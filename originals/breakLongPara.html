<head>
<link href="//fonts.googleapis.com/css?family=Roboto+Condensed:300italic,300,400italic,400,700italic,700" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Roboto:400,100,500,900' rel='stylesheet' type='text/css'>
<style>
* {
font-family: 'Roboto', 'Open Sans', sans-serif;
}
h1{
font-weight: 100;
}
p {
font-weight: 400;
margin: 0;
text-indent: 1.5em;
}
p:first-child {
text-indent: 0;
}
.speakerName {
font-family: 'Roboto Condensed', 'Open Sans', sans-serif;
font-weight: 900;
}
</style>
</head>
<h1>Google I/O 2013 &mdash; Mobile Performance from the Radio Up: Battery, Latency and Bandwidth Optimization</h1>

<div id="paras">
  <p><strong class="speakerName">Ilya Grigorik</strong>: Hi, everyone. My name is Ilya Grigork. I'm a developer advocate on the Make the Web Fast Team at Google. Today I want to talk to you about mobile performance from radio up, which is to say taking a lower level look at how the radio works and what we can learn about it to make our apps — mobile apps and Web pages with more performance. These are some tricks and tips I have learned from working with different Google properties, helping them optimize their applications, and some general best practices. So, first, I think we should start with the obvious which is — or maybe it is not so obvious to many of us — which is wireless is fundamentally different than wired. There are different constraints. The technology, the underlying technology, is, in fact, very different. And, fortunately, or unfortunately, I'm not quite sure yet, our platform actually abstracts that, right? TCP and our browsers make it seem like it is all the same, whether you are accessing over a wireless network, whether it is WiFi or mobile network or wired network. It feels like all the same. But once you actually dig a little bit deeper, you will realize that there are different design constraints within — even within the different wireless standards. And that actually dictates how you need to design your applications to make them feel performant. So, first of all, why do we care? It turns out that performance is a top criteria for all applications, mobile especially. And there's a number of great studies that have been done about performance on mobile. And the first take-away is that users expect mobile sites to perform just as well, if not better, on mobile than they do on desktop. We don't kind of have more relaxed expectations on mobile. If anything, it should be faster. You're on the go. You are trying to check something quickly. You don't have much time. You want it to perform well. Now, out of all of these users that have asked these questions, more than half actually reported feeling frustrated about having a problem when accessing a site or an app over a mobile network. And most of those, the number one complaint has been the slow load time for their applications. So — and after that, almost half of them said, If I had a problem, I couldn't get the page to load fast enough. It didn't react fast enough. They wouldn't come back. So you have lost that user and they're not returning to your site, which is the worst possible outcome. And, of course, this also translates to dollars and cents and even millions of dollars. So this is another great case study that I would like to share. This was done by Aberdeen Group. They looked at a whole number, 100-plus e-commerce sites and they realized that adding one second of delay to their pages and to their applications dropped their conversions significantly. So this is your actual purchases. People viewed fewer pages. And, of course, customer satisfaction decreased as well. So this is just a thousand milliseconds of latency added to your application. So it is not just dollars and cents. For many sites, large sites, it's literally millions of dollars. So our agenda today is to actually look at radio performance 101. It is kind of a propeller-hat talk a little bit. And, specifically, we'll compare WiFi and mobile. And you will see why, because it is important to understand that even something like WiFi and mobile networks are fundamentally different in how we schedule how the communication is done and how we design our applications or what we can even do to optimize our applications. And we'll also look at some practical tips for what you can do in your applications to design for this. And then I'll leave the last part for you, which is to optimize the profit part. So there are tons and tons of techniques for how to make your applications more performant. There is application optimizations. There is PageSpeed-specific optimizations or Speed 1-specific optimizations. We are not going to touch on those. We are going to mention them at the very end. We will are actually going to go a little bit deeper. We are going to go below the application layer, even below the TCP layer, and kind of look at how does the radio actually work, right? So we will put the wired stuff aside, look at the radio and dive into WiFi and mobile. So 3G and 4G, what's so special about that? How does battery life play into this? It turns out that battery life is kind of the central component. There is the radio, and then there is a battery. Those are two connected components that we need to think about. And what is the radio resource controller? Our friend and foe. So let's dive right in. First of all, wireless or WiFi came around in the early '90s. That's when the first standards were published. Really, it only became popular in the late '90s with the release of the 802.11b, which is the 11-megabits-per-second standard. And the thing to realize about WiFi is it was literally designed as an extension to your local area network, your LAN. So we re-use all of the same framing, protocols, mechanisms, and all the rest of them, basically added a wireless interface to it. So it is not designed for a mobile device, which is to say a device with limited battery. It was designed for your desktop computer, your laptop computer, right? We weren't constrained by power at the time. Think back to the phone that you had in 1999. Right? We weren't thinking about the kinds of applications that we were delivering at the time. And the thing about WiFi is we need to understand how we actually schedule how we communicate over WiFi, right? So when we are communicating over a wired connection, we have a switch or a router which routes all of the packets between the destination — or the client and server, for example. In WiFi, we share the radio channel. And the radio channel is a shared medium between all of us, right? All of us can't talk at the same time. That would just generate a lot of noise. So we need some sort of mechanism to figure out who is going to talk when. And WiFi takes a very hands-off approach about this. It basically says let's use a very simple algorithm, which is if you want to talk first, listen if nobody else is talking. If nobody else is talking, then start talking, right? And if another person starts talking while you're talking, well, then both of you stop, wait for random interval of time and repeat the whole process, right? So it is kind of like this party algorithm of, We'll just trust that all of you behave nicely and you will all respect each other and we will just kind of share this medium. That's WiFi. Now, you can actually model this and prove that the channel load or the amount of traffic needs to be kept fairly low. In fact, the load of the network needs to be below 10% in order to achieve good performance. Like, you're always going to have retransmissions. There will always be the case when I start talking and you start talking a little bit later and we collide. That's okay because we will wait and then we will retransmit data and everything is okay. You can get pretty good performance. But after a while, you basically run into the case where there are too many devices trying to compete for the same medium and the network basically collapses. There is no way to recover from this state. And I'm pretty sure all of us have experienced this at some point, right? WiFi in a large group of people and a room, not a good combination oftentimes. So that's in part why. And we can dig a little bit deeper and actually look at how it's implemented. So in the 2.4-gigahertz spectrum, we actually have a limited amount of spectrum. Like, let's say 60 megahertz. Within that 60 megahertz, we can actually have three channels, which is to say up to three devices can talk in parallel and they won't interfere with each other, right? So these are the channels. If you guys have ever dug into your settings on your WiFi router, that would be your, like, channel 1, channel 6 or channel 11 or something to that extent. Now, the problem is — this is nice and pretty. This is a little chart that I pulled up on my own home network. And you can see that there is over a dozen networks, right? And they're all overlapping. We are all trying to talk over each other. And, basically, WiFi, to some degree, is a victim of its own success. It has become so ubiquitous, there are so many WiFi routers out there, that it's just — it is very hard to get a slot to talk to somebody without interfering with anybody, right? So your neighbor, when they start streaming that HD Netflix movie, they are interfering with you as well even though it is a different access point. They are still using the same shared spectrum. So there is limited capacity. And most networks have tens or even more than dozens of overlapping networks. So here's a fun experiment. I ran this at my house. This is not definitive data, but this is an example of a data point. There's about 15 access points just in and around my apartment. And I ran a very simple test. I took my laptop and I had my router which was about 15 feet away and I was staring right at it. And I figured, hey, how long does it take for one packet to get from my laptop to the router? What is the latency of that first hop? And I gathered data for several hours. So this is, you know, a good sample of data. And if you look at the numbers here, the 95th percentile is about 50 milliseconds. So to travel 15 feet from my laptop to my router, it was taking about 50 milliseconds, which is crazy because 50 milliseconds is about the amount of time that it takes to travel from the West Coast to the East Coast, right? So here I am trying to, like, shuttle a packet 15 feet away to my router. This is a function of there is just a lot of other activity in the vicinity. So we were competing for the same spectrum. So then I tried something different. I actually went out and bought a different router, which is using the new — the new 802.11n standard and it's running on the 5-gigahertz band. And the 5-gigahertz band gives us more bandwidth. And by the function that it is also new, not many people are using it, right? So I was like the lone person on that channel. And I ran the same test and there you go. My 95th percentile latency is down to 2 milliseconds. So as far as I'm concerned that was a fantastic investment. So if nothing else, you can go back home, upgrade your router to 5 gigahertz, and hope that not many of you are living in the same neighborhood, and you are not competing with each other. [ Laughter ]</p>
  <p><strong class="speakerName">Mike Mahemoff</strong>: Yes, so as Sam said, I'm Mike. Right now, I'm actually working on Player FM, which is very much around audio. So audio is really the aspect of media that's been most interesting to me. And as well as that, it is actually a responsive web app. So images for any web app is going to be important. And I think something that I focus a lot on is the concept of developer experience, and looking at developers as users as well, and basically understanding what it's like for a developer to perform any particular task. And what are the complications they're having? For me, as just working as a one man band, my time is very valuable. And so a lot of this too is not just about pure functionality — what sort of media capabilities have we got? But it's also about making it really straightforward for developers to do it without having to spend too much time. I know most of my images are kind of responsive to the user. They look responsive, but they're loading way too much data, just because I don't have the time to do it the right way. So those are the kinds of things I hope we can focus on as well today. So do you want to go around, and we'll just really briefly — we're pretty short on time. So just say who you are and what you do.</p>
  <p><strong class="speakerName">Andre Behrens</strong>: The challenge we face is that we publish 300 articles every day — 300, 300 articles every day. And if you're making something that's supposed to show the whole "New York Times," that means you have to show 300. So to give an example of how awful that is, I used to have a section that came from our "Times" wire feed that would do the last 24 hours of articles. And it crashed the app, so I took it out. It just couldn't load that much stuff. And we like to show these nice, big, beautiful images that we pay people a lot of money to put up to take — and that they put their lives on the line to get a lot of the times. And those big, beautiful images in it, in order to fit into our apps, the way we used to do it on the website was the whole thing was structured kind of around the images. This is how big it can be, because this is how big the image is. And so we would just have people manually cutting them whenever they could, pulling from this giant database. And now we're trying to move into a more fluid style, both on our website and in some of our apps. And a big reckoning call was when the iPad came out. And they were saying, well, we don't want to have to look. Because we would have images for certain things in different sizes. They didn't fit together. So we made people put in the big ones. So now you're doing a thing where you're resizing all your images — big performance problem. And then, retina stuff came out, and these stupid pixels came out. And now the main image we use — that's the main one to work with — is called jumbo. And that's 1024 by 768, which is full screen on an old iPad. Then, the retinas came out, so we had to double the size. So they are 2048 on a side. And they take a long time to download. And they take a long time to render. And they affect everything else. And if you are casually resizing them, which a lot of our developers will be inclined to do in this sort of lazy way, it slows everything down. And it doesn't make sense why it's taking so long to load. And it's just a problem.</p>
  <p><strong class="speakerName">Mike Mahemoff</strong>: And do you have any particular techniques that you're using to pick up on that?</p>
<p><strong class="speakerName">Rob</strong>: Whatever's requested.</p>

<p><strong class="speakerName">Jason Grigsby</strong>: Yeah, so the way that I tend to think about it is, we've got a big conflict between what the browser wants, which is to be able to start requesting assets as soon as it can recognize the assets in the document, versus what people want to do in responsive design, which is to have the elements on the page, and particular images, basically size based on the element that it actually is, like the size of the element in the page. And to me, it's sort of akin to when I've gone on vacations with members of our family who want to script every part of the vacation. And then, you've got other people who don't want to plan ahead at all. And those are incredibly tense vacations. And that's what's going on from sort of an imaging perspective, where we've got this conflict between what responsive design people generally want to do, which is to wait until the layout is determined by the viewport size and other characteristics of the device, and what the browser wants to do, which is to start selecting assets as soon as it can.</p>
<p><strong class="speakerName">Jason Grigsby</strong>: I think one of the things that — so I've spent a lot of time working with the responsive images community group and talking about the different use cases, whether it's the art direction use case or the resolution switching use case. And all of this has been in an effort to sort of create that balance between what the preparser wants and what responsive designers want. And I was talking yesterday about how, increasingly, I'm beginning to wonder if it is solvable, or if we're going to end up in a situation where we have to choose between one or the other. And so Estelle has this really, really amazing technique using SVG where you can do media queries inside SVG, and SVG also does raster. And so basically, you can have an SVG image that is basically an image bundle that is responsive. SVG isn't supported across — it isn't on Android 2.3. And there are some other sort of weird quirks around SVG, because SVG is sort of weird generally. But it's promising. And more importantly to me, it's like the moment I saw the clown car technique, which has an awesome name. I found myself thinking that if I had access to this, I would totally use it. Because it's actually the problem that I want to solve. I want to make decisions about the size of images and the sources of images based on the size of the images in the page, not based on device width, not based on viewport width, not based on all these. All those other things are basically like wearing boxing gloves and trying to pick a pencil up off the ground, right? They're crude implements. And so when I saw the clown car technique, I'm not sure if that actually will end up being something that we, as web designers, end up using. But if it actually worked, I don't think that the preparser would have a choice. I think web designers would adopt it, and just move forward, and say, figure it out, browsers.</p>

</div>

<script>
var paragraphs = [];
var paragraphElements = document.querySelectorAll('p');
for (var i = 0; i != paragraphElements.length; ++i) {
  paragraphs.push(paragraphElements[i].innerHTML);
}

okParagraphs = [];
for (var i = 0; i !== paragraphs.length; ++i) {
  var paragraph = paragraphs[i];
  var MAXLENGTH = 500 + Math.floor(Math.random() * 1500);
  if (paragraph.length < MAXLENGTH) {
    okParagraphs.push(paragraph);
  } else {
    okParagraphs = okParagraphs.concat(split(paragraph));
  }
}

function split(paragraph) {
  var sentences = paragraph.
    replace(/([^\.][a-z]\.) ([A-Z])/g, '\$1±@£\$2').
    split('±@£');
  var paragraphs = [];
  var paragraph = '';
  while (sentences.length > 0) {
    paragraph += sentences.shift() + ' ';
    MAXLENGTH = 500 + Math.floor(Math.random() * 1500);
    if (paragraph.length > MAXLENGTH){
      paragraphs.push(paragraph);
      paragraph = '';
    }
  }
  paragraphs.push(paragraph); // the last one, not over-length
  return paragraphs;
}




var splitText = paragraphs.join(' ').trim().replace(/ {2,}/g, ' ');
var okParagraphsText = okParagraphs.join(' ').trim().replace(/ {2,}/g, ' ');
console.log('Unmatched: ', okParagraphsText.replace(splitText, ''));
okParagraphs = okParagraphs.map(function(item){return '<p>' + item.trim() + '</p>'});
document.querySelector('div#paras').innerHTML = okParagraphs.join('').replace(/ {2,}/g, ' ');
</script>
