<p class="speaker"><span class="line" data-starttime="2"><span class="speakerName">Tom Tom Wiltzius</span>: Hello, everyone. I think we're </span><span class="line" data-startTime="2">ready to get started. </span><span class="line" data-startTime="7">Welcome to Jank Busters. I'm Tom Wiltzius. </span><span class="line" data-startTime="7">I'm a PM on the Chrome graphics team. </span></p>

<p class="speaker"><span class="line" data-starttime="12"><span class="speakerName">Nat Duca</span>: I'm Nat Duca. I'm a graphics hacker </span><span class="line" data-startTime="12">on the Chrome team. </span></p>

<p class="speaker"><span class="line" data-starttime="15"><span class="speakerName">Tom Tom Wiltzius</span>: And we're here today to talk </span><span class="line" data-startTime="15">about Jank on the web, what it is and how </span><span class="line" data-startTime="19">to avoid it. </span></p>

<p class="speaker"><span class="line" data-starttime="19"><span class="speakerName">Nat Duca</span>: Yeah. So Jank. Everybody has a </span><span class="line" data-startTime="22">screen in front of them, probably. Jank really </span><span class="line" data-startTime="22">begins with the monitor, right? You've got </span><span class="line" data-startTime="26">this monitor in front of you and it's designed </span><span class="line" data-startTime="26">to sort of trick your eye into this illusion </span><span class="line" data-startTime="30">of motion, and the way it does that is by </span><span class="line" data-startTime="30">updating a frame every couple milliseconds, </span><span class="line" data-startTime="35">right? </span><span class="line" data-startTime="35">And the trick is, your eye wants to go at </span><span class="line" data-startTime="38">something like 40 hertz, and if you do that, </span><span class="line" data-startTime="38">then you'll perceive motion. </span><span class="line" data-startTime="42">And so monitors out there go anywhere from </span><span class="line" data-startTime="42">30 to 50 to 60 to 70 hertz, right? And if </span><span class="line" data-startTime="48">you manage to get all of your JavaScript and </span><span class="line" data-startTime="48">all your different pieces going at that rate </span><span class="line" data-startTime="53">of the monitor, then you can present this </span><span class="line" data-startTime="53">illusion of smoothness and then people are </span><span class="line" data-startTime="58">happy. </span></p>

<p class="speaker"><span class="line" data-starttime="58"><span class="speakerName">Tom Tom Wiltzius</span>: But if you don't manage that, </span><span class="line" data-startTime="60">then you end up with Jank. And this is what </span><span class="line" data-startTime="60">we're talking about when we're talking about </span><span class="line" data-startTime="63">Jank. </span> <span class="line" data-startTime="63">It's anytime that you don't get a new image </span><span class="line" data-startTime="65">on the screen every time the monitor refreshes. </span> <span class="line" data-startTime="65">This comes in all sorts of formats. A hitch </span><span class="line" data-startTime="71">is when we miss a bunch of frames in a row. </span> <span class="line" data-startTime="71">A low frame rate is when you're taking out </span><span class="line" data-startTime="74">a frame every maybe fifth of a second instead </span><span class="line" data-startTime="74">of every 50th. A variable frame rate is maybe </span><span class="line" data-startTime="78">some combination of these things. And this </span><span class="line" data-startTime="78">is particularly painful when you're trying </span><span class="line" data-startTime="83">to interact with something. </span> <span class="line" data-startTime="83">So here's a div with a bunch of Chrome logos </span><span class="line" data-startTime="87">moving around and it scrolls sluggishly. It's </span><span class="line" data-startTime="87">what we call a Janky scroll. And the problem </span><span class="line" data-startTime="93">here is that as I move my finger on the trackpad, </span><span class="line" data-startTime="93">I'm scrolling around in this little iframe </span><span class="line" data-startTime="102">but the frame rate isn't matched up to the </span><span class="line" data-startTime="102">monitor's refresh rate, and as I move my finger, </span><span class="line" data-startTime="108">I don't get the smooth motion on the screen </span><span class="line" data-startTime="108">that I sort of expect. </span></p>

<p><span class="line" data-startTime="112">And so the physical metaphor is broken and </span><span class="line" data-startTime="112">it doesn't &mdash; it doesn't feel good. It doesn't </span><span class="line" data-startTime="116">feel fluid. </span></p>

<p class="speaker"><span class="line" data-starttime="116"><span class="speakerName">Nat Duca</span>: Yeah. So, you know, basically </span><span class="line" data-startTime="120">what's going on behind the scenes when you </span><span class="line" data-startTime="120">get dropped out of your experience and you </span><span class="line" data-startTime="123">get something like Jank is one part of the </span><span class="line" data-startTime="123">rendering pipeline is getting behind, right? </span><span class="line" data-startTime="129">Now, if you go on line and you look at our </span><span class="line" data-startTime="129">talk from last year's I/O and also a lot of </span><span class="line" data-startTime="133">great resources out there on Jank busting, </span><span class="line" data-startTime="133">you'll find that there's this great feature </span><span class="line" data-startTime="138">in DevTools called the frames mode. It's in </span><span class="line" data-startTime="138">the Timeline. And you can use that to record, </span><span class="line" data-startTime="144">basically, an interaction with your page and </span><span class="line" data-startTime="144">see, for example, "Oh, hey, this frame ran </span><span class="line" data-startTime="149">long because of JavaScript." And there are </span><span class="line" data-startTime="149">just thousands of things that can go wrong. </span> <span class="line" data-startTime="153">CSS can run long. You can have an XHR that </span><span class="line" data-startTime="153">comes back and does some big json parse. You </span><span class="line" data-startTime="158">can have an image decode that fires. You can </span><span class="line" data-startTime="158">&mdash; you know, I can go on for hours on this, </span><span class="line" data-startTime="163">you know. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="163"><span class="speakerName">Tom Tom Wiltzius</span>: What Nat is trying to say </span><span class="line" data-startTime="165">is there's a lot that gets in the way of the </span><span class="line" data-startTime="165">16 milliseconds you have to make a new image </span><span class="line" data-startTime="170">before the monitor refreshes. And there are, </span><span class="line" data-startTime="170">as Nat says, lots and lots of ways that this </span><span class="line" data-startTime="175">can go poorly but today we're going to talk </span><span class="line" data-startTime="175">about one kind of specific category and that's </span><span class="line" data-startTime="180">what are essentially the green bars in the </span><span class="line" data-startTime="180">vertical Timeline in DevTools. </span><span class="line" data-startTime="184">This is what we call sort of rendering, but </span><span class="line" data-startTime="184">that breaks down into painting and compositing </span><span class="line" data-startTime="189">and we're going to talk about both of those </span><span class="line" data-startTime="189">in today's talk. </span></p>

<p class="speaker"><span class="line" data-starttime="192"><span class="speakerName">Nat Duca</span>: And it's good that Tom saved you </span><span class="line" data-startTime="192">from me yammering on because you'd just fall </span><span class="line" data-startTime="196">asleep and be wasting your time. </span><span class="line" data-startTime="196">[ Laughter ] </span></p>

<p class="speaker"><span class="line" data-starttime="199"><span class="speakerName">Tom Tom Wiltzius</span>: So rendering, what are we </span><span class="line" data-startTime="199">going to talk about today? We're going to </span><span class="line" data-startTime="203">talk about painting speed, what &mdash; what kind </span><span class="line" data-startTime="203">of goes into it and how you can try to paint </span><span class="line" data-startTime="208">as quickly as possible. But then even better </span><span class="line" data-startTime="208">than that, we're going to try to talk about </span><span class="line" data-startTime="211">how you can avoid painting in the first place, </span><span class="line" data-startTime="211">either because you were doing so accidentally </span><span class="line" data-startTime="216">and you didn't realize it &mdash; and we're going </span><span class="line" data-startTime="216">to show you how to notice that kind of thing </span><span class="line" data-startTime="218">&mdash; and then better yet, we're going to talk </span><span class="line" data-startTime="218">about how to deliberately avoid paints from </span><span class="line" data-startTime="223">the get-go when you're designing your application. </span></p>

<p class="speaker"><span class="line" data-starttime="223"><span class="speakerName">Nat Duca</span>: And there will not be a rocket </span><span class="line" data-startTime="227">ship that we can give you at the end as a </span><span class="line" data-startTime="227">takeaway, so sorry. </span> <span class="line" data-startTime="231">The beginning building block of rendering </span><span class="line" data-startTime="231">in a web browser is preparing pixels to be </span><span class="line" data-startTime="236">put up on the screen. </span> <span class="line" data-startTime="236">So if you go to Google &mdash; right? &mdash; we've </span><span class="line" data-startTime="239">all been there, you're presented with this, </span><span class="line" data-startTime="239">which is the nice little happy hello Google </span><span class="line" data-startTime="244">thing, and you get a blinking cursor, right? </span><span class="line" data-startTime="244">Where the only difference between the page </span><span class="line" data-startTime="250">over time is the cursor coming on and off. </span> <span class="line" data-startTime="250">Now, what Chrome's doing behind the scenes </span><span class="line" data-startTime="255">is it's actually filling in those black dots </span><span class="line" data-startTime="255">for the cursor itself, and what it's doing </span><span class="line" data-startTime="259">is it's got some, you know, logic in it that </span><span class="line" data-startTime="259">says, "Ooh, this part of the page has changed. </span> <span class="line" data-startTime="264">I need to refill those pixels with black or </span><span class="line" data-startTime="264">I need to remove them." </span><span class="line" data-startTime="268">And so you get this little update req, this </span><span class="line" data-startTime="268">painted area on the screen that we repaint </span><span class="line" data-startTime="273">and then you see this illusion of a blinking </span><span class="line" data-startTime="273">cursor. </span></p>

<p><span class="line" data-startTime="278">Now, if you think about that, that takes some </span><span class="line" data-startTime="278">time but it's probably relatively little and </span><span class="line" data-startTime="282">if I compared the time taken to blink the </span><span class="line" data-startTime="282">cursor versus, say, if I just had the whole </span><span class="line" data-startTime="285">Google logo blinking &mdash; now, of course people </span><span class="line" data-startTime="285">would be upset if I did that to our home page, </span><span class="line" data-startTime="290">but also, it would take more time to do it, </span><span class="line" data-startTime="290">okay? Because there's just &mdash; you can sort </span><span class="line" data-startTime="294">of think about this. This is intuitive. We </span><span class="line" data-startTime="294">have to touch more pixels, right? So that's </span><span class="line" data-startTime="298">one dimension of rendering performance and </span><span class="line" data-startTime="298">in particular painting speed, is how many </span><span class="line" data-startTime="302">pixels you've touched. </span> <span class="line" data-startTime="302">But that's not the only dimension, of course. </span> <span class="line" data-startTime="306">The other part that matters is what you touch </span><span class="line" data-startTime="306">and what type of content is in the area that </span><span class="line" data-startTime="310">you're updating. </span></p>

<p><span class="line" data-startTime="310">So if you take this white block on the upper </span><span class="line" data-startTime="314">left, that's just white. And if you think </span><span class="line" data-startTime="314">about what Chrome has to do to make those </span><span class="line" data-startTime="318">pixels white, it just has to sort of put RGBA </span><span class="line" data-startTime="318">for white into a bunch of parts of memory. </span> <span class="line" data-startTime="324">So that's a mem set and it's pretty darn fast. </span> <span class="line" data-startTime="324">In contrast, the "I'm Feeling Lucky" button </span><span class="line" data-startTime="329">has all sorts of nasty little details on it, </span><span class="line" data-startTime="329">and it's actually kind of fun to zoom on this </span><span class="line" data-startTime="333">on a computer with a magnifying glass and </span><span class="line" data-startTime="333">see all the things going on there. If any </span><span class="line" data-startTime="337">of you have actually taken like an undergrad </span><span class="line" data-startTime="337">graphics class and had to write like a line </span><span class="line" data-startTime="341">drawing algorithm, imagine having to do that </span><span class="line" data-startTime="341">in Chrome but where you also have antialiasing </span><span class="line" data-startTime="346">and rounded corners and blurs and text and </span><span class="line" data-startTime="346">anti-alias text. It gets really hairy and </span><span class="line" data-startTime="351">it's sort of the thing that makes you want </span><span class="line" data-startTime="351">to jump off a, you know, cliff, but it's also </span><span class="line" data-startTime="356">the thing that makes the CPU chug along. </span> <span class="line" data-startTime="356">So painting is a slow thing and it's something </span><span class="line" data-startTime="361">to be avoided pretty much at all costs. </span></p>

<p class="speaker"><span class="line" data-starttime="361"><span class="speakerName">Tom Tom Wiltzius</span>: And you want to wonder probably </span><span class="line" data-startTime="366">like what &mdash; what is expensive and what isn't, </span><span class="line" data-startTime="366">right? Like Nat is just asserting that like, </span><span class="line" data-startTime="370">oh, drawing his NTOS lines is expensive, but </span><span class="line" data-startTime="370">in an ideal world you would be able to measure </span><span class="line" data-startTime="376">this kind of thing. And this is something </span><span class="line" data-startTime="376">that DevTools does allow you to do to a certain </span><span class="line" data-startTime="380">extent. A good question to ask is like, "Well, </span><span class="line" data-startTime="380">which elements on the page are expensive?" </span><span class="line" data-startTime="385">And a good way to measure that is with continuous </span><span class="line" data-startTime="385">painting mode in DevTools, which is a DevTools </span><span class="line" data-startTime="390">setting that we're not going to talk about </span><span class="line" data-startTime="390">in great detail today but there are some really </span><span class="line" data-startTime="394">good resources on the web about how to use </span><span class="line" data-startTime="394">it. This link &mdash; and our slides will be linked </span><span class="line" data-startTime="399">on the web later &mdash; will take you to an article </span><span class="line" data-startTime="399">that explains in detail how to use continuous </span><span class="line" data-startTime="404">painting mode to repaint the entire frame </span><span class="line" data-startTime="404">as fast as possible and tell you how long </span><span class="line" data-startTime="409">that takes and then you can hide certain elements </span><span class="line" data-startTime="409">and see how does that affect the painting </span><span class="line" data-startTime="414">time. Because often as not, it's a single </span><span class="line" data-startTime="414">complicated element that's taking all the </span><span class="line" data-startTime="416">time. </span></p>

<p class="speaker"><span class="line" data-starttime="416"><span class="speakerName">Nat Duca</span>: When you look at your page, look </span><span class="line" data-startTime="418">at all the pieces and keep in the back of </span><span class="line" data-startTime="418">your head that not all of them are the same </span><span class="line" data-startTime="422">cost and you're paying for some of those effects </span><span class="line" data-startTime="422">more than others. And if you start getting </span><span class="line" data-startTime="427">in a situation where you see painting, start </span><span class="line" data-startTime="427">figuring out which ones you're paying for </span><span class="line" data-startTime="430">and whether you really want to be paying for </span><span class="line" data-startTime="430">that bill for that one. </span></p>

<p class="speaker"><span class="line" data-starttime="433"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. Painting also, </span><span class="line" data-startTime="433">I should say, isn't &mdash; it's not just about </span><span class="line" data-startTime="437">the blinking cursor, right? In the blinking </span><span class="line" data-startTime="437">cursor case, it makes sense that we need to </span><span class="line" data-startTime="441">repaint like the part of the screen that's </span><span class="line" data-startTime="441">changed because the pixel output is different. </span> <span class="line" data-startTime="445">But there are plenty of cases on the web where </span><span class="line" data-startTime="445">even if you change something that doesn't </span><span class="line" data-startTime="450">have any sort of material impact on the final </span><span class="line" data-startTime="450">presentation of what goes up on the screen, </span><span class="line" data-startTime="457">you can still incur a costly repaint, and </span><span class="line" data-startTime="457">we're going to show a small demo of that right </span><span class="line" data-startTime="461">now. </span> <span class="line" data-startTime="461">If I hit this button, I get elements that </span><span class="line" data-startTime="466">are added to this screen. It's &mdash; this is </span><span class="line" data-startTime="466">really simple. These are just gray divs. Basically </span><span class="line" data-startTime="471">styles, right? </span></p>

<p class="speaker"><span class="line" data-starttime="471"><span class="speakerName">Nat Duca</span>: Winner of Web Site of the Year </span><span class="line" data-startTime="473">for 2013. </span></p>

<p class="speaker"><span class="line" data-starttime="473"><span class="speakerName">Tom Tom Wiltzius</span>: Thanks, Nat. </span></p>

<p class="speaker"><span class="line" data-starttime="474"><span class="speakerName">Nat Duca</span>: Because you're good. </span></p>

<p class="speaker"><span class="line" data-starttime="474"><span class="speakerName">Tom Tom Wiltzius</span>: And what we want to do here </span><span class="line" data-startTime="480">is get some insight into what is being painted </span><span class="line" data-startTime="480">when by the browser. </span><span class="line" data-startTime="484">So if we open up DevTools and we turn on show </span><span class="line" data-startTime="484">paint rectangles under the rendering heading </span><span class="line" data-startTime="489">of settings, then we have &mdash; we have the ability </span><span class="line" data-startTime="489">to really see what gets painted as the page </span><span class="line" data-startTime="495">changes. </span><span class="line" data-startTime="495">So again, I'm going to hit this button a few </span><span class="line" data-startTime="497">times and you can see that as I add additional </span><span class="line" data-startTime="497">elements, there's a red &mdash; red rectangle that </span><span class="line" data-startTime="504">flashes over the element and that red rectangle </span><span class="line" data-startTime="504">means, "This part of the screen just got repainted </span><span class="line" data-startTime="509">by Chrome." Or really by Blink in this case. </span></p>

<p class="speaker"><span class="line" data-starttime="509"><span class="speakerName">Nat Duca</span>: So that's that rectangle that </span><span class="line" data-startTime="512">I was showing you in slides but in runtime </span><span class="line" data-startTime="512">for your production site. </span></p>

<p class="speaker"><span class="line" data-starttime="515"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. And I can keep </span><span class="line" data-startTime="515">adding elements, and now I'm adding elements </span><span class="line" data-startTime="518">like way below the fold of the page and you </span><span class="line" data-startTime="518">can see that as I add more, the only thing </span><span class="line" data-startTime="524">that gets repainted here is the button, because </span><span class="line" data-startTime="524">it ends up in this depressed state and then </span><span class="line" data-startTime="528">comes out of it, and the scrollbar, because </span><span class="line" data-startTime="528">the scrollbar size is changing. </span> <span class="line" data-startTime="533">So this is great, right? And it makes sense </span><span class="line" data-startTime="533">in some sort of basic logic that as you're </span><span class="line" data-startTime="538">adding elements below the fold of the page, </span><span class="line" data-startTime="538">you're not having to repaint anything that </span><span class="line" data-startTime="542">is on the page. But it's not always that simple. </span> <span class="line" data-startTime="542">If I try to do something like inspect this </span><span class="line" data-startTime="549">container block &mdash; and the DevTools inspection </span><span class="line" data-startTime="549">is going to drive the paint rectangles nuts </span><span class="line" data-startTime="555">a little bit, but if I look at this block </span><span class="line" data-startTime="555">that contains all of these elements and then </span><span class="line" data-startTime="560">I toggle, say, how much padding there is on </span><span class="line" data-startTime="560">the right side of that container block, I'm </span><span class="line" data-startTime="565">not going to end up with any, again, visible </span><span class="line" data-startTime="565">change to what gets rendered. </span> <span class="line" data-startTime="569">These divs are sized such that even if there's </span><span class="line" data-startTime="569">an extra 10 pixels of padding on the right </span><span class="line" data-startTime="574">side of that container, the layout is not </span><span class="line" data-startTime="574">going to change, nothing is going to look </span><span class="line" data-startTime="577">any different. But watch what happens when </span><span class="line" data-startTime="577">I add some of that padding. You can see in </span><span class="line" data-startTime="582">&mdash; it's probably small text, but padding has </span><span class="line" data-startTime="582">showed up in the element style in inspector </span><span class="line" data-startTime="589">and I got this big red rectangle that flashed </span><span class="line" data-startTime="589">over the entire container. And the reason </span><span class="line" data-startTime="594">is that Blink, I mean, it's not that smart, </span><span class="line" data-startTime="594">right? And so when some of this padding got </span><span class="line" data-startTime="599">added, there was a series of steps that it </span><span class="line" data-startTime="599">went through that said, "Okay, now I need </span><span class="line" data-startTime="604">to think about do I need to recalculate the </span><span class="line" data-startTime="604">position of any of the elements inside of </span><span class="line" data-startTime="610">this container block?" </span><span class="line" data-startTime="610">The answer ends up being "no" but in the process, </span><span class="line" data-startTime="613">it invalidates the &mdash; the sort of visible </span><span class="line" data-startTime="613">state of all of these elements on the screen </span><span class="line" data-startTime="618">and then they all get repainted. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="618"><span class="speakerName">Nat Duca</span>: Yeah. Blink has a well-meaning </span><span class="line" data-startTime="621">but sometimes confused brain and so, you know, </span><span class="line" data-startTime="621">in this case it's getting confused. It thinks </span><span class="line" data-startTime="625">that maybe something bad is about to happen </span><span class="line" data-startTime="625">and it causes a repaint. And this is the sort </span><span class="line" data-startTime="629">of thing that actually happens more often </span><span class="line" data-startTime="629">than we'd like. </span> <span class="line" data-startTime="632">When you use and write really nice modular </span><span class="line" data-startTime="632">code that's beautiful and has all sorts of </span><span class="line" data-startTime="636">awesome design patterns in it, sometimes this </span><span class="line" data-startTime="636">sort of thing will creep in because somewhere </span><span class="line" data-startTime="641">deep in there somebody added a class and then </span><span class="line" data-startTime="641">removed a class somewhere else and that confused </span><span class="line" data-startTime="645">the system. So this is something to keep your </span><span class="line" data-startTime="645">eye out for when you're doing sort of day-to-day </span><span class="line" data-startTime="650">production. Keep an eye out for these erroneous </span><span class="line" data-startTime="650">blinks where you would expect there to be </span><span class="line" data-startTime="654">no red flash and there is. Because once they </span><span class="line" data-startTime="654">start creeping in, they're really devilishly </span><span class="line" data-startTime="659">hard to stamp out again. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="659"><span class="speakerName">Tom Tom Wiltzius</span>: Very true. So switching gears </span><span class="line" data-startTime="663">a little bit, we've talked about painting </span><span class="line" data-startTime="663">now, but the &mdash; the next best thing from trying </span><span class="line" data-startTime="668">to avoid unnecessary paints is to not paint </span><span class="line" data-startTime="668">at all. And Nat's going to talk a little bit </span><span class="line" data-startTime="674">about how we do that for common cases like </span><span class="line" data-startTime="674">scrolling. </span></p>

<p class="speaker"><span class="line" data-starttime="676"><span class="speakerName">Nat Duca</span>: So like in ye old days &mdash; right, </span><span class="line" data-startTime="676">like 1990 something, the way that we would </span><span class="line" data-startTime="681">scroll a page in a browser was we would repaint </span><span class="line" data-startTime="681">parts of it. So we would move bits of the </span><span class="line" data-startTime="685">pixels up using some low-level things, and </span><span class="line" data-startTime="685">then we'd do a big repaint rectangle on the </span><span class="line" data-startTime="689">area that you'd exposed from the scroll. </span> <span class="line" data-startTime="689">Now we just talked for, you know, a while </span><span class="line" data-startTime="694">about how devilishly slow painting is and </span><span class="line" data-startTime="694">how it should be avoided. So developers in </span><span class="line" data-startTime="700">both, you know, Webkit and Blink and Chrome </span><span class="line" data-startTime="700">and pretty much everywhere have adopted this </span><span class="line" data-startTime="704">new notion of a layer. </span> <span class="line" data-startTime="704">If you look at this picture we've got up of </span><span class="line" data-startTime="708">Gmail, the analogy is this: If I look at Gmail, </span><span class="line" data-startTime="708">I know that there's a part of the page that's </span><span class="line" data-startTime="713">just going to move up and down. It's not going </span><span class="line" data-startTime="713">to change visually. It's just there are going </span><span class="line" data-startTime="717">to be new pieces shown that weren't previously </span><span class="line" data-startTime="717">visible. Right? </span><span class="line" data-startTime="721">But the stuff on top of it, the &mdash; the top </span><span class="line" data-startTime="721">nav and the left thing, they'll always be </span><span class="line" data-startTime="725">there. And so there's this sort of idea of </span><span class="line" data-startTime="725">"Hey, we will detect that using semantic cues </span><span class="line" data-startTime="729">in your thing like it being an overflow div </span><span class="line" data-startTime="729">and we will turn those into layers and each </span><span class="line" data-startTime="734">layer becomes a picture that we upload to </span><span class="line" data-startTime="734">the GPU on your computer, store there, and </span><span class="line" data-startTime="740">then if the thing that you're doing to your </span><span class="line" data-startTime="740">page is just moving the layers around, we </span><span class="line" data-startTime="744">can ask the GPU to scroll it for you." Or, </span><span class="line" data-startTime="744">in fact, reposition it and then ask the GPU </span><span class="line" data-startTime="748">to recompose them. And so it looks like you're </span><span class="line" data-startTime="748">scrolling because you're only looking down </span><span class="line" data-startTime="752">at the layers. You just see it &mdash; you know, </span><span class="line" data-startTime="752">it looks like you're seeing the whole Web </span><span class="line" data-startTime="755">page. But what's happening underneath is the </span><span class="line" data-startTime="755">browser is just re-compositing, skipping that </span><span class="line" data-startTime="760">expensive paint step, and going nice and jankfree. </span></p>

<p><span class="line" data-startTime="760">But this all depends &mdash; this jankfreeness </span><span class="line" data-startTime="767">is all predicated on you getting good layers </span><span class="line" data-startTime="767">in the first place, and if you don't get those </span><span class="line" data-startTime="771">layers created, things can go a little bit </span><span class="line" data-startTime="771">haywire. </span></p>

<p class="speaker"><span class="line" data-starttime="773"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. It's also predicated </span><span class="line" data-startTime="773">on not like the good layers. It's predicated </span><span class="line" data-startTime="777">on the layers being set up in such a way that </span><span class="line" data-startTime="777">we don't need to paint them, right? Like if </span><span class="line" data-startTime="782">the layer content is changing, then all bets </span><span class="line" data-startTime="782">are off on this being a good system. So I'll </span><span class="line" data-startTime="787">open up another demo, and this one &mdash; maybe </span><span class="line" data-startTime="787">it will load... </span><span class="line" data-startTime="796">You want to turn off &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="796"><span class="speakerName">Nat Duca</span>: I will turn off WiFi. </span><span class="line" data-startTime="797">Tom Wiltzius: &mdash; WiFi and try again? </span><span class="line" data-startTime="797">In a case where we scroll &mdash; in this case, </span><span class="line" data-startTime="805">a whole long list of images, we can &mdash; we </span><span class="line" data-startTime="805">can do that pretty well, right? </span><span class="line" data-startTime="811">Nothing on the page is changing here. This </span><span class="line" data-startTime="811">is really a simple sort of like static media </span><span class="line" data-startTime="814">site scenario. And indeed, we can scroll this </span><span class="line" data-startTime="814">&mdash; this quite well. </span><span class="line" data-startTime="819">This whole sort of body of the page is in </span><span class="line" data-startTime="819">a layer. It's being re-composited every frame. </span></p>

<p class="speaker"><span class="line" data-starttime="825"><span class="speakerName">Nat Duca</span>: We shall bless this jankfree. </span></p>

<p class="speaker"><span class="line" data-starttime="825"><span class="speakerName">Tom Tom Wiltzius</span>: Right. But if I open up DevTools </span><span class="line" data-startTime="831">again and I turn on show paint rectangles, </span><span class="line" data-startTime="831">as I had, then you can see that part of the </span><span class="line" data-startTime="840">kind of jankfreeness here is that nothing </span><span class="line" data-startTime="840">is being repainted. The only thing that's </span><span class="line" data-startTime="843">being repainted is, again, the scrollbar so </span><span class="line" data-startTime="843">we can kind of afford. </span></p>

<p class="speaker"><span class="line" data-starttime="846"><span class="speakerName">Nat Duca</span>: So we're keeping that contract </span><span class="line" data-startTime="846">with the browser: I won't repaint and you'll </span><span class="line" data-startTime="848">be jankfree. </span></p>

<p class="speaker"><span class="line" data-starttime="848"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. But if I hover </span><span class="line" data-startTime="851">over this image, I've got actually kind of </span><span class="line" data-startTime="851">like a nice animation that happens. I add </span><span class="line" data-startTime="856">a shadow, I change the opacity, I brighten </span><span class="line" data-startTime="856">the image a little bit. This is the kind of </span><span class="line" data-startTime="860">thing that's become increasingly common. And </span><span class="line" data-startTime="860">as I do that, you can see that because it's </span><span class="line" data-startTime="865">sort of a complicated animation that Chrome </span><span class="line" data-startTime="865">doesn't accelerate very well, I get a lot </span><span class="line" data-startTime="869">of repaints throughout the course of the animation </span><span class="line" data-startTime="869">and that's those red rectangles flashing over </span><span class="line" data-startTime="873">the animation again. But that animation is </span><span class="line" data-startTime="873">going to play really, really poorly with the </span><span class="line" data-startTime="879">scroll, and you can probably guess why by </span><span class="line" data-startTime="879">now, based on everything we've just said. </span> <span class="line" data-startTime="883">The &mdash; the browser is going to start repainting </span><span class="line" data-startTime="883">to run the animation right at the time when </span><span class="line" data-startTime="889">it &mdash; what it wants to be doing is re-compositing </span><span class="line" data-startTime="889">this static unchanging content over and over </span><span class="line" data-startTime="895">again in different positions. But if the content's </span><span class="line" data-startTime="895">changed, then it can't just reposition it. </span></p>

<p><span class="line" data-startTime="898">It needs to repaint it first, re-upload it </span><span class="line" data-startTime="898">to the GPU, and then re-composite it. You </span><span class="line" data-startTime="902">lose all the benefits. And indeed, if I try </span><span class="line" data-startTime="902">to scroll with my mouse over here, the resolution </span><span class="line" data-startTime="909">of this screen is hurting me a little bit, </span><span class="line" data-startTime="909">but it gets a lot Jankier, and you can see </span><span class="line" data-startTime="912">that these are these big red flashes that </span><span class="line" data-startTime="912">occur all over &mdash; all over the page and that </span><span class="line" data-startTime="918">gets in the way of sort of a jankfree scroll. </span></p>

<p class="speaker"><span class="line" data-starttime="918"><span class="speakerName">Nat Duca</span>: Yeah. So these big red flashes </span><span class="line" data-startTime="922">are your warning to &mdash; you know, your one-way </span><span class="line" data-startTime="922">trip to Janktown, right? You've got big red </span><span class="line" data-startTime="926">flashes and you're basically going to start </span><span class="line" data-startTime="926">repainting all the time and then on a low-end </span><span class="line" data-startTime="931">machine &mdash; this is a Mac Book Pro so of course </span><span class="line" data-startTime="931">it's going to be in better shape, but on a </span><span class="line" data-startTime="935">lower-end machine especially you're going </span><span class="line" data-startTime="935">to really start paying dearly. </span></p>

<p class="speaker"><span class="line" data-starttime="937"><span class="speakerName">Tom Tom Wiltzius</span>: This is the type of thing </span><span class="line" data-startTime="937">that we see as particularly painful on like </span><span class="line" data-startTime="941">phones or tablets. In this case, I mean, getting </span><span class="line" data-startTime="941">rid of the hover effect is a relatively simple </span><span class="line" data-startTime="946">task, right? So if I uncheck this box, there's </span><span class="line" data-startTime="946">a scroll handler here that will disable the </span><span class="line" data-startTime="952">hover effect when it first runs and then sets </span><span class="line" data-startTime="952">a timer and 200 milliseconds after the final </span><span class="line" data-startTime="958">on-scroll event, it will re-enable the hover </span><span class="line" data-startTime="958">effects. This means that I can start scrolling </span><span class="line" data-startTime="963">and the hover effects get disabled and no </span><span class="line" data-startTime="963">repaint is happening during the scroll but </span><span class="line" data-startTime="967">then as soon as the scroll is done, I still </span><span class="line" data-startTime="967">get my sort of nice animation. </span></p>

<p class="speaker"><span class="line" data-starttime="971"><span class="speakerName">Nat Duca</span>: And this is sort of your instant </span><span class="line" data-startTime="971">recipe to making it smooth, right? Is if you </span><span class="line" data-startTime="974">are willing to compromise on some of those </span><span class="line" data-startTime="974">gorgeous hover effects or whatever it is that </span><span class="line" data-startTime="978">is causing your repaint in the first place, </span><span class="line" data-startTime="978">if you're willing to reduce it during the </span><span class="line" data-startTime="982">scroll or simplify your content in some way, </span><span class="line" data-startTime="982">you can go nice and fast again. </span></p>

<p class="speaker"><span class="line" data-starttime="986"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. I mean, this </span><span class="line" data-startTime="986">is changing the behavior of the page, right? </span><span class="line" data-startTime="988">And that's not always going to be acceptable </span><span class="line" data-startTime="988">to you. So it's important to understand that </span><span class="line" data-startTime="992">there are often tradeoffs between how well </span><span class="line" data-startTime="992">something performs and what it looks &mdash; what </span><span class="line" data-startTime="997">it looks like, but it isn't always going to </span><span class="line" data-startTime="997">be possible to achieve whatever sort of like </span><span class="line" data-startTime="1001">crazy effect you want in a &mdash; a totally nice </span><span class="line" data-startTime="1001">performance way. </span> <span class="line" data-startTime="1006">We're sort of picking on hover here, but really </span><span class="line" data-startTime="1006">there are all sorts of things that can cause </span><span class="line" data-startTime="1011">this sort of problem. </span> <span class="line" data-startTime="1011">The &mdash; the real thing you want to do is use </span><span class="line" data-startTime="1016">show paint reqs to sort of look for these </span><span class="line" data-startTime="1016">big red flashes during your scroll or during </span><span class="line" data-startTime="1021">your animation and then try total rid of them. </span> <span class="line" data-startTime="1021">So hover effects are one thing to look out </span><span class="line" data-startTime="1024">for but there are a lot of others as well. </span></p>

<p><span class="line" data-startTime="1024">Common problems come from fixed-position elements </span><span class="line" data-startTime="1030">or overflow scroll divs or touch listeners, </span><span class="line" data-startTime="1030">mouse wheel events, trying to reposition things </span><span class="line" data-startTime="1038">in an on-scroll handler for like paralax effects </span><span class="line" data-startTime="1038">sites. These are all things that we see that </span><span class="line" data-startTime="1042"> &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="1042"><span class="speakerName">Nat Duca</span>: Social widgets that you position </span><span class="line" data-startTime="1044">when people hover over an article and stuff </span><span class="line" data-startTime="1044">like that. Like give the pages a chance to </span><span class="line" data-startTime="1048">settle before you bring in your, you know, </span><span class="line" data-startTime="1048">+1 button, right? </span></p>

<p class="speaker"><span class="line" data-starttime="1051"><span class="speakerName">Tom Tom Wiltzius</span>: Right. Which is not to say </span><span class="line" data-startTime="1051">that like these things are bad, right? It's </span><span class="line" data-startTime="1054">just that you need to be aware that in sort </span><span class="line" data-startTime="1054">of liberally using them, you may end up in </span><span class="line" data-startTime="1058">a position where you really end up fighting </span><span class="line" data-startTime="1058">with the rendering system and the performance </span><span class="line" data-startTime="1062">is going to go through the floor. There are </span><span class="line" data-startTime="1062">cases where you really do need that paint, </span><span class="line" data-startTime="1066">though, you really do want something to change </span><span class="line" data-startTime="1066">accident occurring a scroll, and that's fine. </span><span class="line" data-startTime="1069">If it's fast enough, you can still be Jankfree, </span><span class="line" data-startTime="1069">right? But you're going to have to be very </span><span class="line" data-startTime="1073">vigilant about keeping paint as cheap as possible. </span><span class="line" data-startTime="1073">For this, you want to be paying a lot of attention </span><span class="line" data-startTime="1078">to how visually complicated your CSS is and </span><span class="line" data-startTime="1078">continuous painting mode that we plugged earlier </span><span class="line" data-startTime="1082">is a good way to try to reduce the cost of </span><span class="line" data-startTime="1082">a lot of those paints. Image decodes and resizes </span><span class="line" data-startTime="1087">can be really painful. If you're on a media </span><span class="line" data-startTime="1087">site with tons of images, you can blow the </span><span class="line" data-startTime="1090">image cache inside of Blink and that can be </span><span class="line" data-startTime="1090">really painful. </span></p>

<p class="speaker"><span class="line" data-starttime="1093"><span class="speakerName">Nat Duca</span>: Constant vigilance. </span></p>

<p class="speaker"><span class="line" data-starttime="1093"><span class="speakerName">Tom Tom Wiltzius</span>: Constant vigilance is the </span><span class="line" data-startTime="1096">answer, yeah. But now Nat's going to talk </span><span class="line" data-startTime="1096">about some of the other great applications </span><span class="line" data-startTime="1100">of layers. </span></p>

<p class="speaker"><span class="line" data-starttime="1100"><span class="speakerName">Nat Duca</span>: Well, I think we've got another </span><span class="line" data-startTime="1101">demo for you which is always fun, more fun </span><span class="line" data-startTime="1101">than us talking but, you know, here's the </span><span class="line" data-startTime="1105">thing. We showed you how you can use layers </span><span class="line" data-startTime="1105">to scroll smoothly, right? And that's &mdash; you </span><span class="line" data-startTime="1109">can sort of understand that, when we're moving </span><span class="line" data-startTime="1109">something up and down. But people like, you </span><span class="line" data-startTime="1112">know, drawers and &mdash; and hover effects and, </span><span class="line" data-startTime="1112">you know, slides that &mdash; that zoom in from </span><span class="line" data-startTime="1117">the left, right? </span><span class="line" data-startTime="1117">And this is a really cool thing. There are </span><span class="line" data-startTime="1120">some amazing things you can do here. But the </span><span class="line" data-startTime="1120">way to make it fast versus the way that you </span><span class="line" data-startTime="1124">encode it up quick are often not well aligned, </span><span class="line" data-startTime="1124">so it's very important when you do sort of </span><span class="line" data-startTime="1129">animations to also think about layers and </span><span class="line" data-startTime="1129">also think about how can I construct this </span><span class="line" data-startTime="1132">animation so it plays well with Chrome's layered </span><span class="line" data-startTime="1132">rendering model, not fights against it. </span></p>

<p class="speaker"><span class="line" data-starttime="1138"><span class="speakerName">Tom Tom Wiltzius</span>: Right. And a lot of that comes </span><span class="line" data-startTime="1138">down to how can I run this animation without </span><span class="line" data-startTime="1141">incurring any paints. So here's a really simple </span><span class="line" data-startTime="1141">drawer. This is styled like incredibly plainly, </span><span class="line" data-startTime="1147">but you can see that if I open up DevTools </span><span class="line" data-startTime="1147">and I have show paint reqs on, that as I run </span><span class="line" data-startTime="1154">this animation, which is a simple CSS animation </span><span class="line" data-startTime="1154">on the left property &mdash; right? &mdash; like very </span><span class="line" data-startTime="1159">basic, I get repaints of the drawer throughout </span><span class="line" data-startTime="1159">the entire animation. That means every frame, </span><span class="line" data-startTime="1166">this entire part of the screen is being repainted, </span><span class="line" data-startTime="1166">re-uploaded to the GPU, and re-composited. </span><span class="line" data-startTime="1170">And that's, again, relatively painful. </span></p>

<p class="speaker"><span class="line" data-starttime="1170"><span class="speakerName">Nat Duca</span>: And if you take that to a low-end </span><span class="line" data-startTime="1174">device, it will be worse and worse and worse. </span><span class="line" data-startTime="1174">Six times worse, often. </span></p>

<p class="speaker"><span class="line" data-starttime="1177"><span class="speakerName">Tom Tom Wiltzius</span>: Right. So the question you </span><span class="line" data-startTime="1177">want to be asking yourself is, "okay, like </span><span class="line" data-startTime="1179">how do I get around this? Like how do I avoid </span><span class="line" data-startTime="1179">these red rectangles?" And it so happens that </span><span class="line" data-startTime="1186">one good way to do so for moving things like </span><span class="line" data-startTime="1186">this is with transforms, through CSS 3 transforms, </span><span class="line" data-startTime="1193">rather than changing the position property. </span><span class="line" data-startTime="1193">Transforms take elements out of the flow of </span><span class="line" data-startTime="1198">the page, which gives the browser some stronger </span><span class="line" data-startTime="1198">guarantees about what it can move without </span><span class="line" data-startTime="1203">risking having to reflow other elements. </span></p>

<p class="speaker"><span class="line" data-starttime="1203"><span class="speakerName">Nat Duca</span>: This is an example of not all </span><span class="line" data-startTime="1207">&mdash; you can make the same look in CSS with </span><span class="line" data-startTime="1207">different types of selectors or different </span><span class="line" data-startTime="1213">types of attributes and get the same visual </span><span class="line" data-startTime="1213">look. But it is going to perform totally differently. </span></p>

<p class="speaker"><span class="line" data-starttime="1219"><span class="speakerName">Tom Tom Wiltzius</span>: Chrome has all these fast </span><span class="line" data-startTime="1219">pass. But you kind of need to find them, which </span><span class="line" data-startTime="1222">can be painful. If I use a Webkit transform </span><span class="line" data-startTime="1222">here and a translate X, I have this comparatively </span><span class="line" data-startTime="1230">much nicer animation, right? You can see it </span><span class="line" data-startTime="1230">is a little bit smoother if your eyes are </span><span class="line" data-startTime="1234">attuned to it. But the really nice thing is </span><span class="line" data-startTime="1234">I'm not getting any paints, there is no red </span><span class="line" data-startTime="1239">rectangles throughout the animation. There </span><span class="line" data-startTime="1239">are red rectangles at the beginning and end, </span><span class="line" data-startTime="1243">though. And we will talk about those next. </span></p>

<p class="speaker"><span class="line" data-starttime="1243"><span class="speakerName">Nat Duca</span>: If you get somebody who stamps </span><span class="line" data-startTime="1248">out that first bit of animation and Tom comes </span><span class="line" data-startTime="1248">over to me and says, I got it! I got it! We </span><span class="line" data-startTime="1252">just have red flashes getting in. It is not </span><span class="line" data-startTime="1252">good enough. Never, ever paint. That's what </span><span class="line" data-startTime="1256">we are looking for. Not, oh, I reduced it </span><span class="line" data-startTime="1256">a bit. It's, Don't paint. </span></p>

<p class="speaker"><span class="line" data-starttime="1261"><span class="speakerName">Tom Tom Wiltzius</span>: We are standing up here stating </span><span class="line" data-startTime="1261">that this thing is now fast because it is </span><span class="line" data-startTime="1267">in layer. You shouldn't take our word for </span><span class="line" data-startTime="1267">it. You should want to look for this yourself. </span><span class="line" data-startTime="1271">The way to do that is to open up DevTools </span><span class="line" data-startTime="1271">again, turn on show composited layer borders </span><span class="line" data-startTime="1275">in DevTools settings. And if you look really </span><span class="line" data-startTime="1275">carefully &mdash; I will zoom in here &mdash; there </span><span class="line" data-startTime="1282">is an orange border that goes around the edge </span><span class="line" data-startTime="1282">of the page and that orange border is your </span><span class="line" data-startTime="1287">cue that says, The content inside of this </span><span class="line" data-startTime="1287">border is in its own layer. </span><span class="line" data-startTime="1293">You can see there is only one orange border. </span><span class="line" data-startTime="1293">It is probably hard to see from the audience </span><span class="line" data-startTime="1296">on this screen. </span></p>

<p class="speaker"><span class="line" data-starttime="1296"><span class="speakerName">Nat Duca</span>: Trust us. </span></p>

<p class="speaker"><span class="line" data-starttime="1297"><span class="speakerName">Tom Tom Wiltzius</span>: There is only one orange border </span><span class="line" data-startTime="1297">on this particular page because there is only </span><span class="line" data-startTime="1301">one layer. Again, look really carefully. I </span><span class="line" data-startTime="1301">will zoom in again. Look really carefully </span><span class="line" data-startTime="1307">at the edge of the drawer as this animation </span><span class="line" data-startTime="1307">runs. You can see that there is another orange </span><span class="line" data-startTime="1311">border that pops up along the edge of the </span><span class="line" data-startTime="1311">drawer during the animation. And that's your </span><span class="line" data-startTime="1316">sign that says, Oh, this content actually </span><span class="line" data-startTime="1316">got promoted to its own layer and now it is </span><span class="line" data-startTime="1322">being moved back and forth, which is great. </span> <span class="line" data-startTime="1322">But the question is: Why the red rectangles </span><span class="line" data-startTime="1328">at the beginning and end? </span><span class="line" data-startTime="1328">And if you look carefully, maybe you can guess </span><span class="line" data-startTime="1331">why. There isn't an orange border before or </span><span class="line" data-startTime="1331">after this animation runs, right? So what's </span><span class="line" data-startTime="1337">happening is that the layer that the drawer </span><span class="line" data-startTime="1337">is in during the animation doesn't exist before </span><span class="line" data-startTime="1342">or after the animation, right? </span><span class="line" data-startTime="1342">So the animation starts. We pop the drawer </span><span class="line" data-startTime="1347">out. Put it in its own layer. It is a new </span><span class="line" data-startTime="1347">layer so we need to render its contents, right? </span><span class="line" data-startTime="1352">That's the first red flash. </span> <span class="line" data-startTime="1352">Then we recomposite it, recomposite it, recomposite </span><span class="line" data-startTime="1355">it, move it all the over and pop it back into </span><span class="line" data-startTime="1355">the base layer. And when we pop it into the </span><span class="line" data-startTime="1360">base layer, we need to repaint that part of </span><span class="line" data-startTime="1360">it. That's the second red flash. </span></p>

<p><span class="line" data-startTime="1366">How do we avoid this? One way is sort of incidental. </span> <span class="line" data-startTime="1366">If you use a translate 3D instead of a translate </span><span class="line" data-startTime="1372">X, you get a layer even when the thing isn't </span><span class="line" data-startTime="1372">moving because it will be promoted to a layer </span><span class="line" data-startTime="1376">not due to the animation but due to the CSS </span><span class="line" data-startTime="1376">transform itself. </span> <span class="line" data-startTime="1381">If we try that and run this animation, you </span><span class="line" data-startTime="1381">can see that I can now run it back and forth, </span><span class="line" data-startTime="1389">no red rectangles. </span></p>

<p class="speaker"><span class="line" data-starttime="1389"><span class="speakerName">Nat Duca</span>: Look, Ma, no red flash, right? </span></p>

<p class="speaker"><span class="line" data-starttime="1392"><span class="speakerName">Tom Tom Wiltzius</span>: That's great. That's kind </span><span class="line" data-startTime="1392">of what we want. And if I open up the timeline </span><span class="line" data-startTime="1396">view, we talked about vertical timeline earlier, </span><span class="line" data-startTime="1396">usually you would see all sorts of paint events </span><span class="line" data-startTime="1400">and stuff, right? But if I start a recording </span><span class="line" data-startTime="1400">and run this animation, you can see that throughout </span><span class="line" data-startTime="1407">the animation, all we get are these composite </span><span class="line" data-startTime="1407">layer operations over and over and over again, </span><span class="line" data-startTime="1411">which are comparatively super, super cheap. </span> <span class="line" data-startTime="1411">That's really good. This is the ideal timeline </span><span class="line" data-startTime="1416">case where, yes, things are moving but there </span><span class="line" data-startTime="1416">is a minimum of other stuff going on. So that's </span><span class="line" data-startTime="1423">drawers. </span> <span class="line" data-startTime="1423">But sometimes this isn't quite enough. Sometimes </span><span class="line" data-startTime="1427">just seeing those borders isn't enough to </span><span class="line" data-startTime="1427">tell you really what's going on, especially </span><span class="line" data-startTime="1432">if you have really complicated animations, </span><span class="line" data-startTime="1432">et cetera. These are contrived examples. It </span><span class="line" data-startTime="1436">is easy for us to come up with a demo. You </span><span class="line" data-startTime="1436">are trying to debug a site or an app on a </span><span class="line" data-startTime="1442">phone in production, there can be lots of </span><span class="line" data-startTime="1442">stuff going on. There can be all sorts of </span><span class="line" data-startTime="1446">layers all over the place. And you can be </span><span class="line" data-startTime="1446">trying to add more but that's only causing </span><span class="line" data-startTime="1451">you to have too many. Maybe you are running </span><span class="line" data-startTime="1451">out of memory. All sorts of things can go </span><span class="line" data-startTime="1454">wrong, right? </span><span class="line" data-startTime="1454">So Nat's going to talk a little bit about </span><span class="line" data-startTime="1456">what to do in those more advanced scenarios. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="1456"><span class="speakerName">Nat Duca</span>: What we are going to do now is </span><span class="line" data-startTime="1459">we're going to take the covers off of an internal </span><span class="line" data-startTime="1459">tool we have been developing in Chrome to </span><span class="line" data-startTime="1463">show the nasty innard guts of the compositing </span><span class="line" data-startTime="1463">system, which is this thing that makes things </span><span class="line" data-startTime="1468">Jankfree. </span> <span class="line" data-startTime="1468">As you see this, keep in mind basically this </span><span class="line" data-startTime="1473">is very, very brand-new. And it is designed </span><span class="line" data-startTime="1473">for developers first, but we wanted to show </span><span class="line" data-startTime="1477">it because this shows you exactly why things </span><span class="line" data-startTime="1477">really are slow. The way it works is you get </span><span class="line" data-startTime="1483">a relatively current build of Chrome and that </span><span class="line" data-startTime="1483">will probably be like Friday's build, not </span><span class="line" data-startTime="1488">today's. So that's how new it is. And you </span><span class="line" data-startTime="1488">pop over to your site that you think is Janky. </span> <span class="line" data-startTime="1494">So I'm just going to start with something </span><span class="line" data-startTime="1494">really simple. This is just a tall site with </span><span class="line" data-startTime="1498">some As in it, right? Really bringing out </span><span class="line" data-startTime="1498">the good content for you guys. </span> <span class="line" data-startTime="1505">[ Laughter ] </span><span class="line" data-startTime="1505">Remember, we showed you the picture of Gmail, </span><span class="line" data-startTime="1509">right, with it broken out in layers. You go </span><span class="line" data-startTime="1509">over to tracing, this Chrome tracing thing, </span><span class="line" data-startTime="1514">and you start it recording. </span> <span class="line" data-startTime="1514">You go back over to here and you do your thing, </span><span class="line" data-startTime="1518">whatever that thing happens to be. Just like </span><span class="line" data-startTime="1518">in Timeline. </span></p>

<p><span class="line" data-startTime="1520">What you are going to be presented with, once </span><span class="line" data-startTime="1520">it does its thinking is something that should </span><span class="line" data-startTime="1524">actually remind some of you of Android systrace </span><span class="line" data-startTime="1524">in sort of appearance. </span> <span class="line" data-startTime="1528">What you are seeing here is these all the </span><span class="line" data-startTime="1528">different times my finger was moving on the </span><span class="line" data-startTime="1531">track pad causing it to scroll. And the nice </span><span class="line" data-startTime="1531">regularity of that that should scream out </span><span class="line" data-startTime="1535">Jankfreeness right away. </span> <span class="line" data-startTime="1535">Each one of these green dots are the things </span><span class="line" data-startTime="1539">you really want to click on. Everything else </span><span class="line" data-startTime="1539">is sort of side show. </span> <span class="line" data-startTime="1542">The green dot represents Chrome drawing one </span><span class="line" data-startTime="1542">frame up onto the screen. That's kind of where </span><span class="line" data-startTime="1547">the meat is. </span> <span class="line" data-startTime="1547">Down here you have got &mdash; in the center here, </span><span class="line" data-startTime="1551">you have got a list of the layers on the screen </span><span class="line" data-startTime="1551">on that frame. There's two. There is this </span><span class="line" data-startTime="1556">one which is shown over here. You can see </span><span class="line" data-startTime="1556">that's the really tall page. You can see that's </span><span class="line" data-startTime="1560">the whole darn page. </span></p>

<p><span class="line" data-startTime="1560">Then you have got this thing which is tall </span><span class="line" data-startTime="1563">and narrow. What is that? That's the scroll </span><span class="line" data-startTime="1563">bar. It is that little thing. Even on Mac, </span><span class="line" data-startTime="1567">we have it, even though it is transparent. </span> <span class="line" data-startTime="1567">That's sort of the shape of the page. </span> <span class="line" data-startTime="1571">The thing you want to then look at as I go </span><span class="line" data-startTime="1571">from frame to frame, see this thing over here, </span><span class="line" data-startTime="1576">this is our mini map. As you go from frame </span><span class="line" data-startTime="1576">to frame, you see the green thing which is </span><span class="line" data-startTime="1580">the layer moving and that's the scroll happening. </span> <span class="line" data-startTime="1580">The blue represents the viewport. So just </span><span class="line" data-startTime="1586">like in the Gmail example where we showed </span><span class="line" data-startTime="1586">the Gmail thing &mdash; the mail list moving and </span><span class="line" data-startTime="1592">sort of this hole where the viewport was looking, </span><span class="line" data-startTime="1592">this is the same thing but from my live site. </span> <span class="line" data-startTime="1597">This is kind of &mdash; you can sort of start thinking, </span><span class="line" data-startTime="1597">this is kind of useful. </span> <span class="line" data-startTime="1600">Hey, that's a big picture. I wonder how much </span><span class="line" data-startTime="1600">memory it is using. We have a lot of people </span><span class="line" data-startTime="1605">who worry about that, where they say, These </span><span class="line" data-startTime="1605">layer things are great but they are eating </span><span class="line" data-startTime="1608">a lot of memory. </span></p>

<p><span class="line" data-startTime="1608">You can actually click now on this and see </span><span class="line" data-startTime="1611">the actual bytes consumed by that layer. It </span><span class="line" data-startTime="1611">is like 7 megs, something like that. </span> <span class="line" data-startTime="1619">And I'm beeping. That was fun. </span> <span class="line" data-startTime="1619">[ Laughter ] </span><span class="line" data-startTime="1623">So that's the most fun part of the talk. </span> <span class="line" data-startTime="1623">You can actually get the actual memory consumption </span><span class="line" data-startTime="1627">from this tool, which is super useful when </span><span class="line" data-startTime="1627">you are trying to take your site which is </span><span class="line" data-startTime="1631">layer heavy, for instance, and bring it to </span><span class="line" data-startTime="1631">a phone, which is constrained. Remember, we </span><span class="line" data-startTime="1636">had this demo up, right? This drawer. And </span><span class="line" data-startTime="1636">Tom was saying, trust me, there is a layer </span><span class="line" data-startTime="1642">there. Don't trust, measure. </span> <span class="line" data-startTime="1642">So we are going to reload. I'm going to set </span><span class="line" data-startTime="1646">it to do the thing where it was popping in </span><span class="line" data-startTime="1646">and out and we are going to do the effect. </span> <span class="line" data-startTime="1650">Same old thing. And we wait for it to do a </span><span class="line" data-startTime="1650">bit of a think. You can see again there is </span><span class="line" data-startTime="1656">two big bursts of animation which is when </span><span class="line" data-startTime="1656">the rendering system was active. </span> <span class="line" data-startTime="1660">I click here. Let's pick that frame. You can </span><span class="line" data-startTime="1660">sort of see this, right? </span><span class="line" data-startTime="1663">There's my page as before, right? There is </span><span class="line" data-startTime="1663">the drawer on the left. </span></p>

<p><span class="line" data-startTime="1668">And then there is this big stall here. It </span><span class="line" data-startTime="1668">is Jank. When I click here, you see that it </span><span class="line" data-startTime="1673">is gone. There is a hole. where did it go, </span><span class="line" data-startTime="1673">right? Now you see there are two layers instead </span><span class="line" data-startTime="1679">of one. </span> <span class="line" data-startTime="1679">This is the root layer, and that's this newly </span><span class="line" data-startTime="1682">created one. And that got painted. We paid </span><span class="line" data-startTime="1682">to paint that and pop it out. </span> <span class="line" data-startTime="1686">And we also paid to paint the other layer </span><span class="line" data-startTime="1686">to create the hole. </span> <span class="line" data-startTime="1690">Now you see on the left in the mini map that </span><span class="line" data-startTime="1690">drawer starting to slide in under the viewport. </span> <span class="line" data-startTime="1695">So now it is sliding in, sliding in and it </span><span class="line" data-startTime="1695">is good and we are happy and it is 60 hertz </span><span class="line" data-startTime="1698">and it looks smooth. </span> <span class="line" data-startTime="1698">Toward the end, what you are going to see </span><span class="line" data-startTime="1702">is it smoosh down. So here &mdash; from here to </span><span class="line" data-startTime="1702">here, you see that we have two layers like </span><span class="line" data-startTime="1707">this still. And then in the next frame, it </span><span class="line" data-startTime="1707">is smooshed down to one. </span> <span class="line" data-startTime="1712">Ah, right? So then we paid yet again to paint </span><span class="line" data-startTime="1712">it. We didn't pay so much of a painting penalty </span><span class="line" data-startTime="1717">this time, but maybe on a lower-end device, </span><span class="line" data-startTime="1717">we would have. If you scroll down, you can </span><span class="line" data-startTime="1721">see the painting activity taking place. </span> <span class="line" data-startTime="1721">One other final thing to show about this tool. </span></p>

<p><span class="line" data-startTime="1726">A lot of people wonder when you get a big </span><span class="line" data-startTime="1726">&mdash; big site, big production site where there's </span><span class="line" data-startTime="1730">a zillion things going on, you get a ton of </span><span class="line" data-startTime="1730">layers. And you are like: I didn't ask for </span><span class="line" data-startTime="1734">this. Why is this layer promoted? </span><span class="line" data-startTime="1734">So if you actually look down at the bottom </span><span class="line" data-startTime="1738">of this thing, you can see this compositing </span><span class="line" data-startTime="1738">reason. This so no promotion reason given. </span> <span class="line" data-startTime="1745">But if I click on this one that's moving, </span><span class="line" data-startTime="1745">it is using accelerated animation. That's </span><span class="line" data-startTime="1751">your key to then start understanding, Hey, </span><span class="line" data-startTime="1751">maybe I should keep this promoted for some </span><span class="line" data-startTime="1755">other reason, too, so it stays promoted afterward. </span> <span class="line" data-startTime="1755">And so when we turn this on and do a trace </span><span class="line" data-startTime="1760">of this with the real &mdash; that final demo that </span><span class="line" data-startTime="1760">we say was Jankfree, you will see that, then, </span><span class="line" data-startTime="1765">has several promotion reasons that keep it </span><span class="line" data-startTime="1765">promoted the whole time. </span> <span class="line" data-startTime="1769">So this is sort of the low &mdash; the quick glimpse </span><span class="line" data-startTime="1769">into a tool that we are trying to get out </span><span class="line" data-startTime="1773">there into people's hands so when you are </span><span class="line" data-startTime="1773">really under deadline and you need to make </span><span class="line" data-startTime="1776">something Jankfree that's in your available </span><span class="line" data-startTime="1776">in your arsenal to help with. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="1780"><span class="speakerName">Tom Tom Wiltzius</span>: It is as Nat said super, super </span><span class="line" data-startTime="1780">new. We have some nascent docs up at this </span><span class="line" data-startTime="1788">link. And we do encourage you guys to maybe </span><span class="line" data-startTime="1788">in the next couple weeks go try it out as </span><span class="line" data-startTime="1793">it lands and starts to stabilize. </span><span class="line" data-startTime="1793">But for sort of advanced use cases, this is </span><span class="line" data-startTime="1798"> &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="1798"><span class="speakerName">Nat Duca</span>: You can get very far with DevTools. </span><span class="line" data-startTime="1800">This is if &mdash; if you are in a pinch, you can </span><span class="line" data-startTime="1800">check this out. You will be confused, but </span><span class="line" data-startTime="1804">it will help. </span></p>

<p class="speaker"><span class="line" data-starttime="1804"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. But for starters, </span><span class="line" data-startTime="1807">as you sort of begin down your journey towards </span><span class="line" data-startTime="1807">fighting Jank, you want to use DevTools. You </span><span class="line" data-startTime="1813">want to turn on Share Paint Rectangles every </span><span class="line" data-startTime="1813">time you see Jank sort of crop up in the wild. </span><span class="line" data-startTime="1818">And you want to look for what is repainting </span><span class="line" data-startTime="1818">and try to figure out why. </span><span class="line" data-startTime="1821">You want to ask yourself why &mdash; why am I repainting </span><span class="line" data-startTime="1821">this? And can I either avoid it by being judicious </span><span class="line" data-startTime="1828">and not changing style when I don't have to </span><span class="line" data-startTime="1828">or by using layers or some combination of </span><span class="line" data-startTime="1833">the above. </span><span class="line" data-startTime="1833">And if you can't avoid it, you want to make </span><span class="line" data-startTime="1835">it as fast as possible by using continuous </span><span class="line" data-startTime="1835">painting mode that we talked about earlier. </span></p>

<p class="speaker"><span class="line" data-starttime="1840"><span class="speakerName">Nat Duca</span>: There are a lot of great tools. </span><span class="line" data-startTime="1840">The thing to keep in mind, if you walk away </span><span class="line" data-startTime="1844">with nothing else in your take-aways is this, </span><span class="line" data-startTime="1844">all the browsers are basically building something </span><span class="line" data-startTime="1849">around layers. </span><span class="line" data-startTime="1849">Think about doing your effects, your awesome </span><span class="line" data-startTime="1854">immersive Web experiences in terms of layers. </span><span class="line" data-startTime="1854">Think about whether you're designing for that, </span><span class="line" data-startTime="1859">try to reduce paint. </span><span class="line" data-startTime="1859">And if you do, the browsers will pay you back </span><span class="line" data-startTime="1863">in scores with Jankfreeness, smoothness, right? </span><span class="line" data-startTime="1863">And if you don't, then you are going to be </span><span class="line" data-startTime="1867">fighting the browser. It is going to be doing </span><span class="line" data-startTime="1867">its best, but you are asking it to do a hard </span><span class="line" data-startTime="1871">thing. So happy Jank busting. </span><span class="line" data-startTime="1871">[ Laughter ] </span></p>

<p class="speaker"><span class="line" data-starttime="1874"><span class="speakerName">Tom Tom Wiltzius</span>: I think we're going to take </span><span class="line" data-startTime="1874">a few questions because we have some time </span><span class="line" data-startTime="1877">left. But if you are hungry for more, we've </span><span class="line" data-startTime="1877">got sort of a collection of links and articles </span><span class="line" data-startTime="1884">and whatnot up at jankfree.org. It is just </span><span class="line" data-startTime="1884">sort of a dumping ground for us. And that's </span><span class="line" data-startTime="1888">where we are going to put these slides as </span><span class="line" data-startTime="1888">well. </span> <span class="line" data-startTime="1890">If you take away one URL from this talk, it </span><span class="line" data-startTime="1890">should be that. And you can get to everything </span><span class="line" data-startTime="1893">else from there. Html5rocks is the Chrome </span><span class="line" data-startTime="1893">developer relations Website about this kind </span><span class="line" data-startTime="1897">of topic. So you should definitely go check </span><span class="line" data-startTime="1897">that out. </span> <span class="line" data-startTime="1900">We will continue putting up content about </span><span class="line" data-startTime="1900">this topic. Go check that out. </span> <span class="line" data-startTime="1905">Our contact info is up here, too. We are happy </span><span class="line" data-startTime="1905">to talk about things like this if you have </span><span class="line" data-startTime="1908">interesting cases that you want to sort of </span><span class="line" data-startTime="1908">bring to us. We also welcome bugs on the Chrome </span><span class="line" data-startTime="1914">bug tracker. </span> <span class="line" data-startTime="1914">With that, I think we will take some questions. </span></p>

<p><span class="line" data-startTime="1919">Thank you very much. </span> <span class="line" data-startTime="1919">[ Applause ] </span></p>

<p class="speaker"><span class="line" data-starttime="1926"><span class="speakerName">Audience member</span>: Hi. So it seems like layers are really </span><span class="line" data-startTime="1926">important. But right now, it seems like you </span><span class="line" data-startTime="1932">kind of have to do a snake dance to figure </span><span class="line" data-startTime="1932">out or make something into a layer. </span></p>

<p class="speaker"><span class="line" data-starttime="1936"><span class="speakerName">Nat Duca</span>: I like that expression. </span></p>

<p class="speaker"><span class="line" data-starttime="1936"><span class="speakerName">Audience member</span>: Does it make sense for there to be an </span><span class="line" data-startTime="1941">explicit style declaration to say, Hey, I </span><span class="line" data-startTime="1941">know how I want to composite my page? </span></p>

<p class="speaker"><span class="line" data-starttime="1946"><span class="speakerName">Tom Tom Wiltzius</span>: Right. </span></p>

<p class="speaker"><span class="line" data-starttime="1946"><span class="speakerName">Audience member</span>: Let me turn this into a layer, just like </span><span class="line" data-startTime="1949">Webkit layer, whatever, make this into a layer, </span><span class="line" data-startTime="1949">yeah, almost like Z index. Is that coming? </span></p>

<p class="speaker"><span class="line" data-starttime="1955"><span class="speakerName">Tom Tom Wiltzius</span>: Right. I mean, it is a good </span><span class="line" data-startTime="1955">question. It actually comes up a fair amount. </span><span class="line" data-startTime="1959">It is something we've resisted because, like, </span><span class="line" data-startTime="1959">in general, there is resistance to adding </span><span class="line" data-startTime="1963">APIs to this. </span></p>

<p class="speaker"><span class="line" data-starttime="1963"><span class="speakerName">Nat Duca</span>: One of the great things about </span><span class="line" data-startTime="1966">the Web is that your content can run pretty </span><span class="line" data-startTime="1966">much anywhere. And, remember I showed you </span><span class="line" data-startTime="1971">in the demo that these layers take memory? </span><span class="line" data-startTime="1971">If you start telling Chrome to use a layer </span><span class="line" data-startTime="1979">for that, then you run into the situation </span><span class="line" data-startTime="1979">of it might fit on your high-end computer, </span><span class="line" data-startTime="1983">say, a Pixel, but then it won't fit on an </span><span class="line" data-startTime="1983">Android device. </span><span class="line" data-startTime="1985">And at which point, what are we to do? If </span><span class="line" data-startTime="1985">you start making assumptions about this definitely </span><span class="line" data-startTime="1990">being in a layer and we can't fit it in memory, </span><span class="line" data-startTime="1990">what are we going to do? </span><span class="line" data-startTime="1993">I totally get where you are coming from. This </span><span class="line" data-startTime="1993">is something that we as a community, the Web </span><span class="line" data-startTime="1997">community, need to really tackle in the next </span><span class="line" data-startTime="1997">couple of years, of how to improve the statement </span><span class="line" data-startTime="2001">of intent. </span><span class="line" data-startTime="2001">But we also have to think about as we do that, </span><span class="line" data-startTime="2004">how to make it work and preserve sort of that </span><span class="line" data-startTime="2004">promise of the Web where it just sort of works </span><span class="line" data-startTime="2007">everywhere. Does that &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2007"><span class="speakerName">Tom Tom Wiltzius</span>: I think the intent &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2010"><span class="speakerName">Nat Duca</span>: Is that responsive? </span></p>

<p class="speaker"><span class="line" data-starttime="2010"><span class="speakerName">Tom Tom Wiltzius</span>: The intent point is a good </span><span class="line" data-startTime="2011">one, right, because, like, in some ways, the </span><span class="line" data-startTime="2011">layer concept, like, it is kind of an implementation </span><span class="line" data-startTime="2016">detail. And that's not the kind of thing we </span><span class="line" data-startTime="2016">like to codify with syntax, right? </span><span class="line" data-startTime="2020">Instead what we want to codify is stuff about </span><span class="line" data-startTime="2020">intent, right? So things that, for instance, </span><span class="line" data-startTime="2026">the Chrome Compositor is good at right now </span><span class="line" data-startTime="2026">is moving stuff around, changing opacity and </span><span class="line" data-startTime="2032">sort of doing this 60 times a second. And </span><span class="line" data-startTime="2032">there actually are semantic ways of declaring </span><span class="line" data-startTime="2037">all of these things. If you declare them, </span><span class="line" data-startTime="2037">Chrome will do the right thing. Those things </span><span class="line" data-startTime="2041">get layers and those things get hardware accelerated. </span><span class="line" data-startTime="2041">I think that's probably more the direction </span><span class="line" data-startTime="2046">we want to go. Otherwise, you will try to </span><span class="line" data-startTime="2046">end up in some senses abuse it, right? You </span><span class="line" data-startTime="2052">will try to trick the compositor into doing </span><span class="line" data-startTime="2052">things that it is not really designed ed for. </span><span class="line" data-startTime="2055">I wonder &mdash; I don't know. I wonder if we will </span><span class="line" data-startTime="2055">end up in a worse place &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2058"><span class="speakerName">Nat Duca</span>: TLDR hard problem. And if you </span><span class="line" data-startTime="2058">have any brilliant observations, come grab </span><span class="line" data-startTime="2063">us. </span></p>

<p class="speaker"><span class="line" data-starttime="2063"><span class="speakerName">Tom Tom Wiltzius</span>: We will be in the Chrome performance </span><span class="line" data-startTime="2065">area later, too, if anyone wants to talk. </span><span class="line" data-startTime="2065">In the front. </span></p>

<p class="speaker"><span class="line" data-starttime="2069"><span class="speakerName">Audience member</span>: I was just wondering if this tool is available </span><span class="line" data-startTime="2069">on Chrome for Android? </span></p>

<p class="speaker"><span class="line" data-starttime="2073"><span class="speakerName">Tom Tom Wiltzius</span>: Sorry, can you repeat the </span><span class="line" data-startTime="2073">question? </span></p>

<p class="speaker"><span class="line" data-starttime="2076"><span class="speakerName">Audience member</span>: Is this tool available on Chrome for Android? </span></p>

<p class="speaker"><span class="line" data-starttime="2076"><span class="speakerName">Nat Duca</span>: The last one will work on Chrome </span><span class="line" data-startTime="2082">eventually. </span></p>

<p class="speaker"><span class="line" data-starttime="2082"><span class="speakerName">Tom Tom Wiltzius</span>: All the DevTools stuff, yes. </span><span class="line" data-startTime="2084">The last sort of advanced tracing tool doesn't </span><span class="line" data-startTime="2084">work yet. </span></p>

<p class="speaker"><span class="line" data-starttime="2090"><span class="speakerName">Nat Duca</span>: It will come. </span></p>

<p class="speaker"><span class="line" data-starttime="2090"><span class="speakerName">Tom Tom Wiltzius</span>: It should. </span></p>

<p class="speaker"><span class="line" data-starttime="2091"><span class="speakerName">Nat Duca</span>: It is all sort of common infrastructure. </span></p>

<p class="speaker"><span class="line" data-starttime="2091"><span class="speakerName">Tom Tom Wiltzius</span>: The basic tracing does work </span><span class="line" data-startTime="2094">on Android. The more advanced features to </span><span class="line" data-startTime="2094">view frames doesn't work. </span></p>

<p class="speaker"><span class="line" data-starttime="2099"><span class="speakerName">Nat Duca</span>: Haven't tried it. It might work. </span><span class="line" data-startTime="2099">We'll see. But it is all one big happy family. </span><span class="line" data-startTime="2104">We all think about all platforms. </span></p>

<p class="speaker"><span class="line" data-starttime="2104"><span class="speakerName">Tom Tom Wiltzius</span>: We work across. </span></p>

<p class="speaker"><span class="line" data-starttime="2106"><span class="speakerName">Nat Duca</span>: If it is not working today, it </span><span class="line" data-startTime="2106">will be working very soon because we want </span><span class="line" data-startTime="2110">&mdash; our whole vision here is you write your </span><span class="line" data-startTime="2110">Web platform thing and we will take care of </span><span class="line" data-startTime="2115">all your OSes for you, module a few details. </span></p>

<p class="speaker"><span class="line" data-starttime="2115"><span class="speakerName">Audience member</span>: So instead of asking for a layer, is there </span><span class="line" data-startTime="2122">a possibility of getting, like, an experimental </span><span class="line" data-startTime="2122">no-paint attribute, I'm sorry, suppress paint </span><span class="line" data-startTime="2128">while we move stuff around? Because sometimes </span><span class="line" data-startTime="2128">it is kind of like you have to hold the old-style </span><span class="line" data-startTime="2133">TV antenna up to get the right &mdash; it is like: </span><span class="line" data-startTime="2133">Did I do the right thing to kick the compositor </span><span class="line" data-startTime="2139">just the right way? </span><span class="line" data-startTime="2139">If we had attributes that, seriously, we actually </span><span class="line" data-startTime="2143">know better than you, don't repaint this, </span><span class="line" data-startTime="2143">it might help some edge cases we have. </span></p>

<p class="speaker"><span class="line" data-starttime="2148"><span class="speakerName">Nat Duca</span>: There is a proposal floating around </span><span class="line" data-startTime="2148">for, I believe we are calling it, prepainting. </span><span class="line" data-startTime="2153">And if you look on one of chromium's graphics </span><span class="line" data-startTime="2153">development mailing lists, you will find a </span><span class="line" data-startTime="2158">discussion about it. And I think we intend </span><span class="line" data-startTime="2158">to broaden that discussion in the coming months. </span><span class="line" data-startTime="2163">But this is about being able to say, hey, </span><span class="line" data-startTime="2163">I'm bringing &mdash; So, think about infinite scroll. </span><span class="line" data-startTime="2168">You are adding elements to the bottom. Hey, </span><span class="line" data-startTime="2168">Chrome or, hey, browser, I'm adding this image </span><span class="line" data-startTime="2173">but, like, if you can't put that up in time, </span><span class="line" data-startTime="2173">no big. I'll put in a placeholder or something. </span><span class="line" data-startTime="2180">So, hey, this is optional. And please let </span><span class="line" data-startTime="2180">me know when it really is there so I can get </span><span class="line" data-startTime="2183">rid of my placeholder asset. </span><span class="line" data-startTime="2183">That's being discussed. I think it may be </span><span class="line" data-startTime="2187">abusable for the other things you are thinking </span><span class="line" data-startTime="2187">about, too. That actually feels relatively </span><span class="line" data-startTime="2191">within scope of the platform, I think. We'll </span><span class="line" data-startTime="2191">see. </span></p>

<p class="speaker"><span class="line" data-starttime="2196"><span class="speakerName">Tom Tom Wiltzius</span>: I think there is also room </span><span class="line" data-startTime="2196">to do that kind of thing higher up the stack </span><span class="line" data-startTime="2202">before we talk about painting. Like, really </span><span class="line" data-startTime="2202">what you want to do is declare &mdash; is sort </span><span class="line" data-startTime="2206">of make a promise to the browser that you're </span><span class="line" data-startTime="2206">not going to do anything that's going to manipulate </span><span class="line" data-startTime="2211">style or layout inside of &mdash; sort of a container </span><span class="line" data-startTime="2211">block. </span><span class="line" data-startTime="2215">If you can do that, then, like, further down </span><span class="line" data-startTime="2215">the stack where we are talking about, we can </span><span class="line" data-startTime="2220">do the right thing and not paint. </span><span class="line" data-startTime="2220">But there is some efforts going around things </span><span class="line" data-startTime="2224">like that, too. </span></p>

<p class="speaker"><span class="line" data-starttime="2224"><span class="speakerName">Nat Duca</span>: There is a lot of discussion here. </span><span class="line" data-startTime="2225">We're definitely &mdash; please, come on up and </span><span class="line" data-startTime="2225">we can chat if you want. There is a lot of </span><span class="line" data-startTime="2229">discussion in the team about how to basically </span><span class="line" data-startTime="2229">say to the platform, Hey, I solemnly swear </span><span class="line" data-startTime="2233">I'm up to good. Now get out of my way. We </span><span class="line" data-startTime="2233">know it is not good enough yet. </span></p>

<p class="speaker"><span class="line" data-starttime="2240"><span class="speakerName">Audience member</span>: Any love for SVG &mdash; Jankfree SVG any time </span><span class="line" data-startTime="2240">soon? </span></p>

<p class="speaker"><span class="line" data-starttime="2243"><span class="speakerName">Nat Duca</span>: Oh, totally. Definitely. One of </span><span class="line" data-startTime="2243">the people helping build that tool that we </span><span class="line" data-startTime="2247">demoed is one of our SVG awesome peoples. </span></p>

<p class="speaker"><span class="line" data-starttime="2247"><span class="speakerName">Tom Tom Wiltzius</span>: Definitely important. The </span><span class="line" data-startTime="2254">summary is yes. It is a little harder because </span><span class="line" data-startTime="2254">of the way SVG works. Gloss over that. </span><span class="line" data-startTime="2259">In front. </span></p>

<p class="speaker"><span class="line" data-starttime="2259"><span class="speakerName">Audience member</span>: Jankfree is awesome especially considering </span><span class="line" data-startTime="2261">how poor performance still is six years into </span><span class="line" data-startTime="2261">smartphones on smartphones. </span></p>

<p class="speaker"><span class="line" data-starttime="2265"><span class="speakerName">Tom Tom Wiltzius</span>: Totally. </span></p>

<p class="speaker"><span class="line" data-starttime="2265"><span class="speakerName">Audience member</span>: But I can't help but look at these demos </span><span class="line" data-startTime="2267">with "Oh, make this translate and then make </span><span class="line" data-startTime="2267">this a 3D translate" and think about people </span><span class="line" data-startTime="2272">who used underscores for their CSS variables </span><span class="line" data-startTime="2272">to make IE7 not look at that one and look </span><span class="line" data-startTime="2276">at a different one. </span><span class="line" data-startTime="2276">It feels like we are introducing another Web </span><span class="line" data-startTime="2280">development snake dance. And I wonder if there </span><span class="line" data-startTime="2280">is anything we can do to mitigate that to </span><span class="line" data-startTime="2284">make &mdash; to think about our codebases as something </span><span class="line" data-startTime="2284">that's going to live for longer than the six </span><span class="line" data-startTime="2289">months that I'm on this project and make it </span><span class="line" data-startTime="2289">easy for people to maintain down the line. </span></p>

<p class="speaker"><span class="line" data-starttime="2293"><span class="speakerName">Tom Tom Wiltzius</span>: Absolutely. That's kind of </span><span class="line" data-startTime="2293">the reason that we were saying what we were </span><span class="line" data-startTime="2298">in response to the first question about, like, </span><span class="line" data-startTime="2298">Oh, can we have a primitive for layer promotion? </span><span class="line" data-startTime="2304">And the reason that there is hesitancy to </span><span class="line" data-startTime="2304">do that kind of thing is because again so </span><span class="line" data-startTime="2310">directly targeting implementation details </span><span class="line" data-startTime="2310">of the browser, you end up in a world of pain </span><span class="line" data-startTime="2314">later where, oh, I don't care about IE7 so </span><span class="line" data-startTime="2314">much anymore but now my codebase is all kind </span><span class="line" data-startTime="2320">of split up because of that. </span><span class="line" data-startTime="2320">That's the kind of thing we don't want to </span><span class="line" data-startTime="2323">do. We want to stay as semantic as possible </span><span class="line" data-startTime="2323">so future versions of the browser don't need </span><span class="line" data-startTime="2328">to handle these kind of weird cases that were </span><span class="line" data-startTime="2328">targeted very much at implementation. </span></p>

<p class="speaker"><span class="line" data-starttime="2332"><span class="speakerName">Nat Duca</span>: But if there is one thing to keep </span><span class="line" data-startTime="2332">in the back of your head, it's this. Probably </span><span class="line" data-startTime="2336">for the next couple of years it is going to </span><span class="line" data-startTime="2336">be messy. So having your infrastructure on </span><span class="line" data-startTime="2340">your project be set up to deliver custom CSS </span><span class="line" data-startTime="2340">or in some way handle special casing for different </span><span class="line" data-startTime="2345">browsers is probably the unfortunate reality </span><span class="line" data-startTime="2345">of our platform at this time. </span><span class="line" data-startTime="2349">That really stinks and we all know we need </span><span class="line" data-startTime="2349">to do better. But you find quirks that you </span><span class="line" data-startTime="2353">need to apply for Safari different than, say, </span><span class="line" data-startTime="2353">Chrome, that are different from the old Android </span><span class="line" data-startTime="2359">Web view or something like that. </span><span class="line" data-startTime="2359">I would plan for the possibility of needing </span><span class="line" data-startTime="2364">to do that. </span><span class="line" data-startTime="2364">How are we doing? We got probably one more </span><span class="line" data-startTime="2369">question. </span></p>

<p class="speaker"><span class="line" data-starttime="2369"><span class="speakerName">Tom Tom Wiltzius</span>: One more minute. </span></p>

<p class="speaker"><span class="line" data-starttime="2370"><span class="speakerName">Nat Duca</span>: Especially as we are long winded. </span></p>

<p class="speaker"><span class="line" data-starttime="2370"><span class="speakerName">Audience member</span>: Hi. You talked about permanent vigilance. </span><span class="line" data-startTime="2376">Can you tell us how Google internally spots </span><span class="line" data-startTime="2376">these? Whether you have got automation tools </span><span class="line" data-startTime="2380">to assess when things have got worse so that </span><span class="line" data-startTime="2380">we cannot depend on developers being vigilant </span><span class="line" data-startTime="2386">because they will be distracted by other things </span><span class="line" data-startTime="2386">as well? </span></p>

<p class="speaker"><span class="line" data-starttime="2388"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah, sure, Nat built some </span><span class="line" data-startTime="2388">of them. So I will let him &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2390"><span class="speakerName">Nat Duca</span>: What we are starting to use, Go </span><span class="line" data-startTime="2390">Google Chrome telemetry. It is a framework </span><span class="line" data-startTime="2397">built in Python on top of DevTools protocol. </span><span class="line" data-startTime="2397">So DevTools has this fantastic JSON-level </span><span class="line" data-startTime="2403">&mdash; or Web socket and then JSON-level protocol </span><span class="line" data-startTime="2403">where you can talk to the Web page out of </span><span class="line" data-startTime="2409">process. And you can build developer tools </span><span class="line" data-startTime="2409">on top of it. You can also build fantastic </span><span class="line" data-startTime="2413">profiling tools and you can get out of Timeline </span><span class="line" data-startTime="2413">stream in that the painting info of what was </span><span class="line" data-startTime="2418">painting then you can build all sorts of cool </span><span class="line" data-startTime="2418">stuff on that, one of which is telemetry. </span></p>

<p class="speaker"><span class="line" data-starttime="2422"><span class="speakerName">Tom Tom Wiltzius</span>: That's the harness. And then </span><span class="line" data-startTime="2422">we have sort of collections of Web content </span><span class="line" data-startTime="2426">that are sort of interesting cases for whatever </span><span class="line" data-startTime="2426">reason that we're worried about improving </span><span class="line" data-startTime="2432">performance of or aggressing performance against. </span><span class="line" data-startTime="2432">We run sort of banks of content with this </span><span class="line" data-startTime="2438">harness, and we have performance waterfalls. </span></p>

<p class="speaker"><span class="line" data-starttime="2438"><span class="speakerName">Nat Duca</span>: Thank you. </span></p>

<p class="speaker"><span class="line" data-starttime="2442"><span class="speakerName">Tom Tom Wiltzius</span>: So hopefully that is compelling. </span></p>

<p class="speaker"><span class="line" data-starttime="2442"><span class="speakerName">Nat Duca</span>: Thanks, everybody, so much for </span><span class="line" data-startTime="2447">coming. </span></p>

<p class="speaker"><span class="line" data-starttime="2447"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. </span></p>

<p class="speaker"><span class="line" data-starttime="2448"><span class="speakerName">Nat Duca</span>: Good luck dejanking. </span><span class="line" data-startTime="2448">[ Applause ] </span></p>