<p class="speaker"><span class="line" data-starttime="0"><span class="speakerName">Ilya Grigorik</span>: Hi, everyone. My name is </span><span class="line" data-startTime="0">Ilya Grigork. I'm a developer advocate on </span><span class="line" data-startTime="4">the Make the Web Fast Team at Google. Today </span><span class="line" data-startTime="4">I want to talk to you about mobile performance </span><span class="line" data-startTime="9">from radio up, which is to say taking a lower </span><span class="line" data-startTime="9">level look at how the radio works and what </span><span class="line" data-startTime="14">we can learn about it to make our apps &mdash; mobile </span><span class="line" data-startTime="14">apps and Web pages with more performance. </span> <span class="line" data-startTime="19">These are some tricks and tips I have learned </span><span class="line" data-startTime="19">from working with different Google properties, </span><span class="line" data-startTime="24">helping them optimize their applications, </span><span class="line" data-startTime="24">and some general best practices. </span> <span class="line" data-startTime="27">So, first, I think we should start with the </span><span class="line" data-startTime="27">obvious which is &mdash; or maybe it is not so </span><span class="line" data-startTime="32">obvious to many of us &mdash; which is wireless </span><span class="line" data-startTime="32">is fundamentally different than wired. There </span><span class="line" data-startTime="36">are different constraints. The technology, </span><span class="line" data-startTime="36">the underlying technology, is, in fact, very </span><span class="line" data-startTime="41">different. </span> <span class="line" data-startTime="41">And, fortunately, or unfortunately, I'm not </span><span class="line" data-startTime="45">quite sure yet, our platform actually abstracts </span><span class="line" data-startTime="45">that, right? </span><span class="line" data-startTime="50">TCP and our browsers make it seem like it </span><span class="line" data-startTime="50">is all the same, whether you are accessing </span><span class="line" data-startTime="54">over a wireless network, whether it is WiFi </span><span class="line" data-startTime="54">or mobile network or wired network. It feels </span><span class="line" data-startTime="58">like all the same. </span></p>

<p><span class="line" data-startTime="58">But once you actually dig a little bit deeper, </span><span class="line" data-startTime="62">you will realize that there are different </span><span class="line" data-startTime="62">design constraints within &mdash; even within the </span><span class="line" data-startTime="65">different wireless standards. And that actually </span><span class="line" data-startTime="65">dictates how you need to design your applications </span><span class="line" data-startTime="71">to make them feel performant. </span> <span class="line" data-startTime="71">So, first of all, why do we care? It turns </span><span class="line" data-startTime="77">out that performance is a top criteria for </span><span class="line" data-startTime="77">all applications, mobile especially. And there's </span><span class="line" data-startTime="83">a number of great studies that have been done </span><span class="line" data-startTime="83">about performance on mobile. </span> <span class="line" data-startTime="87">And the first take-away is that users expect </span><span class="line" data-startTime="87">mobile sites to perform just as well, if not </span><span class="line" data-startTime="93">better, on mobile than they do on desktop. </span> <span class="line" data-startTime="93">We don't kind of have more relaxed expectations </span><span class="line" data-startTime="98">on mobile. If anything, it should be faster. </span> <span class="line" data-startTime="98">You're on the go. You are trying to check </span><span class="line" data-startTime="102">something quickly. You don't have much time. </span> <span class="line" data-startTime="102">You want it to perform well. </span> <span class="line" data-startTime="106">Now, out of all of these users that have asked </span><span class="line" data-startTime="106">these questions, more than half actually reported </span><span class="line" data-startTime="111">feeling frustrated about having a problem </span><span class="line" data-startTime="111">when accessing a site or an app over a mobile </span><span class="line" data-startTime="116">network. And most of those, the number one </span><span class="line" data-startTime="116">complaint has been the slow load time for </span><span class="line" data-startTime="122">their applications. </span></p>

<p><span class="line" data-startTime="122">So &mdash; and after that, almost half of them </span><span class="line" data-startTime="128">said, If I had a problem, I couldn't get the </span><span class="line" data-startTime="128">page to load fast enough. It didn't react </span><span class="line" data-startTime="132">fast enough. They wouldn't come back. So you </span><span class="line" data-startTime="132">have lost that user and they're not returning </span><span class="line" data-startTime="137">to your site, which is the worst possible </span><span class="line" data-startTime="137">outcome. </span> <span class="line" data-startTime="140">And, of course, this also translates to dollars </span><span class="line" data-startTime="140">and cents and even millions of dollars. So </span><span class="line" data-startTime="144">this is another great case study that I would </span><span class="line" data-startTime="144">like to share. This was done by Aberdeen Group. </span> <span class="line" data-startTime="149">They looked at a whole number, 100-plus e-commerce </span><span class="line" data-startTime="149">sites and they realized that adding one second </span><span class="line" data-startTime="156">of delay to their pages and to their applications </span><span class="line" data-startTime="156">dropped their conversions significantly. So </span><span class="line" data-startTime="161">this is your actual purchases. People viewed </span><span class="line" data-startTime="161">fewer pages. And, of course, customer satisfaction </span><span class="line" data-startTime="168">decreased as well. So this is just a thousand </span><span class="line" data-startTime="168">milliseconds of latency added to your application. </span> <span class="line" data-startTime="173">So it is not just dollars and cents. For many </span><span class="line" data-startTime="173">sites, large sites, it's literally millions </span><span class="line" data-startTime="178">of dollars. </span> <span class="line" data-startTime="178">So our agenda today is to actually look at </span><span class="line" data-startTime="182">radio performance 101. It is kind of a propeller-hat </span><span class="line" data-startTime="182">talk a little bit. And, specifically, we'll </span><span class="line" data-startTime="188">compare WiFi and mobile. And you will see </span><span class="line" data-startTime="188">why, because it is important to understand </span><span class="line" data-startTime="191">that even something like WiFi and mobile networks </span><span class="line" data-startTime="191">are fundamentally different in how we schedule </span><span class="line" data-startTime="196">how the communication is done and how we design </span><span class="line" data-startTime="196">our applications or what we can even do to </span><span class="line" data-startTime="202">optimize our applications. </span></p>

<p><span class="line" data-startTime="202">And we'll also look at some practical tips </span><span class="line" data-startTime="206">for what you can do in your applications to </span><span class="line" data-startTime="206">design for this. And then I'll leave the last </span><span class="line" data-startTime="210">part for you, which is to optimize the profit </span><span class="line" data-startTime="210">part. </span> <span class="line" data-startTime="214">So there are tons and tons of techniques for </span><span class="line" data-startTime="214">how to make your applications more performant. </span> <span class="line" data-startTime="219">There is application optimizations. There </span><span class="line" data-startTime="219">is PageSpeed-specific optimizations or Speed </span><span class="line" data-startTime="224">1-specific optimizations. We are not going </span><span class="line" data-startTime="224">to touch on those. We are going to mention </span><span class="line" data-startTime="228">them at the very end. We will are actually </span><span class="line" data-startTime="228">going to go a little bit deeper. </span> <span class="line" data-startTime="231">We are going to go below the application layer, </span><span class="line" data-startTime="231">even below the TCP layer, and kind of look </span><span class="line" data-startTime="236">at how does the radio actually work, right? </span><span class="line" data-startTime="236">So we will put the wired stuff aside, look </span><span class="line" data-startTime="241">at the radio and dive into WiFi and mobile. </span></p>

<p><span class="line" data-startTime="241">So 3G and 4G, what's so special about that? </span><span class="line" data-startTime="247">How does battery life play into this? It turns </span><span class="line" data-startTime="247">out that battery life is kind of the central </span><span class="line" data-startTime="252">component. There is the radio, and then there </span><span class="line" data-startTime="252">is a battery. Those are two connected components </span><span class="line" data-startTime="257">that we need to think about. And what is the </span><span class="line" data-startTime="257">radio resource controller? Our friend and </span><span class="line" data-startTime="262">foe. </span> <span class="line" data-startTime="262">So let's dive right in. First of all, wireless </span><span class="line" data-startTime="266">or WiFi came around in the early '90s. That's </span><span class="line" data-startTime="266">when the first standards were published. Really, </span><span class="line" data-startTime="272">it only became popular in the late '90s with </span><span class="line" data-startTime="272">the release of the 802.11b, which is the 11-megabits-per-second </span><span class="line" data-startTime="279">standard. </span> <span class="line" data-startTime="279">And the thing to realize about WiFi is it </span><span class="line" data-startTime="281">was literally designed as an extension to </span><span class="line" data-startTime="281">your local area network, your LAN. So we re-use </span><span class="line" data-startTime="287">all of the same framing, protocols, mechanisms, </span><span class="line" data-startTime="287">and all the rest of them, basically added </span><span class="line" data-startTime="291">a wireless interface to it. So it is not designed </span><span class="line" data-startTime="291">for a mobile device, which is to say a device </span><span class="line" data-startTime="298">with limited battery. It was designed for </span><span class="line" data-startTime="298">your desktop computer, your laptop computer, </span><span class="line" data-startTime="302">right? </span><span class="line" data-startTime="302">We weren't constrained by power at the time. </span></p>

<p><span class="line" data-startTime="305">Think back to the phone that you had in 1999. </span> <span class="line" data-startTime="305">Right? We weren't thinking about the kinds </span><span class="line" data-startTime="311">of applications that we were delivering at </span><span class="line" data-startTime="311">the time. </span> <span class="line" data-startTime="314">And the thing about WiFi is we need to understand </span><span class="line" data-startTime="314">how we actually schedule how we communicate </span><span class="line" data-startTime="319">over WiFi, right? So when we are communicating </span><span class="line" data-startTime="319">over a wired connection, we have a switch </span><span class="line" data-startTime="324">or a router which routes all of the packets </span><span class="line" data-startTime="324">between the destination &mdash; or the client and </span><span class="line" data-startTime="330">server, for example. </span> <span class="line" data-startTime="330">In WiFi, we share the radio channel. And the </span><span class="line" data-startTime="334">radio channel is a shared medium between all </span><span class="line" data-startTime="334">of us, right? All of us can't talk at the </span><span class="line" data-startTime="338">same time. That would just generate a lot </span><span class="line" data-startTime="338">of noise. So we need some sort of mechanism </span><span class="line" data-startTime="342">to figure out who is going to talk when. And </span><span class="line" data-startTime="342">WiFi takes a very hands-off approach about </span><span class="line" data-startTime="346">this. It basically says let's use a very simple </span><span class="line" data-startTime="346">algorithm, which is if you want to talk first, </span><span class="line" data-startTime="351">listen if nobody else is talking. If nobody </span><span class="line" data-startTime="351">else is talking, then start talking, right? </span><span class="line" data-startTime="356">And if another person starts talking while </span><span class="line" data-startTime="356">you're talking, well, then both of you stop, </span><span class="line" data-startTime="360">wait for random interval of time and repeat </span><span class="line" data-startTime="360">the whole process, right? So it is kind of </span><span class="line" data-startTime="364">like this party algorithm of, We'll just trust </span><span class="line" data-startTime="364">that all of you behave nicely and you will </span><span class="line" data-startTime="370">all respect each other and we will just kind </span><span class="line" data-startTime="370">of share this medium. That's WiFi. </span></p>

<p><span class="line" data-startTime="376">Now, you can actually model this and prove </span><span class="line" data-startTime="376">that the channel load or the amount of traffic </span><span class="line" data-startTime="382">needs to be kept fairly low. In fact, the </span><span class="line" data-startTime="382">load of the network needs to be below 10% </span><span class="line" data-startTime="387">in order to achieve good performance. Like, </span><span class="line" data-startTime="387">you're always going to have retransmissions. </span> <span class="line" data-startTime="391">There will always be the case when I start </span><span class="line" data-startTime="391">talking and you start talking a little bit </span><span class="line" data-startTime="393">later and we collide. That's okay because </span><span class="line" data-startTime="393">we will wait and then we will retransmit data </span><span class="line" data-startTime="398">and everything is okay. You can get pretty </span><span class="line" data-startTime="398">good performance. </span> <span class="line" data-startTime="401">But after a while, you basically run into </span><span class="line" data-startTime="401">the case where there are too many devices </span><span class="line" data-startTime="405">trying to compete for the same medium and </span><span class="line" data-startTime="405">the network basically collapses. There is </span><span class="line" data-startTime="410">no way to recover from this state. </span> <span class="line" data-startTime="410">And I'm pretty sure all of us have experienced </span><span class="line" data-startTime="414">this at some point, right? WiFi in a large </span><span class="line" data-startTime="414">group of people and a room, not a good combination </span><span class="line" data-startTime="422">oftentimes. So that's in part why. </span> <span class="line" data-startTime="422">And we can dig a little bit deeper and actually </span><span class="line" data-startTime="428">look at how it's implemented. So in the 2.4-gigahertz </span><span class="line" data-startTime="428">spectrum, we actually have a limited amount </span><span class="line" data-startTime="434">of spectrum. Like, let's say 60 megahertz. </span> <span class="line" data-startTime="434">Within that 60 megahertz, we can actually </span><span class="line" data-startTime="439">have three channels, which is to say up to </span><span class="line" data-startTime="439">three devices can talk in parallel and they </span><span class="line" data-startTime="444">won't interfere with each other, right? So </span><span class="line" data-startTime="444">these are the channels. If you guys have ever </span><span class="line" data-startTime="448">dug into your settings on your WiFi router, </span><span class="line" data-startTime="448">that would be your, like, channel 1, channel </span><span class="line" data-startTime="452">6 or channel 11 or something to that extent. </span></p>

<p><span class="line" data-startTime="452">Now, the problem is &mdash; this is nice and pretty. </span> <span class="line" data-startTime="459">This is a little chart that I pulled up on </span><span class="line" data-startTime="459">my own home network. And you can see that </span><span class="line" data-startTime="463">there is over a dozen networks, right? And </span><span class="line" data-startTime="463">they're all overlapping. We are all trying </span><span class="line" data-startTime="467">to talk over each other. And, basically, WiFi, </span><span class="line" data-startTime="467">to some degree, is a victim of its own success. </span> <span class="line" data-startTime="473">It has become so ubiquitous, there are so </span><span class="line" data-startTime="473">many WiFi routers out there, that it's just </span><span class="line" data-startTime="479">&mdash; it is very hard to get a slot to talk to </span><span class="line" data-startTime="479">somebody without interfering with anybody, </span><span class="line" data-startTime="484">right? </span><span class="line" data-startTime="484">So your neighbor, when they start streaming </span><span class="line" data-startTime="487">that HD Netflix movie, they are interfering </span><span class="line" data-startTime="487">with you as well even though it is a different </span><span class="line" data-startTime="492">access point. They are still using the same </span><span class="line" data-startTime="492">shared spectrum. </span></p>

<p><span class="line" data-startTime="496">So there is limited capacity. And most networks </span><span class="line" data-startTime="496">have tens or even more than dozens of overlapping </span><span class="line" data-startTime="504">networks. </span> <span class="line" data-startTime="504">So here's a fun experiment. I ran this at </span><span class="line" data-startTime="507">my house. This is not definitive data, but </span><span class="line" data-startTime="507">this is an example of a data point. There's </span><span class="line" data-startTime="512">about 15 access points just in and around </span><span class="line" data-startTime="512">my apartment. And I ran a very simple test. </span> <span class="line" data-startTime="518">I took my laptop and I had my router which </span><span class="line" data-startTime="518">was about 15 feet away and I was staring right </span><span class="line" data-startTime="523">at it. And I figured, hey, how long does it </span><span class="line" data-startTime="523">take for one packet to get from my laptop </span><span class="line" data-startTime="528">to the router? What is the latency of that </span><span class="line" data-startTime="528">first hop? </span><span class="line" data-startTime="532">And I gathered data for several hours. So </span><span class="line" data-startTime="532">this is, you know, a good sample of data. </span> <span class="line" data-startTime="537">And if you look at the numbers here, the 95th </span><span class="line" data-startTime="537">percentile is about 50 milliseconds. So to </span><span class="line" data-startTime="543">travel 15 feet from my laptop to my router, </span><span class="line" data-startTime="543">it was taking about 50 milliseconds, which </span><span class="line" data-startTime="548">is crazy because 50 milliseconds is about </span><span class="line" data-startTime="548">the amount of time that it takes to travel </span><span class="line" data-startTime="552">from the West Coast to the East Coast, right? </span><span class="line" data-startTime="552">So here I am trying to, like, shuttle a packet </span><span class="line" data-startTime="558">15 feet away to my router. This is a function </span><span class="line" data-startTime="558">of there is just a lot of other activity in </span><span class="line" data-startTime="564">the vicinity. So we were competing for the </span><span class="line" data-startTime="564">same spectrum. </span></p>

<p><span class="line" data-startTime="567">So then I tried something different. I actually </span><span class="line" data-startTime="567">went out and bought a different router, which </span><span class="line" data-startTime="571">is using the new &mdash; the new 802.11n standard </span><span class="line" data-startTime="571">and it's running on the 5-gigahertz band. </span> <span class="line" data-startTime="577">And the 5-gigahertz band gives us more bandwidth. </span> <span class="line" data-startTime="577">And by the function that it is also new, not </span><span class="line" data-startTime="583">many people are using it, right? So I was </span><span class="line" data-startTime="583">like the lone person on that channel. </span> <span class="line" data-startTime="588">And I ran the same test and there you go. </span> <span class="line" data-startTime="588">My 95th percentile latency is down to 2 milliseconds. </span> <span class="line" data-startTime="595">So as far as I'm concerned that was a fantastic </span><span class="line" data-startTime="595">investment. So if nothing else, you can go </span><span class="line" data-startTime="599">back home, upgrade your router to 5 gigahertz, </span><span class="line" data-startTime="599">and hope that not many of you are living in </span><span class="line" data-startTime="604">the same neighborhood, and you are not competing </span><span class="line" data-startTime="604">with each other. </span> <span class="line" data-startTime="606">[ Laughter ] </span></p>

<p class="speaker"><span class="line" data-starttime="606"><span class="speakerName">Ilya Grigorik</span>: And then you will get much </span><span class="line" data-startTime="608">better performance &mdash; Web performance. We </span><span class="line" data-startTime="608">just cut 50 milliseconds of latency. That </span><span class="line" data-startTime="612">is huge for performance. </span> <span class="line" data-startTime="612">So some take-aways from this. First of all, </span><span class="line" data-startTime="619">WiFi makes no guarantees about the bandwidth </span><span class="line" data-startTime="619">or the data rate that you are going to get. </span> <span class="line" data-startTime="624">Anybody else can start transmitting at any </span><span class="line" data-startTime="624">point in time, so it is unpredictable. </span> <span class="line" data-startTime="629">One way to adapt to this is to &mdash; well, one </span><span class="line" data-startTime="629">way to deal with this is to adapt to the variable </span><span class="line" data-startTime="636">bandwidth. Not to predict it, you can't predict </span><span class="line" data-startTime="636">it. You can only adapt to it. </span> <span class="line" data-startTime="641">We leverage this to, for example, serve video. </span> <span class="line" data-startTime="641">Like, when we serve video on YouTube, we serve </span><span class="line" data-startTime="645">it in small chunks, like, 5 to 10-second chunks, </span><span class="line" data-startTime="645">where we stream a chunk of video. We see if </span><span class="line" data-startTime="651">you can download it fast enough. If you can </span><span class="line" data-startTime="651">download it fast enough, we can upgrade you </span><span class="line" data-startTime="656">to a higher-quality stream. Vice versa, if </span><span class="line" data-startTime="656">your bandwidth was all of a sudden cut in </span><span class="line" data-startTime="661">half because somebody else is streaming a </span><span class="line" data-startTime="661">video, we will downgrade you seamlessly to </span><span class="line" data-startTime="666">a lower resolution video. So that's adaptive </span><span class="line" data-startTime="666">streaming. And that's something that you can </span><span class="line" data-startTime="671">do as well if you're streaming music, streaming </span><span class="line" data-startTime="671">video, or other things. </span></p>

<p><span class="line" data-startTime="675">The other variable that you can't really control </span><span class="line" data-startTime="675">with WiFi is, of course, latency and jitter, </span><span class="line" data-startTime="680">right? So because we have these collisions </span><span class="line" data-startTime="680">all the time. Your packets need to be retransmitted, </span><span class="line" data-startTime="685">and there is not much you can do. WiFi provides </span><span class="line" data-startTime="685">no guarantees about this. If you have ever </span><span class="line" data-startTime="689">tried to implement a real-time chat or real-time </span><span class="line" data-startTime="689">voice and video over WiFi, you have certainly </span><span class="line" data-startTime="696">run into this problem. </span> <span class="line" data-startTime="696">So perhaps the only thing you can really do </span><span class="line" data-startTime="700">is start looking into something like WebRTC </span><span class="line" data-startTime="700">which allows you to leverage unreliable delivery </span><span class="line" data-startTime="706">and basically UDP in the browser. </span> <span class="line" data-startTime="706">And we had a great session on WebRTC earlier </span><span class="line" data-startTime="710">today. So if you guys have missed it, check </span><span class="line" data-startTime="710">out the video for that. </span> <span class="line" data-startTime="715">So that's WiFi, right? So that's just a baseline. </span></p>

<p><span class="line" data-startTime="715">Now let's take a look at 2G, 3G and 4G networks. </span> <span class="line" data-startTime="722">How do they work and how are they different? </span><span class="line" data-startTime="722">So, first of all, when the mobile carriers </span><span class="line" data-startTime="729">or the mobile standards started, you know, </span><span class="line" data-startTime="729">they set aside some specific constraints that </span><span class="line" data-startTime="735">they needed to optimize for. First, they needed </span><span class="line" data-startTime="735">to guarantee some level of performance. </span> <span class="line" data-startTime="742">So they wanted to make sure that they don't </span><span class="line" data-startTime="742">have this congestion collapse scenario which </span><span class="line" data-startTime="746">is present in WiFi, right? And they wanted </span><span class="line" data-startTime="746">to have some knobs to tweak to say, like, </span><span class="line" data-startTime="750">if this is really overloading a network, we </span><span class="line" data-startTime="750">will lower the data rates for everybody. But </span><span class="line" data-startTime="754">you can still sort of get a lower data rate. </span> <span class="line" data-startTime="754">We want to be able to control that, and we </span><span class="line" data-startTime="758">need some knobs for that. That's number one. </span> <span class="line" data-startTime="758">Second is, of course, we're covering a much </span><span class="line" data-startTime="763">larger geographical area which means that, </span><span class="line" data-startTime="763">once again, we need to handle more clients. </span> <span class="line" data-startTime="768">And that's something we need to account for. </span> <span class="line" data-startTime="768">And the second one is our battery life. So </span><span class="line" data-startTime="774">it turns out when you're optimizing for mobile </span><span class="line" data-startTime="774">devices, you really need to think about battery </span><span class="line" data-startTime="779">life. I think for many of us, you know, if </span><span class="line" data-startTime="779">we use our phone actively, or our mobile device </span><span class="line" data-startTime="785">actively, you will find that your battery </span><span class="line" data-startTime="785">is draining very, very quickly. So, radio </span><span class="line" data-startTime="792">is a very important component of that. </span></p>

<p><span class="line" data-startTime="792">You add these two things together and you </span><span class="line" data-startTime="796">get the radio resource controller. And what </span><span class="line" data-startTime="796">is the radio resource controller? So, mobile </span><span class="line" data-startTime="803">networks, the 2G, 3G and 4G standards take </span><span class="line" data-startTime="803">a different approach as to how they schedule </span><span class="line" data-startTime="809">when you can communicate. Instead of doing </span><span class="line" data-startTime="809">this freebie approach of you just start talking </span><span class="line" data-startTime="814">when you think nobody else is talking, they're </span><span class="line" data-startTime="814">actually employing a moderator, which is to </span><span class="line" data-startTime="818">say the radio tower actually tells you when </span><span class="line" data-startTime="818">you can speak. </span> <span class="line" data-startTime="822">You tell the radio tower that, Hey, I would </span><span class="line" data-startTime="822">like to send some data and then the radio </span><span class="line" data-startTime="826">tower consults its schedule and tells you, </span><span class="line" data-startTime="826">okay, I've got these five people that are </span><span class="line" data-startTime="831">queued up. You're this far away, so you start </span><span class="line" data-startTime="831">transmitting at this point in time with this </span><span class="line" data-startTime="836">signal power with these parameters, with this </span><span class="line" data-startTime="836">encoding and then you have this amount of </span><span class="line" data-startTime="840">time, right? </span><span class="line" data-startTime="840">So it is a very different scheduling mechanism. </span> <span class="line" data-startTime="845">And as you can imagine, this adds a lot more </span><span class="line" data-startTime="845">overhead, but it allows us to schedule resources </span><span class="line" data-startTime="849">more efficiently within the network. And this </span><span class="line" data-startTime="849">obviously has its pros and cons. </span> <span class="line" data-startTime="854">So the radio resource controller lives within </span><span class="line" data-startTime="854">a different component of the network infrastructure </span><span class="line" data-startTime="863">in 2G and 3G networks. It was actually living </span><span class="line" data-startTime="863">in the core network. In the latest networks, </span><span class="line" data-startTime="867">it is living right at the radio tower, which </span><span class="line" data-startTime="867">is one of the ways of how we are improving </span><span class="line" data-startTime="871">performance in 4G networks. By moving it closer </span><span class="line" data-startTime="871">to you, we are reducing the latency. </span></p>

<p><span class="line" data-startTime="877">But the radio resource controller has a number </span><span class="line" data-startTime="877">of implications. So first of these is the </span><span class="line" data-startTime="883">difference &mdash; and the distinction between </span><span class="line" data-startTime="883">the control and the user-plane latency. So </span><span class="line" data-startTime="891">whenever you talk to anybody that's working </span><span class="line" data-startTime="891">in the mobile space, they'll often throw this </span><span class="line" data-startTime="895">out and mention the control and user-plane </span><span class="line" data-startTime="895">latency. What is it? </span><span class="line" data-startTime="899">Recall that we need to talk to the radio tower </span><span class="line" data-startTime="899">to figure out when we're allowed to transmit </span><span class="line" data-startTime="903">data. This is what happens first. You send </span><span class="line" data-startTime="903">a message to the radio tower and say, I would </span><span class="line" data-startTime="908">like to send data. The radio tower determines </span><span class="line" data-startTime="908">when you can talk. And then it sends you a </span><span class="line" data-startTime="913">message back. That is the control plane latency. </span> <span class="line" data-startTime="913">In 3G networks, this can take up to 2 1/2 </span><span class="line" data-startTime="920">seconds. 2 1/2 seconds just &mdash; we haven't </span><span class="line" data-startTime="920">even sent a packet of data, application data, </span><span class="line" data-startTime="926">from your phone. We're basically trying to </span><span class="line" data-startTime="926">get a resource assignment from the radio tower. </span></p>

<p><span class="line" data-startTime="931">In 4G networks and the latest generation networks, </span><span class="line" data-startTime="931">this time is significantly improved. It's </span><span class="line" data-startTime="936">under 100 milliseconds. But, nonetheless, </span><span class="line" data-startTime="936">every millisecond counts and 100 milliseconds </span><span class="line" data-startTime="941">is a significant amount of time. </span> <span class="line" data-startTime="941">And then only after we've incurred this cost </span><span class="line" data-startTime="946">and we have gotten a resource assignment, </span><span class="line" data-startTime="946">can we then trance &mdash; start transmitting data </span><span class="line" data-startTime="951">from our phone to the radio tower? </span><span class="line" data-startTime="951">And that is known as the user-plane latency. </span> <span class="line" data-startTime="956">And, for example, in 4G networks that can </span><span class="line" data-startTime="956">be about 10 milliseconds, right? We're definitely </span><span class="line" data-startTime="962">in the weeds here looking at how the mobile </span><span class="line" data-startTime="962">radio works, but some important take-aways </span><span class="line" data-startTime="967">there. </span> <span class="line" data-startTime="967">Let's take this from the ground up. Your phone </span><span class="line" data-startTime="971">is idle. It has been asleep. You take it out </span><span class="line" data-startTime="971">of your pocket. You start typing in an URL. </span> <span class="line" data-startTime="976">You hit "go." What happens? </span><span class="line" data-startTime="976">We &mdash; so this is a 4G network. First, we need </span><span class="line" data-startTime="981">to talk to the tower. So we're going to incur </span><span class="line" data-startTime="981">at least 100 milliseconds of latency. Then </span><span class="line" data-startTime="986">our phone is active and starts transmitting </span><span class="line" data-startTime="986">data or the radio was active and it starts </span><span class="line" data-startTime="990">transmitting data. </span> <span class="line" data-startTime="990">After some time, it will actually downgrade </span><span class="line" data-startTime="996">your radio into a short sleep cycle which </span><span class="line" data-startTime="996">is to say it is not going to listen for transmissions </span><span class="line" data-startTime="1001">all the time. It will sleep for some time </span><span class="line" data-startTime="1001">and then it will wake up periodically to save </span><span class="line" data-startTime="1007">power. It turns out that the radio is the </span><span class="line" data-startTime="1007">second most expensive component in terms of </span><span class="line" data-startTime="1011">power or energy use in your phone after the </span><span class="line" data-startTime="1011">screen. </span></p>

<p><span class="line" data-startTime="1015">So this is why we want to turn off the radio </span><span class="line" data-startTime="1015">as quickly as possible. And in the case of </span><span class="line" data-startTime="1021">4G networks, this is usually done after 100 </span><span class="line" data-startTime="1021">milliseconds of inactivity on your radio. </span> <span class="line" data-startTime="1025">So we've transmitted some data. We wait for </span><span class="line" data-startTime="1025">a 100-millisecond pause and then we downgrade </span><span class="line" data-startTime="1029">your radio into this half sleep state. </span> <span class="line" data-startTime="1029">And at that point, if you want to transmit </span><span class="line" data-startTime="1034">data again, we need to go through that whole </span><span class="line" data-startTime="1034">control plane cycle once more. So you're, </span><span class="line" data-startTime="1039">once again, incurring this same cost. </span> <span class="line" data-startTime="1039">But then if your phone continues to be idle, </span><span class="line" data-startTime="1046">we wait for another 100 milliseconds. We go </span><span class="line" data-startTime="1046">into the second, the long sleep mode, and </span><span class="line" data-startTime="1051">only after then &mdash; after about 10 seconds, </span><span class="line" data-startTime="1051">we will go back into the idle mode. </span> <span class="line" data-startTime="1055">Right? So a kind of pretty complicated flowchart. </span></p>

<p><span class="line" data-startTime="1055">But effectively what this says is, first, </span><span class="line" data-startTime="1061">we have to incur the cost to upgrade the radio </span><span class="line" data-startTime="1061">and then it takes roughly 10 seconds to get </span><span class="line" data-startTime="1066">back to idle mode. And this is very important, </span><span class="line" data-startTime="1066">as you will see in a second. </span> <span class="line" data-startTime="1071">So let's put this together, right? This is </span><span class="line" data-startTime="1071">pretty low level. How does this affect an </span><span class="line" data-startTime="1075">actual data transfer, something like an hspeed </span><span class="line" data-startTime="1075">edit data transfer. Let's start from the beginning. </span> <span class="line" data-startTime="1081">We want to send the request which means we </span><span class="line" data-startTime="1081">need to do a DNS lookup. We may need to do </span><span class="line" data-startTime="1084">a DNS lookup. We need to do a TCP handshake </span><span class="line" data-startTime="1084">followed by the dispatching the actual hspear </span><span class="line" data-startTime="1089">request and then we actually need to fetch </span><span class="line" data-startTime="1089">the content and maybe optionally we need to </span><span class="line" data-startTime="1094">do the TLS handshake for another &mdash; up to </span><span class="line" data-startTime="1094">two round trips there. </span> <span class="line" data-startTime="1102">So let's add up all of these numbers. First </span><span class="line" data-startTime="1102">of all, we have the control plane latency, </span><span class="line" data-startTime="1108">which is the time to wake up the radio and </span><span class="line" data-startTime="1108">get into the active state. </span></p>

<p><span class="line" data-startTime="1111">So I'm using HSPA here, which is a 3G network. </span> <span class="line" data-startTime="1111">And I'm using an average round trip time of </span><span class="line" data-startTime="1117">about 200 milliseconds, which is roughly the </span><span class="line" data-startTime="1117">time that we see at Google for 3G networks. </span> <span class="line" data-startTime="1122">And then for 4G networks, these new-generation </span><span class="line" data-startTime="1122">networks, let's use 80 milliseconds, which </span><span class="line" data-startTime="1127">is actually fairly aggressive. </span> <span class="line" data-startTime="1127">So 200 to 2.5 seconds &mdash; so 200 milliseconds </span><span class="line" data-startTime="1136">to 2 1/2 seconds just to get out of the control </span><span class="line" data-startTime="1136">plane for the 3G network and then we have </span><span class="line" data-startTime="1141">these round trips to fetch the DNS, to establish </span><span class="line" data-startTime="1141">TCP and all the rest. And very quickly you </span><span class="line" data-startTime="1146">add up all the numbers, and this is without </span><span class="line" data-startTime="1146">your server response time, we already have </span><span class="line" data-startTime="1151">over half a second of just network latency. </span> <span class="line" data-startTime="1151">And this is very important if you're trying </span><span class="line" data-startTime="1157">to design a responsive application that feels </span><span class="line" data-startTime="1157">responsive to the user. So the good news is, </span><span class="line" data-startTime="1162">things are definitely getting better with </span><span class="line" data-startTime="1162">4G. We are down into hundreds of milliseconds </span><span class="line" data-startTime="1167">and half a second territory. But we also can't </span><span class="line" data-startTime="1167">rely on 4G as you will see in a second. So </span><span class="line" data-startTime="1172">really you should assume that there's literally </span><span class="line" data-startTime="1172">seconds of latency &mdash; of network latency overhead </span><span class="line" data-startTime="1178">when you design your applications. </span> <span class="line" data-startTime="1178">So the first take-away here is we know that </span><span class="line" data-startTime="1185">there are some constants that good applications </span><span class="line" data-startTime="1185">need to follow. A number of different user </span><span class="line" data-startTime="1191">experience research studies have shown that </span><span class="line" data-startTime="1191">in order for an app to feel instant, it needs </span><span class="line" data-startTime="1196">to respond to the user, knowledge user input </span><span class="line" data-startTime="1196">within hundreds of milliseconds. We just saw </span><span class="line" data-startTime="1202">in that, even on the latest 4G network, you </span><span class="line" data-startTime="1202">are incurring 300 to 500 milliseconds. Which </span><span class="line" data-startTime="1206">means that you basically &mdash; you cannot wait </span><span class="line" data-startTime="1206">for the http request or any request to complete. </span></p>

<p><span class="line" data-startTime="1211">You need to acknowledge the user input independently </span><span class="line" data-startTime="1211">of dispatching the request. That's the only </span><span class="line" data-startTime="1220">way you will have an application that feels </span><span class="line" data-startTime="1220">instant to the user. All communication should </span><span class="line" data-startTime="1229">be asynchronous. </span> <span class="line" data-startTime="1229">Similarly, you should anticipate the RRC latency. </span> <span class="line" data-startTime="1235">It is a very common complaint about mobile </span><span class="line" data-startTime="1235">networks. Oh, my God, they are so unpredictable. </span> <span class="line" data-startTime="1240">The variability is so high. Turns out, once </span><span class="line" data-startTime="1240">you are aware of the control playing latency </span><span class="line" data-startTime="1245">or listening negotiation at the beginning </span><span class="line" data-startTime="1245">which is the time to wake up your radio, you </span><span class="line" data-startTime="1249">can model the stuff very well. You can build </span><span class="line" data-startTime="1249">and you can bake these things into the design </span><span class="line" data-startTime="1255">process of your application. Once you talk </span><span class="line" data-startTime="1255">to your designers and let them know, hey, </span><span class="line" data-startTime="1259">it may actually take two seconds before we </span><span class="line" data-startTime="1259">can do anything like even send an application </span><span class="line" data-startTime="1263">packet, they can design their application </span><span class="line" data-startTime="1263">in a way that provides some sort of feedback </span><span class="line" data-startTime="1269">to the user that, hey, we are working on processing </span><span class="line" data-startTime="1269">your input but it may take a while. </span> <span class="line" data-startTime="1275">All right. So moving on. We talked about energy. </span></p>

<p><span class="line" data-startTime="1275">So this is another gotcha that I think is </span><span class="line" data-startTime="1284">top of mind for a lot of applications that </span><span class="line" data-startTime="1284">are native applications but is not top of </span><span class="line" data-startTime="1290">mind for web applications but it certainly </span><span class="line" data-startTime="1290">will be soon. So notice that in our earlier </span><span class="line" data-startTime="1297">diagram we said it takes about ten seconds </span><span class="line" data-startTime="1297">to cycle from a high-power state to a low-power </span><span class="line" data-startTime="1302">state. This actually causes what is known </span><span class="line" data-startTime="1302">as an energy tail where it doesn't matter </span><span class="line" data-startTime="1307">how much data you have transferred, the radio </span><span class="line" data-startTime="1307">will be active for a certain period of time. </span> <span class="line" data-startTime="1312">Like it could have transferred one bit or </span><span class="line" data-startTime="1312">one byte of data. It doesn't matter, right? </span><span class="line" data-startTime="1317">Or you could have transferred 10 kilobytes </span><span class="line" data-startTime="1317">or 100 kilobytes for data. The radio is going </span><span class="line" data-startTime="1320">to be on effectively for ten seconds after </span><span class="line" data-startTime="1320">that. So you are not going to save much by </span><span class="line" data-startTime="1328">kind of sending data bit by bit. What you </span><span class="line" data-startTime="1328">want do is you want to send as much data as </span><span class="line" data-startTime="1332">possible as early as possible. And, in fact, </span><span class="line" data-startTime="1332">intermittent data transfers is a huge, huge </span><span class="line" data-startTime="1339">anti-pattern, performance anti-pattern on </span><span class="line" data-startTime="1339">mobile. So I have an example of this. And </span><span class="line" data-startTime="1344">average mobile device today has about five </span><span class="line" data-startTime="1344">watt hours of battery capacity. Don't worry </span><span class="line" data-startTime="1349">about the units too much. This is just to </span><span class="line" data-startTime="1349">illustrate the point. Five watt hours is about </span><span class="line" data-startTime="1354">18,000 joules. It turns out that an average </span><span class="line" data-startTime="1354">phone today, a4G connection, in order to cycle </span><span class="line" data-startTime="1360">to a low state to high state back to low state </span><span class="line" data-startTime="1360">will take about ten joules of energy. All </span><span class="line" data-startTime="1367">right. Let's do our math. Let's say we have </span><span class="line" data-startTime="1367">a one-minute pulling interval. So I built </span><span class="line" data-startTime="1372">an application like a gmail application which </span><span class="line" data-startTime="1372">every minute will wake up and just ping the </span><span class="line" data-startTime="1377">server, say, do I have any mail? Are there </span><span class="line" data-startTime="1377">any messages for me? You multiply that out. </span></p>

<p><span class="line" data-startTime="1383">It turns out that this application will consume </span><span class="line" data-startTime="1383">3% of battery life per hour. Right? Now you </span><span class="line" data-startTime="1389">have a couple of these applications running </span><span class="line" data-startTime="1389">on your phone. They have nonoverlapping intervals. </span> <span class="line" data-startTime="1394">You have your phone in your pocket for half </span><span class="line" data-startTime="1394">a day. You take it out. Your battery is at </span><span class="line" data-startTime="1398">20%. You wonder what the heck happened there? </span><span class="line" data-startTime="1398">That's what happened there. We're doing these </span><span class="line" data-startTime="1403">intermittent pings and that's what's draining </span><span class="line" data-startTime="1403">the battery. So intermittent data transfers </span><span class="line" data-startTime="1407">are extremely expensive. There's a really </span><span class="line" data-startTime="1407">cool case study that was done as a joint case </span><span class="line" data-startTime="1413">study between AT&T and Pandora. They analyzed </span><span class="line" data-startTime="1413">the native Pandora application, which is, </span><span class="line" data-startTime="1420">of course, a music streaming application. </span> <span class="line" data-startTime="1420">And they discovered something interesting. </span></p>

<p><span class="line" data-startTime="1423">Pandora was doing all the right things when </span><span class="line" data-startTime="1423">they were streaming the music. You start playing </span><span class="line" data-startTime="1427">the song. They would stream the entire song </span><span class="line" data-startTime="1427">down to the client. Play the whole thing, </span><span class="line" data-startTime="1432">and turn off the radio which is exactly what </span><span class="line" data-startTime="1432">you want to do. But then about every 58 seconds </span><span class="line" data-startTime="1439">or 60 seconds, Pandora would fire an analytics </span><span class="line" data-startTime="1439">beacon which was reporting, like, how far </span><span class="line" data-startTime="1445">along did you listen in a song and did you </span><span class="line" data-startTime="1445">like the song and all the rest. It seems reasonable. </span> <span class="line" data-startTime="1451">They analyze it and realized that those data </span><span class="line" data-startTime="1451">transfers were accounting to .2% of the total </span><span class="line" data-startTime="1456">bytes transferred but it was 46% of the battery </span><span class="line" data-startTime="1456">life of that application. So &mdash; which is a </span><span class="line" data-startTime="1463">huge, of course, huge performance problem. </span></p>

<p><span class="line" data-startTime="1463">So all they had to do was to move &mdash; these </span><span class="line" data-startTime="1471">are not critical beacons. Right? They could </span><span class="line" data-startTime="1471">simply defer that until later until the next </span><span class="line" data-startTime="1475">song data transfer. They could accumulate </span><span class="line" data-startTime="1475">this data. They did exactly that and they </span><span class="line" data-startTime="1479">significantly improved the performance of </span><span class="line" data-startTime="1479">their application. So here are a couple of </span><span class="line" data-startTime="1485">examples. It's a little bit small but I was </span><span class="line" data-startTime="1485">looking at, for example, CNN.com here. And </span><span class="line" data-startTime="1489">I notice that they have a realtime Analytics </span><span class="line" data-startTime="1489">beacon installed in their site. So whenever </span><span class="line" data-startTime="1494">you're reading a CNN article on your mobile </span><span class="line" data-startTime="1494">phone, about every five seconds chart beat </span><span class="line" data-startTime="1500">sends a beacon saying, yep, I'm still here. </span> <span class="line" data-startTime="1500">Yep, I'm still here. Yep, I'm still alive. </span> <span class="line" data-startTime="1505">And guess what? As you're reading CNN, you're </span><span class="line" data-startTime="1505">draining your battery, which is not a great </span><span class="line" data-startTime="1510">experience. So in Google Analytics, we actually </span><span class="line" data-startTime="1510">caught this problem early and fixed it and </span><span class="line" data-startTime="1516">we don't do this. We will actually &mdash; we have </span><span class="line" data-startTime="1516">a different way to provide realtime Analytics </span><span class="line" data-startTime="1522">but we have a way to do that without requiring </span><span class="line" data-startTime="1522">these beacons. So the short take-away is if </span><span class="line" data-startTime="1527">you are sending these kinds of beacons in </span><span class="line" data-startTime="1527">your application, web or native, definitely </span><span class="line" data-startTime="1531">something to reconsider because it's extremely </span><span class="line" data-startTime="1531">expensive. Now, unfortunately today I don't </span><span class="line" data-startTime="1538">think many platforms provide very good instrumentation </span><span class="line" data-startTime="1538">or visibility into how much energy does my </span><span class="line" data-startTime="1545">application consume? Whether that's web or </span><span class="line" data-startTime="1545">native, but one tool that is actually very </span><span class="line" data-startTime="1551">good is the AT&T's error tool. It is a free </span><span class="line" data-startTime="1551">and open source tool. I will show you a quick </span><span class="line" data-startTime="1557">demo of this. What it allows you to do, it </span><span class="line" data-startTime="1557">allows you to capture a trace file. It can </span><span class="line" data-startTime="1565">actually record &mdash; you can install an application </span><span class="line" data-startTime="1565">on your Android device. You hit record. You </span><span class="line" data-startTime="1570">interact with your application. Then you export </span><span class="line" data-startTime="1570">a trace and you can analyze it with this analyzer </span><span class="line" data-startTime="1574">tool. I have already prerecorded a trace. </span></p>

<p><span class="line" data-startTime="1574">I will show it to you guys here. So let me </span><span class="line" data-startTime="1580">load this app here. And you can also run it </span><span class="line" data-startTime="1580">in emulator, but I prefer do it on my phone. </span> <span class="line" data-startTime="1589">I loaded a web site. I have this trace. One </span><span class="line" data-startTime="1589">of the cool things it provides is it will </span><span class="line" data-startTime="1594">&mdash; it can also record your screen. Here I'm </span><span class="line" data-startTime="1594">starting collector and I will fast forward </span><span class="line" data-startTime="1598">a little bit. So I'm loading the site Red </span><span class="line" data-startTime="1598">Robin here. It can look at the diagnostics </span><span class="line" data-startTime="1604">here. This is us downloading the images, downloading </span><span class="line" data-startTime="1604">the page. You can see the through put, different </span><span class="line" data-startTime="1612">RCC states or the states of the radio and </span><span class="line" data-startTime="1612">the energy consumption of your app. So let </span><span class="line" data-startTime="1617">me pause this. And one of the cool things </span><span class="line" data-startTime="1617">about this tool it will actually also analyze </span><span class="line" data-startTime="1624">the content that you are downloading and point </span><span class="line" data-startTime="1624">out common performance anti-patterns. Things </span><span class="line" data-startTime="1630">like, hey, you're not caching the data. Or </span><span class="line" data-startTime="1630">you have intermittent data transfers. But </span><span class="line" data-startTime="1636">then on top of all of that, it will also tell </span><span class="line" data-startTime="1636">you the energy consumed during this session </span><span class="line" data-startTime="1642">that you have recorded, right? So you can </span><span class="line" data-startTime="1642">actually model this. Now, one thing to call </span><span class="line" data-startTime="1646">out is this is not an exact measurement. This </span><span class="line" data-startTime="1646">is based on a model. So it has some assumptions </span><span class="line" data-startTime="1651">about the phone that you are using and the </span><span class="line" data-startTime="1651">network type you are on. You can actually </span><span class="line" data-startTime="1655">switch those and you say, I want to run this </span><span class="line" data-startTime="1655">model on the 3G network versus a 4G network. </span></p>

<p><span class="line" data-startTime="1661">So if nothing else, this is a great tool to </span><span class="line" data-startTime="1661">play with and I encourage you guys to check </span><span class="line" data-startTime="1666">it out. I hope that in the future we will </span><span class="line" data-startTime="1666">have more tools like this baked right into </span><span class="line" data-startTime="1672">our, kind of day-to-day DevTools both on native </span><span class="line" data-startTime="1672">and web platforms. </span> <span class="line" data-startTime="1678">So it is all about the battery. It literally </span><span class="line" data-startTime="1678">is all about the battery. Whenever you're </span><span class="line" data-startTime="1683">wondering, why does my mobile radio behave </span><span class="line" data-startTime="1683">in a certain way? Always ask the question </span><span class="line" data-startTime="1688">of, how does it impact my battery life and </span><span class="line" data-startTime="1688">you will often find the answer there. Radio </span><span class="line" data-startTime="1694">at full power, if it is on all the time, will </span><span class="line" data-startTime="1694">literally drain your battery in a matter of </span><span class="line" data-startTime="1698">hours. If you have ever had your phone burning </span><span class="line" data-startTime="1698">your leg, you know how that feels. What's </span><span class="line" data-startTime="1705">usually happening there is you can't get a </span><span class="line" data-startTime="1705">connection and some application is just continuously </span><span class="line" data-startTime="1711">trying to reconnect and that turns on the </span><span class="line" data-startTime="1711">radio at full power. It drains your battery </span><span class="line" data-startTime="1717">like there's no tomorrow. And the actual transfer </span><span class="line" data-startTime="1717">size does not matter. It doesn't matter if </span><span class="line" data-startTime="1724">you're transferring one byte or a hundred </span><span class="line" data-startTime="1724">kilobytes. That's the other important take-away. </span></p>

<p><span class="line" data-startTime="1728">So the consequence of that is you want to </span><span class="line" data-startTime="1728">pre-fetch data. You don't want to fetch &mdash; I'll </span><span class="line" data-startTime="1734">fetch the previews and thumbnails of my awesome </span><span class="line" data-startTime="1734">application and then as you scroll, I will </span><span class="line" data-startTime="1741">fetch the rest. That's an anti-pattern in </span><span class="line" data-startTime="1741">mobile. You want to pre-fetch as much data </span><span class="line" data-startTime="1745">as possible. Turn off the radio and hopefully </span><span class="line" data-startTime="1745">keep it off for as long as possible. We talked </span><span class="line" data-startTime="1751">about periodic data transfers. What can you </span><span class="line" data-startTime="1751">do that? You can defer the request until later. </span> <span class="line" data-startTime="1755">You can combine them. You can log that data </span><span class="line" data-startTime="1755">into a local database like localstorage and </span><span class="line" data-startTime="1761">then fire the request later. Of course, we </span><span class="line" data-startTime="1761">provide some tools for this, both on Android </span><span class="line" data-startTime="1768">and Chrome. So Google Cloud Messaging is definitely </span><span class="line" data-startTime="1768">something that you guys should check out and </span><span class="line" data-startTime="1773">leverage. What it allows you to do is you </span><span class="line" data-startTime="1773">can push notifications to our servers, through </span><span class="line" data-startTime="1779">the Google Cloud Messaging servers, and then </span><span class="line" data-startTime="1779">those servers determine a optimal strategy </span><span class="line" data-startTime="1783">for delivering those messages to your form </span><span class="line" data-startTime="1783">by limiting the number of data transfers. </span> <span class="line" data-startTime="1789">So for example, we just launched this support </span><span class="line" data-startTime="1789">on Chrome. We don't have future parity with </span><span class="line" data-startTime="1795">Android. I hope we get there quick. On Android, </span><span class="line" data-startTime="1795">you can mark a message as delay while idle, </span><span class="line" data-startTime="1803">which is to say, if the user's phone is idle, </span><span class="line" data-startTime="1803">don't push it right now. But when they wake </span><span class="line" data-startTime="1809">up their phone, push the message there. And </span><span class="line" data-startTime="1809">not only that, but if you are going to delay </span><span class="line" data-startTime="1814">the message, this is the time to live. Like </span><span class="line" data-startTime="1814">if the user doesn't wake up their phone within </span><span class="line" data-startTime="1818">the next hour, just drop the message on the </span><span class="line" data-startTime="1818">floor. It's no longer relevant, right? It's </span><span class="line" data-startTime="1823">an combination of these things that allow </span><span class="line" data-startTime="1823">you to build efficient applications with efficient </span><span class="line" data-startTime="1828">delivery of messages to the phone without </span><span class="line" data-startTime="1828">necessarily having to wake up the phone or </span><span class="line" data-startTime="1833">having your phone wake up periodically and </span><span class="line" data-startTime="1833">query our service. Which clearly does not </span><span class="line" data-startTime="1837">scale. </span></p>

<p><span class="line" data-startTime="1837">So that's a little bit about how the network </span><span class="line" data-startTime="1843">&mdash; or how the radio works on the phone itself. </span> <span class="line" data-startTime="1843">Now let's take a deep dive into how the mobile </span><span class="line" data-startTime="1849">network, the core network actually works and </span><span class="line" data-startTime="1849">what implication it is has on performance. </span> <span class="line" data-startTime="1855">So at a very high level, the mobile network </span><span class="line" data-startTime="1855">effectively has a couple of important components. </span> <span class="line" data-startTime="1862">The first one is packet gateway. The way to </span><span class="line" data-startTime="1862">think about packet gateway, is basically like </span><span class="line" data-startTime="1866">your wireless router or your router at your </span><span class="line" data-startTime="1866">us, right? It's a nat device which accepts </span><span class="line" data-startTime="1872">all of the connections. It terminates all </span><span class="line" data-startTime="1872">the connections and then it forwards the packets </span><span class="line" data-startTime="1876">to your device. In this case, a mobile device. </span> <span class="line" data-startTime="1876">And there's an important pause here which </span><span class="line" data-startTime="1883">is your connection or the connection to your </span><span class="line" data-startTime="1883">phone between the server and your phone is </span><span class="line" data-startTime="1889">not an end-to-end connection. It is being </span><span class="line" data-startTime="1889">terminated by this router. So just the fact </span><span class="line" data-startTime="1894">that you are turning off your radio or you're </span><span class="line" data-startTime="1894">pressing the power button on your phone does </span><span class="line" data-startTime="1898">not terminate the TCP connection which I think </span><span class="line" data-startTime="1898">is a common misconception. And if you are </span><span class="line" data-startTime="1904">ever seeing this kind of pattern where you </span><span class="line" data-startTime="1904">have your code basically saying, look, if </span><span class="line" data-startTime="1908">I turn off the radio, I'm going to lose my </span><span class="line" data-startTime="1908">web socket connection or something else, that </span><span class="line" data-startTime="1912">is not true. Because the connection is still </span><span class="line" data-startTime="1912">maintained by the radio network and it will </span><span class="line" data-startTime="1917">wake up your radio when it's necessary. So </span><span class="line" data-startTime="1917">if you have code like this in your application, </span><span class="line" data-startTime="1922">you definitely want to turn that off. Most </span><span class="line" data-startTime="1922">carriers have actually timeouts of anywhere </span><span class="line" data-startTime="1927">between five to 30 minutes for a TCP connection. </span></p>

<p><span class="line" data-startTime="1927">If anything, I found that by working with </span><span class="line" data-startTime="1934">many different apps, it's usually the applications </span><span class="line" data-startTime="1934">server on your side that's terminating the </span><span class="line" data-startTime="1940">connection early on. Like you have aggressive </span><span class="line" data-startTime="1940">timeouts of 60 seconds. And then because of </span><span class="line" data-startTime="1945">that, your app needs to periodically pull </span><span class="line" data-startTime="1945">your server to keep it open. So make sure </span><span class="line" data-startTime="1950">that that plumbing is correct. It's not the </span><span class="line" data-startTime="1950">carriers in most cases. </span> <span class="line" data-startTime="1956">Okay. So we've got the packet gateway. Packet </span><span class="line" data-startTime="1956">gateway has no idea about the location of </span><span class="line" data-startTime="1962">your device. What it actually does is it sends </span><span class="line" data-startTime="1962">&mdash; it forwards the packets to the serving </span><span class="line" data-startTime="1967">gateway. The serving gateway needs to figure </span><span class="line" data-startTime="1967">out, where are you? Where is your device? </span><span class="line" data-startTime="1974">The trick is, the serving gateway actually </span><span class="line" data-startTime="1974">doesn't know that either. It basically needs </span><span class="line" data-startTime="1978">to query a database like a user database to </span><span class="line" data-startTime="1978">say which radio tower are you currently associated </span><span class="line" data-startTime="1984">with and how is your billing status? Should </span><span class="line" data-startTime="1984">I be even forwarding this packet to begin </span><span class="line" data-startTime="1988">with? That's this mobility management entity. </span></p>

<p><span class="line" data-startTime="1988">It's like a user database. That's all it is. </span> <span class="line" data-startTime="1994">All right. So let's try this. Let's say we </span><span class="line" data-startTime="1994">want to send a data packet from your phone. </span> <span class="line" data-startTime="2004">We can actually connect all the pieces together </span><span class="line" data-startTime="2004">now. First my device is going to wake up and </span><span class="line" data-startTime="2009">the first component is it is going to talk </span><span class="line" data-startTime="2009">to the radio tower. It is going to negotiate </span><span class="line" data-startTime="2013">the time when it can send data. That will </span><span class="line" data-startTime="2013">take hundreds of milliseconds or up to two </span><span class="line" data-startTime="2018">seconds on 3G networks. After that, it will </span><span class="line" data-startTime="2018">transfer data to the radio tower. The radio </span><span class="line" data-startTime="2022">tower will transfer it to the serving gateway </span><span class="line" data-startTime="2022">which will forward it to the packet gateway. </span> <span class="line" data-startTime="2027">Only then will it hit the external network. </span> <span class="line" data-startTime="2027">This is when the data is transferred to the </span><span class="line" data-startTime="2031">server and all the rest. The latencies for </span><span class="line" data-startTime="2031">this end-to-end transferring here without </span><span class="line" data-startTime="2037">the external network is anywhere between 50 </span><span class="line" data-startTime="2037">milliseconds to hundreds of milliseconds on </span><span class="line" data-startTime="2041">different networks. I pulled out these numbers </span><span class="line" data-startTime="2041">from the AT&T technical FAQ. Right? Basically </span><span class="line" data-startTime="2047">the take-away here is 4G, 50 milliseconds </span><span class="line" data-startTime="2047">plus the transfer time to your server. On </span><span class="line" data-startTime="2052">3G, as high as 400 milliseconds and much, </span><span class="line" data-startTime="2052">much worse for 2G networks. Turns out that's </span><span class="line" data-startTime="2060">a simple case. Let's try the more complicated </span><span class="line" data-startTime="2060">case. I hope you guys stay with me here. Let's </span><span class="line" data-startTime="2066">say we actually want to push a packet to the </span><span class="line" data-startTime="2066">device. Right? So we are trying to wake up </span><span class="line" data-startTime="2070">the device. Our server pushes a packet to </span><span class="line" data-startTime="2070">the mobile carrier. It hits the packet gateway. </span> <span class="line" data-startTime="2076">That goes to the serving gateway. The serving </span><span class="line" data-startTime="2076">gateway, once again, has no idea where you </span><span class="line" data-startTime="2081">are. Right? Once of the nice properties in </span><span class="line" data-startTime="2081">mobile networks, you guys are mobile. You </span><span class="line" data-startTime="2084">hop into a car accident now you are on your </span><span class="line" data-startTime="2084">way out of San Francisco. We have no idea </span><span class="line" data-startTime="2088">where you are. The serving gateway talks to </span><span class="line" data-startTime="2088">the mobility management here and it says, </span><span class="line" data-startTime="2094">okay, I need to send this packet to this user. </span></p>

<p><span class="line" data-startTime="2094">Tell me where to forward the packet to. The </span><span class="line" data-startTime="2099">mobility interface doesn't actually know your </span><span class="line" data-startTime="2099">current physical location. It knows geographically </span><span class="line" data-startTime="2105">where you are. Okay, last time he checked </span><span class="line" data-startTime="2105">in, he was in San Francisco. So it sends a </span><span class="line" data-startTime="2110">ping to all of the radio towers in the vicinity </span><span class="line" data-startTime="2110">and says just flood the entire network with </span><span class="line" data-startTime="2115">a beacon that says, hey you, user number blah </span><span class="line" data-startTime="2115">blah blah, there's a packet waiting for you. </span> <span class="line" data-startTime="2121">Identify yourself, please. Your radio wakes </span><span class="line" data-startTime="2121">up. It gets that packet. It then talks to </span><span class="line" data-startTime="2126">the tower and says, I'm here. I'm associated </span><span class="line" data-startTime="2126">with you right now. That data gets transferred </span><span class="line" data-startTime="2132">back, goes back to the serving gateway and </span><span class="line" data-startTime="2132">now can transfer the data back to the tower </span><span class="line" data-startTime="2136">and to your device. This is pretty complicated, </span><span class="line" data-startTime="2136">right? The reason I'm pointing this out is </span><span class="line" data-startTime="2143">oftentimes there's a question of, like, why </span><span class="line" data-startTime="2143">does it take 200 milliseconds to do this? </span><span class="line" data-startTime="2147">But clearly this is a pretty complicated problem </span><span class="line" data-startTime="2147">to solve, right? So the fact that we can do </span><span class="line" data-startTime="2151">this in 40 to 50 milliseconds in 4G is actually </span><span class="line" data-startTime="2151">rather impressive to be honest. </span> <span class="line" data-startTime="2158">All right, so, this is a little crazy. But </span><span class="line" data-startTime="2158">is it worth it? I think this is a valid question </span><span class="line" data-startTime="2166">to ask. We went from Wi-Fi where we had nothing. </span></p>

<p><span class="line" data-startTime="2166">Right? We had just talk. We hoped for the </span><span class="line" data-startTime="2171">best. Cross our fingers. We went to this 4G </span><span class="line" data-startTime="2171">network interface where we now have all these </span><span class="line" data-startTime="2176">routers. Radio towers talking to each other. </span> <span class="line" data-startTime="2176">It's all crazy. Where are we going? So this </span><span class="line" data-startTime="2185">is a great case study that was done a couple </span><span class="line" data-startTime="2185">years back actually in 2011. Where they measured </span><span class="line" data-startTime="2192">performance of Wi-Fi networks, typical whole </span><span class="line" data-startTime="2192">router networks. I think this was 802.11G, </span><span class="line" data-startTime="2200">so fairly new standard. They compared it against </span><span class="line" data-startTime="2200">LTE. So just focus on these two clusters here. </span> <span class="line" data-startTime="2207">What I want to point out, first of all the </span><span class="line" data-startTime="2207">through put is better. Most importantly is </span><span class="line" data-startTime="2212">this graph right here, the round trip time </span><span class="line" data-startTime="2212">for our packets. With Wi-Fi, there's no guaranties </span><span class="line" data-startTime="2221">about the latency of the delivery of your </span><span class="line" data-startTime="2221">packets. That's why you have these giant tails </span><span class="line" data-startTime="2226">here. Generally speaking, the latency is fairly </span><span class="line" data-startTime="2226">low. But then you have these outliers which </span><span class="line" data-startTime="2231">is why this line is stretched. With LTE, even </span><span class="line" data-startTime="2231">though it is seemingly more complicated &mdash; not </span><span class="line" data-startTime="2238">seemingly, it is more complicated, we can </span><span class="line" data-startTime="2238">deliver more reliable latency and lower jitter </span><span class="line" data-startTime="2244">across the network. So this is good. Right? </span><span class="line" data-startTime="2244">This is, like, great. 4G will make things </span><span class="line" data-startTime="2252">better. </span> <span class="line" data-startTime="2252">So a couple of things. Mobile radio is optimized </span><span class="line" data-startTime="2261">for burst data transfers. It is not optimized </span><span class="line" data-startTime="2261">for sending bits in small chunks, right? If </span><span class="line" data-startTime="2270">what you want to do is transfer as much data </span><span class="line" data-startTime="2270">as possible and then turn off the radio. In </span><span class="line" data-startTime="2275">fact, the latest 4G networks can transfer </span><span class="line" data-startTime="2275">on the order of tens of megabits per second, </span><span class="line" data-startTime="2282">which is really high data rates. But it will </span><span class="line" data-startTime="2282">do so in very small assignments. In fact, </span><span class="line" data-startTime="2288">the bandwidth assignments are done in millisecond </span><span class="line" data-startTime="2288">and lower chunks. All right? So you get a </span><span class="line" data-startTime="2293">chunk of space, air space, for about one millisecond. </span></p>

<p><span class="line" data-startTime="2293">You can transfer huge amounts of data. So </span><span class="line" data-startTime="2298">pack as much data as you can. Group your requests. </span> <span class="line" data-startTime="2298">Don't delay requests. The not so good news </span><span class="line" data-startTime="2307">part of the 4G world is that 4G will take </span><span class="line" data-startTime="2307">a while to come. Despite the fact that there </span><span class="line" data-startTime="2314">is ads everywhere across all the highways </span><span class="line" data-startTime="2314">and everywhere else that 4G will save all </span><span class="line" data-startTime="2319">things, 4G will take a while to deploy. Current </span><span class="line" data-startTime="2319">carriers have deployed a lot of infrastructure </span><span class="line" data-startTime="2325">for 3G and they are continuing to improve </span><span class="line" data-startTime="2325">that in part because they can and in part </span><span class="line" data-startTime="2330">because it's very expensive. So the dominant </span><span class="line" data-startTime="2330">network type of this decade &mdash; not just this </span><span class="line" data-startTime="2336">year or in the coming year &mdash; of this decade </span><span class="line" data-startTime="2336">will be 3G networks. Granted, they are being </span><span class="line" data-startTime="2342">enhanced to deliver higher data rates. But </span><span class="line" data-startTime="2342">nevertheless, you can see overall growth projections </span><span class="line" data-startTime="2349">are for 3G networks. The good news is, at </span><span class="line" data-startTime="2349">least within North America, LTE and HSPA, </span><span class="line" data-startTime="2355">which are 4G networks, are actually taking </span><span class="line" data-startTime="2355">off quite well. In fact, we are way ahead </span><span class="line" data-startTime="2359">of the curve compared to all the other countries. </span> <span class="line" data-startTime="2359">But nonetheless, you have to basically assume </span><span class="line" data-startTime="2365">that your users will be using a mix of 3G </span><span class="line" data-startTime="2365">and 4G networks. Right? Even if you have a </span><span class="line" data-startTime="2371">4G network data plan on your phone, your phone </span><span class="line" data-startTime="2371">is switching between 4G and 3G all the time </span><span class="line" data-startTime="2379">and depending on coverage or where you currently </span><span class="line" data-startTime="2379">are and load within the network. So because </span><span class="line" data-startTime="2385">of that, you have to design for variable network </span><span class="line" data-startTime="2385">performance and availability. It is truly </span><span class="line" data-startTime="2391">a multi-generation future. You can't assume </span><span class="line" data-startTime="2391">that you will get great performance with 4G. </span></p>

<p><span class="line" data-startTime="2396">You need to plan for 3G networks as well. </span> <span class="line" data-startTime="2396">Bandwidth and latency are variable and, of </span><span class="line" data-startTime="2401">course, as we have all experienced, connectivity </span><span class="line" data-startTime="2401">is intermittent. So if you are building a </span><span class="line" data-startTime="2406">mobile application or an application for the </span><span class="line" data-startTime="2406">mobile web, you have to assume that there </span><span class="line" data-startTime="2411">should be an offline mode or some fallback </span><span class="line" data-startTime="2411">to say what happens when I can't actually </span><span class="line" data-startTime="2419">connect. And I mentioned this before, but </span><span class="line" data-startTime="2419">I think this is an important point to make </span><span class="line" data-startTime="2425">once again. You should have some sort of a </span><span class="line" data-startTime="2425">back-off strategy. Oftentimes the reason we </span><span class="line" data-startTime="2434">have poor battery performance is because some </span><span class="line" data-startTime="2434">application does not plan for intermittent </span><span class="line" data-startTime="2441">connectivity or the fact that there is no </span><span class="line" data-startTime="2441">connectivity and it just continues to pull </span><span class="line" data-startTime="2445">the server to say, are you there yet? Are </span><span class="line" data-startTime="2445">you there yet? Are you there yet? And that's </span><span class="line" data-startTime="2450">what's burning your leg and burning the battery </span><span class="line" data-startTime="2450">on your device. What you want to do instead </span><span class="line" data-startTime="2456">is to say, I'm going to try to connect now </span><span class="line" data-startTime="2456">and then every time I fail, I will just punt </span><span class="line" data-startTime="2463">further out into the future, have some sort </span><span class="line" data-startTime="2463">of a decay function, and then say I'm going </span><span class="line" data-startTime="2467">to stop after this interval and retry later. </span> <span class="line" data-startTime="2467">Nine cases out of ten, whenever I have a performance </span><span class="line" data-startTime="2473">or battery life program, I track it down to </span><span class="line" data-startTime="2473">exactly this. It's some application that's </span><span class="line" data-startTime="2477">just sitting there in the loop while not connected, </span><span class="line" data-startTime="2477">keep trying, right? Not a good strategy. </span></p>

<p><span class="line" data-startTime="2487">So with that, I think we've gone through kind </span><span class="line" data-startTime="2487">of the full cycle and we're back to application </span><span class="line" data-startTime="2493">best practices. Of course, all of the radio </span><span class="line" data-startTime="2493">stuff is very important but optimizing TCP </span><span class="line" data-startTime="2499">best practices, TLS, and http is very important. </span> <span class="line" data-startTime="2499">The take-away here is, of course, measure </span><span class="line" data-startTime="2504">first. Make sure that you are using a real </span><span class="line" data-startTime="2504">user measurement and measuring performance </span><span class="line" data-startTime="2508">across real networks. Do that first, then </span><span class="line" data-startTime="2508">optimize later. And I'll just call out an </span><span class="line" data-startTime="2514">couple of examples. Fastest request is a request </span><span class="line" data-startTime="2514">not made. This is an obvious one. But turns </span><span class="line" data-startTime="2522">out when we analyze a lot of mobile applications, </span><span class="line" data-startTime="2522">they are not caching data. This is like number </span><span class="line" data-startTime="2527">one problem for a lot of applications. So </span><span class="line" data-startTime="2527">make sure you do that. Bytes are literally </span><span class="line" data-startTime="2532">expensive for a lot of users. You need to </span><span class="line" data-startTime="2532">compress resources and it's funny because </span><span class="line" data-startTime="2537">we have been talking about compressing resources, </span><span class="line" data-startTime="2537">compressing images for years but we still </span><span class="line" data-startTime="2541">find that a lot of applications don't do it. </span> <span class="line" data-startTime="2541">And of course, leveraging performance like </span><span class="line" data-startTime="2546">WebP as you heard in the keynote. We had a </span><span class="line" data-startTime="2546">session earlier today in WebP, I definitely </span><span class="line" data-startTime="2551">encourage you to try it both on web and native. </span></p>

<p><span class="line" data-startTime="2551">And then finally, a shameless self-promotion. </span> <span class="line" data-startTime="2559">I have been writing a book on this stuff and </span><span class="line" data-startTime="2559">specifically on mobile radio performance and </span><span class="line" data-startTime="2565">other things and it's available online for </span><span class="line" data-startTime="2565">free. If you guys are curious to learn more </span><span class="line" data-startTime="2568">about this, and I can talk about it all day, </span><span class="line" data-startTime="2568">please check it out and please offer feedback. </span> <span class="line" data-startTime="2573">You can actually comment right on it. </span> <span class="line" data-startTime="2573">And with that, I think we have some time for </span><span class="line" data-startTime="2579">questions. If you can grab one of the mics, </span><span class="line" data-startTime="2579">I would be happy to answer them. </span> <span class="line" data-startTime="2585">[ Applause ] </span></p>

<p class="speaker"><span class="line" data-starttime="2585"><span class="speakerName">Audience member</span>: My name is Mauricio. I work for Verizon </span><span class="line" data-startTime="2604">wireless. I have a question regarding APIs </span><span class="line" data-startTime="2604">or services that can be provided by Google </span><span class="line" data-startTime="2613">&mdash; the Android framework itself to help verticals </span><span class="line" data-startTime="2613">to make application more efficient. For example, </span><span class="line" data-startTime="2618">the same way today does not allow you to put </span><span class="line" data-startTime="2618">network accessing your main thread. Is there </span><span class="line" data-startTime="2626">anything planned to do in that manner? </span></p>

<p class="speaker"><span class="line" data-starttime="2626"><span class="speakerName">Ilya Grigorik</span>: So I can't &mdash; &mdash; I'm more </span><span class="line" data-startTime="2633">&mdash; I have more experience with the web part </span><span class="line" data-startTime="2633">of the stack so I can't necessarily comment </span><span class="line" data-startTime="2636">on the Android part. I would actually direct </span><span class="line" data-startTime="2636">you to the Android guys sitting outside for </span><span class="line" data-startTime="2642">that. But something like GCM, we continue </span><span class="line" data-startTime="2642">to enhance GCM, or the Google Cloud Messaging, </span><span class="line" data-startTime="2650">and that's what you want to use for a lot </span><span class="line" data-startTime="2650">of your communication. Just recently we announced </span><span class="line" data-startTime="2653">the ability to actually send data through </span><span class="line" data-startTime="2653">GCM as well. </span></p>

<p class="speaker"><span class="line" data-starttime="2657"><span class="speakerName">Audience member</span>: Thank you. </span></p>

<p class="speaker"><span class="line" data-starttime="2657"><span class="speakerName">Audience member</span>: So my understanding of why LT is much </span><span class="line" data-startTime="2663">better is partially because of the modulation </span><span class="line" data-startTime="2663">that it uses, since LT uses RFDM and Wi-Fi </span><span class="line" data-startTime="2671">uses something different. Do you know if there's </span><span class="line" data-startTime="2671">any, like, industry trends to move the modulation </span><span class="line" data-startTime="2677">scheme of the access points that you might </span><span class="line" data-startTime="2677">have at home to use that technology over, </span><span class="line" data-startTime="2683">you know, what we have today since it's so </span><span class="line" data-startTime="2683">jittery. </span></p>

<p class="speaker"><span class="line" data-starttime="2686"><span class="speakerName">Ilya Grigorik</span>: There's a couple of questions </span><span class="line" data-startTime="2686">in there. So LT has a host of different improvements. </span> <span class="line" data-startTime="2692">So they are basically redesigning the network </span><span class="line" data-startTime="2692">from the ground up. They are moving the scheduling </span><span class="line" data-startTime="2696">stuff into the edges of the network. They </span><span class="line" data-startTime="2696">are using a new modulation scheme as you described. </span> <span class="line" data-startTime="2700">It's not just a modulation. Right? Because </span><span class="line" data-startTime="2700">that helps you with through-put but there's </span><span class="line" data-startTime="2705">a number of other variables. Energy used, </span><span class="line" data-startTime="2705">latency of the assumption, connection, all </span><span class="line" data-startTime="2710">the rest. For moving that same technology </span><span class="line" data-startTime="2710">into, let's say, your local access points, </span><span class="line" data-startTime="2716">yes, to some degree. Wi-Fi standards and LTE </span><span class="line" data-startTime="2716">or 3GPP standards are completely separate. </span> <span class="line" data-startTime="2723">But just watching both of them, they do borrow </span><span class="line" data-startTime="2723">and steal from each other. So with the latest </span><span class="line" data-startTime="2729">Wi-Fi standards, you will find that the way </span><span class="line" data-startTime="2729">they are &mdash; the way they are achieving gigabyte </span><span class="line" data-startTime="2733">data rates is by using the same tricks to </span><span class="line" data-startTime="2733">a large degree. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="2737"><span class="speakerName">Audience member</span>: Do you know if that's in ADT2C or &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2737"><span class="speakerName">Ilya Grigorik</span>: Yeah, that's in part how </span><span class="line" data-startTime="2741">&mdash; yeah, exactly. Audience member: Thank you. </span></p>

<p class="speaker"><span class="line" data-starttime="2741"><span class="speakerName">Audience member</span>: I'm fairly new to Android development. </span><span class="line" data-startTime="2746">This may have been covered in the Cloud Messaging </span><span class="line" data-startTime="2746">feature. I was just wondering, is there any </span><span class="line" data-startTime="2753">currently or plans to provide support for </span><span class="line" data-startTime="2753">aggregating requests from the OS level or </span><span class="line" data-startTime="2760">framework to, you know, if you have multiple </span><span class="line" data-startTime="2760">apps running that have a stupid beacon request, </span><span class="line" data-startTime="2765">is there any support for, like, ganging these </span><span class="line" data-startTime="2765">together so multiple apps kind of work with </span><span class="line" data-startTime="2771">each other instead of against each other to </span><span class="line" data-startTime="2771">reduce radio usage? </span></p>

<p class="speaker"><span class="line" data-starttime="2773"><span class="speakerName">Ilya Grigorik</span>: That's something definitely </span><span class="line" data-startTime="2773">we are looking at. That is only something </span><span class="line" data-startTime="2778">the platform can provide. As an application </span><span class="line" data-startTime="2778">designer, you can't control what the other </span><span class="line" data-startTime="2782">applications are doing. This is definitely </span><span class="line" data-startTime="2782">something we are thinking about both on the </span><span class="line" data-startTime="2787">web, like, on Chrome for example, how can </span><span class="line" data-startTime="2787">Chrome leverage something like this, and also </span><span class="line" data-startTime="2792">with the Android platform. A good example </span><span class="line" data-startTime="2792">of this is turning off the radio early. Like </span><span class="line" data-startTime="2797">if we know that there's no other connections </span><span class="line" data-startTime="2797">being made, we can terminate the connections </span><span class="line" data-startTime="2802">early. That can be done by the operating system </span><span class="line" data-startTime="2802">in conjunction with the radio resource controller. </span><span class="line" data-startTime="2807">So, yes, there's definitely work in that direction. </span></p>

<p class="speaker"><span class="line" data-starttime="2807"><span class="speakerName">Audience member</span>: So that's nothing current but it's in </span><span class="line" data-startTime="2812">the works? </span></p>

<p class="speaker"><span class="line" data-starttime="2812"><span class="speakerName">Ilya Grigorik</span>: Yep. </span></p>

<p class="speaker"><span class="line" data-starttime="2815"><span class="speakerName">Audience member</span>: Do you have recommendations for tools </span><span class="line" data-startTime="2815">to just as a user to help figure out, like, </span><span class="line" data-startTime="2819">what's killing your battery on iOS and Android? </span></p>

<p class="speaker"><span class="line" data-starttime="2819"><span class="speakerName">Ilya Grigorik</span>: So I hope we make that tooling </span><span class="line" data-startTime="2825">much better. I guess a couple of tips that </span><span class="line" data-startTime="2825">I use. One is you actually have the battery </span><span class="line" data-startTime="2830">panel within Android. If you go into your </span><span class="line" data-startTime="2830">settings and kind of navigate down, it actually </span><span class="line" data-startTime="2835">gives you a really good breakdown of which </span><span class="line" data-startTime="2835">applications consume power. If you click on </span><span class="line" data-startTime="2839">the graph, it will also show you a breakdown </span><span class="line" data-startTime="2839">of when the power is being consumed. So I </span><span class="line" data-startTime="2843">find that is the most effective way to identify </span><span class="line" data-startTime="2843">specific applications. I think we need to </span><span class="line" data-startTime="2849">do more to isolate, like, at a web page level, </span><span class="line" data-startTime="2849">there's nothing really like that. And I think </span><span class="line" data-startTime="2854">we need something like that. So I hope we </span><span class="line" data-startTime="2854">will have a better answer in a year's time. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="2860"><span class="speakerName">Audience member</span>: Hi, could you talk a little bit about </span><span class="line" data-startTime="2860">strategies you would use for games because </span><span class="line" data-startTime="2866">they have a completely different data access </span><span class="line" data-startTime="2866">pattern and they typically [indiscernable] </span><span class="line" data-startTime="2872">instead of TCP and require lower latency in </span><span class="line" data-startTime="2872">case you are playing with someone else. </span></p>

<p class="speaker"><span class="line" data-starttime="2877"><span class="speakerName">Ilya Grigorik</span>: So all of the same optimization </span><span class="line" data-startTime="2877">strategies apply there. Intermittent, it doesn't </span><span class="line" data-startTime="2881">matter if it CCP, TCP. You need to wake up </span><span class="line" data-startTime="2881">the radio. So to the extent possible, you </span><span class="line" data-startTime="2886">want to aggregate data. You don't want to </span><span class="line" data-startTime="2886">be beaconing back every single achievement </span><span class="line" data-startTime="2890">unlocked by the user if that can be kept on </span><span class="line" data-startTime="2890">the device. So once again, leveraging things </span><span class="line" data-startTime="2897">like GCM and others to aggregate that data, </span><span class="line" data-startTime="2897">it's all the same. The protocol doesn't actually </span><span class="line" data-startTime="2902">matter. </span></p>

<p class="speaker"><span class="line" data-starttime="2902"><span class="speakerName">Audience member</span>: Hi, as a JavaScript developer, the best </span><span class="line" data-startTime="2908">practice as you said is to batch API requests </span><span class="line" data-startTime="2908">or other requests. And could you comment on </span><span class="line" data-startTime="2913">the beacon API which would help us tap into </span><span class="line" data-startTime="2913">actually when the radio is active. </span></p>

<p class="speaker"><span class="line" data-starttime="2918"><span class="speakerName">Ilya Grigorik</span>: The beacon API? Are you talking </span><span class="line" data-startTime="2918">about the new proposal? </span></p>

<p class="speaker"><span class="line" data-starttime="2923"><span class="speakerName">Audience member</span>: Yeah, and then what the status of that </span><span class="line" data-startTime="2923">is. </span></p>

<p class="speaker"><span class="line" data-starttime="2925"><span class="speakerName">Ilya Grigorik</span>: Yeah. So in the http performance </span><span class="line" data-startTime="2925">working group, we are working on a couple </span><span class="line" data-startTime="2930">of proposals I guess. One is the beacon API </span><span class="line" data-startTime="2930">which is to say I want you to send this request </span><span class="line" data-startTime="2935">but I don't actually care when you send it, </span><span class="line" data-startTime="2935">just send it when it's convenient for you. </span><span class="line" data-startTime="2940">Good example of that is Analytics beacons. </span><span class="line" data-startTime="2940">Right? You don't want to wake up the radio </span><span class="line" data-startTime="2944">right now. You are saying defer this. Dispatch </span><span class="line" data-startTime="2944">it at some later time. So there's no implementation </span><span class="line" data-startTime="2950">of that yet. We have early drafts of the spec. </span><span class="line" data-startTime="2950">If you guys are interested, I definitely encourage </span><span class="line" data-startTime="2955">you to check out the working group and comment </span><span class="line" data-startTime="2955">on it. But hopefully soon we will have something. </span></p>

<p class="speaker"><span class="line" data-starttime="2961"><span class="speakerName">Audience member</span>: Okay, thanks. </span></p>

<p class="speaker"><span class="line" data-starttime="2961"><span class="speakerName">Audience member</span>: Can you talk about what tools you use </span><span class="line" data-startTime="2965">to look at your Wi-Fi networks in those slides? </span></p>

<p class="speaker"><span class="line" data-starttime="2965"><span class="speakerName">Ilya Grigorik</span>: What is the tool that I used </span><span class="line" data-startTime="2971">in &mdash; I don't remember off the top of my head. </span><span class="line" data-startTime="2971">If you talk to me afterwards, I can find it </span><span class="line" data-startTime="2975">on my laptop. </span></p>

<p class="speaker"><span class="line" data-starttime="2975"><span class="speakerName">Audience member</span>: I have a question about Analytics. What </span><span class="line" data-startTime="2981">solutions are you currently [indiscernible] </span><span class="line" data-startTime="2981">not to lose the data value and to reduce the </span><span class="line" data-startTime="2988">page rate consumption? </span></p>

<p class="speaker"><span class="line" data-starttime="2988"><span class="speakerName">Ilya Grigorik</span>: So for Analytics, what you </span><span class="line" data-startTime="2993">generally want to do &mdash; so this is actually </span><span class="line" data-startTime="2993">related to the previous question about the </span><span class="line" data-startTime="2995">beacon API. Oftentimes you can report the </span><span class="line" data-startTime="2995">data later. One strategy is to literally stash </span><span class="line" data-startTime="3002">the data into your local database and then </span><span class="line" data-startTime="3002">report it when the radio is active. This requires </span><span class="line" data-startTime="3006">some modifications of your application itself. </span><span class="line" data-startTime="3006">But, for example, on the realtime Analytics, </span><span class="line" data-startTime="3013">we don't actually ping back every so often </span><span class="line" data-startTime="3013">to just say that you are there. We actually </span><span class="line" data-startTime="3021">do the realtime Analytics differently which </span><span class="line" data-startTime="3021">is to say, we track when you first visit the </span><span class="line" data-startTime="3026">page, which is when you hit that beacon. And </span><span class="line" data-startTime="3026">then we say that you are active on the page </span><span class="line" data-startTime="3032">for the next 30 seconds. Right? You have to </span><span class="line" data-startTime="3032">be &mdash; if you navigate to another page, then </span><span class="line" data-startTime="3037">you are still active. We are not forcing this </span><span class="line" data-startTime="3037">five-second interval. I think we need to talk </span><span class="line" data-startTime="3043">to the other vendors and get them to move </span><span class="line" data-startTime="3043">in the same direction. They are literally </span><span class="line" data-startTime="3048">costing a lot in terms of performance. </span></p>

<p class="speaker"><span class="line" data-starttime="3048"><span class="speakerName">Audience member</span>: And about Google Analytics, an additional </span><span class="line" data-startTime="3052">question. Will it be a separate API extended </span><span class="line" data-startTime="3052">for request bulking? </span></p>

<p class="speaker"><span class="line" data-starttime="3056"><span class="speakerName">Ilya Grigorik</span>: Can you say that again? </span></p>

<p class="speaker"><span class="line" data-starttime="3056"><span class="speakerName">Audience member</span>: So for example, we start an activity and </span><span class="line" data-startTime="3063">we are reporting the user, when there is a </span><span class="line" data-startTime="3063">start of activity and when he left it. And </span><span class="line" data-startTime="3068">there is a chain of that event. And will the </span><span class="line" data-startTime="3068">API Google Analytics extend it so we can bufferize </span><span class="line" data-startTime="3075">this like to put a buffer and report later. </span></p>

<p class="speaker"><span class="line" data-starttime="3075"><span class="speakerName">Ilya Grigorik</span>: That's a great idea. There's </span><span class="line" data-startTime="3081">ways to tackle that. Google Analytics can </span><span class="line" data-startTime="3081">provide a new API to basically say stash this </span><span class="line" data-startTime="3086">and remember later. You can implement your </span><span class="line" data-startTime="3086">own wrap around it and basically say I am </span><span class="line" data-startTime="3090">going to fire this later when I consider that </span><span class="line" data-startTime="3090">it is active. The best approach, I think, </span><span class="line" data-startTime="3096">is a combination of two which is the beacon </span><span class="line" data-startTime="3096">API that we were just talking about which </span><span class="line" data-startTime="3101">is basically a browser mechanism to say, we </span><span class="line" data-startTime="3101">will defer this to the browser to determine </span><span class="line" data-startTime="3106">because it's actually in the best position. </span><span class="line" data-startTime="3106">So today the fastest way to get what you are </span><span class="line" data-startTime="3111">talking about is to implement the new application. </span><span class="line" data-startTime="3111">I can certainly talk to the Google Analytics </span><span class="line" data-startTime="3115">team and see if there is interest in implementing </span><span class="line" data-startTime="3115">something like this. I think that's a great </span><span class="line" data-startTime="3120">idea. Maybe in a year's time we will have </span><span class="line" data-startTime="3120">something like the beacon Analytics. </span></p>

<p class="speaker"><span class="line" data-starttime="3124"><span class="speakerName">Audience member</span>: We are way over. We are going to need </span><span class="line" data-startTime="3124">to wrap up. </span></p>

<p class="speaker"><span class="line" data-starttime="3128"><span class="speakerName">Ilya Grigorik</span>: Okay, one more. </span></p>

<p class="speaker"><span class="line" data-starttime="3128"><span class="speakerName">Audience member</span>: My question is related to the Nexus 4. </span><span class="line" data-startTime="3133">I have always used Verizon, I have never had </span><span class="line" data-startTime="3133">any signal reception issues until I switched </span><span class="line" data-startTime="3138">to T-Mobile. At my house on the first floor, </span><span class="line" data-startTime="3138">I only get edge. On the second floor, I get </span><span class="line" data-startTime="3148">edge but it's if-y. On the third floor, I </span><span class="line" data-startTime="3148">will get edge and HSPA+. This is the thing, </span><span class="line" data-startTime="3156">with this phone, the decibel rating, from </span><span class="line" data-startTime="3156">what I'm reading, is like around a hundred. </span><span class="line" data-startTime="3161">If I hold the phone in my hand, I lose signal. </span></p>

<p class="speaker"><span class="line" data-starttime="3161"><span class="speakerName">Ilya Grigorik</span>: Yep. You're holding it wrong. </span><span class="line" data-startTime="3166">[ Laughter ] </span></p>

<p class="speaker"><span class="line" data-starttime="3166"><span class="speakerName">Audience member</span>: But this is the thing, if I'm on a phone </span><span class="line" data-startTime="3169">call and then I hold it, it doesn't drop signal. </span><span class="line" data-startTime="3169">So my question is, is there a way that I, </span><span class="line" data-startTime="3175">as an end user, can make the phone put more </span><span class="line" data-startTime="3175">power into the radio to hold the signal? Because </span><span class="line" data-startTime="3181">I can't change T-Mobile. </span></p>

<p class="speaker"><span class="line" data-starttime="3181"><span class="speakerName">Ilya Grigorik</span>: So the short answer is no. </span><span class="line" data-startTime="3186">The energy use is actually dictated by the </span><span class="line" data-startTime="3186">radio tower. It actually tells you, depending </span><span class="line" data-startTime="3190">on where you are, like the distance between </span><span class="line" data-startTime="3190">you and the radio tower. The amount of other </span><span class="line" data-startTime="3194">people talking. The exact signal power that </span><span class="line" data-startTime="3194">you should be transmitting. So, in fact, radio </span><span class="line" data-startTime="3199">tower is trying to help you optimize your </span><span class="line" data-startTime="3199">battery use. Which sounds like, in this case, </span><span class="line" data-startTime="3203">it may be working against you. But there's </span><span class="line" data-startTime="3203">no explicit control of that, unfortunately. </span></p>

<p class="speaker"><span class="line" data-starttime="3208"><span class="speakerName">Audience member</span>: Thank you. </span></p>

<p class="speaker"><span class="line" data-starttime="3208"><span class="speakerName">Ilya Grigorik</span>: Thank, thanks guys. </span><span class="line" data-startTime="3211">[ Applause ] </span></p>