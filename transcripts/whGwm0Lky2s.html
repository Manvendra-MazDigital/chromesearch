<p><span class="line" data-startTime="9">Hey everybody. </span> <span class="line" data-startTime="10">Welcome to another </span><span class="line" data-startTime="10">fantastic episode </span><span class="line" data-startTime="12">of Google Developers Live, </span><span class="line" data-startTime="12">where we here at Google </span><span class="line" data-startTime="16">get a chance to talk to you </span><span class="line" data-startTime="16">about all the amazing things </span><span class="line" data-startTime="18">going on on the web, in the </span><span class="line" data-startTime="18">tech, and all the platforms </span><span class="line" data-startTime="21">and the fantastic things </span><span class="line" data-startTime="21">you can do with it. </span> <span class="line" data-startTime="23">My name is Colt McAnlis. </span> <span class="line" data-startTime="24">I'm a developer advocate </span><span class="line" data-startTime="24">here on the Chrome team, </span><span class="line" data-startTime="27">and I mostly work with web </span><span class="line" data-startTime="27">performance issues as well as </span><span class="line" data-startTime="30">web gaming. </span> <span class="line" data-startTime="31">Now, what I'd like </span><span class="line" data-startTime="31">to talk to you today </span><span class="line" data-startTime="33">about is something </span><span class="line" data-startTime="33">that's very near and dear </span><span class="line" data-startTime="35">and close to my heart, </span><span class="line" data-startTime="35">and that's compression. </span> <span class="line" data-startTime="38">Today, we're going to be talking </span><span class="line" data-startTime="38">about GZIP on the web platform </span><span class="line" data-startTime="41">and how you can modify it </span><span class="line" data-startTime="41">and address it and munge </span><span class="line" data-startTime="45">it to try to minimize your </span><span class="line" data-startTime="45">website memory footprint </span><span class="line" data-startTime="48">and actually get </span><span class="line" data-startTime="48">faster loading data. </span> <span class="line" data-startTime="50">Now, before we get into </span><span class="line" data-startTime="50">this talk too much, </span><span class="line" data-startTime="52">I'd actually like to point </span><span class="line" data-startTime="52">out the #perfmatters hashtag. </span></p>

<p><span class="line" data-startTime="55">This is a fantastic </span><span class="line" data-startTime="55">hashtag that's </span><span class="line" data-startTime="57">being used all </span><span class="line" data-startTime="57">around the intertubes </span><span class="line" data-startTime="59">on various social networks </span><span class="line" data-startTime="59">for people in web performance </span><span class="line" data-startTime="62">who are trying to </span><span class="line" data-startTime="62">find the same problems </span><span class="line" data-startTime="64">and address difficult issues </span><span class="line" data-startTime="64">and have conversations </span><span class="line" data-startTime="67">about performance in </span><span class="line" data-startTime="67">interesting and insightful ways. </span> <span class="line" data-startTime="70">So use this hashtag. </span> <span class="line" data-startTime="71">If anything during this talk </span><span class="line" data-startTime="71">is interesting or inspiring, </span><span class="line" data-startTime="74">feel free to go to your favorite </span><span class="line" data-startTime="74">social media network of choice. </span> <span class="line" data-startTime="77">It's a fantastic outlet, and </span><span class="line" data-startTime="77">you need to be following it. </span></p>

<p><span class="line" data-startTime="80">So with that, let's </span><span class="line" data-startTime="80">get into things. </span> <span class="line" data-startTime="83">So let's start at the beginning. </span> <span class="line" data-startTime="84">I can't really talk about </span><span class="line" data-startTime="84">compression on the web </span><span class="line" data-startTime="86">without actually taking a look </span><span class="line" data-startTime="86">at the state of the web today. </span> <span class="line" data-startTime="89">Now, besides being </span><span class="line" data-startTime="89">filled with cats, </span><span class="line" data-startTime="91">there's actually some </span><span class="line" data-startTime="91">interesting data out there </span><span class="line" data-startTime="93">for us to look at. </span> <span class="line" data-startTime="95">There's a great site </span><span class="line" data-startTime="95">called httparchive.org, </span><span class="line" data-startTime="97">and what this site </span><span class="line" data-startTime="97">will do is actually </span><span class="line" data-startTime="99">run large amounts of website </span><span class="line" data-startTime="99">through processing filters </span><span class="line" data-startTime="102">during the day. </span> <span class="line" data-startTime="103">So what will happen </span><span class="line" data-startTime="103">is they'll take </span><span class="line" data-startTime="104">300,000, 400,000 </span><span class="line" data-startTime="104">very common websites, </span><span class="line" data-startTime="107">run them through a </span><span class="line" data-startTime="107">processing system, </span><span class="line" data-startTime="109">and then scrape </span><span class="line" data-startTime="109">information about them </span><span class="line" data-startTime="111">to present on their page. </span> <span class="line" data-startTime="112">Now, what you can see </span><span class="line" data-startTime="112">here in this graph </span><span class="line" data-startTime="115">is actually one of the </span><span class="line" data-startTime="115">latest studies that </span><span class="line" data-startTime="117">shows the average bytes of </span><span class="line" data-startTime="117">a page per content type. </span></p>

<p><span class="line" data-startTime="120">So what this graph </span><span class="line" data-startTime="120">shows us is that images, </span><span class="line" data-startTime="123">for an average site, </span><span class="line" data-startTime="123">actually take up </span><span class="line" data-startTime="126">the lion's share of the content </span><span class="line" data-startTime="126">that's being streamed to users. </span> <span class="line" data-startTime="130">In fact, it's more than 50%. </span> <span class="line" data-startTime="132">It's actually a massive amount </span><span class="line" data-startTime="132">of the content being delivered, </span><span class="line" data-startTime="136">while scripts actually remain </span><span class="line" data-startTime="136">the second largest, ending up </span><span class="line" data-startTime="138">at around 260k or so. </span> <span class="line" data-startTime="141">Now, the interesting </span><span class="line" data-startTime="141">thing about this </span><span class="line" data-startTime="142">is when you look at the </span><span class="line" data-startTime="142">individual response sizes, </span><span class="line" data-startTime="145">you see a similar </span><span class="line" data-startTime="145">trend, of course, </span><span class="line" data-startTime="148">Flash being one of the largest </span><span class="line" data-startTime="148">sizes per number of responses. </span> <span class="line" data-startTime="153">But of course, that </span><span class="line" data-startTime="153">comes down to the fact </span><span class="line" data-startTime="154">that you generally only have one </span><span class="line" data-startTime="154">or two flashes per page where </span><span class="line" data-startTime="159">they tend to be pretty large, </span><span class="line" data-startTime="159">whereas JavaScript or PNGs </span><span class="line" data-startTime="163">or JPEGs tend to be lots </span><span class="line" data-startTime="163">of requests for a page. </span></p>

<p><span class="line" data-startTime="165">That actually drives </span><span class="line" data-startTime="165">that number down. </span> <span class="line" data-startTime="167">So what we're looking </span><span class="line" data-startTime="167">at here is basically </span><span class="line" data-startTime="169">a vision of the web that shows </span><span class="line" data-startTime="169">that we're dominated by images </span><span class="line" data-startTime="173">and we're dominated </span><span class="line" data-startTime="173">by image data. </span> <span class="line" data-startTime="175">But I'm not </span><span class="line" data-startTime="175">necessarily sure that </span><span class="line" data-startTime="176">means that we can give up on </span><span class="line" data-startTime="176">trying to minimize and reduce </span><span class="line" data-startTime="180">the size of the text data </span><span class="line" data-startTime="180">that actually drives our web. </span> <span class="line" data-startTime="183">So let's take a look at this. </span> <span class="line" data-startTime="184">This is another great set </span><span class="line" data-startTime="184">of charts from HTTP Archive. </span> <span class="line" data-startTime="187">And effectively, what </span><span class="line" data-startTime="187">you're looking at here </span><span class="line" data-startTime="189">is three graphs showing </span><span class="line" data-startTime="189">the transfer size </span><span class="line" data-startTime="191">against the number of requests. </span> <span class="line" data-startTime="194">And so what you're </span><span class="line" data-startTime="194">seeing is over time, </span><span class="line" data-startTime="196">our number of requests have </span><span class="line" data-startTime="196">remained pretty constant </span><span class="line" data-startTime="200">over the past couple </span><span class="line" data-startTime="200">of years, while you </span><span class="line" data-startTime="203">see a general increasing </span><span class="line" data-startTime="203">trend in the overall size </span><span class="line" data-startTime="206">per request. </span></p>

<p><span class="line" data-startTime="207">Now, this is </span><span class="line" data-startTime="207">specifically three graphs </span><span class="line" data-startTime="209">for HTML, JavaScript, and CSS. </span> <span class="line" data-startTime="212">What this is telling us is </span><span class="line" data-startTime="212">that while images may make up </span><span class="line" data-startTime="215">the lion's share of </span><span class="line" data-startTime="215">the internet right now, </span><span class="line" data-startTime="218">text information, the backbone </span><span class="line" data-startTime="218">of these three formats, </span><span class="line" data-startTime="221">isn't going away </span><span class="line" data-startTime="221">anytime soon, nor is it </span><span class="line" data-startTime="224">slated to get any smaller. </span> <span class="line" data-startTime="226">So for most people, </span><span class="line" data-startTime="226">they would say, well, </span><span class="line" data-startTime="228">if the web is mostly images, </span><span class="line" data-startTime="228">why should we care about text? </span><span class="line" data-startTime="232">Well, here's why. </span> <span class="line" data-startTime="234">You see, images may </span><span class="line" data-startTime="234">be fantastic and they </span><span class="line" data-startTime="237">may be the dominant </span><span class="line" data-startTime="237">form of content for us, </span><span class="line" data-startTime="240">but it's apparent and been </span><span class="line" data-startTime="240">shown that they're not </span><span class="line" data-startTime="243">as small as they could be. </span> <span class="line" data-startTime="244">So for example, let's </span><span class="line" data-startTime="244">take this fantastic image, </span><span class="line" data-startTime="246">which was captured on a camera. </span> <span class="line" data-startTime="248">This is about one </span><span class="line" data-startTime="248">megapixel of data. </span></p>

<p><span class="line" data-startTime="251">Now, if we say </span><span class="line" data-startTime="251">this is a PNG file, </span><span class="line" data-startTime="252">it actually comes out at </span><span class="line" data-startTime="252">about 2.3 megabytes of data. </span> <span class="line" data-startTime="256">Now, for those of you </span><span class="line" data-startTime="256">playing the home game, </span><span class="line" data-startTime="258">you'll note that </span><span class="line" data-startTime="258">HTTP Archive averages </span><span class="line" data-startTime="261">that the average </span><span class="line" data-startTime="261">website out there </span><span class="line" data-startTime="263">is about 1.2 to </span><span class="line" data-startTime="263">1.1 megs of data. </span> <span class="line" data-startTime="266">So this single PNG image, </span><span class="line" data-startTime="266">if hosted on your website, </span><span class="line" data-startTime="269">is already larger </span><span class="line" data-startTime="269">than the average size </span><span class="line" data-startTime="271">of a website on the internet. </span> <span class="line" data-startTime="272">Now, PNG's fantastic. </span> <span class="line" data-startTime="274">It allows you to </span><span class="line" data-startTime="274">get transparency, </span><span class="line" data-startTime="276">and it does support GZIP </span><span class="line" data-startTime="276">compression internally </span><span class="line" data-startTime="278">as a format, but it really only </span><span class="line" data-startTime="278">supports a lossless encoding, </span><span class="line" data-startTime="281">which means you're </span><span class="line" data-startTime="281">not really getting rid </span><span class="line" data-startTime="283">of any visual data </span><span class="line" data-startTime="283">that may be redundant. </span> <span class="line" data-startTime="286">JPEG, on the other </span><span class="line" data-startTime="286">hand, as a format </span><span class="line" data-startTime="288">is built both a lossy </span><span class="line" data-startTime="288">and lossless encoder. </span> <span class="line" data-startTime="291">This allows the JPEG encoding </span><span class="line" data-startTime="291">system to actually remove </span><span class="line" data-startTime="295">visually redundant </span><span class="line" data-startTime="295">information from the image </span><span class="line" data-startTime="297">so that you don't </span><span class="line" data-startTime="297">really notice it's gone. </span></p>

<p><span class="line" data-startTime="300">The human eye is pretty </span><span class="line" data-startTime="300">complex, but still, </span><span class="line" data-startTime="303">at 32 bits per pixel, </span><span class="line" data-startTime="303">there's a lot of information </span><span class="line" data-startTime="305">that we can't discern. </span> <span class="line" data-startTime="307">So if you JPEG this </span><span class="line" data-startTime="307">image, you lose </span><span class="line" data-startTime="309">the ability to get </span><span class="line" data-startTime="309">transparency, however, you </span><span class="line" data-startTime="310">do cut the size of the </span><span class="line" data-startTime="310">image down to 297k. </span> <span class="line" data-startTime="315">Now, these have been the </span><span class="line" data-startTime="315">two mostly dominant image </span><span class="line" data-startTime="320">formats, besides animated </span><span class="line" data-startTime="320">cat GIFs on the internet, </span><span class="line" data-startTime="323">but earlier this year, </span><span class="line" data-startTime="323">internet technology evangelists </span><span class="line" data-startTime="327">and other enthusiasts </span><span class="line" data-startTime="327">decided that maybe we </span><span class="line" data-startTime="330">weren't done here yet. </span> <span class="line" data-startTime="332">Maybe the compression </span><span class="line" data-startTime="332">system of JPEG </span><span class="line" data-startTime="334">wasn't good enough for </span><span class="line" data-startTime="334">the rest of the web, </span><span class="line" data-startTime="336">and thus we had the </span><span class="line" data-startTime="336">WebP format being born. </span> <span class="line" data-startTime="339">Now, the WebP format is new. </span></p>

<p><span class="line" data-startTime="341">It's not necessarily </span><span class="line" data-startTime="341">supported by all browsers </span><span class="line" data-startTime="343">as of this date. </span> <span class="line" data-startTime="344">But it's actually got </span><span class="line" data-startTime="344">some exciting properties </span><span class="line" data-startTime="347">that are really making </span><span class="line" data-startTime="347">people on the web </span><span class="line" data-startTime="348">stand up and take notice. </span> <span class="line" data-startTime="349">So first off, if you compress </span><span class="line" data-startTime="349">this image with WebP, </span><span class="line" data-startTime="352">it actually drops to about 198k. </span> <span class="line" data-startTime="355">That's 100 kilobytes </span><span class="line" data-startTime="355">of data difference </span><span class="line" data-startTime="357">for this single image. </span> <span class="line" data-startTime="358">In addition to that, </span><span class="line" data-startTime="358">WebP will actually </span><span class="line" data-startTime="360">allow you to get </span><span class="line" data-startTime="360">transparency and even </span><span class="line" data-startTime="362">support some forms of animation, </span><span class="line" data-startTime="362">which means this single image </span><span class="line" data-startTime="366">format gets you the </span><span class="line" data-startTime="366">compression sizes of JPEG, </span><span class="line" data-startTime="368">the transparency </span><span class="line" data-startTime="368">properties of PNG, </span><span class="line" data-startTime="371">as well as the animation </span><span class="line" data-startTime="371">properties of GIFs. </span></p>

<p><span class="line" data-startTime="374">It's an exciting, </span><span class="line" data-startTime="374">one stop solution </span><span class="line" data-startTime="377">for a lot of your image needs. </span> <span class="line" data-startTime="379">Now, this is the important </span><span class="line" data-startTime="379">thing to note about this image </span><span class="line" data-startTime="382">size, and about </span><span class="line" data-startTime="382">this image format, </span><span class="line" data-startTime="384">is that most mobile phones </span><span class="line" data-startTime="384">right now are actually </span><span class="line" data-startTime="387">about five megapixels </span><span class="line" data-startTime="387">for their cameras, </span><span class="line" data-startTime="389">which means people are taking </span><span class="line" data-startTime="389">snapshots of the food they eat </span><span class="line" data-startTime="392">or signs on the </span><span class="line" data-startTime="392">street or their kids, </span><span class="line" data-startTime="394">uploading them to their </span><span class="line" data-startTime="394">favorite social media network, </span><span class="line" data-startTime="396">and that's actually coming in </span><span class="line" data-startTime="396">at five megapixels uncompressed. </span> <span class="line" data-startTime="399">Now, if we look at PNG and </span><span class="line" data-startTime="399">JPEG and the compression ratios </span><span class="line" data-startTime="402">they got with a </span><span class="line" data-startTime="402">single megabyte image, </span><span class="line" data-startTime="404">you can see that over time, </span><span class="line" data-startTime="404">as the number of images that </span><span class="line" data-startTime="407">fill the internet </span><span class="line" data-startTime="407">increases, we're </span><span class="line" data-startTime="409">going to quickly run into </span><span class="line" data-startTime="409">compression and data size </span><span class="line" data-startTime="411">issues. </span> <span class="line" data-startTime="412">That's why WebP shows </span><span class="line" data-startTime="412">up, and it actually </span><span class="line" data-startTime="414">solves a huge problem </span><span class="line" data-startTime="414">for us and allows </span><span class="line" data-startTime="416">us to address a lot of issues. </span> <span class="line" data-startTime="418">Now, there's a whole separate </span><span class="line" data-startTime="418">series of GDLs done on WebP. </span></p>

<p><span class="line" data-startTime="421">I encourage you to go </span><span class="line" data-startTime="421">to the GDL website, </span><span class="line" data-startTime="423">take a look at </span><span class="line" data-startTime="423">some of these talks </span><span class="line" data-startTime="424">for more information on how </span><span class="line" data-startTime="424">to get started with that. </span> <span class="line" data-startTime="426">Now, that's all I'm </span><span class="line" data-startTime="426">going to say about image </span><span class="line" data-startTime="428">compression for now. </span> <span class="line" data-startTime="431">But in the meantime, </span><span class="line" data-startTime="431">let's talk about text. </span> <span class="line" data-startTime="433">So I said before that text </span><span class="line" data-startTime="433">data &mdash; CSS, HTML, JavaScript &mdash; </span><span class="line" data-startTime="437">actually drive the rendering </span><span class="line" data-startTime="437">performance and initial page </span><span class="line" data-startTime="440">load of your page </span><span class="line" data-startTime="440">more than images do. </span> <span class="line" data-startTime="444">This is for a very </span><span class="line" data-startTime="444">specific reason. </span></p>

<p><span class="line" data-startTime="445">So if you look at </span><span class="line" data-startTime="445">this graph here, </span><span class="line" data-startTime="447">we actually can't start </span><span class="line" data-startTime="447">rendering anything on your page </span><span class="line" data-startTime="450">until the HTML has been parsed </span><span class="line" data-startTime="450">and subsequent JavaScript </span><span class="line" data-startTime="454">and CSS may be loaded to create </span><span class="line" data-startTime="454">both the DOM and the CSS DOM </span><span class="line" data-startTime="459">so that we can actually </span><span class="line" data-startTime="459">parse the render tree </span><span class="line" data-startTime="460">and actually start getting </span><span class="line" data-startTime="460">pixels on the screen. </span> <span class="line" data-startTime="463">So if we look at this average </span><span class="line" data-startTime="463">flow of events from HTML </span><span class="line" data-startTime="466">to CSS to actually </span><span class="line" data-startTime="466">getting pixels there, </span><span class="line" data-startTime="468">we can actually see an </span><span class="line" data-startTime="468">interesting example. </span> <span class="line" data-startTime="470">So we have a standard HTML, </span><span class="line" data-startTime="470">which actually links to a CSS. </span> <span class="line" data-startTime="473">That CSS is updating </span><span class="line" data-startTime="473">some of the information </span><span class="line" data-startTime="476">on the page, the text data. </span></p>

<p><span class="line" data-startTime="477">We also have an image </span><span class="line" data-startTime="477">that's referenced </span><span class="line" data-startTime="479">and a script that's </span><span class="line" data-startTime="479">at the bottom of it. </span> <span class="line" data-startTime="481">Now you can see on the </span><span class="line" data-startTime="481">mobile image on the side </span><span class="line" data-startTime="484">there that nothing </span><span class="line" data-startTime="484">has been shown yet, </span><span class="line" data-startTime="487">even though this </span><span class="line" data-startTime="487">HTML has been parsed. </span> <span class="line" data-startTime="489">So we've got our little HTML </span><span class="line" data-startTime="489">box that's mostly orange. </span> <span class="line" data-startTime="492">You can see that the DOM </span><span class="line" data-startTime="492">has mostly been parsed. </span> <span class="line" data-startTime="494">It's partially orange. </span> <span class="line" data-startTime="495">And that the CSS </span><span class="line" data-startTime="495">file &mdash; example.css &mdash; </span><span class="line" data-startTime="497">has been discovered, but it </span><span class="line" data-startTime="497">hasn't really been loaded yet. </span> <span class="line" data-startTime="501">So this means that we </span><span class="line" data-startTime="501">actually cannot display text </span><span class="line" data-startTime="503">on the screen because we don't </span><span class="line" data-startTime="503">have the styling properties </span><span class="line" data-startTime="506">that define that </span><span class="line" data-startTime="506">text on the screen. </span> <span class="line" data-startTime="509">It's not until the </span><span class="line" data-startTime="509">CSS data actually </span><span class="line" data-startTime="511">gets loaded that we can build </span><span class="line" data-startTime="511">the CSS version of the DOM </span><span class="line" data-startTime="514">and actually begin </span><span class="line" data-startTime="514">constructing the render tree. </span></p>

<p><span class="line" data-startTime="516">Now notice that the DOM still </span><span class="line" data-startTime="516">hasn't finished loading yet. </span> <span class="line" data-startTime="519">That's OK. </span> <span class="line" data-startTime="520">If we can actually partially </span><span class="line" data-startTime="520">load and partially display </span><span class="line" data-startTime="523">the top part of the DOM, or </span><span class="line" data-startTime="523">what people typically say </span><span class="line" data-startTime="526">is above the fold, that allows </span><span class="line" data-startTime="526">us to actually start rendering </span><span class="line" data-startTime="529">pixels on the screen while </span><span class="line" data-startTime="529">the bottom part of the page </span><span class="line" data-startTime="531">is still loading. </span> <span class="line" data-startTime="532">So now that the </span><span class="line" data-startTime="532">CSS has loaded, we </span><span class="line" data-startTime="534">can actually get some </span><span class="line" data-startTime="534">text on the screen. </span> <span class="line" data-startTime="536">Now notice that layout </span><span class="line" data-startTime="536">and paint are halfway </span><span class="line" data-startTime="538">through their process because </span><span class="line" data-startTime="538">they don't have all the data. </span> <span class="line" data-startTime="541">Loading up next should be </span><span class="line" data-startTime="541">WebP, and then of course, </span><span class="line" data-startTime="543">last.js is defined </span><span class="line" data-startTime="543">there as well. </span> <span class="line" data-startTime="546">Now, because of the </span><span class="line" data-startTime="546">file sizes, last.js </span><span class="line" data-startTime="548">is smaller than the image, </span><span class="line" data-startTime="548">and so it can actually </span><span class="line" data-startTime="551">get loaded and parsed </span><span class="line" data-startTime="551">before the image </span><span class="line" data-startTime="553">data actually gets </span><span class="line" data-startTime="553">to the screen. </span></p>

<p><span class="line" data-startTime="555">Now, if last.js kicks </span><span class="line" data-startTime="555">off some style chains </span><span class="line" data-startTime="558">or some other information </span><span class="line" data-startTime="558">that needs to be loaded, </span><span class="line" data-startTime="560">it can go back </span><span class="line" data-startTime="560">and change the DOM </span><span class="line" data-startTime="562">and change the CSS properties, </span><span class="line" data-startTime="562">forcing page reflows, </span><span class="line" data-startTime="565">forcing page repaints, and other </span><span class="line" data-startTime="565">sorts of chaos in your loading </span><span class="line" data-startTime="568">time. </span> <span class="line" data-startTime="568">But notice the image still </span><span class="line" data-startTime="568">hasn't been loaded yet </span><span class="line" data-startTime="571">and hasn't been </span><span class="line" data-startTime="571">displayed on screen. </span> <span class="line" data-startTime="573">It's not until the final </span><span class="line" data-startTime="573">complete bits come off </span><span class="line" data-startTime="575">the wire, the CSS </span><span class="line" data-startTime="575">DOM can be finished, </span><span class="line" data-startTime="578">the render tree can </span><span class="line" data-startTime="578">actually be completed, </span><span class="line" data-startTime="579">and finally, we can </span><span class="line" data-startTime="579">actually get the image </span><span class="line" data-startTime="581">on the screen showing </span><span class="line" data-startTime="581">you what we're </span><span class="line" data-startTime="583">trying to show you </span><span class="line" data-startTime="583">in the first place. </span> <span class="line" data-startTime="585">Now, what you should </span><span class="line" data-startTime="585">gather from this </span><span class="line" data-startTime="586">is that while images make up the </span><span class="line" data-startTime="586">bulk of the content on the web, </span><span class="line" data-startTime="589">it's really the </span><span class="line" data-startTime="589">textual base data that </span><span class="line" data-startTime="592">drives how and when </span><span class="line" data-startTime="592">pixels get to your screen. </span></p>

<p><span class="line" data-startTime="596">And when you're </span><span class="line" data-startTime="596">trying to optimize </span><span class="line" data-startTime="597">for fast path and critical path </span><span class="line" data-startTime="597">rendering on mobile devices, </span><span class="line" data-startTime="601">it's really the </span><span class="line" data-startTime="601">text data you need </span><span class="line" data-startTime="603">to get off the wire </span><span class="line" data-startTime="603">as fast as possible. </span> <span class="line" data-startTime="606">Now, a lot of you </span><span class="line" data-startTime="606">kids out there are </span><span class="line" data-startTime="608">talking about some </span><span class="line" data-startTime="608">really cool internet </span><span class="line" data-startTime="609">technology called Emscripten. </span> <span class="line" data-startTime="611">Now, this is a library has </span><span class="line" data-startTime="611">been developed open source that </span><span class="line" data-startTime="614">allows developers to take </span><span class="line" data-startTime="614">existing C and C++ code </span><span class="line" data-startTime="618">and trans-compile that </span><span class="line" data-startTime="618">to JavaScript data. </span> <span class="line" data-startTime="621">Probably one of the </span><span class="line" data-startTime="621">most impressive examples </span><span class="line" data-startTime="623">of this technology was debuted </span><span class="line" data-startTime="623">a little bit earlier this year, </span><span class="line" data-startTime="625">sometime in March at the game </span><span class="line" data-startTime="625">developer conference, where </span><span class="line" data-startTime="628">Nvidia and Mozilla and a </span><span class="line" data-startTime="628">bunch of the open source </span><span class="line" data-startTime="630">community at Emscripten actually </span><span class="line" data-startTime="630">debuted the Unreal 3 graphics </span><span class="line" data-startTime="634">engine running on </span><span class="line" data-startTime="634">top of Emscripten. </span> <span class="line" data-startTime="638">Now, this means that you </span><span class="line" data-startTime="638">get this rich, full graphics </span><span class="line" data-startTime="640">engine running </span><span class="line" data-startTime="640">inside of a browser. </span></p>

<p><span class="line" data-startTime="642">It runs inside of </span><span class="line" data-startTime="642">JavaScript, so it's </span><span class="line" data-startTime="643">spec compliant and all </span><span class="line" data-startTime="643">this other fun stuff. </span> <span class="line" data-startTime="645">Now, I'm from the </span><span class="line" data-startTime="645">games industry, </span><span class="line" data-startTime="647">and I've been working with </span><span class="line" data-startTime="647">Unreal 3 for a number of years </span><span class="line" data-startTime="650">now. </span> <span class="line" data-startTime="650">And one of the things </span><span class="line" data-startTime="650">Unreal has never </span><span class="line" data-startTime="652">been popular for is </span><span class="line" data-startTime="652">being small in size. </span> <span class="line" data-startTime="655">You can actually see that </span><span class="line" data-startTime="655">when we move the source </span><span class="line" data-startTime="657">code and the compiled </span><span class="line" data-startTime="657">data to the web, </span><span class="line" data-startTime="660">this problem still consists. </span> <span class="line" data-startTime="662">So if you look at the loading </span><span class="line" data-startTime="662">time of this application, </span><span class="line" data-startTime="666">you can actually see </span><span class="line" data-startTime="666">that the core JavaScript </span><span class="line" data-startTime="668">file for this Emscripten-based </span><span class="line" data-startTime="668">port of Unreal </span><span class="line" data-startTime="671">is about 50 megabytes of data. </span></p>

<p><span class="line" data-startTime="674">50 megabytes to bring </span><span class="line" data-startTime="674">down a JavaScript </span><span class="line" data-startTime="676">file to actually load this game. </span> <span class="line" data-startTime="678">Now to be fair, it </span><span class="line" data-startTime="678">is served compressed, </span><span class="line" data-startTime="681">which means that </span><span class="line" data-startTime="681">you actually only </span><span class="line" data-startTime="682">have to pull down </span><span class="line" data-startTime="682">five megabytes of data </span><span class="line" data-startTime="684">across the wire for this </span><span class="line" data-startTime="684">single JavaScript file. </span> <span class="line" data-startTime="687">But still, five megabytes. </span> <span class="line" data-startTime="689">That's five times larger than </span><span class="line" data-startTime="689">any of our other websites </span><span class="line" data-startTime="691">out there. </span> <span class="line" data-startTime="691">And by the way, this isn't </span><span class="line" data-startTime="691">counting the 18 megabytes </span><span class="line" data-startTime="694">worth of data that has to </span><span class="line" data-startTime="694">be pulled down as well. </span> <span class="line" data-startTime="697">So when you look at these </span><span class="line" data-startTime="697">trends &mdash; and the more </span><span class="line" data-startTime="699">developers that are trying to </span><span class="line" data-startTime="699">move towards high performance </span><span class="line" data-startTime="702">JavaScript execution using </span><span class="line" data-startTime="702">things like Emscripten </span><span class="line" data-startTime="705">and asm.js &mdash; what you </span><span class="line" data-startTime="705">start seeing is a trend. </span> <span class="line" data-startTime="708">The more web applications </span><span class="line" data-startTime="708">that produce source code </span><span class="line" data-startTime="711">in JavaScript that come </span><span class="line" data-startTime="711">from other languages, </span><span class="line" data-startTime="713">we'll start seeing bloated </span><span class="line" data-startTime="713">and larger and larger </span><span class="line" data-startTime="717">JavaScript files that need to </span><span class="line" data-startTime="717">be downloaded by their clients </span><span class="line" data-startTime="719">before pixels can get </span><span class="line" data-startTime="719">on the screen and a game </span><span class="line" data-startTime="721">can be played. </span></p>

<p><span class="line" data-startTime="722">This trend is not going </span><span class="line" data-startTime="722">to diminish over time. </span> <span class="line" data-startTime="725">This means that our </span><span class="line" data-startTime="725">text data is going </span><span class="line" data-startTime="727">to continue growing larger. </span> <span class="line" data-startTime="729">As such, as a </span><span class="line" data-startTime="729">developer, it's your job </span><span class="line" data-startTime="732">to figure out how to </span><span class="line" data-startTime="732">minimize, compress, and reduce </span><span class="line" data-startTime="734">the number of bits on the wire. </span> <span class="line" data-startTime="737">And so with that, </span><span class="line" data-startTime="737">let's take a look </span><span class="line" data-startTime="739">at the good old </span><span class="line" data-startTime="739">boy known as GZIP, </span><span class="line" data-startTime="741">sort of the backbone of </span><span class="line" data-startTime="741">compression on the internet </span><span class="line" data-startTime="744">today. </span> <span class="line" data-startTime="744">Now, I want to do a quick side </span><span class="line" data-startTime="744">to note that compression is not </span><span class="line" data-startTime="749">the same as minimization </span><span class="line" data-startTime="749">or minification, </span><span class="line" data-startTime="752">depending on how purist </span><span class="line" data-startTime="752">you are on the term. </span> <span class="line" data-startTime="754">So let's take a look at </span><span class="line" data-startTime="754">the two really quick. </span> <span class="line" data-startTime="756">Minification in the </span><span class="line" data-startTime="756">web platform is the art </span><span class="line" data-startTime="760">of removing redundant </span><span class="line" data-startTime="760">information from textual data </span><span class="line" data-startTime="763">such that we can still </span><span class="line" data-startTime="763">symbolically parse and process </span><span class="line" data-startTime="768">it when we pass it off </span><span class="line" data-startTime="768">to the underlying system. </span> <span class="line" data-startTime="771">So if you look at </span><span class="line" data-startTime="771">this example here, </span><span class="line" data-startTime="772">we've got a function </span><span class="line" data-startTime="772">that adds two numbers, </span><span class="line" data-startTime="774">but there seems like </span><span class="line" data-startTime="774">there's a lot of information </span><span class="line" data-startTime="777">that you don't see. </span></p>

<p><span class="line" data-startTime="778">There's line returns, there's </span><span class="line" data-startTime="778">extra spacing information, </span><span class="line" data-startTime="781">perhaps the variable names </span><span class="line" data-startTime="781">are actually too long. </span> <span class="line" data-startTime="784">The process of minification </span><span class="line" data-startTime="784">actually reduces all of this </span><span class="line" data-startTime="787">to give you the least number of </span><span class="line" data-startTime="787">completely processing and valid </span><span class="line" data-startTime="792">bytes for this file </span><span class="line" data-startTime="792">representation. </span> <span class="line" data-startTime="795">Again here, we can </span><span class="line" data-startTime="795">process this ahead of time </span><span class="line" data-startTime="797">and actually pass this right </span><span class="line" data-startTime="797">to the underlying systems </span><span class="line" data-startTime="799">to be processed and actually </span><span class="line" data-startTime="799">get stuff on your screen. </span> <span class="line" data-startTime="802">Now, compression, </span><span class="line" data-startTime="802">on the other hand, </span><span class="line" data-startTime="804">offers something </span><span class="line" data-startTime="804">completely different. </span> <span class="line" data-startTime="806">Compression is the act of </span><span class="line" data-startTime="806">modifying your data so that it </span><span class="line" data-startTime="809">has to be reconstructed before </span><span class="line" data-startTime="809">being passed to the underlying </span><span class="line" data-startTime="812">processing system. </span></p>

<p><span class="line" data-startTime="813">So again, if we take </span><span class="line" data-startTime="813">the minimized form </span><span class="line" data-startTime="815">of that some </span><span class="line" data-startTime="815">function, compression </span><span class="line" data-startTime="817">will actually turn it into </span><span class="line" data-startTime="817">a bit stream of information </span><span class="line" data-startTime="820">that then has to be deflated, </span><span class="line" data-startTime="820">or actually decompressed </span><span class="line" data-startTime="824">into the original form </span><span class="line" data-startTime="824">before it can actually </span><span class="line" data-startTime="826">be passed off to the </span><span class="line" data-startTime="826">underlying systems. </span> <span class="line" data-startTime="828">These two technologies </span><span class="line" data-startTime="828">work as a one-two punch. </span> <span class="line" data-startTime="831">So you actually have to add </span><span class="line" data-startTime="831">minification to your technology </span><span class="line" data-startTime="834">before you allow GZIP-ing </span><span class="line" data-startTime="834">to occur in order </span><span class="line" data-startTime="837">to get the fewest </span><span class="line" data-startTime="837">bytes on the wire. </span> <span class="line" data-startTime="838">Now for the rest </span><span class="line" data-startTime="838">of this talk, we're </span><span class="line" data-startTime="840">actually going to be addressing </span><span class="line" data-startTime="840">some of the issues and pros </span><span class="line" data-startTime="843">and cons of GZIP, </span><span class="line" data-startTime="843">but before we do </span><span class="line" data-startTime="845">that, I need to make sure </span><span class="line" data-startTime="845">that we understand what's </span><span class="line" data-startTime="847">going on under the </span><span class="line" data-startTime="847">hood of this algorithm. </span> <span class="line" data-startTime="849">You see, GZIP is a </span><span class="line" data-startTime="849">compression format </span><span class="line" data-startTime="851">that actually uses two </span><span class="line" data-startTime="851">interplaying technologies </span><span class="line" data-startTime="853">together. </span></p>

<p><span class="line" data-startTime="854">The first one is a </span><span class="line" data-startTime="854">technology known as LZ77. </span> <span class="line" data-startTime="857">Now, this is a </span><span class="line" data-startTime="857">dictionary-based transform </span><span class="line" data-startTime="860">that will actually take </span><span class="line" data-startTime="860">a given data stream </span><span class="line" data-startTime="863">and convert it into </span><span class="line" data-startTime="863">a sequence of tuples. </span> <span class="line" data-startTime="866">Now, in each tuple, we actually </span><span class="line" data-startTime="866">have a position and a length </span><span class="line" data-startTime="870">value. </span> <span class="line" data-startTime="870">So I know that's confusing. </span> <span class="line" data-startTime="872">Let's take a look at </span><span class="line" data-startTime="872">a little example here. </span> <span class="line" data-startTime="874">So we've got this </span><span class="line" data-startTime="874">string up top which </span><span class="line" data-startTime="875">is comprised of </span><span class="line" data-startTime="875">various A, B's, and C's </span><span class="line" data-startTime="877">in some sort of random order. </span></p>

<p><span class="line" data-startTime="879">What happens is if we </span><span class="line" data-startTime="879">start parsing this string, </span><span class="line" data-startTime="881">we're going to look at </span><span class="line" data-startTime="881">each symbol individually </span><span class="line" data-startTime="883">and we're going to do a </span><span class="line" data-startTime="883">scan backwards to find out </span><span class="line" data-startTime="887">when previously we've </span><span class="line" data-startTime="887">seen this symbol before, </span><span class="line" data-startTime="891">because then that allows </span><span class="line" data-startTime="891">us to actually encode </span><span class="line" data-startTime="892">this symbol rather as a </span><span class="line" data-startTime="892">single piece of information, </span><span class="line" data-startTime="896">but actually as a relative </span><span class="line" data-startTime="896">piece of information. </span> <span class="line" data-startTime="899">The goal here in </span><span class="line" data-startTime="899">LZ77 is actually </span><span class="line" data-startTime="901">to create a lot of </span><span class="line" data-startTime="901">redundant types of tuples </span><span class="line" data-startTime="904">that we can then compress </span><span class="line" data-startTime="904">a little bit better. </span> <span class="line" data-startTime="906">So let's walk through </span><span class="line" data-startTime="906">this just a little bit </span><span class="line" data-startTime="908">so you can see what's going on. </span> <span class="line" data-startTime="910">So you see if we start </span><span class="line" data-startTime="910">with the first A here </span><span class="line" data-startTime="912">and we actually </span><span class="line" data-startTime="912">parse it, well, it's </span><span class="line" data-startTime="913">the beginning of the </span><span class="line" data-startTime="913">string, so we haven't really </span><span class="line" data-startTime="915">seen anything before yet. </span> <span class="line" data-startTime="917">Therefore, we actually </span><span class="line" data-startTime="917">have to output </span><span class="line" data-startTime="918">a position and length of 0, 0. </span></p>

<p><span class="line" data-startTime="920">It represents that </span><span class="line" data-startTime="920">we're not actually </span><span class="line" data-startTime="922">seeing any other characters. </span> <span class="line" data-startTime="923">We're just looking </span><span class="line" data-startTime="923">at the A itself. </span> <span class="line" data-startTime="925">Now, when we get to the second </span><span class="line" data-startTime="925">A, we start our backwards scan </span><span class="line" data-startTime="929">and we find that the </span><span class="line" data-startTime="929">first A we encounter </span><span class="line" data-startTime="931">was actually one symbol ago </span><span class="line" data-startTime="931">at a length of one symbol. </span> <span class="line" data-startTime="935">So this means we can actually </span><span class="line" data-startTime="935">output the tuple, 1, 1. </span> <span class="line" data-startTime="937">Now B, we haven't </span><span class="line" data-startTime="937">seen any B's before, </span><span class="line" data-startTime="939">so we have to output 0, 0. </span> <span class="line" data-startTime="941">And C, same thing, 0, 0. </span> <span class="line" data-startTime="943">But now we've reached </span><span class="line" data-startTime="943">another B. So it's </span><span class="line" data-startTime="945">going to start </span><span class="line" data-startTime="945">scanning backwards </span><span class="line" data-startTime="946">and actually finds that the last </span><span class="line" data-startTime="946">B we encountered in the stream </span><span class="line" data-startTime="949">was two symbols ago. </span></p>

<p><span class="line" data-startTime="951">And again, we only </span><span class="line" data-startTime="951">want length of one. </span> <span class="line" data-startTime="952">Now, the important and probably </span><span class="line" data-startTime="952">the more interesting part </span><span class="line" data-startTime="954">of this particular </span><span class="line" data-startTime="954">example is when </span><span class="line" data-startTime="956">we get to the end of the string </span><span class="line" data-startTime="956">where we see A, B, C. Now, </span><span class="line" data-startTime="960">when we scan backwards </span><span class="line" data-startTime="960">from A, B, C, </span><span class="line" data-startTime="961">we can actually find that we </span><span class="line" data-startTime="961">found this exact three symbol </span><span class="line" data-startTime="965">value previously in </span><span class="line" data-startTime="965">our stream, and exactly </span><span class="line" data-startTime="968">about five character </span><span class="line" data-startTime="968">positions back. </span> <span class="line" data-startTime="971">So this means we're going </span><span class="line" data-startTime="971">to output the tuple of 5, 3. </span> <span class="line" data-startTime="974">So we output a tuple rather </span><span class="line" data-startTime="974">than the three characters </span><span class="line" data-startTime="976">themselves. </span></p>

<p><span class="line" data-startTime="977">Now again, the point of </span><span class="line" data-startTime="977">LZ77 is to actually create </span><span class="line" data-startTime="981">duplicate and high </span><span class="line" data-startTime="981">redundancy tuples. </span> <span class="line" data-startTime="984">These tuples and the </span><span class="line" data-startTime="984">redundancy that we </span><span class="line" data-startTime="986">create with them are actually </span><span class="line" data-startTime="986">very important to pass off </span><span class="line" data-startTime="989">to the next step of </span><span class="line" data-startTime="989">the GZIP algorithm </span><span class="line" data-startTime="991">known as Huffman compression. </span> <span class="line" data-startTime="993">Now, for those of you who don't </span><span class="line" data-startTime="993">remember Huffman compression </span><span class="line" data-startTime="996">or probably have blocked </span><span class="line" data-startTime="996">it out of your mind back </span><span class="line" data-startTime="998">from the Computer Science </span><span class="line" data-startTime="998">101 days at your university, </span><span class="line" data-startTime="1001">Huffman works by assigning </span><span class="line" data-startTime="1001">variable length bit codes </span><span class="line" data-startTime="1006">to symbols in your stream </span><span class="line" data-startTime="1006">based on probability. </span></p>

<p><span class="line" data-startTime="1010">The idea here is that the more </span><span class="line" data-startTime="1010">probable and more frequent </span><span class="line" data-startTime="1013">a symbol is in your </span><span class="line" data-startTime="1013">stream, the least bits </span><span class="line" data-startTime="1016">you should use to represent it. </span> <span class="line" data-startTime="1017">A perfect real world example of </span><span class="line" data-startTime="1017">Huffman encoding is Morse code. </span> <span class="line" data-startTime="1021">In the American </span><span class="line" data-startTime="1021">language, the letter E </span><span class="line" data-startTime="1023">is the most dominant </span><span class="line" data-startTime="1023">of all our words. </span> <span class="line" data-startTime="1025">Therefore, it's </span><span class="line" data-startTime="1025">assigned a single beep </span><span class="line" data-startTime="1027">to represent its value. </span> <span class="line" data-startTime="1029">Huffman compression </span><span class="line" data-startTime="1029">works in a similar way. </span> <span class="line" data-startTime="1031">Now, we're going to spare </span><span class="line" data-startTime="1031">you the knowledge of building </span><span class="line" data-startTime="1034">a Huffman tree and </span><span class="line" data-startTime="1034">everything else. </span> <span class="line" data-startTime="1035">This is in tons of </span><span class="line" data-startTime="1035">data structures books. </span> <span class="line" data-startTime="1037">Instead, we'll just </span><span class="line" data-startTime="1037">show you that we </span><span class="line" data-startTime="1039">can see after we parse our </span><span class="line" data-startTime="1039">newly tokenized tuple string, </span><span class="line" data-startTime="1043">you can see that 0, 0 is </span><span class="line" data-startTime="1043">the most dominant tuple set. </span></p>

<p><span class="line" data-startTime="1046">And of course, we </span><span class="line" data-startTime="1046">can assign that one </span><span class="line" data-startTime="1048">bit, being a single zero. </span> <span class="line" data-startTime="1050">Therefore, the next </span><span class="line" data-startTime="1050">set is actually 1, 1. </span> <span class="line" data-startTime="1052">We have two symbols of that. </span> <span class="line" data-startTime="1053">And because of the way </span><span class="line" data-startTime="1053">our tree is constructed, </span><span class="line" data-startTime="1055">we actually have to provide </span><span class="line" data-startTime="1055">that with two bit symbols. </span> <span class="line" data-startTime="1057">We continue on and continue </span><span class="line" data-startTime="1057">on and effectively keep </span><span class="line" data-startTime="1060">assigning variable bit </span><span class="line" data-startTime="1060">code words to symbols, </span><span class="line" data-startTime="1064">creating a compressed </span><span class="line" data-startTime="1064">version of our data. </span> <span class="line" data-startTime="1066">Now, these two characters </span><span class="line" data-startTime="1066">or these two algorithms </span><span class="line" data-startTime="1069">operating back and </span><span class="line" data-startTime="1069">forth with each other </span><span class="line" data-startTime="1071">actually have a very </span><span class="line" data-startTime="1071">beautiful ballet </span><span class="line" data-startTime="1073">in the way that </span><span class="line" data-startTime="1073">content is created </span><span class="line" data-startTime="1075">and how it's compressed with </span><span class="line" data-startTime="1075">the statistical encoding. </span> <span class="line" data-startTime="1077">This is the cornerstone </span><span class="line" data-startTime="1077">of everything </span><span class="line" data-startTime="1079">we're going to talk about for </span><span class="line" data-startTime="1079">the rest of this conversation. </span> <span class="line" data-startTime="1082">Now, it's worth pointing </span><span class="line" data-startTime="1082">out that GZIP is not </span><span class="line" data-startTime="1084">the only kid on the block. </span></p>

<p><span class="line" data-startTime="1086">In fact, GZIP is about 20 </span><span class="line" data-startTime="1086">something years old now. </span> <span class="line" data-startTime="1090">If it were a real </span><span class="line" data-startTime="1090">human being, it </span><span class="line" data-startTime="1092">would be able to </span><span class="line" data-startTime="1092">drink and drive and do </span><span class="line" data-startTime="1093">all other sorts of fun </span><span class="line" data-startTime="1093">stuff on the internet. </span> <span class="line" data-startTime="1096">But other compression </span><span class="line" data-startTime="1096">algorithms which </span><span class="line" data-startTime="1098">may be a little bit newer </span><span class="line" data-startTime="1098">and a little bit different </span><span class="line" data-startTime="1100">can actually give you some </span><span class="line" data-startTime="1100">interesting trade-offs. </span> <span class="line" data-startTime="1102">So here are four of the more </span><span class="line" data-startTime="1102">popular encoders out there. </span> <span class="line" data-startTime="1105">The first is one known as LZMA. </span> <span class="line" data-startTime="1107">Some of you may know </span><span class="line" data-startTime="1107">this more popularly </span><span class="line" data-startTime="1108">as 7-Zip, a very </span><span class="line" data-startTime="1108">popular compression </span><span class="line" data-startTime="1112">archive tool out there. </span> <span class="line" data-startTime="1113">You can see that LZMA </span><span class="line" data-startTime="1113">actually gives you </span><span class="line" data-startTime="1115">smaller compression than GZIP. </span> <span class="line" data-startTime="1118">This is actually due to </span><span class="line" data-startTime="1118">a lot of higher order </span><span class="line" data-startTime="1120">searching and finding algorithms </span><span class="line" data-startTime="1120">built around that LZ77 </span><span class="line" data-startTime="1124">algorithm. </span> <span class="line" data-startTime="1125">In fact, LZMA can actually be </span><span class="line" data-startTime="1125">considered a distant cousin </span><span class="line" data-startTime="1128">to GZIP because it's actually </span><span class="line" data-startTime="1128">very similar in the way </span><span class="line" data-startTime="1130">that it compresses its data. </span></p>

<p><span class="line" data-startTime="1132">However, because it uses </span><span class="line" data-startTime="1132">more modern heuristics </span><span class="line" data-startTime="1134">and algorithms, it can </span><span class="line" data-startTime="1134">actually get better results. </span> <span class="line" data-startTime="1137">Now, below LZMA, you see LPAQ. </span> <span class="line" data-startTime="1139">This is a context </span><span class="line" data-startTime="1139">mixing based encoder. </span> <span class="line" data-startTime="1143">It's effectively </span><span class="line" data-startTime="1143">mostly a neural net </span><span class="line" data-startTime="1145">in practice of how </span><span class="line" data-startTime="1145">it matches symbols. </span> <span class="line" data-startTime="1148">Now notice LPAQ </span><span class="line" data-startTime="1148">actually gives us </span><span class="line" data-startTime="1149">the smallest file size </span><span class="line" data-startTime="1149">compared to everything else </span><span class="line" data-startTime="1152">at 0.35 megabytes. </span> <span class="line" data-startTime="1155">I'll get into that a little </span><span class="line" data-startTime="1155">bit more in a second. </span> <span class="line" data-startTime="1158">Now, the final compressor we </span><span class="line" data-startTime="1158">look at is actually BZIP2. </span> <span class="line" data-startTime="1160">Now, BZIP is a modern variant </span><span class="line" data-startTime="1160">of the Burrows-Wheeler transform </span><span class="line" data-startTime="1165">assigned also with a </span><span class="line" data-startTime="1165">move to front transform </span><span class="line" data-startTime="1167">and either a Huffman </span><span class="line" data-startTime="1167">or an arithmetic </span><span class="line" data-startTime="1170">encoder on the back end. </span> <span class="line" data-startTime="1171">Now, BZIP2 fundamentally changes </span><span class="line" data-startTime="1171">the way that compression works. </span> <span class="line" data-startTime="1174">It's very different. </span> <span class="line" data-startTime="1175">Doesn't use LZ77 at all. </span> <span class="line" data-startTime="1177">Instead, it uses </span><span class="line" data-startTime="1177">a semi-block based </span><span class="line" data-startTime="1180">sorting transform </span><span class="line" data-startTime="1180">to actually increase </span><span class="line" data-startTime="1182">redundancy or adjacent </span><span class="line" data-startTime="1182">redundancy in data. </span></p>

<p><span class="line" data-startTime="1185">This redundancy allows it </span><span class="line" data-startTime="1185">to get better compression. </span> <span class="line" data-startTime="1187">Again, you can see here </span><span class="line" data-startTime="1187">where GZIP actually gives us </span><span class="line" data-startTime="1190">0.48 in terms of megabytes, </span><span class="line" data-startTime="1190">BZIP actually beats this. </span> <span class="line" data-startTime="1194">Now, what you're actually </span><span class="line" data-startTime="1194">seeing here in terms of data </span><span class="line" data-startTime="1196">sizes is actually a scrape I </span><span class="line" data-startTime="1196">did of the amazon.com home page. </span> <span class="line" data-startTime="1200">So if I take all </span><span class="line" data-startTime="1200">of the text data </span><span class="line" data-startTime="1201">from that &mdash; HTML, CSS, </span><span class="line" data-startTime="1201">JSON, and JS data &mdash; </span><span class="line" data-startTime="1205">it actually comes out </span><span class="line" data-startTime="1205">to about 1.64 megs. </span> <span class="line" data-startTime="1207">So you can see how </span><span class="line" data-startTime="1207">these compressors relate </span><span class="line" data-startTime="1209">to that specific </span><span class="line" data-startTime="1209">memory footprint. </span> <span class="line" data-startTime="1212">Now, when you're </span><span class="line" data-startTime="1212">comparing compressors, </span><span class="line" data-startTime="1214">the size of the data is </span><span class="line" data-startTime="1214">not the only heuristic. </span> <span class="line" data-startTime="1217">You have two other </span><span class="line" data-startTime="1217">heuristics that you typically </span><span class="line" data-startTime="1219">throw into the mix. </span> <span class="line" data-startTime="1220">The first one is encoding </span><span class="line" data-startTime="1220">time and the second one </span><span class="line" data-startTime="1222">is decoding time, which often is </span><span class="line" data-startTime="1222">the more important of the two. </span> <span class="line" data-startTime="1225">So if we look at the </span><span class="line" data-startTime="1225">encoding time column, </span><span class="line" data-startTime="1227">you can see that GZIP does </span><span class="line" data-startTime="1227">probably the fastest in terms </span><span class="line" data-startTime="1231">of encoding speed </span><span class="line" data-startTime="1231">at 0.79 seconds. </span></p>

<p><span class="line" data-startTime="1234">LZMA, being a distant cousin </span><span class="line" data-startTime="1234">with more search heuristics, </span><span class="line" data-startTime="1238">actually comes in </span><span class="line" data-startTime="1238">pretty close at 1.26. </span> <span class="line" data-startTime="1240">You can see that the wins </span><span class="line" data-startTime="1240">it gets in compression size </span><span class="line" data-startTime="1244">actually come from </span><span class="line" data-startTime="1244">more preprocessing </span><span class="line" data-startTime="1247">at the front of </span><span class="line" data-startTime="1247">the encoding step. </span> <span class="line" data-startTime="1251">Now, LPAQ gives you </span><span class="line" data-startTime="1251">amazing compression, </span><span class="line" data-startTime="1253">but notice it actually takes 11 </span><span class="line" data-startTime="1253">seconds to compress your data. </span> <span class="line" data-startTime="1256">Now again, LPAQ is </span><span class="line" data-startTime="1256">a modern wonder. </span> <span class="line" data-startTime="1259">It actually uses </span><span class="line" data-startTime="1259">various forms of context </span><span class="line" data-startTime="1261">mixing in different </span><span class="line" data-startTime="1261">sort of combinations, </span><span class="line" data-startTime="1264">again, resulting in pretty </span><span class="line" data-startTime="1264">much an artificial intelligence </span><span class="line" data-startTime="1267">neural net algorithm to </span><span class="line" data-startTime="1267">find compression wins. </span> <span class="line" data-startTime="1269">So it makes sense </span><span class="line" data-startTime="1269">that this actually </span><span class="line" data-startTime="1271">oscillates at about 11 seconds </span><span class="line" data-startTime="1271">worth of processing time </span><span class="line" data-startTime="1273">because there's a lot of </span><span class="line" data-startTime="1273">things going on under the hood. </span> <span class="line" data-startTime="1276">Meanwhile, the Burrows-Wheeler </span><span class="line" data-startTime="1276">transform powered BZIP2 </span><span class="line" data-startTime="1279">doesn't stray too </span><span class="line" data-startTime="1279">far from the mark, </span><span class="line" data-startTime="1281">but gives us about 2.1 </span><span class="line" data-startTime="1281">seconds in encoding time. </span></p>

<p><span class="line" data-startTime="1284">And there's a </span><span class="line" data-startTime="1284">whole set of papers </span><span class="line" data-startTime="1285">that talk about how that </span><span class="line" data-startTime="1285">clustering transform actually </span><span class="line" data-startTime="1288">affects memory and </span><span class="line" data-startTime="1288">processing and whatnot. </span> <span class="line" data-startTime="1290">Now, decoding time is probably </span><span class="line" data-startTime="1290">the most important part here. </span> <span class="line" data-startTime="1293">You can actually see </span><span class="line" data-startTime="1293">that GZIP and LZMA are, </span><span class="line" data-startTime="1295">for all practical </span><span class="line" data-startTime="1295">purposes, identical. </span> <span class="line" data-startTime="1298">So while LZMA takes a </span><span class="line" data-startTime="1298">little bit longer to encode, </span><span class="line" data-startTime="1301">it seems to regularly produce </span><span class="line" data-startTime="1301">smaller files than GZIP, </span><span class="line" data-startTime="1304">and the decoding time tends </span><span class="line" data-startTime="1304">to be almost identical. </span></p>

<p><span class="line" data-startTime="1307">Now, LPAQ, again, because </span><span class="line" data-startTime="1307">it's running a neural net, </span><span class="line" data-startTime="1309">the decode time actually </span><span class="line" data-startTime="1309">equals almost what </span><span class="line" data-startTime="1311">the encode time was, so you </span><span class="line" data-startTime="1311">look at about 11 seconds </span><span class="line" data-startTime="1314">there, while BZIP </span><span class="line" data-startTime="1314">actually is a faster </span><span class="line" data-startTime="1316">decode than it is an encode. </span> <span class="line" data-startTime="1317">The whole point of this </span><span class="line" data-startTime="1317">slide &mdash; the only thing </span><span class="line" data-startTime="1319">I want you to take </span><span class="line" data-startTime="1319">away from here &mdash; </span><span class="line" data-startTime="1320">is that GZIP is really </span><span class="line" data-startTime="1320">good at a couple things, </span><span class="line" data-startTime="1323">specifically encoding time. </span> <span class="line" data-startTime="1325">It gets beat in a couple </span><span class="line" data-startTime="1325">places, specifically </span><span class="line" data-startTime="1327">with the size of the compression </span><span class="line" data-startTime="1327">that it achieves, and then ties </span><span class="line" data-startTime="1332">in a couple other </span><span class="line" data-startTime="1332">places in decoding time. </span> <span class="line" data-startTime="1334">So it's not really the </span><span class="line" data-startTime="1334">only algorithm on the block </span><span class="line" data-startTime="1336">there in terms of </span><span class="line" data-startTime="1336">compression ratios. </span> <span class="line" data-startTime="1339">So you can see here </span><span class="line" data-startTime="1339">that we've highlighted </span><span class="line" data-startTime="1341">a couple of these </span><span class="line" data-startTime="1341">specific instances. </span></p>

<p><span class="line" data-startTime="1343">LPAQ wins in size. </span> <span class="line" data-startTime="1344">Encoding time is, of </span><span class="line" data-startTime="1344">course, dominated by GZIP, </span><span class="line" data-startTime="1346">and decoding time is, of </span><span class="line" data-startTime="1346">course, dominated by LZMA. </span> <span class="line" data-startTime="1350">Now, this can lead a lot of </span><span class="line" data-startTime="1350">people on the web tech platform </span><span class="line" data-startTime="1354">to actually come at me </span><span class="line" data-startTime="1354">with burning pitchforks </span><span class="line" data-startTime="1357">and actually say, hey, GZIP </span><span class="line" data-startTime="1357">is actually pretty good. </span> <span class="line" data-startTime="1359">That data just showed </span><span class="line" data-startTime="1359">us that we really </span><span class="line" data-startTime="1361">don't need any other compression </span><span class="line" data-startTime="1361">algorithms because it gives us </span><span class="line" data-startTime="1364">decent size compression, </span><span class="line" data-startTime="1364">decent time for encoding, </span><span class="line" data-startTime="1367">and decent decoding time. </span> <span class="line" data-startTime="1369">Well, I'm here to tell you </span><span class="line" data-startTime="1369">that's a good argument, </span><span class="line" data-startTime="1371">but let's dig a </span><span class="line" data-startTime="1371">little bit deeper into </span><span class="line" data-startTime="1373">whether or not GZIP should </span><span class="line" data-startTime="1373">be the only thing we </span><span class="line" data-startTime="1375">allow on the web. </span> <span class="line" data-startTime="1377">So first off, you should </span><span class="line" data-startTime="1377">understand that there's really </span><span class="line" data-startTime="1379">no silver bullet </span><span class="line" data-startTime="1379">for compression. </span></p>

<p><span class="line" data-startTime="1382">Depending on what your </span><span class="line" data-startTime="1382">data is, how frequent </span><span class="line" data-startTime="1384">it is, the relationships it </span><span class="line" data-startTime="1384">has with local information, </span><span class="line" data-startTime="1388">all relate to how well it </span><span class="line" data-startTime="1388">can be compressed at the end, </span><span class="line" data-startTime="1391">and different compressors </span><span class="line" data-startTime="1391">will handle this data </span><span class="line" data-startTime="1393">in different ways. </span> <span class="line" data-startTime="1394">For example, if you actually </span><span class="line" data-startTime="1394">applied JPEG style compression </span><span class="line" data-startTime="1397">to text data, you're </span><span class="line" data-startTime="1397">not going to be </span><span class="line" data-startTime="1399">able to decompress your </span><span class="line" data-startTime="1399">text in the right way </span><span class="line" data-startTime="1401">because it's lossy in terms </span><span class="line" data-startTime="1401">of removing information </span><span class="line" data-startTime="1404">bits from the stream itself. </span></p>

<p><span class="line" data-startTime="1406">So let's take a perfect </span><span class="line" data-startTime="1406">example that actually </span><span class="line" data-startTime="1408">shows to beat GZIP without </span><span class="line" data-startTime="1408">really any modification. </span> <span class="line" data-startTime="1411">So let's say we have a </span><span class="line" data-startTime="1411">string of integers here. </span> <span class="line" data-startTime="1413">Now, this string of </span><span class="line" data-startTime="1413">integers was actually </span><span class="line" data-startTime="1415">created as an index system into </span><span class="line" data-startTime="1415">some higher order database. </span> <span class="line" data-startTime="1420">So there's basically 10 </span><span class="line" data-startTime="1420">things that are being indexed, </span><span class="line" data-startTime="1424">and we list them here. </span> <span class="line" data-startTime="1425">Now, if we just GZIP </span><span class="line" data-startTime="1425">this, we actually </span><span class="line" data-startTime="1426">don't get a lot of savings. </span> <span class="line" data-startTime="1428">This is because, </span><span class="line" data-startTime="1428">if you remember, </span><span class="line" data-startTime="1429">the LZ77 algorithm </span><span class="line" data-startTime="1429">isn't going to find </span><span class="line" data-startTime="1433">any duplicate indexes </span><span class="line" data-startTime="1433">in this array. </span> <span class="line" data-startTime="1435">Nine is only existing once, </span><span class="line" data-startTime="1435">and so are the other numbers. </span> <span class="line" data-startTime="1439">Meanwhile, that means that all </span><span class="line" data-startTime="1439">of the statistical probability </span><span class="line" data-startTime="1443">for these symbols is </span><span class="line" data-startTime="1443">pretty much equal. </span> <span class="line" data-startTime="1445">There's no difference. </span> <span class="line" data-startTime="1447">Nothing is more frequent </span><span class="line" data-startTime="1447">or less frequent, </span><span class="line" data-startTime="1449">which means the Huffman </span><span class="line" data-startTime="1449">algorithm is going </span><span class="line" data-startTime="1451">to pretty much assign </span><span class="line" data-startTime="1451">equal bit lengths to all </span><span class="line" data-startTime="1453">the symbols themselves. </span></p>

<p><span class="line" data-startTime="1454">Because of this, we really don't </span><span class="line" data-startTime="1454">get any compression savings </span><span class="line" data-startTime="1457">at all from the GZIP algorithm </span><span class="line" data-startTime="1457">for this particular data </span><span class="line" data-startTime="1460">stream. </span> <span class="line" data-startTime="1461">This means that you have </span><span class="line" data-startTime="1461">to look at your data </span><span class="line" data-startTime="1465">and go, what is </span><span class="line" data-startTime="1465">GZIP doing to it? </span><span class="line" data-startTime="1467">If we, however, take a </span><span class="line" data-startTime="1467">little bit different swing </span><span class="line" data-startTime="1470">at the problem itself, </span><span class="line" data-startTime="1470">we can actually </span><span class="line" data-startTime="1472">beat what GZIP is doing with a </span><span class="line" data-startTime="1472">little knowledge of our data. </span> <span class="line" data-startTime="1475">So let's say we take </span><span class="line" data-startTime="1475">the original array, </span><span class="line" data-startTime="1478">and instead of just </span><span class="line" data-startTime="1478">leaving it by itself, </span><span class="line" data-startTime="1480">we actually notice the </span><span class="line" data-startTime="1480">property that we can actually </span><span class="line" data-startTime="1482">sort this information because </span><span class="line" data-startTime="1482">we don't need the order </span><span class="line" data-startTime="1484">to come out on the backside. </span> <span class="line" data-startTime="1486">So if we sort this, </span><span class="line" data-startTime="1486">we actually end up </span><span class="line" data-startTime="1488">with a pretty incrementing </span><span class="line" data-startTime="1488">run of numbers &mdash; zero to nine </span><span class="line" data-startTime="1491">without any gaps in the middle. </span> <span class="line" data-startTime="1493">We can take this string </span><span class="line" data-startTime="1493">and apply a technique known </span><span class="line" data-startTime="1496">as delta encoding to actually </span><span class="line" data-startTime="1496">create a different symbol set. </span></p>

<p><span class="line" data-startTime="1500">Now, delta encoding </span><span class="line" data-startTime="1500">works by taking a symbol </span><span class="line" data-startTime="1503">and finding the </span><span class="line" data-startTime="1503">difference in the symbol </span><span class="line" data-startTime="1505">between the previous symbol, </span><span class="line" data-startTime="1505">and it encodes the difference </span><span class="line" data-startTime="1508">rather than the actual value. </span> <span class="line" data-startTime="1510">So for our specific </span><span class="line" data-startTime="1510">example here, </span><span class="line" data-startTime="1512">we start with the number </span><span class="line" data-startTime="1512">zero, and the number one </span><span class="line" data-startTime="1514">is one more, so we </span><span class="line" data-startTime="1514">add one to that. </span> <span class="line" data-startTime="1516">Two is greater than </span><span class="line" data-startTime="1516">one by a single value, </span><span class="line" data-startTime="1519">so we had one, one, </span><span class="line" data-startTime="1519">one, one, one, one. </span> <span class="line" data-startTime="1521">And you can see </span><span class="line" data-startTime="1521">with delta encoding, </span><span class="line" data-startTime="1522">all we have to do is encode </span><span class="line" data-startTime="1522">one and then eight zeros </span><span class="line" data-startTime="1526">to actually represent the </span><span class="line" data-startTime="1526">original string we have. </span> <span class="line" data-startTime="1529">Now, the delta encoded </span><span class="line" data-startTime="1529">version, notice </span><span class="line" data-startTime="1532">that it does have a lot </span><span class="line" data-startTime="1532">of duplicate symbols, </span><span class="line" data-startTime="1534">and there is a </span><span class="line" data-startTime="1534">particular symbol which </span><span class="line" data-startTime="1536">is more dominant than </span><span class="line" data-startTime="1536">the other symbols. </span> <span class="line" data-startTime="1538">Now, once we've encoded </span><span class="line" data-startTime="1538">our data into this form, </span><span class="line" data-startTime="1543">GZIP actually has a field day. </span></p>

<p><span class="line" data-startTime="1545">The LZ77 algorithm finds lots </span><span class="line" data-startTime="1545">of matches in its window, </span><span class="line" data-startTime="1548">and the arithmetic </span><span class="line" data-startTime="1548">compressor can actually </span><span class="line" data-startTime="1550">come through and assign </span><span class="line" data-startTime="1550">smaller bit codes </span><span class="line" data-startTime="1553">to more frequent streams. </span> <span class="line" data-startTime="1555">What we're showing you </span><span class="line" data-startTime="1555">here is that you can't just </span><span class="line" data-startTime="1557">throw arbitrary data </span><span class="line" data-startTime="1557">at GZIP and expect </span><span class="line" data-startTime="1559">to get the most perfect, </span><span class="line" data-startTime="1559">amazing form of compression. </span> <span class="line" data-startTime="1563">Instead, a little </span><span class="line" data-startTime="1563">bit of preprocessing </span><span class="line" data-startTime="1565">can actually change the </span><span class="line" data-startTime="1565">way your compression works, </span><span class="line" data-startTime="1567">most of the time for the better. </span> <span class="line" data-startTime="1569">Now, let's look at </span><span class="line" data-startTime="1569">another perfect example </span><span class="line" data-startTime="1572">of where GZIP can actually </span><span class="line" data-startTime="1572">cause some problems. </span></p>

<p><span class="line" data-startTime="1573">So if you look at my website, I </span><span class="line" data-startTime="1573">did a little bit of an analysis </span><span class="line" data-startTime="1577">a while ago on various forms of </span><span class="line" data-startTime="1577">CSS minimization technologies. </span> <span class="line" data-startTime="1581">There was a </span><span class="line" data-startTime="1581">fantastic set of code </span><span class="line" data-startTime="1583">out there by someone who </span><span class="line" data-startTime="1583">was using genetic algorithms </span><span class="line" data-startTime="1585">to figure out optimal </span><span class="line" data-startTime="1585">ways to minify CSS data. </span> <span class="line" data-startTime="1589">So let's take a look </span><span class="line" data-startTime="1589">at this table here. </span> <span class="line" data-startTime="1591">So if we take two CSS files from </span><span class="line" data-startTime="1591">StackOverflow and Bootstrap, </span><span class="line" data-startTime="1595">and we actually look at </span><span class="line" data-startTime="1595">their minified forms &mdash; </span><span class="line" data-startTime="1597">so this has already been run </span><span class="line" data-startTime="1597">through Closure or YUI or Clean </span><span class="line" data-startTime="1602">CSS, one of these things &mdash; we </span><span class="line" data-startTime="1602">actually get about 90 and 97k, </span><span class="line" data-startTime="1607">respectively. </span></p>

<p><span class="line" data-startTime="1608">Now, using the genetic </span><span class="line" data-startTime="1608">algorithm version </span><span class="line" data-startTime="1611">of the minifier actually </span><span class="line" data-startTime="1611">produced about 3% savings </span><span class="line" data-startTime="1614">in both of these </span><span class="line" data-startTime="1614">files, which meant </span><span class="line" data-startTime="1616">that we can use a different </span><span class="line" data-startTime="1616">variant of minification to get </span><span class="line" data-startTime="1619">wins over what we're </span><span class="line" data-startTime="1619">typically already doing. </span> <span class="line" data-startTime="1622">So this is a good idea. </span> <span class="line" data-startTime="1623">If we find a better algorithm </span><span class="line" data-startTime="1623">that minifies our data smaller, </span><span class="line" data-startTime="1627">we should be embracing that. </span> <span class="line" data-startTime="1629">This is where GZIP actually </span><span class="line" data-startTime="1629">causes some trouble. </span> <span class="line" data-startTime="1631">When we actually run these </span><span class="line" data-startTime="1631">genetically algorithmically </span><span class="line" data-startTime="1635">minimized data through </span><span class="line" data-startTime="1635">the GZIP compressor, </span><span class="line" data-startTime="1639">you can see the results </span><span class="line" data-startTime="1639">are actually negative. </span> <span class="line" data-startTime="1641">That means it's actually </span><span class="line" data-startTime="1641">growing the data. </span></p>

<p><span class="line" data-startTime="1643">So we have our minified.GZIP. </span> <span class="line" data-startTime="1645">So if we just zip the data </span><span class="line" data-startTime="1645">that comes from Clean CSS </span><span class="line" data-startTime="1649">or Closure, we get </span><span class="line" data-startTime="1649">about 18 and 15k. </span> <span class="line" data-startTime="1651">However, when we </span><span class="line" data-startTime="1651">zip the data that's </span><span class="line" data-startTime="1654">been generated from </span><span class="line" data-startTime="1654">our genetic algorithm, </span><span class="line" data-startTime="1656">you can see that we're </span><span class="line" data-startTime="1656">actually increasing </span><span class="line" data-startTime="1658">the size of the file. </span> <span class="line" data-startTime="1660">Basically, what you're </span><span class="line" data-startTime="1660">seeing is that the data is so </span><span class="line" data-startTime="1663">minimized coming from </span><span class="line" data-startTime="1663">the genetic algorithm </span><span class="line" data-startTime="1665">that GZIP is actually </span><span class="line" data-startTime="1665">inflating the data. </span> <span class="line" data-startTime="1667">It's making your </span><span class="line" data-startTime="1667">file larger than it </span><span class="line" data-startTime="1669">should be because it's only </span><span class="line" data-startTime="1669">using the LZ77 and Huffman </span><span class="line" data-startTime="1673">encoding steps. </span> <span class="line" data-startTime="1674">Now, this should </span><span class="line" data-startTime="1674">scare a lot of people, </span><span class="line" data-startTime="1676">hopefully, into thinking </span><span class="line" data-startTime="1676">how often this is actually </span><span class="line" data-startTime="1679">occurring on the internet </span><span class="line" data-startTime="1679">for various size of files. </span> <span class="line" data-startTime="1682">Now, I can tell you </span><span class="line" data-startTime="1682">it's not that frequent, </span><span class="line" data-startTime="1684">but it is something to keep an </span><span class="line" data-startTime="1684">eye on because it definitely </span><span class="line" data-startTime="1686">shows that GZIP is </span><span class="line" data-startTime="1686">not a silver bullet </span><span class="line" data-startTime="1688">and that it can actually </span><span class="line" data-startTime="1688">do harmful things in very </span><span class="line" data-startTime="1690">certain circumstances. </span></p>

<p><span class="line" data-startTime="1692">Now of course, a </span><span class="line" data-startTime="1692">lot of people here </span><span class="line" data-startTime="1694">would then say, well, </span><span class="line" data-startTime="1694">this means we shouldn't </span><span class="line" data-startTime="1696">be using this genetic </span><span class="line" data-startTime="1696">algorithm to minimize our CSS. </span> <span class="line" data-startTime="1699">Obviously, that's a flop. </span> <span class="line" data-startTime="1700">And I still think that </span><span class="line" data-startTime="1700">that's the wrong argument, </span><span class="line" data-startTime="1702">but let's move on. </span> <span class="line" data-startTime="1704">Now, let's talk </span><span class="line" data-startTime="1704">about PNG for minute. </span> <span class="line" data-startTime="1706">Now, PNG is a format </span><span class="line" data-startTime="1706">that you can actually </span><span class="line" data-startTime="1708">export in a compressed form. </span> <span class="line" data-startTime="1710">Now internal to PNG, the </span><span class="line" data-startTime="1710">compression algorithm it uses </span><span class="line" data-startTime="1713">is called deflate, pretty much </span><span class="line" data-startTime="1713">the backbone of what GZIP uses. </span> <span class="line" data-startTime="1718">It's LZ77 coupled with a </span><span class="line" data-startTime="1718">Huffman compressor step. </span> <span class="line" data-startTime="1721">Now, what you're looking at on </span><span class="line" data-startTime="1721">the screen here is two images. </span> <span class="line" data-startTime="1724">Effectively, I took a 90 </span><span class="line" data-startTime="1724">pixel by 90 pixel sprite, </span><span class="line" data-startTime="1727">and I tiled it vertically, </span><span class="line" data-startTime="1727">creating a 90 by 270 image. </span></p>

<p><span class="line" data-startTime="1732">Now, I resized that </span><span class="line" data-startTime="1732">image just a little bit </span><span class="line" data-startTime="1735">and added two columns of </span><span class="line" data-startTime="1735">pixels, so we now have a 92 </span><span class="line" data-startTime="1739">by 270 image instead </span><span class="line" data-startTime="1739">of a 90 by 270. </span> <span class="line" data-startTime="1742">So we've barely altered </span><span class="line" data-startTime="1742">the size of the data. </span> <span class="line" data-startTime="1745">However, you can </span><span class="line" data-startTime="1745">see at the bottom </span><span class="line" data-startTime="1747">there that the sizes post-GZIP </span><span class="line" data-startTime="1747">are drastically different. </span> <span class="line" data-startTime="1753">The 90 by 270 </span><span class="line" data-startTime="1753">image is about 20k, </span><span class="line" data-startTime="1756">while the 92 pixel image is 41k. </span> <span class="line" data-startTime="1759">That's twice as large for </span><span class="line" data-startTime="1759">only two columns of pixels </span><span class="line" data-startTime="1763">being added to the image. </span> <span class="line" data-startTime="1764">And again, the </span><span class="line" data-startTime="1764">compression algorithm </span><span class="line" data-startTime="1766">that's being used under the </span><span class="line" data-startTime="1766">hood here is effectively GZIP. </span></p>

<p><span class="line" data-startTime="1769">So let's take a look at </span><span class="line" data-startTime="1769">why this is occurring </span><span class="line" data-startTime="1771">and what's going on. </span> <span class="line" data-startTime="1773">So let's say we've got a </span><span class="line" data-startTime="1773">bunch of pixel colors here. </span> <span class="line" data-startTime="1775">Well remember, </span><span class="line" data-startTime="1775">the LZ77 algorithm </span><span class="line" data-startTime="1777">is going to come </span><span class="line" data-startTime="1777">through, and it's </span><span class="line" data-startTime="1778">going to try to find matches. </span> <span class="line" data-startTime="1779">So we've got a particular </span><span class="line" data-startTime="1779">green pixel here </span><span class="line" data-startTime="1782">and another green </span><span class="line" data-startTime="1782">pixel that's identical </span><span class="line" data-startTime="1784">to this somewhere previous </span><span class="line" data-startTime="1784">in our data stream. </span> <span class="line" data-startTime="1787">Now, how this works is that </span><span class="line" data-startTime="1787">LZ77 won't scan infinitely </span><span class="line" data-startTime="1792">to try to find matches. </span></p>

<p><span class="line" data-startTime="1793">Instead, it actually </span><span class="line" data-startTime="1793">operates in a window </span><span class="line" data-startTime="1796">of 32k worth of information. </span> <span class="line" data-startTime="1799">Now, that means if I </span><span class="line" data-startTime="1799">encounter a symbol that's </span><span class="line" data-startTime="1802">outside of that window, then </span><span class="line" data-startTime="1802">I'm not going to find a match. </span> <span class="line" data-startTime="1805">It only matches things </span><span class="line" data-startTime="1805">inside of a 32k window. </span> <span class="line" data-startTime="1808">So if we look at </span><span class="line" data-startTime="1808">our 90 by 90 images </span><span class="line" data-startTime="1810">that we created for </span><span class="line" data-startTime="1810">our tile sheet there, </span><span class="line" data-startTime="1813">90 times 90 times </span><span class="line" data-startTime="1813">4 bytes per pixel </span><span class="line" data-startTime="1817">is roughly about 32k in size. </span> <span class="line" data-startTime="1821">Now, if we actually </span><span class="line" data-startTime="1821">look at 32 times 1,024, </span><span class="line" data-startTime="1823">the real definition </span><span class="line" data-startTime="1823">of 32k, it's, </span><span class="line" data-startTime="1825">again, about 300 bytes </span><span class="line" data-startTime="1825">larger than our 90 by 90. </span> <span class="line" data-startTime="1829">However, when we added </span><span class="line" data-startTime="1829">those two columns of pixels, </span><span class="line" data-startTime="1833">we actually changed the size </span><span class="line" data-startTime="1833">and the stride of our images. </span></p>

<p><span class="line" data-startTime="1836">90 by 92 by 4 is </span><span class="line" data-startTime="1836">actually 33k, not 32k. </span> <span class="line" data-startTime="1841">What this means </span><span class="line" data-startTime="1841">is that when we're </span><span class="line" data-startTime="1843">trying to find duplicate </span><span class="line" data-startTime="1843">pixels in this image, </span><span class="line" data-startTime="1846">we're just far enough away that </span><span class="line" data-startTime="1846">we can't find the exact pixel </span><span class="line" data-startTime="1850">that we had seen before. </span> <span class="line" data-startTime="1851">Let's take a look </span><span class="line" data-startTime="1851">at this visually. </span> <span class="line" data-startTime="1853">So again, we have our two </span><span class="line" data-startTime="1853">images, the 20k and the 41k, </span><span class="line" data-startTime="1856">and we can actually </span><span class="line" data-startTime="1856">create a heat map </span><span class="line" data-startTime="1858">for this image representation. </span> <span class="line" data-startTime="1860">Now, this heat map shows </span><span class="line" data-startTime="1860">us in dark blue pixels </span><span class="line" data-startTime="1863">being the ones that </span><span class="line" data-startTime="1863">are highly compressed. </span> <span class="line" data-startTime="1865">This is where matches </span><span class="line" data-startTime="1865">have been found. </span> <span class="line" data-startTime="1867">They're very small, encoded </span><span class="line" data-startTime="1867">pixels at this point. </span> <span class="line" data-startTime="1870">Meanwhile, reds and yellows mean </span><span class="line" data-startTime="1870">that we didn't find a match, </span><span class="line" data-startTime="1874">and to encode this particular </span><span class="line" data-startTime="1874">pixel took a lot more bits. </span> <span class="line" data-startTime="1878">So you can see on the left hand </span><span class="line" data-startTime="1878">side, where we're 90 by 270, </span><span class="line" data-startTime="1881">we actually get a </span><span class="line" data-startTime="1881">lot more matches. </span></p>

<p><span class="line" data-startTime="1883">The dominant form of </span><span class="line" data-startTime="1883">the image is dark blue. </span> <span class="line" data-startTime="1885">You can see once we tiled that </span><span class="line" data-startTime="1885">image in the lower two regions, </span><span class="line" data-startTime="1889">that we find an exact pixel </span><span class="line" data-startTime="1889">matching 32k pixels away. </span> <span class="line" data-startTime="1893">However, when we increase </span><span class="line" data-startTime="1893">the size by two columns, </span><span class="line" data-startTime="1895">we've actually bumped out the </span><span class="line" data-startTime="1895">window of pixels to look at. </span> <span class="line" data-startTime="1900">Therefore, we're not actually </span><span class="line" data-startTime="1900">finding exact matches. </span> <span class="line" data-startTime="1902">In fact, we have to </span><span class="line" data-startTime="1902">look for near matches, </span><span class="line" data-startTime="1904">and that's why the second </span><span class="line" data-startTime="1904">image has a lot more misses </span><span class="line" data-startTime="1907">in the LZ77 cache, </span><span class="line" data-startTime="1907">resulting in worse encoding. </span> <span class="line" data-startTime="1911">Now, this basically shows </span><span class="line" data-startTime="1911">us that with small changes </span><span class="line" data-startTime="1915">to our image data, the </span><span class="line" data-startTime="1915">GZIP algorithm actually </span><span class="line" data-startTime="1917">falls completely on its face. </span> <span class="line" data-startTime="1919">Again, it's far from </span><span class="line" data-startTime="1919">being a silver bullet. </span> <span class="line" data-startTime="1922">Now, the truth is that at this </span><span class="line" data-startTime="1922">time you should be saying, </span><span class="line" data-startTime="1924">well hey, it'd be </span><span class="line" data-startTime="1924">great if we could </span><span class="line" data-startTime="1925">use one of the newer algorithms. </span> <span class="line" data-startTime="1927">But in reality, </span><span class="line" data-startTime="1927">we're stuck with GZIP </span><span class="line" data-startTime="1930">for some indefinite future. </span> <span class="line" data-startTime="1932">Here's why. </span> <span class="line" data-startTime="1933">If you actually go to </span><span class="line" data-startTime="1933">the Chromium source code </span><span class="line" data-startTime="1935">and look at the bug system </span><span class="line" data-startTime="1935">that's provided there, </span><span class="line" data-startTime="1937">you'll find an interesting </span><span class="line" data-startTime="1937">tale of how Chrome actually </span><span class="line" data-startTime="1942">adopted the BZIP2 </span><span class="line" data-startTime="1942">compression format. </span></p>

<p><span class="line" data-startTime="1945">Effectively, Chrome </span><span class="line" data-startTime="1945">added support for it, </span><span class="line" data-startTime="1946">and a lot of servers &mdash; </span><span class="line" data-startTime="1946">Apache and whatnot &mdash; </span><span class="line" data-startTime="1948">added support to send </span><span class="line" data-startTime="1948">out BZIP2 content. </span> <span class="line" data-startTime="1951">So effectively, a server creates </span><span class="line" data-startTime="1951">a BZIP2 file instead of GZIP </span><span class="line" data-startTime="1954">and sends it off to servers. </span> <span class="line" data-startTime="1956">However, what started </span><span class="line" data-startTime="1956">happening in the wild </span><span class="line" data-startTime="1958">was a little bit </span><span class="line" data-startTime="1958">interesting to us, </span><span class="line" data-startTime="1960">and the results made </span><span class="line" data-startTime="1960">us actually have </span><span class="line" data-startTime="1961">to remove the support </span><span class="line" data-startTime="1961">for BZIP2 from Chrome. </span> <span class="line" data-startTime="1965">You see, what was happening </span><span class="line" data-startTime="1965">was a lot of these middle boxes </span><span class="line" data-startTime="1968">that are out there in </span><span class="line" data-startTime="1968">the wild didn't ever </span><span class="line" data-startTime="1970">expect that we would do </span><span class="line" data-startTime="1970">anything besides GZIP, </span><span class="line" data-startTime="1973">and they actually had hard coded </span><span class="line" data-startTime="1973">paths in there to look and say, </span><span class="line" data-startTime="1978">if this is not GZIP </span><span class="line" data-startTime="1978">header compressed, </span><span class="line" data-startTime="1981">compress it with GZIP. </span></p>

<p><span class="line" data-startTime="1982">So effectively, what occurred </span><span class="line" data-startTime="1982">was some servers, when </span><span class="line" data-startTime="1985">they received the BZIP2 </span><span class="line" data-startTime="1985">archive or the BZIP2 header, </span><span class="line" data-startTime="1989">and these middle boxes </span><span class="line" data-startTime="1989">would look at it and say, </span><span class="line" data-startTime="1991">hey, this isn't GZIP. </span> <span class="line" data-startTime="1992">Strip the header, try </span><span class="line" data-startTime="1992">to GZIP the information, </span><span class="line" data-startTime="1994">and then send it out. </span> <span class="line" data-startTime="1995">This means Chrome would </span><span class="line" data-startTime="1995">actually receive a BZIP2 data </span><span class="line" data-startTime="1999">package whose header </span><span class="line" data-startTime="1999">had been stripped </span><span class="line" data-startTime="2001">and then it had been re-gzipped. </span> <span class="line" data-startTime="2003">So we would have no idea what </span><span class="line" data-startTime="2003">the actual format of the data </span><span class="line" data-startTime="2005">is that we're receiving. </span> <span class="line" data-startTime="2007">It could be binary data, </span><span class="line" data-startTime="2007">or it could actually </span><span class="line" data-startTime="2009">be valid information. </span> <span class="line" data-startTime="2010">The problem was this was </span><span class="line" data-startTime="2010">so systemic out there </span><span class="line" data-startTime="2012">in the wild for various types </span><span class="line" data-startTime="2012">of firmware and middle boxes </span><span class="line" data-startTime="2015">that it was actually </span><span class="line" data-startTime="2015">too difficult for us </span><span class="line" data-startTime="2017">to fix on the fly, which </span><span class="line" data-startTime="2017">means it was a smarter idea </span><span class="line" data-startTime="2020">to actually just remove </span><span class="line" data-startTime="2020">this from Chrome. </span> <span class="line" data-startTime="2021">So when you start </span><span class="line" data-startTime="2021">talking about the ability </span><span class="line" data-startTime="2023">to add other compression </span><span class="line" data-startTime="2023">algorithms to the base browser, </span><span class="line" data-startTime="2026">you're going to run </span><span class="line" data-startTime="2026">into the same problem. </span></p>

<p><span class="line" data-startTime="2028">There's a lot of </span><span class="line" data-startTime="2028">systems out there </span><span class="line" data-startTime="2030">who just don't </span><span class="line" data-startTime="2030">understand and haven't </span><span class="line" data-startTime="2032">been updated to expand to </span><span class="line" data-startTime="2032">different sorts of compression </span><span class="line" data-startTime="2035">technologies. </span> <span class="line" data-startTime="2037">So this gets us to an </span><span class="line" data-startTime="2037">interesting idea of well, </span><span class="line" data-startTime="2040">if we're stuck with GZIP, but </span><span class="line" data-startTime="2040">size of text data is a problem, </span><span class="line" data-startTime="2044">how do we actually create </span><span class="line" data-startTime="2044">smaller GZIP files? </span><span class="line" data-startTime="2046">Well lucky for </span><span class="line" data-startTime="2046">you, I've actually </span><span class="line" data-startTime="2047">spent the past three or four </span><span class="line" data-startTime="2047">months focusing explicitly </span><span class="line" data-startTime="2050">on this problem, </span><span class="line" data-startTime="2050">and you can actually </span><span class="line" data-startTime="2051">see a lot of the results on my </span><span class="line" data-startTime="2051">blog at mainroach.blogspot.com. </span> <span class="line" data-startTime="2054">But first, let's dive into </span><span class="line" data-startTime="2054">a couple of these ideas, </span><span class="line" data-startTime="2058">and then you can </span><span class="line" data-startTime="2058">go there and read </span><span class="line" data-startTime="2059">about all the awesome things. </span> <span class="line" data-startTime="2061">So first off, we can actually </span><span class="line" data-startTime="2061">generate better GZIP files. </span> <span class="line" data-startTime="2066">A lot of people don't </span><span class="line" data-startTime="2066">understand this, </span><span class="line" data-startTime="2067">but when your server creates </span><span class="line" data-startTime="2067">your GZIP file, a lot of them </span><span class="line" data-startTime="2071">are only tuned to compress </span><span class="line" data-startTime="2071">it at a factor of six. </span></p>

<p><span class="line" data-startTime="2080">The command line parameter </span><span class="line" data-startTime="2080">that you pass to GZIP </span><span class="line" data-startTime="2082">allows you to pass in </span><span class="line" data-startTime="2082">between zero and nine, </span><span class="line" data-startTime="2085">where most of the servers </span><span class="line" data-startTime="2085">are default set to six. </span> <span class="line" data-startTime="2087">This seems to be an </span><span class="line" data-startTime="2087">interesting trade-off </span><span class="line" data-startTime="2089">between compression speed </span><span class="line" data-startTime="2089">and compression size. </span> <span class="line" data-startTime="2092">Now, this is mostly </span><span class="line" data-startTime="2092">because web developers </span><span class="line" data-startTime="2095">tend to just upload raw </span><span class="line" data-startTime="2095">assets to the server, </span><span class="line" data-startTime="2097">not wanting to deal </span><span class="line" data-startTime="2097">with compression. </span> <span class="line" data-startTime="2099">The server actually is </span><span class="line" data-startTime="2099">responsible for compressing </span><span class="line" data-startTime="2101">the content and then </span><span class="line" data-startTime="2101">sending it off to requests. </span> <span class="line" data-startTime="2104">Now, what's </span><span class="line" data-startTime="2104">interesting about this, </span><span class="line" data-startTime="2105">though, is that you </span><span class="line" data-startTime="2105">can modify your files </span><span class="line" data-startTime="2108">and actually GZIP them offline. </span> <span class="line" data-startTime="2110">So effectively, </span><span class="line" data-startTime="2110">part of your build </span><span class="line" data-startTime="2112">step would be to take </span><span class="line" data-startTime="2112">your text information, </span><span class="line" data-startTime="2115">GZIP it with some better </span><span class="line" data-startTime="2115">compressor to produce a smaller </span><span class="line" data-startTime="2118">GZIP file, and then </span><span class="line" data-startTime="2118">actually tell the server </span><span class="line" data-startTime="2120">to just pass that data through. </span></p>

<p><span class="line" data-startTime="2122">There's two applications out </span><span class="line" data-startTime="2122">there that could actually </span><span class="line" data-startTime="2125">produce this type of </span><span class="line" data-startTime="2125">smaller GZIP file. </span> <span class="line" data-startTime="2127">The first one is 7-Zip. </span> <span class="line" data-startTime="2128">This is actually a </span><span class="line" data-startTime="2128">very nice command line </span><span class="line" data-startTime="2132">tool which can produce BZIP2 </span><span class="line" data-startTime="2132">archives as well as GZIP </span><span class="line" data-startTime="2135">archives, but it does </span><span class="line" data-startTime="2135">so taking advantage </span><span class="line" data-startTime="2138">of the more modern, </span><span class="line" data-startTime="2138">more powerful searching </span><span class="line" data-startTime="2141">and dictionary based </span><span class="line" data-startTime="2141">compression algorithms </span><span class="line" data-startTime="2144">that it's going to be using. </span> <span class="line" data-startTime="2145">So 7-Zip can actually produce </span><span class="line" data-startTime="2145">smaller versions of GZIP files </span><span class="line" data-startTime="2149">than the standard command </span><span class="line" data-startTime="2149">line GZIP archiver </span><span class="line" data-startTime="2151">that ships with most </span><span class="line" data-startTime="2151">firmware in servers. </span></p>

<p><span class="line" data-startTime="2154">Another fantastic tool out </span><span class="line" data-startTime="2154">there is one called Zopfli. </span> <span class="line" data-startTime="2156">Now, this was actually </span><span class="line" data-startTime="2156">created by the engineers </span><span class="line" data-startTime="2158">here at Google to solve </span><span class="line" data-startTime="2158">this same problem. </span> <span class="line" data-startTime="2161">Now, Zopfli uses a lot more </span><span class="line" data-startTime="2161">memory and a lot more advanced </span><span class="line" data-startTime="2164">algorithms than even 7-Zip to </span><span class="line" data-startTime="2164">find better matches in smaller </span><span class="line" data-startTime="2168">spaces to produce smaller </span><span class="line" data-startTime="2168">GZIP files as well. </span> <span class="line" data-startTime="2172">It's an open source project. </span> <span class="line" data-startTime="2173">You can go check it out. </span></p>

<p><span class="line" data-startTime="2174">I highly recommend it </span><span class="line" data-startTime="2174">if you're interested. </span> <span class="line" data-startTime="2176">So the cool thing is we can </span><span class="line" data-startTime="2176">use either 7-Zip or Zopfli </span><span class="line" data-startTime="2179">as part of your build process to </span><span class="line" data-startTime="2179">actually generate smaller text </span><span class="line" data-startTime="2181">files and have them sent </span><span class="line" data-startTime="2181">along on behalf of the user. </span> <span class="line" data-startTime="2184">And again, these are </span><span class="line" data-startTime="2184">GZIPs, so they're </span><span class="line" data-startTime="2186">going to be accepted by </span><span class="line" data-startTime="2186">the middle boxes as well </span><span class="line" data-startTime="2188">as the browsers. </span> <span class="line" data-startTime="2189">Now, if you're wondering </span><span class="line" data-startTime="2189">how these preprocessing </span><span class="line" data-startTime="2192">systems actually fare </span><span class="line" data-startTime="2192">against the standard GZIP, </span><span class="line" data-startTime="2195">here's a great graph to look at. </span> <span class="line" data-startTime="2196">So you can actually </span><span class="line" data-startTime="2196">see the blue column </span><span class="line" data-startTime="2198">across the bunch of files is </span><span class="line" data-startTime="2198">actually the standard GZIP </span><span class="line" data-startTime="2201">algorithm. </span> <span class="line" data-startTime="2202">The red one is actually </span><span class="line" data-startTime="2202">Zopfli, and the green one </span><span class="line" data-startTime="2205">is actually 7-Zip. </span> <span class="line" data-startTime="2206">So you can see </span><span class="line" data-startTime="2206">across these 42 files </span><span class="line" data-startTime="2210">that on average, in fact, </span><span class="line" data-startTime="2210">most of the time, both Zopfli </span><span class="line" data-startTime="2214">and 7-Zip regularly beat GZIP </span><span class="line" data-startTime="2214">by somewhere between 2% to 10%. </span></p>

<p><span class="line" data-startTime="2219">And if you actually </span><span class="line" data-startTime="2219">increase your parameters </span><span class="line" data-startTime="2222">and allow Zopfli and 7-Zip to </span><span class="line" data-startTime="2222">spend more time doing matching </span><span class="line" data-startTime="2225">and doing compression, </span><span class="line" data-startTime="2225">you can actually </span><span class="line" data-startTime="2226">get it into the 15% </span><span class="line" data-startTime="2226">ratio, which is fantastic. </span> <span class="line" data-startTime="2229">Now, the cost of this, </span><span class="line" data-startTime="2229">though, is enormous. </span> <span class="line" data-startTime="2232">A lot of these algorithms </span><span class="line" data-startTime="2232">took probably 20 minutes </span><span class="line" data-startTime="2235">to run &mdash; on the light </span><span class="line" data-startTime="2235">side &mdash; to find 1% to 5% </span><span class="line" data-startTime="2239">worth of compression wins. </span> <span class="line" data-startTime="2240">Basically, what we </span><span class="line" data-startTime="2240">found is that we're </span><span class="line" data-startTime="2242">at a local minima </span><span class="line" data-startTime="2242">for compression. </span> <span class="line" data-startTime="2245">The more time we spend trying </span><span class="line" data-startTime="2245">to compress the content </span><span class="line" data-startTime="2248">yields less and less </span><span class="line" data-startTime="2248">and less actual savings. </span></p>

<p><span class="line" data-startTime="2251">You could spend </span><span class="line" data-startTime="2251">six hours of cloud </span><span class="line" data-startTime="2252">compute time to get 2% savings </span><span class="line" data-startTime="2252">in your compression algorithm. </span> <span class="line" data-startTime="2256">So at this point, you </span><span class="line" data-startTime="2256">have to look and say, </span><span class="line" data-startTime="2258">well, if we're stuck </span><span class="line" data-startTime="2258">with GZIP, yet it </span><span class="line" data-startTime="2260">takes additional hours of </span><span class="line" data-startTime="2260">time to compute smaller GZIP </span><span class="line" data-startTime="2263">files, what the heck is </span><span class="line" data-startTime="2263">this entire talk about? </span><span class="line" data-startTime="2266">Aren't we just stuck in this? </span><span class="line" data-startTime="2268">Fret not, my good friends. </span> <span class="line" data-startTime="2269">You're actually not </span><span class="line" data-startTime="2269">stuck, and it actually </span><span class="line" data-startTime="2271">comes down to you </span><span class="line" data-startTime="2271">owning your data. </span> <span class="line" data-startTime="2273">You see, you can create </span><span class="line" data-startTime="2273">smaller GZIP files </span><span class="line" data-startTime="2276">by actually preprocessing </span><span class="line" data-startTime="2276">your information </span><span class="line" data-startTime="2278">before handing it off to GZIP. </span> <span class="line" data-startTime="2280">Much like the example </span><span class="line" data-startTime="2280">I gave earlier </span><span class="line" data-startTime="2281">where we took a set of numbers </span><span class="line" data-startTime="2281">and then delta compressed them </span><span class="line" data-startTime="2284">to create something that was </span><span class="line" data-startTime="2284">highly repetitive and highly </span><span class="line" data-startTime="2287">compressible, you can </span><span class="line" data-startTime="2287">apply these techniques </span><span class="line" data-startTime="2289">to a lot of other portions </span><span class="line" data-startTime="2289">of your code base. </span></p>

<p><span class="line" data-startTime="2291">So let's dive into some </span><span class="line" data-startTime="2291">interesting algorithms </span><span class="line" data-startTime="2293">you can use in your </span><span class="line" data-startTime="2293">projects today. </span> <span class="line" data-startTime="2297">The first one happens to be </span><span class="line" data-startTime="2297">close and near to my heart. </span> <span class="line" data-startTime="2300">Now, many applications </span><span class="line" data-startTime="2300">and many websites </span><span class="line" data-startTime="2302">out there use JSON as </span><span class="line" data-startTime="2302">a format to transfer </span><span class="line" data-startTime="2305">data between client and server. </span> <span class="line" data-startTime="2307">Social media </span><span class="line" data-startTime="2307">information is typically </span><span class="line" data-startTime="2309">sent around in this information. </span> <span class="line" data-startTime="2310">It's a very nice, very </span><span class="line" data-startTime="2310">adopted file format </span><span class="line" data-startTime="2313">for sending information around, </span><span class="line" data-startTime="2313">particularly because it's </span><span class="line" data-startTime="2316">built off the </span><span class="line" data-startTime="2316">JavaScript standard. </span></p>

<p><span class="line" data-startTime="2318">Now, when you're sending </span><span class="line" data-startTime="2318">this data around, </span><span class="line" data-startTime="2321">though, most of the time, </span><span class="line" data-startTime="2321">users and developers </span><span class="line" data-startTime="2323">don't think about how to </span><span class="line" data-startTime="2323">modify the data being sent such </span><span class="line" data-startTime="2328">that it compresses better. </span> <span class="line" data-startTime="2329">So a user asks for </span><span class="line" data-startTime="2329">some search query. </span> <span class="line" data-startTime="2331">The server goes and </span><span class="line" data-startTime="2331">computes the information </span><span class="line" data-startTime="2333">and then returns </span><span class="line" data-startTime="2333">the JSON blob back, </span><span class="line" data-startTime="2336">normally optimizing for </span><span class="line" data-startTime="2336">return round trip time. </span> <span class="line" data-startTime="2338">It's trying to get the </span><span class="line" data-startTime="2338">data back to the user </span><span class="line" data-startTime="2340">as fast as possible. </span> <span class="line" data-startTime="2341">But what they don't </span><span class="line" data-startTime="2341">understand is if they actually </span><span class="line" data-startTime="2343">have that GZIP flag </span><span class="line" data-startTime="2343">turned on, GZIP </span><span class="line" data-startTime="2346">is going to stop the </span><span class="line" data-startTime="2346">operation and zip the content </span><span class="line" data-startTime="2348">before sending it down </span><span class="line" data-startTime="2348">to the client anyway. </span> <span class="line" data-startTime="2350">Now, if you're the </span><span class="line" data-startTime="2350">type of developer </span><span class="line" data-startTime="2351">that's dealing in third world </span><span class="line" data-startTime="2351">countries or other types </span><span class="line" data-startTime="2354">of connectivity that may </span><span class="line" data-startTime="2354">be sparse or intermittent, </span><span class="line" data-startTime="2358">this is actually a huge problem </span><span class="line" data-startTime="2358">because your client device &mdash; </span><span class="line" data-startTime="2362">usually a mobile device </span><span class="line" data-startTime="2362">on some 1G or 2G network </span><span class="line" data-startTime="2365">that may or may not </span><span class="line" data-startTime="2365">stay consistent &mdash; </span><span class="line" data-startTime="2367">is sending off </span><span class="line" data-startTime="2367">requests, and then </span><span class="line" data-startTime="2369">what's hurting them </span><span class="line" data-startTime="2369">is that they're </span><span class="line" data-startTime="2370">getting a larger </span><span class="line" data-startTime="2370">payload coming down. </span></p>

<p><span class="line" data-startTime="2372">So basically, what we're </span><span class="line" data-startTime="2372">talking about now is, </span><span class="line" data-startTime="2375">how can you process </span><span class="line" data-startTime="2375">your JSON blobs that </span><span class="line" data-startTime="2378">are being returned to these </span><span class="line" data-startTime="2378">individuals in such a way </span><span class="line" data-startTime="2380">that GZIP can </span><span class="line" data-startTime="2380">compress it further? </span><span class="line" data-startTime="2381">And it all starts </span><span class="line" data-startTime="2381">with the ability </span><span class="line" data-startTime="2383">to transpose your structured </span><span class="line" data-startTime="2383">data in your JSON file. </span> <span class="line" data-startTime="2388">So let's take a look </span><span class="line" data-startTime="2388">at this example. </span> <span class="line" data-startTime="2389">Now, I've scraped </span><span class="line" data-startTime="2389">a lot of websites </span><span class="line" data-startTime="2391">and a lot of JSON </span><span class="line" data-startTime="2391">responses, and I </span><span class="line" data-startTime="2392">see this pattern occur </span><span class="line" data-startTime="2392">on a lot of websites. </span> <span class="line" data-startTime="2395">Effectively, what </span><span class="line" data-startTime="2395">you're looking at </span><span class="line" data-startTime="2397">is a list of dictionary </span><span class="line" data-startTime="2397">structures of name value pairs. </span></p>

<p><span class="line" data-startTime="2403">So if someone requests a </span><span class="line" data-startTime="2403">search for a particular item </span><span class="line" data-startTime="2406">on a shopping website, </span><span class="line" data-startTime="2406">it's very common </span><span class="line" data-startTime="2409">to actually return to them a </span><span class="line" data-startTime="2409">dictionary item that actually </span><span class="line" data-startTime="2413">contains what the product </span><span class="line" data-startTime="2413">name is, what the price is, </span><span class="line" data-startTime="2416">what thumbnail image to use, </span><span class="line" data-startTime="2416">et cetera, and then just </span><span class="line" data-startTime="2418">list these linearly </span><span class="line" data-startTime="2418">inside of an array. </span> <span class="line" data-startTime="2421">So what this creates, though, </span><span class="line" data-startTime="2421">as an interesting problem, </span><span class="line" data-startTime="2424">is that similar based </span><span class="line" data-startTime="2424">data is actually </span><span class="line" data-startTime="2427">strided away from each other. </span> <span class="line" data-startTime="2428">It's actually interleaved. </span> <span class="line" data-startTime="2430">So you may have a </span><span class="line" data-startTime="2430">name and then a price, </span><span class="line" data-startTime="2431">which could be a floating point </span><span class="line" data-startTime="2431">value, and then a description, </span><span class="line" data-startTime="2434">which may be a long </span><span class="line" data-startTime="2434">form block of text, </span><span class="line" data-startTime="2436">and then a URL, which has its </span><span class="line" data-startTime="2436">own specific characteristics. </span> <span class="line" data-startTime="2439">What we're proposing </span><span class="line" data-startTime="2439">in transposing our data </span><span class="line" data-startTime="2442">is actually turning </span><span class="line" data-startTime="2442">this name value pair </span><span class="line" data-startTime="2444">and actually de-interleaving it, </span><span class="line" data-startTime="2444">and instead actually grouping </span><span class="line" data-startTime="2448">similar values for </span><span class="line" data-startTime="2448">property names together. </span></p>

<p><span class="line" data-startTime="2451">So example here is we have these </span><span class="line" data-startTime="2451">two dictionary objects that </span><span class="line" data-startTime="2454">both have name and </span><span class="line" data-startTime="2454">position values, </span><span class="line" data-startTime="2456">and instead, we can </span><span class="line" data-startTime="2456">transpose that such </span><span class="line" data-startTime="2458">that we have an </span><span class="line" data-startTime="2458">array of name answers </span><span class="line" data-startTime="2461">and an array of pos answers. </span> <span class="line" data-startTime="2463">Now, I know this </span><span class="line" data-startTime="2463">looks weird at JSON, </span><span class="line" data-startTime="2465">so let's take a </span><span class="line" data-startTime="2465">graphical look at things. </span> <span class="line" data-startTime="2467">So let's say on the </span><span class="line" data-startTime="2467">top here, we have </span><span class="line" data-startTime="2468">an array where we have </span><span class="line" data-startTime="2468">a list of objects, </span><span class="line" data-startTime="2470">and each one of </span><span class="line" data-startTime="2470">the colored blocks </span><span class="line" data-startTime="2472">represents a property </span><span class="line" data-startTime="2472">on that object. </span> <span class="line" data-startTime="2474">So we've got green is a name, </span><span class="line" data-startTime="2474">and blue may be a price point, </span><span class="line" data-startTime="2477">and again, red </span><span class="line" data-startTime="2477">might be some URL. </span></p>

<p><span class="line" data-startTime="2479">What we can do, then, </span><span class="line" data-startTime="2479">is we can actually </span><span class="line" data-startTime="2481">transpose this and align all of </span><span class="line" data-startTime="2481">the green blocks, blue blocks, </span><span class="line" data-startTime="2484">and red blocks together, </span><span class="line" data-startTime="2484">allowing homogeneous data </span><span class="line" data-startTime="2489">to reside in an array with </span><span class="line" data-startTime="2489">other homogeneous data. </span> <span class="line" data-startTime="2493">Now, I'm going to explain </span><span class="line" data-startTime="2493">why this is actually </span><span class="line" data-startTime="2495">an improvement in a </span><span class="line" data-startTime="2495">second, but let's see </span><span class="line" data-startTime="2496">if we can take a look at whether </span><span class="line" data-startTime="2496">or not this saves us any data. </span> <span class="line" data-startTime="2500">So if we take a </span><span class="line" data-startTime="2500">bunch of JSON files </span><span class="line" data-startTime="2501">that are returned from </span><span class="line" data-startTime="2501">very common websites &mdash; </span><span class="line" data-startTime="2503">so I took some responses </span><span class="line" data-startTime="2503">from Amazon and Pinterest </span><span class="line" data-startTime="2505">and whatnot &mdash; you can see that </span><span class="line" data-startTime="2505">the first column represents </span><span class="line" data-startTime="2508">the source size in </span><span class="line" data-startTime="2508">bytes, the second column </span><span class="line" data-startTime="2510">represents the source </span><span class="line" data-startTime="2510">data actually gzipped. </span></p>

<p><span class="line" data-startTime="2513">The third is actually </span><span class="line" data-startTime="2513">the size of the data </span><span class="line" data-startTime="2516">after it's been transposed. </span> <span class="line" data-startTime="2517">You can see that there's </span><span class="line" data-startTime="2517">some variability in numbers </span><span class="line" data-startTime="2520">there because we're </span><span class="line" data-startTime="2520">actually removing symbols </span><span class="line" data-startTime="2522">from the string at this point. </span> <span class="line" data-startTime="2523">And you can see the </span><span class="line" data-startTime="2523">final column is actually </span><span class="line" data-startTime="2525">the gzipped version of </span><span class="line" data-startTime="2525">the transposed data. </span> <span class="line" data-startTime="2527">Now, we're actually in an </span><span class="line" data-startTime="2527">interesting situation here, </span><span class="line" data-startTime="2529">is that for some JSON files, </span><span class="line" data-startTime="2529">the transposed gzipped data </span><span class="line" data-startTime="2534">is actually smaller than the </span><span class="line" data-startTime="2534">source gzipped data, which </span><span class="line" data-startTime="2537">means we actually get a win </span><span class="line" data-startTime="2537">by applying this process. </span> <span class="line" data-startTime="2540">Thankfully, we're not </span><span class="line" data-startTime="2540">falling into that area </span><span class="line" data-startTime="2542">where genetic algorithm </span><span class="line" data-startTime="2542">minimized CSS is actually </span><span class="line" data-startTime="2546">causing GZIP to </span><span class="line" data-startTime="2546">inflate the data. </span> <span class="line" data-startTime="2547">We don't want to be there. </span></p>

<p><span class="line" data-startTime="2548">So the transpose operation </span><span class="line" data-startTime="2548">actually gives us </span><span class="line" data-startTime="2550">smaller files, </span><span class="line" data-startTime="2550">which is fantastic. </span> <span class="line" data-startTime="2552">Now, the reason that </span><span class="line" data-startTime="2552">this actually works </span><span class="line" data-startTime="2554">has to do with the </span><span class="line" data-startTime="2554">32k window that LZ77 </span><span class="line" data-startTime="2557">uses for its matching. </span> <span class="line" data-startTime="2559">So if we have our </span><span class="line" data-startTime="2559">values here that </span><span class="line" data-startTime="2561">are all interleaved &mdash; red, </span><span class="line" data-startTime="2561">green, blue, red, green, blue, </span><span class="line" data-startTime="2563">red, green, blue &mdash; again, we </span><span class="line" data-startTime="2563">have to go farther to search </span><span class="line" data-startTime="2568">for a piece of content </span><span class="line" data-startTime="2568">that may be an exact match. </span> <span class="line" data-startTime="2570">However, when we transpose </span><span class="line" data-startTime="2570">our data, we de-interleave it </span><span class="line" data-startTime="2574">and group similar </span><span class="line" data-startTime="2574">types of data together. </span> <span class="line" data-startTime="2576">So let's say we're </span><span class="line" data-startTime="2576">actually trying </span><span class="line" data-startTime="2577">to find a match for one </span><span class="line" data-startTime="2577">of these green values. </span> <span class="line" data-startTime="2580">In the top array, you can see </span><span class="line" data-startTime="2580">that an entire listing of data, </span><span class="line" data-startTime="2583">the green may not fit </span><span class="line" data-startTime="2583">inside the 32k window. </span></p>

<p><span class="line" data-startTime="2586">Meanwhile, once we transpose </span><span class="line" data-startTime="2586">it and group homogeneous data </span><span class="line" data-startTime="2589">together, the entirety </span><span class="line" data-startTime="2589">of the green data </span><span class="line" data-startTime="2591">actually fits in </span><span class="line" data-startTime="2591">a single window. </span> <span class="line" data-startTime="2593">This is going to allow you </span><span class="line" data-startTime="2593">to find better matches, which </span><span class="line" data-startTime="2596">is going to result in </span><span class="line" data-startTime="2596">smaller compression values. </span> <span class="line" data-startTime="2600">Now this actually comes to </span><span class="line" data-startTime="2600">another step here, which is OK, </span><span class="line" data-startTime="2603">well, if we can </span><span class="line" data-startTime="2603">transpose our data, </span><span class="line" data-startTime="2605">how else might we </span><span class="line" data-startTime="2605">modify our content </span><span class="line" data-startTime="2607">so that we can get wins? </span><span class="line" data-startTime="2608">Now, this is a really, </span><span class="line" data-startTime="2608">really cool algorithm </span><span class="line" data-startTime="2610">that I found digging </span><span class="line" data-startTime="2610">through the archives of IEEE </span><span class="line" data-startTime="2613">known as compression boosting. </span> <span class="line" data-startTime="2614">Now, it operates on </span><span class="line" data-startTime="2614">the same parameters. </span></p>

<p><span class="line" data-startTime="2616">How do we preprocess things </span><span class="line" data-startTime="2616">for better compression? </span><span class="line" data-startTime="2619">So the first one we're </span><span class="line" data-startTime="2619">going to take a look at here </span><span class="line" data-startTime="2621">is actually something </span><span class="line" data-startTime="2621">called Dense Codes. </span> <span class="line" data-startTime="2623">Now, this is some great </span><span class="line" data-startTime="2623">research out of some academics </span><span class="line" data-startTime="2626">in Argentina, and </span><span class="line" data-startTime="2626">effectively, it </span><span class="line" data-startTime="2628">allows us to take a text </span><span class="line" data-startTime="2628">based file and preprocess </span><span class="line" data-startTime="2630">it and hand it off to GZIP. </span> <span class="line" data-startTime="2632">Now, the preprocessing </span><span class="line" data-startTime="2632">is actually </span><span class="line" data-startTime="2633">the important part here. </span> <span class="line" data-startTime="2634">We're not actually </span><span class="line" data-startTime="2634">transposing it, </span><span class="line" data-startTime="2636">but instead, were using a </span><span class="line" data-startTime="2636">modified dictionary index </span><span class="line" data-startTime="2639">lookup scheme. </span> <span class="line" data-startTime="2640">So let's say we parse </span><span class="line" data-startTime="2640">our text and our seen, </span><span class="line" data-startTime="2643">and we create a </span><span class="line" data-startTime="2643">dictionary index. </span></p>

<p><span class="line" data-startTime="2646">So once a word is seen, we </span><span class="line" data-startTime="2646">provide it to the dictionary, </span><span class="line" data-startTime="2649">and then every </span><span class="line" data-startTime="2649">reference to that word </span><span class="line" data-startTime="2651">is replaced with an </span><span class="line" data-startTime="2651">index value to the array. </span> <span class="line" data-startTime="2653">So let's say we have an array </span><span class="line" data-startTime="2653">here of, "How much would could </span><span class="line" data-startTime="2656">a woodchuck chuck," and we </span><span class="line" data-startTime="2656">have 400 symbols before that. </span> <span class="line" data-startTime="2660">So we see that "how" is at </span><span class="line" data-startTime="2660">location 400, 401 is "much," </span><span class="line" data-startTime="2664">402 is "wood," 403 is "could." </span><span class="line" data-startTime="2666">So when we're creating </span><span class="line" data-startTime="2666">a stream, we're </span><span class="line" data-startTime="2668">going to get values that point </span><span class="line" data-startTime="2668">into these element arrays. </span> <span class="line" data-startTime="2673">So the problem with this is that </span><span class="line" data-startTime="2673">if we only have 256 symbols, </span><span class="line" data-startTime="2677">we can only use eight </span><span class="line" data-startTime="2677">bits per pointer. </span> <span class="line" data-startTime="2679">However, if we go </span><span class="line" data-startTime="2679">above 256, we have </span><span class="line" data-startTime="2681">to start using 16 bits per </span><span class="line" data-startTime="2681">pointer, which is actually </span><span class="line" data-startTime="2684">a problem because if the </span><span class="line" data-startTime="2684">symbols are weighted such </span><span class="line" data-startTime="2688">that the most probable </span><span class="line" data-startTime="2688">and most visible </span><span class="line" data-startTime="2691">symbols are actually closer to </span><span class="line" data-startTime="2691">the front of the dictionary, </span><span class="line" data-startTime="2693">you're actually going to </span><span class="line" data-startTime="2693">be wasting a lot of space. </span></p>

<p><span class="line" data-startTime="2696">You're going to have a lot of </span><span class="line" data-startTime="2696">symbols and a lot of indexes </span><span class="line" data-startTime="2698">where the first upper </span><span class="line" data-startTime="2698">eight bits are actually </span><span class="line" data-startTime="2701">going to be zeros for the </span><span class="line" data-startTime="2701">entire dominant side of it. </span> <span class="line" data-startTime="2703">So you're actually </span><span class="line" data-startTime="2703">inflating the size </span><span class="line" data-startTime="2705">of your stream at this </span><span class="line" data-startTime="2705">point because there's </span><span class="line" data-startTime="2706">a lot of bits that </span><span class="line" data-startTime="2706">aren't being used. </span> <span class="line" data-startTime="2709">Now, the way that </span><span class="line" data-startTime="2709">Dense Codes work is it </span><span class="line" data-startTime="2712">actually allows you to modify </span><span class="line" data-startTime="2712">the way the token is used </span><span class="line" data-startTime="2716">to create the ability </span><span class="line" data-startTime="2716">to actually do </span><span class="line" data-startTime="2718">variable length coding </span><span class="line" data-startTime="2718">in string, which means </span><span class="line" data-startTime="2721">that for the first </span><span class="line" data-startTime="2721">three numbers, </span><span class="line" data-startTime="2723">we actually use 16 bits </span><span class="line" data-startTime="2723">to represent the indexes, </span><span class="line" data-startTime="2726">but the second three numbers, </span><span class="line" data-startTime="2726">because their indexes </span><span class="line" data-startTime="2728">are lower than 256, </span><span class="line" data-startTime="2728">we can actually </span><span class="line" data-startTime="2731">use eight bits instead of 16. </span> <span class="line" data-startTime="2733">This is actually going to </span><span class="line" data-startTime="2733">create a smaller stream for us </span><span class="line" data-startTime="2735">to actually compress </span><span class="line" data-startTime="2735">a little bit later. </span></p>

<p><span class="line" data-startTime="2740">Now, the wins from </span><span class="line" data-startTime="2740">this are pretty </span><span class="line" data-startTime="2741">interesting to look </span><span class="line" data-startTime="2741">at because there's </span><span class="line" data-startTime="2743">a couple things in </span><span class="line" data-startTime="2743">flight here, and I've </span><span class="line" data-startTime="2745">got an entire 10-page writeup </span><span class="line" data-startTime="2745">on my blog about this algorithm </span><span class="line" data-startTime="2749">and the interesting things that </span><span class="line" data-startTime="2749">go back and forth between it, </span><span class="line" data-startTime="2752">some caveats, and some </span><span class="line" data-startTime="2752">things you need to know, </span><span class="line" data-startTime="2754">but it all boils </span><span class="line" data-startTime="2754">down to this table. </span> <span class="line" data-startTime="2756">Now basically, what </span><span class="line" data-startTime="2756">this table says </span><span class="line" data-startTime="2757">is that we've tried the </span><span class="line" data-startTime="2757">source data being gzipped, </span><span class="line" data-startTime="2761">and then we've </span><span class="line" data-startTime="2761">tried the data being </span><span class="line" data-startTime="2763">run through our </span><span class="line" data-startTime="2763">dense codes &mdash; that's </span><span class="line" data-startTime="2765">the ETDC column &mdash; and then the </span><span class="line" data-startTime="2765">gzipping of that information. </span></p>

<p><span class="line" data-startTime="2769">Now, next to it, I actually </span><span class="line" data-startTime="2769">compare the other compressors </span><span class="line" data-startTime="2771">that we've mentioned today &mdash; </span><span class="line" data-startTime="2771">Zopfli, 7-Zip, and BZIP2. </span> <span class="line" data-startTime="2776">So what I'm trying </span><span class="line" data-startTime="2776">to see here is </span><span class="line" data-startTime="2777">once I do this preprocessing, </span><span class="line" data-startTime="2777">what compression algorithm is </span><span class="line" data-startTime="2781">actually going to give </span><span class="line" data-startTime="2781">us the best results? </span><span class="line" data-startTime="2783">You can see that hands </span><span class="line" data-startTime="2783">down, GZIP really </span><span class="line" data-startTime="2786">doesn't produce savings with </span><span class="line" data-startTime="2786">this preprocessing method </span><span class="line" data-startTime="2790">for the majority of </span><span class="line" data-startTime="2790">the data that I've </span><span class="line" data-startTime="2791">shown here &mdash; JSON files, CSSs. </span> <span class="line" data-startTime="2793">And I've actually </span><span class="line" data-startTime="2793">run this probably </span><span class="line" data-startTime="2794">against 25,000, </span><span class="line" data-startTime="2794">30,000 files, and you </span><span class="line" data-startTime="2797">see this similar pattern, </span><span class="line" data-startTime="2797">that just doing standard GZIP </span><span class="line" data-startTime="2800">against this information </span><span class="line" data-startTime="2800">doesn't really give you wins. </span> <span class="line" data-startTime="2802">However, you see when </span><span class="line" data-startTime="2802">you start using Zopfli, </span><span class="line" data-startTime="2805">you start getting some wins. </span> <span class="line" data-startTime="2806">The advanced pattern matching </span><span class="line" data-startTime="2806">and more memory usage </span><span class="line" data-startTime="2810">characteristics that it </span><span class="line" data-startTime="2810">has inside of an encoder </span><span class="line" data-startTime="2812">allows you to get better </span><span class="line" data-startTime="2812">matches with this, </span><span class="line" data-startTime="2814">producing smaller files. </span></p>

<p><span class="line" data-startTime="2816">The clear winner here is 7-Zip. </span> <span class="line" data-startTime="2818">Something inside of the way </span><span class="line" data-startTime="2818">it's using its algorithms </span><span class="line" data-startTime="2820">consistently produces smaller </span><span class="line" data-startTime="2820">dense code compressed files </span><span class="line" data-startTime="2824">as opposed to the </span><span class="line" data-startTime="2824">source data, which </span><span class="line" data-startTime="2826">means this is interesting, </span><span class="line" data-startTime="2826">that if you have </span><span class="line" data-startTime="2828">data that's above </span><span class="line" data-startTime="2828">a certain size. </span> <span class="line" data-startTime="2829">Let's say you're returning a 20k </span><span class="line" data-startTime="2829">blob of data for some reason. </span> <span class="line" data-startTime="2832">Preprocessing that </span><span class="line" data-startTime="2832">text with dense codes </span><span class="line" data-startTime="2835">and then using 7-Zip as </span><span class="line" data-startTime="2835">your compressor of choice </span><span class="line" data-startTime="2842">can actually produce smaller </span><span class="line" data-startTime="2842">GZIP files consistently. </span> <span class="line" data-startTime="2845">Now, the downside </span><span class="line" data-startTime="2845">of this, of course, </span><span class="line" data-startTime="2847">is that you have to reconstruct </span><span class="line" data-startTime="2847">your dense code transform </span><span class="line" data-startTime="2849">at the client, but that's </span><span class="line" data-startTime="2849">not necessarily a big deal </span><span class="line" data-startTime="2852">depending on what </span><span class="line" data-startTime="2852">type of trade-off </span><span class="line" data-startTime="2853">you're willing to make. </span> <span class="line" data-startTime="2855">Now, these are all </span><span class="line" data-startTime="2855">preprocessing schemes. </span></p>

<p><span class="line" data-startTime="2858">There's another form of </span><span class="line" data-startTime="2858">processing your data that </span><span class="line" data-startTime="2860">can actually get wins </span><span class="line" data-startTime="2860">that these can't touch. </span> <span class="line" data-startTime="2862">I mean, the types </span><span class="line" data-startTime="2862">of wins that we're </span><span class="line" data-startTime="2864">going to talk about </span><span class="line" data-startTime="2864">for Delta.js blow </span><span class="line" data-startTime="2866">these preprocessing schemes out </span><span class="line" data-startTime="2866">of the water, but be warned. </span> <span class="line" data-startTime="2870">Thar be dragons here, mostly </span><span class="line" data-startTime="2870">in the form of madness. </span> <span class="line" data-startTime="2873">So let's dive into what </span><span class="line" data-startTime="2873">I'm talking about here. </span> <span class="line" data-startTime="2876">So in 2012, the </span><span class="line" data-startTime="2876">Gmail team actually </span><span class="line" data-startTime="2879">did a fantastic </span><span class="line" data-startTime="2879">presentation for the W3C, </span><span class="line" data-startTime="2882">and actually put </span><span class="line" data-startTime="2882">up some slides that </span><span class="line" data-startTime="2883">are publicly available to other </span><span class="line" data-startTime="2883">information, that was proposing </span><span class="line" data-startTime="2887">a solution to a common problem. </span></p>

<p><span class="line" data-startTime="2889">You see, Gmail users </span><span class="line" data-startTime="2889">see about 61 years </span><span class="line" data-startTime="2893">of loading bar inside of </span><span class="line" data-startTime="2893">Gmail about every day. </span> <span class="line" data-startTime="2896">This is a lot of time that </span><span class="line" data-startTime="2896">users are sitting around, </span><span class="line" data-startTime="2900">waiting for JavaScript </span><span class="line" data-startTime="2900">to be streamed out. </span> <span class="line" data-startTime="2902">What they proposed was </span><span class="line" data-startTime="2902">a new form of ability </span><span class="line" data-startTime="2905">to, instead of transferring the </span><span class="line" data-startTime="2905">large files every single time, </span><span class="line" data-startTime="2908">they can actually start </span><span class="line" data-startTime="2908">transferring the difference </span><span class="line" data-startTime="2910">between the file </span><span class="line" data-startTime="2910">that the user has </span><span class="line" data-startTime="2912">and the new file </span><span class="line" data-startTime="2912">that the user needs. </span></p>

<p><span class="line" data-startTime="2915">Now, this isn't a new concept. </span> <span class="line" data-startTime="2916">We've seen these sorts </span><span class="line" data-startTime="2916">of patching-based systems </span><span class="line" data-startTime="2919">everywhere in computing </span><span class="line" data-startTime="2919">since the late 1970s, </span><span class="line" data-startTime="2922">but it's never been </span><span class="line" data-startTime="2922">able to be applied </span><span class="line" data-startTime="2923">to the web due to some of </span><span class="line" data-startTime="2923">the architecture involved. </span> <span class="line" data-startTime="2927">How the algorithm works is this. </span> <span class="line" data-startTime="2928">So let's say we have a </span><span class="line" data-startTime="2928">file, file.CSS version zero, </span><span class="line" data-startTime="2932">and we've made an update to it. </span> <span class="line" data-startTime="2934">This happens quite a </span><span class="line" data-startTime="2934">bit in large projects. </span> <span class="line" data-startTime="2937">Now, when we make that update, </span><span class="line" data-startTime="2937">the majority of the file </span><span class="line" data-startTime="2939">is the same as it used to be. </span> <span class="line" data-startTime="2941">There may be a </span><span class="line" data-startTime="2941">function that's added, </span><span class="line" data-startTime="2942">or some comments were placed </span><span class="line" data-startTime="2942">in, or some things were removed, </span><span class="line" data-startTime="2945">but for the majority </span><span class="line" data-startTime="2945">of the file, </span><span class="line" data-startTime="2947">it's almost </span><span class="line" data-startTime="2947">identical, which means </span><span class="line" data-startTime="2948">we can represent the </span><span class="line" data-startTime="2948">second file, the new file, </span><span class="line" data-startTime="2952">as a difference from the </span><span class="line" data-startTime="2952">file that we've already seen. </span></p>

<p><span class="line" data-startTime="2955">This is the concept, </span><span class="line" data-startTime="2955">again, of delta encoding. </span> <span class="line" data-startTime="2958">Now, once we've delta </span><span class="line" data-startTime="2958">encoded this file, </span><span class="line" data-startTime="2960">the patch &mdash; basically the </span><span class="line" data-startTime="2960">difference between the two &mdash; </span><span class="line" data-startTime="2963">is generally much, much smaller </span><span class="line" data-startTime="2963">than the updated version </span><span class="line" data-startTime="2967">of the file, which </span><span class="line" data-startTime="2967">means we can represent </span><span class="line" data-startTime="2970">version one as a patch </span><span class="line" data-startTime="2970">operation of version zero. </span> <span class="line" data-startTime="2976">This means that if </span><span class="line" data-startTime="2976">the user already </span><span class="line" data-startTime="2978">has version one on their </span><span class="line" data-startTime="2978">machine, all we have to do </span><span class="line" data-startTime="2981">is send them the </span><span class="line" data-startTime="2981">patch, and it allows </span><span class="line" data-startTime="2984">them to reconstruct and create </span><span class="line" data-startTime="2984">the new version of the data. </span></p>

<p><span class="line" data-startTime="2987">Now, this is actually a </span><span class="line" data-startTime="2987">pretty interesting concept </span><span class="line" data-startTime="2989">because this means </span><span class="line" data-startTime="2989">we don't have to send </span><span class="line" data-startTime="2991">full files to the </span><span class="line" data-startTime="2991">clients all the time. </span> <span class="line" data-startTime="2993">Instead, we can produce and send </span><span class="line" data-startTime="2993">down highly, highly minimized </span><span class="line" data-startTime="2997">content to these guys. </span> <span class="line" data-startTime="2998">Now of course, this comes </span><span class="line" data-startTime="2998">with a bit of overhead </span><span class="line" data-startTime="3001">in terms of communication. </span> <span class="line" data-startTime="3003">You see, in order </span><span class="line" data-startTime="3003">to get this working, </span><span class="line" data-startTime="3005">we have to have a </span><span class="line" data-startTime="3005">communication process </span><span class="line" data-startTime="3007">between the client </span><span class="line" data-startTime="3007">and the server. </span> <span class="line" data-startTime="3009">So let's say we have </span><span class="line" data-startTime="3009">our mobile device here </span><span class="line" data-startTime="3011">and the user is going </span><span class="line" data-startTime="3011">to load a website. </span> <span class="line" data-startTime="3013">Well, the client </span><span class="line" data-startTime="3013">actually needs to notify </span><span class="line" data-startTime="3015">the server on what version </span><span class="line" data-startTime="3015">of the file it has cached. </span> <span class="line" data-startTime="3019">The server can then </span><span class="line" data-startTime="3019">take this information, </span><span class="line" data-startTime="3021">look up in its </span><span class="line" data-startTime="3021">array, and figure out </span><span class="line" data-startTime="3022">what patch file it needs </span><span class="line" data-startTime="3022">to send to the client </span><span class="line" data-startTime="3026">in order to get them up to date. </span></p>

<p><span class="line" data-startTime="3027">Once it's figured this out, it </span><span class="line" data-startTime="3027">passes it off to the client, </span><span class="line" data-startTime="3030">and then the client is </span><span class="line" data-startTime="3030">going to use this patch </span><span class="line" data-startTime="3032">to construct the new version </span><span class="line" data-startTime="3032">of the file and cache that </span><span class="line" data-startTime="3035">and use that appropriately. </span> <span class="line" data-startTime="3036">Effectively, this technique </span><span class="line" data-startTime="3036">is trading network requests </span><span class="line" data-startTime="3040">for smaller file sizes. </span> <span class="line" data-startTime="3042">Sending a couple byte </span><span class="line" data-startTime="3042">request to determine </span><span class="line" data-startTime="3044">what version of </span><span class="line" data-startTime="3044">the file you have </span><span class="line" data-startTime="3046">is going to be night and day </span><span class="line" data-startTime="3046">difference than actually doing </span><span class="line" data-startTime="3048">the entire file being sent </span><span class="line" data-startTime="3048">to the user multiple times. </span> <span class="line" data-startTime="3051">Now, if this sounds like </span><span class="line" data-startTime="3051">craziness to you, just hold on. </span> <span class="line" data-startTime="3054">You have to realize </span><span class="line" data-startTime="3054">this is a common problem </span><span class="line" data-startTime="3057">for many large, very </span><span class="line" data-startTime="3057">industrial websites </span><span class="line" data-startTime="3060">that serve millions </span><span class="line" data-startTime="3060">of users a day. </span> <span class="line" data-startTime="3062">You see, when the </span><span class="line" data-startTime="3062">Gmail people actually </span><span class="line" data-startTime="3064">looked at the type </span><span class="line" data-startTime="3064">of savings they </span><span class="line" data-startTime="3066">can get from this </span><span class="line" data-startTime="3066">type of algorithm, </span><span class="line" data-startTime="3068">they saw a massive potential </span><span class="line" data-startTime="3068">for improvement here. </span> <span class="line" data-startTime="3071">You see, when they </span><span class="line" data-startTime="3071">compared the number of revs </span><span class="line" data-startTime="3074">they do to a single file </span><span class="line" data-startTime="3074">over a month against the size </span><span class="line" data-startTime="3078">of the deltas if they </span><span class="line" data-startTime="3078">were using this scheme, </span><span class="line" data-startTime="3080">they actually saw that a </span><span class="line" data-startTime="3080">whole month's worth of changes </span><span class="line" data-startTime="3083">was about 9% &mdash; lower than </span><span class="line" data-startTime="3083">9% &mdash; of the size of the assets </span><span class="line" data-startTime="3088">altogether, which </span><span class="line" data-startTime="3088">means they would only </span><span class="line" data-startTime="3090">have to send 9% of the content </span><span class="line" data-startTime="3090">as opposed to the new full file </span><span class="line" data-startTime="3094">each time. </span></p>

<p><span class="line" data-startTime="3095">This is a huge win. </span> <span class="line" data-startTime="3096">We're not talking </span><span class="line" data-startTime="3096">about 10% improvement. </span> <span class="line" data-startTime="3097">We're not talking </span><span class="line" data-startTime="3097">about 50% improvement. </span> <span class="line" data-startTime="3099">This is 90% size decrease by </span><span class="line" data-startTime="3099">using this delta algorithm. </span> <span class="line" data-startTime="3104">So obviously, this was a </span><span class="line" data-startTime="3104">proposal to the W3C spec. </span> <span class="line" data-startTime="3108">I've talked with some </span><span class="line" data-startTime="3108">of the Gmail guys. </span> <span class="line" data-startTime="3110">It doesn't look like this is </span><span class="line" data-startTime="3110">actually live in the servers </span><span class="line" data-startTime="3112">right now. </span> <span class="line" data-startTime="3113">If that's changed, I hope </span><span class="line" data-startTime="3113">to be wrong because this </span><span class="line" data-startTime="3115">is a fantastic </span><span class="line" data-startTime="3115">piece of technology </span><span class="line" data-startTime="3117">that I hope to see </span><span class="line" data-startTime="3117">rolling out in some form </span><span class="line" data-startTime="3119">to a lot of other </span><span class="line" data-startTime="3119">distributors on the internet. </span> <span class="line" data-startTime="3122">Now, there's another </span><span class="line" data-startTime="3122">form of this compression </span><span class="line" data-startTime="3124">that I've actually been </span><span class="line" data-startTime="3124">playing around with. </span></p>

<p><span class="line" data-startTime="3126">It actually comes in the form </span><span class="line" data-startTime="3126">of horizontal compression. </span> <span class="line" data-startTime="3128">Typically, when we think of </span><span class="line" data-startTime="3128">delta encoding for files, </span><span class="line" data-startTime="3131">we think in terms of patches. </span> <span class="line" data-startTime="3132">I've got version </span><span class="line" data-startTime="3132">A and version B, </span><span class="line" data-startTime="3134">and I want to generate </span><span class="line" data-startTime="3134">the patch between the two. </span> <span class="line" data-startTime="3136">This is especially common </span><span class="line" data-startTime="3136">in game development. </span> <span class="line" data-startTime="3138">However, there exists a </span><span class="line" data-startTime="3138">form called horizontal. </span> <span class="line" data-startTime="3140">How this works is </span><span class="line" data-startTime="3140">let's say we have </span><span class="line" data-startTime="3142">a cascade of files that may </span><span class="line" data-startTime="3142">be similar on a website. </span> <span class="line" data-startTime="3145">So this particular website </span><span class="line" data-startTime="3145">uses three CSS files. </span> <span class="line" data-startTime="3149">Let's say it's Bootstrap </span><span class="line" data-startTime="3149">or something like that. </span> <span class="line" data-startTime="3151">Well, the interesting thing is </span><span class="line" data-startTime="3151">that these CSS files generally </span><span class="line" data-startTime="3155">aren't that different </span><span class="line" data-startTime="3155">from each other. </span></p>

<p><span class="line" data-startTime="3156">There's actually a lot a shared </span><span class="line" data-startTime="3156">syntax on a website for a given </span><span class="line" data-startTime="3159">CSS file, which </span><span class="line" data-startTime="3159">means that instead </span><span class="line" data-startTime="3161">of doing delta compression </span><span class="line" data-startTime="3161">between versions of the file, </span><span class="line" data-startTime="3165">we can actually do delta </span><span class="line" data-startTime="3165">compression between the files </span><span class="line" data-startTime="3168">that are going to </span><span class="line" data-startTime="3168">be sent to the user. </span> <span class="line" data-startTime="3170">So we can actually do a </span><span class="line" data-startTime="3170">difference between file zero </span><span class="line" data-startTime="3173">and file one, and then </span><span class="line" data-startTime="3173">file one and file two. </span> <span class="line" data-startTime="3176">This actually allows </span><span class="line" data-startTime="3176">us to create patches </span><span class="line" data-startTime="3178">for each one of </span><span class="line" data-startTime="3178">these, and when we </span><span class="line" data-startTime="3179">combine that with the </span><span class="line" data-startTime="3179">source file to your server, </span><span class="line" data-startTime="3182">the size of the assets that need </span><span class="line" data-startTime="3182">to be sent down to the client </span><span class="line" data-startTime="3185">is drastically reduced. </span></p>

<p><span class="line" data-startTime="3187">We can actually send them </span><span class="line" data-startTime="3187">the entire application </span><span class="line" data-startTime="3190">and all the content required </span><span class="line" data-startTime="3190">as deltas from base files. </span> <span class="line" data-startTime="3193">This, again, is just </span><span class="line" data-startTime="3193">an extrapolation </span><span class="line" data-startTime="3195">of various forms </span><span class="line" data-startTime="3195">of delta algorithms </span><span class="line" data-startTime="3197">that are already </span><span class="line" data-startTime="3197">used out in the wild. </span> <span class="line" data-startTime="3199">Now, how this works </span><span class="line" data-startTime="3199">on the client side </span><span class="line" data-startTime="3202">is that the server </span><span class="line" data-startTime="3202">will, of course, provide </span><span class="line" data-startTime="3204">to the client the base file </span><span class="line" data-startTime="3204">and the set of patches, </span><span class="line" data-startTime="3207">and then the client is </span><span class="line" data-startTime="3207">responsible for reconstructing </span><span class="line" data-startTime="3210">each one of those files and </span><span class="line" data-startTime="3210">then caching them locally. </span> <span class="line" data-startTime="3213">This is a really </span><span class="line" data-startTime="3213">neat idea if you're </span><span class="line" data-startTime="3215">trying to optimize first </span><span class="line" data-startTime="3215">time load for users. </span> <span class="line" data-startTime="3218">The Gmail proposed </span><span class="line" data-startTime="3218">specification requires </span><span class="line" data-startTime="3220">that the user has to download </span><span class="line" data-startTime="3220">version zero of the file, which </span><span class="line" data-startTime="3224">in some cases actually </span><span class="line" data-startTime="3224">could be 300k of CSS data. </span></p>

<p><span class="line" data-startTime="3228">Meanwhile, horizontal </span><span class="line" data-startTime="3228">compression </span><span class="line" data-startTime="3230">suggests that it may </span><span class="line" data-startTime="3230">not have to do that. </span> <span class="line" data-startTime="3232">It may only have to send down </span><span class="line" data-startTime="3232">bites or chunks of 50k data </span><span class="line" data-startTime="3237">when you actually represent </span><span class="line" data-startTime="3237">that CSS as a delta. </span> <span class="line" data-startTime="3240">Effectively, what you're doing </span><span class="line" data-startTime="3240">in this horizontal scheme is </span><span class="line" data-startTime="3243">you're trading client side </span><span class="line" data-startTime="3243">processing for smaller transfer </span><span class="line" data-startTime="3247">sizes. </span> <span class="line" data-startTime="3248">This is because it actually </span><span class="line" data-startTime="3248">takes a lot of CPU cycles </span><span class="line" data-startTime="3250">on the client to reconstruct </span><span class="line" data-startTime="3250">these files before passing them </span><span class="line" data-startTime="3254">off to the processing </span><span class="line" data-startTime="3254">system to create </span><span class="line" data-startTime="3255">your DOM and everything else. </span> <span class="line" data-startTime="3257">So there's this interesting </span><span class="line" data-startTime="3257">trade-off between Delta.js </span><span class="line" data-startTime="3260">or vertical delta encoding for </span><span class="line" data-startTime="3260">files and the horizontal delta </span><span class="line" data-startTime="3264">encoding for files as well. </span> <span class="line" data-startTime="3266">Now, we can see when I've </span><span class="line" data-startTime="3266">applied this technique </span><span class="line" data-startTime="3269">to some various </span><span class="line" data-startTime="3269">sites on the internet </span><span class="line" data-startTime="3270">that we actually get some </span><span class="line" data-startTime="3270">interesting numbers out of it. </span></p>

<p><span class="line" data-startTime="3272">So I took all of the CSS </span><span class="line" data-startTime="3272">from a Gmail session, </span><span class="line" data-startTime="3274">all of the JavaScript </span><span class="line" data-startTime="3274">from a Gmail session, </span><span class="line" data-startTime="3276">and all of the CSS </span><span class="line" data-startTime="3276">from an Amazon session, </span><span class="line" data-startTime="3279">and I ran it through </span><span class="line" data-startTime="3279">this technique. </span> <span class="line" data-startTime="3281">So you can see we've </span><span class="line" data-startTime="3281">got the source, the GZIP </span><span class="line" data-startTime="3283">source, and then </span><span class="line" data-startTime="3283">the size of the data </span><span class="line" data-startTime="3285">once it's been delta </span><span class="line" data-startTime="3285">encoded, and then </span><span class="line" data-startTime="3287">of course, the gzipping </span><span class="line" data-startTime="3287">of the delta encoded data </span><span class="line" data-startTime="3290">because we can't just stop </span><span class="line" data-startTime="3290">at the delta encoding. </span> <span class="line" data-startTime="3292">So you can see for </span><span class="line" data-startTime="3292">Gmail, we actually </span><span class="line" data-startTime="3294">get some pretty amazing </span><span class="line" data-startTime="3294">savings, 31% and 12%, </span><span class="line" data-startTime="3298">by using this horizontal </span><span class="line" data-startTime="3298">delta compression encoding. </span> <span class="line" data-startTime="3302">Meanwhile, something weird's </span><span class="line" data-startTime="3302">going on with the Amazon data </span><span class="line" data-startTime="3304">where we actually get an </span><span class="line" data-startTime="3304">increase of size by 13%. </span></p>

<p><span class="line" data-startTime="3308">Now, I'd like to </span><span class="line" data-startTime="3308">actually point out </span><span class="line" data-startTime="3310">that this data is highly, highly </span><span class="line" data-startTime="3310">minimized and highly redundant. </span> <span class="line" data-startTime="3315">All of these files that are </span><span class="line" data-startTime="3315">creating multiple network </span><span class="line" data-startTime="3317">requests tend to </span><span class="line" data-startTime="3317">be self similar, </span><span class="line" data-startTime="3319">and that's actually due to the </span><span class="line" data-startTime="3319">minification processes that </span><span class="line" data-startTime="3322">are being applied to </span><span class="line" data-startTime="3322">these files on the web. </span> <span class="line" data-startTime="3324">To give you an example of </span><span class="line" data-startTime="3324">how important minimization </span><span class="line" data-startTime="3327">is to horizontal </span><span class="line" data-startTime="3327">delta compression, </span><span class="line" data-startTime="3329">let's take a look at the game </span><span class="line" data-startTime="3329">library known as Impact.js. </span></p>

<p><span class="line" data-startTime="3332">I love this library. </span> <span class="line" data-startTime="3333">It's fantastic. </span> <span class="line" data-startTime="3334">If you're a game </span><span class="line" data-startTime="3334">developer and you're </span><span class="line" data-startTime="3335">looking to make HTML5 </span><span class="line" data-startTime="3335">games, definitely </span><span class="line" data-startTime="3337">give Impact.js a look. </span> <span class="line" data-startTime="3339">Effectively, I took </span><span class="line" data-startTime="3339">the source file </span><span class="line" data-startTime="3340">and left them as loose files. </span> <span class="line" data-startTime="3345">I did not combine them </span><span class="line" data-startTime="3345">into a single large file. </span> <span class="line" data-startTime="3347">I actually created the delta </span><span class="line" data-startTime="3347">between all these files </span><span class="line" data-startTime="3350">and then did the </span><span class="line" data-startTime="3350">gzipped version of that. </span> <span class="line" data-startTime="3354">Now, you can see </span><span class="line" data-startTime="3354">that it actually </span><span class="line" data-startTime="3355">goes down from about 70k to 21k. </span> <span class="line" data-startTime="3357">However, when I minimized </span><span class="line" data-startTime="3357">all of the files </span><span class="line" data-startTime="3360">before doing delta </span><span class="line" data-startTime="3360">compression, I actually </span><span class="line" data-startTime="3362">got a better savings. </span> <span class="line" data-startTime="3363">I got down to about 14k. </span></p>

<p><span class="line" data-startTime="3365">This is because the </span><span class="line" data-startTime="3365">minimization techniques </span><span class="line" data-startTime="3366">we're using on the </span><span class="line" data-startTime="3366">web today actually </span><span class="line" data-startTime="3368">produce a lot of </span><span class="line" data-startTime="3368">duplicate symbols </span><span class="line" data-startTime="3370">that could be used </span><span class="line" data-startTime="3370">in various places. </span> <span class="line" data-startTime="3372">Again, when you see </span><span class="line" data-startTime="3372">those original examples </span><span class="line" data-startTime="3374">of taking some and we </span><span class="line" data-startTime="3374">renamed the parameters that </span><span class="line" data-startTime="3378">are being passed </span><span class="line" data-startTime="3378">to it as ABC, we </span><span class="line" data-startTime="3380">tend to see that pattern </span><span class="line" data-startTime="3380">occur for all the JavaScript </span><span class="line" data-startTime="3383">for every function </span><span class="line" data-startTime="3383">that's been defined, </span><span class="line" data-startTime="3384">meaning we're going </span><span class="line" data-startTime="3384">to see more matches. </span> <span class="line" data-startTime="3386">More matches result in better </span><span class="line" data-startTime="3386">statistical probability, </span><span class="line" data-startTime="3389">which results in </span><span class="line" data-startTime="3389">smaller file sizes. </span> <span class="line" data-startTime="3392">So by minimizing our data before </span><span class="line" data-startTime="3392">we do our delta compression, </span><span class="line" data-startTime="3395">we actually get very, </span><span class="line" data-startTime="3395">very important wins. </span> <span class="line" data-startTime="3399">So what we've talked </span><span class="line" data-startTime="3399">about today is </span><span class="line" data-startTime="3402">where GZIP sits on </span><span class="line" data-startTime="3402">the web platform. </span></p>

<p><span class="line" data-startTime="3404">We've got a lot of text data </span><span class="line" data-startTime="3404">that's about to blow up. </span> <span class="line" data-startTime="3406">We've got mobile devices. </span> <span class="line" data-startTime="3408">We've got fragmented hardware. </span> <span class="line" data-startTime="3409">We've got different </span><span class="line" data-startTime="3409">connectivity all over the world, </span><span class="line" data-startTime="3412">but some things here allow you </span><span class="line" data-startTime="3412">to take advantage and actually </span><span class="line" data-startTime="3416">address these issues </span><span class="line" data-startTime="3416">today rather than waiting </span><span class="line" data-startTime="3418">for network times to increase. </span> <span class="line" data-startTime="3420">So for example, we </span><span class="line" data-startTime="3420">looked at the fact </span><span class="line" data-startTime="3421">that GZIP is not </span><span class="line" data-startTime="3421">a silver bullet. </span> <span class="line" data-startTime="3423">By preprocessing your </span><span class="line" data-startTime="3423">data, you can actually </span><span class="line" data-startTime="3424">get some pretty big wins. </span> <span class="line" data-startTime="3425">We've seen where GZIP </span><span class="line" data-startTime="3425">actually falls on its face. </span></p>

<p><span class="line" data-startTime="3428">If you've done a lot </span><span class="line" data-startTime="3428">of preprocessing, </span><span class="line" data-startTime="3429">it may not compress your </span><span class="line" data-startTime="3429">data, and in fact, it </span><span class="line" data-startTime="3431">might inflate it. </span> <span class="line" data-startTime="3432">Or in the case of PNGs, </span><span class="line" data-startTime="3432">modifying the window matching </span><span class="line" data-startTime="3436">by slight parameters </span><span class="line" data-startTime="3436">can actually </span><span class="line" data-startTime="3437">upset how well GZIP </span><span class="line" data-startTime="3437">attaches to your data. </span> <span class="line" data-startTime="3441">We also looked at how to </span><span class="line" data-startTime="3441">preprocess your content using </span><span class="line" data-startTime="3443">various forms of other command </span><span class="line" data-startTime="3443">line algorithms, like Zopfli </span><span class="line" data-startTime="3447">or 7-Zip, and then how to </span><span class="line" data-startTime="3447">transpose your JSON data, which </span><span class="line" data-startTime="3450">is fantastic for a lot </span><span class="line" data-startTime="3450">of your shopping sites. </span> <span class="line" data-startTime="3453">Also, when you combine that </span><span class="line" data-startTime="3453">with the dense code boosting, </span><span class="line" data-startTime="3455">which is more cutting edge </span><span class="line" data-startTime="3455">text preprocessing data, </span><span class="line" data-startTime="3459">you start getting a sense </span><span class="line" data-startTime="3459">that the web is not done yet. </span> <span class="line" data-startTime="3461">You're not locked into </span><span class="line" data-startTime="3461">your form that you have. </span></p>

<p><span class="line" data-startTime="3464">Then you can start looking at </span><span class="line" data-startTime="3464">the delta compression methods </span><span class="line" data-startTime="3466">and start looking at the </span><span class="line" data-startTime="3466">ways to actually combine </span><span class="line" data-startTime="3468">your data in different </span><span class="line" data-startTime="3468">ways to reduce duplication </span><span class="line" data-startTime="3473">and complexity in the </span><span class="line" data-startTime="3473">content that you have. </span> <span class="line" data-startTime="3475">And when you apply </span><span class="line" data-startTime="3475">all this together, </span><span class="line" data-startTime="3477">you start getting </span><span class="line" data-startTime="3477">a vision of the web </span><span class="line" data-startTime="3479">that we can actually </span><span class="line" data-startTime="3479">control more of our data </span><span class="line" data-startTime="3481">to reduce the sizes and actually </span><span class="line" data-startTime="3481">get around a lot of the hitches </span><span class="line" data-startTime="3485">and problems that </span><span class="line" data-startTime="3485">GZIP presents to us. </span> <span class="line" data-startTime="3487">So with that, thank you </span><span class="line" data-startTime="3487">for your time today. </span> <span class="line" data-startTime="3489">I really appreciate </span><span class="line" data-startTime="3489">you listening </span><span class="line" data-startTime="3491">to this ramble on some very </span><span class="line" data-startTime="3491">hard compression stuff. </span></p>

<p><span class="line" data-startTime="3494">If you're interested </span><span class="line" data-startTime="3494">in more, I highly </span><span class="line" data-startTime="3495">recommend you check </span><span class="line" data-startTime="3495">out html4rocks.com. </span> <span class="line" data-startTime="3497">I recently put up </span><span class="line" data-startTime="3497">two articles there </span><span class="line" data-startTime="3500">on text compression </span><span class="line" data-startTime="3500">for web developers </span><span class="line" data-startTime="3502">as well as image compression </span><span class="line" data-startTime="3502">for web developers, </span><span class="line" data-startTime="3505">and these are generally </span><span class="line" data-startTime="3505">meant to be opener tutorials </span><span class="line" data-startTime="3507">to introduce you to different </span><span class="line" data-startTime="3507">terminology and different </span><span class="line" data-startTime="3510">algorithms and how </span><span class="line" data-startTime="3510">they're being used. </span> <span class="line" data-startTime="3511">Once again, definitely check </span><span class="line" data-startTime="3511">out the #perfmatters hashtag. </span> <span class="line" data-startTime="3514">A lot of smart people are there. </span> <span class="line" data-startTime="3515">And join the Google+ Web </span><span class="line" data-startTime="3515">Performance community. </span></p>

<p><span class="line" data-startTime="3518">You can actually see the </span><span class="line" data-startTime="3518">short link there on the side </span><span class="line" data-startTime="3521">as goo.gl/webperf. </span> <span class="line" data-startTime="3523">Again, a great place to talk </span><span class="line" data-startTime="3523">about performance problems </span><span class="line" data-startTime="3525">and find issues. </span> <span class="line" data-startTime="3526">That's it for me. </span> <span class="line" data-startTime="3527">My name is Colt McAnlis. </span> <span class="line" data-startTime="3528">Here's how you get a </span><span class="line" data-startTime="3528">hold of me for email </span><span class="line" data-startTime="3530">and other various </span><span class="line" data-startTime="3530">social media times. </span> <span class="line" data-startTime="3532">Thanks, once again, for tuning </span><span class="line" data-startTime="3532">in to this episode of Google </span><span class="line" data-startTime="3534">Developers Live. </span></p>

<p><span class="line" data-startTime="3536">I hope to see you again soon. </span> <span class="line" data-startTime="3537">Thanks. </span></p>