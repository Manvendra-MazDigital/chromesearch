<style>* {font-family: "Open Sans", sans-serif}
a {color: #77aaff}
a.video {border-bottom: 1px solid #ddd; display: block; margin: 0 0 2em 0; padding: 0 0 2em 0}
h2 {color: #444; font-size: 18px;}
span.speakerName {color: black; font-weight: 900;}
body {padding: 2em}
p {color: #444; margin: 0; text-indent: 1.5em;}
p.speaker {margin: 1em 0 0 0; text-indent: 0;}
div#transcript > p:first-child {text-indent: 0;}
</style>

<h1>Building Chrome Apps with AngularJS</h1>

<h2>Brad Green, Darrel Sumi, John Feig</h2>

<a class="video" href="http://youtu.be/BSvquSYGoXQ">youtu.be/BSvquSYGoXQ</a><div id="transcript"><p class="speaker"><span class="line" data-starttime="9"><span class="speakerName">Brad Green</span>: Good </span><span class="line" data-startTime="9">morning, everyone. </span><span class="line" data-startTime="11">I'm Brad Green. </span><span class="line" data-startTime="11">I'm the manager of the Angular </span><span class="line" data-startTime="11">project here at Google. </span><span class="line" data-startTime="14">And I'm joined by John </span><span class="line" data-startTime="14">and Darrel from TiKL. </span><span class="line" data-startTime="17">And they're going to </span><span class="line" data-startTime="17">talk to us about building </span><span class="line" data-startTime="20">Chrome Apps with AngularJS. </span><span class="line" data-startTime="23">And I'm sorry, you guys. </span><span class="line" data-startTime="24">For this holiday </span><span class="line" data-startTime="24">addition, John's </span><span class="line" data-startTime="25">actually wearing some </span><span class="line" data-startTime="25">spectacular Christmas pants, </span><span class="line" data-startTime="27">but you can't see it on camera. </span><span class="line" data-startTime="30">Maybe at the end, we </span><span class="line" data-startTime="30">can get a shot of that. </span><span class="line" data-startTime="33">So hey guys, tell </span><span class="line" data-startTime="33">us a little bit </span><span class="line" data-startTime="35">about what TiKL </span><span class="line" data-startTime="35">does before we get </span><span class="line" data-startTime="36">into the presentation </span><span class="line" data-startTime="36">about building apps. </span></p>

<p class="speaker"><span class="line" data-starttime="38"><span class="speakerName">Darrel Sumi</span>: Sure. </span></p>

<p class="speaker"><span class="line" data-starttime="39"><span class="speakerName">John Feig</span>: Sure, yeah. </span><span class="line" data-startTime="40">We're mainly a </span><span class="line" data-startTime="40">mobile app company. </span><span class="line" data-startTime="43">We have several </span><span class="line" data-startTime="43">communications apps. </span><span class="line" data-startTime="46">We have three on Android. </span><span class="line" data-startTime="48">And wait &mdash; no, we </span><span class="line" data-startTime="48">have four on Android. </span></p>

<p class="speaker"><span class="line" data-starttime="50"><span class="speakerName">Darrel Sumi</span>: Four on </span><span class="line" data-startTime="50">Android, two on iOS. </span></p>

<p class="speaker"><span class="line" data-starttime="52"><span class="speakerName">John Feig</span>: Two on iOS. </span><span class="line" data-startTime="54">So we've got TiKL, which </span><span class="line" data-startTime="54">is like a walkie-talkie. </span><span class="line" data-startTime="58">It works just like </span><span class="line" data-startTime="58">a walkie-talkie. </span><span class="line" data-startTime="59">It's pretty fun. </span><span class="line" data-startTime="61">We have Talkray, which is </span><span class="line" data-startTime="61">our main focus these days, </span><span class="line" data-startTime="65">which is a unified </span><span class="line" data-startTime="65">communications app. </span><span class="line" data-startTime="67">You do texting, calling &mdash; it </span><span class="line" data-startTime="67">does groups up to 25 people. </span><span class="line" data-startTime="72">KeeChat, which is </span><span class="line" data-startTime="72">what we're going </span><span class="line" data-startTime="73">to be talking about </span><span class="line" data-startTime="73">today, which is </span><span class="line" data-startTime="76">group texting with usernames. </span><span class="line" data-startTime="79">And then we have a new app out </span><span class="line" data-startTime="79">that we launched a couple weeks </span><span class="line" data-startTime="83">ago, which is a </span><span class="line" data-startTime="83">PTT recorded app, </span><span class="line" data-startTime="88">so you can send voice </span><span class="line" data-startTime="88">mails back and forth. </span><span class="line" data-startTime="89">It's called VoMessenger. </span></p>

<p class="speaker"><span class="line" data-starttime="93"><span class="speakerName">Brad Green</span>: So you guys have </span><span class="line" data-startTime="93">been primarily doing Java and &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="95"><span class="speakerName">Darrel Sumi</span>: Yes. </span></p>

<p class="speaker"><span class="line" data-starttime="96"><span class="speakerName">Brad Green</span>:  &mdash; maybe </span><span class="line" data-startTime="96">Objective-C development. </span><span class="line" data-startTime="98">And you've just recently </span><span class="line" data-startTime="98">come into the web </span><span class="line" data-startTime="100">way of developing things. </span><span class="line" data-startTime="102">And so how long have </span><span class="line" data-startTime="102">you been doing this? </span></p>

<p class="speaker"><span class="line" data-starttime="105"><span class="speakerName">Darrel Sumi</span>: Since we </span><span class="line" data-startTime="105">started as a company, </span><span class="line" data-startTime="107">it's probably &mdash; I don't </span><span class="line" data-startTime="107">know, five months or so where </span><span class="line" data-startTime="112">we've been kind of </span><span class="line" data-startTime="112">jumped into this. </span></p>

<p class="speaker"><span class="line" data-starttime="114"><span class="speakerName">John Feig</span>: Yeah, we started over </span><span class="line" data-startTime="114">the summer doing the web stuff. </span></p>

<p class="speaker"><span class="line" data-starttime="118"><span class="speakerName">Darrel Sumi</span>: Yeah. </span><span class="line" data-startTime="119">I mean, both of </span><span class="line" data-startTime="119">us have obviously </span><span class="line" data-startTime="120">dabbled in a lot of </span><span class="line" data-startTime="120">web stuff before. </span><span class="line" data-startTime="123">But this is our first </span><span class="line" data-startTime="123">real, larger project. </span></p>

<p class="speaker"><span class="line" data-starttime="126"><span class="speakerName">John Feig</span>: Yeah, right. </span><span class="line" data-startTime="127">Definitely the </span><span class="line" data-startTime="127">first big project. </span><span class="line" data-startTime="129">And the company, as a </span><span class="line" data-startTime="129">company, doesn't really </span><span class="line" data-startTime="131">have much experience </span><span class="line" data-startTime="131">with web things. </span><span class="line" data-startTime="135">TiKL was started in 2010. </span><span class="line" data-startTime="137">They had the TiKL </span><span class="line" data-startTime="137">app for a while. </span><span class="line" data-startTime="138">And then we jumped into Talkray. </span><span class="line" data-startTime="140">And that was iOS and Android. </span><span class="line" data-startTime="143">And we've basically been </span><span class="line" data-startTime="143">focused on mobile exclusively </span><span class="line" data-startTime="145">until this product. </span></p>

<p class="speaker"><span class="line" data-starttime="147"><span class="speakerName">Brad Green</span>: OK, very cool. </span><span class="line" data-startTime="148">All right. </span><span class="line" data-startTime="148">Well, then, let's jump </span><span class="line" data-startTime="148">into the presentation. </span><span class="line" data-startTime="150">And tell us about </span><span class="line" data-startTime="150">what you guys have </span><span class="line" data-startTime="152">learned about the environment. </span></p>

<p class="speaker"><span class="line" data-starttime="153"><span class="speakerName">John Feig</span>: Great. </span><span class="line" data-startTime="154">So we can start with the slides. </span><span class="line" data-startTime="159">So this is KeeChat. </span></p>

<p class="speaker"><span class="line" data-starttime="161"><span class="speakerName">Darrel Sumi</span>: Yeah. </span><span class="line" data-startTime="162">So these are just a </span><span class="line" data-startTime="162">couple screenshots </span><span class="line" data-startTime="164">of what the mobile </span><span class="line" data-startTime="164">app looks like. </span><span class="line" data-startTime="166">So basically, like what we said, </span><span class="line" data-startTime="166">it's a unified messaging app. </span><span class="line" data-startTime="170">So you can send regular </span><span class="line" data-startTime="170">texting images to anyone </span><span class="line" data-startTime="173">within our system. </span></p>

<p class="speaker"><span class="line" data-starttime="177"><span class="speakerName">John Feig</span>: And we recently </span><span class="line" data-startTime="177">built a Chrome App out of it. </span><span class="line" data-startTime="179">We started with a </span><span class="line" data-startTime="179">web version of this. </span><span class="line" data-startTime="183">And then we sort of </span><span class="line" data-startTime="183">transitioned to a Chrome App. </span><span class="line" data-startTime="187">And we'll talk a </span><span class="line" data-startTime="187">little bit about why </span><span class="line" data-startTime="189">we picked Angular and Chrome. </span></p>

<p class="speaker"><span class="line" data-starttime="193"><span class="speakerName">Darrel Sumi</span>: Yeah. </span><span class="line" data-startTime="193">Angular really fit with, like </span><span class="line" data-startTime="193">we said, our background in Java. </span><span class="line" data-startTime="197">We wanted the look and </span><span class="line" data-startTime="197">feel of the entire thing </span><span class="line" data-startTime="200">to be very much like an </span><span class="line" data-startTime="200">app, less a traditional web </span><span class="line" data-startTime="204">style of doing things. </span><span class="line" data-startTime="206">And everything, like the </span><span class="line" data-startTime="206">MVC architecture of Angular, </span><span class="line" data-startTime="209">really fit into the </span><span class="line" data-startTime="209">pre-existing model </span><span class="line" data-startTime="212">that we had built everything </span><span class="line" data-startTime="212">around on the mobile side. </span></p>

<p class="speaker"><span class="line" data-starttime="215"><span class="speakerName">John Feig</span>: Right. </span><span class="line" data-startTime="215">Yeah. </span><span class="line" data-startTime="216">It was very comfortable </span><span class="line" data-startTime="216">for us to look at </span><span class="line" data-startTime="219">because it just felt a lot like </span><span class="line" data-startTime="219">being able to build an app. </span><span class="line" data-startTime="222">And you can see </span><span class="line" data-startTime="222">here the structure </span><span class="line" data-startTime="225">that we chose for KeeChat, </span><span class="line" data-startTime="225">which is basically </span><span class="line" data-startTime="229">Angular's suggested structure </span><span class="line" data-startTime="229">for especially large projects. </span><span class="line" data-startTime="234">So we broke it out into </span><span class="line" data-startTime="234">controllers and services </span><span class="line" data-startTime="237">and models are the </span><span class="line" data-startTime="237">main components here, </span><span class="line" data-startTime="242">trying to pick apart </span><span class="line" data-startTime="242">with the MVC architecture </span><span class="line" data-startTime="246">and do this properly. </span><span class="line" data-startTime="247">And it was really </span><span class="line" data-startTime="247">nice to have services. </span><span class="line" data-startTime="250">For us, coming from Java, </span><span class="line" data-startTime="250">where they're sort of like </span><span class="line" data-startTime="255">singletons. </span><span class="line" data-startTime="255">They work in a similar way. </span><span class="line" data-startTime="259">There's a lot of nice stuff. </span><span class="line" data-startTime="260">And organizing </span><span class="line" data-startTime="260">your code like this </span><span class="line" data-startTime="262">really helps in larger projects. </span></p>

<p class="speaker"><span class="line" data-starttime="267"><span class="speakerName">Darrel Sumi</span>: Yes. </span><span class="line" data-startTime="267">So I guess one of the </span><span class="line" data-startTime="267">reasons, or one of the things, </span><span class="line" data-startTime="270">is why did we chose to do a </span><span class="line" data-startTime="270">Chrome App off the Angular app. </span><span class="line" data-startTime="275">Why not just keep it a </span><span class="line" data-startTime="275">website kind of thing? </span><span class="line" data-startTime="278">So obviously, the biggest </span><span class="line" data-startTime="278">one is the Chrome Web Store. </span><span class="line" data-startTime="281">That's a great way to get </span><span class="line" data-startTime="281">distribution for our app. </span><span class="line" data-startTime="284">The other one is </span><span class="line" data-startTime="284">that, like I said, </span><span class="line" data-startTime="286">we really wanted to make </span><span class="line" data-startTime="286">it feel like an app. </span><span class="line" data-startTime="288">We wanted users who </span><span class="line" data-startTime="288">came from our mobile </span><span class="line" data-startTime="290">to be able to experience </span><span class="line" data-startTime="290">the same kind of experience </span><span class="line" data-startTime="293">that we provided </span><span class="line" data-startTime="293">on their computers. </span><span class="line" data-startTime="296">So one of the big </span><span class="line" data-startTime="296">things is notifications. </span><span class="line" data-startTime="298">That makes it feel like a </span><span class="line" data-startTime="298">much more rich experience. </span><span class="line" data-startTime="301">And obviously, raw sockets </span><span class="line" data-startTime="301">were pretty important for us </span><span class="line" data-startTime="304">because we're a </span><span class="line" data-startTime="304">communication app. </span></p>

<p class="speaker"><span class="line" data-starttime="307"><span class="speakerName">John Feig</span>: Yeah. </span><span class="line" data-startTime="308">We had played around with a </span><span class="line" data-startTime="308">couple different socket clients </span><span class="line" data-startTime="313">and decided that for </span><span class="line" data-startTime="313">us to get out the door, </span><span class="line" data-startTime="317">raw sockets was going to be the </span><span class="line" data-startTime="317">easiest way for us to do it. </span><span class="line" data-startTime="320">So that was something that </span><span class="line" data-startTime="320">was available in Chrome Apps </span><span class="line" data-startTime="324">that really you </span><span class="line" data-startTime="324">can't do in HTML5. </span><span class="line" data-startTime="327">There's WebSockets, but </span><span class="line" data-startTime="327">it's not the same thing. </span><span class="line" data-startTime="330">Java can use </span><span class="line" data-startTime="330">WebSockets in Java 7, </span><span class="line" data-startTime="334">but we're not running </span><span class="line" data-startTime="334">Java 7 on the server. </span></p>

<p class="speaker"><span class="line" data-starttime="339"><span class="speakerName">Darrel Sumi</span>: So </span><span class="line" data-startTime="339">some of the tools </span><span class="line" data-startTime="340">we use are &mdash; we'll just briefly </span><span class="line" data-startTime="340">go over this &mdash; Yeoman, Grunt, </span><span class="line" data-startTime="344">Bower, and Karma. </span><span class="line" data-startTime="345">Karma's our testing suite. </span><span class="line" data-startTime="346">The other three really help </span><span class="line" data-startTime="346">us organize our code a lot, </span><span class="line" data-startTime="350">bring in all the dependencies, </span><span class="line" data-startTime="350">keep everything clean. </span></p>

<p class="speaker"><span class="line" data-starttime="353"><span class="speakerName">John Feig</span>: Yeah. </span><span class="line" data-startTime="353">It's pretty standard stuff. </span><span class="line" data-startTime="354">And it was really nice </span><span class="line" data-startTime="354">with Grunt, actually. </span><span class="line" data-startTime="357">You can run Grunt server. </span><span class="line" data-startTime="358">And it has listeners for things. </span><span class="line" data-startTime="359">And so it was really funny. </span><span class="line" data-startTime="361">Because when we were really </span><span class="line" data-startTime="361">running through this stuff, </span><span class="line" data-startTime="365">it was faster developing on the </span><span class="line" data-startTime="365">web than it was for Android. </span><span class="line" data-startTime="372">Because you'd change something, </span><span class="line" data-startTime="372">and then your browser </span><span class="line" data-startTime="374">would get updated right away. </span><span class="line" data-startTime="376">I don't know. </span><span class="line" data-startTime="376">It was kind of funny. </span></p>

<p class="speaker"><span class="line" data-starttime="377"><span class="speakerName">Darrel Sumi</span>: Yeah, we're just </span><span class="line" data-startTime="377">used to waiting, compiling, </span><span class="line" data-startTime="382">and doing all this stuff </span><span class="line" data-startTime="382">for Android development. </span></p>

<p class="speaker"><span class="line" data-starttime="384"><span class="speakerName">John Feig</span>: Yeah. </span><span class="line" data-startTime="385">And we didn't even have to hit </span><span class="line" data-startTime="385">Refresh on the browser window </span><span class="line" data-startTime="387">here. </span><span class="line" data-startTime="387">So it's kind of nice. </span></p>

<p class="speaker"><span class="line" data-starttime="390"><span class="speakerName">Darrel Sumi</span>: So one of the </span><span class="line" data-startTime="390">main concerns, when you're </span><span class="line" data-startTime="394">thinking about </span><span class="line" data-startTime="394">building a Chrome App, </span><span class="line" data-startTime="395">is what are all the </span><span class="line" data-startTime="395">dependencies in your project </span><span class="line" data-startTime="397">that you're going to need to </span><span class="line" data-startTime="397">re-work around the Chrome Apps. </span> <span class="line" data-startTime="403">And one of them, the </span><span class="line" data-startTime="403">big one, was RequireJS. </span> <span class="line" data-startTime="406">So we used Require a lot. </span> <span class="line" data-startTime="408">It's a great modularization tool </span><span class="line" data-startTime="408">that you can use &mdash; or library. </span> <span class="line" data-startTime="413">A lot of people use it. </span> <span class="line" data-startTime="414">It's a very common thing. </span> <span class="line" data-startTime="416">But they kind of </span><span class="line" data-startTime="416">conflict a little bit </span><span class="line" data-startTime="417">with the module </span><span class="line" data-startTime="417">system in Angular. </span> <span class="line" data-startTime="421">They don't necessarily </span><span class="line" data-startTime="421">directly &mdash; they're </span><span class="line" data-startTime="425">not against each other. </span> <span class="line" data-startTime="425">In fact, that they're </span><span class="line" data-startTime="425">orthogonal ideas of the way </span><span class="line" data-startTime="429">they treat modularization. </span> <span class="line" data-startTime="432">But they are going to step </span><span class="line" data-startTime="432">over each other a little bit, </span><span class="line" data-startTime="434">so you've got to understand </span><span class="line" data-startTime="434">if you really need it </span><span class="line" data-startTime="436">and how to deal with it. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="439"><span class="speakerName">John Feig</span>: For us, we had all </span><span class="line" data-startTime="439">these third-party libraries </span><span class="line" data-startTime="442">that we just had to use. </span><span class="line" data-startTime="443">And some of those </span><span class="line" data-startTime="443">required Require. </span><span class="line" data-startTime="446">So it's like, OK, we're </span><span class="line" data-startTime="446">stuck using Require. </span><span class="line" data-startTime="450">It's kind of painful to </span><span class="line" data-startTime="450">get implemented properly </span><span class="line" data-startTime="453">with Angular. </span><span class="line" data-startTime="455">If you can avoid it, it's </span><span class="line" data-startTime="455">probably better to avoid it, </span><span class="line" data-startTime="458">but &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="459"><span class="speakerName">Darrel Sumi</span>: But it's </span><span class="line" data-startTime="459">still a great tool. </span><span class="line" data-startTime="460">And if you need it, there </span><span class="line" data-startTime="460">are several resources </span><span class="line" data-startTime="462">online that show examples </span><span class="line" data-startTime="462">of how exactly to do it. </span><span class="line" data-startTime="465">So it's not &mdash; there's </span><span class="line" data-startTime="465">ways around it. </span></p>

<p class="speaker"><span class="line" data-starttime="467"><span class="speakerName">John Feig</span>: And I have </span><span class="line" data-startTime="467">read that Angular </span><span class="line" data-startTime="468">is supposed to be getting </span><span class="line" data-startTime="468">better about trying </span><span class="line" data-startTime="470">to integrate with Require. </span></p>

<p class="speaker"><span class="line" data-starttime="471"><span class="speakerName">Brad Green</span>: We do want </span><span class="line" data-startTime="471">to work on that more. </span><span class="line" data-startTime="473">So like you say, these </span><span class="line" data-startTime="473">are two orthogonal things. </span><span class="line" data-startTime="477">One is about what does my </span><span class="line" data-startTime="477">JavaScript class need in order </span><span class="line" data-startTime="481">to run. </span><span class="line" data-startTime="482">The other is, what order </span><span class="line" data-startTime="482">should I load vals. </span></p>

<p class="speaker"><span class="line" data-starttime="483"><span class="speakerName">Darrel Sumi</span>: Right. </span><span class="line" data-startTime="483">Dependency order and then lazy </span><span class="line" data-startTime="483">loading, and things like that. </span></p>

<p class="speaker"><span class="line" data-starttime="485"><span class="speakerName">Brad Green</span>: It would be nice </span><span class="line" data-startTime="485">if these worked well together. </span><span class="line" data-startTime="487">This is some future thing </span><span class="line" data-startTime="487">we'd like to get right. </span></p>

<p class="speaker"><span class="line" data-starttime="491"><span class="speakerName">John Feig</span>: So, yeah. </span><span class="line" data-startTime="492">I guess now we're </span><span class="line" data-startTime="492">just going to dive </span><span class="line" data-startTime="494">into what the process of </span><span class="line" data-startTime="494">converting a web Angular </span><span class="line" data-startTime="498">app to a Chrome App was. </span></p>

<p class="speaker"><span class="line" data-starttime="503"><span class="speakerName">Darrel Sumi</span>: So just kind </span><span class="line" data-startTime="503">of the quick few basics </span><span class="line" data-startTime="505">that every kind of </span><span class="line" data-startTime="505">Chrome App needs </span><span class="line" data-startTime="507">is that it's going to need a </span><span class="line" data-startTime="507">manifest.json file that pretty </span><span class="line" data-startTime="510">much describes all the </span><span class="line" data-startTime="510">permissions and the app name </span><span class="line" data-startTime="513">and things that </span><span class="line" data-startTime="513">go into the store. </span> <span class="line" data-startTime="517">There's going to be a </span><span class="line" data-startTime="517">background.js file that </span><span class="line" data-startTime="520">describes several entry </span><span class="line" data-startTime="520">points into the app, </span><span class="line" data-startTime="522">like what happens </span><span class="line" data-startTime="522">when you install </span><span class="line" data-startTime="524">the app, what happens on launch. </span> <span class="line" data-startTime="526">And you're going to need here, </span><span class="line" data-startTime="526">obviously, your index files, </span><span class="line" data-startTime="529">your main index file. </span> <span class="line" data-startTime="531">But there's a trick to this </span><span class="line" data-startTime="531">one is that it sometimes </span><span class="line" data-startTime="533">differs from what you normally </span><span class="line" data-startTime="533">would have in your Angular </span><span class="line" data-startTime="536">project. </span></p>

<p class="speaker"><span class="line" data-starttime="538"><span class="speakerName">John Feig</span>: OK. </span><span class="line" data-startTime="538">So we can look at the manifest </span><span class="line" data-startTime="538">here for a little demo app </span><span class="line" data-startTime="542">that I did. </span><span class="line" data-startTime="544">And it's really pretty basic. </span><span class="line" data-startTime="546">You've got your </span><span class="line" data-startTime="546">name, description. </span><span class="line" data-startTime="548">You have the entry point of </span><span class="line" data-startTime="548">the JavaScript for your app </span><span class="line" data-startTime="552">to find, which is background.js. </span><span class="line" data-startTime="555">That's a pretty standard </span><span class="line" data-startTime="555">thing within Chrome Apps. </span><span class="line" data-startTime="558">And then permissions &mdash; </span><span class="line" data-startTime="558">so for example, </span><span class="line" data-startTime="561">I need to be able to talk to </span><span class="line" data-startTime="561">the ajax.googleapis.com site. </span><span class="line" data-startTime="566">And I also need to have </span><span class="line" data-startTime="566">storage permissions. </span><span class="line" data-startTime="569">And then you also </span><span class="line" data-startTime="569">specify your icons. </span></p>

<p class="speaker"><span class="line" data-starttime="571"><span class="speakerName">Darrel Sumi</span>: Yeah, </span><span class="line" data-startTime="571">pretty straightforward. </span><span class="line" data-startTime="573">And like I said, </span><span class="line" data-startTime="573">for the background, </span><span class="line" data-startTime="575">you can pretty much </span><span class="line" data-startTime="575">describe generic things </span><span class="line" data-startTime="579">about your Chrome App. </span><span class="line" data-startTime="580">So in this case, all we said is </span><span class="line" data-startTime="580">the width is going to be 1,200, </span><span class="line" data-startTime="583">the height's going to be 700. </span></p>

<p class="speaker"><span class="line" data-starttime="585"><span class="speakerName">John Feig</span>: Yeah. </span><span class="line" data-startTime="586">And then your index </span><span class="line" data-startTime="586">is chomeindex.html. </span><span class="line" data-startTime="589">And you can name it </span><span class="line" data-startTime="589">whatever you want. </span><span class="line" data-startTime="591">But I think it's easy just </span><span class="line" data-startTime="591">to call it Chrome Index. </span><span class="line" data-startTime="594">And your regular one's Index. </span><span class="line" data-startTime="598">OK. </span></p>

<p class="speaker"><span class="line" data-starttime="598"><span class="speakerName">Darrel Sumi</span>: So once you </span><span class="line" data-startTime="598">add all these things in, </span><span class="line" data-startTime="600">and you think, OK, this </span><span class="line" data-startTime="600">is going to &mdash; things </span><span class="line" data-startTime="602">are going to look good. </span><span class="line" data-startTime="603">And you try running it. </span><span class="line" data-startTime="604">Of course, nothing works, right? </span></p>

<p class="speaker"><span class="line" data-starttime="605"><span class="speakerName">John Feig</span>: Yeah. </span><span class="line" data-startTime="606">You get a lot of red. </span></p>

<p class="speaker"><span class="line" data-starttime="607"><span class="speakerName">Darrel Sumi</span>: Right, right. </span> <span class="line" data-startTime="608">And so one of the main, </span><span class="line" data-startTime="608">first ways to approach this </span><span class="line" data-startTime="611">is there's a thing </span><span class="line" data-startTime="611">called a Content Security </span><span class="line" data-startTime="614">Policy that web </span><span class="line" data-startTime="614">browsers implement. </span> <span class="line" data-startTime="617">It basically </span><span class="line" data-startTime="617">restricts what you can </span><span class="line" data-startTime="620">do so that third-party external </span><span class="line" data-startTime="620">code doesn't maliciously </span><span class="line" data-startTime="624">run some hacks on </span><span class="line" data-startTime="624">your website and cause </span><span class="line" data-startTime="628">all kinds of problems. </span> <span class="line" data-startTime="630">So this is something </span><span class="line" data-startTime="630">that's already </span><span class="line" data-startTime="632">out in most web browsers. </span> <span class="line" data-startTime="633">But then Chrome Apps have </span><span class="line" data-startTime="633">a tighter restriction </span><span class="line" data-startTime="637">on this Content Security Policy. </span></p>

<p><span class="line" data-startTime="640">So the three main things that </span><span class="line" data-startTime="640">differ from traditional web are </span><span class="line" data-startTime="643">is that it's going to </span><span class="line" data-startTime="643">restrict any inline scripting. </span> <span class="line" data-startTime="646">It's going to restrict </span><span class="line" data-startTime="646">any external resources. </span> <span class="line" data-startTime="649">So if you link to some extra </span><span class="line" data-startTime="649">library somewhere else, </span><span class="line" data-startTime="653">you can't necessarily </span><span class="line" data-startTime="653">just link to that </span><span class="line" data-startTime="656">to bring that script in. </span> <span class="line" data-startTime="657">And it's going to </span><span class="line" data-startTime="657">restrict anything </span><span class="line" data-startTime="659">that pretty much converts </span><span class="line" data-startTime="659">strings into JavaScript. </span> <span class="line" data-startTime="663">So things that use the eval </span><span class="line" data-startTime="663">or new Function methods </span><span class="line" data-startTime="667">are not going to </span><span class="line" data-startTime="667">work in Chrome Apps. </span> <span class="line" data-startTime="670">So the second thing </span><span class="line" data-startTime="670">that I talked about, </span><span class="line" data-startTime="674">the external resources, </span><span class="line" data-startTime="674">so the first thing </span><span class="line" data-startTime="677">you're going to look at is </span><span class="line" data-startTime="677">what third-party libraries </span><span class="line" data-startTime="679">you bring in that </span><span class="line" data-startTime="679">you might actually </span><span class="line" data-startTime="681">reference from a </span><span class="line" data-startTime="681">CDN or something. </span> <span class="line" data-startTime="684">These you can't bring </span><span class="line" data-startTime="684">into your app directly, </span><span class="line" data-startTime="685">so you're going to </span><span class="line" data-startTime="685">have to download </span><span class="line" data-startTime="687">these libraries or any </span><span class="line" data-startTime="687">styles, or fonts, images, </span><span class="line" data-startTime="690">any other kind of static </span><span class="line" data-startTime="690">content that you might </span><span class="line" data-startTime="692">be able to just bring </span><span class="line" data-startTime="692">into your app and have it </span><span class="line" data-startTime="694">hosted straight from there. </span></p>

<p><span class="line" data-startTime="696">And so you're going to </span><span class="line" data-startTime="696">have to modify your index </span><span class="line" data-startTime="698">file, obviously, because that's </span><span class="line" data-startTime="698">where all these things get </span><span class="line" data-startTime="701">referenced. </span> <span class="line" data-startTime="704">So here's a quick example of how </span><span class="line" data-startTime="704">the index that you might have </span><span class="line" data-startTime="709">for your regular </span><span class="line" data-startTime="709">Angular projects </span><span class="line" data-startTime="712">will differ from the Chrome one. </span> <span class="line" data-startTime="714">So first one, when </span><span class="line" data-startTime="714">we reference the app, </span><span class="line" data-startTime="717">is going to be a ngCsp. </span></p>

<p class="speaker"><span class="line" data-starttime="719"><span class="speakerName">John Feig</span>: I don't </span><span class="line" data-startTime="719">think it highlights. </span></p>

<p class="speaker"><span class="line" data-starttime="720"><span class="speakerName">Darrel Sumi</span>: Yeah, </span><span class="line" data-startTime="720">it doesn't highlight. </span><span class="line" data-startTime="722">There's going to </span><span class="line" data-startTime="722">be a ngCsp Angular </span><span class="line" data-startTime="724">tag that you're </span><span class="line" data-startTime="724">going to put there. </span><span class="line" data-startTime="726">What this describes </span><span class="line" data-startTime="726">is that it tells </span><span class="line" data-startTime="729">Angular to be in a </span><span class="line" data-startTime="729">CSP mode, essentially. </span><span class="line" data-startTime="734">Angular has a lot </span><span class="line" data-startTime="734">of optimizations </span><span class="line" data-startTime="736">that use things like the </span><span class="line" data-startTime="736">eval and new Function, </span><span class="line" data-startTime="740">I believe, basically </span><span class="line" data-startTime="740">just to optimize Angular. </span><span class="line" data-startTime="745">But for it to run </span><span class="line" data-startTime="745">in the Chrome App, </span><span class="line" data-startTime="747">you have to restrict </span><span class="line" data-startTime="747">those kinds of things. </span><span class="line" data-startTime="749">So it has a CSP mode </span><span class="line" data-startTime="749">that'll get around that. </span></p>

<p class="speaker"><span class="line" data-starttime="751"><span class="speakerName">Brad Green</span>: It's actually </span><span class="line" data-startTime="751">only a few little things. </span><span class="line" data-startTime="753">You don't lose very much at all. </span></p>

<p class="speaker"><span class="line" data-starttime="754"><span class="speakerName">Darrel Sumi</span>: OK. </span><span class="line" data-startTime="754">Well, yeah. </span><span class="line" data-startTime="755">Great. </span></p>

<p class="speaker"><span class="line" data-starttime="755"><span class="speakerName">Brad Green</span>: It's one </span><span class="line" data-startTime="755">small optimization. </span><span class="line" data-startTime="757">But yes, you do lose it. </span></p>

<p class="speaker"><span class="line" data-starttime="758"><span class="speakerName">Darrel Sumi</span>: Right, right. </span><span class="line" data-startTime="759">And so you do need </span><span class="line" data-startTime="759">to specify that. </span><span class="line" data-startTime="762">And obviously, now that </span><span class="line" data-startTime="762">you downloaded &mdash; say, </span><span class="line" data-startTime="765">in this example </span><span class="line" data-startTime="765">it's a Socket.IO. </span><span class="line" data-startTime="767">We were referencing </span><span class="line" data-startTime="767">it from the CDN. </span><span class="line" data-startTime="769">And so now we just have to </span><span class="line" data-startTime="769">bring it into your own project </span><span class="line" data-startTime="771">and reference it that way. </span><span class="line" data-startTime="773">Pretty straightforward. </span></p>

<p class="speaker"><span class="line" data-starttime="774"><span class="speakerName">John Feig</span>: Yep. </span><span class="line" data-startTime="774">And then you try running it </span><span class="line" data-startTime="774">again, and it's still broken. </span><span class="line" data-startTime="778">So &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="779"><span class="speakerName">Darrel Sumi</span>: OK, so here's a </span><span class="line" data-startTime="779">little demo &mdash; let me switch. </span><span class="line" data-startTime="783">Here's a little demo of </span><span class="line" data-startTime="783">a socket app that I made. </span><span class="line" data-startTime="788">So basically, all this is &mdash; </span><span class="line" data-startTime="788">it's just a small little test </span><span class="line" data-startTime="794">demo that connects </span><span class="line" data-startTime="794">to a Node.js server. </span><span class="line" data-startTime="798">The Node.js server </span><span class="line" data-startTime="798">starts counting </span><span class="line" data-startTime="800">every one, two, </span><span class="line" data-startTime="800">three &mdash; every second. </span><span class="line" data-startTime="802">And it would reply </span><span class="line" data-startTime="802">back on Socket.IO </span><span class="line" data-startTime="804">to the client and display </span><span class="line" data-startTime="804">what the current count is, </span><span class="line" data-startTime="808">essentially. </span><span class="line" data-startTime="809">Really simple &mdash; that's </span><span class="line" data-startTime="809">all that's happening. </span><span class="line" data-startTime="812">And so here, you'll see that </span><span class="line" data-startTime="812">the counter's incrementing. </span><span class="line" data-startTime="815">But at this point, </span><span class="line" data-startTime="815">the Angular project </span><span class="line" data-startTime="818">doesn't know anything about </span><span class="line" data-startTime="818">what the count was previously. </span><span class="line" data-startTime="821">It doesn't know anything </span><span class="line" data-startTime="821">about who its friends are. </span><span class="line" data-startTime="824">These are all initialized and </span><span class="line" data-startTime="824">given to us by the Node server. </span></p>

<p class="speaker"><span class="line" data-starttime="830"><span class="speakerName">John Feig</span>: Yeah. </span><span class="line" data-startTime="830">You don't want to </span><span class="line" data-startTime="830">dive into &mdash; OK. </span></p>

<p class="speaker"><span class="line" data-starttime="832"><span class="speakerName">Darrel Sumi</span>: Whoa. </span> <span class="line" data-startTime="835">Whoops. </span> <span class="line" data-startTime="836">There we go. </span> <span class="line" data-startTime="836">OK. </span> <span class="line" data-startTime="838">So one of the key components to </span><span class="line" data-startTime="838">Angular as well as Chrome Apps </span><span class="line" data-startTime="844">is that the way you </span><span class="line" data-startTime="844">think about web servers </span><span class="line" data-startTime="846">traditionally is switched </span><span class="line" data-startTime="846">to be using an API server. </span> <span class="line" data-startTime="851">So the web server you need </span><span class="line" data-startTime="851">to treat as an API server. </span> <span class="line" data-startTime="854">And what that means is </span><span class="line" data-startTime="854">that the web server is not </span><span class="line" data-startTime="856">going to hand down HTML or </span><span class="line" data-startTime="856">things like that, where it's </span><span class="line" data-startTime="860">traditionally &mdash; they might </span><span class="line" data-startTime="860">have injected information, say. </span> <span class="line" data-startTime="864">You grab information </span><span class="line" data-startTime="864">from your database, </span><span class="line" data-startTime="865">and you put it in your friends </span><span class="line" data-startTime="865">list or something, for example. </span> <span class="line" data-startTime="868">And it's not going to inject </span><span class="line" data-startTime="868">[? a string ?] into the HTML </span><span class="line" data-startTime="870">and hand you back the HTML. </span> <span class="line" data-startTime="872">Rather, all that's going to </span><span class="line" data-startTime="872">exist in your Angular app </span><span class="line" data-startTime="875">already. </span> <span class="line" data-startTime="876">And really, what your </span><span class="line" data-startTime="876">server should be doing </span><span class="line" data-startTime="878">is sending back just the data, </span><span class="line" data-startTime="878">none of the UI components. </span></p>

<p><span class="line" data-startTime="882">So in this example, </span><span class="line" data-startTime="882">this is how the HTML </span><span class="line" data-startTime="885">looks like for the </span><span class="line" data-startTime="885">example I just showed you. </span> <span class="line" data-startTime="889">Pretty much all we know </span><span class="line" data-startTime="889">on the Angular side </span><span class="line" data-startTime="891">is that there's </span><span class="line" data-startTime="891">going to be a count. </span> <span class="line" data-startTime="894">There's going to be </span><span class="line" data-startTime="894">a count listed here. </span> <span class="line" data-startTime="896">Whoops. </span> <span class="line" data-startTime="896">That doesn't do that. </span> <span class="line" data-startTime="897">JOHN FEIG: [LAUGHTER] No. </span></p>

<p class="speaker"><span class="line" data-starttime="898"><span class="speakerName">Darrel Sumi</span>: OK. </span><span class="line" data-startTime="898">So there's going to be a </span><span class="line" data-startTime="898">count referenced there. </span><span class="line" data-startTime="900">And we're going to be repeating </span><span class="line" data-startTime="900">over a list of friends. </span><span class="line" data-startTime="902">But we don't know who the </span><span class="line" data-startTime="902">friends are at this point. </span><span class="line" data-startTime="905">There might be one friend. </span><span class="line" data-startTime="906">There might be hundreds. </span><span class="line" data-startTime="907">And we don't know. </span><span class="line" data-startTime="908">But really, you need to </span><span class="line" data-startTime="908">treat your web server </span><span class="line" data-startTime="910">to give you those </span><span class="line" data-startTime="910">things as an API server. </span></p>

<p class="speaker"><span class="line" data-starttime="912"><span class="speakerName">Brad Green</span>: And this is the </span><span class="line" data-startTime="912">great thing about Angular </span><span class="line" data-startTime="914">is you're going to build </span><span class="line" data-startTime="914">your app this way anyway. </span><span class="line" data-startTime="916">So there's not much </span><span class="line" data-startTime="916">in the transition. </span></p>

<p class="speaker"><span class="line" data-starttime="918"><span class="speakerName">John Feig</span>: Right. </span></p>

<p class="speaker"><span class="line" data-starttime="919"><span class="speakerName">Darrel Sumi</span>: Exactly. </span></p>

<p class="speaker"><span class="line" data-starttime="920"><span class="speakerName">John Feig</span>: So we're going </span><span class="line" data-startTime="920">to look at Socket.IO here. </span></p>

<p class="speaker"><span class="line" data-starttime="922"><span class="speakerName">Darrel Sumi</span>: OK. </span></p>

<p class="speaker"><span class="line" data-starttime="923"><span class="speakerName">John Feig</span>: Whoops. </span><span class="line" data-startTime="923">Uh-oh. </span><span class="line" data-startTime="924">That's not good. </span></p>

<p class="speaker"><span class="line" data-starttime="926"><span class="speakerName">Darrel Sumi</span>: OK. </span><span class="line" data-startTime="927">So here is some of the </span><span class="line" data-startTime="927">code for this example. </span><span class="line" data-startTime="931">And this is all, by the way, </span><span class="line" data-startTime="931">{public} GitHub {repress}, </span><span class="line" data-startTime="934">so that you can look </span><span class="line" data-startTime="934">it later on your time. </span></p>

<p class="speaker"><span class="line" data-starttime="936"><span class="speakerName">John Feig</span>: Yeah. </span><span class="line" data-startTime="937">We have links at the end. </span></p>

<p class="speaker"><span class="line" data-starttime="938"><span class="speakerName">Darrel Sumi</span>: Right, right. </span> <span class="line" data-startTime="940">So this is the main controller </span><span class="line" data-startTime="940">for the example I was just </span><span class="line" data-startTime="945">[? saying ?]. </span> <span class="line" data-startTime="946">So basically, there is </span><span class="line" data-startTime="946">going to be a count that's </span><span class="line" data-startTime="949">initialized at zero and </span><span class="line" data-startTime="949">an empty friends list. </span> <span class="line" data-startTime="951">Like I said, you don't </span><span class="line" data-startTime="951">really know anything </span><span class="line" data-startTime="953">about what's happening. </span> <span class="line" data-startTime="955">And the way we </span><span class="line" data-startTime="955">have it structured </span><span class="line" data-startTime="957">is that initially, you </span><span class="line" data-startTime="957">just connect to the server. </span> <span class="line" data-startTime="960">The server is, like I </span><span class="line" data-startTime="960">said, a Node.js server </span><span class="line" data-startTime="963">that's running locally. </span> <span class="line" data-startTime="966">And here is a service that </span><span class="line" data-startTime="966">controls the communication </span><span class="line" data-startTime="970">to that Node server. </span> <span class="line" data-startTime="972">So in server connect, </span><span class="line" data-startTime="972">where you start off, </span><span class="line" data-startTime="975">essentially we just connect </span><span class="line" data-startTime="975">to &mdash; I have a hard-coded thing </span><span class="line" data-startTime="978">to look a host right here. </span> <span class="line" data-startTime="981">And at this point, we </span><span class="line" data-startTime="981">don't know any kind </span><span class="line" data-startTime="983">of data that's been </span><span class="line" data-startTime="983">passed through. </span></p>

<p><span class="line" data-startTime="985">We just know that we </span><span class="line" data-startTime="985">started with nothing. </span> <span class="line" data-startTime="988">So what we do is we </span><span class="line" data-startTime="988">tell it to connect. </span> <span class="line" data-startTime="991">And when we connect, we event </span><span class="line" data-startTime="991">an emit back to our controller, </span><span class="line" data-startTime="995">saying, hey, we've connected. </span> <span class="line" data-startTime="997">And at this point &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="998"><span class="speakerName">Brad Green</span>: Actually, Darrel, </span><span class="line" data-startTime="998">maybe just bump the font </span><span class="line" data-startTime="1001">up a point or two. </span></p>

<p class="speaker"><span class="line" data-starttime="1002"><span class="speakerName">Darrel Sumi</span>: Sure. </span><span class="line" data-startTime="1002">What was it? </span><span class="line" data-startTime="1003">Command-Plus? </span></p>

<p class="speaker"><span class="line" data-starttime="1004"><span class="speakerName">John Feig</span>: Yeah. </span></p>

<p class="speaker"><span class="line" data-starttime="1005"><span class="speakerName">Darrel Sumi</span>: There we go. </span></p>

<p class="speaker"><span class="line" data-starttime="1006"><span class="speakerName">Brad Green</span>: That'll be good. </span></p>

<p class="speaker"><span class="line" data-starttime="1007"><span class="speakerName">John Feig</span>: Sorry about that. </span></p>

<p class="speaker"><span class="line" data-starttime="1011"><span class="speakerName">Darrel Sumi</span>: So </span><span class="line" data-startTime="1011">in our controller, </span><span class="line" data-startTime="1012">when you do connect, we're </span><span class="line" data-startTime="1012">going to tell it to initialize, </span><span class="line" data-startTime="1017">initialize our state. </span> <span class="line" data-startTime="1019">So at this point, </span><span class="line" data-startTime="1019">your API server </span><span class="line" data-startTime="1022">doesn't really know anything </span><span class="line" data-startTime="1022">about where you've left off </span><span class="line" data-startTime="1025">or what it is. </span> <span class="line" data-startTime="1026">It's just going to start </span><span class="line" data-startTime="1026">counting from some random &mdash; </span><span class="line" data-startTime="1028">from zero, if the server </span><span class="line" data-startTime="1028">doesn't know anything. </span> <span class="line" data-startTime="1031">So it helps if you pass in some </span><span class="line" data-startTime="1031">kind of initialization data </span><span class="line" data-startTime="1035">to tell it, hey, this </span><span class="line" data-startTime="1035">is where we left off. </span></p>

<p><span class="line" data-startTime="1036">And this leads into </span><span class="line" data-startTime="1036">a key point of how </span><span class="line" data-startTime="1039">you want to treat </span><span class="line" data-startTime="1039">offline and online mode. </span> <span class="line" data-startTime="1042">But we'll get to </span><span class="line" data-startTime="1042">that in a second. </span> <span class="line" data-startTime="1045">And so we initialize it </span><span class="line" data-startTime="1045">with our current count, </span><span class="line" data-startTime="1049">which at this point is zero. </span> <span class="line" data-startTime="1052">And when we get a response </span><span class="line" data-startTime="1052">back from the server here, </span><span class="line" data-startTime="1056">and it responds here, </span><span class="line" data-startTime="1056">we'll get back some data. </span> <span class="line" data-startTime="1059">And in the data &mdash; </span><span class="line" data-startTime="1059">like I just know </span><span class="line" data-startTime="1061">it's going to contain the </span><span class="line" data-startTime="1061">current count and just </span><span class="line" data-startTime="1065">a list of friends, which </span><span class="line" data-startTime="1065">doesn't really change. </span> <span class="line" data-startTime="1068">And then from that point </span><span class="line" data-startTime="1068">onward, the socket's </span><span class="line" data-startTime="1070">going to connect &mdash; it's going </span><span class="line" data-startTime="1070">to listen for a counter update </span><span class="line" data-startTime="1074">event that's going to </span><span class="line" data-startTime="1074">get pushed down once </span><span class="line" data-startTime="1076">every second from </span><span class="line" data-startTime="1076">the Node server. </span></p>

<p><span class="line" data-startTime="1079">And it's just going emit </span><span class="line" data-startTime="1079">the count right here. </span> <span class="line" data-startTime="1081">So the count is actually </span><span class="line" data-startTime="1081">incremented on the server side. </span> <span class="line" data-startTime="1085">So all that kind of </span><span class="line" data-startTime="1085">logic &mdash; obviously, </span><span class="line" data-startTime="1087">this is a contrived </span><span class="line" data-startTime="1087">example of what </span><span class="line" data-startTime="1089">you might want to pass </span><span class="line" data-startTime="1089">down, what information you </span><span class="line" data-startTime="1092">want to pass down </span><span class="line" data-startTime="1092">from your server. </span> <span class="line" data-startTime="1093">But essentially, </span><span class="line" data-startTime="1093">the server's going </span><span class="line" data-startTime="1096">to be handling all that </span><span class="line" data-startTime="1096">kind of data management, </span><span class="line" data-startTime="1098">a lot of that </span><span class="line" data-startTime="1098">stuff that goes on. </span> <span class="line" data-startTime="1102">But you'll notice here </span><span class="line" data-startTime="1102">that this is all just </span><span class="line" data-startTime="1104">standard Socket.IO stuff if </span><span class="line" data-startTime="1104">you have worked with it before. </span> <span class="line" data-startTime="1110">[INAUDIBLE] All right. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="1117"><span class="speakerName">John Feig</span>: There we go. </span></p>

<p class="speaker"><span class="line" data-starttime="1118"><span class="speakerName">Darrel Sumi</span>: OK. </span> <span class="line" data-startTime="1118">Right. </span> <span class="line" data-startTime="1120">And so one of the </span><span class="line" data-startTime="1120">things that you </span><span class="line" data-startTime="1122">have to consider when you </span><span class="line" data-startTime="1122">build your Chrome app, </span><span class="line" data-startTime="1125">and for Angular as </span><span class="line" data-startTime="1125">well, is how this </span><span class="line" data-startTime="1128">is going to get treated </span><span class="line" data-startTime="1128">in an offline mode </span><span class="line" data-startTime="1130">or in a state where you're not </span><span class="line" data-startTime="1130">sure about the connectivity </span><span class="line" data-startTime="1134">of things. </span> <span class="line" data-startTime="1135">So you do need to handle things </span><span class="line" data-startTime="1135">like disconnections or crappy </span><span class="line" data-startTime="1138">connections. </span> <span class="line" data-startTime="1139">And a lot of that needs to go </span><span class="line" data-startTime="1139">into any kind of socket code </span><span class="line" data-startTime="1144">that you write. </span> <span class="line" data-startTime="1145">So luckily, Socket.IO </span><span class="line" data-startTime="1145">handles a lot </span><span class="line" data-startTime="1147">of the disconnect and </span><span class="line" data-startTime="1147">auto-reconnect logic. </span> <span class="line" data-startTime="1149">But if you're working </span><span class="line" data-startTime="1149">with raw sockets, </span><span class="line" data-startTime="1150">you're going to need to handle </span><span class="line" data-startTime="1150">these kinds of things, as well. </span> <span class="line" data-startTime="1153">But more than just the </span><span class="line" data-startTime="1153">actual connectivity, </span><span class="line" data-startTime="1155">you need to think about </span><span class="line" data-startTime="1155">how your app is going </span><span class="line" data-startTime="1158">to work from the </span><span class="line" data-startTime="1158">user's standpoint </span><span class="line" data-startTime="1162">when you don't </span><span class="line" data-startTime="1162">have connectivity. </span></p>

<p><span class="line" data-startTime="1163">If you start up the app, will </span><span class="line" data-startTime="1163">you be showing a blank page? </span><span class="line" data-startTime="1169">If you lose connection </span><span class="line" data-startTime="1169">in the middle, what's </span><span class="line" data-startTime="1171">going to happen to, let's </span><span class="line" data-startTime="1171">say, in our example, </span><span class="line" data-startTime="1173">the counter that </span><span class="line" data-startTime="1173">you have going on? </span></p>

<p class="speaker"><span class="line" data-starttime="1175"><span class="speakerName">John Feig</span>: Right. </span><span class="line" data-startTime="1176">You don't want to just </span><span class="line" data-startTime="1176">throw up a Refresh button </span><span class="line" data-startTime="1178">and make the user </span><span class="line" data-startTime="1178">think about that stuff. </span><span class="line" data-startTime="1180">You want to handle </span><span class="line" data-startTime="1180">it in a smart way </span><span class="line" data-startTime="1184">so that it's as </span><span class="line" data-startTime="1184">automatic as it can be. </span></p>

<p class="speaker"><span class="line" data-starttime="1187"><span class="speakerName">Darrel Sumi</span>: Right, right. </span><span class="line" data-startTime="1188">So in our example &mdash; can </span><span class="line" data-startTime="1188">we go &mdash; what's it called? </span><span class="line" data-startTime="1191">Terminate the server. </span></p>

<p class="speaker"><span class="line" data-starttime="1193"><span class="speakerName">John Feig</span>: Oh, the &mdash; OK. </span><span class="line" data-startTime="1195">Um, yeah. </span><span class="line" data-startTime="1199">There we go. </span><span class="line" data-startTime="1203">OK. </span><span class="line" data-startTime="1205">Server's up there. </span></p>

<p class="speaker"><span class="line" data-starttime="1206"><span class="speakerName">Darrel Sumi</span>: OK. </span><span class="line" data-startTime="1207">So we just &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="1208"><span class="speakerName">John Feig</span>: Server's dead. </span></p>

<p class="speaker"><span class="line" data-starttime="1208"><span class="speakerName">Darrel Sumi</span>: Yeah, killed </span><span class="line" data-startTime="1208">our server, essentially. </span> <span class="line" data-startTime="1210">And when you go </span><span class="line" data-startTime="1210">back to this, you'll </span><span class="line" data-startTime="1212">notice that the </span><span class="line" data-startTime="1212">counter has stopped. </span> <span class="line" data-startTime="1213">You'll probably </span><span class="line" data-startTime="1213">want to do something </span><span class="line" data-startTime="1215">to signify that you're in </span><span class="line" data-startTime="1215">an offline mode, maybe. </span> <span class="line" data-startTime="1217">That might help, </span><span class="line" data-startTime="1217">so the user doesn't </span><span class="line" data-startTime="1219">get confused, like, why </span><span class="line" data-startTime="1219">isn't anything working? </span><span class="line" data-startTime="1222">But you notice that the count </span><span class="line" data-startTime="1222">is just stopped at here. </span> <span class="line" data-startTime="1224">But if you were to </span><span class="line" data-startTime="1224">redo the server, </span><span class="line" data-startTime="1226">or reconnect it, after </span><span class="line" data-startTime="1226">some retrial logic, </span><span class="line" data-startTime="1231">it's going to </span><span class="line" data-startTime="1231">essentially start back </span><span class="line" data-startTime="1233">from where we previously </span><span class="line" data-startTime="1233">were counting. </span></p>

<p><span class="line" data-startTime="1235">So you don't want to </span><span class="line" data-startTime="1235">necessarily start from scratch </span><span class="line" data-startTime="1237">every time you reconnect. </span> <span class="line" data-startTime="1239">You want to leave the user </span><span class="line" data-startTime="1239">off where they were before </span><span class="line" data-startTime="1242">and [? smoothen </span><span class="line" data-startTime="1242">?] the transition </span><span class="line" data-startTime="1244">between these things. </span></p>

<p class="speaker"><span class="line" data-starttime="1245"><span class="speakerName">John Feig</span>: You </span><span class="line" data-startTime="1245">can see it worked. </span><span class="line" data-startTime="1246">We were stuck at 419, and </span><span class="line" data-startTime="1246">now we're counting again. </span></p>

<p class="speaker"><span class="line" data-starttime="1249"><span class="speakerName">Darrel Sumi</span>: Right, right. </span><span class="line" data-startTime="1250">So you don't necessarily want </span><span class="line" data-startTime="1250">to start at zero every time. </span></p>

<p class="speaker"><span class="line" data-starttime="1257"><span class="speakerName">John Feig</span>: OK. </span><span class="line" data-startTime="1259">So go here. </span></p>

<p class="speaker"><span class="line" data-starttime="1262"><span class="speakerName">Darrel Sumi</span>: So </span><span class="line" data-startTime="1262">this whole example </span><span class="line" data-startTime="1263">was, [? obviously, ?] just </span><span class="line" data-startTime="1263">a regular Angular app. </span><span class="line" data-startTime="1266">And the same thing works for &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="1270"><span class="speakerName">John Feig</span>: Kill this one. </span></p>

<p class="speaker"><span class="line" data-starttime="1271"><span class="speakerName">Darrel Sumi</span>: Yeah. </span><span class="line" data-startTime="1271">Same thing works &mdash; </span><span class="line" data-startTime="1271">the transition </span><span class="line" data-startTime="1274">from bringing Socket.IO </span><span class="line" data-startTime="1274">into Chrome Apps </span><span class="line" data-startTime="1276">is really, really simple, </span><span class="line" data-startTime="1276">pretty much like what </span><span class="line" data-startTime="1279">we showed earlier where you </span><span class="line" data-startTime="1279">reference the Socket.IO, not </span><span class="line" data-startTime="1282">from CDN but from </span><span class="line" data-startTime="1282">your own project. </span><span class="line" data-startTime="1285">After you do that, </span><span class="line" data-startTime="1285">that's pretty much it. </span><span class="line" data-startTime="1287">There isn't a </span><span class="line" data-startTime="1287">whole lot of things </span><span class="line" data-startTime="1289">that you need to do to </span><span class="line" data-startTime="1289">get Socket.IO working. </span><span class="line" data-startTime="1291">It actually just </span><span class="line" data-startTime="1291">works out of the box. </span></p>

<p class="speaker"><span class="line" data-starttime="1293"><span class="speakerName">John Feig</span>: Yeah, which was </span><span class="line" data-startTime="1293">really surprising to me </span><span class="line" data-startTime="1294">because I thought that </span><span class="line" data-startTime="1294">this might be restricted </span><span class="line" data-startTime="1296">or it might be really difficult. </span><span class="line" data-startTime="1298">But Socket.IO just works. </span><span class="line" data-startTime="1303">Where do you want to go? </span></p>

<p class="speaker"><span class="line" data-starttime="1305"><span class="speakerName">Darrel Sumi</span>: Yeah, there we go. </span><span class="line" data-startTime="1308">And so on top of </span><span class="line" data-startTime="1308">Socket.IO, Chrome Apps </span><span class="line" data-startTime="1311">provides a really </span><span class="line" data-startTime="1311">great Sockets API. </span><span class="line" data-startTime="1314">It gives you access to </span><span class="line" data-startTime="1314">raw TCP and UDP sockets. </span><span class="line" data-startTime="1317">It's through the </span><span class="line" data-startTime="1317">chrome.socket API. </span><span class="line" data-startTime="1320">I have an example on the GitHub </span><span class="line" data-startTime="1320">that is the same exact demo </span><span class="line" data-startTime="1324">that we just showed but </span><span class="line" data-startTime="1324">just rewritten for TCP. </span><span class="line" data-startTime="1328">So if you want to look at </span><span class="line" data-startTime="1328">that, here's a link for that. </span><span class="line" data-startTime="1331">But we necessarily </span><span class="line" data-startTime="1331">won't go into that code. </span></p>

<p class="speaker"><span class="line" data-starttime="1333"><span class="speakerName">John Feig</span>: It's a </span><span class="line" data-startTime="1333">little bit more verbose, </span><span class="line" data-startTime="1335">but it's also a </span><span class="line" data-startTime="1335">lot more powerful. </span><span class="line" data-startTime="1337">Like I mentioned at </span><span class="line" data-startTime="1337">the top, you get access </span><span class="line" data-startTime="1341">to real raw sockets with </span><span class="line" data-startTime="1341">this, which, like I said, </span><span class="line" data-startTime="1345">we just needed for our app. </span></p>

<p class="speaker"><span class="line" data-starttime="1348"><span class="speakerName">Brad Green</span>: Just so </span><span class="line" data-startTime="1348">folks can think about, </span><span class="line" data-startTime="1349">which one would I need? </span><span class="line" data-startTime="1350">What did you guys need </span><span class="line" data-startTime="1350">the raw sockets for? </span></p>

<p class="speaker"><span class="line" data-starttime="1352"><span class="speakerName">John Feig</span>: So we're sending </span><span class="line" data-startTime="1352">binary data back and forth </span><span class="line" data-startTime="1355">to the server. </span> <span class="line" data-startTime="1356">Socket.IO sends back </span><span class="line" data-startTime="1356">and forth strings. </span> <span class="line" data-startTime="1359">So if you want to send that </span><span class="line" data-startTime="1359">sort of data over Socket.IO, </span><span class="line" data-startTime="1364">you have to encode </span><span class="line" data-startTime="1364">it as a string first. </span> <span class="line" data-startTime="1366">And then you have to decode </span><span class="line" data-startTime="1366">it on the server side. </span> <span class="line" data-startTime="1368">You also have to have </span><span class="line" data-startTime="1368">server-side components that </span><span class="line" data-startTime="1370">can handle Socket.IO. </span> <span class="line" data-startTime="1371">Depending on the server that </span><span class="line" data-startTime="1371">you're running the sockets, </span><span class="line" data-startTime="1375">you might have a good Socket.IO </span><span class="line" data-startTime="1375">library available to you. </span> <span class="line" data-startTime="1379">Like if you're running </span><span class="line" data-startTime="1379">Node, it's really easy </span><span class="line" data-startTime="1381">to just pull in Socket.IO. </span> <span class="line" data-startTime="1383">But if you're </span><span class="line" data-startTime="1383">running Java, there's </span><span class="line" data-startTime="1385">not really a great </span><span class="line" data-startTime="1385">solution for Socket.IO. </span> <span class="line" data-startTime="1389">So it's a lot easier to </span><span class="line" data-startTime="1389">use raw sockets there. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="1391"><span class="speakerName">Darrel Sumi</span>: It just depends on </span><span class="line" data-startTime="1391">what your current architecture </span><span class="line" data-startTime="1394">is and structures. </span><span class="line" data-startTime="1395">For us, since we came </span><span class="line" data-startTime="1395">from a mobile app </span><span class="line" data-startTime="1397">with a pre-existing system, it </span><span class="line" data-startTime="1397">was easier to plug into that </span><span class="line" data-startTime="1400">rather than recreate everything </span><span class="line" data-startTime="1400">on a different system. </span></p>

<p class="speaker"><span class="line" data-starttime="1403"><span class="speakerName">John Feig</span>: Right. </span> <span class="line" data-startTime="1404">And there's also WebSockets, </span><span class="line" data-startTime="1404">too, like we mentioned. </span> <span class="line" data-startTime="1407">And those are maybe a little </span><span class="line" data-startTime="1407">bit more available on servers. </span> <span class="line" data-startTime="1411">So it just depends on </span><span class="line" data-startTime="1411">what your needs are. </span> <span class="line" data-startTime="1414">But it's really nice to have </span><span class="line" data-startTime="1414">Chrome sockets available. </span> <span class="line" data-startTime="1420">So the next thing that </span><span class="line" data-startTime="1420">you want to think about, </span><span class="line" data-startTime="1422">in terms of how your app </span><span class="line" data-startTime="1422">behaves when it's offline, </span><span class="line" data-startTime="1426">is your local storage stuff. </span> <span class="line" data-startTime="1428">And this is actually </span><span class="line" data-startTime="1428">something that I </span><span class="line" data-startTime="1431">started with in my demo, </span><span class="line" data-startTime="1431">which is a little podcast app, </span><span class="line" data-startTime="1437">before I even thought about </span><span class="line" data-startTime="1437">converting this into a Chrome </span><span class="line" data-startTime="1439">App. </span></p>

<p><span class="line" data-startTime="1441">The main reason is </span><span class="line" data-startTime="1441">because I wanted </span><span class="line" data-startTime="1443">it to behave like an app. </span> <span class="line" data-startTime="1444">I wanted people to be able </span><span class="line" data-startTime="1444">to subscribe to podcasts </span><span class="line" data-startTime="1449">and then listen to episodes. </span> <span class="line" data-startTime="1450">I wanted it to keep </span><span class="line" data-startTime="1450">track of how much they </span><span class="line" data-startTime="1453">had listened to so far. </span> <span class="line" data-startTime="1455">One thing that really </span><span class="line" data-startTime="1455">drives me nuts is I </span><span class="line" data-startTime="1458">have a couple tools that </span><span class="line" data-startTime="1458">I use, aside from my app, </span><span class="line" data-startTime="1465">for listening to </span><span class="line" data-startTime="1465">podcasts, and they always </span><span class="line" data-startTime="1467">forget where I left off. </span></p>

<p><span class="line" data-startTime="1469">And some of the </span><span class="line" data-startTime="1469">podcasts I listen to </span><span class="line" data-startTime="1471">are multiple hours long. </span> <span class="line" data-startTime="1473">And if the thing goes down or </span><span class="line" data-startTime="1473">you accidentally click Refresh, </span><span class="line" data-startTime="1477">and you start back at zero </span><span class="line" data-startTime="1477">when you're an hour and a half </span><span class="line" data-startTime="1480">in, that's not too fun . </span> <span class="line" data-startTime="1483">So this stuff is </span><span class="line" data-startTime="1483">really important. </span> <span class="line" data-startTime="1485">It's really useful. </span> <span class="line" data-startTime="1487">And storing stuff </span><span class="line" data-startTime="1487">on the client side </span><span class="line" data-startTime="1490">in certain cases &mdash; like </span><span class="line" data-startTime="1490">for KeeChat for example, </span><span class="line" data-startTime="1493">all of your chats are stored </span><span class="line" data-startTime="1493">locally &mdash; your contacts list. </span></p>

<p><span class="line" data-startTime="1498">You want all that stuff local. </span> <span class="line" data-startTime="1500">Especially if it's just </span><span class="line" data-startTime="1500">going to be for you, </span><span class="line" data-startTime="1502">there's no reason to </span><span class="line" data-startTime="1502">have it on the server. </span> <span class="line" data-startTime="1505">So there are some </span><span class="line" data-startTime="1505">slight differences </span><span class="line" data-startTime="1507">between how Chrome handles </span><span class="line" data-startTime="1507">local storage versus how </span><span class="line" data-startTime="1510">HTML5 handles local storage. </span> <span class="line" data-startTime="1514">And I will show you right here. </span> <span class="line" data-startTime="1515">So the big difference is </span><span class="line" data-startTime="1515">that HTML5 is synchronous. </span> <span class="line" data-startTime="1520">It has a synchronous API </span><span class="line" data-startTime="1520">for local storage, which </span><span class="line" data-startTime="1522">means that you can just say, </span><span class="line" data-startTime="1522">myVal equals localStorage key. </span> <span class="line" data-startTime="1528">So that's just getting the </span><span class="line" data-startTime="1528">thing right off a disk. </span> <span class="line" data-startTime="1531">It blocks in-line. </span></p>

<p><span class="line" data-startTime="1532">And so you're going to be </span><span class="line" data-startTime="1532">blocking on whatever thread </span><span class="line" data-startTime="1534">you're calling that on. </span> <span class="line" data-startTime="1536">And Chrome is asynchronous. </span> <span class="line" data-startTime="1538">So it's going to go </span><span class="line" data-startTime="1538">out to disk and then </span><span class="line" data-startTime="1541">return in a callback the thing. </span> <span class="line" data-startTime="1544">And you can just </span><span class="line" data-startTime="1544">follow along here. </span> <span class="line" data-startTime="1545">I highlighted in blue the </span><span class="line" data-startTime="1545">value that I'm trying to set. </span> <span class="line" data-startTime="1549">And then orange </span><span class="line" data-startTime="1549">here is the value </span><span class="line" data-startTime="1553">that's coming back from disk. </span> <span class="line" data-startTime="1555">So in the HTML5 </span><span class="line" data-startTime="1555">example at the top, </span><span class="line" data-startTime="1559">that's just one line </span><span class="line" data-startTime="1559">that we have to call. </span> <span class="line" data-startTime="1562">But again, it blocks there. </span> <span class="line" data-startTime="1564">And then the example below </span><span class="line" data-startTime="1564">is a little bit more verbose, </span><span class="line" data-startTime="1569">but you can see we start </span><span class="line" data-startTime="1569">out with null set to that. </span> <span class="line" data-startTime="1575">And then we define </span><span class="line" data-startTime="1575">a callback function </span><span class="line" data-startTime="1579">that's going to take </span><span class="line" data-startTime="1579">a single parameter </span><span class="line" data-startTime="1581">and assign it to the </span><span class="line" data-startTime="1581">value that we want set. </span> <span class="line" data-startTime="1585">Oh, boy. </span></p>

<p><span class="line" data-startTime="1586">Ha. </span> <span class="line" data-startTime="1588">There we go. </span> <span class="line" data-startTime="1590">And then we do this </span><span class="line" data-startTime="1590">chrome.storage.local.get. </span> <span class="line" data-startTime="1594">And then the first </span><span class="line" data-startTime="1594">parameter is the key, </span><span class="line" data-startTime="1597">which is the same key </span><span class="line" data-startTime="1597">that we have up above. </span> <span class="line" data-startTime="1600">And then whatever </span><span class="line" data-startTime="1600">gets returned is </span><span class="line" data-startTime="1603">going to get passed </span><span class="line" data-startTime="1603">to a function. </span> <span class="line" data-startTime="1606">And it's going to be </span><span class="line" data-startTime="1606">callback and then data, key. </span> <span class="line" data-startTime="1610">So you get an object back. </span> <span class="line" data-startTime="1611">And you have to pull the </span><span class="line" data-startTime="1611">value out of the object. </span> <span class="line" data-startTime="1615">It's really not too tough. </span> <span class="line" data-startTime="1616">It's just slightly different </span><span class="line" data-startTime="1616">because it's asynchronous. </span> <span class="line" data-startTime="1620">And the big deal </span><span class="line" data-startTime="1620">here is that there </span><span class="line" data-startTime="1623">may be some third-party </span><span class="line" data-startTime="1623">libraries, especially if you're </span><span class="line" data-startTime="1625">in a larger project, </span><span class="line" data-startTime="1625">that make assumptions </span><span class="line" data-startTime="1627">about having the synchronous </span><span class="line" data-startTime="1627">API for local storage. </span></p>

<p><span class="line" data-startTime="1632">So there was one </span><span class="line" data-startTime="1632">library that we ran </span><span class="line" data-startTime="1635">into that was a pretty integral </span><span class="line" data-startTime="1635">part of KeeChat that just made </span><span class="line" data-startTime="1640">assumptions all over the </span><span class="line" data-startTime="1640">place about local storage </span><span class="line" data-startTime="1644">being synchronous. </span> <span class="line" data-startTime="1645">And we made assumptions &mdash; </span><span class="line" data-startTime="1645">we kind of used their API </span><span class="line" data-startTime="1650">in a synchronous way because </span><span class="line" data-startTime="1650">those were synchronous calls. </span> <span class="line" data-startTime="1654">So it made sense to use </span><span class="line" data-startTime="1654">it in a synchronous way. </span> <span class="line" data-startTime="1657">So what happened was when we </span><span class="line" data-startTime="1657">did this change to Chrome, </span><span class="line" data-startTime="1661">we had to go through </span><span class="line" data-startTime="1661">and rewrite quite a bit </span><span class="line" data-startTime="1665">of that third-party </span><span class="line" data-startTime="1665">library to make </span><span class="line" data-startTime="1667">it function asynchronously. </span> <span class="line" data-startTime="1670">That was one of the </span><span class="line" data-startTime="1670">more painful things. </span> <span class="line" data-startTime="1673">It wasn't a huge deal. </span> <span class="line" data-startTime="1674">And it wasn't </span><span class="line" data-startTime="1674">technically difficult. </span> <span class="line" data-startTime="1677">It was just annoying because </span><span class="line" data-startTime="1677">you have this dependency. </span> <span class="line" data-startTime="1680">And it's not working for you. </span></p>

<p><span class="line" data-startTime="1682">So that stuff you </span><span class="line" data-startTime="1682">might run into. </span> <span class="line" data-startTime="1686">But &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="1687"><span class="speakerName">Darrel Sumi</span>: So pretty </span><span class="line" data-startTime="1687">much, you always want </span><span class="line" data-startTime="1689">to check and see what </span><span class="line" data-startTime="1689">kind of assumptions </span><span class="line" data-startTime="1691">any third-party banks on </span><span class="line" data-startTime="1691">the access to the APIs, </span><span class="line" data-startTime="1695">as well as the </span><span class="line" data-startTime="1695">thing like we talked </span><span class="line" data-startTime="1696">about earlier &mdash; the </span><span class="line" data-startTime="1696">Content Security Policy. </span><span class="line" data-startTime="1698">A lot of these libraries are </span><span class="line" data-startTime="1698">going to make assumptions, </span><span class="line" data-startTime="1701">a lot of them more </span><span class="line" data-startTime="1701">towards the way web </span><span class="line" data-startTime="1703">has been done up till </span><span class="line" data-startTime="1703">now and not the Angular </span><span class="line" data-startTime="1708">way or the Chrome App way. </span></p>

<p class="speaker"><span class="line" data-starttime="1712"><span class="speakerName">John Feig</span>: And another great </span><span class="line" data-startTime="1712">way to persist data locally </span><span class="line" data-startTime="1716">is with IndexedDB, </span><span class="line" data-startTime="1716">which is an HTML5 API. </span> <span class="line" data-startTime="1722">And it can actually </span><span class="line" data-startTime="1722">be a much better fit </span><span class="line" data-startTime="1723">for certain types of data. </span> <span class="line" data-startTime="1724">So if you have larger data sets, </span><span class="line" data-startTime="1724">anything that's not a string, </span><span class="line" data-startTime="1727">really, you probably </span><span class="line" data-startTime="1727">want to use IndexedDB. </span> <span class="line" data-startTime="1730">It's a NoSQL </span><span class="line" data-startTime="1730">database on a client. </span> <span class="line" data-startTime="1735">The API's a little &mdash; it takes </span><span class="line" data-startTime="1735">a little getting used to. </span> <span class="line" data-startTime="1739">It's a little verbose. </span> <span class="line" data-startTime="1742">I actually wrote </span><span class="line" data-startTime="1742">a wrapper to help </span><span class="line" data-startTime="1747">with doing things with Angular. </span></p>

<p><span class="line" data-startTime="1748">So it's an AngularJS </span><span class="line" data-startTime="1748">IndexedDB wrapper </span><span class="line" data-startTime="1752">so you can just inject it. </span> <span class="line" data-startTime="1754">And then you just do </span><span class="line" data-startTime="1754">much simpler calls. </span> <span class="line" data-startTime="1757">But here's an example </span><span class="line" data-startTime="1757">of IndexedDB Put. </span> <span class="line" data-startTime="1762">So you have a datastore. </span> <span class="line" data-startTime="1764">You have a database. </span> <span class="line" data-startTime="1768">The storeName is </span><span class="line" data-startTime="1768">kind of like a table. </span> <span class="line" data-startTime="1770">So it's like &mdash; I mean, </span><span class="line" data-startTime="1770">it's a datastore for NoSQL. </span> <span class="line" data-startTime="1775">And we're just going to put </span><span class="line" data-startTime="1775">some data, which is an object, </span><span class="line" data-startTime="1778">so it's going to be key </span><span class="line" data-startTime="1778">value pairs in that object. </span> <span class="line" data-startTime="1784">And so you have a reference </span><span class="line" data-startTime="1784">to the database already. </span> <span class="line" data-startTime="1788">You have to have </span><span class="line" data-startTime="1788">opened the database. </span> <span class="line" data-startTime="1790">And there's a whole </span><span class="line" data-startTime="1790">process for that. </span> <span class="line" data-startTime="1793">And then you get a transaction. </span> <span class="line" data-startTime="1795">With the storeName, it has </span><span class="line" data-startTime="1795">to be in read-write mode </span><span class="line" data-startTime="1798">if you're going to </span><span class="line" data-startTime="1798">be persisting things. </span></p>

<p><span class="line" data-startTime="1802">I'm going to say objectStore, </span><span class="line" data-startTime="1802">dot put, and then your object. </span> <span class="line" data-startTime="1806">And then, hopefully, </span><span class="line" data-startTime="1806">you'll go through this on, </span><span class="line" data-startTime="1808">success callback </span><span class="line" data-startTime="1808">that has your event. </span> <span class="line" data-startTime="1812">And now what I'm </span><span class="line" data-startTime="1812">doing here is I'm </span><span class="line" data-startTime="1814">emitting an event through </span><span class="line" data-startTime="1814">Angular, through the Angular </span><span class="line" data-startTime="1817">scope, that this data was put, </span><span class="line" data-startTime="1817">and then on what database, </span><span class="line" data-startTime="1822">and what storeName. </span> <span class="line" data-startTime="1824">And then I have a similar </span><span class="line" data-startTime="1824">event in the error case. </span></p>

<p class="speaker"><span class="line" data-starttime="1827"><span class="speakerName">Darrel Sumi</span>: And </span><span class="line" data-startTime="1827">this whole wrapper </span><span class="line" data-startTime="1829">is put as a Angular </span><span class="line" data-startTime="1829">service, right? </span></p>

<p class="speaker"><span class="line" data-starttime="1830"><span class="speakerName">John Feig</span>: Mm-hm. </span><span class="line" data-startTime="1831">Yep. </span><span class="line" data-startTime="1831">So it's a singleton. </span><span class="line" data-startTime="1832">You can call it when </span><span class="line" data-startTime="1832">you set up your app. </span><span class="line" data-startTime="1836">I tried to make it as </span><span class="line" data-startTime="1836">simple as possible. </span><span class="line" data-startTime="1837">And we actually used the </span><span class="line" data-startTime="1837">same library in KeeChat. </span><span class="line" data-startTime="1843">It cut way down on </span><span class="line" data-startTime="1843">the amount of code </span><span class="line" data-startTime="1845">that I had to write </span><span class="line" data-startTime="1845">over trying to do things </span><span class="line" data-startTime="1848">with local storage. </span></p>

<p class="speaker"><span class="line" data-starttime="1849"><span class="speakerName">Brad Green</span>: And you'll be able </span><span class="line" data-startTime="1849">to share that link with us? </span></p>

<p class="speaker"><span class="line" data-starttime="1852"><span class="speakerName">Darrel Sumi</span>: Yes. </span></p>

<p class="speaker"><span class="line" data-starttime="1852"><span class="speakerName">John Feig</span>: Yep, yep. </span><span class="line" data-startTime="1853">It's at the end. </span></p>

<p class="speaker"><span class="line" data-starttime="1853"><span class="speakerName">Brad Green</span>: Great. </span></p>

<p class="speaker"><span class="line" data-starttime="1855"><span class="speakerName">John Feig</span>: So I actually </span><span class="line" data-startTime="1855">also have a wrapper </span><span class="line" data-startTime="1856">for the local storage to choose </span><span class="line" data-startTime="1856">between Chrome versus the HTML5 </span><span class="line" data-startTime="1862">thing. </span> <span class="line" data-startTime="1863">It tests to see if </span><span class="line" data-startTime="1863">chrome.storage exists. </span> <span class="line" data-startTime="1865">And if it does, it uses that. </span> <span class="line" data-startTime="1867">And you can also </span><span class="line" data-startTime="1867">set it up to use </span><span class="line" data-startTime="1868">the sync, chrome.storage.sync </span><span class="line" data-startTime="1868">versus local, </span><span class="line" data-startTime="1872">which will sync any </span><span class="line" data-startTime="1872">of those strings </span><span class="line" data-startTime="1875">across multiple </span><span class="line" data-startTime="1875">instances of Chrome. </span> <span class="line" data-startTime="1877">So if you're logged into </span><span class="line" data-startTime="1877">Chrome on your laptop at home </span><span class="line" data-startTime="1880">and your laptop at </span><span class="line" data-startTime="1880">work, you can actually </span><span class="line" data-startTime="1881">have that stuff synced </span><span class="line" data-startTime="1881">up, which is nice. </span> <span class="line" data-startTime="1886">So back to the slide. </span></p>

<p><span class="line" data-startTime="1890">Angular has &mdash; it's </span><span class="line" data-startTime="1890">just an aside, </span><span class="line" data-startTime="1891">but Angular has these </span><span class="line" data-startTime="1891">really nice event emitters. </span> <span class="line" data-startTime="1894">In KeeChat, we used a </span><span class="line" data-startTime="1894">third-party event emitter </span><span class="line" data-startTime="1897">library because we had &mdash; </span><span class="line" data-startTime="1897">like I mentioned at the top, </span><span class="line" data-startTime="1900">there's some </span><span class="line" data-startTime="1900">third-party libraries </span><span class="line" data-startTime="1901">that make assumptions </span><span class="line" data-startTime="1901">about what's available. </span> <span class="line" data-startTime="1903">One of those assumptions </span><span class="line" data-startTime="1903">was that event emitters </span><span class="line" data-startTime="1906">would be available. </span> <span class="line" data-startTime="1908">In my podcast demo, </span><span class="line" data-startTime="1908">I didn't need that. </span> <span class="line" data-startTime="1911">I didn't really use </span><span class="line" data-startTime="1911">much third-party stuff. </span> <span class="line" data-startTime="1913">So I could use the </span><span class="line" data-startTime="1913">Angular event emitters, </span><span class="line" data-startTime="1917">which are really nice because </span><span class="line" data-startTime="1917">this is done on the scope, </span><span class="line" data-startTime="1922">on Angular's scope. </span> <span class="line" data-startTime="1923">So Angular knows </span><span class="line" data-startTime="1923">about these things. </span> <span class="line" data-startTime="1924">You don't have to </span><span class="line" data-startTime="1924">run scope.apply </span><span class="line" data-startTime="1928">to get the digest cycle going. </span></p>

<p><span class="line" data-startTime="1930">So when you send a controller </span><span class="line" data-startTime="1930">an event, it's going to show up. </span> <span class="line" data-startTime="1937">So it's a really simple API. </span> <span class="line" data-startTime="1939">You listen for &mdash; you register </span><span class="line" data-startTime="1939">for events with scope.on. </span> <span class="line" data-startTime="1944">You say, like, i_am_event </span><span class="line" data-startTime="1944">is the string that's </span><span class="line" data-startTime="1950">going to identify this. </span> <span class="line" data-startTime="1951">And then the second </span><span class="line" data-startTime="1951">parameter is a function </span><span class="line" data-startTime="1954">with two parameters, </span><span class="line" data-startTime="1954">event and data. </span> <span class="line" data-startTime="1957">The event I never use at all. </span> <span class="line" data-startTime="1960">But data is important. </span> <span class="line" data-startTime="1962">And so then you can emit </span><span class="line" data-startTime="1962">it with rootScope.emit. </span> <span class="line" data-startTime="1966">And it's rootScope </span><span class="line" data-startTime="1966">because you're usually </span><span class="line" data-startTime="1968">going to be doing </span><span class="line" data-startTime="1968">this from a service. </span></p>

<p><span class="line" data-startTime="1970">Services can't get </span><span class="line" data-startTime="1970">scope injected. </span> <span class="line" data-startTime="1972">And they probably wouldn't </span><span class="line" data-startTime="1972">be on the same scope anyway. </span> <span class="line" data-startTime="1974">So rootScope is what you use. </span></p>

<p class="speaker"><span class="line" data-starttime="1978"><span class="speakerName">Darrel Sumi</span>: The syntax &mdash; </span><span class="line" data-startTime="1978">the whole notion of this </span><span class="line" data-startTime="1980">is fairly common, standard </span><span class="line" data-startTime="1980">event emitter type of paradigm </span><span class="line" data-startTime="1983">that people are probably </span><span class="line" data-startTime="1983">used to for any other system. </span><span class="line" data-startTime="1987">It's just that these events </span><span class="line" data-startTime="1987">get passed through the scope, </span><span class="line" data-startTime="1990">so you do have to understand how </span><span class="line" data-startTime="1990">it goes up and down the scope. </span></p>

<p class="speaker"><span class="line" data-starttime="1994"><span class="speakerName">John Feig</span>: Right. </span><span class="line" data-startTime="1995">Yeah. </span><span class="line" data-startTime="1995">There are a couple options here. </span><span class="line" data-startTime="1997">So it's depending on where </span><span class="line" data-startTime="1997">you're firing events from </span><span class="line" data-startTime="2001">and where you want to get </span><span class="line" data-startTime="2001">them to, you might need emit </span><span class="line" data-startTime="2004">or you might need broadcast. </span><span class="line" data-startTime="2006">And they take the </span><span class="line" data-startTime="2006">same parameters. </span><span class="line" data-startTime="2008">But broadcast basically sends </span><span class="line" data-startTime="2008">things down to children. </span><span class="line" data-startTime="2013">Emit goes up the stack. </span><span class="line" data-startTime="2015">So you have to know </span><span class="line" data-startTime="2015">which one you need. </span><span class="line" data-startTime="2019">But yeah, event emitters </span><span class="line" data-startTime="2019">are really useful. </span><span class="line" data-startTime="2022">And they really </span><span class="line" data-startTime="2022">help clean up code. </span><span class="line" data-startTime="2024">And you don't have to have </span><span class="line" data-startTime="2024">as many things explicitly </span><span class="line" data-startTime="2027">calling one another. </span></p>

<p class="speaker"><span class="line" data-starttime="2029"><span class="speakerName">Darrel Sumi</span>: It </span><span class="line" data-startTime="2029">just really helps </span><span class="line" data-startTime="2030">keep your code structured </span><span class="line" data-startTime="2030">in a really nice, clean way </span><span class="line" data-startTime="2034">and modularized that way. </span></p>

<p class="speaker"><span class="line" data-starttime="2035"><span class="speakerName">John Feig</span>: Right Yeah. </span> <span class="line" data-startTime="2036">It really cuts down on </span><span class="line" data-startTime="2036">interdependency stuff. </span> <span class="line" data-startTime="2039">And then I have just one other </span><span class="line" data-startTime="2039">quick example of IndexedDB Get. </span> <span class="line" data-startTime="2046">So very similar to </span><span class="line" data-startTime="2046">Put, this is just </span><span class="line" data-startTime="2049">getting some item </span><span class="line" data-startTime="2049">out of the database. </span> <span class="line" data-startTime="2052">This time, we're </span><span class="line" data-startTime="2052">going to just use </span><span class="line" data-startTime="2055">a key, which can be a string, </span><span class="line" data-startTime="2055">whatever the type for your key </span><span class="line" data-startTime="2060">is. </span> <span class="line" data-startTime="2062">And so we have a similar thing </span><span class="line" data-startTime="2062">where we get the transaction </span><span class="line" data-startTime="2066">out of the database </span><span class="line" data-startTime="2066">with the storeName. </span></p>

<p><span class="line" data-startTime="2068">You don't need to be </span><span class="line" data-startTime="2068">in read-write mode. </span> <span class="line" data-startTime="2069">You don't need to </span><span class="line" data-startTime="2069">pass the mode in. </span> <span class="line" data-startTime="2070">The default is just read. </span> <span class="line" data-startTime="2073">And then the </span><span class="line" data-startTime="2073">onsuccess case again, </span><span class="line" data-startTime="2074">we're emitting something with </span><span class="line" data-startTime="2074">Angular's rootScope emitter. </span> <span class="line" data-startTime="2080">We say, we've gotten this item. </span> <span class="line" data-startTime="2081">And then we're going to </span><span class="line" data-startTime="2081">pass an array of results. </span> <span class="line" data-startTime="2085">So this is nice. </span> <span class="line" data-startTime="2087">With IndexedDB, I like </span><span class="line" data-startTime="2087">to always pass back </span><span class="line" data-startTime="2090">the database name, the </span><span class="line" data-startTime="2090">storeName, and then the data so </span><span class="line" data-startTime="2093">that in my controller &mdash; whatever </span><span class="line" data-startTime="2093">is getting this data, if it's </span><span class="line" data-startTime="2096">a service controller or </span><span class="line" data-startTime="2096">whatever, I can first </span><span class="line" data-startTime="2098">check to see &mdash; OK, getitem </span><span class="line" data-startTime="2098">is pretty generic, right? </span><span class="line" data-startTime="2103">And since this is a service </span><span class="line" data-startTime="2103">library that I wrote, </span><span class="line" data-startTime="2107">I'm not going to have </span><span class="line" data-startTime="2107">dozens of different names </span><span class="line" data-startTime="2111">for these things. </span> <span class="line" data-startTime="2114">If I have common </span><span class="line" data-startTime="2114">names, and I pass back </span><span class="line" data-startTime="2118">identifiers in the </span><span class="line" data-startTime="2118">data, it just helps </span><span class="line" data-startTime="2121">so that I can register the </span><span class="line" data-startTime="2121">listener with that common name </span><span class="line" data-startTime="2124">and then just inspect things </span><span class="line" data-startTime="2124">that come back on those event </span><span class="line" data-startTime="2131">listeners when I get them. </span></p>

<p><span class="line" data-startTime="2135">So after you do your local </span><span class="line" data-startTime="2135">storage, convert things </span><span class="line" data-startTime="2139">to IndexedDB, it's </span><span class="line" data-startTime="2139">still not going to work. </span> <span class="line" data-startTime="2143">You probably have </span><span class="line" data-startTime="2143">some dynamic content </span><span class="line" data-startTime="2145">that you need to handle. </span></p>

<p class="speaker"><span class="line" data-starttime="2147"><span class="speakerName">Darrel Sumi</span>: And this goes </span><span class="line" data-startTime="2147">back to the notion of the CSP </span><span class="line" data-startTime="2150">that you can't bring </span><span class="line" data-startTime="2150">in external content </span><span class="line" data-startTime="2153">and just think it's going </span><span class="line" data-startTime="2153">to run all fine and dandy. </span></p>

<p class="speaker"><span class="line" data-starttime="2155"><span class="speakerName">John Feig</span>: Right. </span> <span class="line" data-startTime="2156">So actually, this would </span><span class="line" data-startTime="2156">probably be a good time </span><span class="line" data-startTime="2158">to explain one thing here. </span> <span class="line" data-startTime="2162">So this is my little </span><span class="line" data-startTime="2162">podcast app that I did. </span> <span class="line" data-startTime="2166">And this is actually </span><span class="line" data-startTime="2166">the Chrome App version. </span> <span class="line" data-startTime="2168">So you can see, I </span><span class="line" data-startTime="2168">launched it there. </span> <span class="line" data-startTime="2172">And so this middle </span><span class="line" data-startTime="2172">section here you can see </span><span class="line" data-startTime="2175">is all pulled in </span><span class="line" data-startTime="2175">with a web request. </span> <span class="line" data-startTime="2179">So this side &mdash; the </span><span class="line" data-startTime="2179">Add Podcast and List </span><span class="line" data-startTime="2183">a Podcast side &mdash; that's local. </span> <span class="line" data-startTime="2186">And then I have </span><span class="line" data-startTime="2186">this section up top. </span> <span class="line" data-startTime="2188">This &mdash; you've got a </span><span class="line" data-startTime="2188">playlist here on the left. </span> <span class="line" data-startTime="2191">That's local. </span> <span class="line" data-startTime="2192">But then the content </span><span class="line" data-startTime="2192">with text that </span><span class="line" data-startTime="2196">pulls in information about </span><span class="line" data-startTime="2196">either the show or all </span><span class="line" data-startTime="2202">these episodes, that's all being </span><span class="line" data-startTime="2202">pulled in with a web request. </span> <span class="line" data-startTime="2207">And you need XHR to do that. </span></p>

<p><span class="line" data-startTime="2210">And it's a slightly </span><span class="line" data-startTime="2210">different call </span><span class="line" data-startTime="2213">that I had to make in </span><span class="line" data-startTime="2213">the Chrome environment </span><span class="line" data-startTime="2216">versus with just the </span><span class="line" data-startTime="2216">Angular web environment. </span> <span class="line" data-startTime="2221">And so here's what you can </span><span class="line" data-startTime="2221">use to get, say, an image. </span> <span class="line" data-startTime="2227">And this is an example of </span><span class="line" data-startTime="2227">getting an image out of imgur. </span> <span class="line" data-startTime="2231">So I am going to set it up </span><span class="line" data-startTime="2231">with just a regular HTTP. </span> <span class="line" data-startTime="2235">This is Angular's </span><span class="line" data-startTime="2235">HTTP thing that </span><span class="line" data-startTime="2238">can be injected into your app. </span> <span class="line" data-startTime="2242">As I said, the method's </span><span class="line" data-startTime="2242">Get &mdash; here's the URL. </span> <span class="line" data-startTime="2245">And it's going to be a blob </span><span class="line" data-startTime="2245">response so that I can actually </span><span class="line" data-startTime="2249">set it as the </span><span class="line" data-startTime="2249">source of an image. </span> <span class="line" data-startTime="2253">In a success case, you </span><span class="line" data-startTime="2253">get all this stuff back. </span></p>

<p><span class="line" data-startTime="2256">Again, I'm going to </span><span class="line" data-startTime="2256">ignore everything </span><span class="line" data-startTime="2258">except for the data </span><span class="line" data-startTime="2258">that's coming back. </span> <span class="line" data-startTime="2261">I keep scrolling. </span> <span class="line" data-startTime="2264">And there. </span> <span class="line" data-startTime="2268">So I'm going to ignore </span><span class="line" data-startTime="2268">everything except the data. </span> <span class="line" data-startTime="2270">I have in my HTML this </span><span class="line" data-startTime="2270">image tag with an ID </span><span class="line" data-startTime="2276">that I specified, onepod_img. </span> <span class="line" data-startTime="2281">So I'm going to grab </span><span class="line" data-startTime="2281">a reference to it. </span> <span class="line" data-startTime="2283">And then I can set </span><span class="line" data-startTime="2283">the source with </span><span class="line" data-startTime="2286">this </span><span class="line" data-startTime="2286">window.webkitURL.createObjectURL </span><span class="line" data-startTime="2289">and then the data. </span> <span class="line" data-startTime="2290">And that's going to allow me </span><span class="line" data-startTime="2290">to just take that data that's </span><span class="line" data-startTime="2294">the result of this web </span><span class="line" data-startTime="2294">request, which is &mdash; actually, </span><span class="line" data-startTime="2299">it works the same </span><span class="line" data-startTime="2299">way as the XHR stuff. </span></p>

<p><span class="line" data-startTime="2301">It's just a slightly </span><span class="line" data-startTime="2301">different API. </span> <span class="line" data-startTime="2303">And then set that </span><span class="line" data-startTime="2303">into the image. </span> <span class="line" data-startTime="2307">And there's an error </span><span class="line" data-startTime="2307">case where it failed. </span> <span class="line" data-startTime="2309">And hopefully, it </span><span class="line" data-startTime="2309">won't fail for you. </span> <span class="line" data-startTime="2312">And you also have to </span><span class="line" data-startTime="2312">make sure that imgur </span><span class="line" data-startTime="2314">is in your permissions. </span> <span class="line" data-startTime="2316">So this is not something </span><span class="line" data-startTime="2316">that &mdash; it's not my server, </span><span class="line" data-startTime="2319">so I have to put it in </span><span class="line" data-startTime="2319">the permissions thing. </span> <span class="line" data-startTime="2322">Once I do that, it should be OK. </span></p>

<p class="speaker"><span class="line" data-starttime="2324"><span class="speakerName">Darrel Sumi</span>: Right. </span><span class="line" data-startTime="2324">And you'll notice that </span><span class="line" data-startTime="2324">there's other things that </span><span class="line" data-startTime="2325">might need to go into </span><span class="line" data-startTime="2325">your permissions. </span><span class="line" data-startTime="2327">So any of the </span><span class="line" data-startTime="2327">Chrome Apps require </span><span class="line" data-startTime="2329">you to specify either, </span><span class="line" data-startTime="2329">like what he said, </span><span class="line" data-startTime="2332">which domains you might be </span><span class="line" data-startTime="2332">getting external content </span><span class="line" data-startTime="2334">from that you put in </span><span class="line" data-startTime="2334">your approved list. </span><span class="line" data-startTime="2337">But also things like </span><span class="line" data-startTime="2337">your storage here. </span><span class="line" data-startTime="2340">You have to tell it that </span><span class="line" data-startTime="2340">you're going to use storage. </span><span class="line" data-startTime="2342">And even for your </span><span class="line" data-startTime="2342">sockets, if you're </span><span class="line" data-startTime="2344">going to use the </span><span class="line" data-startTime="2344">Chrome Socket API, </span><span class="line" data-startTime="2347">you need to specify </span><span class="line" data-startTime="2347">that, hey, I'm </span><span class="line" data-startTime="2349">going to allow TCP connections. </span></p>

<p class="speaker"><span class="line" data-starttime="2355"><span class="speakerName">John Feig</span>: And then we're going </span><span class="line" data-startTime="2355">to keep iterating on this. </span> <span class="line" data-startTime="2358">So one thing that was </span><span class="line" data-startTime="2358">interesting was &mdash; here's </span><span class="line" data-startTime="2363">my controller to get individual </span><span class="line" data-startTime="2363">episodes of a podcast. </span> <span class="line" data-startTime="2373">And this is the method </span><span class="line" data-startTime="2373">here, makeRequest, </span><span class="line" data-startTime="2381">that's going to actually get </span><span class="line" data-startTime="2381">the data for each episode &mdash; </span><span class="line" data-startTime="2387">or for each podcast, actually, </span><span class="line" data-startTime="2387">and all the episodes within it. </span> <span class="line" data-startTime="2392">So I do the test up top to see. </span> <span class="line" data-startTime="2394">If it's chrome.storage, then </span><span class="line" data-startTime="2394">I'm in the Chrome environment. </span> <span class="line" data-startTime="2397">There's probably a </span><span class="line" data-startTime="2397">better way to do that. </span></p>

<p><span class="line" data-startTime="2399">But that's the </span><span class="line" data-startTime="2399">thing that I used. </span> <span class="line" data-startTime="2402">And now we get this request URL, </span><span class="line" data-startTime="2402">which is a really long thing. </span> <span class="line" data-startTime="2405">What's interesting </span><span class="line" data-startTime="2405">here is I'm actually </span><span class="line" data-startTime="2407">using a Google service. </span> <span class="line" data-startTime="2410">So with the Content </span><span class="line" data-startTime="2410">Security Policy, again, </span><span class="line" data-startTime="2413">and since this is </span><span class="line" data-startTime="2413">a podcast app, so I </span><span class="line" data-startTime="2417">needed to go through </span><span class="line" data-startTime="2417">a single place that's </span><span class="line" data-startTime="2421">going to return </span><span class="line" data-startTime="2421">the proper headers. </span> <span class="line" data-startTime="2426">So very basically, with </span><span class="line" data-startTime="2426">an RSS feed app like mine, </span><span class="line" data-startTime="2432">you want to be able to </span><span class="line" data-startTime="2432">subscribe to whoever. </span> <span class="line" data-startTime="2436">And whoever may not </span><span class="line" data-startTime="2436">have a server that's </span><span class="line" data-startTime="2439">going to return you the </span><span class="line" data-startTime="2439">headers that allow you to make </span><span class="line" data-startTime="2443">requests, like cross-site </span><span class="line" data-startTime="2443">requests to it. </span> <span class="line" data-startTime="2447">So what Google's </span><span class="line" data-startTime="2447">done is to set up </span><span class="line" data-startTime="2449">a service that allows you </span><span class="line" data-startTime="2449">to get these RSS feeds </span><span class="line" data-startTime="2453">from a single location. </span></p>

<p><span class="line" data-startTime="2454">So I can say, </span><span class="line" data-startTime="2454">ajax.googleapis.com. </span> <span class="line" data-startTime="2458">I'm giving that one permission. </span> <span class="line" data-startTime="2460">It returns me back </span><span class="line" data-startTime="2460">the proper header </span><span class="line" data-startTime="2463">so that the requests are valid. </span> <span class="line" data-startTime="2465">And everybody's happy. </span> <span class="line" data-startTime="2467">The one big difference </span><span class="line" data-startTime="2467">between the HTML5 version </span><span class="line" data-startTime="2471">and the Chrome version </span><span class="line" data-startTime="2471">is in the HTML5 version, </span><span class="line" data-startTime="2475">I can actually use this .jsonp </span><span class="line" data-startTime="2475">thing, which, basically, </span><span class="line" data-startTime="2481">this returns as a callback. </span> <span class="line" data-startTime="2483">I don't really need this. </span> <span class="line" data-startTime="2487">There's probably a way that </span><span class="line" data-startTime="2487">I could get rid of this </span><span class="line" data-startTime="2489">completely in and do </span><span class="line" data-startTime="2489">them both the same way. </span></p>

<p><span class="line" data-startTime="2491">But it's a little nicer. </span> <span class="line" data-startTime="2494">This is how I was </span><span class="line" data-startTime="2494">doing things before, </span><span class="line" data-startTime="2496">where it was &mdash; you see a </span><span class="line" data-startTime="2496">callback equals JSON_CALLBACK </span><span class="line" data-startTime="2501">and the URL here. </span> <span class="line" data-startTime="2503">And that works with this API. </span> <span class="line" data-startTime="2507">And then for Chrome, if you do </span><span class="line" data-startTime="2507">that, it'll throw red at you </span><span class="line" data-startTime="2512">and say, you're not </span><span class="line" data-startTime="2512">allowed to specify </span><span class="line" data-startTime="2516">callbacks and responses. </span> <span class="line" data-startTime="2520">So instead, you just </span><span class="line" data-startTime="2520">do a regular HTTP get. </span> <span class="line" data-startTime="2525">And then in the </span><span class="line" data-startTime="2525">success, you can still </span><span class="line" data-startTime="2527">parse the data the same way. </span> <span class="line" data-startTime="2530">So that was the only </span><span class="line" data-startTime="2530">difference here, really. </span> <span class="line" data-startTime="2534">And then, obviously, </span><span class="line" data-startTime="2534">the other thing </span><span class="line" data-startTime="2536">is you've got to be </span><span class="line" data-startTime="2536">able to load images. </span> <span class="line" data-startTime="2539">And as I showed you </span><span class="line" data-startTime="2539">before, it's the same deal. </span> <span class="line" data-startTime="2547">So yeah. </span></p>

<p><span class="line" data-startTime="2548">And then you just iterate until </span><span class="line" data-startTime="2548">you don't have any more red. </span> <span class="line" data-startTime="2552">There probably are going to </span><span class="line" data-startTime="2552">be other issues that you'll </span><span class="line" data-startTime="2555">run into outside of this stuff. </span></p>

<p class="speaker"><span class="line" data-starttime="2557"><span class="speakerName">Darrel Sumi</span>: So just to recap. </span> <span class="line" data-startTime="2559">You have to really understand </span><span class="line" data-startTime="2559">where the Content Security </span><span class="line" data-startTime="2562">Policy's coming from. </span> <span class="line" data-startTime="2562">That's going to be the major </span><span class="line" data-startTime="2562">source for most of the errors. </span> <span class="line" data-startTime="2566">But you have to look into each </span><span class="line" data-startTime="2566">of the third-party libraries </span><span class="line" data-startTime="2569">that you use. </span> <span class="line" data-startTime="2570">A lot of them will make </span><span class="line" data-startTime="2570">assumptions of what environment </span><span class="line" data-startTime="2573">they're working in, </span><span class="line" data-startTime="2573">whether that be how they </span><span class="line" data-startTime="2576">access sockets, how they access </span><span class="line" data-startTime="2576">local storage, what they're </span><span class="line" data-startTime="2582">used to being brought in. </span> <span class="line" data-startTime="2583">So if they use a AMD or Require </span><span class="line" data-startTime="2583">style of being packaged up, </span><span class="line" data-startTime="2589">you got to understand </span><span class="line" data-startTime="2589">how that's all </span><span class="line" data-startTime="2591">wrapped around those libraries. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="2593"><span class="speakerName">John Feig</span>: Yeah. </span><span class="line" data-startTime="2595">So I can show &mdash; so </span><span class="line" data-startTime="2595">here's the app in Chrome. </span><span class="line" data-startTime="2603">Oh, I closed it out. </span><span class="line" data-startTime="2604">Never mind. </span><span class="line" data-startTime="2605">Yeah. </span><span class="line" data-startTime="2605">So here's the app in Chrome. </span><span class="line" data-startTime="2608">This stuff works. </span><span class="line" data-startTime="2609">It remembers where </span><span class="line" data-startTime="2609">you left off because I </span><span class="line" data-startTime="2614">saved that information </span><span class="line" data-startTime="2614">in local storage. </span><span class="line" data-startTime="2619">So I have this method, </span><span class="line" data-startTime="2619">refreshInterval. </span><span class="line" data-startTime="2623">So every &mdash; I think it's </span><span class="line" data-startTime="2623">three seconds, until it's </span><span class="line" data-startTime="2627">done playing, I send a message </span><span class="line" data-startTime="2627">to say, update the progress </span><span class="line" data-startTime="2636">with the current time. </span></p>

<p class="speaker"><span class="line" data-starttime="2637"><span class="speakerName">Darrel Sumi</span>: And this gets </span><span class="line" data-startTime="2637">saved into the local storage. </span></p>

<p class="speaker"><span class="line" data-starttime="2639"><span class="speakerName">John Feig</span>: It gets saved </span><span class="line" data-startTime="2639">into the local storage, </span><span class="line" data-startTime="2641">whereas this data is </span><span class="line" data-startTime="2641">saved in IndexedDB. </span><span class="line" data-startTime="2644">I originally wrote it </span><span class="line" data-startTime="2644">with local storage. </span><span class="line" data-startTime="2648">And I switched it over to </span><span class="line" data-startTime="2648">IndexedDB and cut down like &mdash; I </span><span class="line" data-startTime="2651">just deleted a third of my code. </span><span class="line" data-startTime="2653">It was really nice. </span></p>

<p class="speaker"><span class="line" data-starttime="2654"><span class="speakerName">Darrel Sumi</span>: And </span><span class="line" data-startTime="2654">just to reiterate, </span><span class="line" data-startTime="2655">the whole point of </span><span class="line" data-startTime="2655">that is to make sure </span><span class="line" data-startTime="2657">that the transition from offline </span><span class="line" data-startTime="2657">mode to online is smooth. </span><span class="line" data-startTime="2661">So if you do lose </span><span class="line" data-startTime="2661">connection, it does </span><span class="line" data-startTime="2663">remember where you left off. </span><span class="line" data-startTime="2665">And that's really important </span><span class="line" data-startTime="2665">for the whole user experience </span><span class="line" data-startTime="2668">point of view. </span></p>

<p class="speaker"><span class="line" data-starttime="2669"><span class="speakerName">John Feig</span>: Yeah. </span> <span class="line" data-startTime="2670">And there's definitely </span><span class="line" data-startTime="2670">some other stuff </span><span class="line" data-startTime="2672">that I'd like to </span><span class="line" data-startTime="2672">get to in this app, </span><span class="line" data-startTime="2674">like basically downloading </span><span class="line" data-startTime="2674">the audio ahead of time. </span> <span class="line" data-startTime="2678">So that if you have no </span><span class="line" data-startTime="2678">internet connection, </span><span class="line" data-startTime="2680">you can still play your stuff. </span> <span class="line" data-startTime="2683">That I did not get to. </span> <span class="line" data-startTime="2686">But it's still a </span><span class="line" data-startTime="2686">pretty functional tool. </span> <span class="line" data-startTime="2690">It's nicer than some </span><span class="line" data-startTime="2690">of the other web tools </span><span class="line" data-startTime="2693">that I've used, which </span><span class="line" data-startTime="2693">is why I built it. </span> <span class="line" data-startTime="2698">And then we've got &mdash; </span><span class="line" data-startTime="2698">just throw up some links. </span> <span class="line" data-startTime="2702">We'll make the presentation </span><span class="line" data-startTime="2702">available to everybody </span><span class="line" data-startTime="2704">so that they can look at </span><span class="line" data-startTime="2704">the stuff on their own. </span> <span class="line" data-startTime="2707">We have our app that we're </span><span class="line" data-startTime="2707">modeling this talk on. </span> <span class="line" data-startTime="2713">This was actually &mdash; </span><span class="line" data-startTime="2713">I think, basically, </span><span class="line" data-startTime="2715">all we really needed to do to </span><span class="line" data-startTime="2715">get KeeChat up and running. </span></p>

<p><span class="line" data-startTime="2721">The content security stuff was </span><span class="line" data-startTime="2721">more of a minor issue for us. </span> <span class="line" data-startTime="2724">And then we didn't really </span><span class="line" data-startTime="2724">have anything outside </span><span class="line" data-startTime="2727">of this that turned out </span><span class="line" data-startTime="2727">to be much a problem. </span> <span class="line" data-startTime="2730">It was a pretty </span><span class="line" data-startTime="2730">straightforward conversion. </span> <span class="line" data-startTime="2732">It took me very little time to </span><span class="line" data-startTime="2732">get up and running &mdash; really, </span><span class="line" data-startTime="2736">just a couple days. </span> <span class="line" data-startTime="2737">And this is a pretty </span><span class="line" data-startTime="2737">decent-size project. </span> <span class="line" data-startTime="2740">So I was very surprised </span><span class="line" data-startTime="2740">at how quickly </span><span class="line" data-startTime="2744">we were able to </span><span class="line" data-startTime="2744">do the conversion. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="2745"><span class="speakerName">Darrel Sumi</span>: Yeah, definitely. </span><span class="line" data-startTime="2746">If you come from the Angular </span><span class="line" data-startTime="2746">setup, it's really easy. </span></p>

<p class="speaker"><span class="line" data-starttime="2752"><span class="speakerName">John Feig</span>: And now, we've got </span><span class="line" data-startTime="2752">Darrel's socket demo linked, </span><span class="line" data-startTime="2755">which has both the server </span><span class="line" data-startTime="2755">side and the client side </span><span class="line" data-startTime="2757">in the same project. </span></p>

<p class="speaker"><span class="line" data-starttime="2759"><span class="speakerName">Darrel Sumi</span>: Yes. </span><span class="line" data-startTime="2759">Yep, yep. </span></p>

<p class="speaker"><span class="line" data-starttime="2761"><span class="speakerName">John Feig</span>: And then </span><span class="line" data-startTime="2761">I have two versions </span><span class="line" data-startTime="2763">of the source for my app. </span><span class="line" data-startTime="2765">So I created a </span><span class="line" data-startTime="2765">couple branches so </span><span class="line" data-startTime="2767">that you can look at before </span><span class="line" data-startTime="2767">I started the Chrome App </span><span class="line" data-startTime="2770">conversion and after </span><span class="line" data-startTime="2770">it was finished. </span><span class="line" data-startTime="2773">And these specific branches </span><span class="line" data-startTime="2773">will not have any more commits, </span><span class="line" data-startTime="2777">so they'll be exactly what </span><span class="line" data-startTime="2777">I presented to you today. </span><span class="line" data-startTime="2782">And then I wrote a </span><span class="line" data-startTime="2782">couple little libraries </span><span class="line" data-startTime="2784">that work nice with Angular </span><span class="line" data-startTime="2784">and some of these APIs, </span><span class="line" data-startTime="2787">like the IndexedDB and </span><span class="line" data-startTime="2787">localStorage wrapper. </span><span class="line" data-startTime="2792">And I have to get documentation </span><span class="line" data-startTime="2792">up for those, but they work. </span></p>

<p class="speaker"><span class="line" data-starttime="2798"><span class="speakerName">Brad Green</span>: Good, good. </span> <span class="line" data-startTime="2800">Guys, thanks so much. </span> <span class="line" data-startTime="2801">This was a really nice </span><span class="line" data-startTime="2801">introduction for Chrome Apps </span><span class="line" data-startTime="2804">and the differences between </span><span class="line" data-startTime="2804">an HTML5 app and a Chrome App. </span> <span class="line" data-startTime="2807">I think it'll get people </span><span class="line" data-startTime="2807">started really quickly. </span> <span class="line" data-startTime="2810">And for everyone else, </span><span class="line" data-startTime="2810">thanks for joining us today. </span> <span class="line" data-startTime="2812">We will see you on the web. </span> <span class="line" data-startTime="2814">We'll share all of these </span><span class="line" data-startTime="2814">links to the presentation. </span> <span class="line" data-startTime="2816">We love to take questions </span><span class="line" data-startTime="2816">on Google+ and Twitter. </span> <span class="line" data-startTime="2818">And we'll see you </span><span class="line" data-startTime="2818">at the next GDL. </span></p>

<p class="speaker"><span class="line" data-starttime="2821"><span class="speakerName">John Feig</span>: Thanks for having us. </span></p>

<p class="speaker"><span class="line" data-starttime="2822"><span class="speakerName">Darrel Sumi</span>: Yeah, </span><span class="line" data-startTime="2822">thanks for having us. </span></p>

<p class="speaker"><span class="line" data-starttime="2824"><span class="speakerName">Brad Green</span>: Thanks, guys. </span></p></div>