<style>* {font-family: "Open Sans", sans-serif}
a {color: #77aaff}
a.video {border-bottom: 1px solid #ddd; display: block; margin: 0 0 2em 0; padding: 0 0 2em 0}
h2 {color: #444; font-size: 18px;}
span.speakerName {color: black; font-weight: 900;}
body {padding: 2em}
p {color: #444; margin: 0; text-indent: 1.5em;}
p.speaker {margin: 1em 0 0 0; text-indent: 0;}
div#transcript > p:first-child {text-indent: 0;}
</style>

<h1>#perfmatters: Instant mobile web apps &mdash; Chrome Dev Summit 2013 (Bryan McQuade)</h1>

<h2></h2>

<a class="video" href="http://youtu.be/VKTWdaupft0">youtu.be/VKTWdaupft0</a><div id="transcript"><p><span class="line" data-startTime="3">Good morning. </span> <span class="line" data-startTime="5">I'm Brian McQuade. </span> <span class="line" data-startTime="5">I'm a software </span><span class="line" data-startTime="5">engineer at Google. </span> <span class="line" data-startTime="7">I work on making the mobile </span><span class="line" data-startTime="7">web faster and better. </span> <span class="line" data-startTime="9">And today I'm going </span><span class="line" data-startTime="9">to talk about building </span><span class="line" data-startTime="11">an instant mobile web apps. </span> <span class="line" data-startTime="13">So we'll take the next 30 </span><span class="line" data-startTime="13">minutes to cover two topics. </span> <span class="line" data-startTime="16">The first will be, </span><span class="line" data-startTime="16">I'll give an overview </span><span class="line" data-startTime="17">of the process my </span><span class="line" data-startTime="17">team actually took </span><span class="line" data-startTime="19">to optimize one of </span><span class="line" data-startTime="19">the apps I work on. </span> <span class="line" data-startTime="22">And then in the </span><span class="line" data-startTime="22">second half we'll </span><span class="line" data-startTime="23">take from that some learnings </span><span class="line" data-startTime="23">or some generalizations and best </span><span class="line" data-startTime="26">practices that hopefully </span><span class="line" data-startTime="26">you can take with you </span><span class="line" data-startTime="28">to make your mobile apps faster. </span> <span class="line" data-startTime="34">OK, so our goal </span><span class="line" data-startTime="34">specifically, more precisely, </span><span class="line" data-startTime="37">is to render app content </span><span class="line" data-startTime="37">on the phone in a second. </span></p>

<p><span class="line" data-startTime="39">So from the time a user </span><span class="line" data-startTime="39">clicks a link, to the time </span><span class="line" data-startTime="42">they actually start to </span><span class="line" data-startTime="42">see content on your phone </span><span class="line" data-startTime="45">and you're able to interact with </span><span class="line" data-startTime="45">it, should be about a second. </span> <span class="line" data-startTime="48">And this one second </span><span class="line" data-startTime="48">target actually </span><span class="line" data-startTime="49">comes from some work </span><span class="line" data-startTime="49">linked here at the bottom </span><span class="line" data-startTime="51">by Jakob Nielsen &mdash; </span><span class="line" data-startTime="51">hopefully you can </span><span class="line" data-startTime="53">see that &mdash; that talks about </span><span class="line" data-startTime="53">some different thresholds </span><span class="line" data-startTime="55">of human perception, where, </span><span class="line" data-startTime="55">sort of, behavior changes. </span> <span class="line" data-startTime="59">And that one second </span><span class="line" data-startTime="59">boundary is interesting </span><span class="line" data-startTime="61">because that's the point </span><span class="line" data-startTime="61">at which a user will start </span><span class="line" data-startTime="63">to disengage with the </span><span class="line" data-startTime="63">activity they've initiated. </span></p>

<p><span class="line" data-startTime="66">They'll start to think </span><span class="line" data-startTime="66">about doing something else. </span> <span class="line" data-startTime="69">And so to keep the user </span><span class="line" data-startTime="69">engaged, to keep them wanting </span><span class="line" data-startTime="73">to use your app, we want to </span><span class="line" data-startTime="73">try to deliver that content as </span><span class="line" data-startTime="76">quickly as possible, ideally </span><span class="line" data-startTime="76">within that roughly one </span><span class="line" data-startTime="78">second boundary. </span> <span class="line" data-startTime="81">So a lot of what I'm going </span><span class="line" data-startTime="81">to talk about focuses </span><span class="line" data-startTime="84">on this concept of the critical </span><span class="line" data-startTime="84">rendering path, which you may </span><span class="line" data-startTime="86">have heard Ilya talk about </span><span class="line" data-startTime="86">or others talk about. </span> <span class="line" data-startTime="89">At a really high level, </span><span class="line" data-startTime="89">the critical rendering path </span><span class="line" data-startTime="91">is sort of the </span><span class="line" data-startTime="91">sequence of resources </span><span class="line" data-startTime="93">that need to be </span><span class="line" data-startTime="93">loaded and parsed, </span><span class="line" data-startTime="95">usually JavaScript and </span><span class="line" data-startTime="95">style sheet resources, </span><span class="line" data-startTime="100">that prevent content on </span><span class="line" data-startTime="100">the page from actually </span><span class="line" data-startTime="103">rendering from the screen. </span></p>

<p><span class="line" data-startTime="104">So actually it's easiest </span><span class="line" data-startTime="104">to explain, I think, </span><span class="line" data-startTime="107">with an example. </span> <span class="line" data-startTime="112">So here along the top </span><span class="line" data-startTime="112">we've got a timeline </span><span class="line" data-startTime="114">that shows how an example page </span><span class="line" data-startTime="114">that I'm using for this example </span><span class="line" data-startTime="117">renders over time, out to 20 </span><span class="line" data-startTime="117">seconds on a mobile device. </span> <span class="line" data-startTime="121">So we have a performance </span><span class="line" data-startTime="121">problem here. </span> <span class="line" data-startTime="123">And the question becomes, </span><span class="line" data-startTime="123">well, why is it so slow? </span><span class="line" data-startTime="125">Why is it taking nine seconds to </span><span class="line" data-startTime="125">render anything to the screen, </span><span class="line" data-startTime="128">and why does it take 20 </span><span class="line" data-startTime="128">seconds to finish rendering? </span><span class="line" data-startTime="131">And that's what the critical </span><span class="line" data-startTime="131">rendering path tries to answer. </span> <span class="line" data-startTime="135">So if we have an example </span><span class="line" data-startTime="135">network waterfall here, </span><span class="line" data-startTime="137">we can walk through </span><span class="line" data-startTime="137">and try to start </span><span class="line" data-startTime="138">to make sense of what this </span><span class="line" data-startTime="138">critical rendering path is all </span><span class="line" data-startTime="141">about. </span> <span class="line" data-startTime="142">So obviously, we start by </span><span class="line" data-startTime="142">loading the HTML resource. </span></p>

<p><span class="line" data-startTime="146">That comes back </span><span class="line" data-startTime="146">with some content. </span> <span class="line" data-startTime="147">It might have a style sheet, </span><span class="line" data-startTime="147">and a script resource. </span> <span class="line" data-startTime="150">And so at this point </span><span class="line" data-startTime="150">we have &mdash; like I said, </span><span class="line" data-startTime="152">the critical path includes, </span><span class="line" data-startTime="152">usually, script and styles. </span> <span class="line" data-startTime="156">These resources </span><span class="line" data-startTime="156">block the browser </span><span class="line" data-startTime="157">from actually painting </span><span class="line" data-startTime="157">content to the screen. </span> <span class="line" data-startTime="159">So while a style </span><span class="line" data-startTime="159">sheet is pending, </span><span class="line" data-startTime="161">the browser is going to </span><span class="line" data-startTime="161">wait for that style sheet </span><span class="line" data-startTime="163">to load before it </span><span class="line" data-startTime="163">actually paints </span><span class="line" data-startTime="164">any content to the screen. </span></p>

<p><span class="line" data-startTime="165">So we can't paint anything until </span><span class="line" data-startTime="165">these resources finish loading. </span> <span class="line" data-startTime="171">Imagine that we sent out the </span><span class="line" data-startTime="171">request for both of those. </span> <span class="line" data-startTime="174">The response comes back to the </span><span class="line" data-startTime="174">JavaScript in nine seconds, </span><span class="line" data-startTime="177">and at that point, we can </span><span class="line" data-startTime="177">begin to paint something </span><span class="line" data-startTime="180">to the screen. </span> <span class="line" data-startTime="181">It may not be the content </span><span class="line" data-startTime="181">the user actually wants, </span><span class="line" data-startTime="183">unfortunately. </span> <span class="line" data-startTime="183">That's sort of at the end. </span> <span class="line" data-startTime="185">But we've sort of </span><span class="line" data-startTime="185">started to paint. </span> <span class="line" data-startTime="186">And then from there imagine the </span><span class="line" data-startTime="186">JavaScript resource adds a CSS </span><span class="line" data-startTime="190">resource to the DOM, a </span><span class="line" data-startTime="190">style sheet to the DOM, </span><span class="line" data-startTime="192">and so now that's </span><span class="line" data-startTime="192">on the critical path </span><span class="line" data-startTime="194">for subsequent paints. </span></p>

<p><span class="line" data-startTime="195">Once that loads, we can paint </span><span class="line" data-startTime="195">a little bit more content. </span> <span class="line" data-startTime="200">The style sheet maybe had </span><span class="line" data-startTime="200">some stylings for the footer. </span> <span class="line" data-startTime="203">Additionally, we've loaded, say, </span><span class="line" data-startTime="203">a second JavaScript resource </span><span class="line" data-startTime="207">from that first </span><span class="line" data-startTime="207">JavaScript resource. </span> <span class="line" data-startTime="209">And say that's used </span><span class="line" data-startTime="209">to actually render </span><span class="line" data-startTime="211">the main content on the screen. </span> <span class="line" data-startTime="212">And so that now </span><span class="line" data-startTime="212">has to load, parse, </span><span class="line" data-startTime="214">and execute before </span><span class="line" data-startTime="214">you can actually </span><span class="line" data-startTime="215">see any content on the </span><span class="line" data-startTime="215">screen &mdash; or, I'm sorry, </span><span class="line" data-startTime="217">see the final content. </span></p>

<p><span class="line" data-startTime="218">And then finally around </span><span class="line" data-startTime="218">19 or 20 seconds, </span><span class="line" data-startTime="221">all of that finishes, that </span><span class="line" data-startTime="221">whole process of these things </span><span class="line" data-startTime="224">loading in the browser </span><span class="line" data-startTime="224">finishes, and we </span><span class="line" data-startTime="226">could paint these finished </span><span class="line" data-startTime="226">content to the screen </span><span class="line" data-startTime="228">and show that the user. </span> <span class="line" data-startTime="229">So the critical </span><span class="line" data-startTime="229">rendering path tries </span><span class="line" data-startTime="231">to focus on the most </span><span class="line" data-startTime="231">significant resources that </span><span class="line" data-startTime="234">cause render-blocking, </span><span class="line" data-startTime="234">and explain </span><span class="line" data-startTime="238">why we see these delays. </span> <span class="line" data-startTime="239">But this becomes especially </span><span class="line" data-startTime="239">important on mobile, where </span><span class="line" data-startTime="241">we have these very high </span><span class="line" data-startTime="241">network round-trip times, </span><span class="line" data-startTime="244">and loading extra </span><span class="line" data-startTime="244">JavaScript and CSS resources </span><span class="line" data-startTime="246">ends up having a </span><span class="line" data-startTime="246">significant cost. </span> <span class="line" data-startTime="249">So now, we'll focus </span><span class="line" data-startTime="249">more on thinking </span><span class="line" data-startTime="253">about optimizing critical path. </span></p>

<p><span class="line" data-startTime="254">We know, here, that we've got </span><span class="line" data-startTime="254">this really long critical path </span><span class="line" data-startTime="257">of resources. </span> <span class="line" data-startTime="258">This is just a toy example. </span> <span class="line" data-startTime="260">So the question becomes, </span><span class="line" data-startTime="260">how do we actually </span><span class="line" data-startTime="262">address and optimize that? </span><span class="line" data-startTime="263">I'm going to talk about </span><span class="line" data-startTime="263">the process my team went </span><span class="line" data-startTime="265">through about a year ago to do </span><span class="line" data-startTime="265">just that for one of the apps </span><span class="line" data-startTime="269">I work on, PageSpeed Insights. </span> <span class="line" data-startTime="271">So PageSpeed Insights </span><span class="line" data-startTime="271">is a tool you can use </span><span class="line" data-startTime="273">at </span><span class="line" data-startTime="273">developers.google.com/pagespeed. </span> <span class="line" data-startTime="276">This is a tool where you could </span><span class="line" data-startTime="276">enter a URL into the box here. </span> <span class="line" data-startTime="279">We go off and we render the </span><span class="line" data-startTime="279">page in a headless browser. </span></p>

<p><span class="line" data-startTime="284">We analyze how it loads. </span> <span class="line" data-startTime="286">And we come back and give </span><span class="line" data-startTime="286">you a prioritized list </span><span class="line" data-startTime="288">of recommendations to </span><span class="line" data-startTime="288">make the page load faster. </span> <span class="line" data-startTime="290">And about a year ago, </span><span class="line" data-startTime="290">we had this problem. </span> <span class="line" data-startTime="292">Well, we started </span><span class="line" data-startTime="292">to think about, OK, </span><span class="line" data-startTime="294">how do we make this page </span><span class="line" data-startTime="294">really fast on mobile? </span><span class="line" data-startTime="297">We knew we weren't doing great, </span><span class="line" data-startTime="297">but the first thing we did </span><span class="line" data-startTime="300">is we wanted to see exactly </span><span class="line" data-startTime="300">how poorly we were doing. </span> <span class="line" data-startTime="303">And so what we saw </span><span class="line" data-startTime="303">really surprised us. </span> <span class="line" data-startTime="305">It was worse than we expected. </span> <span class="line" data-startTime="307">Now you can see where </span><span class="line" data-startTime="307">the example comes from. </span> <span class="line" data-startTime="310">It took nine seconds to </span><span class="line" data-startTime="310">render anything at all, </span><span class="line" data-startTime="312">but it took about 19 or 20 </span><span class="line" data-startTime="312">seconds on a 3G connection </span><span class="line" data-startTime="314">or on an iPhone 4, in </span><span class="line" data-startTime="314">this case, to render </span><span class="line" data-startTime="316">what the user </span><span class="line" data-startTime="316">actually cared about, </span><span class="line" data-startTime="318">which was that initial </span><span class="line" data-startTime="318">text box that they </span><span class="line" data-startTime="319">could use to interact </span><span class="line" data-startTime="319">with the app. </span></p>

<p><span class="line" data-startTime="321">And so, 20 seconds. </span> <span class="line" data-startTime="325">Our target is one second. </span> <span class="line" data-startTime="327">We've got a really </span><span class="line" data-startTime="327">significant problem here, </span><span class="line" data-startTime="330">and we knew we needed </span><span class="line" data-startTime="330">to really rethink a lot, </span><span class="line" data-startTime="332">or try to figure out what </span><span class="line" data-startTime="332">we had missed, right? </span><span class="line" data-startTime="334">This app was reasonably </span><span class="line" data-startTime="334">fast on desktop, </span><span class="line" data-startTime="336">but on a high latency </span><span class="line" data-startTime="336">mobile connection, </span><span class="line" data-startTime="339">it just took way </span><span class="line" data-startTime="339">too long to load. </span> <span class="line" data-startTime="341">So we started to </span><span class="line" data-startTime="341">look at the markup. </span> <span class="line" data-startTime="344">We saw we had some </span><span class="line" data-startTime="344">render-blocking resources </span><span class="line" data-startTime="346">in the head. </span> <span class="line" data-startTime="346">But this isn't all </span><span class="line" data-startTime="346">that uncommon, right? </span><span class="line" data-startTime="348">You see this in lots of apps. </span> <span class="line" data-startTime="349">So there's nothing that </span><span class="line" data-startTime="349">really stood out here </span><span class="line" data-startTime="351">as being particularly costly. </span></p>

<p><span class="line" data-startTime="353">So we went back to our timeline. </span> <span class="line" data-startTime="356">Then we looked at a </span><span class="line" data-startTime="356">network waterfall. </span> <span class="line" data-startTime="358">You can see we load </span><span class="line" data-startTime="358">about 25 resources here. </span> <span class="line" data-startTime="361">And the question came </span><span class="line" data-startTime="361">up, OK, well we're </span><span class="line" data-startTime="363">loading all these resources, </span><span class="line" data-startTime="363">but which of these resources </span><span class="line" data-startTime="366">are actually contributing </span><span class="line" data-startTime="366">to making the page slower? </span><span class="line" data-startTime="369">Which of these are on the </span><span class="line" data-startTime="369">critical rendering path? </span><span class="line" data-startTime="372">And so one of the things that </span><span class="line" data-startTime="372">PageSpeed Insights actually </span><span class="line" data-startTime="375">does today is it can </span><span class="line" data-startTime="375">tell you which resources </span><span class="line" data-startTime="378">are on the critical </span><span class="line" data-startTime="378">rendering path. </span> <span class="line" data-startTime="380">And so we can go here. </span> <span class="line" data-startTime="382">We can click through. </span> <span class="line" data-startTime="385">And we can see we've got these </span><span class="line" data-startTime="385">JavaScript resources, these CSS </span><span class="line" data-startTime="388">resources that are on that </span><span class="line" data-startTime="388">critical rendering path, </span><span class="line" data-startTime="390">that block rendering of </span><span class="line" data-startTime="390">content on the screen, </span><span class="line" data-startTime="392">and then use that to go </span><span class="line" data-startTime="392">back to our waterfall </span><span class="line" data-startTime="394">and start to focus on </span><span class="line" data-startTime="394">which resources actually </span><span class="line" data-startTime="399">block rendering. </span></p>

<p><span class="line" data-startTime="399">So now we have about a </span><span class="line" data-startTime="399">dozen resources to focus on. </span> <span class="line" data-startTime="404">And we're able to focus </span><span class="line" data-startTime="404">more precisely on, </span><span class="line" data-startTime="406">what are the render-blocking </span><span class="line" data-startTime="406">effects of these resources? </span><span class="line" data-startTime="408">And then, how do </span><span class="line" data-startTime="408">we address those? </span><span class="line" data-startTime="410">And so we can begin to </span><span class="line" data-startTime="410">sort of match up here. </span> <span class="line" data-startTime="412">We've got some content that </span><span class="line" data-startTime="412">loads before the nine second </span><span class="line" data-startTime="417">first paint. </span> <span class="line" data-startTime="418">We can start to notice </span><span class="line" data-startTime="418">which of those resources </span><span class="line" data-startTime="420">are blocking that point. </span> <span class="line" data-startTime="421">I'll get into that </span><span class="line" data-startTime="421">in just a minute. </span> <span class="line" data-startTime="423">But this was sort of the </span><span class="line" data-startTime="423">starting point for us, </span><span class="line" data-startTime="425">was looking at this </span><span class="line" data-startTime="425">and figuring out, </span><span class="line" data-startTime="428">how do we optimize the critical </span><span class="line" data-startTime="428">rendering path for this page? </span><span class="line" data-startTime="437">At a high level we felt like </span><span class="line" data-startTime="437">we had two problems here. </span></p>

<p><span class="line" data-startTime="440">One was that we had a bunch </span><span class="line" data-startTime="440">of render-blocking JavaScript </span><span class="line" data-startTime="444">and CSS loaded in a way that </span><span class="line" data-startTime="444">blocked any content at all </span><span class="line" data-startTime="448">from rendering the page &mdash; </span><span class="line" data-startTime="448">rendering on the page. </span> <span class="line" data-startTime="451">So this block of </span><span class="line" data-startTime="451">JavaScript and CSS </span><span class="line" data-startTime="453">here, which declared in </span><span class="line" data-startTime="453">the head of the HTML, all </span><span class="line" data-startTime="457">had to be downloaded, </span><span class="line" data-startTime="457">parsed, and executed in order </span><span class="line" data-startTime="460">for anything at all </span><span class="line" data-startTime="460">to render on screen. </span> <span class="line" data-startTime="462">And as we know, mobile networks </span><span class="line" data-startTime="462">have really high latency, </span><span class="line" data-startTime="466">so downloading </span><span class="line" data-startTime="466">additional resources has </span><span class="line" data-startTime="469">a pretty significant, </span><span class="line" data-startTime="469">pretty high cost, </span><span class="line" data-startTime="472">all the while your users are </span><span class="line" data-startTime="472">looking at a blank screen, </span><span class="line" data-startTime="474">waiting and wondering </span><span class="line" data-startTime="474">if your app is working, </span><span class="line" data-startTime="476">thinking about transitioning </span><span class="line" data-startTime="476">away to do something else. </span> <span class="line" data-startTime="479">So for us &mdash; and I'll show </span><span class="line" data-startTime="479">it in a little more detail </span><span class="line" data-startTime="481">in a minute &mdash; what we </span><span class="line" data-startTime="481">concluded we needed to do </span><span class="line" data-startTime="484">was basically eliminate </span><span class="line" data-startTime="484">all of these resources </span><span class="line" data-startTime="487">from being render-blocking. </span></p>

<p><span class="line" data-startTime="488">And that amounted to doing </span><span class="line" data-startTime="488">two things, which we'll </span><span class="line" data-startTime="490">dive into &mdash; loading our </span><span class="line" data-startTime="490">render-blocking JavaScript </span><span class="line" data-startTime="494">asynchronously, and </span><span class="line" data-startTime="494">then really thinking </span><span class="line" data-startTime="495">about what is the </span><span class="line" data-startTime="495">minimal amount of CSS </span><span class="line" data-startTime="497">we actually need </span><span class="line" data-startTime="497">to render this out, </span><span class="line" data-startTime="499">and loading that in a </span><span class="line" data-startTime="499">blocking way, but making sure </span><span class="line" data-startTime="501">we weren't loading </span><span class="line" data-startTime="501">any more than we </span><span class="line" data-startTime="502">needed in a render-blocking way. </span> <span class="line" data-startTime="507">And so recall, this </span><span class="line" data-startTime="507">is the screenshot </span><span class="line" data-startTime="509">that was associated with </span><span class="line" data-startTime="509">that point in the page load. </span> <span class="line" data-startTime="513">The thing to note here is </span><span class="line" data-startTime="513">that we haven't actually </span><span class="line" data-startTime="515">rendered the content </span><span class="line" data-startTime="515">the user really cared, </span><span class="line" data-startTime="517">that text box to interact </span><span class="line" data-startTime="517">with the app yet. </span> <span class="line" data-startTime="520">So the second issue </span><span class="line" data-startTime="520">was, we were actually </span><span class="line" data-startTime="523">rendering that sort </span><span class="line" data-startTime="523">of critical content, </span><span class="line" data-startTime="525">the text box, that the user </span><span class="line" data-startTime="525">could use to actually analyze </span><span class="line" data-startTime="529">a page, using a </span><span class="line" data-startTime="529">JavaScript resource. </span> <span class="line" data-startTime="531">We made it to download a </span><span class="line" data-startTime="531">large chunk of JavaScript, </span><span class="line" data-startTime="534">download, parse, and execute </span><span class="line" data-startTime="534">that JavaScript before we </span><span class="line" data-startTime="536">actually rendered </span><span class="line" data-startTime="536">that, using JavaScript </span><span class="line" data-startTime="538">to construct the DOM. </span></p>

<p><span class="line" data-startTime="540">So this added another </span><span class="line" data-startTime="540">roughly 10 seconds of latency </span><span class="line" data-startTime="543">here before we could </span><span class="line" data-startTime="543">get to this point. </span> <span class="line" data-startTime="545">So all in all, we had at a </span><span class="line" data-startTime="545">high level these two problems. </span> <span class="line" data-startTime="551">And so we sat down and we </span><span class="line" data-startTime="551">tried to address these things. </span> <span class="line" data-startTime="554">The thing we did for this was </span><span class="line" data-startTime="554">we realized most of the content, </span><span class="line" data-startTime="556">we're rendering it </span><span class="line" data-startTime="556">with JavaScript, </span><span class="line" data-startTime="558">and that's fine and great, </span><span class="line" data-startTime="558">but it just wasn't performant. </span> <span class="line" data-startTime="560">And so what we did is we </span><span class="line" data-startTime="560">inlined that initial view. </span> <span class="line" data-startTime="564">Or I should say, we put the </span><span class="line" data-startTime="564">initial view's HTML markup </span><span class="line" data-startTime="567">directly in HTML, no longer </span><span class="line" data-startTime="567">depending on JavaScript </span><span class="line" data-startTime="571">to actually render that, which </span><span class="line" data-startTime="571">allowed us to present that </span><span class="line" data-startTime="574">to the user that much </span><span class="line" data-startTime="574">faster without having </span><span class="line" data-startTime="576">to wait for that render-blocking </span><span class="line" data-startTime="576">JavaScript to load. </span> <span class="line" data-startTime="580">So I just wanted to show </span><span class="line" data-startTime="580">a quick before and after. </span></p>

<p><span class="line" data-startTime="582">Here's that HTML markup </span><span class="line" data-startTime="582">for the original page that </span><span class="line" data-startTime="585">took 19 seconds, at </span><span class="line" data-startTime="585">least part of it. </span> <span class="line" data-startTime="588">We've got our render-blocking </span><span class="line" data-startTime="588">JavaScript in the head. </span> <span class="line" data-startTime="590">We've got some markup </span><span class="line" data-startTime="590">for the content, </span><span class="line" data-startTime="596">but we don't have, you'll </span><span class="line" data-startTime="596">notice, the input box. </span> <span class="line" data-startTime="598">That was rendered with </span><span class="line" data-startTime="598">JavaScript, so some of that </span><span class="line" data-startTime="600">comes later. </span> <span class="line" data-startTime="601">The after case &mdash; here, we've </span><span class="line" data-startTime="601">got a slightly different markup. </span> <span class="line" data-startTime="607">First, we've got an inline style </span><span class="line" data-startTime="607">block that contains the CSS. </span> <span class="line" data-startTime="610">We need to style the </span><span class="line" data-startTime="610">content in the initial view. </span> <span class="line" data-startTime="612">So we don't have </span><span class="line" data-startTime="612">to go to network </span><span class="line" data-startTime="614">to download additional </span><span class="line" data-startTime="614">style sheets, which </span><span class="line" data-startTime="616">will incur additional mobile </span><span class="line" data-startTime="616">network round trips, which </span><span class="line" data-startTime="618">are significantly slower, </span><span class="line" data-startTime="618">or significantly slow </span><span class="line" data-startTime="621">down the page load. </span> <span class="line" data-startTime="624">And then as I </span><span class="line" data-startTime="624">mentioned, now we've </span><span class="line" data-startTime="625">made sure that all </span><span class="line" data-startTime="625">the markup we need </span><span class="line" data-startTime="627">to render the above the fold </span><span class="line" data-startTime="627">content is directly in HTML. </span></p>

<p><span class="line" data-startTime="630">We're not using JavaScript to </span><span class="line" data-startTime="630">render any of this content. </span> <span class="line" data-startTime="634">And then finally, </span><span class="line" data-startTime="634">because we're including </span><span class="line" data-startTime="636">all the markup we need to </span><span class="line" data-startTime="636">render the initial view directly </span><span class="line" data-startTime="639">in HTML, we can load our </span><span class="line" data-startTime="639">JavaScript asynchronously </span><span class="line" data-startTime="643">because we don't </span><span class="line" data-startTime="643">need it to render, </span><span class="line" data-startTime="644">so we don't want it </span><span class="line" data-startTime="644">to block rendering </span><span class="line" data-startTime="646">of the initial presentation. </span> <span class="line" data-startTime="650">So that high level was the </span><span class="line" data-startTime="650">process we went through. </span> <span class="line" data-startTime="652">And so the question </span><span class="line" data-startTime="652">is, how did we do? </span><span class="line" data-startTime="654">Did we actually </span><span class="line" data-startTime="654">speed the page up? </span><span class="line" data-startTime="656">So here's the waterfall </span><span class="line" data-startTime="656">for the original page. </span> <span class="line" data-startTime="660">We've got about 25 </span><span class="line" data-startTime="660">resources in total. </span> <span class="line" data-startTime="664">And then here's the waterfall </span><span class="line" data-startTime="664">for this rewrite that </span><span class="line" data-startTime="667">was focused on delivering </span><span class="line" data-startTime="667">a really fast experience </span><span class="line" data-startTime="669">on mobile. </span> <span class="line" data-startTime="670">And you can see we've got </span><span class="line" data-startTime="670">about 20 resources now. </span> <span class="line" data-startTime="672">So we had 25 before, 20 now. </span> <span class="line" data-startTime="676">It's not really </span><span class="line" data-startTime="676">significantly different </span><span class="line" data-startTime="678">if you look at the </span><span class="line" data-startTime="678">total waterfall </span><span class="line" data-startTime="679">size, total number of requests. </span> <span class="line" data-startTime="681">But I think what's </span><span class="line" data-startTime="681">really important </span><span class="line" data-startTime="682">here is looking not at the </span><span class="line" data-startTime="682">total number of requests, </span><span class="line" data-startTime="685">but the relative size of </span><span class="line" data-startTime="685">the two critical paths </span><span class="line" data-startTime="687">between the critical rendering </span><span class="line" data-startTime="687">paths, between the two pages. </span></p>

<p><span class="line" data-startTime="690">So in the old example, we had </span><span class="line" data-startTime="690">a bunch of resources here. </span> <span class="line" data-startTime="692">We've got everything </span><span class="line" data-startTime="692">we need to render </span><span class="line" data-startTime="694">the initial view in </span><span class="line" data-startTime="694">the HTML payload. </span> <span class="line" data-startTime="697">So the critical path, the </span><span class="line" data-startTime="697">critical rendering path, </span><span class="line" data-startTime="699">is this one HTML resource. </span> <span class="line" data-startTime="701">And we can render </span><span class="line" data-startTime="701">much more quickly </span><span class="line" data-startTime="703">than in the original case </span><span class="line" data-startTime="703">where we had a dozen resources. </span> <span class="line" data-startTime="706">So we often talk </span><span class="line" data-startTime="706">about, well, reducing </span><span class="line" data-startTime="709">requests is a goal </span><span class="line" data-startTime="709">with performance </span><span class="line" data-startTime="711">and with optimization. </span> <span class="line" data-startTime="712">But I think what's </span><span class="line" data-startTime="712">more important is </span><span class="line" data-startTime="713">to think about reducing </span><span class="line" data-startTime="713">the number of requests </span><span class="line" data-startTime="715">on the critical rendering path. </span> <span class="line" data-startTime="717">That's really where you </span><span class="line" data-startTime="717">will see your big returns. </span></p>

<p><span class="line" data-startTime="721">So let's look. </span> <span class="line" data-startTime="722">Let's do sort of a side </span><span class="line" data-startTime="722">by side, before and after. </span> <span class="line" data-startTime="725">So the optimized case, </span><span class="line" data-startTime="725">we start to render in </span><span class="line" data-startTime="727">about a second a half, </span><span class="line" data-startTime="727">and we're completely </span><span class="line" data-startTime="729">done at three seconds. </span> <span class="line" data-startTime="730">All the images, </span><span class="line" data-startTime="730">everything, have come back. </span> <span class="line" data-startTime="732">And recall the original case. </span> <span class="line" data-startTime="733">We're still waiting. </span> <span class="line" data-startTime="735">We can't actually really </span><span class="line" data-startTime="735">interact with the app, even </span><span class="line" data-startTime="737">at this point, because we </span><span class="line" data-startTime="737">don't have the text box. </span> <span class="line" data-startTime="740">So we were able to reduce </span><span class="line" data-startTime="740">the render time down </span><span class="line" data-startTime="748">from about 20 seconds down </span><span class="line" data-startTime="748">to one or one half seconds. </span> <span class="line" data-startTime="751">So we more or less </span><span class="line" data-startTime="751">accomplished our goal. </span> <span class="line" data-startTime="754">So that's the process </span><span class="line" data-startTime="754">we went through, </span><span class="line" data-startTime="756">and now I'm going to </span><span class="line" data-startTime="756">spend little time talking </span><span class="line" data-startTime="759">about the process of </span><span class="line" data-startTime="759">optimizing your app's content. </span> <span class="line" data-startTime="762">So what did we learn? </span><span class="line" data-startTime="763">What are the general </span><span class="line" data-startTime="763">best practices there? </span><span class="line" data-startTime="764">How can you deliver this instant </span><span class="line" data-startTime="764">experience for your users </span><span class="line" data-startTime="767">on mobile? </span><span class="line" data-startTime="769">So the first thing we </span><span class="line" data-startTime="769">learned &mdash; the first thing </span><span class="line" data-startTime="771">we identified as an </span><span class="line" data-startTime="771">important best practice &mdash; </span><span class="line" data-startTime="774">is to load script </span><span class="line" data-startTime="774">asynchronously. </span></p>

<p><span class="line" data-startTime="775">So don't load scripts in a way </span><span class="line" data-startTime="775">that blocks rendering, because </span><span class="line" data-startTime="779">on mobile networks, with the </span><span class="line" data-startTime="779">high latency, high round trip </span><span class="line" data-startTime="783">times, each additional </span><span class="line" data-startTime="783">resource you </span><span class="line" data-startTime="785">load in the critical </span><span class="line" data-startTime="785">rendering path </span><span class="line" data-startTime="786">pushes out the time the user </span><span class="line" data-startTime="786">has to wait to start interacting </span><span class="line" data-startTime="790">with your app pretty </span><span class="line" data-startTime="790">significantly. </span> <span class="line" data-startTime="792">So here we've got your </span><span class="line" data-startTime="792">sort of standard page, </span><span class="line" data-startTime="796">group source equals all </span><span class="line" data-startTime="796">that JS in the head. </span> <span class="line" data-startTime="799">And we've got the </span><span class="line" data-startTime="799">content right beneath it. </span> <span class="line" data-startTime="801">The browser receives that </span><span class="line" data-startTime="801">at the same time, probably, </span><span class="line" data-startTime="803">as the script. </span> <span class="line" data-startTime="804">But it can't show it to the user </span><span class="line" data-startTime="804">until the script has finished </span><span class="line" data-startTime="809">downloading, parsing, </span><span class="line" data-startTime="809">and executing </span><span class="line" data-startTime="810">on the mobile device, </span><span class="line" data-startTime="810">which introduces </span><span class="line" data-startTime="812">really significant additional </span><span class="line" data-startTime="812">render latencies for the user. </span> <span class="line" data-startTime="817">And so what do we do? </span><span class="line" data-startTime="819">In the best case, you </span><span class="line" data-startTime="819">can take advantage </span><span class="line" data-startTime="821">of the HMTL5 async tag, which </span><span class="line" data-startTime="821">tells the browser, yes, I </span><span class="line" data-startTime="825">need this script, I need </span><span class="line" data-startTime="825">to load this script, </span><span class="line" data-startTime="828">but you don't need to execute </span><span class="line" data-startTime="828">it inline at the point </span><span class="line" data-startTime="831">where it appears </span><span class="line" data-startTime="831">in the document. </span></p>

<p><span class="line" data-startTime="833">Execute it sometime later </span><span class="line" data-startTime="833">when it finishes downloading, </span><span class="line" data-startTime="835">and then go ahead </span><span class="line" data-startTime="835">and just proceed </span><span class="line" data-startTime="837">parsing the rest </span><span class="line" data-startTime="837">of the document, </span><span class="line" data-startTime="839">and render that content to the </span><span class="line" data-startTime="839">user as quickly as you can. </span> <span class="line" data-startTime="841">So this gets scripts out of </span><span class="line" data-startTime="841">the critical rendering path, </span><span class="line" data-startTime="844">which is a really </span><span class="line" data-startTime="844">important thing to do. </span> <span class="line" data-startTime="849">So I'll say there are </span><span class="line" data-startTime="849">some subtleties here. </span> <span class="line" data-startTime="852">It's often not quite </span><span class="line" data-startTime="852">as easy as just </span><span class="line" data-startTime="854">dropping the async tag in there. </span> <span class="line" data-startTime="856">If you use document.write </span><span class="line" data-startTime="856">in your JavaScript, </span><span class="line" data-startTime="858">this is a really </span><span class="line" data-startTime="858">dangerous thing to do. </span> <span class="line" data-startTime="860">And there are other </span><span class="line" data-startTime="860">subtleties that I'd </span><span class="line" data-startTime="863">be happy to talk </span><span class="line" data-startTime="863">about at the session. </span> <span class="line" data-startTime="866">And I guess it'll be 45 minutes. </span> <span class="line" data-startTime="869">So second, render the initial </span><span class="line" data-startTime="869">view server-side as HTML. </span> <span class="line" data-startTime="872">You'll recall we had </span><span class="line" data-startTime="872">about six seconds </span><span class="line" data-startTime="875">of render-blocking </span><span class="line" data-startTime="875">JavaScript and CSS, </span><span class="line" data-startTime="877">but then we had 10 seconds </span><span class="line" data-startTime="877">to load that final JavaScript </span><span class="line" data-startTime="882">resource, download, </span><span class="line" data-startTime="882">parse, and execute it </span><span class="line" data-startTime="884">before the app </span><span class="line" data-startTime="884">finished rendering. </span></p>

<p><span class="line" data-startTime="886">And the problem was we were </span><span class="line" data-startTime="886">loading this big JavaScript </span><span class="line" data-startTime="888">bundle, whose job it was to </span><span class="line" data-startTime="888">actually construct the DOM. </span> <span class="line" data-startTime="891">So we had to go to </span><span class="line" data-startTime="891">network in order </span><span class="line" data-startTime="893">to create the DOM that </span><span class="line" data-startTime="893">the user would see. </span> <span class="line" data-startTime="895">And this is just, unfortunately, </span><span class="line" data-startTime="895">an inherently slow process </span><span class="line" data-startTime="898">on mobile. </span> <span class="line" data-startTime="898">Rendering client-side &mdash; </span><span class="line" data-startTime="898">let's talk about &mdash; so </span><span class="line" data-startTime="901">what do we mean by </span><span class="line" data-startTime="901">server-side rendering </span><span class="line" data-startTime="903">versus client-side rendering? </span><span class="line" data-startTime="904">So client-side rendering, </span><span class="line" data-startTime="904">you're using JavaScript </span><span class="line" data-startTime="909">to actually render the </span><span class="line" data-startTime="909">content in the document. </span> <span class="line" data-startTime="911">So here we load up that JS. </span> <span class="line" data-startTime="913">The DOM itself doesn't </span><span class="line" data-startTime="913">really contain any markup. </span> <span class="line" data-startTime="917">It doesn't contain mark up </span><span class="line" data-startTime="917">that you see on the screen. </span> <span class="line" data-startTime="920">It's just to figure </span><span class="line" data-startTime="920">out a placeholder div, </span><span class="line" data-startTime="922">and then when app.js </span><span class="line" data-startTime="922">finishes loading, </span><span class="line" data-startTime="925">we might get something like </span><span class="line" data-startTime="925">this that actually constructs </span><span class="line" data-startTime="927">the DOM once that </span><span class="line" data-startTime="927">resource finishes loading. </span></p>

<p><span class="line" data-startTime="930">By contrast, server-side </span><span class="line" data-startTime="930">rendering &mdash; everything </span><span class="line" data-startTime="935">that we need to display </span><span class="line" data-startTime="935">in the initial view </span><span class="line" data-startTime="937">is present right </span><span class="line" data-startTime="937">in the HTML markup, </span><span class="line" data-startTime="940">and so no additional </span><span class="line" data-startTime="940">resources are needed. </span> <span class="line" data-startTime="941">As soon as that </span><span class="line" data-startTime="941">HTML comes back, we </span><span class="line" data-startTime="943">can render that to the </span><span class="line" data-startTime="943">screen and the user </span><span class="line" data-startTime="945">sees that as </span><span class="line" data-startTime="945">quickly as possible. </span> <span class="line" data-startTime="947">So this is just, on </span><span class="line" data-startTime="947">mobile especially, </span><span class="line" data-startTime="948">this is just a much </span><span class="line" data-startTime="948">more performant approach </span><span class="line" data-startTime="950">for the initial view. </span> <span class="line" data-startTime="951">So certainly, once the </span><span class="line" data-startTime="951">app has finished loading, </span><span class="line" data-startTime="954">and the user is </span><span class="line" data-startTime="954">interacting with your app &mdash; </span><span class="line" data-startTime="957">they're changing the way </span><span class="line" data-startTime="957">the content is presented, </span><span class="line" data-startTime="959">maybe they're navigating </span><span class="line" data-startTime="959">through a menu &mdash; certainly </span><span class="line" data-startTime="961">at that point it makes </span><span class="line" data-startTime="961">sense to use JavaScript </span><span class="line" data-startTime="963">to construct your document. </span> <span class="line" data-startTime="965">But for that initial </span><span class="line" data-startTime="965">view, you should </span><span class="line" data-startTime="967">do as much server-side rendering </span><span class="line" data-startTime="967">to HTML as you possibly can. </span></p>

<p><span class="line" data-startTime="974">So we found this to be true. </span> <span class="line" data-startTime="975">But we weren't the only ones. </span> <span class="line" data-startTime="977">Twitter also came to </span><span class="line" data-startTime="977">the same conclusion. </span> <span class="line" data-startTime="981">So they wrote a blog </span><span class="line" data-startTime="981">post about a year ago </span><span class="line" data-startTime="983">where they talked about this. </span> <span class="line" data-startTime="984">In 2010, they'd </span><span class="line" data-startTime="984">released new Twitter, </span><span class="line" data-startTime="987">where all the rendering </span><span class="line" data-startTime="987">happened on the client. </span> <span class="line" data-startTime="990">And they talked about </span><span class="line" data-startTime="990">how that allowed </span><span class="line" data-startTime="992">them to do some </span><span class="line" data-startTime="992">interesting new things, </span><span class="line" data-startTime="993">but it came at the consequence </span><span class="line" data-startTime="993">of significant regression </span><span class="line" data-startTime="997">in actual client-side </span><span class="line" data-startTime="997">render time. </span> <span class="line" data-startTime="999">So in 2012, they </span><span class="line" data-startTime="999">wrote this blog post </span><span class="line" data-startTime="1001">where they talk about taking </span><span class="line" data-startTime="1001">back control of front end </span><span class="line" data-startTime="1003">performance by moving </span><span class="line" data-startTime="1003">rendering back to the server. </span></p>

<p><span class="line" data-startTime="1007">And what they found is that </span><span class="line" data-startTime="1007">page load times dropped really </span><span class="line" data-startTime="1014">significantly. </span> <span class="line" data-startTime="1015">So wasn't like </span><span class="line" data-startTime="1015">10% or 15%, it was </span><span class="line" data-startTime="1017">1/5 of what they </span><span class="line" data-startTime="1017">were previously. </span> <span class="line" data-startTime="1019">So this was a really </span><span class="line" data-startTime="1019">big thing for them. </span> <span class="line" data-startTime="1021">And in order to deliver that </span><span class="line" data-startTime="1021">instant experience on mobile, </span><span class="line" data-startTime="1024">it's pretty much a </span><span class="line" data-startTime="1024">requirement that you </span><span class="line" data-startTime="1027">render that initial </span><span class="line" data-startTime="1027">view server-side. </span> <span class="line" data-startTime="1030">So Twitter wasn't </span><span class="line" data-startTime="1030">the only organization </span><span class="line" data-startTime="1033">to come to this conclusion. </span> <span class="line" data-startTime="1034">Airbnb had a very similar </span><span class="line" data-startTime="1034">conclusion in a blog post </span><span class="line" data-startTime="1037">earlier this year. </span> <span class="line" data-startTime="1038">And they said under </span><span class="line" data-startTime="1038">their old design, </span><span class="line" data-startTime="1040">the external </span><span class="line" data-startTime="1040">JavaScript files had </span><span class="line" data-startTime="1041">to download, </span><span class="line" data-startTime="1041">evaluate, and execute. </span> <span class="line" data-startTime="1047">Only then would </span><span class="line" data-startTime="1047">the app discover, </span><span class="line" data-startTime="1048">oh, the user's intent was </span><span class="line" data-startTime="1048">to do x, who would call up </span><span class="line" data-startTime="1051">the API, which was an </span><span class="line" data-startTime="1051">additional network request, </span><span class="line" data-startTime="1053">that became part of that </span><span class="line" data-startTime="1053">critical rendering path. </span> <span class="line" data-startTime="1056">Here we are in a </span><span class="line" data-startTime="1056">mobile connection, </span><span class="line" data-startTime="1057">which has really high latency. </span></p>

<p><span class="line" data-startTime="1060">Which led to, for them, a </span><span class="line" data-startTime="1060">time to content &mdash; the time </span><span class="line" data-startTime="1062">until the user could get the </span><span class="line" data-startTime="1062">content that they wanted &mdash; </span><span class="line" data-startTime="1065">of upwards of 10 </span><span class="line" data-startTime="1065">seconds, in bad cases. </span> <span class="line" data-startTime="1068">So then they switched to </span><span class="line" data-startTime="1068">server-side rendering &mdash; </span><span class="line" data-startTime="1070">which, by the way, they open </span><span class="line" data-startTime="1070">sourced the infrastructure they </span><span class="line" data-startTime="1073">used for this, so it's worth </span><span class="line" data-startTime="1073">a look at this blog post. </span> <span class="line" data-startTime="1076">When they moved to serving the </span><span class="line" data-startTime="1076">initial view as HTML generated </span><span class="line" data-startTime="1080">on the server, it felt </span><span class="line" data-startTime="1080">five times faster. </span> <span class="line" data-startTime="1082">So similar conclusion, right? </span><span class="line" data-startTime="1083">Twitter &mdash; 1/5. </span></p>

<p><span class="line" data-startTime="1085">Here, Airbnb &mdash; </span><span class="line" data-startTime="1085">five times faster. </span> <span class="line" data-startTime="1089">So in my opinion, if you </span><span class="line" data-startTime="1089">want to deliver a truly </span><span class="line" data-startTime="1091">instant experience &mdash; </span><span class="line" data-startTime="1091">and there's a trade off. </span> <span class="line" data-startTime="1096">So if you want to deliver </span><span class="line" data-startTime="1096">that experience on mobile, </span><span class="line" data-startTime="1098">you really need </span><span class="line" data-startTime="1098">to be server-side </span><span class="line" data-startTime="1099">rendering that initial view. </span> <span class="line" data-startTime="1100">Loading JavaScript to create </span><span class="line" data-startTime="1100">the initial presentation </span><span class="line" data-startTime="1103">is just going to be </span><span class="line" data-startTime="1103">too slow on mobile </span><span class="line" data-startTime="1104">for it to be an </span><span class="line" data-startTime="1104">instant experience. </span> <span class="line" data-startTime="1106">And we saw Twitter and Airbnb </span><span class="line" data-startTime="1106">both had really dramatic speed </span><span class="line" data-startTime="1112">reductions as a result of </span><span class="line" data-startTime="1112">adopting this technique. </span></p>

<p><span class="line" data-startTime="1117">So I would say, when choosing </span><span class="line" data-startTime="1117">a JavaScript framework, </span><span class="line" data-startTime="1119">you want to look for a </span><span class="line" data-startTime="1119">framework ideally that </span><span class="line" data-startTime="1121">supports server-side rendering. </span> <span class="line" data-startTime="1125">Airbnb talked about the </span><span class="line" data-startTime="1125">one they open source. </span> <span class="line" data-startTime="1127">Not all the JavaScript </span><span class="line" data-startTime="1127">frameworks out </span><span class="line" data-startTime="1128">there today do support this, </span><span class="line" data-startTime="1128">but if you're using one today </span><span class="line" data-startTime="1131">that you do like that doesn't </span><span class="line" data-startTime="1131">support server-side rendering, </span><span class="line" data-startTime="1133">you should push on </span><span class="line" data-startTime="1133">the development team </span><span class="line" data-startTime="1135">or pitch in and </span><span class="line" data-startTime="1135">help out to make it </span><span class="line" data-startTime="1137">easy to do that as part </span><span class="line" data-startTime="1137">of using that framework. </span> <span class="line" data-startTime="1140">So you can take advantage </span><span class="line" data-startTime="1140">of this automatically. </span> <span class="line" data-startTime="1144">So the third area I </span><span class="line" data-startTime="1144">want to talk about </span><span class="line" data-startTime="1148">is minimizing </span><span class="line" data-startTime="1148">render-blocking CSS. </span> <span class="line" data-startTime="1150">And I think this is the topic </span><span class="line" data-startTime="1150">we get the most questions on. </span> <span class="line" data-startTime="1155">So I'm going to go through a </span><span class="line" data-startTime="1155">couple common questions here. </span></p>

<p><span class="line" data-startTime="1158">The first of which, people </span><span class="line" data-startTime="1158">say, well what do you mean CSS </span><span class="line" data-startTime="1160">is blocking? </span><span class="line" data-startTime="1161">Why is this part of this </span><span class="line" data-startTime="1161">blocking critical render path? </span><span class="line" data-startTime="1163">JavaScript blocks, yes, but </span><span class="line" data-startTime="1163">what do you mean CSS blocks? </span><span class="line" data-startTime="1167">And it's correct that JavaScript </span><span class="line" data-startTime="1167">blocks DOM tree construction. </span> <span class="line" data-startTime="1171">JavaScript blocks the parser. </span> <span class="line" data-startTime="1173">But style sheets block </span><span class="line" data-startTime="1173">render tree construction. </span> <span class="line" data-startTime="1176">So ultimately, in order </span><span class="line" data-startTime="1176">to lay out in paint, </span><span class="line" data-startTime="1179">we need the style sheet </span><span class="line" data-startTime="1179">to have finished loading. </span> <span class="line" data-startTime="1181">And what your users </span><span class="line" data-startTime="1181">care about is content </span><span class="line" data-startTime="1183">painted to the screen. </span></p>

<p><span class="line" data-startTime="1184">So for them, JavaScript </span><span class="line" data-startTime="1184">is &mdash; I'm sorry, </span><span class="line" data-startTime="1187">style sheets are </span><span class="line" data-startTime="1187">render-blocking. </span> <span class="line" data-startTime="1189">So it's important to </span><span class="line" data-startTime="1189">keep this in mind. </span> <span class="line" data-startTime="1191">If you load a large style </span><span class="line" data-startTime="1191">sheet in the head, that's </span><span class="line" data-startTime="1193">going to delay the time it takes </span><span class="line" data-startTime="1193">to paint content to the screen. </span> <span class="line" data-startTime="1198">So CSS is render-blocking. </span> <span class="line" data-startTime="1204">So what's critical CSS? </span><span class="line" data-startTime="1205">What is this? </span><span class="line" data-startTime="1206">We talk about this </span><span class="line" data-startTime="1206">concept of critical CSS. </span> <span class="line" data-startTime="1208">You may have heard, </span><span class="line" data-startTime="1208">it sort of goes along </span><span class="line" data-startTime="1210">with the critical </span><span class="line" data-startTime="1210">rendering path. </span> <span class="line" data-startTime="1212">And how do I identify </span><span class="line" data-startTime="1212">my critical CSS? </span><span class="line" data-startTime="1215">So critical CSS you can </span><span class="line" data-startTime="1215">think of as the minimal CSS </span><span class="line" data-startTime="1219">you need to actually </span><span class="line" data-startTime="1219">position and style content </span><span class="line" data-startTime="1221">in the initial view of your app. </span> <span class="line" data-startTime="1223">So everything you </span><span class="line" data-startTime="1223">need to present </span><span class="line" data-startTime="1225">that flash of unstyled style </span><span class="line" data-startTime="1225">content for the content </span><span class="line" data-startTime="1229">that you display </span><span class="line" data-startTime="1229">initially to the user. </span> <span class="line" data-startTime="1230">And the idea here </span><span class="line" data-startTime="1230">is that because we </span><span class="line" data-startTime="1233">know CSS is </span><span class="line" data-startTime="1233">render-blocking, we want </span><span class="line" data-startTime="1235">to minimize the amount of CSS </span><span class="line" data-startTime="1235">that we serve up to the user, </span><span class="line" data-startTime="1238">in order to minimize the </span><span class="line" data-startTime="1238">size of the critical path </span><span class="line" data-startTime="1241">and get the content to display </span><span class="line" data-startTime="1241">as quickly as possible. </span></p>

<p><span class="line" data-startTime="1244">So identifying critical </span><span class="line" data-startTime="1244">CSS &mdash; we'll talk about this. </span> <span class="line" data-startTime="1248">People often ask the question, </span><span class="line" data-startTime="1248">well I have all this CSS. </span> <span class="line" data-startTime="1251">I need all of it. </span> <span class="line" data-startTime="1252">What do you mean critical? </span><span class="line" data-startTime="1254">How do I know what's </span><span class="line" data-startTime="1254">critical and what's not? </span><span class="line" data-startTime="1256">So again, critical CSS is that </span><span class="line" data-startTime="1256">needed to position and style </span><span class="line" data-startTime="1259">content in the initial view. </span> <span class="line" data-startTime="1261">So imagine we have </span><span class="line" data-startTime="1261">this alert CSS rule, </span><span class="line" data-startTime="1264">and then we've got this markup </span><span class="line" data-startTime="1264">served up in the initial HTML. </span> <span class="line" data-startTime="1267">So it's going to be </span><span class="line" data-startTime="1267">visible in the initial view </span><span class="line" data-startTime="1270">that references that rule. </span> <span class="line" data-startTime="1273">We expect it to look like </span><span class="line" data-startTime="1273">this on the page initially. </span> <span class="line" data-startTime="1276">We expect it to have </span><span class="line" data-startTime="1276">their proper stylings. </span> <span class="line" data-startTime="1279">A good way to ask yourself, </span><span class="line" data-startTime="1279">is this critical CSS or not, </span><span class="line" data-startTime="1281">is to ask well, if I took </span><span class="line" data-startTime="1281">this rule out of the payload, </span><span class="line" data-startTime="1284">would my initial view with the </span><span class="line" data-startTime="1284">content I serve to the user </span><span class="line" data-startTime="1287">initially look correctly? </span><span class="line" data-startTime="1289">And in this case obviously, </span><span class="line" data-startTime="1289">if we took that rule out, </span><span class="line" data-startTime="1292">it would get the </span><span class="line" data-startTime="1292">default stylings </span><span class="line" data-startTime="1294">and look totally wrong. </span> <span class="line" data-startTime="1295">So clearly, we need this </span><span class="line" data-startTime="1295">CSS to style content </span><span class="line" data-startTime="1300">in the initial view, and </span><span class="line" data-startTime="1300">thus it is critical CSS. </span></p>

<p><span class="line" data-startTime="1304">And we want to </span><span class="line" data-startTime="1304">serve it up early, </span><span class="line" data-startTime="1305">and in a render-blocking way. </span> <span class="line" data-startTime="1310">So imagine we changed </span><span class="line" data-startTime="1310">our HTML markup there. </span> <span class="line" data-startTime="1313">So you can see before it </span><span class="line" data-startTime="1313">was . </span> <span class="line" data-startTime="1316">Now we decide, OK, </span><span class="line" data-startTime="1316">we don't really </span><span class="line" data-startTime="1317">want to mark hello </span><span class="line" data-startTime="1317">world as an alert. </span> <span class="line" data-startTime="1319">It's just a normal </span><span class="line" data-startTime="1319">snippet of text. </span> <span class="line" data-startTime="1321">We want it to be styled as such. </span> <span class="line" data-startTime="1325">So imagine, though, that we </span><span class="line" data-startTime="1325">do use the alert class later </span><span class="line" data-startTime="1327">in the app. </span> <span class="line" data-startTime="1328">Like imagine your user is </span><span class="line" data-startTime="1328">interacting with the app. </span></p>

<p><span class="line" data-startTime="1332">They try to upload a video. </span> <span class="line" data-startTime="1333">It fails. </span> <span class="line" data-startTime="1334">You want to show an </span><span class="line" data-startTime="1334">alert at that time. </span> <span class="line" data-startTime="1335">So we do need it, but </span><span class="line" data-startTime="1335">we don't need this rule </span><span class="line" data-startTime="1337">as part of the initial view. </span> <span class="line" data-startTime="1339">At that point, it's not </span><span class="line" data-startTime="1339">part of the initial view, </span><span class="line" data-startTime="1342">and so it's no longer </span><span class="line" data-startTime="1342">critical and you </span><span class="line" data-startTime="1344">may want to think about loading </span><span class="line" data-startTime="1344">that later in the app life </span><span class="line" data-startTime="1347">cycle, in a way that doesn't </span><span class="line" data-startTime="1347">block the initial view. </span> <span class="line" data-startTime="1352">So one more bit. </span> <span class="line" data-startTime="1353">I think this is </span><span class="line" data-startTime="1353">actually, probably &mdash; </span><span class="line" data-startTime="1354">this is somewhat subtle, but </span><span class="line" data-startTime="1354">probably the most important </span><span class="line" data-startTime="1356">thing we talk </span><span class="line" data-startTime="1356">about critical CSS. </span> <span class="line" data-startTime="1360">The critical CSS is that the CSS </span><span class="line" data-startTime="1360">is needed to position and style </span><span class="line" data-startTime="1362">the content in the initial view. </span></p>

<p><span class="line" data-startTime="1364">So oftentimes, we inline </span><span class="line" data-startTime="1364">data URIs into our CSS, </span><span class="line" data-startTime="1369">the goal being OK, let's </span><span class="line" data-startTime="1369">reduce the number of requests </span><span class="line" data-startTime="1371">that my page makes. </span> <span class="line" data-startTime="1372">I can serve up the </span><span class="line" data-startTime="1372">image separately, </span><span class="line" data-startTime="1374">or I can inline </span><span class="line" data-startTime="1374">right into my CSS. </span> <span class="line" data-startTime="1377">And interestingly, what we are </span><span class="line" data-startTime="1377">doing when we inline these data </span><span class="line" data-startTime="1382">URIs for images, </span><span class="line" data-startTime="1382">is we're basically </span><span class="line" data-startTime="1384">promoting the image from </span><span class="line" data-startTime="1384">being non-render-blocking, </span><span class="line" data-startTime="1387">not part of the critical </span><span class="line" data-startTime="1387">render path, because images </span><span class="line" data-startTime="1389">by default &mdash; they obviously </span><span class="line" data-startTime="1389">need to download the image </span><span class="line" data-startTime="1392">to render the image itself &mdash; </span><span class="line" data-startTime="1392">but images don't block rendering </span><span class="line" data-startTime="1395">of other content on the screen. </span></p>

<p><span class="line" data-startTime="1397">When we inline it </span><span class="line" data-startTime="1397">as a data URI here, </span><span class="line" data-startTime="1399">we basically promoted it </span><span class="line" data-startTime="1399">to being render-blocking, </span><span class="line" data-startTime="1402">to being part of the </span><span class="line" data-startTime="1402">critical rendering path, </span><span class="line" data-startTime="1404">and we're making that critical </span><span class="line" data-startTime="1404">rendering path that much </span><span class="line" data-startTime="1406">longer. </span> <span class="line" data-startTime="1407">And so data URIs too, they </span><span class="line" data-startTime="1407">tend to be quite big, right? </span><span class="line" data-startTime="1411">So here's our markup. </span> <span class="line" data-startTime="1415">So if you look at </span><span class="line" data-startTime="1415">your CSS, and you're </span><span class="line" data-startTime="1417">using this technique </span><span class="line" data-startTime="1417">lots of sites do, </span><span class="line" data-startTime="1418">you'll notice </span><span class="line" data-startTime="1418">probably the majority </span><span class="line" data-startTime="1419">of bites in your CSS </span><span class="line" data-startTime="1419">files may actually </span><span class="line" data-startTime="1421">be from these inline data URIs. </span> <span class="line" data-startTime="1423">And what you're doing is, you're </span><span class="line" data-startTime="1423">increasing that critical path </span><span class="line" data-startTime="1425">length pretty significantly, </span><span class="line" data-startTime="1425">and actually causing users </span><span class="line" data-startTime="1428">to have to wait to </span><span class="line" data-startTime="1428">see any content at all </span><span class="line" data-startTime="1430">on the screen as a result. </span></p>

<p><span class="line" data-startTime="1432">So you'll actually render the </span><span class="line" data-startTime="1432">other content on the screen </span><span class="line" data-startTime="1437">more quickly if you just </span><span class="line" data-startTime="1437">switch back to that CSS sprite </span><span class="line" data-startTime="1440">with the external </span><span class="line" data-startTime="1440">file reference, </span><span class="line" data-startTime="1441">or, if you're using something </span><span class="line" data-startTime="1441">like [INAUDIBLE] where spriting </span><span class="line" data-startTime="1444">doesn't really bring </span><span class="line" data-startTime="1444">you any benefit, </span><span class="line" data-startTime="1446">just keeping each </span><span class="line" data-startTime="1446">image asset separate, </span><span class="line" data-startTime="1449">reducing the size </span><span class="line" data-startTime="1449">of the CSS, reducing </span><span class="line" data-startTime="1451">the size of your </span><span class="line" data-startTime="1451">critical rendering path, </span><span class="line" data-startTime="1453">and making the page load </span><span class="line" data-startTime="1453">that much more quickly. </span> <span class="line" data-startTime="1457">This is pretty easy to test out. </span> <span class="line" data-startTime="1459">Create a simple page. </span> <span class="line" data-startTime="1460">Inline a bunch of data </span><span class="line" data-startTime="1460">URIs and a style sheet. </span> <span class="line" data-startTime="1463">Create a second </span><span class="line" data-startTime="1463">version that page. </span> <span class="line" data-startTime="1465">Use the technique </span><span class="line" data-startTime="1465">here where you've </span><span class="line" data-startTime="1467">got a separate image asset. </span></p>

<p><span class="line" data-startTime="1468">Make sure there's some </span><span class="line" data-startTime="1468">non-image content on the page, </span><span class="line" data-startTime="1471">so put some text in </span><span class="line" data-startTime="1471">there, whatever it may be. </span> <span class="line" data-startTime="1473">And then compare the </span><span class="line" data-startTime="1473">two in web page test. </span> <span class="line" data-startTime="1475">Do a video comparison </span><span class="line" data-startTime="1475">on a 3G network. </span> <span class="line" data-startTime="1476">And you'll see that when </span><span class="line" data-startTime="1476">you inline data URIs </span><span class="line" data-startTime="1479">into your style </span><span class="line" data-startTime="1479">sheet, you're blocking </span><span class="line" data-startTime="1480">rendering of all the </span><span class="line" data-startTime="1480">content on the page. </span> <span class="line" data-startTime="1482">You're blocking the </span><span class="line" data-startTime="1482">text, whatever it may be. </span> <span class="line" data-startTime="1486">So on mobile, again where </span><span class="line" data-startTime="1486">downloading additional content </span><span class="line" data-startTime="1489">in the critical rendering </span><span class="line" data-startTime="1489">path is expensive, </span><span class="line" data-startTime="1493">I encourage people to </span><span class="line" data-startTime="1493">not take that approach &mdash; </span><span class="line" data-startTime="1495">except for maybe </span><span class="line" data-startTime="1495">very small data URIs. </span></p>

<p><span class="line" data-startTime="1498">I would say that large data URIs </span><span class="line" data-startTime="1498">inlined in render-blocking CSS </span><span class="line" data-startTime="1502">are actually harmful </span><span class="line" data-startTime="1502">for render performance, </span><span class="line" data-startTime="1504">and I would avoid </span><span class="line" data-startTime="1504">using that approach. </span> <span class="line" data-startTime="1511">So then a couple more questions. </span> <span class="line" data-startTime="1512">OK, so I've identified </span><span class="line" data-startTime="1512">my critical CSS. </span> <span class="line" data-startTime="1515">I've removed my data URIS. </span> <span class="line" data-startTime="1516">I made it nice and small. </span> <span class="line" data-startTime="1517">How should I load </span><span class="line" data-startTime="1517">that critical CSS? </span><span class="line" data-startTime="1520">So there's two ways </span><span class="line" data-startTime="1520">to go about this. </span> <span class="line" data-startTime="1522">In PageSpeed </span><span class="line" data-startTime="1522">Insights we actually </span><span class="line" data-startTime="1524">in line the critical CSS </span><span class="line" data-startTime="1524">as a style block in line, </span><span class="line" data-startTime="1528">keeping that critical rendering </span><span class="line" data-startTime="1528">path as short as we can. </span> <span class="line" data-startTime="1530">We don't want to </span><span class="line" data-startTime="1530">go back to network </span><span class="line" data-startTime="1532">to download an external </span><span class="line" data-startTime="1532">style sheet, in our case, </span><span class="line" data-startTime="1534">because that incurs additional </span><span class="line" data-startTime="1534">network round trips, which </span><span class="line" data-startTime="1537">can add anywhere from 500 </span><span class="line" data-startTime="1537">millis to maybe a second, </span><span class="line" data-startTime="1540">depending on how </span><span class="line" data-startTime="1540">it's loaded, of time </span><span class="line" data-startTime="1542">the user is staring </span><span class="line" data-startTime="1542">at a blank screen. </span></p>

<p><span class="line" data-startTime="1544">So for us, we felt like the </span><span class="line" data-startTime="1544">best approach was to inline. </span> <span class="line" data-startTime="1547">The CSS needed to style </span><span class="line" data-startTime="1547">the initial view directly </span><span class="line" data-startTime="1550">in our HTML payload. </span> <span class="line" data-startTime="1552">But I wouldn't say that's </span><span class="line" data-startTime="1552">necessarily a requirement. </span> <span class="line" data-startTime="1555">I think it's still </span><span class="line" data-startTime="1555">perfectly reasonable </span><span class="line" data-startTime="1556">to load that critical </span><span class="line" data-startTime="1556">CSS resource, as long </span><span class="line" data-startTime="1560">as the critical resource </span><span class="line" data-startTime="1560">is small, in the head, </span><span class="line" data-startTime="1563">as an external resource. </span> <span class="line" data-startTime="1564">The page will be </span><span class="line" data-startTime="1564">slower for people </span><span class="line" data-startTime="1565">who don't have the </span><span class="line" data-startTime="1565">resource in cache, </span><span class="line" data-startTime="1567">because now they </span><span class="line" data-startTime="1567">have to go to network </span><span class="line" data-startTime="1568">to download that </span><span class="line" data-startTime="1568">additional resource. </span> <span class="line" data-startTime="1572">But you've got some </span><span class="line" data-startTime="1572">other benefits. </span></p>

<p><span class="line" data-startTime="1573">You're reducing bytes sent </span><span class="line" data-startTime="1573">on the wire for repeat views, </span><span class="line" data-startTime="1576">because once it's in </span><span class="line" data-startTime="1576">cache the user doesn't </span><span class="line" data-startTime="1577">have to download it again. </span> <span class="line" data-startTime="1579">You may introduce a faster </span><span class="line" data-startTime="1579">full cache experience </span><span class="line" data-startTime="1582">for repeat view. </span> <span class="line" data-startTime="1583">It really depends. </span> <span class="line" data-startTime="1584">It's not guaranteed </span><span class="line" data-startTime="1584">by any means. </span> <span class="line" data-startTime="1585">It's sort of a little </span><span class="line" data-startTime="1585">counter intuitive. </span> <span class="line" data-startTime="1587">You would think, well the </span><span class="line" data-startTime="1587">HTML payload is smaller, </span><span class="line" data-startTime="1589">so the page should load faster. </span> <span class="line" data-startTime="1591">But it actually depends, it's </span><span class="line" data-startTime="1591">not necessarily the case. </span> <span class="line" data-startTime="1595">But in any case, either of </span><span class="line" data-startTime="1595">these approaches is reasonable. </span> <span class="line" data-startTime="1597">And it really just depends. </span> <span class="line" data-startTime="1598">You're making a trade off. </span></p>

<p><span class="line" data-startTime="1599">Do I want the </span><span class="line" data-startTime="1599">fastest performance? </span><span class="line" data-startTime="1602">In which case, you </span><span class="line" data-startTime="1602">want to inline. </span> <span class="line" data-startTime="1603">Or do I want a </span><span class="line" data-startTime="1603">little bit, perhaps, </span><span class="line" data-startTime="1605">more maintainable approach? </span><span class="line" data-startTime="1607">In which case you </span><span class="line" data-startTime="1607">could keep it external, </span><span class="line" data-startTime="1609">and pay a little bit of a </span><span class="line" data-startTime="1609">performance penalty for that. </span> <span class="line" data-startTime="1614">So things get kind of fuzzier </span><span class="line" data-startTime="1614">the further along we go here. </span> <span class="line" data-startTime="1618">So the last bit, once we've </span><span class="line" data-startTime="1618">loaded our critical CSS &mdash; now </span><span class="line" data-startTime="1622">we've got this other CSS </span><span class="line" data-startTime="1622">needed to style other parts </span><span class="line" data-startTime="1624">of our app &mdash; how do we </span><span class="line" data-startTime="1624">load that in a way that </span><span class="line" data-startTime="1626">doesn't block </span><span class="line" data-startTime="1626">rendering of the page? </span><span class="line" data-startTime="1629">Unfortunately, today there's not </span><span class="line" data-startTime="1629">a great simple, straightforward </span><span class="line" data-startTime="1635">technique. </span> <span class="line" data-startTime="1635">Like we have with </span><span class="line" data-startTime="1635">script, we have async. </span></p>

<p><span class="line" data-startTime="1637">It's a really easy, first </span><span class="line" data-startTime="1637">class feature of the platform. </span> <span class="line" data-startTime="1640">The same does not </span><span class="line" data-startTime="1640">exist for style sheet. </span> <span class="line" data-startTime="1642">Any style sheet found in </span><span class="line" data-startTime="1642">the document by the parser </span><span class="line" data-startTime="1644">will cause the rendering </span><span class="line" data-startTime="1644">engine to say, OK, </span><span class="line" data-startTime="1648">I'm going to wait and </span><span class="line" data-startTime="1648">not paint anything </span><span class="line" data-startTime="1650">until I finished fully </span><span class="line" data-startTime="1650">downloading this style sheet. </span> <span class="line" data-startTime="1652">So you can't just throw link </span><span class="line" data-startTime="1652">rel stylesheet href equals </span><span class="line" data-startTime="1655">noncritical CSS in the </span><span class="line" data-startTime="1655">footer of your HTML. </span> <span class="line" data-startTime="1658">The parser will find that. </span> <span class="line" data-startTime="1659">And as soon as it does, </span><span class="line" data-startTime="1659">if it hasn't painted </span><span class="line" data-startTime="1661">the content above yet, </span><span class="line" data-startTime="1661">it will say, whoa, </span><span class="line" data-startTime="1662">I'm not going to paint anything, </span><span class="line" data-startTime="1662">even the markup above that, </span><span class="line" data-startTime="1666">until that finishes downloading. </span> <span class="line" data-startTime="1667">So you have to be careful here. </span> <span class="line" data-startTime="1671">So what we want is this </span><span class="line" data-startTime="1671">lazy load attribute. </span> <span class="line" data-startTime="1672">And that's coming soon. </span> <span class="line" data-startTime="1674">Some Chrome engineers, </span><span class="line" data-startTime="1674">IE engineers </span><span class="line" data-startTime="1676">are working together on a spec. </span> <span class="line" data-startTime="1677">And what that says basically &mdash; </span><span class="line" data-startTime="1677">it's similar to async &mdash; </span><span class="line" data-startTime="1680">and it basically says, </span><span class="line" data-startTime="1680">I need this resource. </span> <span class="line" data-startTime="1682">It shouldn't block rendering. </span></p>

<p><span class="line" data-startTime="1684">It shouldn't block onload. </span> <span class="line" data-startTime="1685">Load it, and when it's </span><span class="line" data-startTime="1685">available, I'll make use of it. </span> <span class="line" data-startTime="1688">In the meantime, we </span><span class="line" data-startTime="1688">don't have that today. </span> <span class="line" data-startTime="1689">It's coming. </span> <span class="line" data-startTime="1690">It's being speced. </span> <span class="line" data-startTime="1691">There are a couple ways </span><span class="line" data-startTime="1691">you can work around this. </span> <span class="line" data-startTime="1697">It's listed here. </span> <span class="line" data-startTime="1697">requestAnimationFrame, </span><span class="line" data-startTime="1699">so you wait for the first paint. </span> <span class="line" data-startTime="1701">You could load the </span><span class="line" data-startTime="1701">resource and hidden iframe. </span> <span class="line" data-startTime="1703">You could actually </span><span class="line" data-startTime="1703">load it as JavaScript. </span> <span class="line" data-startTime="1705">I've seen people do this. </span> <span class="line" data-startTime="1706">JavaScript has async, so you </span><span class="line" data-startTime="1706">could load a CSS resource </span><span class="line" data-startTime="1709">to JavaScript. </span> <span class="line" data-startTime="1710">As I say each of these, part </span><span class="line" data-startTime="1710">of me is feeling not great. </span> <span class="line" data-startTime="1715">This is really not </span><span class="line" data-startTime="1715">the kind of APIs </span><span class="line" data-startTime="1719">we want for this kind of thing. </span></p>

<p><span class="line" data-startTime="1721">But fortunately, the lazy </span><span class="line" data-startTime="1721">load attribute is coming, </span><span class="line" data-startTime="1724">and that will be the right thing </span><span class="line" data-startTime="1724">to use once that's shipped. </span> <span class="line" data-startTime="1730">So some high level </span><span class="line" data-startTime="1730">recommendations </span><span class="line" data-startTime="1732">for render-blocking CSS. </span> <span class="line" data-startTime="1735">How are we doing on time? </span><span class="line" data-startTime="1737">A couple minutes. </span> <span class="line" data-startTime="1739">Avoid inlining data URIs. </span> <span class="line" data-startTime="1742">Keep them external. </span> <span class="line" data-startTime="1743">Keep the CSS as </span><span class="line" data-startTime="1743">small as possible. </span> <span class="line" data-startTime="1746">Critical CSS, what that </span><span class="line" data-startTime="1746">is, keeping that in mind, </span><span class="line" data-startTime="1748">and making sure you're focusing </span><span class="line" data-startTime="1748">on only delivering that. </span> <span class="line" data-startTime="1751">But all this said &mdash; </span><span class="line" data-startTime="1751">and if you're </span><span class="line" data-startTime="1752">hearing me talk about </span><span class="line" data-startTime="1752">this critical CSS </span><span class="line" data-startTime="1754">and oh, I have to load </span><span class="line" data-startTime="1754">some early and some late, </span><span class="line" data-startTime="1756">and that sounds like </span><span class="line" data-startTime="1756">a lot of overhead &mdash; </span><span class="line" data-startTime="1759">the good news is if your </span><span class="line" data-startTime="1759">total CSS is reasonably small, </span><span class="line" data-startTime="1762">like if it's under </span><span class="line" data-startTime="1762">say 15k compressed, </span><span class="line" data-startTime="1764">which might mean </span><span class="line" data-startTime="1764">45km compressed, </span><span class="line" data-startTime="1766">it's probably small </span><span class="line" data-startTime="1766">enough that you can just </span><span class="line" data-startTime="1768">treat it all as critical. </span> <span class="line" data-startTime="1769">Just don't worry about </span><span class="line" data-startTime="1769">partitioning out. </span></p>

<p><span class="line" data-startTime="1772">It's only when it </span><span class="line" data-startTime="1772">becomes really big </span><span class="line" data-startTime="1773">that you don't want </span><span class="line" data-startTime="1773">to load all of it </span><span class="line" data-startTime="1775">in a way that blocks rendering </span><span class="line" data-startTime="1775">anything at all to the screen. </span> <span class="line" data-startTime="1778">So the common case, I hope, is </span><span class="line" data-startTime="1778">that your CSS is already small, </span><span class="line" data-startTime="1784">and you just load that </span><span class="line" data-startTime="1784">up front and don't </span><span class="line" data-startTime="1785">worry about this concept </span><span class="line" data-startTime="1785">of noncritical CSS. </span> <span class="line" data-startTime="1788">If you do have a </span><span class="line" data-startTime="1788">lot of CSS, you want </span><span class="line" data-startTime="1790">to load that in a </span><span class="line" data-startTime="1790">render-blocking manner &mdash; </span><span class="line" data-startTime="1791">we talked about the two </span><span class="line" data-startTime="1791">techniques for that &mdash; </span><span class="line" data-startTime="1793">and then load the remaining </span><span class="line" data-startTime="1793">CSS in that non-blocking manner </span><span class="line" data-startTime="1796">using, for the time being, one </span><span class="line" data-startTime="1796">of those requestAnimationFrame </span><span class="line" data-startTime="1799">or whatever it may be </span><span class="line" data-startTime="1799">techniques, longer term using </span><span class="line" data-startTime="1801">that lazy load attribute. </span> <span class="line" data-startTime="1804">So just to summarize really high </span><span class="line" data-startTime="1804">level, the things that we found </span><span class="line" data-startTime="1808">were really important. </span> <span class="line" data-startTime="1809">Eliminate render-block </span><span class="line" data-startTime="1809">in JavaScript. </span></p>

<p><span class="line" data-startTime="1812">Load JavaScript asynchronously. </span> <span class="line" data-startTime="1813">Get it out of the </span><span class="line" data-startTime="1813">critical rendering path. </span> <span class="line" data-startTime="1815">So design your apps </span><span class="line" data-startTime="1815">with that in mind. </span> <span class="line" data-startTime="1819">Don't depend JavaScript </span><span class="line" data-startTime="1819">having to load synchronously </span><span class="line" data-startTime="1821">in order to render your page. </span> <span class="line" data-startTime="1822">And along those lines, </span><span class="line" data-startTime="1822">render the initial view </span><span class="line" data-startTime="1825">to HTML on the server. </span> <span class="line" data-startTime="1827">So don't use JavaScript </span><span class="line" data-startTime="1827">client-side to render </span><span class="line" data-startTime="1829">the initial view. </span> <span class="line" data-startTime="1831">It's an inherently slow process. </span> <span class="line" data-startTime="1832">We saw Twitter had performance </span><span class="line" data-startTime="1832">problems with this, Airbnb, </span><span class="line" data-startTime="1835">my team had the same issues. </span> <span class="line" data-startTime="1837">And then finally, </span><span class="line" data-startTime="1837">serve up as little CSS </span><span class="line" data-startTime="1840">as you need to render </span><span class="line" data-startTime="1840">the initial view. </span> <span class="line" data-startTime="1842">Be mindful of just how </span><span class="line" data-startTime="1842">much you're serving. </span> <span class="line" data-startTime="1846">And largely, you </span><span class="line" data-startTime="1846">can accomplish that </span><span class="line" data-startTime="1848">by just not inlining large </span><span class="line" data-startTime="1848">data URIs in your CSS. </span></p>

<p><span class="line" data-startTime="1850">I think if we stop </span><span class="line" data-startTime="1850">doing that, I think </span><span class="line" data-startTime="1852">our CSS size, for the most </span><span class="line" data-startTime="1852">part, will become manageable, </span><span class="line" data-startTime="1855">and will be reasonable to </span><span class="line" data-startTime="1855">load in a render-blocking way. </span> <span class="line" data-startTime="1859">So that's everything. </span></p></div>