<p class="speaker"><span class="line" data-starttime="3"><span class="speakerName">Michael Bolin</span>: Hello. </span> <span class="line" data-startTime="3">Good afternoon. </span> <span class="line" data-startTime="4">Welcome to, I guess, </span><span class="line" data-startTime="4">what is the last </span><span class="line" data-startTime="5">session of Google I/O. </span> <span class="line" data-startTime="8">I'm here to talk to you about </span><span class="line" data-startTime="8">a topic that's near and dear </span><span class="line" data-startTime="11">to my heart, which is JavaScript </span><span class="line" data-startTime="11">programming in the </span><span class="line" data-startTime="13">large with Closure tools. </span> <span class="line" data-startTime="15">My name's Michael Bolin. </span> <span class="line" data-startTime="17">As you can see I have my </span><span class="line" data-startTime="17">SpeakerMeter URL up there if </span><span class="line" data-startTime="20">you want to give me feedback. </span> <span class="line" data-startTime="21">I do talk about Closure a bit, </span><span class="line" data-startTime="21">so feedback would be great. </span> <span class="line" data-startTime="25">But let's get started. </span> <span class="line" data-startTime="28">So first of all, something I </span><span class="line" data-startTime="28">would actually like to clarify </span><span class="line" data-startTime="31">is who am I and why did </span><span class="line" data-startTime="31">they let me up here? </span><span class="line" data-startTime="35">Because actually, I don't </span><span class="line" data-startTime="35">work at Google. </span> <span class="line" data-startTime="38">I used to work at Google. </span> <span class="line" data-startTime="39">And while I was there I worked </span><span class="line" data-startTime="39">on Google Calendar. </span></p>

<p><span class="line" data-startTime="42">I did a lot of the front-end </span><span class="line" data-startTime="42">development for that. </span> <span class="line" data-startTime="44">And then also then the majority </span><span class="line" data-startTime="44">of the front-end </span><span class="line" data-startTime="46">development on Google Tasks. </span> <span class="line" data-startTime="49">And then post-Google I wrote </span><span class="line" data-startTime="49">a book called Closure:The </span><span class="line" data-startTime="52">Definitive Guide. </span> <span class="line" data-startTime="53">Maybe some you have it. </span> <span class="line" data-startTime="56">And basically around </span><span class="line" data-startTime="56">the time when &mdash; </span><span class="line" data-startTime="59">about a year and a half ago &mdash; </span><span class="line" data-startTime="59">when Google Open Sourced </span><span class="line" data-startTime="61">Closure, I just felt very </span><span class="line" data-startTime="61">strongly that this is a really </span><span class="line" data-startTime="64">important toolkit. </span> <span class="line" data-startTime="65">In terms of moving the web </span><span class="line" data-startTime="65">forward, in terms of enabling </span><span class="line" data-startTime="68">people to make really fast </span><span class="line" data-startTime="68">web applications. </span> <span class="line" data-startTime="72">And that's what makes the web </span><span class="line" data-startTime="72">better for everyone, when </span><span class="line" data-startTime="73">people can build higher </span><span class="line" data-startTime="73">quality applications. </span> <span class="line" data-startTime="77">So I've done a bit of work in </span><span class="line" data-startTime="77">the realm of doing some large </span><span class="line" data-startTime="80">JavaScript development. </span></p>

<p><span class="line" data-startTime="82">And that's what we're going </span><span class="line" data-startTime="82">to talk about today. </span> <span class="line" data-startTime="85">So first I should clarify &mdash; </span><span class="line" data-startTime="87">or at least give some sort of </span><span class="line" data-startTime="87">definition &mdash; for what I mean </span><span class="line" data-startTime="90">by programming in the large. </span> <span class="line" data-startTime="92">Just to throw out &mdash; </span><span class="line" data-startTime="92">I'm just going to make up some </span><span class="line" data-startTime="92">numbers &mdash; but more properties, </span><span class="line" data-startTime="96">let's say 30,000 </span><span class="line" data-startTime="96">lines of code. </span> <span class="line" data-startTime="97">Let's say that's programming </span><span class="line" data-startTime="97">in the large. </span> <span class="line" data-startTime="101">Another aspect is having </span><span class="line" data-startTime="101">a large team. </span> <span class="line" data-startTime="103">Once you have more people &mdash; </span><span class="line" data-startTime="104">because you need more people </span><span class="line" data-startTime="104">to build a bigger </span><span class="line" data-startTime="106">application &mdash; </span><span class="line" data-startTime="107">now you also have this </span><span class="line" data-startTime="107">communication overhead that </span><span class="line" data-startTime="109">you have to think about. </span></p>

<p><span class="line" data-startTime="110">I think that this is really </span><span class="line" data-startTime="110">important in terms of </span><span class="line" data-startTime="112">JavaScript because a lot of </span><span class="line" data-startTime="112">people are used to just </span><span class="line" data-startTime="115">copying and pasting some code </span><span class="line" data-startTime="115">they find on the web to </span><span class="line" data-startTime="118">decorate some page that they </span><span class="line" data-startTime="118">have and that's kind of what </span><span class="line" data-startTime="120">their impression of what </span><span class="line" data-startTime="120">JavaScript programming is. </span> <span class="line" data-startTime="123">And they don't really have an </span><span class="line" data-startTime="123">idea of how to get to the 10 </span><span class="line" data-startTime="126">lines of code they copied to </span><span class="line" data-startTime="126">the 30,000-line JavaScript </span><span class="line" data-startTime="130">application. </span> <span class="line" data-startTime="132">And another aspect of this is </span><span class="line" data-startTime="132">a longer development cycle. </span> <span class="line" data-startTime="135">This is significant in terms </span><span class="line" data-startTime="135">of, if you work at a larger </span><span class="line" data-startTime="138">company people may roll </span><span class="line" data-startTime="138">on and off your team. </span> <span class="line" data-startTime="141">They're going to have to be able </span><span class="line" data-startTime="141">to pick up and dive into </span><span class="line" data-startTime="144">a large code base that they're </span><span class="line" data-startTime="144">not familiar with. </span></p>

<p><span class="line" data-startTime="146">Also over a six-month period, </span><span class="line" data-startTime="146">you, yourself, may not even </span><span class="line" data-startTime="150">remember what the code that </span><span class="line" data-startTime="150">you did six months ago. </span> <span class="line" data-startTime="152">So it needs to be organized. </span> <span class="line" data-startTime="155">You need to have some way of </span><span class="line" data-startTime="155">laying it out such that you </span><span class="line" data-startTime="157">can come back to it, anyone else </span><span class="line" data-startTime="157">can come into it because </span><span class="line" data-startTime="159">this is what's going to enable </span><span class="line" data-startTime="159">you to build more complex and </span><span class="line" data-startTime="163">interesting applications. </span> <span class="line" data-startTime="165">Not that everything needs </span><span class="line" data-startTime="165">to be complex. </span> <span class="line" data-startTime="167">Absolutely not. </span> <span class="line" data-startTime="168">But there's a certain class of </span><span class="line" data-startTime="168">applications that are really </span><span class="line" data-startTime="170">interesting that we want to </span><span class="line" data-startTime="170">see brought to the web. </span> <span class="line" data-startTime="173">And for that, it just takes a </span><span class="line" data-startTime="173">different, you need to take a </span><span class="line" data-startTime="176">different tack in terms of how </span><span class="line" data-startTime="176">you organize your team and </span><span class="line" data-startTime="179">organize your code to </span><span class="line" data-startTime="179">make sure you can </span><span class="line" data-startTime="181">make interesting progress. </span> <span class="line" data-startTime="182">So this the area that I'm </span><span class="line" data-startTime="182">calling JavaScript programming </span><span class="line" data-startTime="185">in the large. </span> <span class="line" data-startTime="185">And that's where, I think, </span><span class="line" data-startTime="185">Closure really fits in and </span><span class="line" data-startTime="188">speaks to that. </span></p>

<p><span class="line" data-startTime="190">So today if you wanted to </span><span class="line" data-startTime="190">build a rich internet </span><span class="line" data-startTime="192">application, or an RIA, a lot </span><span class="line" data-startTime="192">of these are thought of a </span><span class="line" data-startTime="196">single-page applications. </span> <span class="line" data-startTime="198">Such as Gmail and Calendar, </span><span class="line" data-startTime="198">where you go, you log in, you </span><span class="line" data-startTime="201">actually don't really reload </span><span class="line" data-startTime="201">the page or change URLs. </span> <span class="line" data-startTime="204">Maybe the fragment changes and </span><span class="line" data-startTime="204">it keeps track of your state. </span> <span class="line" data-startTime="206">But you load a large bundle of </span><span class="line" data-startTime="206">JavaScript at the beginning. </span> <span class="line" data-startTime="211">Perhaps you navigate through </span><span class="line" data-startTime="211">the app, exercise certain </span><span class="line" data-startTime="213">features, more JavaScript </span><span class="line" data-startTime="213">gets loaded. </span> <span class="line" data-startTime="215">But basically you're using </span><span class="line" data-startTime="215">this one thing where </span><span class="line" data-startTime="218">everything is in memory </span><span class="line" data-startTime="218">on that single page. </span></p>

<p><span class="line" data-startTime="221">So if you wanted to create </span><span class="line" data-startTime="221">this rich experience, </span><span class="line" data-startTime="224">something that's more akin to a </span><span class="line" data-startTime="224">desktop app, obviously we're </span><span class="line" data-startTime="227">doing a lot of stuff with </span><span class="line" data-startTime="227">HTML5 right now. </span> <span class="line" data-startTime="230">But let's think about what some </span><span class="line" data-startTime="230">of your options would be. </span> <span class="line" data-startTime="233">So the first one is use a </span><span class="line" data-startTime="233">plugin, such as Java or Flash. </span> <span class="line" data-startTime="236">Some people may remember Java </span><span class="line" data-startTime="236">applets, which were going to </span><span class="line" data-startTime="240">be the greatest thing and they </span><span class="line" data-startTime="240">were going to save the web and </span><span class="line" data-startTime="242">we were going to be able to </span><span class="line" data-startTime="242">write all our things in Swing </span><span class="line" data-startTime="244">and they were all going to be </span><span class="line" data-startTime="244">purple and gray and it was </span><span class="line" data-startTime="246">going to be great. </span></p>

<p><span class="line" data-startTime="248">But the problem was, it took </span><span class="line" data-startTime="248">like half an hour or something </span><span class="line" data-startTime="251">for that Java plugin to load and </span><span class="line" data-startTime="251">you were looking at that </span><span class="line" data-startTime="254">coffee cup. </span> <span class="line" data-startTime="255">Assuming you could even figure </span><span class="line" data-startTime="255">out how to download it. </span> <span class="line" data-startTime="258">And then Flash. </span> <span class="line" data-startTime="258">Flash is obviously a lot </span><span class="line" data-startTime="258">snappier than Java. </span> <span class="line" data-startTime="263">And is very popular today. </span> <span class="line" data-startTime="265">Obviously when YouTube first </span><span class="line" data-startTime="265">came out, I don't know if </span><span class="line" data-startTime="268">there would have been a YouTube </span><span class="line" data-startTime="268">if there weren't a </span><span class="line" data-startTime="270">Flash plugin. </span> <span class="line" data-startTime="271">But certainly Apple has thrown </span><span class="line" data-startTime="271">down the gauntlet. </span> <span class="line" data-startTime="274">An iOS Flash is a non-starter. </span> <span class="line" data-startTime="276">So if you want to have a code </span><span class="line" data-startTime="276">base that you can use across </span><span class="line" data-startTime="280">different devices and supporting </span><span class="line" data-startTime="280">iOS is important to </span><span class="line" data-startTime="282">you, than Flash is not really </span><span class="line" data-startTime="282">a reasonable option. </span></p>

<p><span class="line" data-startTime="288">Another option, which is good </span><span class="line" data-startTime="288">for building an RIA, is GWT. </span> <span class="line" data-startTime="292">Obviously I'm sure there's </span><span class="line" data-startTime="292">a lot of people </span><span class="line" data-startTime="293">here who use GWT. </span> <span class="line" data-startTime="295">Certainly a lot of people at </span><span class="line" data-startTime="295">this conference have been </span><span class="line" data-startTime="296">talking a lot about GWT. </span> <span class="line" data-startTime="298">And so, if you're familiar with </span><span class="line" data-startTime="298">it, the idea is basically </span><span class="line" data-startTime="301">that you write your application </span><span class="line" data-startTime="301">in a language </span><span class="line" data-startTime="303">that's more familiar to you. </span> <span class="line" data-startTime="304">In the case of GWT, it's Java. </span> <span class="line" data-startTime="307">And then the tool takes care of </span><span class="line" data-startTime="307">translating your Java code </span><span class="line" data-startTime="312">into JavaScript. </span> <span class="line" data-startTime="313">And certainly a lot of people </span><span class="line" data-startTime="313">have written a lot of </span><span class="line" data-startTime="315">interesting things with GWT. </span> <span class="line" data-startTime="317">Even this morning, I believe, </span><span class="line" data-startTime="317">the Angry Birds folks said </span><span class="line" data-startTime="321">that their stuff is </span><span class="line" data-startTime="321">written in GWT. </span> <span class="line" data-startTime="322">So clearly you can get </span><span class="line" data-startTime="322">a lot done using it. </span> <span class="line" data-startTime="325">But at the same time, there's </span><span class="line" data-startTime="325">actually a lot of really great </span><span class="line" data-startTime="328">things that JavaScript has that </span><span class="line" data-startTime="328">Java doesn't have. Such </span><span class="line" data-startTime="332">as first-order functions, is a </span><span class="line" data-startTime="332">really big one and a really </span><span class="line" data-startTime="335">natural use of Closure's. </span></p>

<p><span class="line" data-startTime="337">Passing a function around as a </span><span class="line" data-startTime="337">parameter in Java is actually </span><span class="line" data-startTime="340">incredibly awkward. </span> <span class="line" data-startTime="342">Yet it's also very </span><span class="line" data-startTime="342">straight-forward when you do </span><span class="line" data-startTime="345">it in JavaScript. </span> <span class="line" data-startTime="346">Similarly there's APIs of the </span><span class="line" data-startTime="346">browser, with HTML5, new </span><span class="line" data-startTime="349">things are coming out </span><span class="line" data-startTime="349">all the time. </span> <span class="line" data-startTime="351">In JavaScript you can use these </span><span class="line" data-startTime="351">things very directly. </span> <span class="line" data-startTime="355">In GWT you need to wrap them in </span><span class="line" data-startTime="355">JSNI or someone else has to </span><span class="line" data-startTime="358">do that work for you. </span> <span class="line" data-startTime="360">So if you really care about </span><span class="line" data-startTime="360">getting close to the mettle of </span><span class="line" data-startTime="363">the browser, so to speak, GWT </span><span class="line" data-startTime="363">has ways to get to it. </span> <span class="line" data-startTime="369">But it's not as natural as if </span><span class="line" data-startTime="369">you were using the language </span><span class="line" data-startTime="371">that the browser speaks, </span><span class="line" data-startTime="371">which is JavaScript. </span> <span class="line" data-startTime="376">The way that I propose, and </span><span class="line" data-startTime="376">have built, rich internet </span><span class="line" data-startTime="379">applications is writing </span><span class="line" data-startTime="379">lots of JavaScript. </span></p>

<p><span class="line" data-startTime="382">Because it is awesome. </span> <span class="line" data-startTime="385">And when I say lots, </span><span class="line" data-startTime="385">I do mean lots. </span> <span class="line" data-startTime="387">The last project I worked on </span><span class="line" data-startTime="387">we wrote 70,000 lines of </span><span class="line" data-startTime="390">JavaScript was our </span><span class="line" data-startTime="390">application. </span> <span class="line" data-startTime="392">And we did it using Closure. </span> <span class="line" data-startTime="397">As I mentioned, JavaScript has </span><span class="line" data-startTime="397">first-order functions. </span> <span class="line" data-startTime="400">It also has regular expression </span><span class="line" data-startTime="400">literal, similar to Perl. </span> <span class="line" data-startTime="404">It has a prototype- based </span><span class="line" data-startTime="404">inheritance mechanism that </span><span class="line" data-startTime="409">Java does have and other </span><span class="line" data-startTime="409">languages don't have. It </span><span class="line" data-startTime="410">actually took that &mdash; it was </span><span class="line" data-startTime="410">inspired by this other </span><span class="line" data-startTime="412">language called Self. </span></p>

<p><span class="line" data-startTime="413">So there's a lot of neat things </span><span class="line" data-startTime="413">that you get when you </span><span class="line" data-startTime="417">write in JavaScript, in </span><span class="line" data-startTime="417">addition to being </span><span class="line" data-startTime="419">close to the browser. </span> <span class="line" data-startTime="420">But also as a language, it </span><span class="line" data-startTime="420">is a very good language. </span> <span class="line" data-startTime="423">People have bad impressions of </span><span class="line" data-startTime="423">it because they only associate </span><span class="line" data-startTime="425">it with browser programming, </span><span class="line" data-startTime="425">which is traditionally </span><span class="line" data-startTime="428">fundamentally difficult </span><span class="line" data-startTime="428">because of things like </span><span class="line" data-startTime="430">Internet Explorer 6 and all the </span><span class="line" data-startTime="430">differences in the DOM. </span> <span class="line" data-startTime="434">It's the DOM API that's actually </span><span class="line" data-startTime="434">the source of most </span><span class="line" data-startTime="436">people's frustration. </span> <span class="line" data-startTime="438">But JavaScript the language </span><span class="line" data-startTime="438">really takes more of the heat, </span><span class="line" data-startTime="441">whereas it should not. </span> <span class="line" data-startTime="445">In case you think I'm the only </span><span class="line" data-startTime="445">person who is crazy, who </span><span class="line" data-startTime="447">thinks we should write a lot </span><span class="line" data-startTime="447">of JavaScript, all these </span><span class="line" data-startTime="450">applications on the bottom that </span><span class="line" data-startTime="450">Google has written, they </span><span class="line" data-startTime="453">are in JavaScript. </span></p>

<p><span class="line" data-startTime="454">A lot of people assume that </span><span class="line" data-startTime="454">the Google Web Toolkit is </span><span class="line" data-startTime="458">responsible for everything </span><span class="line" data-startTime="458">that Google produces. </span> <span class="line" data-startTime="461">That's not the case. </span> <span class="line" data-startTime="463">Part of it was also just </span><span class="line" data-startTime="463">due to history. </span> <span class="line" data-startTime="466">Some of these applications had </span><span class="line" data-startTime="466">already been built up and were </span><span class="line" data-startTime="468">going and rewriting </span><span class="line" data-startTime="468">it in GWT &mdash; </span><span class="line" data-startTime="471">doesn't seem like </span><span class="line" data-startTime="471">a good option. </span> <span class="line" data-startTime="472">But also, sometimes there </span><span class="line" data-startTime="472">are just performance </span><span class="line" data-startTime="477">characteristics or metrics </span><span class="line" data-startTime="477">that we wanted these </span><span class="line" data-startTime="479">applications to meet. </span> <span class="line" data-startTime="480">And it just made a lot of </span><span class="line" data-startTime="480">sense to write them in </span><span class="line" data-startTime="482">JavaScript. </span></p>

<p><span class="line" data-startTime="484">And all these are basically </span><span class="line" data-startTime="484">powered by Closure. </span> <span class="line" data-startTime="488">So at the same time I'm telling </span><span class="line" data-startTime="488">you that you should </span><span class="line" data-startTime="492">write a lot of JavaScript, yet </span><span class="line" data-startTime="492">in some ways JavaScript tries </span><span class="line" data-startTime="496">to defeat programming </span><span class="line" data-startTime="496">in the large. </span> <span class="line" data-startTime="500">So unlike Java, there's </span><span class="line" data-startTime="500">no namespaces. </span> <span class="line" data-startTime="503">There's no import statement that </span><span class="line" data-startTime="503">is part of the language </span><span class="line" data-startTime="506">in JavaScript. </span> <span class="line" data-startTime="507">And namespaces are important </span><span class="line" data-startTime="507">because as you build up a lot </span><span class="line" data-startTime="510">of code, you need some </span><span class="line" data-startTime="510">way to modularize it. </span> <span class="line" data-startTime="512">You need some way </span><span class="line" data-startTime="512">to organize it. </span> <span class="line" data-startTime="514">Namespaces turn out to be a </span><span class="line" data-startTime="514">pretty good mechanism for </span><span class="line" data-startTime="517">doing that sort of thing. </span></p>

<p><span class="line" data-startTime="519">Visibility controls are another </span><span class="line" data-startTime="519">important point. </span> <span class="line" data-startTime="523">In particular, in terms of </span><span class="line" data-startTime="523">object oriented programming </span><span class="line" data-startTime="525">you have &mdash; in Java you have </span><span class="line" data-startTime="525">the private public </span><span class="line" data-startTime="528">protected key words. </span> <span class="line" data-startTime="529">You're saying, this data should </span><span class="line" data-startTime="529">only be seen by the </span><span class="line" data-startTime="532">methods that belong </span><span class="line" data-startTime="532">to this class. </span> <span class="line" data-startTime="534">This also is helpful in </span><span class="line" data-startTime="534">programming in the large. </span> <span class="line" data-startTime="536">Because then this further helps </span><span class="line" data-startTime="536">you modularize your </span><span class="line" data-startTime="539">code, modularize data. </span> <span class="line" data-startTime="541">And it's enforced </span><span class="line" data-startTime="541">by the compiler. </span> <span class="line" data-startTime="542">So you get some static </span><span class="line" data-startTime="542">checking about this </span><span class="line" data-startTime="545">organization and you don't have </span><span class="line" data-startTime="545">to manage it yourself. </span> <span class="line" data-startTime="551">Similarly, having </span><span class="line" data-startTime="551">a type system. </span> <span class="line" data-startTime="553">A lot of people like the idea </span><span class="line" data-startTime="553">that JavaScript is, what many </span><span class="line" data-startTime="557">people call, duck type. </span></p>

<p><span class="line" data-startTime="558">That if you get an object and it </span><span class="line" data-startTime="558">has the properties that you </span><span class="line" data-startTime="561">want, then you can use it the </span><span class="line" data-startTime="561">way that you want to. </span> <span class="line" data-startTime="564">As opposed to having to create </span><span class="line" data-startTime="564">an explicit class and having </span><span class="line" data-startTime="570">methods with strongly typed </span><span class="line" data-startTime="570">signatures saying, this takes </span><span class="line" data-startTime="573">a string, this takes a number </span><span class="line" data-startTime="573">and the compiler won't let you </span><span class="line" data-startTime="576">do anything that violates </span><span class="line" data-startTime="576">that contract. </span> <span class="line" data-startTime="580">But as you write more and more </span><span class="line" data-startTime="580">JavaScript and you just pick </span><span class="line" data-startTime="583">up people's code and you're </span><span class="line" data-startTime="583">just trying to look at the </span><span class="line" data-startTime="585">interface, this can actually </span><span class="line" data-startTime="585">be kind of difficult. </span></p>

<p><span class="line" data-startTime="587">I, myself, find this someone </span><span class="line" data-startTime="587">troubling when I look at </span><span class="line" data-startTime="590">Python documentation. </span> <span class="line" data-startTime="591">Python's also both not </span><span class="line" data-startTime="591">strongly typed. </span> <span class="line" data-startTime="593">A lot of times what the method </span><span class="line" data-startTime="593">does would be more obvious if </span><span class="line" data-startTime="597">I just knew the type signature </span><span class="line" data-startTime="597">that were associated with it. </span> <span class="line" data-startTime="601">So as you write more </span><span class="line" data-startTime="601">and more code this </span><span class="line" data-startTime="603">can become a problem. </span> <span class="line" data-startTime="604">It's also related to </span><span class="line" data-startTime="604">refactoring, which I will </span><span class="line" data-startTime="607">probably get into later. </span> <span class="line" data-startTime="609">Also static checking. </span> <span class="line" data-startTime="611">So this is related to having </span><span class="line" data-startTime="611">a type system. </span> <span class="line" data-startTime="614">When you have a type system and </span><span class="line" data-startTime="614">you have a compiler that </span><span class="line" data-startTime="617">enforces types that means at </span><span class="line" data-startTime="617">compile time, the compiler can </span><span class="line" data-startTime="620">help you find a whole class of </span><span class="line" data-startTime="620">errors that you might not find </span><span class="line" data-startTime="624">while running your problem. </span> <span class="line" data-startTime="625">But similarly if you have an </span><span class="line" data-startTime="625">error in an else branch &mdash; </span><span class="line" data-startTime="630">I'm sure many Python </span><span class="line" data-startTime="630">programmers </span><span class="line" data-startTime="632">have hit this problem &mdash; </span><span class="line" data-startTime="634">or any branch of code, I should </span><span class="line" data-startTime="634">say, where it's not </span><span class="line" data-startTime="636">executed regularly. </span></p>

<p><span class="line" data-startTime="638">Or say some sort of error </span><span class="line" data-startTime="638">handling code. </span> <span class="line" data-startTime="640">Because obviously you want to </span><span class="line" data-startTime="640">test with good inputs and no </span><span class="line" data-startTime="643">one ever tests their </span><span class="line" data-startTime="643">bad inputs. </span> <span class="line" data-startTime="645">Because why would we ever </span><span class="line" data-startTime="645">have bad inputs? </span><span class="line" data-startTime="648">But that people don't find out </span><span class="line" data-startTime="648">until run time until someone </span><span class="line" data-startTime="651">finally happens to trigger </span><span class="line" data-startTime="651">that error. </span> <span class="line" data-startTime="653">There's a large class pf </span><span class="line" data-startTime="653">problems that happen there </span><span class="line" data-startTime="655">that could be checked statically </span><span class="line" data-startTime="655">if there were a </span><span class="line" data-startTime="657">compiler or some sort of other </span><span class="line" data-startTime="657">static analysis tool to </span><span class="line" data-startTime="660">perform that checking for you. </span> <span class="line" data-startTime="662">Again programming in the large, </span><span class="line" data-startTime="662">as your code gets </span><span class="line" data-startTime="665">bigger and bigger it's really </span><span class="line" data-startTime="665">hard to manage all these </span><span class="line" data-startTime="668">things yourself. </span> <span class="line" data-startTime="669">Yes, you should be writing </span><span class="line" data-startTime="669">unit tests or integration </span><span class="line" data-startTime="672">tests that actually exercise </span><span class="line" data-startTime="672">all these code paths. </span> <span class="line" data-startTime="674">But the reality is that most </span><span class="line" data-startTime="674">people don't, assuming they </span><span class="line" data-startTime="678">write tests at all. </span> <span class="line" data-startTime="680">And this last one is not having </span><span class="line" data-startTime="682">built-in support for templates. </span></p>

<p><span class="line" data-startTime="684">So in JavaScript, or any web </span><span class="line" data-startTime="684">application, you're usually </span><span class="line" data-startTime="688">building up large </span><span class="line" data-startTime="688">strings of HTML. </span> <span class="line" data-startTime="690">Because this is the thing that </span><span class="line" data-startTime="690">you use to create your user </span><span class="line" data-startTime="694">interface in a web browser, </span><span class="line" data-startTime="694">is basically HTML and CSS. </span> <span class="line" data-startTime="698">Unfortunately in JavaScript, </span><span class="line" data-startTime="698">we don't </span><span class="line" data-startTime="701">have multi-line strings. </span> <span class="line" data-startTime="703">Yet we want to create large DOM </span><span class="line" data-startTime="704">structures defined in HTML. </span> <span class="line" data-startTime="709">And then we would really like </span><span class="line" data-startTime="709">to have placeholders, so we </span><span class="line" data-startTime="711">could basically have </span><span class="line" data-startTime="711">a template and </span><span class="line" data-startTime="712">substitute things in. </span> <span class="line" data-startTime="714">If you have a repeated row </span><span class="line" data-startTime="714">in a table, right? </span><span class="line" data-startTime="716">You'd like that row to be a </span><span class="line" data-startTime="716">template that you can just </span><span class="line" data-startTime="719">reuse and pump out the same </span><span class="line" data-startTime="719">structure HTML but with </span><span class="line" data-startTime="723">different variables. </span></p>

<p><span class="line" data-startTime="724">And unfortunately the way </span><span class="line" data-startTime="724">strings work in JavaScript </span><span class="line" data-startTime="726">today, it's not so </span><span class="line" data-startTime="726">straightforward to do that </span><span class="line" data-startTime="730">sort of thing. </span> <span class="line" data-startTime="731">So these are some of the ways </span><span class="line" data-startTime="731">that JavaScript tries to </span><span class="line" data-startTime="735">defeat or makes it harder to do </span><span class="line" data-startTime="735">development in the large. </span> <span class="line" data-startTime="743">There's a suite of tools Open </span><span class="line" data-startTime="743">Sourced by Google called the </span><span class="line" data-startTime="746">Closure tools. </span> <span class="line" data-startTime="746">And that's what the crux </span><span class="line" data-startTime="746">of my talk is about. </span> <span class="line" data-startTime="749">And these tools are useful </span><span class="line" data-startTime="749">in general in JavaScript </span><span class="line" data-startTime="754">development. </span> <span class="line" data-startTime="755">But I think their true strength </span><span class="line" data-startTime="755">is when you start </span><span class="line" data-startTime="758">doing JavaScript development </span><span class="line" data-startTime="758">in the large. </span> <span class="line" data-startTime="760">And that, obviously, </span><span class="line" data-startTime="760">you should start </span><span class="line" data-startTime="762">with a small project. </span></p>

<p><span class="line" data-startTime="763">It's not a good idea to start </span><span class="line" data-startTime="763">with a big project. </span> <span class="line" data-startTime="766">So at the outset you may not see </span><span class="line" data-startTime="766">the value in these tools. </span> <span class="line" data-startTime="769">But you might then get to a </span><span class="line" data-startTime="769">point where you really wish </span><span class="line" data-startTime="772">you had been using them. </span> <span class="line" data-startTime="774">So let's look at </span><span class="line" data-startTime="774">what they are. </span> <span class="line" data-startTime="777">The first one is the </span><span class="line" data-startTime="777">Closure Library. </span> <span class="line" data-startTime="779">The Closure Library is a library </span><span class="line" data-startTime="779">of common utilities, </span><span class="line" data-startTime="784">widgets, written </span><span class="line" data-startTime="784">in JavaScript. </span> <span class="line" data-startTime="788">It works across browsers. </span> <span class="line" data-startTime="790">It works back to IE6. </span> <span class="line" data-startTime="794">So it's analogous to your </span><span class="line" data-startTime="794">jQueries queries, your </span><span class="line" data-startTime="796">MooTools, your YUI all </span><span class="line" data-startTime="796">that sort of thing. </span> <span class="line" data-startTime="799">All these things are JavaScript </span><span class="line" data-startTime="799">libraries that try </span><span class="line" data-startTime="801">to abstract away browser </span><span class="line" data-startTime="801">differences from you and </span><span class="line" data-startTime="804">provide a lot of common </span><span class="line" data-startTime="804">functionality. </span> <span class="line" data-startTime="809">The next tool is Closure </span><span class="line" data-startTime="809">Templates. </span></p>

<p><span class="line" data-startTime="811">So Closure Templates is </span><span class="line" data-startTime="811">a templating language. </span> <span class="line" data-startTime="814">Because we didn't have enough </span><span class="line" data-startTime="814">templating languages. </span> <span class="line" data-startTime="816">But Closure Templates does </span><span class="line" data-startTime="816">have some unique </span><span class="line" data-startTime="819">and important features. </span> <span class="line" data-startTime="822">And you can use it to &mdash; </span><span class="line" data-startTime="824">as I mentioned, it's hard to </span><span class="line" data-startTime="824">build up strings of HTML in </span><span class="line" data-startTime="827">JavaScript using </span><span class="line" data-startTime="827">raw JavaScript. </span> <span class="line" data-startTime="829">But having a separate template </span><span class="line" data-startTime="829">language actually makes this a </span><span class="line" data-startTime="832">lot easier and also less </span><span class="line" data-startTime="832">error-prone, as we'll see. </span> <span class="line" data-startTime="835">And the third tool is the </span><span class="line" data-startTime="835">Closure Compiler. </span> <span class="line" data-startTime="839">The Closure Compiler is </span><span class="line" data-startTime="839">a JavaScript minifier. </span> <span class="line" data-startTime="842">So that means that you may write </span><span class="line" data-startTime="842">your JavaScript full of </span><span class="line" data-startTime="845">comments and white space that </span><span class="line" data-startTime="845">don't actually contribute to </span><span class="line" data-startTime="850">the behavior of your program. </span> <span class="line" data-startTime="852">But your users, who download the </span><span class="line" data-startTime="852">JavaScript when they visit </span><span class="line" data-startTime="855">your site, they're paying the </span><span class="line" data-startTime="855">penalty, so to speak, of </span><span class="line" data-startTime="859">download time and parse </span><span class="line" data-startTime="859">time when you </span><span class="line" data-startTime="861">have these extra bytes. </span></p>

<p><span class="line" data-startTime="863">And so you want to use a </span><span class="line" data-startTime="863">JavaScript minifier to reduce </span><span class="line" data-startTime="867">the size of your JavaScript </span><span class="line" data-startTime="867">code. </span> <span class="line" data-startTime="869">This saves your bandwidth. </span> <span class="line" data-startTime="871">It saves the users' bandwidth. </span> <span class="line" data-startTime="872">It starts up &mdash; and the users' </span><span class="line" data-startTime="872">application will start up </span><span class="line" data-startTime="875">faster because there's less </span><span class="line" data-startTime="875">JavaScript to parse and it got </span><span class="line" data-startTime="879">there quicker because it </span><span class="line" data-startTime="879">was a smaller file. </span> <span class="line" data-startTime="883">There are other minifiers </span><span class="line" data-startTime="883">out there. </span> <span class="line" data-startTime="885">There's like JSMIN </span><span class="line" data-startTime="885">and UglifyJS. </span> <span class="line" data-startTime="887">But most of them only focus on </span><span class="line" data-startTime="887">minification, whereas the </span><span class="line" data-startTime="890">Closure compiler also does </span><span class="line" data-startTime="890">add status checking. </span> <span class="line" data-startTime="893">And we'll see more of that </span><span class="line" data-startTime="893">in a bit as well. </span> <span class="line" data-startTime="897">The most important thing, I </span><span class="line" data-startTime="897">think, about the Closure tools </span><span class="line" data-startTime="899">that people don't realize, is </span><span class="line" data-startTime="899">that the Library, Templates, </span><span class="line" data-startTime="903">and the Compiler, they're </span><span class="line" data-startTime="903">all independent tools. </span></p>

<p><span class="line" data-startTime="905">You can actually use one of the </span><span class="line" data-startTime="905">three on any JavaScript </span><span class="line" data-startTime="907">project if that's all you're </span><span class="line" data-startTime="907">interested in. </span> <span class="line" data-startTime="909">But they are, by far </span><span class="line" data-startTime="909">and away, most </span><span class="line" data-startTime="911">compelling when used together. </span> <span class="line" data-startTime="914">The results that you get, and </span><span class="line" data-startTime="914">the improvement in your code, </span><span class="line" data-startTime="916">are just much more compelling </span><span class="line" data-startTime="916">when you put all these three </span><span class="line" data-startTime="918">things together. </span> <span class="line" data-startTime="919">And I think that this is another </span><span class="line" data-startTime="919">area where Closure is </span><span class="line" data-startTime="924">far beyond a lot of the </span><span class="line" data-startTime="924">other offerings. </span> <span class="line" data-startTime="926">There is jQuery, there Is </span><span class="line" data-startTime="926">Mustache.js there is JSMin. </span> <span class="line" data-startTime="930">There are analogs for all </span><span class="line" data-startTime="930">three of these tools. </span></p>

<p><span class="line" data-startTime="934">So I can't claim that Closure </span><span class="line" data-startTime="934">invented all these ideas. </span> <span class="line" data-startTime="937">However I think that most of </span><span class="line" data-startTime="937">these other projects are done </span><span class="line" data-startTime="940">kind of in a silo. </span> <span class="line" data-startTime="942">Whereas the Closure tools are </span><span class="line" data-startTime="942">done knowing the strength of </span><span class="line" data-startTime="945">each other tool in mind. </span> <span class="line" data-startTime="946">And that's why it really helps </span><span class="line" data-startTime="946">to put them together. </span> <span class="line" data-startTime="956">To really understand and </span><span class="line" data-startTime="956">appreciate the benefit of </span><span class="line" data-startTime="958">Closure Tools, first I think we </span><span class="line" data-startTime="958">should look at some of the </span><span class="line" data-startTime="961">problems that JavaScript </span><span class="line" data-startTime="961">developers face today. </span> <span class="line" data-startTime="963">And maybe you don't even realize </span><span class="line" data-startTime="963">that you're having </span><span class="line" data-startTime="966">this problem or that </span><span class="line" data-startTime="966">you should be </span><span class="line" data-startTime="968">doing something better. </span> <span class="line" data-startTime="969">So here's the first. People &mdash; </span><span class="line" data-startTime="971">I don't know if anyone's used </span><span class="line" data-startTime="971">the Library Prototype JS. </span></p>

<p><span class="line" data-startTime="974">Prototype is a JavaScript </span><span class="line" data-startTime="974">library that </span><span class="line" data-startTime="976">goes way, way back. </span> <span class="line" data-startTime="978">And one of its claims to </span><span class="line" data-startTime="978">fame was its terseness. </span> <span class="line" data-startTime="983">So this is a function that </span><span class="line" data-startTime="983">Prototype offers. </span> <span class="line" data-startTime="987">Does anyone have a guess what </span><span class="line" data-startTime="987">this function does, just by </span><span class="line" data-startTime="991">reading it? </span><span class="line" data-startTime="993">It does white space. </span> <span class="line" data-startTime="994">Yeah. </span> <span class="line" data-startTime="994">So it actually splits </span><span class="line" data-startTime="994">your code. </span> <span class="line" data-startTime="996">It splits your string that you </span><span class="line" data-startTime="996">give it, on white space. </span> <span class="line" data-startTime="1000">Now if you know that, it's </span><span class="line" data-startTime="1000">probably because you've used </span><span class="line" data-startTime="1002">Prototype JS before. </span> <span class="line" data-startTime="1004">But if you have a new person on </span><span class="line" data-startTime="1004">your project and they came </span><span class="line" data-startTime="1007">upon this function that says </span><span class="line" data-startTime="1007">dollar sign W, it's pretty </span><span class="line" data-startTime="1010">hard for them to come up with </span><span class="line" data-startTime="1010">what it does without, either </span><span class="line" data-startTime="1013">running it or looking </span><span class="line" data-startTime="1013">at the code. </span></p>

<p><span class="line" data-startTime="1015">And for one function </span><span class="line" data-startTime="1015">that's fine. </span> <span class="line" data-startTime="1017">But if this is kind of how you </span><span class="line" data-startTime="1017">design your whole library, </span><span class="line" data-startTime="1019">basically to be unreadable but </span><span class="line" data-startTime="1019">terse, this is going to hurt </span><span class="line" data-startTime="1023">you when you're trying to </span><span class="line" data-startTime="1023">build a large JavaScript </span><span class="line" data-startTime="1026">application. </span> <span class="line" data-startTime="1027">For a long time people have kind </span><span class="line" data-startTime="1027">of gotten away with, or </span><span class="line" data-startTime="1030">justified, this type of library </span><span class="line" data-startTime="1030">style because of </span><span class="line" data-startTime="1033">arguing that, well it's saving </span><span class="line" data-startTime="1033">my users' bandwidth because </span><span class="line" data-startTime="1037">I'm using fewer bytes for </span><span class="line" data-startTime="1037">my function names. </span> <span class="line" data-startTime="1039">And so it's saving space on the </span><span class="line" data-startTime="1039">wire and therefore it's OK </span><span class="line" data-startTime="1042">to do things that no one </span><span class="line" data-startTime="1042">else understands. </span></p>

<p><span class="line" data-startTime="1045">But with things like the Closure </span><span class="line" data-startTime="1045">compiler, which will </span><span class="line" data-startTime="1047">rename variable for you &mdash; </span><span class="line" data-startTime="1047">as we'll see in a bit &mdash; </span><span class="line" data-startTime="1050">that's no longer as compelling </span><span class="line" data-startTime="1050">a reason to </span><span class="line" data-startTime="1052">do things that way. </span> <span class="line" data-startTime="1053">So in the Closure world, you're </span><span class="line" data-startTime="1053">really going to want to </span><span class="line" data-startTime="1056">use names that are readable and </span><span class="line" data-startTime="1056">make sense and make sense </span><span class="line" data-startTime="1059">to your teammates and are </span><span class="line" data-startTime="1059">more self-documenting. </span> <span class="line" data-startTime="1064">Another thing is building </span><span class="line" data-startTime="1064">up strings of HTML. </span> <span class="line" data-startTime="1066">So the problem is, as I </span><span class="line" data-startTime="1066">mentioned, that JavaScript is </span><span class="line" data-startTime="1070">not really great at this, when </span><span class="line" data-startTime="1070">you want to preserve the </span><span class="line" data-startTime="1072">formatting of the HTML and the </span><span class="line" data-startTime="1072">structure that you're trying </span><span class="line" data-startTime="1076">to produce such that </span><span class="line" data-startTime="1076">it's readable. </span></p>

<p><span class="line" data-startTime="1078">You want it to be close to what </span><span class="line" data-startTime="1078">it would be if you wrote </span><span class="line" data-startTime="1081">HTML yourself. </span> <span class="line" data-startTime="1084">But does anyone know what this </span><span class="line" data-startTime="1084">function would return? </span><span class="line" data-startTime="1091">So actually, this function, if </span><span class="line" data-startTime="1091">you just ran it, regardless of </span><span class="line" data-startTime="1094">what inputs you gave </span><span class="line" data-startTime="1094">to it, this </span><span class="line" data-startTime="1096">function returns undefined. </span> <span class="line" data-startTime="1098">And the reason is that </span><span class="line" data-startTime="1098">JavaScript has this neat </span><span class="line" data-startTime="1102">feature called semicolon </span><span class="line" data-startTime="1102">insertion. </span> <span class="line" data-startTime="1105">And basically if you don't use </span><span class="line" data-startTime="1105">semicolons everywhere, it </span><span class="line" data-startTime="1109">infers for where semicolons </span><span class="line" data-startTime="1109">can be placed. </span> <span class="line" data-startTime="1112">And so, unlike some other </span><span class="line" data-startTime="1112">languages you can have logic </span><span class="line" data-startTime="1117">after a return statement </span><span class="line" data-startTime="1117">in JavaScript. </span></p>

<p><span class="line" data-startTime="1118">It's actually kind of helpful </span><span class="line" data-startTime="1118">during debugging if you want </span><span class="line" data-startTime="1120">to exit out real quick while </span><span class="line" data-startTime="1120">testing something. </span> <span class="line" data-startTime="1122">But in your production </span><span class="line" data-startTime="1122">code, this is </span><span class="line" data-startTime="1123">actually kind of a disaster. </span> <span class="line" data-startTime="1125">So what happens is, JavaScript </span><span class="line" data-startTime="1125">inserts a semicolon basically </span><span class="line" data-startTime="1129">after where that end </span><span class="line" data-startTime="1129">character would be. </span> <span class="line" data-startTime="1132">Or the interpreter or the </span><span class="line" data-startTime="1132">run time does this. </span> <span class="line" data-startTime="1135">It does this because then </span><span class="line" data-startTime="1135">there's a new line and then </span><span class="line" data-startTime="1137">this whole statement &mdash; </span><span class="line" data-startTime="1137">this on its own is a </span><span class="line" data-startTime="1139">valid JavaScript statement. </span> <span class="line" data-startTime="1142">So the first line just </span><span class="line" data-startTime="1142">becomes return. </span> <span class="line" data-startTime="1143">It returns undefined. </span> <span class="line" data-startTime="1144">Actually that statement below </span><span class="line" data-startTime="1144">it never gets executed. </span> <span class="line" data-startTime="1148">There's lots of little bugs, </span><span class="line" data-startTime="1148">errors, that people make </span><span class="line" data-startTime="1152">around this type of behavior. </span> <span class="line" data-startTime="1153">And when it comes to things like </span><span class="line" data-startTime="1153">formatting HTML, it makes </span><span class="line" data-startTime="1157">it particularly worse. </span></p>

<p><span class="line" data-startTime="1159">Another problem that people </span><span class="line" data-startTime="1159">open themselves up to when </span><span class="line" data-startTime="1163">they write code in this manner </span><span class="line" data-startTime="1163">is that these arguments are </span><span class="line" data-startTime="1166">not HTML escaped. </span> <span class="line" data-startTime="1168">Meaning that, if the user </span><span class="line" data-startTime="1168">is some sort of user and </span><span class="line" data-startTime="1171">potentially a malicious user, </span><span class="line" data-startTime="1171">is responsible for &mdash; </span><span class="line" data-startTime="1174">if you read these values out of </span><span class="line" data-startTime="1174">a database that that user </span><span class="line" data-startTime="1179">chose when they signed up or </span><span class="line" data-startTime="1179">filled out a form or something </span><span class="line" data-startTime="1182">like that &mdash; if you don't escape </span><span class="line" data-startTime="1182">the less than signs and </span><span class="line" data-startTime="1185">whatnot before you blitz this </span><span class="line" data-startTime="1185">string of HTML into your </span><span class="line" data-startTime="1188">application, you could open </span><span class="line" data-startTime="1188">yourself up to a across-site </span><span class="line" data-startTime="1192">scripting attack. </span> <span class="line" data-startTime="1194">Which is very embarrassing </span><span class="line" data-startTime="1194">for you. </span></p>

<p><span class="line" data-startTime="1196">I've done it. </span> <span class="line" data-startTime="1198">I was very embarrassed </span><span class="line" data-startTime="1198">as you might imagine. </span> <span class="line" data-startTime="1200">But it's better to have a tool </span><span class="line" data-startTime="1200">that really makes it harder to </span><span class="line" data-startTime="1203">make these kinds of mistakes. </span> <span class="line" data-startTime="1209">Another issue is managing </span><span class="line" data-startTime="1209">dependencies in JavaScript. </span> <span class="line" data-startTime="1214">I look at a lot of projects, or </span><span class="line" data-startTime="1214">even websites I visit, and </span><span class="line" data-startTime="1217">I wonder why they're slow. </span> <span class="line" data-startTime="1218">And then I take a little look </span><span class="line" data-startTime="1218">under the hood and a lot of </span><span class="line" data-startTime="1220">them manage their dependencies </span><span class="line" data-startTime="1220">in this way. </span> <span class="line" data-startTime="1224">And I can imagine what's going </span><span class="line" data-startTime="1224">through the developer's mind </span><span class="line" data-startTime="1227">as they come up with HTML. </span> <span class="line" data-startTime="1228">So they're like, number one, </span><span class="line" data-startTime="1228">I'm writing JavaScript. </span> <span class="line" data-startTime="1232">So I need jQuery. </span></p>

<p><span class="line" data-startTime="1233">Because everyone says </span><span class="line" data-startTime="1233">jQuery's cool. </span> <span class="line" data-startTime="1234">So that's what I'm </span><span class="line" data-startTime="1234">going to do. </span> <span class="line" data-startTime="1235">So they put a script tag to </span><span class="line" data-startTime="1235">jQuery in their page. </span> <span class="line" data-startTime="1238">So far that's completely fine. </span> <span class="line" data-startTime="1240">But then they get to the point </span><span class="line" data-startTime="1240">where they have some form that </span><span class="line" data-startTime="1244">needs people to input a date. </span> <span class="line" data-startTime="1246">And they're like, I need </span><span class="line" data-startTime="1246">a date picker. </span> <span class="line" data-startTime="1247">And they go and they download </span><span class="line" data-startTime="1247">a date picker library for </span><span class="line" data-startTime="1250">somewhere and they just plop </span><span class="line" data-startTime="1250">another script tag in there. </span> <span class="line" data-startTime="1252">So now it's two tags. </span> <span class="line" data-startTime="1254">Not so bad, right? </span><span class="line" data-startTime="1255">Probably going to need a date </span><span class="line" data-startTime="1255">picker in other places. </span> <span class="line" data-startTime="1258">That's OK. </span></p>

<p><span class="line" data-startTime="1259">And then they decide that they </span><span class="line" data-startTime="1259">want some template solution. </span> <span class="line" data-startTime="1263">Because actually, that would </span><span class="line" data-startTime="1263">kind of help them out. </span> <span class="line" data-startTime="1264">And they didn't get one out of </span><span class="line" data-startTime="1264">box with jQuery or with the </span><span class="line" data-startTime="1267">data picker, so they </span><span class="line" data-startTime="1267">include that. </span> <span class="line" data-startTime="1270">And then they started testing </span><span class="line" data-startTime="1270">on IE 6 and they're </span><span class="line" data-startTime="1273">like, ah, son of a &mdash; </span><span class="line" data-startTime="1274">Now I've got to add </span><span class="line" data-startTime="1274">this workaround. </span> <span class="line" data-startTime="1276">And it's not that big, so </span><span class="line" data-startTime="1276">everyone can just get it. </span> <span class="line" data-startTime="1280">It's just another script tag </span><span class="line" data-startTime="1280">and that type of thing. </span></p>

<p><span class="line" data-startTime="1282">And then, oh, actually, I also </span><span class="line" data-startTime="1282">forgot I should probably write </span><span class="line" data-startTime="1285">my application, too, while </span><span class="line" data-startTime="1285">I'm doing all this other </span><span class="line" data-startTime="1288">JavaScript development. </span> <span class="line" data-startTime="1289">And you see lots of pages </span><span class="line" data-startTime="1289">like this, where </span><span class="line" data-startTime="1291">everything gets built up. </span> <span class="line" data-startTime="1292">There's also a good chance </span><span class="line" data-startTime="1292">that unrelated template </span><span class="line" data-startTime="1295">solution dot js happened to </span><span class="line" data-startTime="1295">bundle jQuery in their </span><span class="line" data-startTime="1298">implementation. </span> <span class="line" data-startTime="1299">And now you're pulling down </span><span class="line" data-startTime="1299">two versions of it. </span> <span class="line" data-startTime="1304">I've seen a lot of </span><span class="line" data-startTime="1304">things like this. </span> <span class="line" data-startTime="1305">So how long can this go on? </span><span class="line" data-startTime="1306">How many script tags can you </span><span class="line" data-startTime="1306">add to your web page? </span><span class="line" data-startTime="1309">Well, a lot, unfortunately. </span></p>

<p><span class="line" data-startTime="1311">And this is a big source of </span><span class="line" data-startTime="1311">slowness, if you've looked at </span><span class="line" data-startTime="1315">page feed or any of Steve </span><span class="line" data-startTime="1315">Souders's work on how to make </span><span class="line" data-startTime="1320">faster websites. </span> <span class="line" data-startTime="1322">Everyone will tell you. </span> <span class="line" data-startTime="1322">One, you need to minimize the </span><span class="line" data-startTime="1322">number of requests that your </span><span class="line" data-startTime="1325">page makes. </span> <span class="line" data-startTime="1327">Sometimes you may want </span><span class="line" data-startTime="1327">to split things </span><span class="line" data-startTime="1328">up to leverage cacheing. </span> <span class="line" data-startTime="1330">That really depends on the </span><span class="line" data-startTime="1330">profile of your page or the </span><span class="line" data-startTime="1333">assets that you're trying </span><span class="line" data-startTime="1333">to download. </span> <span class="line" data-startTime="1335">But if you see something like </span><span class="line" data-startTime="1335">this, you're probably doing </span><span class="line" data-startTime="1338">something wrong. </span> <span class="line" data-startTime="1338">And you could be doing something </span><span class="line" data-startTime="1338">a lot better. </span></p>

<p><span class="line" data-startTime="1341">And also, a lot of these </span><span class="line" data-startTime="1341">disparate libraries are </span><span class="line" data-startTime="1345">probably reimplementing the same </span><span class="line" data-startTime="1345">functionality and your </span><span class="line" data-startTime="1348">users are now downloading </span><span class="line" data-startTime="1348">it five times. </span> <span class="line" data-startTime="1351">So managing dependencies. </span> <span class="line" data-startTime="1352">Again, I said there's no </span><span class="line" data-startTime="1352">import statement in </span><span class="line" data-startTime="1354">JavaScript. </span> <span class="line" data-startTime="1354">So it's somewhat difficult </span><span class="line" data-startTime="1354">to do out of the box. </span> <span class="line" data-startTime="1359">Another thing that I've seen </span><span class="line" data-startTime="1359">happening recently is creating </span><span class="line" data-startTime="1362">a special version of JavaScript </span><span class="line" data-startTime="1362">for mobile. </span> <span class="line" data-startTime="1366">Creating a special version of </span><span class="line" data-startTime="1366">your JavaScript for mobile is </span><span class="line" data-startTime="1369">a good thing. </span> <span class="line" data-startTime="1369">Because they have different </span><span class="line" data-startTime="1369">capabilities and </span><span class="line" data-startTime="1373">that sort of thing. </span> <span class="line" data-startTime="1373">But the problem is that when </span><span class="line" data-startTime="1373">I see forks of libraries. </span> <span class="line" data-startTime="1376">So there's a library out called </span><span class="line" data-startTime="1376">Zepto .js and it's </span><span class="line" data-startTime="1379">basically a mobile web kit </span><span class="line" data-startTime="1379">implementation of jQuery So </span><span class="line" data-startTime="1386">when I say mobile web kit I </span><span class="line" data-startTime="1386">mean, you can rely on an array </span><span class="line" data-startTime="1389">having a for each library. </span></p>

<p><span class="line" data-startTime="1391">Or that you know that the </span><span class="line" data-startTime="1391">query selector method is </span><span class="line" data-startTime="1394">available in the DOM As opposed </span><span class="line" data-startTime="1394">to, in jQuery, to be </span><span class="line" data-startTime="1397">backwards compatible there's </span><span class="line" data-startTime="1397">substantial code that it </span><span class="line" data-startTime="1400">bundles to be able to emulate </span><span class="line" data-startTime="1400">query SelectorAll and </span><span class="line" data-startTime="1404">iterating of an array </span><span class="line" data-startTime="1404">and a whole bunch </span><span class="line" data-startTime="1406">of things like that. </span> <span class="line" data-startTime="1407">And so instead of trying to </span><span class="line" data-startTime="1407">write one library, and not </span><span class="line" data-startTime="1412">repeating yourself, and then </span><span class="line" data-startTime="1412">doing some sort of </span><span class="line" data-startTime="1414">post-processing to generate what </span><span class="line" data-startTime="1414">would be a mobile web kit </span><span class="line" data-startTime="1417">optimized version and then </span><span class="line" data-startTime="1417">generating what's, let's say a </span><span class="line" data-startTime="1421">browser-agnostic version, people </span><span class="line" data-startTime="1421">sometimes just choose </span><span class="line" data-startTime="1423">to fork things. </span> <span class="line" data-startTime="1424">And obviously then, it's much </span><span class="line" data-startTime="1424">harder to maintain. </span> <span class="line" data-startTime="1428">You have two versions. </span> <span class="line" data-startTime="1429">One has features that the </span><span class="line" data-startTime="1429">other one doesn't. </span> <span class="line" data-startTime="1431">Testing. </span> <span class="line" data-startTime="1432">All the efforts of what you're </span><span class="line" data-startTime="1432">trying to do are now doubled. </span></p>

<p><span class="line" data-startTime="1439">Another one is safeguarding </span><span class="line" data-startTime="1439">private variables. </span> <span class="line" data-startTime="1443">Again, because we have no idea </span><span class="line" data-startTime="1443">of visibility keywords in </span><span class="line" data-startTime="1446">JavaScript. </span> <span class="line" data-startTime="1447">There is no public </span><span class="line" data-startTime="1447">private keyword. </span> <span class="line" data-startTime="1450">A lot of people use Closure to </span><span class="line" data-startTime="1450">emulate the private variables </span><span class="line" data-startTime="1456">in languages like Java. </span> <span class="line" data-startTime="1458">And so this is an implementation </span><span class="line" data-startTime="1458">of how you </span><span class="line" data-startTime="1461">could do this if you imagine, </span><span class="line" data-startTime="1461">ImmutableLatLng, if you </span><span class="line" data-startTime="1463">treated that as a constructor. </span> <span class="line" data-startTime="1464">You passed into lat, lng. </span> <span class="line" data-startTime="1466">You wanted there to be </span><span class="line" data-startTime="1466">getters for these </span><span class="line" data-startTime="1468">properties but not setters. </span> <span class="line" data-startTime="1470">This would do that for you. </span> <span class="line" data-startTime="1472">The downside is that means every </span><span class="line" data-startTime="1472">time you instantiate one </span><span class="line" data-startTime="1476">of these objects &mdash; </span><span class="line" data-startTime="1477">in this case it's creating three </span><span class="line" data-startTime="1477">new function objects as </span><span class="line" data-startTime="1479">opposed to sharing one </span><span class="line" data-startTime="1479">method object. </span> <span class="line" data-startTime="1482">So this will take </span><span class="line" data-startTime="1482">up more memory. </span> <span class="line" data-startTime="1484">It also increases </span><span class="line" data-startTime="1484">look up time. </span></p>

<p><span class="line" data-startTime="1487">Because by using a Closure, you </span><span class="line" data-startTime="1487">actually create an actual </span><span class="line" data-startTime="1489">level of scope. </span> <span class="line" data-startTime="1490">Newer engines like V 8 this </span><span class="line" data-startTime="1490">shouldn't actually be a </span><span class="line" data-startTime="1493">significant difference in terms </span><span class="line" data-startTime="1493">of the look up time. </span> <span class="line" data-startTime="1495">But older browsers, like IE6, </span><span class="line" data-startTime="1495">these things actually become </span><span class="line" data-startTime="1499">more significant. </span> <span class="line" data-startTime="1502">And another thing is </span><span class="line" data-startTime="1502">documenting types. </span> <span class="line" data-startTime="1504">So as I mentioned we don't have </span><span class="line" data-startTime="1504">a standard syntax for </span><span class="line" data-startTime="1508">documenting types of variables </span><span class="line" data-startTime="1508">and methods in JavaScript. </span> <span class="line" data-startTime="1512">But if you're going to have a </span><span class="line" data-startTime="1512">large application and people </span><span class="line" data-startTime="1515">want to be able to look at an </span><span class="line" data-startTime="1515">API really quickly, it's more </span><span class="line" data-startTime="1518">helpful if you have some </span><span class="line" data-startTime="1518">sort of standard </span><span class="line" data-startTime="1520">way to document types. </span></p>

<p><span class="line" data-startTime="1523">Sometimes libraries &mdash; </span><span class="line" data-startTime="1525">this is what Dojo does, </span><span class="line" data-startTime="1525">basically is that you can make </span><span class="line" data-startTime="1528">a little in-line comment. </span> <span class="line" data-startTime="1529">And this is actually pretty good </span><span class="line" data-startTime="1529">as long as it's, you have </span><span class="line" data-startTime="1533">kind of a standard format. </span> <span class="line" data-startTime="1534">But even in this example, you </span><span class="line" data-startTime="1534">have a method that takes some </span><span class="line" data-startTime="1539">number of parameters </span><span class="line" data-startTime="1539">and then you also </span><span class="line" data-startTime="1540">specify a call back function. </span> <span class="line" data-startTime="1541">And a lot of people just say the </span><span class="line" data-startTime="1541">call back is a function. </span> <span class="line" data-startTime="1544">But really, that call </span><span class="line" data-startTime="1544">back has a contract. </span> <span class="line" data-startTime="1546">And in this case it </span><span class="line" data-startTime="1546">would be something </span><span class="line" data-startTime="1550">that takes a lat lng. </span></p>

<p><span class="line" data-startTime="1551">But developers right now usually </span><span class="line" data-startTime="1551">have to take a look at </span><span class="line" data-startTime="1554">the implementation of the method </span><span class="line" data-startTime="1554">to see what the call </span><span class="line" data-startTime="1557">back actually gets </span><span class="line" data-startTime="1557">or test it out. </span> <span class="line" data-startTime="1560">Because it's not expressed in </span><span class="line" data-startTime="1560">the type definition that you </span><span class="line" data-startTime="1563">gave for the argument. </span> <span class="line" data-startTime="1565">It's a lot easier to pick up a </span><span class="line" data-startTime="1565">library and use it if you know </span><span class="line" data-startTime="1569">what the contract of the </span><span class="line" data-startTime="1569">call back function is. </span> <span class="line" data-startTime="1572">Helps you figure out where you </span><span class="line" data-startTime="1572">should send it or actually if </span><span class="line" data-startTime="1574">even if it's the right </span><span class="line" data-startTime="1574">method that you </span><span class="line" data-startTime="1575">should be using or not. </span> <span class="line" data-startTime="1580">So these are a bunch of problems </span><span class="line" data-startTime="1580">that JavaScript </span><span class="line" data-startTime="1581">developers have today. </span> <span class="line" data-startTime="1582">And so I want to go through the </span><span class="line" data-startTime="1582">Closure tools and let's </span><span class="line" data-startTime="1586">take a look at how Closure can </span><span class="line" data-startTime="1586">help you address these </span><span class="line" data-startTime="1589">problems, write better code and </span><span class="line" data-startTime="1589">avoid these pitfalls and </span><span class="line" data-startTime="1593">hopefully avoid bugs. </span> <span class="line" data-startTime="1596">So the first thing is, this </span><span class="line" data-startTime="1596">is basically how &mdash; </span><span class="line" data-startTime="1601">when you use all the Closure </span><span class="line" data-startTime="1601">tools together &mdash; </span><span class="line" data-startTime="1603">how your application is built. </span></p>

<p><span class="line" data-startTime="1606">Or how you produce JavaScript </span><span class="line" data-startTime="1606">at the bottom. </span> <span class="line" data-startTime="1609">So at the top, so one thing you </span><span class="line" data-startTime="1609">would have is you'd have </span><span class="line" data-startTime="1612">template code. </span> <span class="line" data-startTime="1615">I'll show you in a second. </span> <span class="line" data-startTime="1617">Closure Templates is its own </span><span class="line" data-startTime="1617">templating language. </span> <span class="line" data-startTime="1620">So you write your templates in </span><span class="line" data-startTime="1620">that templating language. </span> <span class="line" data-startTime="1624">And then you run it through the </span><span class="line" data-startTime="1624">tool, Closure Templates, </span><span class="line" data-startTime="1626">and that produces JavaScript. </span> <span class="line" data-startTime="1628">So now each template that </span><span class="line" data-startTime="1628">you wrote becomes </span><span class="line" data-startTime="1630">a JavaScript function. </span> <span class="line" data-startTime="1631">The Closure Library, as I said, </span><span class="line" data-startTime="1631">is already a library in </span><span class="line" data-startTime="1634">pure JavaScript. </span> <span class="line" data-startTime="1635">So now you already have your </span><span class="line" data-startTime="1635">JavaScript library for string </span><span class="line" data-startTime="1639">and DOM utilities and all sorts </span><span class="line" data-startTime="1639">of other good stuff. </span> <span class="line" data-startTime="1642">And then the third is your </span><span class="line" data-startTime="1642">application code. </span></p>

<p><span class="line" data-startTime="1645">So you're able to write code </span><span class="line" data-startTime="1645">that leverages both the </span><span class="line" data-startTime="1649">templates and the library code </span><span class="line" data-startTime="1649">that you've written. </span> <span class="line" data-startTime="1652">And all three of these </span><span class="line" data-startTime="1652">things go down </span><span class="line" data-startTime="1654">into the Closure Compiler. </span> <span class="line" data-startTime="1656">And so the Closure Compiler </span><span class="line" data-startTime="1656">is a whole program </span><span class="line" data-startTime="1659">optimize and compiler. </span> <span class="line" data-startTime="1661">Meaning that it has all the </span><span class="line" data-startTime="1661">source code of your </span><span class="line" data-startTime="1663">application at once when </span><span class="line" data-startTime="1663">it compiles it. </span> <span class="line" data-startTime="1665">This is unlike, let's say </span><span class="line" data-startTime="1665">Java, for example. </span> <span class="line" data-startTime="1668">Where some of the assets that go </span><span class="line" data-startTime="1668">through javac are JARs are </span><span class="line" data-startTime="1672">pre-compiled objects and </span><span class="line" data-startTime="1672">therefore there's some </span><span class="line" data-startTime="1677">optimizations that the Closure </span><span class="line" data-startTime="1677">Compiler can do on a global </span><span class="line" data-startTime="1680">level because it has all </span><span class="line" data-startTime="1680">the source code. </span> <span class="line" data-startTime="1684">And then as a result we get </span><span class="line" data-startTime="1684">some optimized JavaScript. </span> <span class="line" data-startTime="1686">We get something that Closure </span><span class="line" data-startTime="1686">Compiler has produced knowing </span><span class="line" data-startTime="1690">all possible code paths, so to </span><span class="line" data-startTime="1690">speak, of your JavaScript </span><span class="line" data-startTime="1694">application. </span></p>

<p><span class="line" data-startTime="1695">And so this is what enables it </span><span class="line" data-startTime="1695">to produce something that's </span><span class="line" data-startTime="1698">really small, really compact </span><span class="line" data-startTime="1698">and really fast. </span> <span class="line" data-startTime="1703">So the first thing I want to </span><span class="line" data-startTime="1703">show you is what the syntax </span><span class="line" data-startTime="1706">for Closure Templates </span><span class="line" data-startTime="1706">look like. </span> <span class="line" data-startTime="1710">There's a namespace </span><span class="line" data-startTime="1710">at the top. </span> <span class="line" data-startTime="1711">In this case I made a namespace </span><span class="line" data-startTime="1711">called widget. </span> <span class="line" data-startTime="1715">The next, I guess this looks </span><span class="line" data-startTime="1715">kind of like Java or Javadoc, </span><span class="line" data-startTime="1719">where you declare the parameters </span><span class="line" data-startTime="1719">that are going to </span><span class="line" data-startTime="1721">be passed into the template. </span> <span class="line" data-startTime="1723">So these are basically your </span><span class="line" data-startTime="1723">template variables below. </span> <span class="line" data-startTime="1728">Then you have your HTML and </span><span class="line" data-startTime="1728">we have this dollar sign </span><span class="line" data-startTime="1731">placeholder type of thing. </span> <span class="line" data-startTime="1734">Which, is probably not too </span><span class="line" data-startTime="1734">surprising if you've looked at </span><span class="line" data-startTime="1737">most other templating </span><span class="line" data-startTime="1737">solutions. </span></p>

<p><span class="line" data-startTime="1738">There's the markup and then </span><span class="line" data-startTime="1738">there's the stuff that you </span><span class="line" data-startTime="1741">want to insert. </span> <span class="line" data-startTime="1744">At the outset, this maybe </span><span class="line" data-startTime="1744">doesn't look too compelling. </span> <span class="line" data-startTime="1747">But what's more interesting is </span><span class="line" data-startTime="1747">that when we run this through </span><span class="line" data-startTime="1751">the Closure Templates tool, </span><span class="line" data-startTime="1751">and so this is what is </span><span class="line" data-startTime="1757">produced once you run </span><span class="line" data-startTime="1757">it through the tool. </span> <span class="line" data-startTime="1760">So what's actually produced </span><span class="line" data-startTime="1760">is a function. </span> <span class="line" data-startTime="1763">So unlike PHP, where PHP is </span><span class="line" data-startTime="1763">also a templating library, </span><span class="line" data-startTime="1767">where you can't really get </span><span class="line" data-startTime="1767">access to it programatically. </span></p>

<p><span class="line" data-startTime="1770">It's kind of like you </span><span class="line" data-startTime="1770">just hit the page </span><span class="line" data-startTime="1771">and stuff just happens. </span> <span class="line" data-startTime="1772">Now this template is actually </span><span class="line" data-startTime="1772">a function. </span> <span class="line" data-startTime="1775">It has, as a parameter </span><span class="line" data-startTime="1775">it has a return type. </span> <span class="line" data-startTime="1780">You can see that it takes </span><span class="line" data-startTime="1780">this object in. </span> <span class="line" data-startTime="1783">And another thing it does for </span><span class="line" data-startTime="1783">you is that, by default, you </span><span class="line" data-startTime="1786">can see that all the arguments </span><span class="line" data-startTime="1786">are escapes. </span> <span class="line" data-startTime="1790">So I made that comment earlier </span><span class="line" data-startTime="1790">about my original definition </span><span class="line" data-startTime="1793">of a function that you'd try to </span><span class="line" data-startTime="1793">do this template, where the </span><span class="line" data-startTime="1799">arguments were not escaped and </span><span class="line" data-startTime="1799">you were subject to cross-site </span><span class="line" data-startTime="1803">scripting vulnerabilities. </span> <span class="line" data-startTime="1805">In Closure Templates, it escapes </span><span class="line" data-startTime="1805">things by default. </span> <span class="line" data-startTime="1808">You can add annotations to say </span><span class="line" data-startTime="1808">don't escape anything in this </span><span class="line" data-startTime="1811">template or don't escape </span><span class="line" data-startTime="1811">this variable. </span></p>

<p><span class="line" data-startTime="1813">But by default, you should </span><span class="line" data-startTime="1813">be a lot safer. </span> <span class="line" data-startTime="1817">Another thing is also that </span><span class="line" data-startTime="1817">by this being a function, </span><span class="line" data-startTime="1821">something you can interact with </span><span class="line" data-startTime="1821">programatically, you can, </span><span class="line" data-startTime="1824">if you're familiar with the idea </span><span class="line" data-startTime="1824">of function carrying, and </span><span class="line" data-startTime="1827">also that in JavaScript that </span><span class="line" data-startTime="1827">functions are first order </span><span class="line" data-startTime="1830">objects, that you can </span><span class="line" data-startTime="1830">pass them around. </span> <span class="line" data-startTime="1832">So programatiically, this is a </span><span class="line" data-startTime="1832">much nicer way to deal with </span><span class="line" data-startTime="1836">the idea of a template. </span> <span class="line" data-startTime="1838">Also, you can see if you look </span><span class="line" data-startTime="1838">carefully, all the white space </span><span class="line" data-startTime="1842">that we put in the template &mdash; </span><span class="line" data-startTime="1844">just to make it readable </span><span class="line" data-startTime="1844">for ourselves &mdash; </span><span class="line" data-startTime="1846">is removed when it's </span><span class="line" data-startTime="1846">translated into </span><span class="line" data-startTime="1848">a JavaScript function. </span> <span class="line" data-startTime="1849">So this saves bytes. </span></p>

<p><span class="line" data-startTime="1851">When you traverse the DOM </span><span class="line" data-startTime="1851">there's actually fewer white </span><span class="line" data-startTime="1853">space nodes that </span><span class="line" data-startTime="1853">get in the way. </span> <span class="line" data-startTime="1854">So these are all nice things </span><span class="line" data-startTime="1854">and help you create markup </span><span class="line" data-startTime="1857">that's basically as trim </span><span class="line" data-startTime="1857">as it can possibly be. </span> <span class="line" data-startTime="1862">Also I want to point out that </span><span class="line" data-startTime="1862">there's these statements that </span><span class="line" data-startTime="1864">got inserted at the top, which </span><span class="line" data-startTime="1864">are goog.provide and </span><span class="line" data-startTime="1868">goog.require, These are </span><span class="line" data-startTime="1868">functions that are part of the </span><span class="line" data-startTime="1871">Closure Library. </span> <span class="line" data-startTime="1873">This is basically how namespaces </span><span class="line" data-startTime="1873">are declared and </span><span class="line" data-startTime="1876">how dependencies are expressed </span><span class="line" data-startTime="1876">in the Closure Library. </span> <span class="line" data-startTime="1878">So as I said, there's no native </span><span class="line" data-startTime="1878">import function in </span><span class="line" data-startTime="1881">JavaScript but when you write </span><span class="line" data-startTime="1881">your code for the Closure </span><span class="line" data-startTime="1883">Library in this style, now you </span><span class="line" data-startTime="1883">have a standard way of </span><span class="line" data-startTime="1886">expressing dependencies and </span><span class="line" data-startTime="1886">we'll see the benefits of that </span><span class="line" data-startTime="1889">in just a second. </span> <span class="line" data-startTime="1892">So the first thing is, now if we </span><span class="line" data-startTime="1892">have this template function </span><span class="line" data-startTime="1895">and now we want to use it. </span></p>

<p><span class="line" data-startTime="1896">So now this file we said </span><span class="line" data-startTime="1896">we provide this </span><span class="line" data-startTime="1900">namespace called widget. </span> <span class="line" data-startTime="1901">Now we'll have some application </span><span class="line" data-startTime="1901">logic, where we </span><span class="line" data-startTime="1904">want to use it. </span> <span class="line" data-startTime="1905">So now there's a goog.require </span><span class="line" data-startTime="1905">statement for widget. </span> <span class="line" data-startTime="1908">And we're actually, ourselves, </span><span class="line" data-startTime="1908">going to provide a new </span><span class="line" data-startTime="1909">namespace called button. </span> <span class="line" data-startTime="1912">So here, we add a method to </span><span class="line" data-startTime="1912">the button namespace by </span><span class="line" data-startTime="1914">declaring it as a property </span><span class="line" data-startTime="1914">on the button object. </span> <span class="line" data-startTime="1917">And the button object got </span><span class="line" data-startTime="1917">created as a side effect of </span><span class="line" data-startTime="1920">running that goog.provide </span><span class="line" data-startTime="1920">statement. </span> <span class="line" data-startTime="1923">And now we add it </span><span class="line" data-startTime="1923">as a property. </span> <span class="line" data-startTime="1925">It's just a function. </span></p>

<p><span class="line" data-startTime="1927">All templates take one argument, </span><span class="line" data-startTime="1927">where the argument </span><span class="line" data-startTime="1930">is an object literal. </span> <span class="line" data-startTime="1932">Where the names of the </span><span class="line" data-startTime="1932">properties are the values for </span><span class="line" data-startTime="1935">the template and the values of </span><span class="line" data-startTime="1935">the property are the values </span><span class="line" data-startTime="1939">for the template values. </span> <span class="line" data-startTime="1940">And so basically we create this </span><span class="line" data-startTime="1940">data object and now we </span><span class="line" data-startTime="1943">can just pass it to </span><span class="line" data-startTime="1943">widget.button as a function, </span><span class="line" data-startTime="1946">return the value and return </span><span class="line" data-startTime="1946">that from get button HTML. </span> <span class="line" data-startTime="1950">I find this to be &mdash; </span><span class="line" data-startTime="1952">many people find this to be &mdash; </span><span class="line" data-startTime="1952">much more maintainable. </span></p>

<p><span class="line" data-startTime="1954">Because now, when you want to </span><span class="line" data-startTime="1954">write your markup, you can </span><span class="line" data-startTime="1956">basically do it in any </span><span class="line" data-startTime="1956">way that you want. </span> <span class="line" data-startTime="1959">You can actually put comments </span><span class="line" data-startTime="1959">in this template that don't </span><span class="line" data-startTime="1962">get included as part the </span><span class="line" data-startTime="1962">markup that's sent out. </span> <span class="line" data-startTime="1967">And you really want </span><span class="line" data-startTime="1967">to write this. </span> <span class="line" data-startTime="1968">But you don't want to </span><span class="line" data-startTime="1968">write it by hand. </span> <span class="line" data-startTime="1970">But that's what you really </span><span class="line" data-startTime="1970">want produced. </span> <span class="line" data-startTime="1971">And now you have that. </span> <span class="line" data-startTime="1972">And now you can use </span><span class="line" data-startTime="1972">that inside your </span><span class="line" data-startTime="1974">regular JavaScript function. </span> <span class="line" data-startTime="1976">So now we're just really </span><span class="line" data-startTime="1976">working in </span><span class="line" data-startTime="1978">the JavaScript world. </span> <span class="line" data-startTime="1981">So as I mentioned, there's these </span><span class="line" data-startTime="1981">dependencies that we've </span><span class="line" data-startTime="1984">expressed through goog.provide </span><span class="line" data-startTime="1984">and goog.require. </span> <span class="line" data-startTime="1986">So at the top we have button, </span><span class="line" data-startTime="1986">which we said requires widget. </span> <span class="line" data-startTime="1991">And widget requires soy, which </span><span class="line" data-startTime="1991">is the internal name of </span><span class="line" data-startTime="1996">Closure Templates. </span></p>

<p><span class="line" data-startTime="1997">You'll see that if you look </span><span class="line" data-startTime="1997">through Closure code. </span> <span class="line" data-startTime="2000">When you see soy it means </span><span class="line" data-startTime="2000">Closure Templates. </span> <span class="line" data-startTime="2002">And in practice, Closure </span><span class="line" data-startTime="2002">Templates by default include a </span><span class="line" data-startTime="2005">bunch of stuff. </span> <span class="line" data-startTime="2005">It includes DOM utilities </span><span class="line" data-startTime="2005">because a lot of times you </span><span class="line" data-startTime="2008">want to take the result of the </span><span class="line" data-startTime="2008">template and put it into a DOM </span><span class="line" data-startTime="2011">node or create a document </span><span class="line" data-startTime="2011">fragment out of it. </span> <span class="line" data-startTime="2013">It includes string utilities for </span><span class="line" data-startTime="2013">doing the escaping and it </span><span class="line" data-startTime="2016">also includes a lot </span><span class="line" data-startTime="2016">of utilities for </span><span class="line" data-startTime="2019">internationalization. </span> <span class="line" data-startTime="2020">So there's actually support </span><span class="line" data-startTime="2020">for internationalization. </span> <span class="line" data-startTime="2023">In JavaScript Templates there's </span><span class="line" data-startTime="2023">a special message tag. </span> <span class="line" data-startTime="2027">So if You're building an </span><span class="line" data-startTime="2027">application that you want to </span><span class="line" data-startTime="2030">localize, Closure Templates </span><span class="line" data-startTime="2030">helps with that as well. </span></p>

<p><span class="line" data-startTime="2034">But the thing is though, in the </span><span class="line" data-startTime="2034">example that I gave, we're </span><span class="line" data-startTime="2037">actually not using all </span><span class="line" data-startTime="2037">that stuff, right? </span><span class="line" data-startTime="2038">We never used the </span><span class="line" data-startTime="2038">DOM utilities. </span> <span class="line" data-startTime="2040">We never used </span><span class="line" data-startTime="2040">internationalization. </span> <span class="line" data-startTime="2043">A lot of people will choose to </span><span class="line" data-startTime="2043">maintain these dependencies by </span><span class="line" data-startTime="2047">hand saying, oh I don't want </span><span class="line" data-startTime="2047">to include all that stuff. </span> <span class="line" data-startTime="2050">But as we'll see, the Closure </span><span class="line" data-startTime="2050">Compiler will take care of </span><span class="line" data-startTime="2052">that for you. </span> <span class="line" data-startTime="2053">So it's OK to create large </span><span class="line" data-startTime="2053">libraries, where you, in </span><span class="line" data-startTime="2057">practice later, only use </span><span class="line" data-startTime="2057">some of the functions. </span> <span class="line" data-startTime="2060">Because you're going to want to </span><span class="line" data-startTime="2060">supply these libraries to, </span><span class="line" data-startTime="2063">say, other teammates or </span><span class="line" data-startTime="2063">for other projects </span><span class="line" data-startTime="2066">that you maybe use. </span> <span class="line" data-startTime="2067">So in practice, we'll see how </span><span class="line" data-startTime="2067">actually the DOM utilities and </span><span class="line" data-startTime="2070">the internationalization stuff </span><span class="line" data-startTime="2070">gets stripped out. </span> <span class="line" data-startTime="2072">You don't pay some penalty for </span><span class="line" data-startTime="2072">using a more mature library. </span> <span class="line" data-startTime="2078">So for example, in terms of </span><span class="line" data-startTime="2078">leveraging dependencies, we'll </span><span class="line" data-startTime="2083">introduce a new one </span><span class="line" data-startTime="2083">called myapp. </span></p>

<p><span class="line" data-startTime="2084">Now let's say this is </span><span class="line" data-startTime="2084">your application. </span> <span class="line" data-startTime="2086">And now you require button and </span><span class="line" data-startTime="2086">you require some DOM utilities </span><span class="line" data-startTime="2089">and now you have a function that </span><span class="line" data-startTime="2089">goes ahead and uses the </span><span class="line" data-startTime="2093">template and inserts it into </span><span class="line" data-startTime="2093">the DOM with these standard </span><span class="line" data-startTime="2096">DOM utilities. </span> <span class="line" data-startTime="2097">So now the dependency </span><span class="line" data-startTime="2097">graph for your </span><span class="line" data-startTime="2099">application has changed. </span> <span class="line" data-startTime="2100">Now we have a new thing </span><span class="line" data-startTime="2100">at the root of the </span><span class="line" data-startTime="2102">graph called myapp. </span> <span class="line" data-startTime="2103">It depends on button and </span><span class="line" data-startTime="2103">its dependencies still </span><span class="line" data-startTime="2106">go all the way down. </span> <span class="line" data-startTime="2107">But now myapp depends on DOM. </span> <span class="line" data-startTime="2109">And so now actually that DOM </span><span class="line" data-startTime="2109">dependency is going to come </span><span class="line" data-startTime="2112">back into our code. </span> <span class="line" data-startTime="2114">But the internationalization one </span><span class="line" data-startTime="2114">will still be separated. </span> <span class="line" data-startTime="2117">This is really nice because this </span><span class="line" data-startTime="2117">all happens naturally, as </span><span class="line" data-startTime="2121">we'll see with the </span><span class="line" data-startTime="2121">Closure Compiler. </span> <span class="line" data-startTime="2123">As opposed to trying to manage </span><span class="line" data-startTime="2123">all those script tags by hand </span><span class="line" data-startTime="2125">and trying to figure out what </span><span class="line" data-startTime="2125">the dependency ordering is and </span><span class="line" data-startTime="2129">trying to find the minimal set </span><span class="line" data-startTime="2129">because you want to send down </span><span class="line" data-startTime="2131">the least JavaScript </span><span class="line" data-startTime="2131">code as possible. </span> <span class="line" data-startTime="2136">Jumping right into the Closure </span><span class="line" data-startTime="2136">Compiler and looking at some </span><span class="line" data-startTime="2139">of the effects. </span></p>

<p><span class="line" data-startTime="2141">So the Closure Compiler, now </span><span class="line" data-startTime="2141">with code that is written in </span><span class="line" data-startTime="2144">the style, it understands </span><span class="line" data-startTime="2144">these goog.provide and </span><span class="line" data-startTime="2146">goog.require statements. </span> <span class="line" data-startTime="2148">Now this is where it gets pretty </span><span class="line" data-startTime="2148">serious in terms of the </span><span class="line" data-startTime="2150">savings that it can give </span><span class="line" data-startTime="2150">you in terms of your </span><span class="line" data-startTime="2154">JavaScript code size. </span> <span class="line" data-startTime="2155">So by default, if you just </span><span class="line" data-startTime="2155">concatenated all the files </span><span class="line" data-startTime="2158">that would be transitively </span><span class="line" data-startTime="2158">required, by that myapp.js </span><span class="line" data-startTime="2162">file that I created, it's </span><span class="line" data-startTime="2162">375K, approximately. </span> <span class="line" data-startTime="2167">Very very, large. </span> <span class="line" data-startTime="2169">That is a lot of code. </span> <span class="line" data-startTime="2169">Especially for something as </span><span class="line" data-startTime="2169">trivial that we were doing. </span> <span class="line" data-startTime="2172">We were just building </span><span class="line" data-startTime="2172">up some HTML and </span><span class="line" data-startTime="2174">inserting it into a DOM. </span> <span class="line" data-startTime="2176">So that does seem </span><span class="line" data-startTime="2176">a bit excessive. </span> <span class="line" data-startTime="2181">But then if you run the Closure </span><span class="line" data-startTime="2181">Compiler, there's a </span><span class="line" data-startTime="2183">mode called whitespace only. </span></p>

<p><span class="line" data-startTime="2184">Where all it does is remove </span><span class="line" data-startTime="2184">whitespace and comments. </span> <span class="line" data-startTime="2188">This already gets you </span><span class="line" data-startTime="2188">down quite a bit. </span> <span class="line" data-startTime="2190">So as you may guess, the Closure </span><span class="line" data-startTime="2190">Library is actually </span><span class="line" data-startTime="2194">pretty well documented </span><span class="line" data-startTime="2194">since that got rid of </span><span class="line" data-startTime="2196">almost 75% of the code. </span> <span class="line" data-startTime="2198">So that's a pretty big </span><span class="line" data-startTime="2198">win right there. </span> <span class="line" data-startTime="2202">By comparison, I also ran the </span><span class="line" data-startTime="2202">same code through YUI </span><span class="line" data-startTime="2206">Compressor and UglifyJS. </span> <span class="line" data-startTime="2208">These are some other minifiers </span><span class="line" data-startTime="2208">that are popular right now. </span> <span class="line" data-startTime="2212">You can see they do </span><span class="line" data-startTime="2212">a bit better than </span><span class="line" data-startTime="2214">whitespace only mode. </span></p>

<p><span class="line" data-startTime="2216">And the Closure Compiler also </span><span class="line" data-startTime="2216">has the simple mode, which is </span><span class="line" data-startTime="2218">analogous to the YUI Compressor </span><span class="line" data-startTime="2218">and UglifyJS. </span> <span class="line" data-startTime="2221">And you can see it just ekes </span><span class="line" data-startTime="2221">them out by a little bit. </span> <span class="line" data-startTime="2223">But we're not looking at an </span><span class="line" data-startTime="2223">order of magnitude of </span><span class="line" data-startTime="2226">difference. </span> <span class="line" data-startTime="2227">Until we look at the advanced </span><span class="line" data-startTime="2227">mode of the Closure Compiler. </span> <span class="line" data-startTime="2230">The advanced mode is quite </span><span class="line" data-startTime="2230">a different animal. </span> <span class="line" data-startTime="2233">Basically what it can do is, </span><span class="line" data-startTime="2233">as I mentioned it's a whole </span><span class="line" data-startTime="2237">program optimize and compiler. </span> <span class="line" data-startTime="2239">So it basically traces </span><span class="line" data-startTime="2239">the code paths </span><span class="line" data-startTime="2242">from the main method. </span> <span class="line" data-startTime="2245">From this main method. </span> <span class="line" data-startTime="2245">So this is the only function </span><span class="line" data-startTime="2245">that's actually called in this </span><span class="line" data-startTime="2249">application. </span></p>

<p><span class="line" data-startTime="2249">And it can trace through and </span><span class="line" data-startTime="2249">realize that, OK, the only </span><span class="line" data-startTime="2252">things that are called ate </span><span class="line" data-startTime="2252">getButtonHtml getElement and </span><span class="line" data-startTime="2255">so on and so forth. </span> <span class="line" data-startTime="2256">And then when it's done </span><span class="line" data-startTime="2256">optimizing, it will only </span><span class="line" data-startTime="2260">include the bits that it needs, </span><span class="line" data-startTime="2260">that it's determined </span><span class="line" data-startTime="2264">that will be exercised by this </span><span class="line" data-startTime="2264">JavaScript application. </span> <span class="line" data-startTime="2268">So now we've gotten down to </span><span class="line" data-startTime="2268">something that's 1/200 of the </span><span class="line" data-startTime="2271">original size of what we </span><span class="line" data-startTime="2271">were dealing with. </span></p>

<p><span class="line" data-startTime="2274">This is obviously a much better </span><span class="line" data-startTime="2274">way, to let a tool do </span><span class="line" data-startTime="2277">this for you than do this </span><span class="line" data-startTime="2277">type of thing by hand. </span> <span class="line" data-startTime="2281">And even to go one step further </span><span class="line" data-startTime="2281">is that you can enable </span><span class="line" data-startTime="2286">options to eliminate </span><span class="line" data-startTime="2286">platform-specific code. </span> <span class="line" data-startTime="2289">So if you have these special </span><span class="line" data-startTime="2289">defines, these special options </span><span class="line" data-startTime="2292">pass through the compiler, you </span><span class="line" data-startTime="2292">can say, assume that it's </span><span class="line" data-startTime="2295">mobile web kit and also assume </span><span class="line" data-startTime="2295">it's not JScript, which is the </span><span class="line" data-startTime="2298">engine in Internet Explorer. </span> <span class="line" data-startTime="2300">And in this particular example, </span><span class="line" data-startTime="2300">this won't be true </span><span class="line" data-startTime="2302">for all examples, but it gets </span><span class="line" data-startTime="2302">the whole program down to 481 </span><span class="line" data-startTime="2306">bytes, which is basically </span><span class="line" data-startTime="2306">nothing. </span> <span class="line" data-startTime="2309">And this is all being done for </span><span class="line" data-startTime="2309">you, as opposed to you trying </span><span class="line" data-startTime="2312">to reorganize your code and </span><span class="line" data-startTime="2312">optimize it by hand in order </span><span class="line" data-startTime="2315">to get this same result. </span></p>

<p><span class="line" data-startTime="2319">So again, this also comes back </span><span class="line" data-startTime="2319">to, I mentioned that libraries </span><span class="line" data-startTime="2322">Zepto.js and jQuery where people </span><span class="line" data-startTime="2322">are making these forks. </span> <span class="line" data-startTime="2325">Where instead if they were just </span><span class="line" data-startTime="2325">writing their code in a </span><span class="line" data-startTime="2328">way that you could eliminate </span><span class="line" data-startTime="2328">blocks of code using the </span><span class="line" data-startTime="2331">compiler, then they could share </span><span class="line" data-startTime="2331">much more of the common </span><span class="line" data-startTime="2334">code as opposed to having to do </span><span class="line" data-startTime="2334">a giant fork, which is much </span><span class="line" data-startTime="2338">harder to keep in sync. </span> <span class="line" data-startTime="2341">So if we look, this </span><span class="line" data-startTime="2341">is the output </span><span class="line" data-startTime="2344">of the Closure Compiler. </span> <span class="line" data-startTime="2345">It's very, very compact. </span> <span class="line" data-startTime="2347">I was at the JavaScript </span><span class="line" data-startTime="2347">conference last week and </span><span class="line" data-startTime="2350">someone made the astute </span><span class="line" data-startTime="2350">remark of, I don't </span><span class="line" data-startTime="2352">want to be a compiler. </span></p>

<p><span class="line" data-startTime="2353">I want a compiler to </span><span class="line" data-startTime="2353">be a compiler. </span> <span class="line" data-startTime="2355">And I think that's </span><span class="line" data-startTime="2355">a good adage. </span> <span class="line" data-startTime="2358">But right now we see a lot of </span><span class="line" data-startTime="2358">people just trying to use </span><span class="line" data-startTime="2360">short variable names and some </span><span class="line" data-startTime="2360">other things and trying to do </span><span class="line" data-startTime="2363">it all by hand. </span> <span class="line" data-startTime="2364">But no one is going to write </span><span class="line" data-startTime="2364">this type of code by hand, </span><span class="line" data-startTime="2368">even though this is really </span><span class="line" data-startTime="2368">what we want </span><span class="line" data-startTime="2370">produced at the outset. </span> <span class="line" data-startTime="2371">And as your application gets </span><span class="line" data-startTime="2371">larger and larger, it's even </span><span class="line" data-startTime="2375">more important. </span> <span class="line" data-startTime="2375">Because you can imagine, with </span><span class="line" data-startTime="2375">that example of five script </span><span class="line" data-startTime="2377">tags, you can imagine someone </span><span class="line" data-startTime="2377">growing their application to </span><span class="line" data-startTime="2381">be 20 script tags and then </span><span class="line" data-startTime="2381">someone copy-pastes it because </span><span class="line" data-startTime="2383">they think it's what they need </span><span class="line" data-startTime="2383">for their next project. </span> <span class="line" data-startTime="2386">It's just not a way to do large </span><span class="line" data-startTime="2386">JavaScript development. </span></p>

<p><span class="line" data-startTime="2390">Especially when it's really </span><span class="line" data-startTime="2390">important that something </span><span class="line" data-startTime="2392">really compact, like what you </span><span class="line" data-startTime="2392">see here, is the result. </span> <span class="line" data-startTime="2397">Another important thing to think </span><span class="line" data-startTime="2397">about as well is that, </span><span class="line" data-startTime="2399">as our applications are getting </span><span class="line" data-startTime="2399">larger in JavaScript, </span><span class="line" data-startTime="2402">that there's a lot more IP, </span><span class="line" data-startTime="2402">intellectual property, that's </span><span class="line" data-startTime="2406">going into these things </span><span class="line" data-startTime="2406">that we are </span><span class="line" data-startTime="2407">sending down to our users. </span> <span class="line" data-startTime="2409">And if you've built a very large </span><span class="line" data-startTime="2409">JavaScript application, </span><span class="line" data-startTime="2413">and now say, you're putting it </span><span class="line" data-startTime="2413">in the Chrome Web Store or </span><span class="line" data-startTime="2416">various other places, you don't </span><span class="line" data-startTime="2416">want to be giving your </span><span class="line" data-startTime="2418">source code away, necessarily. </span></p>

<p><span class="line" data-startTime="2420">So even though it's not the </span><span class="line" data-startTime="2420">primary goal the of the </span><span class="line" data-startTime="2423">Compiler, it also effectively </span><span class="line" data-startTime="2423">serves as an obfuscator. </span> <span class="line" data-startTime="2426">It makes it much more difficult </span><span class="line" data-startTime="2426">for someone to take </span><span class="line" data-startTime="2428">the code that they get and then </span><span class="line" data-startTime="2428">add their own features to </span><span class="line" data-startTime="2432">it and then claim </span><span class="line" data-startTime="2432">it as their own. </span> <span class="line" data-startTime="2433">So that's another aspect, I </span><span class="line" data-startTime="2433">think, that's kind of unique </span><span class="line" data-startTime="2436">to development in the large </span><span class="line" data-startTime="2436">right now, is that the bulk of </span><span class="line" data-startTime="2440">the code is so much </span><span class="line" data-startTime="2440">more interesting. </span> <span class="line" data-startTime="2441">It took you so much more time </span><span class="line" data-startTime="2441">to build up, if you're doing </span><span class="line" data-startTime="2444">it for business reasons, that </span><span class="line" data-startTime="2444">you need to have a better way </span><span class="line" data-startTime="2447">to protect it. </span></p>

<p><span class="line" data-startTime="2451">Also, as I mentioned, there's </span><span class="line" data-startTime="2451">no type system built into </span><span class="line" data-startTime="2455">JavaScript natively. </span> <span class="line" data-startTime="2456">So one of the better ways to </span><span class="line" data-startTime="2456">approximate it is by using </span><span class="line" data-startTime="2460">basically something </span><span class="line" data-startTime="2460">like annotations. </span> <span class="line" data-startTime="2461">And this is what we see here. </span> <span class="line" data-startTime="2462">We have some JS stock, as we </span><span class="line" data-startTime="2462">call it, and where we have &mdash; </span><span class="line" data-startTime="2467">we have app param tags </span><span class="line" data-startTime="2467">like you're kind of </span><span class="line" data-startTime="2469">accustomed to from Java. </span> <span class="line" data-startTime="2471">But then the thing in curly </span><span class="line" data-startTime="2471">braces is what's called a type </span><span class="line" data-startTime="2473">expression. </span></p>

<p><span class="line" data-startTime="2474">And it basically says, this is </span><span class="line" data-startTime="2474">the valid types that can be </span><span class="line" data-startTime="2478">passed in for this argument. </span> <span class="line" data-startTime="2479">We also have this annotation </span><span class="line" data-startTime="2479">for a constructor. </span> <span class="line" data-startTime="2482">So that basically says that, if </span><span class="line" data-startTime="2482">the compiler sees you using </span><span class="line" data-startTime="2487">this LatLng function but not </span><span class="line" data-startTime="2487">using it with the new key </span><span class="line" data-startTime="2489">word, it will yell at you. </span> <span class="line" data-startTime="2490">Because it recognizes that </span><span class="line" data-startTime="2490">this is the constructor. </span> <span class="line" data-startTime="2492">It's something that's meant </span><span class="line" data-startTime="2492">to be instantiated. </span> <span class="line" data-startTime="2494">It's not an ordinary function. </span> <span class="line" data-startTime="2498">Similarly there's also this </span><span class="line" data-startTime="2498">app private annotation. </span> <span class="line" data-startTime="2502">And it's not on by default but </span><span class="line" data-startTime="2502">you can add a check to the </span><span class="line" data-startTime="2505">Compiler that says, make sure </span><span class="line" data-startTime="2505">all accesses to something </span><span class="line" data-startTime="2508">annotated with app private are </span><span class="line" data-startTime="2508">only done from what's inside a </span><span class="line" data-startTime="2512">Closure class. </span> <span class="line" data-startTime="2513">So again, as opposed to creating </span><span class="line" data-startTime="2513">those somewhat clunky </span><span class="line" data-startTime="2517">closures, now you have a way </span><span class="line" data-startTime="2517">that better communicates what </span><span class="line" data-startTime="2521">you're trying to do, much </span><span class="line" data-startTime="2521">more succinctly by </span><span class="line" data-startTime="2522">just saying app private. </span> <span class="line" data-startTime="2523">It also eliminates that run time </span><span class="line" data-startTime="2523">overhead, you had before, </span><span class="line" data-startTime="2527">of creating a closure. </span> <span class="line" data-startTime="2529">Now instead of calling a getter </span><span class="line" data-startTime="2529">method, the Compiler </span><span class="line" data-startTime="2532">can change those getter methods </span><span class="line" data-startTime="2532">into direct property </span><span class="line" data-startTime="2535">look ups, it can in line them, </span><span class="line" data-startTime="2535">and this can further reduce </span><span class="line" data-startTime="2538">code size and improve run </span><span class="line" data-startTime="2538">time performance. </span></p>

<p><span class="line" data-startTime="2543">Also that these type </span><span class="line" data-startTime="2543">expressions, they also enable </span><span class="line" data-startTime="2549">static typing. </span> <span class="line" data-startTime="2550">So the Compiler also has logic </span><span class="line" data-startTime="2550">to enforce your types. </span> <span class="line" data-startTime="2554">So just something that you're </span><span class="line" data-startTime="2554">accustomed from the Java </span><span class="line" data-startTime="2555">compiler or any other very </span><span class="line" data-startTime="2555">strongly typed language, this </span><span class="line" data-startTime="2559">is something that you can turn </span><span class="line" data-startTime="2559">on and have it check to make </span><span class="line" data-startTime="2562">sure that the contracts </span><span class="line" data-startTime="2562">that you've </span><span class="line" data-startTime="2563">declared are being honored. </span> <span class="line" data-startTime="2564">It actually is able to work with </span><span class="line" data-startTime="2564">partial type information </span><span class="line" data-startTime="2568">in that you may not </span><span class="line" data-startTime="2568">document the types </span><span class="line" data-startTime="2570">for all your functions. </span> <span class="line" data-startTime="2571">But where you do, the compiler </span><span class="line" data-startTime="2571">will leverage it and where you </span><span class="line" data-startTime="2574">don't, it'll basically </span><span class="line" data-startTime="2574">make a best effort. </span> <span class="line" data-startTime="2577">But it shouldn't return </span><span class="line" data-startTime="2577">false positives. </span> <span class="line" data-startTime="2582">Finally there's a rich type </span><span class="line" data-startTime="2582">expression language. </span> <span class="line" data-startTime="2584">So as I mentioned before, we </span><span class="line" data-startTime="2584">often see things where someone </span><span class="line" data-startTime="2588">just declares a callback. </span> <span class="line" data-startTime="2590">Now there's actually a standard </span><span class="line" data-startTime="2590">way, or at least from </span><span class="line" data-startTime="2592">the perspective of the Closure </span><span class="line" data-startTime="2592">Compiler, so that you can say, </span><span class="line" data-startTime="2595">this is a function that takes a </span><span class="line" data-startTime="2595">LatLng object, which may be </span><span class="line" data-startTime="2598">null, which is what the question </span><span class="line" data-startTime="2598">mark at the front of </span><span class="line" data-startTime="2601">that LatLng signifies. </span></p>

<p><span class="line" data-startTime="2602">You can also specify if it's a </span><span class="line" data-startTime="2602">var function, the type of its </span><span class="line" data-startTime="2606">return type. </span> <span class="line" data-startTime="2606">This one didn't happen to </span><span class="line" data-startTime="2606">have a return type. </span> <span class="line" data-startTime="2609">And this is a win, both for </span><span class="line" data-startTime="2609">the Compiler, because it's </span><span class="line" data-startTime="2612">able to do type checking </span><span class="line" data-startTime="2612">on more complex </span><span class="line" data-startTime="2615">expressions like functions. </span> <span class="line" data-startTime="2617">But also for your developers, </span><span class="line" data-startTime="2617">because they can go and run </span><span class="line" data-startTime="2620">through the code and look </span><span class="line" data-startTime="2620">really quickly. </span> <span class="line" data-startTime="2621">Like, oh I just need to pass a </span><span class="line" data-startTime="2621">function that takes a LatLng? </span><span class="line" data-startTime="2624">Excellent. </span> <span class="line" data-startTime="2625">As opposed to having to dig </span><span class="line" data-startTime="2625">through the code to figure out </span><span class="line" data-startTime="2628">exactly what it does. </span> <span class="line" data-startTime="2632">So to try to bring all together, </span><span class="line" data-startTime="2632">JavaScript code </span><span class="line" data-startTime="2635">bases are getting larger. </span></p>

<p><span class="line" data-startTime="2637">I think the Chrome Books </span><span class="line" data-startTime="2637">announcement today is also </span><span class="line" data-startTime="2639">very exciting in this regard </span><span class="line" data-startTime="2639">in that people are going to </span><span class="line" data-startTime="2642">want to make bigger </span><span class="line" data-startTime="2642">and bigger apps. </span> <span class="line" data-startTime="2644">They're going to have to be in </span><span class="line" data-startTime="2644">JavaScript at some level, </span><span class="line" data-startTime="2646">either translated from GWT </span><span class="line" data-startTime="2646">or writing them directly. </span> <span class="line" data-startTime="2649">Especially if you want </span><span class="line" data-startTime="2649">them to work offline. </span> <span class="line" data-startTime="2651">Because then all you have </span><span class="line" data-startTime="2651">when it works offline is </span><span class="line" data-startTime="2653">JavaScript, HTML and CSS. </span> <span class="line" data-startTime="2657">So as we are bringing more </span><span class="line" data-startTime="2657">complex applications to the </span><span class="line" data-startTime="2664">web, these code bases are </span><span class="line" data-startTime="2664">going to get larger. </span> <span class="line" data-startTime="2668">And JavaScript, unfortunately, </span><span class="line" data-startTime="2668">was not designed for </span><span class="line" data-startTime="2670">programming in the large. </span> <span class="line" data-startTime="2671">And so one way is to try to </span><span class="line" data-startTime="2671">escape it and run to another </span><span class="line" data-startTime="2674">programming language. </span></p>

<p><span class="line" data-startTime="2675">But another option is to try to </span><span class="line" data-startTime="2675">tame it, so to speak, with </span><span class="line" data-startTime="2678">the Closure tools. </span> <span class="line" data-startTime="2679">And that is what, in </span><span class="line" data-startTime="2679">my experiences, </span><span class="line" data-startTime="2683">worked quite well. </span> <span class="line" data-startTime="2685">And so I encourage you not to </span><span class="line" data-startTime="2685">run from JavaScript but to </span><span class="line" data-startTime="2688">give it a big bear </span><span class="line" data-startTime="2688">hug instead. </span> <span class="line" data-startTime="2691">But use the Closure tools </span><span class="line" data-startTime="2691">to tame it so that your </span><span class="line" data-startTime="2694">application can grow but </span><span class="line" data-startTime="2694">not grow out of hand. </span> <span class="line" data-startTime="2698">So thank you very much. </span> <span class="line" data-startTime="2699">And I now have time </span><span class="line" data-startTime="2699">for questions. </span> <span class="line" data-startTime="2700">[APPLAUSE] </span><span class="line" data-startTime="2709">Yep? </span></p>

<p class="speaker"><span class="line" data-starttime="2711"><span class="speakerName">Audience</span>: I'm not sure I know </span><span class="line" data-startTime="2711">anybody who's starting on a </span><span class="line" data-startTime="2715">really big JavaScript project. </span> <span class="line" data-startTime="2717">We already have JavaScript </span><span class="line" data-startTime="2717">projects and we're probably </span><span class="line" data-startTime="2720">not using Closure tools. </span> <span class="line" data-startTime="2721">Very few people are outside </span><span class="line" data-startTime="2721">of Google, I feel like. </span> <span class="line" data-startTime="2724">How do you transition a very, </span><span class="line" data-startTime="2724">very large project &mdash; </span><span class="line" data-startTime="2727">I mean the sort of project that </span><span class="line" data-startTime="2727">would actually benefit </span><span class="line" data-startTime="2729">from Closure tools &mdash; </span><span class="line" data-startTime="2730">onto it without like, OK well, </span><span class="line" data-startTime="2730">we're just going to spend the </span><span class="line" data-startTime="2734">next three months writing </span><span class="line" data-startTime="2734">comments? </span></p>

<p class="speaker"><span class="line" data-starttime="2737"><span class="speakerName">Michael Bolin</span>: So I think, </span><span class="line" data-startTime="2737">like any migration, you </span><span class="line" data-startTime="2740">certainly want to </span><span class="line" data-startTime="2740">do it in pieces. </span> <span class="line" data-startTime="2742">And you obviously don't want to </span><span class="line" data-startTime="2742">hold up, prevent yourself </span><span class="line" data-startTime="2745">from making any sort of forward </span><span class="line" data-startTime="2745">progress while you're </span><span class="line" data-startTime="2748">in transition. </span> <span class="line" data-startTime="2749">So the first thing I would say </span><span class="line" data-startTime="2749">is using goog.provide and </span><span class="line" data-startTime="2753">goog.require, having some </span><span class="line" data-startTime="2753">scaffolding to express the </span><span class="line" data-startTime="2757">dependencies in your </span><span class="line" data-startTime="2757">application. </span> <span class="line" data-startTime="2759">I would say that is step one. </span> <span class="line" data-startTime="2762">Step two is then, you probably </span><span class="line" data-startTime="2762">have some existing logic for </span><span class="line" data-startTime="2768">things like registering event </span><span class="line" data-startTime="2768">listeners or array utilities. </span> <span class="line" data-startTime="2773">And then I think what you do is </span><span class="line" data-startTime="2773">you choose one at a time to </span><span class="line" data-startTime="2776">swap out what your home-brewed </span><span class="line" data-startTime="2776">solution with the Closure </span><span class="line" data-startTime="2779">Library equivalent and then </span><span class="line" data-startTime="2779">you progressively do that. </span></p>

<p><span class="line" data-startTime="2782">This is also what happened </span><span class="line" data-startTime="2782">inside Google. </span> <span class="line" data-startTime="2784">The Library didn't exist </span><span class="line" data-startTime="2784">forever and we had long </span><span class="line" data-startTime="2787">running applications that </span><span class="line" data-startTime="2787">were already built up. </span> <span class="line" data-startTime="2790">And it was the same problem. </span> <span class="line" data-startTime="2791">Because you don't want to just </span><span class="line" data-startTime="2791">copy it all in in one day. </span> <span class="line" data-startTime="2793">Because then your application </span><span class="line" data-startTime="2793">doubles in size and that's not </span><span class="line" data-startTime="2795">really great for your </span><span class="line" data-startTime="2795">users either. </span> <span class="line" data-startTime="2797">So I think you definitely want </span><span class="line" data-startTime="2797">to stage it and you definitely </span><span class="line" data-startTime="2800">want to pick. </span> <span class="line" data-startTime="2801">Create the scaffolding with the </span><span class="line" data-startTime="2801">require and provide and </span><span class="line" data-startTime="2803">then move things in </span><span class="line" data-startTime="2803">as you go forward. </span></p>

<p class="speaker"><span class="line" data-starttime="2805"><span class="speakerName">Audience</span>: I should clarify. </span><span class="line" data-startTime="2806">We're already using Dojo </span><span class="line" data-startTime="2806">provide and require. </span><span class="line" data-startTime="2809">So we already have something </span><span class="line" data-startTime="2809">in place. </span><span class="line" data-startTime="2812">Certainly we could replace </span><span class="line" data-startTime="2812">them with googs. </span><span class="line" data-startTime="2813">No problem. </span><span class="line" data-startTime="2814">But it's actually really the </span><span class="line" data-startTime="2814">Closure Compiler, which seems </span><span class="line" data-startTime="2817">like it's an all or </span><span class="line" data-startTime="2817">nothing thing. </span><span class="line" data-startTime="2819">Like either everything is marked </span><span class="line" data-startTime="2819">up with comments so it </span><span class="line" data-startTime="2822">knows what to delete or it </span><span class="line" data-startTime="2822">deletes your application. </span></p>

<p class="speaker"><span class="line" data-starttime="2827"><span class="speakerName">Michael Bolin</span>: As I showed, the </span><span class="line" data-startTime="2827">Closure Compiler does have </span><span class="line" data-startTime="2828">different modes. </span><span class="line" data-startTime="2829">So there's simple mode, </span><span class="line" data-startTime="2829">for example. </span></p>

<p class="speaker"><span class="line" data-starttime="2831"><span class="speakerName">Audience</span>: I really want </span><span class="line" data-startTime="2831">advanced mode. </span><span class="line" data-startTime="2832">That's where I feel like </span><span class="line" data-startTime="2832">I get the big benefit. </span><span class="line" data-startTime="2834">How do I ever get there? </span><span class="line" data-startTime="2835">It's a million miles away. </span></p>

<p class="speaker"><span class="line" data-starttime="2837"><span class="speakerName">Michael Bolin</span>: I think that </span><span class="line" data-startTime="2837">some people in the Dojo </span><span class="line" data-startTime="2839">community, well I'm sure more </span><span class="line" data-startTime="2839">than some, are interested in </span><span class="line" data-startTime="2841">this as well. </span> <span class="line" data-startTime="2843">Another thing you can do is, the </span><span class="line" data-startTime="2843">compiler is open source. </span> <span class="line" data-startTime="2845">It is written in Java and it has </span><span class="line" data-startTime="2845">its own plugin system such </span><span class="line" data-startTime="2848">that you can write new </span><span class="line" data-startTime="2848">compiler passes. </span> <span class="line" data-startTime="2851">So if you have a large, if you </span><span class="line" data-startTime="2851">feel like your code base is </span><span class="line" data-startTime="2855">too large to migrate, the right </span><span class="line" data-startTime="2855">thing to do, or the </span><span class="line" data-startTime="2857">simplest thing to do &mdash; </span><span class="line" data-startTime="2857">as simple as writing </span><span class="line" data-startTime="2859">compiler code is &mdash; </span><span class="line" data-startTime="2861">but is to write your own pass. </span></p>

<p><span class="line" data-startTime="2864">Fortunately the Closure </span><span class="line" data-startTime="2864">Compiler has a </span><span class="line" data-startTime="2865">lot of passes already. </span> <span class="line" data-startTime="2866">And they're also very </span><span class="line" data-startTime="2866">well unit tested. </span> <span class="line" data-startTime="2868">So if you break something </span><span class="line" data-startTime="2868">it'll be pretty clear. </span> <span class="line" data-startTime="2871">And you also have a lot of </span><span class="line" data-startTime="2871">sample code to go off. </span> <span class="line" data-startTime="2873">So you might want to write your </span><span class="line" data-startTime="2873">own pass that understands </span><span class="line" data-startTime="2875">Dojo a bit better. </span> <span class="line" data-startTime="2877">And then that may be the best </span><span class="line" data-startTime="2877">way for you to leverage it. </span></p>

<p class="speaker"><span class="line" data-starttime="2880"><span class="speakerName">Audience</span>: So we don't have </span><span class="line" data-startTime="2880">a lot of, even Dojo </span><span class="line" data-startTime="2881">doc common in there. </span></p>

<p class="speaker"><span class="line" data-starttime="2885"><span class="speakerName">Michael Bolin</span>: What </span><span class="line" data-startTime="2885">do you have? </span></p>

<p class="speaker"><span class="line" data-starttime="2887"><span class="speakerName">Audience</span>: We've got comments. </span><span class="line" data-startTime="2888">We've got sort of ordinary </span><span class="line" data-startTime="2888">comments. </span><span class="line" data-startTime="2890">But we didn't make type </span><span class="line" data-startTime="2890">parameter comments. </span><span class="line" data-startTime="2892">Who would, right? </span><span class="line" data-startTime="2893">What's the point of those? </span></p>

<p class="speaker"><span class="line" data-starttime="2897"><span class="speakerName">Michael Bolin</span>: Type checking is </span><span class="line" data-startTime="2897">an option of the advanced </span><span class="line" data-startTime="2900">mode to get the minification. </span><span class="line" data-startTime="2901">It's not a requirement. </span><span class="line" data-startTime="2903">So you don't have to have </span><span class="line" data-startTime="2903">everything marked up with type </span><span class="line" data-startTime="2907">expressions to even use advanced </span><span class="line" data-startTime="2907">mode, necessarily. </span><span class="line" data-startTime="2910">It's more helpful if you do but </span><span class="line" data-startTime="2910">it's not a hard and fast </span><span class="line" data-startTime="2912">requirement. </span></p>

<p class="speaker"><span class="line" data-starttime="2914"><span class="speakerName">Audience</span>: Can I, if I have </span><span class="line" data-startTime="2914">half my code marked up &mdash; </span><span class="line" data-startTime="2917">or really, a hundredth of my </span><span class="line" data-startTime="2917">code marked up with type </span><span class="line" data-startTime="2920">parameters can I use </span><span class="line" data-startTime="2920">that at all? </span></p>

<p class="speaker"><span class="line" data-starttime="2922"><span class="speakerName">Michael Bolin</span>: Yeah, </span><span class="line" data-startTime="2922">absolutely. </span><span class="line" data-startTime="2923">So basically every time omit a </span><span class="line" data-startTime="2923">type expression, it assumes </span><span class="line" data-startTime="2926">that the type expression would </span><span class="line" data-startTime="2926">be asterisk, which </span><span class="line" data-startTime="2928">means the any type. </span><span class="line" data-startTime="2930">And so it already has </span><span class="line" data-startTime="2930">mechanisms to </span><span class="line" data-startTime="2934">deal with that situation. </span></p>

<p class="speaker"><span class="line" data-starttime="2935"><span class="speakerName">Audience</span>: So if I replaced </span><span class="line" data-startTime="2935">all my Dojo requires with </span><span class="line" data-startTime="2938">goog.requires and run the </span><span class="line" data-startTime="2938">advanced Compiler, what's </span><span class="line" data-startTime="2942">about to happen? </span><span class="line" data-startTime="2943">It's going to delete </span><span class="line" data-startTime="2943">my [? location ?] </span><span class="line" data-startTime="2944">right? </span></p>

<p class="speaker"><span class="line" data-starttime="2944"><span class="speakerName">Michael Bolin</span>: There are some </span><span class="line" data-startTime="2944">other caveats that are </span><span class="line" data-startTime="2946">actually well documented </span><span class="line" data-startTime="2946">on the website. </span><span class="line" data-startTime="2948">In terms of things like quoting </span><span class="line" data-startTime="2948">properties, is a </span><span class="line" data-startTime="2951">common one. </span><span class="line" data-startTime="2953">That's probably the biggest one </span><span class="line" data-startTime="2953">off the top of my head. </span><span class="line" data-startTime="2956">But I think most Dojo code </span><span class="line" data-startTime="2956">is pretty similar. </span><span class="line" data-startTime="2958">So I don't think it would be a </span><span class="line" data-startTime="2958">disaster but there's a very </span><span class="line" data-startTime="2962">good page on code.google.com </span><span class="line" data-startTime="2962">that says hazards of using </span><span class="line" data-startTime="2965">advanced mode. </span><span class="line" data-startTime="2966">And it should help you </span><span class="line" data-startTime="2966">audit your code for </span><span class="line" data-startTime="2968">those types of things. </span></p>

<p class="speaker"><span class="line" data-starttime="2969"><span class="speakerName">Audience</span>: Thanks. </span></p>

<p class="speaker"><span class="line" data-starttime="2972"><span class="speakerName">Audience</span>: Hi. </span><span class="line" data-startTime="2973">We have a pretty big </span><span class="line" data-startTime="2973">JavaScript project. </span><span class="line" data-startTime="2976">Probably a couple megs of </span><span class="line" data-startTime="2976">source or something. </span><span class="line" data-startTime="2978">Big project. </span><span class="line" data-startTime="2979">But we switched over to the </span><span class="line" data-startTime="2979">Closure Compiler last summer </span><span class="line" data-startTime="2982">and we've been totally </span><span class="line" data-startTime="2982">thrilled with it. </span><span class="line" data-startTime="2983">But this is the first time </span><span class="line" data-startTime="2983">we've seen the Templates. </span><span class="line" data-startTime="2987">And I think it's something </span><span class="line" data-startTime="2987">we're interested in. </span><span class="line" data-startTime="2989">I am curious &mdash; because it looks </span><span class="line" data-startTime="2989">like you have to run a </span><span class="line" data-startTime="2992">compiler pass just to use them &mdash; </span><span class="line" data-startTime="2992">is there any, so I </span><span class="line" data-startTime="2996">know, like, we're using the </span><span class="line" data-startTime="2996">advanced mode compilation but </span><span class="line" data-startTime="2999">you can run it uncompiled </span><span class="line" data-startTime="2999">and the </span><span class="line" data-startTime="3000">goog.requires just do XHR requests. </span><span class="line" data-startTime="3004">Get the code and eval </span><span class="line" data-startTime="3004">them and stuff. </span><span class="line" data-startTime="3006">Is there an equivalent for those </span><span class="line" data-startTime="3006">templates, that you can </span><span class="line" data-startTime="3008">run them straight from source? </span><span class="line" data-startTime="3010">Because at this point, running </span><span class="line" data-startTime="3010">the compiler takes some time. </span><span class="line" data-startTime="3012">Because it's a big project. </span></p>

<p class="speaker"><span class="line" data-starttime="3015"><span class="speakerName">Michael Bolin</span>: So built a </span><span class="line" data-startTime="3015">tool, for some reason I </span><span class="line" data-startTime="3018">neglected to put it </span><span class="line" data-startTime="3018">in my slides. </span> <span class="line" data-startTime="3019">It's called Plovr. </span> <span class="line" data-startTime="3022">My O'Riley animal is the golden </span><span class="line" data-startTime="3022">plover, so I named my </span><span class="line" data-startTime="3025">tool Plovr, without an e because </span><span class="line" data-startTime="3025">I wanted to be cool </span><span class="line" data-startTime="3027">like Flickr. </span> <span class="line" data-startTime="3028">But if you take a look, what it </span><span class="line" data-startTime="3028">does is it has some modes </span><span class="line" data-startTime="3033">that basically you can just </span><span class="line" data-startTime="3033">point it at a directory of </span><span class="line" data-startTime="3036">JavaScript in Closure Templates </span><span class="line" data-startTime="3036">files and it will </span><span class="line" data-startTime="3040">just spin up and serve </span><span class="line" data-startTime="3040">them from disk. </span> <span class="line" data-startTime="3041">And the JS ones it will serve </span><span class="line" data-startTime="3041">verbatim and the dot.soi files </span><span class="line" data-startTime="3046">for Closure Templates, it'll </span><span class="line" data-startTime="3046">translate them on the fly. </span></p>

<p><span class="line" data-startTime="3049">So you're development, you can </span><span class="line" data-startTime="3049">still debug what is basically </span><span class="line" data-startTime="3052">raw code but not have to run the </span><span class="line" data-startTime="3052">compiler over everything </span><span class="line" data-startTime="3056">to get that. </span> <span class="line" data-startTime="3057">Because I understand that </span><span class="line" data-startTime="3057">for larger code </span><span class="line" data-startTime="3058">bases it is a bit slower. </span></p>

<p class="speaker"><span class="line" data-starttime="3060"><span class="speakerName">Audience</span>: OK. </span><span class="line" data-startTime="3060">Cool. </span><span class="line" data-startTime="3060">Thanks. </span></p>

<p class="speaker"><span class="line" data-starttime="3064"><span class="speakerName">Audience</span>: I actually have </span><span class="line" data-startTime="3064">two questions for you. </span><span class="line" data-startTime="3066">The first question is about </span><span class="line" data-startTime="3066">browser native functionality. </span><span class="line" data-startTime="3069">The Closure Compiler, is it </span><span class="line" data-startTime="3069">smart enough to detect that </span><span class="line" data-startTime="3072">kind of functionality? </span><span class="line" data-startTime="3073">And then, if so, when new </span><span class="line" data-startTime="3073">browser-capable features come </span><span class="line" data-startTime="3077">out, what's the delay time </span><span class="line" data-startTime="3077">between the library being </span><span class="line" data-startTime="3080">updated versus not and being </span><span class="line" data-startTime="3080">able to support those. </span></p>

<p class="speaker"><span class="line" data-starttime="3085"><span class="speakerName">Michael Bolin</span>: That's </span><span class="line" data-startTime="3085">a good question. </span> <span class="line" data-startTime="3089">So basically you're writing </span><span class="line" data-startTime="3089">in JavaScript. </span> <span class="line" data-startTime="3090">So if it's there you can you </span><span class="line" data-startTime="3090">test in JavaScript as you </span><span class="line" data-startTime="3093">normally would. </span> <span class="line" data-startTime="3094">You could say, if document.body </span><span class="line" data-startTime="3094">query selector </span><span class="line" data-startTime="3097">all and then do one thing. </span> <span class="line" data-startTime="3099">And if not, do another thing. </span> <span class="line" data-startTime="3101">But there's also this idea, </span><span class="line" data-startTime="3101">when using the compiler in </span><span class="line" data-startTime="3103">advanced mode, this idea of </span><span class="line" data-startTime="3103">what's called externs. </span> <span class="line" data-startTime="3105">Where you basically say, these </span><span class="line" data-startTime="3105">are all the symbols that are </span><span class="line" data-startTime="3108">going to exist in the </span><span class="line" data-startTime="3108">environment in which my code </span><span class="line" data-startTime="3110">runs and their type </span><span class="line" data-startTime="3110">definitions. </span> <span class="line" data-startTime="3112">So document and window and </span><span class="line" data-startTime="3112">that sort of thing. </span></p>

<p><span class="line" data-startTime="3114">Because as you saw, the Closure </span><span class="line" data-startTime="3114">Compiler renamed a </span><span class="line" data-startTime="3117">whole bunch of variables. </span> <span class="line" data-startTime="3118">But it can't rename the </span><span class="line" data-startTime="3118">built-ins, like </span><span class="line" data-startTime="3119">document and window. </span> <span class="line" data-startTime="3122">So when you're talking about </span><span class="line" data-startTime="3122">browser features, those are </span><span class="line" data-startTime="3125">usually listed in these externs </span><span class="line" data-startTime="3125">files that declare </span><span class="line" data-startTime="3129">basically what's in the </span><span class="line" data-startTime="3129">browser environment. </span> <span class="line" data-startTime="3131">Those are updated pretty </span><span class="line" data-startTime="3131">quickly, I would say. </span> <span class="line" data-startTime="3135">Because a lot of projects, </span><span class="line" data-startTime="3135">people </span><span class="line" data-startTime="3137">are pushing the envelope. </span> <span class="line" data-startTime="3139">In that sense the compiler, </span><span class="line" data-startTime="3139">the time between a feature </span><span class="line" data-startTime="3141">coming out to being used by the </span><span class="line" data-startTime="3141">Compiler, or available or </span><span class="line" data-startTime="3144">recognized by the compiler </span><span class="line" data-startTime="3144">is pretty small. </span></p>

<p class="speaker"><span class="line" data-starttime="3148"><span class="speakerName">Audience</span>: My second question </span><span class="line" data-startTime="3148">was about development. </span><span class="line" data-startTime="3150">It looks like you don't get that </span><span class="line" data-startTime="3150">minified code until after </span><span class="line" data-startTime="3153">you've run through the compiler, </span><span class="line" data-startTime="3153">which makes sense. </span><span class="line" data-startTime="3155">When I'm doing actual </span><span class="line" data-startTime="3155">development and I'm debugging </span><span class="line" data-startTime="3158">with Firebug or Chrome's </span><span class="line" data-startTime="3158">developer tools, do I have to </span><span class="line" data-startTime="3161">load up all 150 or whatever </span><span class="line" data-startTime="3161">megabyte of </span><span class="line" data-startTime="3164">those library files? </span></p>

<p class="speaker"><span class="line" data-starttime="3167"><span class="speakerName">Michael Bolin</span>: It depends </span><span class="line" data-startTime="3167">how you do it. </span> <span class="line" data-startTime="3169">So one thing you can also do </span><span class="line" data-startTime="3169">with the Closure Compiler, </span><span class="line" data-startTime="3172">which I didn't demonstrate </span><span class="line" data-startTime="3172">today, is you can have this </span><span class="line" data-startTime="3174">idea modules. </span> <span class="line" data-startTime="3175">So GWT has this idea of code </span><span class="line" data-startTime="3175">splitting, where you can say </span><span class="line" data-startTime="3179">when I'm only using up to this </span><span class="line" data-startTime="3179">feature, then only include </span><span class="line" data-startTime="3182">these JavaScript files. </span> <span class="line" data-startTime="3183">And then if the user starts </span><span class="line" data-startTime="3183">using this other feature, then </span><span class="line" data-startTime="3185">pull down these other files. </span> <span class="line" data-startTime="3187">So one really good technique is </span><span class="line" data-startTime="3187">to use this modules feature </span><span class="line" data-startTime="3191">of the compiler, which </span><span class="line" data-startTime="3191">ultimately will compile </span><span class="line" data-startTime="3193">optimized version of each of </span><span class="line" data-startTime="3193">those clumps of code and will </span><span class="line" data-startTime="3198">depend on the symbols that </span><span class="line" data-startTime="3198">exist in the code that's </span><span class="line" data-startTime="3201">already loaded. </span></p>

<p><span class="line" data-startTime="3202">So basically, you're only </span><span class="line" data-startTime="3202">loading the minimal set of </span><span class="line" data-startTime="3205">files for the functionality </span><span class="line" data-startTime="3205">you need right now as the </span><span class="line" data-startTime="3208">user, say, goes to the </span><span class="line" data-startTime="3208">settings page. </span> <span class="line" data-startTime="3210">And now the settings code, </span><span class="line" data-startTime="3210">now it'll pull that down, </span><span class="line" data-startTime="3212">basically on demand. </span> <span class="line" data-startTime="3215">And this works in </span><span class="line" data-startTime="3215">development too. </span> <span class="line" data-startTime="3216">So it will only be the </span><span class="line" data-startTime="3216">individual files that </span><span class="line" data-startTime="3218">contribute to, what I'm </span><span class="line" data-startTime="3218">calling a module. </span> <span class="line" data-startTime="3221">So, no, you don't have to </span><span class="line" data-startTime="3221">necessarily load everything </span><span class="line" data-startTime="3225">when you start up. </span></p>

<p class="speaker"><span class="line" data-starttime="3226"><span class="speakerName">Audience</span>: Thanks. </span></p>

<p class="speaker"><span class="line" data-starttime="3230"><span class="speakerName">Audience</span>: Does this one work? </span></p>

<p class="speaker"><span class="line" data-starttime="3231"><span class="speakerName">Michael Bolin</span>: Sorry. </span><span class="line" data-startTime="3231">I didn't see you. </span><span class="line" data-startTime="3232">The lights are bright. </span></p>

<p class="speaker"><span class="line" data-starttime="3233"><span class="speakerName">Audience</span>: This relates to </span><span class="line" data-startTime="3233">the first question. </span><span class="line" data-startTime="3234">You had that one slide, where </span><span class="line" data-startTime="3234">you had the prototype with the </span><span class="line" data-startTime="3237">dollar sign w, I've used Closure </span><span class="line" data-startTime="3237">to do some newer </span><span class="line" data-startTime="3241">projects, but I have </span><span class="line" data-startTime="3241">a lot of legacy </span><span class="line" data-startTime="3242">projects with Prototype. </span><span class="line" data-startTime="3246">Will the compiler deal with </span><span class="line" data-startTime="3246">those types of commands, to </span><span class="line" data-startTime="3250">compile them down? </span><span class="line" data-startTime="3250">Or do you have to pretty much </span><span class="line" data-startTime="3250">remove all the Prototype to </span><span class="line" data-startTime="3253">get the compiler to work? </span></p>

<p class="speaker"><span class="line" data-starttime="3254"><span class="speakerName">Michael Bolin</span>: Well no. </span><span class="line" data-startTime="3255">So if you supply the Prototype </span><span class="line" data-startTime="3255">source code as an input to the </span><span class="line" data-startTime="3258">compiler, it will treat it </span><span class="line" data-startTime="3258">like any other input. </span><span class="line" data-startTime="3260">And also if &mdash; </span><span class="line" data-startTime="3262">so unused functions will then </span><span class="line" data-startTime="3262">also still go away. </span><span class="line" data-startTime="3264">And interestingly, if you have </span><span class="line" data-startTime="3264">a function that you use a lot </span><span class="line" data-startTime="3267">in the Closure Library and it </span><span class="line" data-startTime="3267">has a very verbose name, the </span><span class="line" data-startTime="3271">compiler will pick the smallest </span><span class="line" data-startTime="3271">names for the </span><span class="line" data-startTime="3274">functions that are used the </span><span class="line" data-startTime="3274">most. So possibly your </span><span class="line" data-startTime="3277">prototype functions could get </span><span class="line" data-startTime="3277">renamed to longer things, </span><span class="line" data-startTime="3279">although they're only two bytes </span><span class="line" data-startTime="3279">so it's probably not. </span><span class="line" data-startTime="3281">Actually it would be longer. </span><span class="line" data-startTime="3284">But basically, sorry, </span><span class="line" data-startTime="3284">the short answer to </span><span class="line" data-startTime="3285">your question is yes. </span><span class="line" data-startTime="3286">You can use the Prototype </span><span class="line" data-startTime="3286">code with the compiler. </span></p>

<p class="speaker"><span class="line" data-starttime="3291"><span class="speakerName">Audience</span>: So one of the most fun </span><span class="line" data-startTime="3291">things in the world about </span><span class="line" data-startTime="3293">doing JavaScript is after you've </span><span class="line" data-startTime="3293">minified it, that you </span><span class="line" data-startTime="3297">get a bug report </span><span class="line" data-startTime="3297">from the field. </span><span class="line" data-startTime="3300">So is there an equivalent to a </span><span class="line" data-startTime="3300">symbol table or something that </span><span class="line" data-startTime="3304">could be added in say, a </span><span class="line" data-startTime="3304">less-than perfectly optimized? </span></p>

<p class="speaker"><span class="line" data-starttime="3308"><span class="speakerName">Michael Bolin</span>: Yep. </span> <span class="line" data-startTime="3309">So basically there's an option, </span><span class="line" data-startTime="3309">when you run the </span><span class="line" data-startTime="3312">compiler, to output as a </span><span class="line" data-startTime="3312">byproduct, a thing called a </span><span class="line" data-startTime="3315">source map. </span> <span class="line" data-startTime="3316">And so it is a reverse mapping, </span><span class="line" data-startTime="3316">it's actually every </span><span class="line" data-startTime="3319">line and character in your </span><span class="line" data-startTime="3319">compiled code, to the line and </span><span class="line" data-startTime="3322">character position in the </span><span class="line" data-startTime="3322">original source code. </span> <span class="line" data-startTime="3327">And then there's some other </span><span class="line" data-startTime="3327">Java code that's there for </span><span class="line" data-startTime="3331">taking a JavaScript stack trace </span><span class="line" data-startTime="3331">from the server and </span><span class="line" data-startTime="3334">converting it into an obfuscated </span><span class="line" data-startTime="3334">JavaScript file. </span> <span class="line" data-startTime="3338">The only caveat is that, you </span><span class="line" data-startTime="3338">really care about the line and </span><span class="line" data-startTime="3343">the character offset. </span> <span class="line" data-startTime="3343">And I believe right now, only </span><span class="line" data-startTime="3343">Chrome &mdash; and I guess probably </span><span class="line" data-startTime="3346">then Safari &mdash; </span><span class="line" data-startTime="3347">provide both the line </span><span class="line" data-startTime="3347">and the character. </span></p>

<p><span class="line" data-startTime="3348">Most of the other browsers </span><span class="line" data-startTime="3348">only do the line. </span> <span class="line" data-startTime="3351">I haven't checked Firefox 4, but </span><span class="line" data-startTime="3351">at least Firefox 3.6 still </span><span class="line" data-startTime="3354">only sent the line number. </span> <span class="line" data-startTime="3355">So if anyone has influence over </span><span class="line" data-startTime="3355">any of those folks, it'd </span><span class="line" data-startTime="3359">be great if they also sent </span><span class="line" data-startTime="3359">character offsets. </span> <span class="line" data-startTime="3361">Because, to exactly the point </span><span class="line" data-startTime="3361">that you're making. </span></p>

<p class="speaker"><span class="line" data-starttime="3367"><span class="speakerName">Audience</span>: Is Closure planning to </span><span class="line" data-startTime="3367">implement the common module </span><span class="line" data-startTime="3370">dependency, CommonJS standard? </span></p>

<p class="speaker"><span class="line" data-starttime="3374"><span class="speakerName">Michael Bolin</span>: That's </span><span class="line" data-startTime="3374">a good question. </span><span class="line" data-startTime="3375">So there is no plan </span><span class="line" data-startTime="3375">and there's no </span><span class="line" data-startTime="3377">anti-plan as far as I know. </span><span class="line" data-startTime="3379">In that they're not hating on </span><span class="line" data-startTime="3379">it and they maybe haven't </span><span class="line" data-startTime="3382">figured out exactly how to </span><span class="line" data-startTime="3382">merge the two worlds. </span><span class="line" data-startTime="3386">I think, if there were a good </span><span class="line" data-startTime="3386">proposal put forth on how to </span><span class="line" data-startTime="3391">combine those two things, I </span><span class="line" data-startTime="3391">think the people who work on </span><span class="line" data-startTime="3394">Closure would be </span><span class="line" data-startTime="3394">very interested </span><span class="line" data-startTime="3395">in making that happen. </span></p>

<p class="speaker"><span class="line" data-starttime="3397"><span class="speakerName">Audience</span>: Are you still </span><span class="line" data-startTime="3397">working on Closure? </span><span class="line" data-startTime="3398">Or is that something Google </span><span class="line" data-startTime="3398">works on and you </span><span class="line" data-startTime="3400">don't work on anymore. </span></p>

<p class="speaker"><span class="line" data-starttime="3401"><span class="speakerName">Michael Bolin</span>: I contribute </span><span class="line" data-startTime="3401">to Closure for sure. </span><span class="line" data-startTime="3403">And I certainly talk </span><span class="line" data-startTime="3403">to those folks. </span><span class="line" data-startTime="3406">We had a discussion just last </span><span class="line" data-startTime="3406">week about it and it was kind </span><span class="line" data-startTime="3409">of like, one of the many items </span><span class="line" data-startTime="3409">on the list. It's certainly </span><span class="line" data-startTime="3412">something that we'd like to </span><span class="line" data-startTime="3412">address but it hasn't bubbled </span><span class="line" data-startTime="3415">to the top yet. </span><span class="line" data-startTime="3420">Anybody else? </span><span class="line" data-startTime="3421">Thank you, everyone. </span><span class="line" data-startTime="3423">I hope you enjoy Google I/O. </span></p>