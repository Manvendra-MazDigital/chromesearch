<p class="speaker"><span class="line" data-starttime="3"><span class="speakerName">Steve Souders</span>: Okay. Is that my cue to go? </span><span class="line" data-startTime="3">Okay. We're having a current discussion about </span><span class="line" data-startTime="5">letting people come in and sit up front, so </span><span class="line" data-startTime="5">I hope we can do that. </span> <span class="line" data-startTime="13">I'm really excited to see everyone that showed </span><span class="line" data-startTime="13">up, but I have a cold shower announcement </span><span class="line" data-startTime="19">to make. I'm not giving anything away. </span> <span class="line" data-startTime="19">So although that's not entirely true. I'm </span><span class="line" data-startTime="26">giving away information and knowledge, but </span><span class="line" data-startTime="26">nothing that physically you can take home </span><span class="line" data-startTime="31">and give to your kids if that's what they're </span><span class="line" data-startTime="31">expecting. </span> <span class="line" data-startTime="35">So I'm going to talk about HTML5 from a performance </span><span class="line" data-startTime="35">perspective, but first I'm going to start </span><span class="line" data-startTime="44">off and give a little background on my work </span><span class="line" data-startTime="44">in working on Web performance and kind of </span><span class="line" data-startTime="50">the motivation. I think probably a lot of </span><span class="line" data-startTime="50">people &mdash; how many people here build Web sites? </span><span class="line" data-startTime="55">Yeah, okay, great. </span> <span class="line" data-startTime="55">So I think there's something in the DNA of </span><span class="line" data-startTime="65">engineers in general, and especially programmers, </span><span class="line" data-startTime="65">to be efficient and optimize. </span> <span class="line" data-startTime="70">I think as developers we all like our code </span><span class="line" data-startTime="70">&mdash; we feel proud if people &mdash; if we can say </span><span class="line" data-startTime="76">about our code that it's really fast and efficient. </span></p>

<p><span class="line" data-startTime="76">And so at the beginning I'm going to talk </span><span class="line" data-startTime="82">about how we can try to work to instill that </span><span class="line" data-startTime="82">interest and buy-in for performance across </span><span class="line" data-startTime="90">other parts of the organization outside of </span><span class="line" data-startTime="90">engineering. </span> <span class="line" data-startTime="93">So there will be a little preamble on that </span><span class="line" data-startTime="93">and then we'll dive into the HTML5 stuff. </span> <span class="line" data-startTime="96">I just want to mention the slides are up on </span><span class="line" data-startTime="96">my Web site, stevesouders.com. If you go there </span><span class="line" data-startTime="102">there's a link to it. You can check that out. </span> <span class="line" data-startTime="102">Okay. So let's get started &mdash; oh, the other </span><span class="line" data-startTime="111">thing I want to mention is really more than </span><span class="line" data-startTime="111">what I say and more than the words on the </span><span class="line" data-startTime="118">slides, I really want people to pay attention </span><span class="line" data-startTime="118">to the photos in the background of the slides. </span> <span class="line" data-startTime="124">[ Laughter ] </span></p>

<p class="speaker"><span class="line" data-starttime="124"><span class="speakerName">Steve Souders</span>: Come on, we're going to &mdash; loosen </span><span class="line" data-startTime="128">up a little bit. Let's go. </span><span class="line" data-startTime="128">I mean, like the story of my life, like I </span><span class="line" data-startTime="131">take slow things and make them fast, like </span><span class="line" data-startTime="131">is that very appropriate or what? </span><span class="line" data-startTime="135">I need more feedback. </span><span class="line" data-startTime="135">[ Applause ] </span></p>

<p class="speaker"><span class="line" data-starttime="138"><span class="speakerName">Steve Souders</span>: Yeah, okay, there we go. </span> <span class="line" data-startTime="138">I worked at Yahoo for a long time, eight years. </span> <span class="line" data-startTime="145">I was going to be there one year and I was </span><span class="line" data-startTime="145">there eight years. And about four and a half </span><span class="line" data-startTime="149">years ago I joined Google, which was really </span><span class="line" data-startTime="149">my goal when I first started on Web performance </span><span class="line" data-startTime="155">because I knew the people at Google really </span><span class="line" data-startTime="155">cared about making things fast, and it's true. </span> <span class="line" data-startTime="160">So I've been there four and a half years. </span> <span class="line" data-startTime="160">I do mostly open source stuff, so I did &mdash; I </span><span class="line" data-startTime="166">created YSlow, Cuzillion, Sprite Me, Hammerhead, </span><span class="line" data-startTime="166">Browserscope. Lindsey Simon now runs that </span><span class="line" data-startTime="173">project, very successful project. Jdrop, which </span><span class="line" data-startTime="173">is a great concept, but not such a successful </span><span class="line" data-startTime="178">project, but you should check it out. HTTP </span><span class="line" data-startTime="178">Archive, another one I don't have time to </span><span class="line" data-startTime="184">talk about today, but check it out, HTTParchive.org. </span> <span class="line" data-startTime="184">I wrote "High Performance Web sites," "Even </span><span class="line" data-startTime="190">Faster Web sites." </span><span class="line" data-startTime="190">I taught at Stanford based on the books and </span><span class="line" data-startTime="194">I run the velocity conference. Oh, I have </span><span class="line" data-startTime="194">to update. We just had it this week in fact. </span></p>

<p><span class="line" data-startTime="199">I just finished that on Wednesday. </span> <span class="line" data-startTime="199">So I've been doing this performance stuff </span><span class="line" data-startTime="204">for quite a listening time now, seven years, </span><span class="line" data-startTime="204">I think, but when I started back in 2004 I </span><span class="line" data-startTime="209">kind of felt like the lone voice in the woods. </span> <span class="line" data-startTime="209">So really I'm sure there were people that </span><span class="line" data-startTime="214">were working on it back then, but when I searched </span><span class="line" data-startTime="214">for information about making Web sites faster, </span><span class="line" data-startTime="220">I really didn't find very much. There was </span><span class="line" data-startTime="220">a great blog post from David Hyatt that actually </span><span class="line" data-startTime="224">really opened my eyes to where I should look </span><span class="line" data-startTime="224">for making Web sites faster. </span> <span class="line" data-startTime="231">I should mention that when I talk about performance, </span><span class="line" data-startTime="231">I mean that from the end user's perspective. </span> <span class="line" data-startTime="236">My goal when I started this in 2004 was to </span><span class="line" data-startTime="236">make the user experience fast. </span> <span class="line" data-startTime="241">Now, there's another aspect of performance </span><span class="line" data-startTime="241">which I think of more as efficiency or scalability </span><span class="line" data-startTime="247">on back end servers. How can we handle 10X </span><span class="line" data-startTime="247">the current number of users with the same </span><span class="line" data-startTime="253">hardware? Those kinds of efficiency optimizations </span><span class="line" data-startTime="253">are also performance, but when I say performance, </span><span class="line" data-startTime="259">I really mean speed, speed of the user experience. </span></p>

<p><span class="line" data-startTime="259">So when I first started working on this there </span><span class="line" data-startTime="265">really wasn't that much information out there </span><span class="line" data-startTime="265">and I would try to go &mdash; I started documenting </span><span class="line" data-startTime="270">things, writing books, blogging, trying to </span><span class="line" data-startTime="270">go to other teams and convince them to focus </span><span class="line" data-startTime="275">on performance. </span> <span class="line" data-startTime="275">And it's kind of like QA or writing unit tests. </span> <span class="line" data-startTime="280">Like try to sell unit tests &mdash; time to build </span><span class="line" data-startTime="280">unit tests to someone from marketing or sales. </span> <span class="line" data-startTime="287">That's kind of hard to do, because it's hard </span><span class="line" data-startTime="287">to visually see the benefit of that. </span> <span class="line" data-startTime="292">So at the beginning it was kind of the same </span><span class="line" data-startTime="292">thing with talking about make the Web site </span><span class="line" data-startTime="296">faster. Yeah, we need like a couple of people </span><span class="line" data-startTime="296">to work for at least six months. And you won't </span><span class="line" data-startTime="302">see anything different on the site, it will </span><span class="line" data-startTime="302">just feel faster. And believe me, that's really </span><span class="line" data-startTime="306">critical. </span> <span class="line" data-startTime="306">And they're like no, really we want you to </span><span class="line" data-startTime="309">add more flash. </span> <span class="line" data-startTime="309">[Laughter]. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="312"><span class="speakerName">Steve Souders</span>: And so fast forward to 2010, </span><span class="line" data-startTime="312">future of Web apps. We have Fred Wilson. How </span><span class="line" data-startTime="321">many people know Fred Wilson? </span><span class="line" data-startTime="321">Like one of the most prolific bloggers. He's </span><span class="line" data-startTime="326">the number one VC out of New York City, out </span><span class="line" data-startTime="326">of Union Square, very techy guy. But really </span><span class="line" data-startTime="332">his business is investment, funding startup </span><span class="line" data-startTime="332">companies. </span> <span class="line" data-startTime="337">Here he is speaking at a tech conference about </span><span class="line" data-startTime="337">his 10 golden principles of successful Web </span><span class="line" data-startTime="342">apps. What's number one? Speed. He says, First </span><span class="line" data-startTime="342">and foremost we believe that speed is more </span><span class="line" data-startTime="347">than a feature, speed is the most important </span><span class="line" data-startTime="347">feature. </span> <span class="line" data-startTime="350">And he goes on to talk about with their portfolio </span><span class="line" data-startTime="350">companies they track all of the company's </span><span class="line" data-startTime="357">performance, speed, page load time for real </span><span class="line" data-startTime="357">users. And that in their experience the data </span><span class="line" data-startTime="364">shows that when the speed drops off, the success </span><span class="line" data-startTime="364">of the business drops off. </span> <span class="line" data-startTime="370">And that's why they do this for all the portfolio </span><span class="line" data-startTime="370">companies that they work with. </span></p>

<p><span class="line" data-startTime="376">And so I think that's to me like Web performance </span><span class="line" data-startTime="376">has arrived. We have a VC talking at a tech </span><span class="line" data-startTime="383">conference about speed, like this was beautiful </span><span class="line" data-startTime="383">to me. I start almost every slide deck with </span><span class="line" data-startTime="388">this slide. </span> <span class="line" data-startTime="388">And actually, a partner of Fred's spoke at </span><span class="line" data-startTime="392">the Velocity conference this week. </span> <span class="line" data-startTime="392">And in addition &mdash; if that's not enough to </span><span class="line" data-startTime="398">have the number one VC out of New York City </span><span class="line" data-startTime="398">talking about performance, I'm going to run </span><span class="line" data-startTime="402">through a bunch of case studies here that </span><span class="line" data-startTime="402">correlate performance speed to the success </span><span class="line" data-startTime="408">of the business. </span> <span class="line" data-startTime="408">So here's &mdash; about two years ago Bing and </span><span class="line" data-startTime="413">Google Search got up on stage at the same </span><span class="line" data-startTime="413">time and talked about experiments they had </span><span class="line" data-startTime="417">run. Bing introduced intentionally a delay </span><span class="line" data-startTime="417">in serving search results. They took it up </span><span class="line" data-startTime="423">to two seconds. At a two-second delay they </span><span class="line" data-startTime="423">saw all their goodness metrics drop off. Most </span><span class="line" data-startTime="428">significantly revenue per user dropped off </span><span class="line" data-startTime="428">four percent. </span></p>

<p><span class="line" data-startTime="433">And of course, these companies are doing this </span><span class="line" data-startTime="433">on a very small sample size. </span> <span class="line" data-startTime="438">So Google took this up to 400 milliseconds </span><span class="line" data-startTime="438">at the max. Didn't see that much dropoff in </span><span class="line" data-startTime="444">searches per user, although at Google scale </span><span class="line" data-startTime="444">that's a fairly significant dropoff. </span> <span class="line" data-startTime="449">The thing that was really interesting about </span><span class="line" data-startTime="449">this study was after they removed the delay, </span><span class="line" data-startTime="455">they kept that user group segmented and tracked </span><span class="line" data-startTime="455">their usage. And it took I think six weeks </span><span class="line" data-startTime="462">for the usage, the searches per day, and other </span><span class="line" data-startTime="462">goodness metrics, to resume where they were </span><span class="line" data-startTime="468">before the experiment started. </span> <span class="line" data-startTime="468">So the user's awareness of what the experience </span><span class="line" data-startTime="475">is like is something that gets ingrained and </span><span class="line" data-startTime="475">lives with them and it takes a long time to </span><span class="line" data-startTime="480">build that and to recover from delays. So </span><span class="line" data-startTime="480">it's important to stay on top of keeping your </span><span class="line" data-startTime="486">Web site fast. </span> <span class="line" data-startTime="486">And Yahoo ran a similar study. And for full </span><span class="line" data-startTime="492">page traffic, that means traffic where the </span><span class="line" data-startTime="492">onload event actually fires, a 400-millisecond </span><span class="line" data-startTime="498">delay saw a five to nine percent dropoff in </span><span class="line" data-startTime="498">traffic. </span> <span class="line" data-startTime="503">Here Mozilla &mdash; this is about a year old. </span></p>

<p><span class="line" data-startTime="503">Mozilla, when you want to upgrade to Firefox </span><span class="line" data-startTime="509">and you're in Internet Explorer, you get the </span><span class="line" data-startTime="509">IE landing page, and they made that IE Firefox </span><span class="line" data-startTime="516">landing page 2.2 seconds faster, and they </span><span class="line" data-startTime="516">saw a 15% lift in Firefox downloads. So for </span><span class="line" data-startTime="523">them that's their business metric, being a </span><span class="line" data-startTime="523">nonprofit. </span> <span class="line" data-startTime="527">And this was a seminal study from Velocity </span><span class="line" data-startTime="527">a few years ago. Shopzilla did a tremendous </span><span class="line" data-startTime="532">performance effort, taking their site from </span><span class="line" data-startTime="532">seven seconds to about three seconds, and </span><span class="line" data-startTime="538">they saw conversion rate go up seven to 12 </span><span class="line" data-startTime="538">percent depending on the country. </span> <span class="line" data-startTime="543">This is very significant. They saw the unique </span><span class="line" data-startTime="543">users from search engine marketing more than </span><span class="line" data-startTime="548">double. And this was the first study that </span><span class="line" data-startTime="548">showed another benefit in addition to the </span><span class="line" data-startTime="554">business metrics is operating costs going </span><span class="line" data-startTime="554">down. </span> <span class="line" data-startTime="557">So here we have the number of servers needed </span><span class="line" data-startTime="557">to run the Web site after this optimization </span><span class="line" data-startTime="564">dropped. And that kind of makes sense because </span><span class="line" data-startTime="564">like one of the optimizations is connecting </span><span class="line" data-startTime="570">scripts together, so instead of making seven </span><span class="line" data-startTime="570">requests to my server, I'm only making one. </span></p>

<p><span class="line" data-startTime="575">Turn on Gzip so the amount of time it takes </span><span class="line" data-startTime="575">for the response to get off the server box </span><span class="line" data-startTime="581">is lowered and so the server can handle a </span><span class="line" data-startTime="581">higher QPS. </span> <span class="line" data-startTime="585">And then following that a good friend of mine, </span><span class="line" data-startTime="585">Bill Scott, when he was at Netflix, they had </span><span class="line" data-startTime="590">&mdash; they didn't have Gzip turned on for some </span><span class="line" data-startTime="590">reason. I can go into it after if people want </span><span class="line" data-startTime="596">to ask. </span> <span class="line" data-startTime="596">And he turned it on one day and the [Indiscernible] </span><span class="line" data-startTime="601">said the Web site is down, all we're serving </span><span class="line" data-startTime="601">is the error page. </span> <span class="line" data-startTime="603">And he said why do you think that? </span><span class="line" data-startTime="603">And they said the traffic in our data server </span><span class="line" data-startTime="607">has dropped in half. </span> <span class="line" data-startTime="607">He said, Nope, we're serving everything, it's </span><span class="line" data-startTime="610">just that we turned on Gzip. So this is probably </span><span class="line" data-startTime="610">six figures a month in a data center that </span><span class="line" data-startTime="617">they saved. Pretty significant. </span> <span class="line" data-startTime="617">Here's another example, Edmunds.com turned </span><span class="line" data-startTime="623">on &mdash; added an expires header so that their </span><span class="line" data-startTime="623">resources through their CDN could be cached </span><span class="line" data-startTime="628">and they saw their CDN traffic drop by a third. </span> <span class="line" data-startTime="628">So again, this is a six-figure maybe high </span><span class="line" data-startTime="635">five-figure savings per month from CDN costs. </span> <span class="line" data-startTime="635">And then not that recently anymore, this was </span><span class="line" data-startTime="643">about a year and a half ago, Google announced </span><span class="line" data-startTime="643">that speed or latency was going to be taken </span><span class="line" data-startTime="648">into consideration for page rank. And that </span><span class="line" data-startTime="648">was caveated, it's one of two hundred signals, </span><span class="line" data-startTime="654">it only effects about one percent of search </span><span class="line" data-startTime="654">results, but still it's a consideration and </span><span class="line" data-startTime="658">page rank is really important. </span></p>

<p><span class="line" data-startTime="658">All of these things about a year, year and </span><span class="line" data-startTime="663">a half ago I saw coming together and so I </span><span class="line" data-startTime="663">coined a new catch phrase for this emerging </span><span class="line" data-startTime="669">industry called WPO. It stands for Web Performance </span><span class="line" data-startTime="669">Optimization. And actually as I mentioned, </span><span class="line" data-startTime="676">I keep mentioning, we just had Velocity this </span><span class="line" data-startTime="676">week, there were a number. Sequoia, Battery </span><span class="line" data-startTime="681">Ventures, Excel, Union Square were all there. </span> <span class="line" data-startTime="681">This industry is really growing up. There's </span><span class="line" data-startTime="687">a number of startups in this Web performance </span><span class="line" data-startTime="687">space now. </span> <span class="line" data-startTime="691">And the elevator pitch is it drives traffic </span><span class="line" data-startTime="691">to your site. We see that with search engine </span><span class="line" data-startTime="695">marketing, with page rank. It improves the </span><span class="line" data-startTime="695">user experience. You would think that making </span><span class="line" data-startTime="702">Web sites faster the user would get in and </span><span class="line" data-startTime="702">out more quickly, and it's just the opposite. </span></p>

<p><span class="line" data-startTime="707">All of these studies show that page views </span><span class="line" data-startTime="707">per session, session length all increase because </span><span class="line" data-startTime="713">the users are having a better experience. </span> <span class="line" data-startTime="713">It increases revenue. We saw stats on that </span><span class="line" data-startTime="718">with conversions, downloads, and it reduces </span><span class="line" data-startTime="718">operating costs. </span> <span class="line" data-startTime="723">So this all sounds pretty good, right? </span><span class="line" data-startTime="723">Web PO is really taking off. </span> <span class="line" data-startTime="729">All right, that's the preamble. How many people </span><span class="line" data-startTime="729">here think fast Web sites are good? </span><span class="line" data-startTime="735">All right. So hopefully if you're having trouble </span><span class="line" data-startTime="735">selling that &mdash; if this is stuff that you </span><span class="line" data-startTime="740">want to work on and you're having trouble </span><span class="line" data-startTime="740">selling that back home, you can take some </span><span class="line" data-startTime="744">of these case studies and show people back </span><span class="line" data-startTime="744">home that this is a good investment. You'll </span><span class="line" data-startTime="749">actually get a positive ROI. And maybe these </span><span class="line" data-startTime="749">will give a little guidance on what you can </span><span class="line" data-startTime="753">track on the business side to actually correlate </span><span class="line" data-startTime="753">performance improvements with the goals of </span><span class="line" data-startTime="758">the business. </span> <span class="line" data-startTime="758">All right. So let's transition into the meat </span><span class="line" data-startTime="762">of the topic. I don't want to debate about </span><span class="line" data-startTime="762">what HTML5 is. There's the spec. I also mean </span><span class="line" data-startTime="767">CSS3. It's the new stuff. </span> <span class="line" data-startTime="767">So I'm going to highlight a few things around </span><span class="line" data-startTime="773">HTML5 and CSS3 that I think are really important </span><span class="line" data-startTime="773">to pay attention to from a performance perspective. </span> <span class="line" data-startTime="781">So the first is if you want to optimize something </span><span class="line" data-startTime="781">you need to be able to measure it. And right </span><span class="line" data-startTime="789">now what we'd really like to measure is the </span><span class="line" data-startTime="789">user's perception of speed. Currently there's </span><span class="line" data-startTime="798">no JavaScript handler for brain activity. </span></p>

<p><span class="line" data-startTime="798">So what we've been using as an industry &mdash; as </span><span class="line" data-startTime="805">a proxy for that is the window onload event. </span> <span class="line" data-startTime="805">Now, the problem with that is, for example, </span><span class="line" data-startTime="811">if I do a Google search and I click on a search </span><span class="line" data-startTime="811">result that takes me to Whole Foods, and I </span><span class="line" data-startTime="816">want to measure &mdash; from Whole Foods' perspective, </span><span class="line" data-startTime="816">they want to know how long it took for the </span><span class="line" data-startTime="821">user to click that link to when Whole Foods </span><span class="line" data-startTime="821">was ready. And the problem is tracking the </span><span class="line" data-startTime="826">start time. How do you track the time that </span><span class="line" data-startTime="826">the user started by clicking on that link? </span><span class="line" data-startTime="832">Because that's the user's perception time. </span> <span class="line" data-startTime="832">And what you can do is at the top of the Whole </span><span class="line" data-startTime="837">Foods page you can put a script lock that </span><span class="line" data-startTime="837">takes a time measurement, but that totally </span><span class="line" data-startTime="841">ignores the time it takes for the request </span><span class="line" data-startTime="841">to go up to the Whole Foods server, for it </span><span class="line" data-startTime="846">to stitch together all of the content and </span><span class="line" data-startTime="846">send that back down to the browser. </span> <span class="line" data-startTime="851">So about two years ago Google and Microsoft </span><span class="line" data-startTime="851">formed this Web performance working group </span><span class="line" data-startTime="857">as part of the W3C, and the first task was </span><span class="line" data-startTime="857">to create the Web timing spec, which is actually </span><span class="line" data-startTime="864">three specs, navigation timing, user timing, </span><span class="line" data-startTime="864">resource timing. </span></p>

<p><span class="line" data-startTime="869">How many people here use navigation timing </span><span class="line" data-startTime="869">to measure Web sites? </span><span class="line" data-startTime="873">Good. It's not good that there were so few </span><span class="line" data-startTime="873">hands up. It's good because I'm going to talk </span><span class="line" data-startTime="878">about it a little bit. </span> <span class="line" data-startTime="878">So those of three and I'm going to talk about </span><span class="line" data-startTime="883">each one in a little bit more detail. They're </span><span class="line" data-startTime="883">also working on a few other specs, page visibility </span><span class="line" data-startTime="889">I'll touch on quickly. Script-base animations </span><span class="line" data-startTime="889">I'm not going to spend too much time on, but </span><span class="line" data-startTime="893">people are doing a lot of animation with JavaScript </span><span class="line" data-startTime="893">and they're working on making that better. </span> <span class="line" data-startTime="898">And efficient script yielding, since the browsers </span><span class="line" data-startTime="898">are single threaded, if you have long running </span><span class="line" data-startTime="902">JavaScript it can really degrade the user </span><span class="line" data-startTime="902">experience. So what can scripts do to mitigate </span><span class="line" data-startTime="909">that. </span></p>

<p><span class="line" data-startTime="909">But let me talk about the timing specs. So </span><span class="line" data-startTime="911">navigation timing actually is out. The spec </span><span class="line" data-startTime="911">is done and it's available today. If you look </span><span class="line" data-startTime="918">at window.performance, there's this timing </span><span class="line" data-startTime="918">object. And you can do things like from the </span><span class="line" data-startTime="925">timing object you can get the navigation start </span><span class="line" data-startTime="925">and the load event end, take the difference. </span> <span class="line" data-startTime="932">And the nice thing is that the Web timing </span><span class="line" data-startTime="932">spec gives us two main things. This is the </span><span class="line" data-startTime="937">first one. This is the time at which the &mdash; the </span><span class="line" data-startTime="937">epic time at which the user clicked on that </span><span class="line" data-startTime="943">link on Google. So now the user can &mdash; the </span><span class="line" data-startTime="943">Web site owner can get the full time from </span><span class="line" data-startTime="950">when the click happened to when the onload </span><span class="line" data-startTime="950">event or whatever event you wanted to. And </span><span class="line" data-startTime="957">in fact if you put a little time stamp at </span><span class="line" data-startTime="957">the top of the page you can break that into </span><span class="line" data-startTime="961">what I call the back end time, the time from </span><span class="line" data-startTime="961">the click to when the first byte arrived and </span><span class="line" data-startTime="966">the time from the first byte to when the full </span><span class="line" data-startTime="966">page loaded. </span> <span class="line" data-startTime="970">And there's a bunch of other timings in there. </span></p>

<p><span class="line" data-startTime="970">You can get DNS time and connection time. </span> <span class="line" data-startTime="974">There are a bunch of time values that you </span><span class="line" data-startTime="974">can get in there. </span> <span class="line" data-startTime="979">So this has been out &mdash; the spec was finished </span><span class="line" data-startTime="979">probably about six months ago, maybe a little </span><span class="line" data-startTime="983">longer. </span> <span class="line" data-startTime="983">And I think IE 9 &mdash; no, I think Chrome was </span><span class="line" data-startTime="987">the first to implement it. But it's in IE </span><span class="line" data-startTime="987">9 and up, Firefox 7 and up. They had some </span><span class="line" data-startTime="992">bugs in the Firefox 7 in the early days, but </span><span class="line" data-startTime="992">those are all fixed now. It's on Android. </span> <span class="line" data-startTime="999">And I heard a month ago it's on Blackberry, </span><span class="line" data-startTime="999">but I haven't tested that. </span> <span class="line" data-startTime="1004">And here's a good URL from Tony Gentilcore </span><span class="line" data-startTime="1004">that kind of explains how you could use it </span><span class="line" data-startTime="1008">and some examples of getting different time </span><span class="line" data-startTime="1008">values. </span> <span class="line" data-startTime="1012">So one thing that's really cool is Google </span><span class="line" data-startTime="1012">is taking &mdash; for page rank is taking time </span><span class="line" data-startTime="1019">into consideration, but when they announce </span><span class="line" data-startTime="1019">that &mdash; I'm really proud of the work from </span><span class="line" data-startTime="1024">the make the Web faster team at Google, where </span><span class="line" data-startTime="1024">it wasn't like okay, we're going to hold you </span><span class="line" data-startTime="1029">responsible for it, good luck. We also rolled </span><span class="line" data-startTime="1029">out several tools. </span></p>

<p><span class="line" data-startTime="1033">In Webmaster tools you can go in there and </span><span class="line" data-startTime="1033">you can see how your site compares its speed, </span><span class="line" data-startTime="1040">compares to the rest of the industry. </span> <span class="line" data-startTime="1040">And really the folks who were going to get </span><span class="line" data-startTime="1045">penalized from a page rank perspective are </span><span class="line" data-startTime="1045">going to be in the lower 10%, maybe even lower </span><span class="line" data-startTime="1050">than that. So maybe you're not awesome, but </span><span class="line" data-startTime="1050">if you're in the top 50% you probably don't </span><span class="line" data-startTime="1056">have too much to worry about there. So that's </span><span class="line" data-startTime="1056">a little help, but the other thing that's </span><span class="line" data-startTime="1060">nice to get more granularity, if you use Google </span><span class="line" data-startTime="1060">analytics, we added this time measurement </span><span class="line" data-startTime="1067">capability in Google Analytics. I think we </span><span class="line" data-startTime="1067">call it site speed &mdash; yeah, site speed. </span> <span class="line" data-startTime="1075">Yeah, this screen dump is a little old. I </span><span class="line" data-startTime="1075">think the UI is a little difference now. But </span><span class="line" data-startTime="1081">the nice thing is when we first launched it </span><span class="line" data-startTime="1081">you had to add a little bit more to your Google </span><span class="line" data-startTime="1086">Analytics snippet, and then about three or </span><span class="line" data-startTime="1086">four months ago we turned it on for everyone. </span> <span class="line" data-startTime="1092">So even if you had no awareness of the site </span><span class="line" data-startTime="1092">speed, time measurement capability, you've </span><span class="line" data-startTime="1097">been gathering data for about five months </span><span class="line" data-startTime="1097">now, four or five months. So you could go </span><span class="line" data-startTime="1101">to Google Analytics and go and find this site </span><span class="line" data-startTime="1101">speed tab and you could get charts, and it's </span><span class="line" data-startTime="1107">the usual Google Analytics slice and dice </span><span class="line" data-startTime="1107">capabilities by browser, by geographic region, </span><span class="line" data-startTime="1113">by page, and you can see what your performance </span><span class="line" data-startTime="1113">is. </span></p>

<p><span class="line" data-startTime="1117">This is my Web site, so I don't know what </span><span class="line" data-startTime="1117">was going on there, but that was awhile ago. </span> <span class="line" data-startTime="1122">See, now it's fast. Well, in November it was </span><span class="line" data-startTime="1122">fast. </span> <span class="line" data-startTime="1128">Thank you for that. I appreciate that. </span> <span class="line" data-startTime="1128">[ Laughter ] </span></p>

<p class="speaker"><span class="line" data-starttime="1130"><span class="speakerName">Steve Souders</span>: Oh, I think I probably &mdash; now </span><span class="line" data-startTime="1130">it's on by default. Oh, it's only in browsers </span><span class="line" data-startTime="1136">that support nav timing, so we really need </span><span class="line" data-startTime="1136">mobile browsers to start supporting this more. </span> <span class="line" data-startTime="1142">Oh, it's sampled. So by default it's a one </span><span class="line" data-startTime="1142">percent sampling rate. </span> <span class="line" data-startTime="1148">If you have a huge Web site, like one percent </span><span class="line" data-startTime="1148">is probably fine. And the guys have done a </span><span class="line" data-startTime="1152">really smart thing. Like they don't start </span><span class="line" data-startTime="1152">it at midnight and if you're a huge Web site </span><span class="line" data-startTime="1156">you've used your one percent by 12:15. They, </span><span class="line" data-startTime="1156">like, dole it out throughout the day. But </span><span class="line" data-startTime="1163">if you're a smaller Web site, you can change </span><span class="line" data-startTime="1163">it with some Google Analytics commands to </span><span class="line" data-startTime="1170">cover 100% of your Web site, but it's limited, </span><span class="line" data-startTime="1170">I think, to 10,000 measurements a day. But </span><span class="line" data-startTime="1176">again, those will be sampled throughout the </span><span class="line" data-startTime="1176">day, so you won't get biases based on peak </span><span class="line" data-startTime="1180">time and stuff like that. </span></p>

<p><span class="line" data-startTime="1180">And then I'm just going to talk really quick </span><span class="line" data-startTime="1184">about the other two parts of the timing spec. </span> <span class="line" data-startTime="1184">There's resource timing. And this is &mdash; there's </span><span class="line" data-startTime="1191">drafts of this available, but this hasn't </span><span class="line" data-startTime="1191">been nailed down. I don't think there's any </span><span class="line" data-startTime="1194">browser that supports it yet because the draft </span><span class="line" data-startTime="1194">is &mdash; the spec is still being defined. </span> <span class="line" data-startTime="1199">But this &mdash; if you think about it, navigation </span><span class="line" data-startTime="1199">timing is basically this same information, </span><span class="line" data-startTime="1204">but it's at the page level. It's really high. </span> <span class="line" data-startTime="1204">And what we're doing with resource timing </span><span class="line" data-startTime="1208">is we're bringing that down to every HTTP </span><span class="line" data-startTime="1208">request in the page. So for every HTTP request </span><span class="line" data-startTime="1214">in the page you can get DNS lookup time, connection </span><span class="line" data-startTime="1214">time, total time for that to come back. This </span><span class="line" data-startTime="1220">is going to be a great mechanism for if you're </span><span class="line" data-startTime="1220">using a CDN to track how your CDN &mdash; or maybe </span><span class="line" data-startTime="1225">you're testing out multiple CDN's, to see </span><span class="line" data-startTime="1225">how their performance is going. </span> <span class="line" data-startTime="1230">It does have to worry about security safeguards. </span> <span class="line" data-startTime="1230">So you could have some kind of hack where, </span><span class="line" data-startTime="1235">you know, on my Web site I have the logo from </span><span class="line" data-startTime="1235">some nefarious Web site. And when you land </span><span class="line" data-startTime="1243">on my Web site I can actually see what the </span><span class="line" data-startTime="1243">DNS time is. And if the DNS time is zero, </span><span class="line" data-startTime="1247">I know that you've been to this other Web </span><span class="line" data-startTime="1247">site. So there are some security safeguards </span><span class="line" data-startTime="1253">with HTTP headers. Web sites can allow or </span><span class="line" data-startTime="1253">not allow cross-domain tracking of resource </span><span class="line" data-startTime="1259">timing. </span></p>

<p><span class="line" data-startTime="1259">And then there's also user timing, which is </span><span class="line" data-startTime="1262">really important for people building Web2O </span><span class="line" data-startTime="1262">apps, AJAXy stuff. Something like Gmail that </span><span class="line" data-startTime="1268">is open for several hours, there's no concept </span><span class="line" data-startTime="1268">of a page load time. There's only one of those </span><span class="line" data-startTime="1274">when you start it up. </span> <span class="line" data-startTime="1274">So this is, if you're doing HXE stuff like </span><span class="line" data-startTime="1278">compose, this will give you commands that </span><span class="line" data-startTime="1278">you can use to say the user is about to do </span><span class="line" data-startTime="1284">a compose operation, let me &mdash; let me mark </span><span class="line" data-startTime="1284">a start time and then when the compose is </span><span class="line" data-startTime="1289">all done, you can mark an end time, you can </span><span class="line" data-startTime="1289">give it a label, and so it lets you define </span><span class="line" data-startTime="1294">and track any timing episodes that you care </span><span class="line" data-startTime="1294">about in the Web apps that you are building. </span> <span class="line" data-startTime="1300">So it basically is like nav timing but it's </span><span class="line" data-startTime="1300">much more flexible and lets you define the </span><span class="line" data-startTime="1305">start and stop times whenever you want in </span><span class="line" data-startTime="1305">your code. </span></p>

<p><span class="line" data-startTime="1310">The other one that I mentioned that they are </span><span class="line" data-startTime="1310">working on is page visibility. This one is </span><span class="line" data-startTime="1315">important from a performance perspective. </span> <span class="line" data-startTime="1315">Mostly from a &mdash; from an altruistic perspective, </span><span class="line" data-startTime="1322">but it could also affect, you know, what you </span><span class="line" data-startTime="1322">are doing on your Web site. And so basically </span><span class="line" data-startTime="1326">what the spec let's you do is detect when </span><span class="line" data-startTime="1326">your page is visible. So like one thing I </span><span class="line" data-startTime="1331">do in the morning when I come in, since I </span><span class="line" data-startTime="1331">can't stand to wait for Web sites to load, </span><span class="line" data-startTime="1336">is I have this script and I &mdash; you know, I </span><span class="line" data-startTime="1336">boot up my machine, I load the script, it </span><span class="line" data-startTime="1341">loads my 30 Web sites that I read every morning </span><span class="line" data-startTime="1341">and then I go get breakfast and when I come </span><span class="line" data-startTime="1346">back, all of the pages are loaded and I can </span><span class="line" data-startTime="1346">just go through all of the tabs. But only </span><span class="line" data-startTime="1350">the top tab is visible. And inevitably when </span><span class="line" data-startTime="1350">I come back, if I left my sound on, my office </span><span class="line" data-startTime="1356">manager, you know, giving me a dirty look, </span><span class="line" data-startTime="1356">because there's some hidden tab that's playing </span><span class="line" data-startTime="1361">video. And the sound &mdash; or maybe multiple </span><span class="line" data-startTime="1361">tabs that are playing video and the sound </span><span class="line" data-startTime="1366">is just annoying and it's like really? Like </span><span class="line" data-startTime="1366">you started the video, even though like the </span><span class="line" data-startTime="1372">tab is not even visible? Like why did you </span><span class="line" data-startTime="1372">do that? </span><span class="line" data-startTime="1374">And the page visibility API introduces a way </span><span class="line" data-startTime="1374">to detect whether or not the tab of the window </span><span class="line" data-startTime="1382">is visible. </span></p>

<p><span class="line" data-startTime="1382">And so this is also really important, like, </span><span class="line" data-startTime="1386">if you are tracking metrics, like page impressions. </span> <span class="line" data-startTime="1386">If the user opened the tab but they're never </span><span class="line" data-startTime="1393">going to go to it, but you counted it as an </span><span class="line" data-startTime="1393">impression, that's a miscount. Same thing </span><span class="line" data-startTime="1397">with ads. Again, the example of video. You </span><span class="line" data-startTime="1397">might be doing something like showing them, </span><span class="line" data-startTime="1404">you know, stock updates or the latest messages </span><span class="line" data-startTime="1404">from friends or you might be rotating through </span><span class="line" data-startTime="1409">a carousel of photos and they're not looking </span><span class="line" data-startTime="1409">at it. So not only are you kind of &mdash; like </span><span class="line" data-startTime="1414">you might rotate through a carousel of photos </span><span class="line" data-startTime="1414">that started with their favorite photo, but </span><span class="line" data-startTime="1418">by the time they opened the tab they are down </span><span class="line" data-startTime="1418">to their 5757th favorite photo and you have </span><span class="line" data-startTime="1423">kind of ruined the experience for yourself. </span> <span class="line" data-startTime="1423">So you could use it there. </span> <span class="line" data-startTime="1428">Um, the other thing that you can do is &mdash; this </span><span class="line" data-startTime="1428">API can be used for pre-fetching resources. </span> <span class="line" data-startTime="1438">So the Web site owner can decide and &mdash; the </span><span class="line" data-startTime="1438">Web site owner can decide if they want to </span><span class="line" data-startTime="1446">pre-fetch resources maybe for the next page </span><span class="line" data-startTime="1446">and also if the page should be prerendered. </span> <span class="line" data-startTime="1453">This is something that Chrome does. So Chrome </span><span class="line" data-startTime="1453">can actually prerender a page in the background. </span></p>

<p><span class="line" data-startTime="1459">But one of the problems with doing that is, </span><span class="line" data-startTime="1459">again, if there are ad impression counts or </span><span class="line" data-startTime="1465">page impression counts that are firing, and </span><span class="line" data-startTime="1465">the page is being rendered in the background, </span><span class="line" data-startTime="1471">and the user actually never sees it, that's </span><span class="line" data-startTime="1471">a miscount. So the page visibility API gives </span><span class="line" data-startTime="1477">people controlling those metrics the ability </span><span class="line" data-startTime="1477">to only fire the metrics when it makes sense. </span> <span class="line" data-startTime="1483">And I think this is only in Chrome right now. </span> <span class="line" data-startTime="1483">But what it looks like is you can say WebKit </span><span class="line" data-startTime="1489">hidden is the property, you can look at to </span><span class="line" data-startTime="1489">see whether or not the tab is hidden and this </span><span class="line" data-startTime="1494">is an event handler you can attach to to detect </span><span class="line" data-startTime="1494">when the page does become visible. </span> <span class="line" data-startTime="1503">So we had script defer in IE for years, but </span><span class="line" data-startTime="1503">now with HTML5 the async and defer attributes </span><span class="line" data-startTime="1512">are officially supported across almost every </span><span class="line" data-startTime="1512">browser out there. I'm not going to go into </span><span class="line" data-startTime="1519">it here but in fact I've talked for years </span><span class="line" data-startTime="1519">and written extensively about the impact that </span><span class="line" data-startTime="1526">scripts have on the user experience. </span> <span class="line" data-startTime="1526">So I mentioned earlier how the UI thread, </span><span class="line" data-startTime="1531">you know, the UI is single threaded, the browser </span><span class="line" data-startTime="1531">is single threaded, so if you have JavaScript, </span><span class="line" data-startTime="1537">for example, that takes three seconds to execute, </span><span class="line" data-startTime="1537">the user is clicking in the browser and they </span><span class="line" data-startTime="1543">are trying to scroll the window and nothing </span><span class="line" data-startTime="1543">is happening because the JavaScript is blocking </span><span class="line" data-startTime="1547">any of that interaction. And so &mdash; so that </span><span class="line" data-startTime="1547">also happens when the script is being downloaded. </span></p>

<p><span class="line" data-startTime="1553">So if you have a 500 k JavaScript payload </span><span class="line" data-startTime="1553">and the user has a slow connection, again, </span><span class="line" data-startTime="1558">it can take seconds for that to download. </span> <span class="line" data-startTime="1558">While that's downloading, the UI could be </span><span class="line" data-startTime="1564">blocked. Unless you can do your script loading </span><span class="line" data-startTime="1564">asynchronously. So if you just do scriptsource </span><span class="line" data-startTime="1570">equals main.js it's going to stop the HTML </span><span class="line" data-startTime="1570">parser from parsing past that script tag and </span><span class="line" data-startTime="1579">it's also going to block rendering. No browser </span><span class="line" data-startTime="1579">in the world will render anything below a </span><span class="line" data-startTime="1584">script tag until that script is downloaded </span><span class="line" data-startTime="1584">and parsed and executed. But you can use the </span><span class="line" data-startTime="1591">async attribute which tells the browser to </span><span class="line" data-startTime="1591">start the download but to go ahead and continue </span><span class="line" data-startTime="1598">parsing the HTML and rendering the DOM elements </span><span class="line" data-startTime="1598">in the page. So it gives the user feedback. </span> <span class="line" data-startTime="1605">It's a better user experience. The user can </span><span class="line" data-startTime="1605">see the page rendering, especially because </span><span class="line" data-startTime="1609">a lot of times we put scripts in the heads </span><span class="line" data-startTime="1609">of our pages, which means the entire body </span><span class="line" data-startTime="1614">is blocked from rendering until all of those </span><span class="line" data-startTime="1614">scripts are downloaded, parsed and executed. </span> <span class="line" data-startTime="1619">And so this tells the browser, download it </span><span class="line" data-startTime="1619">in the background, continue parsing; and as </span><span class="line" data-startTime="1625">soon as the script arrives, parse and execute </span><span class="line" data-startTime="1625">it. </span> <span class="line" data-startTime="1628">So one &mdash; two tricky things about this is </span><span class="line" data-startTime="1628">you can't have any document.write in this </span><span class="line" data-startTime="1634">JavaScript code because parser is already </span><span class="line" data-startTime="1634">past that point. You are going to get very </span><span class="line" data-startTime="1640">bad and varied results across browsers if </span><span class="line" data-startTime="1640">you do document.write in an async script. </span></p>

<p><span class="line" data-startTime="1646">The other challenge with async is suppose </span><span class="line" data-startTime="1646">that I have three scripts, A, B, C, C depends </span><span class="line" data-startTime="1651">on B, B depends on A. But A is probably like </span><span class="line" data-startTime="1651">jQuery, so might be my biggest script. C might </span><span class="line" data-startTime="1658">be really tiny, so if I load all of these </span><span class="line" data-startTime="1658">async, which is the one that's going to come </span><span class="line" data-startTime="1662">back first? C. If I loaded async, it's going </span><span class="line" data-startTime="1662">to be parsed and executed as soon as it comes </span><span class="line" data-startTime="1668">back and it's going to get undefined symbol </span><span class="line" data-startTime="1668">errors because B might not be back and A might </span><span class="line" data-startTime="1673">not be back. You can't just willy-nilly add </span><span class="line" data-startTime="1673">an async attribute to all of your script tags. </span> <span class="line" data-startTime="1679">But what you can do is you can use defer. </span> <span class="line" data-startTime="1679">If it's JavaScript that isn't critical for </span><span class="line" data-startTime="1683">rendering content to the page, and doesn't </span><span class="line" data-startTime="1683">have document.write can add the defer attribute. </span> <span class="line" data-startTime="1689">It's pretty similar. It says download it in </span><span class="line" data-startTime="1689">the background, let the parser continue parsing </span><span class="line" data-startTime="1696">and rendering DOM elements. After the entire </span><span class="line" data-startTime="1696">page is done, parse and execute these deferred </span><span class="line" data-startTime="1701">scripts and do it in the order that they were </span><span class="line" data-startTime="1701">listed in the page. And so if you have those </span><span class="line" data-startTime="1705">interdependencies across scripts, defer is </span><span class="line" data-startTime="1705">a good fallback. </span> <span class="line" data-startTime="1710">But &mdash; but this still doesn't give all of </span><span class="line" data-startTime="1710">the control that I think is really needed </span><span class="line" data-startTime="1718">to build a good user experience for &mdash; for </span><span class="line" data-startTime="1718">Web apps, especially on mobile. </span></p>

<p><span class="line" data-startTime="1723">For example, one thing that I would like to </span><span class="line" data-startTime="1723">do is I would like to download maybe a big </span><span class="line" data-startTime="1728">script, 100 k, 300 k, 500 k, but not parse </span><span class="line" data-startTime="1728">and execute it. It might be a script for something </span><span class="line" data-startTime="1735">like popping up a div to compose a message </span><span class="line" data-startTime="1735">or address book stuff that is only needed </span><span class="line" data-startTime="1740">if the user starts typing an email message. </span> <span class="line" data-startTime="1740">But if I download that, as soon as it hits </span><span class="line" data-startTime="1746">the browser, the parse and execute is going </span><span class="line" data-startTime="1746">to happen and it's going to lock up the UI. </span> <span class="line" data-startTime="1751">So I really want to get this JavaScript down </span><span class="line" data-startTime="1751">to the device, get it in cache, but parse </span><span class="line" data-startTime="1757">and execute it, depending on what the user </span><span class="line" data-startTime="1757">does. </span></p>

<p><span class="line" data-startTime="1760">The other thing that I would like to have </span><span class="line" data-startTime="1760">is a control over when the download happens. </span> <span class="line" data-startTime="1765">Right now the spec doesn't say when browser </span><span class="line" data-startTime="1765">should download the script. But if I've said </span><span class="line" data-startTime="1770">defer, if I've said async, certainly if I've </span><span class="line" data-startTime="1770">said defer, I would like you to do this download, </span><span class="line" data-startTime="1776">after everything more important is already </span><span class="line" data-startTime="1776">done, because there's a limited number of </span><span class="line" data-startTime="1780">TCP connections that the browser will make, </span><span class="line" data-startTime="1780">and if you download scripts or multiple scripts, </span><span class="line" data-startTime="1786">then things like the background image of the </span><span class="line" data-startTime="1786">page, the logo at the top of the page, might </span><span class="line" data-startTime="1791">actually be pushed out because you are already </span><span class="line" data-startTime="1791">using the six TCP connections that most browsers </span><span class="line" data-startTime="1797">allocate to a domain. </span> <span class="line" data-startTime="1797">So we don't have control over those in markup, </span><span class="line" data-startTime="1803">but there are techniques that you can use </span><span class="line" data-startTime="1803">to get that behavior. So this is one that </span><span class="line" data-startTime="1809">Gmail wrote about quite a while ago. Gmail </span><span class="line" data-startTime="1809">mobile team. And it's a hack. I think it's </span><span class="line" data-startTime="1816">a beautiful hack. </span></p>

<p><span class="line" data-startTime="1816">So what they did was in the page, they have </span><span class="line" data-startTime="1821">&mdash; you know, maybe 300 k of JavaScript. I'm </span><span class="line" data-startTime="1821">just making these numbers up. I don't know </span><span class="line" data-startTime="1826">how much JavaScript Gmail has. It's probably </span><span class="line" data-startTime="1826">more than that. But they have a lot of JavaScript </span><span class="line" data-startTime="1830">in here and they just wrap it in &mdash; in comment </span><span class="line" data-startTime="1830">delimiters. So what happens is this will get </span><span class="line" data-startTime="1837">downloaded to the browser, it will be cached, </span><span class="line" data-startTime="1837">it's already resident. But it's not parsed </span><span class="line" data-startTime="1843">and executed. So &mdash; so let's say this is compose </span><span class="line" data-startTime="1843">a new message JavaScript. It pops up in div, </span><span class="line" data-startTime="1851">it formats everything, it does error detection </span><span class="line" data-startTime="1851">and things like that. So we don't really need </span><span class="line" data-startTime="1859">this JavaScript to block the UI thread for </span><span class="line" data-startTime="1859">parse and execution until the user actually </span><span class="line" data-startTime="1864">clicks on the compose button, which they may </span><span class="line" data-startTime="1864">never do during this session. So what we do </span><span class="line" data-startTime="1868">is we download the code because we want it </span><span class="line" data-startTime="1868">on the device. When they click compose, especially </span><span class="line" data-startTime="1873">on a phone, we don't want to wait to download </span><span class="line" data-startTime="1873">300 k of JavaScript, we don't want to make </span><span class="line" data-startTime="1878">the user wait. So what we do is we download </span><span class="line" data-startTime="1878">it, you can even download it in the background. </span></p>

<p><span class="line" data-startTime="1883">It's not going to block the UI thread when </span><span class="line" data-startTime="1883">it arrives. Now the user clicks compose, you </span><span class="line" data-startTime="1887">have all of the JavaScript on the client and </span><span class="line" data-startTime="1887">now you just find the DOM element for the </span><span class="line" data-startTime="1892">script tag, remove the comment delimiters </span><span class="line" data-startTime="1892">and eval the code. A lot of people say eval </span><span class="line" data-startTime="1899">is evil. Doug Crawford is here today, I saw </span><span class="line" data-startTime="1899">him downstairs, he'll tell you that. Certainly </span><span class="line" data-startTime="1904">eval is evil from a security perspective. </span> <span class="line" data-startTime="1904">If you are eval'ing code that you didn't generate, </span><span class="line" data-startTime="1909">that can produce really bad things. You wouldn't </span><span class="line" data-startTime="1909">want to do this with third party widgets and </span><span class="line" data-startTime="1913">ads, et cetera. So this is code that you control, </span><span class="line" data-startTime="1913">that you generated. So from a security perspective, </span><span class="line" data-startTime="1921">it's okay and the actual performance of eval </span><span class="line" data-startTime="1921">is less than 10% worse than just a script </span><span class="line" data-startTime="1926">block. So from a performance perspective, </span><span class="line" data-startTime="1926">it's actually down like around one or two </span><span class="line" data-startTime="1931">percent. From a performance perspective, it's </span><span class="line" data-startTime="1931">fine. So you control the code, performance-wise </span><span class="line" data-startTime="1936">it's good. So this is a &mdash; this is a really </span><span class="line" data-startTime="1936">nice hack. </span> <span class="line" data-startTime="1941">And it's perfect for pre-fetching JavaScript </span><span class="line" data-startTime="1941">that you might need but you are not sure. </span> <span class="line" data-startTime="1945">It's possible that you will never need it. </span></p>

<p><span class="line" data-startTime="1945">So don't block the UI thread, especially for </span><span class="line" data-startTime="1949">large amounts of JavaScript. </span> <span class="line" data-startTime="1949">You know, this &mdash; might require a fair amount </span><span class="line" data-startTime="1956">of rewriting on your Web site. So I wrote </span><span class="line" data-startTime="1956">something called ControlJS, that's open source, </span><span class="line" data-startTime="1964">you can get it off my Web site. Several big </span><span class="line" data-startTime="1964">companies &mdash; I was just at this conference, </span><span class="line" data-startTime="1968">and I found that &mdash; including Wal-Mart, I </span><span class="line" data-startTime="1968">found several big companies that were using </span><span class="line" data-startTime="1972">this that I was really surprised at because </span><span class="line" data-startTime="1972">I don't do a lot of testing. </span> <span class="line" data-startTime="1976">[ Laughter ] </span></p>

<p class="speaker"><span class="line" data-starttime="1976"><span class="speakerName">Steve Souders</span>: I trust that they've done </span><span class="line" data-startTime="1981">that. </span> <span class="line" data-startTime="1981">And actually, who else &mdash; Washington Post </span><span class="line" data-startTime="1985">is using it. And I asked them to contribute </span><span class="line" data-startTime="1985">back the robustness changes they had to add. </span> <span class="line" data-startTime="1991">And so the thing that I like about this technique </span><span class="line" data-startTime="1991">is that it's all done in markup. So we can </span><span class="line" data-startTime="1997">just change &mdash; instead of script source, having </span><span class="line" data-startTime="1997">type text script, we would say text CJS, and </span><span class="line" data-startTime="2003">instead of a source we have a data control.js </span><span class="line" data-startTime="2003">source, so this means that the browser will </span><span class="line" data-startTime="2008">basically just ignore this and you can also </span><span class="line" data-startTime="2008">do it with inline scripts just by changing </span><span class="line" data-startTime="2014">the type. Then you load control.js. </span> <span class="line" data-startTime="2014">What it does is it crawls the DOM, and it </span><span class="line" data-startTime="2021">finds these script nodes and it does the right </span><span class="line" data-startTime="2021">thing. It downloads it asynchronously, it </span><span class="line" data-startTime="2026">does it in the background. Again, you would </span><span class="line" data-startTime="2026">only do this with scripts that aren't critical </span><span class="line" data-startTime="2030">for generating the initial user experience </span><span class="line" data-startTime="2030">and scripts that do not have any document.write. </span> <span class="line" data-startTime="2036">But I think it's a little easier to get on </span><span class="line" data-startTime="2036">top of. You can even add this execute false, </span><span class="line" data-startTime="2043">which says downloaded but don't parse and </span><span class="line" data-startTime="2043">execute it. And then later when the user, </span><span class="line" data-startTime="2048">for example, clicks on the compose button, </span><span class="line" data-startTime="2048">you can say control.js execute script. So </span><span class="line" data-startTime="2056">that's kind of a nice alternative. The other </span><span class="line" data-startTime="2056">thing I like about it, how many people here </span><span class="line" data-startTime="2061">have played with &mdash; with JavaScript loader, </span><span class="line" data-startTime="2061">script loaders, lab js or YUI lowered. Some </span><span class="line" data-startTime="2068">people &mdash; the thing that I find ironic about </span><span class="line" data-startTime="2068">all of the other alternatives out there is </span><span class="line" data-startTime="2073">their goal is to help you load JavaScript </span><span class="line" data-startTime="2073">asynchronously. They do that with a helper </span><span class="line" data-startTime="2077">script, but you have to load their helper </span><span class="line" data-startTime="2077">script synchronously. </span></p>

<p><span class="line" data-startTime="2081">[ Laughter ] </span></p>

<p class="speaker"><span class="line" data-starttime="2081"><span class="speakerName">Steve Souders</span>: Anyone else think that's </span><span class="line" data-startTime="2084">weird? Like, you know, synchronous loaded </span><span class="line" data-startTime="2084">scripts are bad. So you load our scripts synchronously </span><span class="line" data-startTime="2091">and we will help you avoid that problem. </span><span class="line" data-startTime="2091">[ Laughter ] </span></p>

<p class="speaker"><span class="line" data-starttime="2094"><span class="speakerName">Steve Souders</span>: Like &mdash; so from the beginning, </span><span class="line" data-startTime="2094">one of the requirements of ControlJS was that </span><span class="line" data-startTime="2099">you could load it asynchronously. So you would </span><span class="line" data-startTime="2099">use the Google Analytics, async loading pattern </span><span class="line" data-startTime="2105">and load the script anywhere you want in a </span><span class="line" data-startTime="2105">page and everything will still work. </span><span class="line" data-startTime="2109">So JavaScript is a really, really big problem. </span><span class="line" data-startTime="2109">I'm &mdash; make sure that you look at how it's </span><span class="line" data-startTime="2116">impacting your Web site and if possible adopt </span><span class="line" data-startTime="2116">some of these asynchronous loading techniques. </span><span class="line" data-startTime="2120">Okay. Shifting gears, I wanted to talk about </span><span class="line" data-startTime="2120">app cache, which is good for offline apps </span><span class="line" data-startTime="2127">and also for longer caching. </span><span class="line" data-startTime="2127">So again, the importance of the background </span><span class="line" data-startTime="2132">photo. You are in the desert. You typically </span><span class="line" data-startTime="2132">don't have a good connection. So having the </span><span class="line" data-startTime="2140">offline apps is really important. </span><span class="line" data-startTime="2140">[ Laughter ] </span></p>

<p class="speaker"><span class="line" data-starttime="2142"><span class="speakerName">Steve Souders</span>: There we go, the groan. So </span><span class="line" data-startTime="2142">building offline apps is really cool. I think </span><span class="line" data-startTime="2151">Google docs just announced that this week </span><span class="line" data-startTime="2151">or last week. It really helps with the user </span><span class="line" data-startTime="2157">experience when you have a bad connection, </span><span class="line" data-startTime="2157">you are flying, whatever. But also people </span><span class="line" data-startTime="2163">are using it from a performance perspective </span><span class="line" data-startTime="2163">for better caching. </span> <span class="line" data-startTime="2167">So this is a study that I did five or six </span><span class="line" data-startTime="2167">years ago with (saying name) when we were </span><span class="line" data-startTime="2174">at Yahoo, it's been a long time, but I've </span><span class="line" data-startTime="2174">talked to people at other big Web companies </span><span class="line" data-startTime="2178">who have run the same experiment and they </span><span class="line" data-startTime="2178">basically get the same results. So I encourage </span><span class="line" data-startTime="2183">you to run it on your Web site. Basically </span><span class="line" data-startTime="2183">we put a hidden pixel in every page, we tracked </span><span class="line" data-startTime="2189">how often people made a request with or without </span><span class="line" data-startTime="2189">an if-modified-since header. If they send </span><span class="line" data-startTime="2196">the if-modified-since request, it means they </span><span class="line" data-startTime="2196">have it in the cache. If they don't, it means </span><span class="line" data-startTime="2201">they don't have it in the cache. So we can </span><span class="line" data-startTime="2201">track how many people coming in, how many </span><span class="line" data-startTime="2205">page views are done with a full cache, a prime </span><span class="line" data-startTime="2205">cache. Our resources are in their cache or </span><span class="line" data-startTime="2212">with an empty cache, our resources are not </span><span class="line" data-startTime="2212">in their cache. </span></p>

<p><span class="line" data-startTime="2215">I talk about in my best practices setting </span><span class="line" data-startTime="2215">a far futures expires header. Turns out even </span><span class="line" data-startTime="2221">if you do that, browsers aren't going to keep </span><span class="line" data-startTime="2221">things around for that long or for whatever </span><span class="line" data-startTime="2226">reason, users are going to come in and they're </span><span class="line" data-startTime="2226">not going to have everything in cache that </span><span class="line" data-startTime="2231">you might expect. </span> <span class="line" data-startTime="2231">So what we see here is that for page views, </span><span class="line" data-startTime="2235">if you look at it from the page views perspective, </span><span class="line" data-startTime="2235">about 20% of page views on any given day are </span><span class="line" data-startTime="2243">done with a &mdash; with an empty cache. Right? </span><span class="line" data-startTime="2243">My resources are not in the cache. </span> <span class="line" data-startTime="2248">You can see on the first day, when we put </span><span class="line" data-startTime="2248">this pixel on the page, 100% of the pages </span><span class="line" data-startTime="2253">had an empty cache because this image had </span><span class="line" data-startTime="2253">never been loaded before. After about two </span><span class="line" data-startTime="2258">weeks, we hit a steady state and we can see </span><span class="line" data-startTime="2258">it's about 20%. We ran this on various properties </span><span class="line" data-startTime="2263">at Yahoo that had different user metrics. </span></p>

<p><span class="line" data-startTime="2263">This was always about the same. This number </span><span class="line" data-startTime="2268">fluctuated a little bit more, but it was always </span><span class="line" data-startTime="2268">between 40 and 60%. About half of your users </span><span class="line" data-startTime="2274">come in at least once a day with an empty </span><span class="line" data-startTime="2274">cache. So why are these numbers different? </span><span class="line" data-startTime="2280">Typically, users are doing multiple page views </span><span class="line" data-startTime="2280">in a session. So even if they have an empty </span><span class="line" data-startTime="2285">cache, they will come in and have an empty </span><span class="line" data-startTime="2285">cache page view, which will show up here and </span><span class="line" data-startTime="2290">show up here. But then they might do three </span><span class="line" data-startTime="2290">or four more page views, which are going to </span><span class="line" data-startTime="2294">be a prime cache, because when they did their </span><span class="line" data-startTime="2294">empty cache page load stuff got put into the </span><span class="line" data-startTime="2299">cache. So that's why these numbers are different. </span> <span class="line" data-startTime="2299">But it still means people anchor on negative </span><span class="line" data-startTime="2304">experience. So if half of your users were </span><span class="line" data-startTime="2304">coming in every day with an empty cache, and </span><span class="line" data-startTime="2310">you are not taking that into consideration, </span><span class="line" data-startTime="2310">you are like, well, yeah, it's not 300 k image </span><span class="line" data-startTime="2314">or script but it will be in the cache, for </span><span class="line" data-startTime="2314">about half of your users, it's not going to </span><span class="line" data-startTime="2319">be in the cache. So you can run this experiment </span><span class="line" data-startTime="2319">yourself and you will get the same results. </span></p>

<p><span class="line" data-startTime="2325">So the cache, even if you are doing far future </span><span class="line" data-startTime="2325">expires, the cache might not be doing what </span><span class="line" data-startTime="2331">you think. And &mdash; and here's a great study </span><span class="line" data-startTime="2331">from Guy Poe over at Blaze, now Akamai, where </span><span class="line" data-startTime="2338">he shows that mobile caches are very small. </span> <span class="line" data-startTime="2338">This is another reason why things you think </span><span class="line" data-startTime="2343">should be in the cache won't be. This was </span><span class="line" data-startTime="2343">a study I did where I found that &mdash; I like </span><span class="line" data-startTime="2348">building Web apps and putting them on the </span><span class="line" data-startTime="2348">home screen and turned out in iOS if you do </span><span class="line" data-startTime="2354">that the cache isn't used optimally. So you </span><span class="line" data-startTime="2354">can use app cache for caching. </span> <span class="line" data-startTime="2363">So the way they use app cache at this manifest </span><span class="line" data-startTime="2363">attribute, you give it a file name, which </span><span class="line" data-startTime="2368">is your app cache. Manifest is a good name </span><span class="line" data-startTime="2368">I think we all intuitively recognize what </span><span class="line" data-startTime="2374">we are going to see here. Here's your manifest </span><span class="line" data-startTime="2374">file. It has to start with this cache manifest </span><span class="line" data-startTime="2380">header. We will talk about the revision number </span><span class="line" data-startTime="2380">in a second, but you'll want to add that. </span> <span class="line" data-startTime="2384">It's got these various sections, a cache section </span><span class="line" data-startTime="2384">says these are the things that I want you </span><span class="line" data-startTime="2388">to put into app cache. The network session </span><span class="line" data-startTime="2388">says these are the things that you should </span><span class="line" data-startTime="2393">never put into app cache. The fallback section </span><span class="line" data-startTime="2393">says if the user is online, then use this </span><span class="line" data-startTime="2401">URL. But if they are offline, read this one </span><span class="line" data-startTime="2401">from app cache. So the browser, when the user </span><span class="line" data-startTime="2406">is online, will download this one, but will </span><span class="line" data-startTime="2406">also download this one and save it into app </span><span class="line" data-startTime="2411">cache. At least right now, you have to make </span><span class="line" data-startTime="2411">sure to give this a very specific content </span><span class="line" data-startTime="2415">type. Text/cache-manifest. So it looks pretty </span><span class="line" data-startTime="2415">good. It turns out actually it's really, really, </span><span class="line" data-startTime="2422">really hard and complicated to work with. </span></p>

<p><span class="line" data-startTime="2422">So here are some of the gotchas that you will </span><span class="line" data-startTime="2427">probably run into. I know I did. </span> <span class="line" data-startTime="2427">I didn't realize &mdash; like, I never listed my </span><span class="line" data-startTime="2431">HTML document itself, .php, .HTML in the manifest </span><span class="line" data-startTime="2431">file, so I just assumed it wouldn't be put </span><span class="line" data-startTime="2438">into app cache. </span> <span class="line" data-startTime="2438">But if your HTML document uses the manifest </span><span class="line" data-startTime="2443">attribute, then it's going to be saved to </span><span class="line" data-startTime="2443">app cache. This was really confusing for me </span><span class="line" data-startTime="2447">because I had a log-in box on the front page. </span> <span class="line" data-startTime="2447">And if the user came in and their app cache </span><span class="line" data-startTime="2453">was empty and they weren't logged in, the </span><span class="line" data-startTime="2453">logged-out version of the page would be saved; </span><span class="line" data-startTime="2459">every time they came back, that's what they </span><span class="line" data-startTime="2459">would see even after logging in. So that's </span><span class="line" data-startTime="2463">a little confusing. If anything in the manifest </span><span class="line" data-startTime="2463">list 404s, nothing is saved. You get about </span><span class="line" data-startTime="2469">five meg, which is pretty good. Yeah, so this </span><span class="line" data-startTime="2469">is interesting, suppose you change one of </span><span class="line" data-startTime="2476">the resources listed in the manifest file, </span><span class="line" data-startTime="2476">like an image, you would think that the next </span><span class="line" data-startTime="2480">time the user opens the app, they would see </span><span class="line" data-startTime="2480">that new image. They don't. You actually have </span><span class="line" data-startTime="2487">to change something in the manifest file to </span><span class="line" data-startTime="2487">make it different, and that's why the revision </span><span class="line" data-startTime="2492">number was in there on the previous slide. </span></p>

<p><span class="line" data-startTime="2492">That's what I do is I have that automatically </span><span class="line" data-startTime="2498">updated whenever I update through source code, </span><span class="line" data-startTime="2498">through my source code control system, it </span><span class="line" data-startTime="2503">will automatically update that revision number, </span><span class="line" data-startTime="2503">so the manifest is always touched whenever </span><span class="line" data-startTime="2508">I update a resource, and this was really confusing </span><span class="line" data-startTime="2508">to me. Even if you do, you know, rev the manifest </span><span class="line" data-startTime="2518">file, the user still won't see the change </span><span class="line" data-startTime="2518">until the second time they open the app. So </span><span class="line" data-startTime="2524">I think this is really interesting, and it's </span><span class="line" data-startTime="2524">a real gotcha', so I wanted to walk through </span><span class="line" data-startTime="2528">it in more detail, so let's suppose you go </span><span class="line" data-startTime="2528">home today and you build mobile Web app that </span><span class="line" data-startTime="2535">uses app cache, or a desktop app that uses </span><span class="line" data-startTime="2535">app cache, and it's got this awesome green </span><span class="line" data-startTime="2540">logo that the designer gave you, and you list </span><span class="line" data-startTime="2540">that into your app cache manifest file, so </span><span class="line" data-startTime="2548">you push that tonight, tomorrow, the first </span><span class="line" data-startTime="2548">user ever downloads your app, and the app </span><span class="line" data-startTime="2556">cache is obviously empty. They've never seen </span><span class="line" data-startTime="2556">this before, and so the browser fetches the </span><span class="line" data-startTime="2561">manifest file and in there the logo is listed </span><span class="line" data-startTime="2561">so the browser downloads that, puts it into </span><span class="line" data-startTime="2566">app cache, and renders the app to the user </span><span class="line" data-startTime="2566">so the user sees the awesome green logo. So </span><span class="line" data-startTime="2573">now suppose tomorrow night you go, you know, </span><span class="line" data-startTime="2573">I really think an orange logo would be better, </span><span class="line" data-startTime="2579">so you push to your server this new orange </span><span class="line" data-startTime="2579">logo, and you remember to change the version </span><span class="line" data-startTime="2585">number in the manifest file. So the logo is </span><span class="line" data-startTime="2585">new, the manifest file is new. And on &mdash; today's </span><span class="line" data-startTime="2594">Friday, so you do that Saturday night, so </span><span class="line" data-startTime="2594">on Sunday, the user &mdash; same user loads the </span><span class="line" data-startTime="2602">app again, and the browser says, okay, well, </span><span class="line" data-startTime="2602">this app has a manifest file associated with </span><span class="line" data-startTime="2609">it. Do I have any of those resources in my </span><span class="line" data-startTime="2609">app cache? </span><span class="line" data-startTime="2611">Oh, I do. I need logo.jif, or i have logo.jif </span><span class="line" data-startTime="2611">in my app cache; it's this pretty green logo. </span></p>

<p><span class="line" data-startTime="2617">Even though I've already pushed an orange </span><span class="line" data-startTime="2617">logo to my server, the browser is ignoring </span><span class="line" data-startTime="2622">that. That's why it can work offline. It can </span><span class="line" data-startTime="2622">say I have this stuff in app cache, let me </span><span class="line" data-startTime="2628">load as much as I can without using the network. </span> <span class="line" data-startTime="2628">And so it displays that app cache logo to </span><span class="line" data-startTime="2635">the user. But now what it does is it's &mdash; once </span><span class="line" data-startTime="2635">it's rendered the app with the old out-of-date </span><span class="line" data-startTime="2642">logo, it fetches the manifest file, it detects </span><span class="line" data-startTime="2642">that it's changed and so then it checks all </span><span class="line" data-startTime="2648">other resources in the manifest file and it </span><span class="line" data-startTime="2648">gets the new version of the logo which is </span><span class="line" data-startTime="2653">orange, it saves that to app cache, so if </span><span class="line" data-startTime="2653">the user reloads the app, a second time, it </span><span class="line" data-startTime="2660">will &mdash; the browser will look in app cache </span><span class="line" data-startTime="2660">and now it has the orange logo, so it renders </span><span class="line" data-startTime="2665">the orange logo to the user, it fetches the </span><span class="line" data-startTime="2665">manifest file which hasn't changed and so </span><span class="line" data-startTime="2669">it's done. So it's really taken these two </span><span class="line" data-startTime="2669">loads &mdash; after I update a resource it takes </span><span class="line" data-startTime="2674">two loads for the user to see the changes. </span></p>

<p><span class="line" data-startTime="2674">Now, there is a work around to this, it's </span><span class="line" data-startTime="2680">not that hard, but not that easy. There's </span><span class="line" data-startTime="2680">this update ready part. The implementation </span><span class="line" data-startTime="2685">is pretty easy. I can track this. But it's </span><span class="line" data-startTime="2685">what do I want to do with the user experience? </span><span class="line" data-startTime="2690">So in the background, the browser detected </span><span class="line" data-startTime="2690">that there was a new logo, and it fires this </span><span class="line" data-startTime="2695">update ready, but are you going to tell the </span><span class="line" data-startTime="2695">user to like reload the app to see the changes? </span><span class="line" data-startTime="2701">I don't know, you have to decide for yourself. </span> <span class="line" data-startTime="2701">Maybe if it's just images it's not that important. </span> <span class="line" data-startTime="2705">If it's like an important JavaScript security </span><span class="line" data-startTime="2705">privacy fix, then, yeah, maybe you want to </span><span class="line" data-startTime="2710">tell them to reload it, or you want to reload </span><span class="line" data-startTime="2710">it without even telling them, just reload </span><span class="line" data-startTime="2714">the app. Another way to do improved caching </span><span class="line" data-startTime="2714">because we know the browser cache doesn't </span><span class="line" data-startTime="2721">work super awesome is local storage. Really </span><span class="line" data-startTime="2721">simple API. Local storage is persistent across </span><span class="line" data-startTime="2728">sessions. If you only care about sessions, </span><span class="line" data-startTime="2728">you can use session storage. It's about five </span><span class="line" data-startTime="2732">meg. One warning, browser developers really </span><span class="line" data-startTime="2732">are worried about this getting too much use </span><span class="line" data-startTime="2740">because it does a synchronous read. Some browsers </span><span class="line" data-startTime="2740">will actually read everything out of local </span><span class="line" data-startTime="2745">storage, the first time you go to that page </span><span class="line" data-startTime="2745">during the session, and if you have a lot </span><span class="line" data-startTime="2750">of stuff in local storage, again, it's single-threaded </span><span class="line" data-startTime="2750">so that can slow down the user experience. </span></p>

<p><span class="line" data-startTime="2756">So I built this bookmark that lets you look </span><span class="line" data-startTime="2756">into what is stored in local storage, and </span><span class="line" data-startTime="2762">I discovered a couple of interesting things </span><span class="line" data-startTime="2762">that Bing and Google search were doing, which </span><span class="line" data-startTime="2767">I hadn't thought of, and it's very cool to </span><span class="line" data-startTime="2767">help with caching. So I think this is the </span><span class="line" data-startTime="2772">Google search &mdash; Google mobile search implementation. </span> <span class="line" data-startTime="2772">The first time you do a search, the HTML document </span><span class="line" data-startTime="2779">will return all of these inline script and </span><span class="line" data-startTime="2779">style blocks, a lot of JavaScript and CSS, </span><span class="line" data-startTime="2787">and when it's done, it iterates over those </span><span class="line" data-startTime="2787">script tags and style tags that have IDs, </span><span class="line" data-startTime="2793">and it takes the content of the block, and </span><span class="line" data-startTime="2793">writes it into local storage based on the </span><span class="line" data-startTime="2799">ID of that element. So now, after I've done </span><span class="line" data-startTime="2799">this first search ever on my phone, I have </span><span class="line" data-startTime="2805">blocks of JavaScript and CSS in my local storage, </span><span class="line" data-startTime="2805">so now let's say I do another &mdash; oh, and the </span><span class="line" data-startTime="2812">other thing it does is it sets a cookie that </span><span class="line" data-startTime="2812">says which blocks of JavaScript and CSS have </span><span class="line" data-startTime="2819">been written into this user's local storage. </span> <span class="line" data-startTime="2819">So now if I do another search, this cookie </span><span class="line" data-startTime="2824">goes up to the server, and the server says, </span><span class="line" data-startTime="2824">oh, well, you're doing a search, I have to </span><span class="line" data-startTime="2828">give you this block and that block and this </span><span class="line" data-startTime="2828">JavaScript and this CSS. Let me see what you </span><span class="line" data-startTime="2833">already have in local storage. It looks at </span><span class="line" data-startTime="2833">the cookie and says, oh, you already have </span><span class="line" data-startTime="2837">this block, I don't have to send you that, </span><span class="line" data-startTime="2837">I don't have to send you this CSS, and for </span><span class="line" data-startTime="2841">&mdash; in the case of mobile search, it drops </span><span class="line" data-startTime="2841">the download size from about 110K to just </span><span class="line" data-startTime="2849">10K, because all that stuff is now in local </span><span class="line" data-startTime="2849">storage. And then when the lightweight page </span><span class="line" data-startTime="2855">arrives, there's some JavaScript that will </span><span class="line" data-startTime="2855">pull all of these things out of local storage </span><span class="line" data-startTime="2860">and write them into the page. So this is a </span><span class="line" data-startTime="2860">really cool way to get more persistent cache. </span></p>

<p><span class="line" data-startTime="2867">Local storage is unaffected by other Web sites </span><span class="line" data-startTime="2867">whereas the shared browser cache, if the user </span><span class="line" data-startTime="2873">visits a bunch of other Web sites that have </span><span class="line" data-startTime="2873">large resources, your content might get pushed </span><span class="line" data-startTime="2878">out. So I did a quick survey using this is </span><span class="line" data-startTime="2878">what this &mdash; I'm a good JavaScript hacker. </span> <span class="line" data-startTime="2884">I'm not a good UI designer. This is my awesome </span><span class="line" data-startTime="2884">storage or bookmark list, and you can see </span><span class="line" data-startTime="2889">it lets you look at what's in the local storage </span><span class="line" data-startTime="2889">and session storage, tells you how big it </span><span class="line" data-startTime="2895">is, how many items it is. So let's just do </span><span class="line" data-startTime="2895">a quick run through the Alexa Top 10 and see </span><span class="line" data-startTime="2901">how local storage is being used. So here we </span><span class="line" data-startTime="2901">have &mdash; Google search is using it on both </span><span class="line" data-startTime="2908">mobile and desktop, so that's one. Bing is </span><span class="line" data-startTime="2908">using it on mobile. Facebook is using it on </span><span class="line" data-startTime="2916">mobile. Yahoo is maybe using it a little bit, </span><span class="line" data-startTime="2916">but not really. We're not going to count that. </span> <span class="line" data-startTime="2924">YouTube, yeah, we'll count that. Quite a bit </span><span class="line" data-startTime="2924">of content on mobile. Amazon, no. Twitter? </span><span class="line" data-startTime="2931">Yeah, okay, we'll count that. Five. LinkedIn, </span><span class="line" data-startTime="2931">no, I would say. eBay, no. MSN, no. So about </span><span class="line" data-startTime="2943">five or six of the Alexa Top 10 are using </span><span class="line" data-startTime="2943">local storage, so that's an indicator that, </span><span class="line" data-startTime="2948">you know, it's worth investigating. Why is </span><span class="line" data-startTime="2948">it more &mdash; maybe used more prevalently on </span><span class="line" data-startTime="2952">mobile? </span><span class="line" data-startTime="2952">You know, the experience of not having something </span><span class="line" data-startTime="2956">in the cache in mobile is worse, because the </span><span class="line" data-startTime="2956">network connection speed is so slow, also </span><span class="line" data-startTime="2961">the cache is smaller on mobile, so caching </span><span class="line" data-startTime="2961">isn't awesome on desktop, but is much better </span><span class="line" data-startTime="2966">on mobile, so I think that's why these top </span><span class="line" data-startTime="2966">properties started using local storage on </span><span class="line" data-startTime="2972">mobile, but I would expect to see this proliferate </span><span class="line" data-startTime="2972">on desktop apps as well. So I want to talk </span><span class="line" data-startTime="2978">about font-face. Again, pay attention to the </span><span class="line" data-startTime="2978">photos, not to what I say. So, you know, fonts, </span><span class="line" data-startTime="2988">using custom fonts can create a more compelling, </span><span class="line" data-startTime="2988">beautiful experience, but people haven't really </span><span class="line" data-startTime="2993">paid attention to what it does, similar to </span><span class="line" data-startTime="2993">how scripts and style sheets can block a page, </span><span class="line" data-startTime="2999">what custom font files do, and so I created </span><span class="line" data-startTime="2999">this table that here's the blog post, that </span><span class="line" data-startTime="3007">shows how scripts and style sheets and fonts </span><span class="line" data-startTime="3007">can affect, and, you know, "blank below in </span><span class="line" data-startTime="3012">red" means that everything using this font </span><span class="line" data-startTime="3012">or below it are going to be affected. Flash </span><span class="line" data-startTime="3021">&mdash; oh, delayed means &mdash; blank is really bad. </span></p>

<p><span class="line" data-startTime="3021">It means like everything in the page is blank. </span> <span class="line" data-startTime="3028">Delayed means just the element that's using </span><span class="line" data-startTime="3028">the font file is affected. Flash means once </span><span class="line" data-startTime="3034">the things &mdash; things will render, but once </span><span class="line" data-startTime="3034">the resource arrives it has to be redrawn, </span><span class="line" data-startTime="3040">and so it's kind of a jerky user experience, </span><span class="line" data-startTime="3040">things have to be rerenderred and repainted. </span> <span class="line" data-startTime="3045">So you can see the impact. Even the green </span><span class="line" data-startTime="3045">"good" is not really a good experience. And </span><span class="line" data-startTime="3050">so you want to use fonts kind of carefully. </span> <span class="line" data-startTime="3050">And it's kind of ironic, it's kind of how </span><span class="line" data-startTime="3057">these async script loader libraries make you </span><span class="line" data-startTime="3057">load their scripts synchronously. When I talk </span><span class="line" data-startTime="3062">to designers about why they're using custom </span><span class="line" data-startTime="3062">fonts, even though we know it has this impact </span><span class="line" data-startTime="3067">on the user experience, they say, well, these </span><span class="line" data-startTime="3067">are the most important design elements in </span><span class="line" data-startTime="3071">the page. I'm like, "so you want the most </span><span class="line" data-startTime="3071">important parts of the page to take the longest </span><span class="line" data-startTime="3076">to render?" </span><span class="line" data-startTime="3076">Like, that doesn't make sense to me. So despite </span><span class="line" data-startTime="3082">my warnings, custom fonts have taken off, </span><span class="line" data-startTime="3082">like they've more than doubled in the last </span><span class="line" data-startTime="3088">year, this is a chart from the HTP archive. </span> <span class="line" data-startTime="3088">So they're taking off. The good thing is the </span><span class="line" data-startTime="3094">folks at Typekit and the Google fonts library </span><span class="line" data-startTime="3094">have done a lot of good work to mitigate the </span><span class="line" data-startTime="3102">impact that custom fonts files have, but we </span><span class="line" data-startTime="3102">can still go farther. In fact, I think Google </span><span class="line" data-startTime="3108">fonts library just announced custom fonts </span><span class="line" data-startTime="3108">a few months ago. If you don't need &mdash; like </span><span class="line" data-startTime="3113">if you're only using digits or other certain </span><span class="line" data-startTime="3113">characters, like it's just a word that you </span><span class="line" data-startTime="3117">want to render in that font, you can actually </span><span class="line" data-startTime="3117">create a smaller font. The font files are </span><span class="line" data-startTime="3123">typically like over 100K, so you can create </span><span class="line" data-startTime="3123">one that is just the characters that you need. </span></p>

<p><span class="line" data-startTime="3132">The flash of unstyled text means you draw </span><span class="line" data-startTime="3132">text and then you have to redraw it, and so </span><span class="line" data-startTime="3138">what I would propose is that browsers have </span><span class="line" data-startTime="3138">like an impatient fallback, like if &mdash; I don't </span><span class="line" data-startTime="3145">want to have this flash of my text, so I'm </span><span class="line" data-startTime="3145">going to wait 250 milliseconds for the font </span><span class="line" data-startTime="3151">file. If it hasn't come back and we're drawing </span><span class="line" data-startTime="3151">in a default font, and even if the font files </span><span class="line" data-startTime="3155">comes back later, I'm not going to redraw </span><span class="line" data-startTime="3155">it. I'll cache that font for the next time </span><span class="line" data-startTime="3159">the user goes to the page, but I'm not going </span><span class="line" data-startTime="3159">to do that, and again, I think this is a behavior </span><span class="line" data-startTime="3164">that the Google font library and Typekit loaders </span><span class="line" data-startTime="3164">do automatically for you. Yeah. And also, </span><span class="line" data-startTime="3175">okay, I'm running short on time, so I'm going </span><span class="line" data-startTime="3175">to go a little faster. Font should be given </span><span class="line" data-startTime="3179">a higher priority in caching. Browsers are </span><span class="line" data-startTime="3179">still just starting to pay attention to that, </span><span class="line" data-startTime="3185">and even if a font is expired, I might want </span><span class="line" data-startTime="3185">to render with it, and do a "if modified since </span><span class="line" data-startTime="3193">request", and then if I get back, "oh, not </span><span class="line" data-startTime="3193">modified?" </span><span class="line" data-startTime="3195">It's okay, I've already rendered with a font. </span></p>

<p><span class="line" data-startTime="3195">All I have to do is validate it. Oh, good, </span><span class="line" data-startTime="3200">I'm getting close to the end, so there's a </span><span class="line" data-startTime="3200">lot more stuff I didn't talk about. We &mdash; you </span><span class="line" data-startTime="3205">know, all of us spent a lot of time building </span><span class="line" data-startTime="3205">rounded corners that downloaded a bunch of </span><span class="line" data-startTime="3210">images, so now you can do a lot of things </span><span class="line" data-startTime="3210">that used to require HTP traffic, you can </span><span class="line" data-startTime="3215">do with CSS 3, so that's cool. You have to </span><span class="line" data-startTime="3215">be a little careful, these incur, you know, </span><span class="line" data-startTime="3222">might incur a lot of CPU overhead or repaints. </span> <span class="line" data-startTime="3222">You can use SVG and canvas instead of downloading </span><span class="line" data-startTime="3229">images. Video tag could make starting up videos </span><span class="line" data-startTime="3229">faster. Web sockets, if you have a very chatty </span><span class="line" data-startTime="3235">sort of app can be used. Web workers, if you </span><span class="line" data-startTime="3235">have like a lot of computation that you want </span><span class="line" data-startTime="3240">to get out of the UI thread, you can use Web </span><span class="line" data-startTime="3240">workers, oh, for some things that we used </span><span class="line" data-startTime="3245">to have to write a lot of JavaScript or HTML </span><span class="line" data-startTime="3245">for, you can do with these new built-in controls. </span> <span class="line" data-startTime="3251">Again, the photo, more, infinite number of </span><span class="line" data-startTime="3251">digits. History API, we used to have to implement </span><span class="line" data-startTime="3260">this in JavaScript. Now we don't have to download </span><span class="line" data-startTime="3260">all that JavaScript. Ping is a way to avoid </span><span class="line" data-startTime="3265">a redirect if you want to track something. </span> <span class="line" data-startTime="3265">Don't use set time-out for animation. Use </span><span class="line" data-startTime="3271">request animation frame. It will be faster. </span> <span class="line" data-startTime="3271">You can use the native JSON parser, and here </span><span class="line" data-startTime="3277">are some good resources to get more information </span><span class="line" data-startTime="3277">about this other HTML5 stuff. So what are </span><span class="line" data-startTime="3282">the takeaways? </span><span class="line" data-startTime="3282">Speed matters. Hopefully we all agree about </span><span class="line" data-startTime="3286">that. I saw you raise your hand before. So </span><span class="line" data-startTime="3286">I'm going to hold you to that. Pay attention </span><span class="line" data-startTime="3290">to what's coming out of the Web performance </span><span class="line" data-startTime="3290">working group out of the W3C. You can use </span><span class="line" data-startTime="3295">window.performance to track the timing on </span><span class="line" data-startTime="3295">your pages, and even if you haven't done that </span><span class="line" data-startTime="3299">yet, if you're using Google Analytics, you </span><span class="line" data-startTime="3299">can go and see the data there. It's already </span><span class="line" data-startTime="3303">been gathered for the last few months. JavaScript </span><span class="line" data-startTime="3303">blocking the UI thread is really critical. </span></p>

<p><span class="line" data-startTime="3309">Try to get a lot of that stuff deferred or </span><span class="line" data-startTime="3309">async, and caching is really important. I </span><span class="line" data-startTime="3314">think it's one of the most important things </span><span class="line" data-startTime="3314">for a fast user experience. Browsers are improving </span><span class="line" data-startTime="3319">their cache. Mobile browsers have a lot of </span><span class="line" data-startTime="3319">room to catch up on, so you can try some of </span><span class="line" data-startTime="3323">these other techniques. And be careful about </span><span class="line" data-startTime="3323">using font-face. So before I close out, I </span><span class="line" data-startTime="3329">want to mention, if you like this kind of </span><span class="line" data-startTime="3329">performance stuff, I'm sorry, but you should </span><span class="line" data-startTime="3334">have been at Velocity this week. We just finished </span><span class="line" data-startTime="3334">that Wednesday. But if you missed that, you </span><span class="line" data-startTime="3340">could go to Web PERF days, the first ever, </span><span class="line" data-startTime="3340">but &mdash; well, actually, that was yesterday. </span> <span class="line" data-startTime="3343">Okay, so you missed that one. </span></p>

<p><span class="line" data-startTime="3343">[ Laughter ] </span></p>

<p class="speaker"><span class="line" data-starttime="3346"><span class="speakerName">Steve Souders</span>: Oh, okay, we've got Velocity </span><span class="line" data-startTime="3346">Europe coming up in October, so you might </span><span class="line" data-startTime="3351">have to go a little farther, but &mdash; and we'll </span><span class="line" data-startTime="3351">be back next year in June for Velocity. I </span><span class="line" data-startTime="3356">also wanted to just mention this &mdash; oh, I </span><span class="line" data-startTime="3356">added this like five minutes before I came </span><span class="line" data-startTime="3362">on stage. How can I do this, like &mdash; I don't </span><span class="line" data-startTime="3362">know, I have to go through them all. So (indiscernible) </span><span class="line" data-startTime="3369">runs this performance calendar every year, </span><span class="line" data-startTime="3369">and O'Reilly took the most recent performance </span><span class="line" data-startTime="3375">calendar and put it into a book, so this just </span><span class="line" data-startTime="3375">came out this week, and you can get most of </span><span class="line" data-startTime="3381">this content on the blog for the performance </span><span class="line" data-startTime="3381">calendar, but the &mdash; they were updated, and </span><span class="line" data-startTime="3386">if you like books, you can get it in book </span><span class="line" data-startTime="3386">form here. So that's it. Thank you very much. </span><span class="line" data-startTime="3396">[ Applause ] </span></p>

<p class="speaker"><span class="line" data-starttime="3396"><span class="speakerName">Steve Souders</span>: So I've got about four minutes, </span><span class="line" data-startTime="3401">I would be happy to answer any questions and </span><span class="line" data-startTime="3401">I think they want you to use the mic. Everyone </span><span class="line" data-startTime="3408">is heading out. </span></p>

<p class="speaker"><span class="line" data-starttime="3408"><span class="speakerName">Audience member</span>: Would you care to expand upon font awesome? </span><span class="line" data-startTime="3414">And also to resolve some of the issues of </span><span class="line" data-startTime="3414">pop-in, I found setting a fixed type for whatever </span><span class="line" data-startTime="3419">text I decide is very nice. </span></p>

<p class="speaker"><span class="line" data-starttime="3419"><span class="speakerName">Steve Souders</span>: What's the first one? Expound </span><span class="line" data-startTime="3424">on... </span></p>

<p class="speaker"><span class="line" data-starttime="3424"><span class="speakerName">Audience member</span>: Font awesome, using fonts instead of sprites? </span></p>

<p class="speaker"><span class="line" data-starttime="3428"><span class="speakerName">Steve Souders</span>: Oh, yeah, so you can create </span><span class="line" data-startTime="3428">a custom font, you know, file, that has little </span><span class="line" data-startTime="3438">pictures, you know, kind of like wings &mdash; what </span><span class="line" data-startTime="3438">is it on windows? The wings font, wingdings, </span><span class="line" data-startTime="3445">yeah, so you can do that with a font, so if </span><span class="line" data-startTime="3445">you have like really small images that you're </span><span class="line" data-startTime="3450">using now and you're downloading them as HTP </span><span class="line" data-startTime="3450">requests instead of images, instead you can </span><span class="line" data-startTime="3455">download a font fall. It doesn't have to be </span><span class="line" data-startTime="3455">huge. Maybe you have 10 of those or 20 of </span><span class="line" data-startTime="3458">those, and you can download those and use </span><span class="line" data-startTime="3458">those to draw those little images, those little </span><span class="line" data-startTime="3466">sprites in the page for like maybe little </span><span class="line" data-startTime="3466">buttons or things like that, and so, you know, </span><span class="line" data-startTime="3471">I think that's a great idea. You could also </span><span class="line" data-startTime="3471">use sprites. Sprites are maybe a little harder </span><span class="line" data-startTime="3475">to do. You have to create the image and know </span><span class="line" data-startTime="3475">all the CSS, but the one thing I would say, </span><span class="line" data-startTime="3480">if you're using any kind of font file, is </span><span class="line" data-startTime="3480">try to figure out a way to do it that doesn't </span><span class="line" data-startTime="3484">block the page, like especially in IE. Custom </span><span class="line" data-startTime="3484">font files block rendering of everything in </span><span class="line" data-startTime="3490">the page, so if you could do that lazily or </span><span class="line" data-startTime="3490">something like that, that would be good, and </span><span class="line" data-startTime="3495">then the second one was... </span></p>

<p class="speaker"><span class="line" data-starttime="3495"><span class="speakerName">Audience member</span>: Just a tip to deal with font snapping </span><span class="line" data-startTime="3502">in after they loaded, the ugly hack of just </span><span class="line" data-startTime="3502">setting a fixed type for everything. So at </span><span class="line" data-startTime="3507">least it doesn't like reflow. </span></p>

<p class="speaker"><span class="line" data-starttime="3507"><span class="speakerName">Steve Souders</span>: Yeah, yeah, you could do </span><span class="line" data-startTime="3510">that. Yes, another question. </span></p>

<p class="speaker"><span class="line" data-starttime="3510"><span class="speakerName">Audience member</span>: Yeah, you said mobile browsers don't support </span><span class="line" data-startTime="3516">most of those features yet, custom, you know, </span><span class="line" data-startTime="3516">desktop browsers either, so how would we test </span><span class="line" data-startTime="3522">them? </span></p>

<p class="speaker"><span class="line" data-starttime="3522"><span class="speakerName">Steve Souders</span>: I guess I wasn't clear. Everything </span><span class="line" data-startTime="3525">I talked about is supported in mobile browsers, </span><span class="line" data-startTime="3525">pretty much, and, in fact, you're going to </span><span class="line" data-startTime="3531">get &mdash; I think that's another reason why we're </span><span class="line" data-startTime="3531">seeing more HTML5 stuff on mobile and desktop, </span><span class="line" data-startTime="3537">because on desktop, there's still a lot more </span><span class="line" data-startTime="3537">lingering IE6, IE7 legacy browsers out there, </span><span class="line" data-startTime="3543">so you're almost a little safer using the </span><span class="line" data-startTime="3543">cutting edge stuff on mobile than you are </span><span class="line" data-startTime="3547">on desktop. The only thing I can think about </span><span class="line" data-startTime="3547">is I thought there was something &mdash; well, </span><span class="line" data-startTime="3554">the page visibility API is only in Chrome, </span><span class="line" data-startTime="3554">but all the timing stuff, local storage fonts, </span><span class="line" data-startTime="3561">app cache, async and defer attributes, all </span><span class="line" data-startTime="3561">of that is supported on mobile too. </span></p>

<p class="speaker"><span class="line" data-starttime="3566"><span class="speakerName">Audience member</span>: Thank you. </span></p>

<p class="speaker"><span class="line" data-starttime="3566"><span class="speakerName">Steve Souders</span>: Yeah. Okay, let's go here. </span></p>

<p class="speaker"><span class="line" data-starttime="3572"><span class="speakerName">Audience member</span>: Let's see here. You were talking about </span><span class="line" data-startTime="3572">visibility and document.webkit hidden and </span><span class="line" data-startTime="3580">how that relates with click tracking and stuff </span><span class="line" data-startTime="3580">like that. One click unsubscribes and e-mails </span><span class="line" data-startTime="3585">and things like that, is that another way </span><span class="line" data-startTime="3585">that we can avoid being automatically unsubscribed? </span></p>

<p class="speaker"><span class="line" data-starttime="3591"><span class="speakerName">Steve Souders</span>: Oh, oh, well, but how would </span><span class="line" data-startTime="3591">you &mdash; how would you &mdash; what's the scenario </span><span class="line" data-startTime="3600">where you would render unsubscribed page without </span><span class="line" data-startTime="3600">the user seeing it? </span></p>

<p class="speaker"><span class="line" data-starttime="3604"><span class="speakerName">Audience member</span>: Well, if they're following links and pre-loading </span><span class="line" data-startTime="3604">in the background, you might follow &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="3609"><span class="speakerName">Steve Souders</span>: Oh, yeah, the pre-rendering </span><span class="line" data-startTime="3609">I was talking about is the developer or user </span><span class="line" data-startTime="3614">has explicitly asked to open a page, but we </span><span class="line" data-startTime="3614">can just know we can do it in the background. </span><span class="line" data-startTime="3620">But, so, yeah, if you're crawling a page, </span><span class="line" data-startTime="3620">that could be something that you could do </span><span class="line" data-startTime="3624">is to make sure not to &mdash; you know, you could </span><span class="line" data-startTime="3624">instrument an unsubscribed link so that it </span><span class="line" data-startTime="3630">only worked if the page was visible. Yeah. </span></p>

<p class="speaker"><span class="line" data-starttime="3630"><span class="speakerName">Audience member</span>: Thank you. </span></p>

<p class="speaker"><span class="line" data-starttime="3634"><span class="speakerName">Steve Souders</span>: Yeah. </span></p>

<p class="speaker"><span class="line" data-starttime="3634"><span class="speakerName">Audience member</span>: What's your recommendation in terms of </span><span class="line" data-startTime="3638">moving the script tags physically to the bottom </span><span class="line" data-startTime="3638">of the body tag versus using the defer script </span><span class="line" data-startTime="3644">tag that you described? </span></p>

<p class="speaker"><span class="line" data-starttime="3644"><span class="speakerName">Steve Souders</span>: Yeah, I think both of those </span><span class="line" data-startTime="3648">work. One thing that we &mdash; I only have a few </span><span class="line" data-startTime="3648">seconds, so one thing we don't have time to </span><span class="line" data-startTime="3655">talk about is the importance of the onload </span><span class="line" data-startTime="3655">event firing as quickly as possible, so in </span><span class="line" data-startTime="3661">both cases with defer and async and putting </span><span class="line" data-startTime="3661">scripts at the bottom, you're going to block </span><span class="line" data-startTime="3666">the onload link, the onload event from firing, </span><span class="line" data-startTime="3666">so really putting scripts at the bottom is </span><span class="line" data-startTime="3672">almost the same as doing defer. It really </span><span class="line" data-startTime="3672">has more to do with kind of the size of your </span><span class="line" data-startTime="3678">team. A lot of times there's, you know, 20 </span><span class="line" data-startTime="3678">or 200 people working on a property, and so </span><span class="line" data-startTime="3684">it's hard to get the message out to put scripts </span><span class="line" data-startTime="3684">at the bottom or like someone's code is only </span><span class="line" data-startTime="3690">going to be executed at the top and be really </span><span class="line" data-startTime="3690">hard to give them a foothold in the top and </span><span class="line" data-startTime="3695">give them also a foothold in the bottom and </span><span class="line" data-startTime="3695">make sure that both of those are done in sync, </span><span class="line" data-startTime="3700">so if the only place like the logging or metrics </span><span class="line" data-startTime="3700">team has a place to &mdash; a foothold in the page </span><span class="line" data-startTime="3706">is at the top, they can get the same behavior </span><span class="line" data-startTime="3706">using the defer attribute as just putting </span><span class="line" data-startTime="3711">the script tag at the bottom. Putting the </span><span class="line" data-startTime="3711">script tag at the bottom is another lightweight </span><span class="line" data-startTime="3715">way to avoid that blocking of the UI thread. </span></p>

<p><span class="line" data-startTime="3715">Okay. So I should wrap up. Thank you very </span><span class="line" data-startTime="3721">much. </span> <span class="line" data-startTime="3721">[ Applause ] </span></p>