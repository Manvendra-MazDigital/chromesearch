<style>* {font-family: "Open Sans", sans-serif}
a {color: #77aaff}
a.video {border-bottom: 1px solid #ddd; display: block; margin: 0 0 2em 0; padding: 0 0 2em 0}
h2 {color: #444; font-size: 18px;}
span.speakerName {color: black; font-weight: 900;}
body {padding: 2em}
p {color: #444; margin: 0; text-indent: 1.5em;}
p.speaker {margin: 1em 0 0 0; text-indent: 0;}
div#transcript > p:first-child {text-indent: 0;}
</style>

<h1>Make the Web Fast: Automagic site optimization with mod_pagespeed 1.0!</h1>

<h2>Ilya Grigorik, Joshua Marantz</h2>

<a class="video" href="http://youtu.be/6uCAdQSHhmA">youtu.be/6uCAdQSHhmA</a><div id="transcript"><p class="speaker"><span class="line" data-starttime="5"><span class="speakerName">Ilya Grigorik</span>: Hello everyone, </span><span class="line" data-startTime="5">and welcome to our "Make the </span><span class="line" data-startTime="7">Web Fast" series here on </span><span class="line" data-startTime="7">Google Developers Live. </span><span class="line" data-startTime="10">Today we'll be talking about </span><span class="line" data-startTime="10">a very awesome tool called </span><span class="line" data-startTime="13">mod_pagespeed, which </span><span class="line" data-startTime="13">is a performance </span><span class="line" data-startTime="16">JIT for your website. </span><span class="line" data-startTime="18">So first off, my name </span><span class="line" data-startTime="18">is Ilya Grigorik. </span><span class="line" data-startTime="20">I work with the "Make </span><span class="line" data-startTime="20">the Web Fast" team. </span><span class="line" data-startTime="22">And with me today &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="23"><span class="speakerName">Joshua Marantz</span>: Hi. </span><span class="line" data-startTime="24">I'm Marinates And I work on </span><span class="line" data-startTime="24">the mod_pagespeed team. </span></p>

<p class="speaker"><span class="line" data-starttime="27"><span class="speakerName">Ilya Grigorik</span>: Awesome. </span><span class="line" data-startTime="27">So Josh, I heard through the </span><span class="line" data-startTime="27">rumor mill that there is an </span><span class="line" data-startTime="31">upcoming 1.0 release </span><span class="line" data-startTime="31">for mod_pagespeed. </span></p>

<p class="speaker"><span class="line" data-starttime="35"><span class="speakerName">Joshua Marantz</span>: That's </span><span class="line" data-startTime="35">correct. </span><span class="line" data-startTime="36">The rumors are correct. </span><span class="line" data-startTime="37">We are releasing mod_pagespeed </span><span class="line" data-startTime="37">1.0 next week. </span><span class="line" data-startTime="41">After two years of beta it's </span><span class="line" data-startTime="41">ready for broader adoption. </span></p>

<p class="speaker"><span class="line" data-starttime="45"><span class="speakerName">Ilya Grigorik</span>: Wow. </span> <span class="line" data-startTime="46">So true to Google philosophy of </span><span class="line" data-startTime="46">keeping everything in beta, </span><span class="line" data-startTime="50">that's two years and quite </span><span class="line" data-startTime="50">a few users, I </span><span class="line" data-startTime="52">think, as well, right? </span><span class="line" data-startTime="53">So it'll be really interesting </span><span class="line" data-startTime="53">to dive in and understand </span><span class="line" data-startTime="56">what's happening underneath, </span><span class="line" data-startTime="56">because I spent some time </span><span class="line" data-startTime="59">looking at what you guys </span><span class="line" data-startTime="59">have built, certainly </span><span class="line" data-startTime="61">worked with the team. </span> <span class="line" data-startTime="62">And the first thing that </span><span class="line" data-startTime="62">stands out to me &mdash; </span><span class="line" data-startTime="64">I guess we have some slides </span><span class="line" data-startTime="64">that I've prepared &mdash; </span><span class="line" data-startTime="67">is that if you care about </span><span class="line" data-startTime="67">performance, there's a lot of </span><span class="line" data-startTime="70">stuff that you need </span><span class="line" data-startTime="70">to care about. </span> <span class="line" data-startTime="72">In fact, my officemate, Steve </span><span class="line" data-startTime="72">Souders, wrote a couple books </span><span class="line" data-startTime="75">on the subject. </span> <span class="line" data-startTime="76">And there is stuff like image </span><span class="line" data-startTime="76">compression, combining your </span><span class="line" data-startTime="81">resources, and deferring </span><span class="line" data-startTime="81">JavaScript, cache extensions. </span> <span class="line" data-startTime="84">Frankly, it's a full-time job to </span><span class="line" data-startTime="84">keep up with all the things </span><span class="line" data-startTime="88">that you need to do to keep </span><span class="line" data-startTime="88">your website fast. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="91"><span class="speakerName">Joshua Marantz</span>: Yeah. </span><span class="line" data-startTime="92">We believe that if you're </span><span class="line" data-startTime="92">building a website, you're </span><span class="line" data-startTime="94">trying to convey information. </span><span class="line" data-startTime="95">You're trying to sell a product, </span><span class="line" data-startTime="95">gain acceptance of an </span><span class="line" data-startTime="98">idea, communicate something. </span><span class="line" data-startTime="100">You're not trying to hack your </span><span class="line" data-startTime="100">website to make it faster. </span><span class="line" data-startTime="104">So the less you have to focus </span><span class="line" data-startTime="104">on that, the better. </span><span class="line" data-startTime="106">Now, it is important that you </span><span class="line" data-startTime="106">make websites fast because you </span><span class="line" data-startTime="109">get more engagement, </span><span class="line" data-startTime="109">happier users. </span><span class="line" data-startTime="111">People will come back. </span><span class="line" data-startTime="113">But you don't want to spend </span><span class="line" data-startTime="113">all your time doing that. </span></p>

<p class="speaker"><span class="line" data-starttime="115"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="115">And that's actually a very good </span><span class="line" data-startTime="115">point, very important </span><span class="line" data-startTime="117">point, which is of course </span><span class="line" data-startTime="117">we care about speed. </span><span class="line" data-startTime="120">But speed in itself can be </span><span class="line" data-startTime="120">almost a full-time job, </span><span class="line" data-startTime="123">because even these best </span><span class="line" data-startTime="123">practices change over time. </span><span class="line" data-startTime="126">The browsers get smarter. </span><span class="line" data-startTime="127">We get more video on the web, </span><span class="line" data-startTime="127">more images on the web. </span><span class="line" data-startTime="130">So these things shift, and you </span><span class="line" data-startTime="130">need to keep up with it. </span><span class="line" data-startTime="132">And not only that, but some </span><span class="line" data-startTime="132">techniques, like let's say </span><span class="line" data-startTime="135">spriting images together or </span><span class="line" data-startTime="135">inlining resources on the </span><span class="line" data-startTime="138">page, are actually pretty heavy </span><span class="line" data-startTime="138">in terms of required </span><span class="line" data-startTime="142">work, either for the design </span><span class="line" data-startTime="142">team or for the dev team. </span><span class="line" data-startTime="145">So it adds additional </span><span class="line" data-startTime="145">complexity to </span><span class="line" data-startTime="147">your development cycle. </span><span class="line" data-startTime="149">So it's not all just easy </span><span class="line" data-startTime="149">wins along the way. </span></p>

<p class="speaker"><span class="line" data-starttime="153"><span class="speakerName">Joshua Marantz</span>: And the other </span><span class="line" data-startTime="153">aspect is that sometimes it's </span><span class="line" data-startTime="158">hard to draw a balance between </span><span class="line" data-startTime="158">being able to keep your site </span><span class="line" data-startTime="161">up to date and keeping </span><span class="line" data-startTime="161">it cached. </span> <span class="line" data-startTime="163">For example, everybody knows who </span><span class="line" data-startTime="163">works on web performance </span><span class="line" data-startTime="166">that the more assets </span><span class="line" data-startTime="166">on a website that </span><span class="line" data-startTime="169">are cached, the better. </span> <span class="line" data-startTime="170">So if you go back to a typical </span><span class="line" data-startTime="170">newspaper site every day to </span><span class="line" data-startTime="174">see what the news is, you'll </span><span class="line" data-startTime="174">typically wind up downloading </span><span class="line" data-startTime="177">their JavaScript and their CSS, </span><span class="line" data-startTime="177">which hasn't changed &mdash; </span><span class="line" data-startTime="181">usually has not changed &mdash; </span><span class="line" data-startTime="184">every day, because they </span><span class="line" data-startTime="184">have to set a </span><span class="line" data-startTime="186">fairly short cache lifetime. </span> <span class="line" data-startTime="187">I typically see a minute or an </span><span class="line" data-startTime="187">hour at the most in order so </span><span class="line" data-startTime="191">that they can push changes </span><span class="line" data-startTime="191">out when they want to. </span> <span class="line" data-startTime="193">But they don't do </span><span class="line" data-startTime="193">it every day. </span></p>

<p><span class="line" data-startTime="195">They probably do it once </span><span class="line" data-startTime="195">every few weeks. </span> <span class="line" data-startTime="197">And you want to be able to </span><span class="line" data-startTime="197">change your website on the fly </span><span class="line" data-startTime="204">and have that propagate quickly </span><span class="line" data-startTime="204">to everybody, but also </span><span class="line" data-startTime="209">have it so that when you don't </span><span class="line" data-startTime="209">change it, it stays in </span><span class="line" data-startTime="211">people's caches. </span> <span class="line" data-startTime="212">So this is a complicated and </span><span class="line" data-startTime="212">messy thing to do manually. </span> <span class="line" data-startTime="215">It's a very easy thing </span><span class="line" data-startTime="215">to automatically. </span></p>

<p class="speaker"><span class="line" data-starttime="217"><span class="speakerName">Ilya Grigorik</span>: Right. </span> <span class="line" data-startTime="217">And I think that is the core </span><span class="line" data-startTime="217">insight behind mod_pagespeed, </span><span class="line" data-startTime="221">which is to say, sure, you </span><span class="line" data-startTime="221">can apply all these </span><span class="line" data-startTime="224">optimizations yourself. </span> <span class="line" data-startTime="225">And in fact, you should know </span><span class="line" data-startTime="225">them, because they should be </span><span class="line" data-startTime="227">best practices on your team. </span> <span class="line" data-startTime="228">But we can, in fact, automate </span><span class="line" data-startTime="228">some of this stuff. </span> <span class="line" data-startTime="231">And that's what mod_pagespeed </span><span class="line" data-startTime="231">is all about. </span> <span class="line" data-startTime="233">That's why we say it's a </span><span class="line" data-startTime="233">performance JIT, Just In Time </span><span class="line" data-startTime="236">compiler, in your web server. </span> <span class="line" data-startTime="238">So maybe you can tell us a </span><span class="line" data-startTime="238">little bit as to what that </span><span class="line" data-startTime="241">actually means and how </span><span class="line" data-startTime="241">you guys have gone </span><span class="line" data-startTime="243">about doing this work. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="246"><span class="speakerName">Joshua Marantz</span>: Sure. </span><span class="line" data-startTime="247">There are a number of approaches </span><span class="line" data-startTime="247">to automated </span><span class="line" data-startTime="249">website automation. </span><span class="line" data-startTime="251">And our approach was to make </span><span class="line" data-startTime="251">it really easy to adopt. </span><span class="line" data-startTime="254">So half the websites around </span><span class="line" data-startTime="254">the world are powered by </span><span class="line" data-startTime="258">Apache web servers. </span><span class="line" data-startTime="259">And so what we did was we </span><span class="line" data-startTime="259">packaged our optimization </span><span class="line" data-startTime="265">framework as an open-source </span><span class="line" data-startTime="265">Apache module. </span><span class="line" data-startTime="268">So you pretty much in three </span><span class="line" data-startTime="268">commands can download our </span><span class="line" data-startTime="273">package, install it, and restart </span><span class="line" data-startTime="273">Apache, and your </span><span class="line" data-startTime="277">website runs faster. </span></p>

<p class="speaker"><span class="line" data-starttime="279"><span class="speakerName">Ilya Grigorik</span>: That's a pretty </span><span class="line" data-startTime="279">compelling pitch. </span></p>

<p class="speaker"><span class="line" data-starttime="282"><span class="speakerName">Joshua Marantz</span>: There's </span><span class="line" data-startTime="282">then more you can do. </span><span class="line" data-startTime="285">There's a core set of filters </span><span class="line" data-startTime="285">that we believe is very safe, </span><span class="line" data-startTime="288">will benefit websites a </span><span class="line" data-startTime="288">lot and be very safe </span><span class="line" data-startTime="291">to run on all websites. </span><span class="line" data-startTime="291">And those come on when </span><span class="line" data-startTime="291">you do that process. </span><span class="line" data-startTime="294">But then there's more that you </span><span class="line" data-startTime="294">can do if you're willing to </span><span class="line" data-startTime="298">investigate and tune </span><span class="line" data-startTime="298">it a little bit. </span><span class="line" data-startTime="301">But the whole idea was out </span><span class="line" data-startTime="301">of the box, really good </span><span class="line" data-startTime="304">performance. </span></p>

<p class="speaker"><span class="line" data-starttime="305"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="305">And safe, right? </span><span class="line" data-startTime="306">So your website shouldn't </span><span class="line" data-startTime="306">be broken. </span><span class="line" data-startTime="308">And I think we'll actually take </span><span class="line" data-startTime="308">a look at kind of deep in </span><span class="line" data-startTime="310">the guts of some of the filters </span><span class="line" data-startTime="310">and how they work. </span><span class="line" data-startTime="312">But before we even get there, </span><span class="line" data-startTime="312">one of the things that I </span><span class="line" data-startTime="315">wanted to highlight was that </span><span class="line" data-startTime="315">I believe mod_pagespeed is </span><span class="line" data-startTime="319">actually based on another </span><span class="line" data-startTime="319">open-source project. </span></p>

<p class="speaker"><span class="line" data-starttime="322"><span class="speakerName">Joshua Marantz</span>: That's right. </span><span class="line" data-startTime="323">So the way that it is structured </span><span class="line" data-startTime="323">is that we thought </span><span class="line" data-startTime="328">Apache was a very good delivery </span><span class="line" data-startTime="328">vehicle for our </span><span class="line" data-startTime="329">technology. </span><span class="line" data-startTime="331">But we know it's not the only </span><span class="line" data-startTime="331">delivery vehicle for our </span><span class="line" data-startTime="333">technology that can </span><span class="line" data-startTime="333">ever exist. </span><span class="line" data-startTime="335">So we layered this as an </span><span class="line" data-startTime="335">optimization framework called </span><span class="line" data-startTime="339">the PageSpeed Optimization </span><span class="line" data-startTime="339">Libraries, which is not tied </span><span class="line" data-startTime="343">to any particular server. </span><span class="line" data-startTime="344">It's a plug-in architecture. </span><span class="line" data-startTime="345">And we'll get into that more </span><span class="line" data-startTime="345">a little bit later. </span><span class="line" data-startTime="347">And then we packaged that with </span><span class="line" data-startTime="347">a connection to Apache, an </span><span class="line" data-startTime="352">Apache gasket, if you will, so </span><span class="line" data-startTime="352">that it's just plug-and-play </span><span class="line" data-startTime="355">and you don't have to modify </span><span class="line" data-startTime="355">the structure. </span></p>

<p class="speaker"><span class="line" data-starttime="356"><span class="speakerName">Ilya Grigorik</span>: So mod_pagespeed </span><span class="line" data-startTime="356">is basically a </span><span class="line" data-startTime="357">wrapper around PageSpeed </span><span class="line" data-startTime="357">Optimization </span><span class="line" data-startTime="360">Libraries for Apache. </span><span class="line" data-startTime="362">But if I want to adopt it </span><span class="line" data-startTime="362">to some other server &mdash; </span><span class="line" data-startTime="365">maybe I've written one myself, </span><span class="line" data-startTime="365">or I'm using some other </span><span class="line" data-startTime="367">popular server &mdash; </span><span class="line" data-startTime="368">I could actually still </span><span class="line" data-startTime="368">reuse that same code. </span></p>

<p class="speaker"><span class="line" data-starttime="370"><span class="speakerName">Joshua Marantz</span>: Yes. </span><span class="line" data-startTime="371">And in fact, this is what we </span><span class="line" data-startTime="371">have done with PageSpeed </span><span class="line" data-startTime="375">service, so that we've now </span><span class="line" data-startTime="375">deployed this on two very </span><span class="line" data-startTime="379">different server stacks, one </span><span class="line" data-startTime="379">based on Apache, one an </span><span class="line" data-startTime="383">internal Google one. </span><span class="line" data-startTime="384">But we can bring the same </span><span class="line" data-startTime="384">technology in two very </span><span class="line" data-startTime="388">different deployments. </span><span class="line" data-startTime="389">And we are looking to expand </span><span class="line" data-startTime="389">to any server that rises in </span><span class="line" data-startTime="393">popularity as well. </span></p>

<p class="speaker"><span class="line" data-starttime="393"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="393">And PageSpeed Service is our </span><span class="line" data-startTime="393">hosted version of this, which </span><span class="line" data-startTime="396">is actually still in beta, </span><span class="line" data-startTime="396">and we're still kind of </span><span class="line" data-startTime="399">field-testing it with </span><span class="line" data-startTime="399">other customers. </span><span class="line" data-startTime="401">But it's actually running </span><span class="line" data-startTime="401">on the same code </span><span class="line" data-startTime="403">base, if you will. </span></p>

<p class="speaker"><span class="line" data-starttime="404"><span class="speakerName">Joshua Marantz</span>: Yes. </span></p>

<p class="speaker"><span class="line" data-starttime="405"><span class="speakerName">Ilya Grigorik</span>: Very cool. </span><span class="line" data-startTime="407">So I think we covered </span><span class="line" data-startTime="407">some of this. </span><span class="line" data-startTime="409">We have a 1.0 coming. </span><span class="line" data-startTime="411">We know that it's an </span><span class="line" data-startTime="411">Apache module. </span><span class="line" data-startTime="413">You guys have been working </span><span class="line" data-startTime="413">on it for over two years. </span><span class="line" data-startTime="415">And you actually mentioned some </span><span class="line" data-startTime="415">of the core filters and </span><span class="line" data-startTime="417">optional filters. </span><span class="line" data-startTime="418">And it sounds like there's </span><span class="line" data-startTime="418">quite a few. </span></p>

<p class="speaker"><span class="line" data-starttime="420"><span class="speakerName">Joshua Marantz</span>: Yeah. </span> <span class="line" data-startTime="422">There's a wide variety. </span> <span class="line" data-startTime="424">There's a lot of ideas. </span> <span class="line" data-startTime="425">Web performance is a topic </span><span class="line" data-startTime="425">that invites papers. </span> <span class="line" data-startTime="429">It invites conferences. </span> <span class="line" data-startTime="430">Many companies are founded </span><span class="line" data-startTime="430">around this. </span> <span class="line" data-startTime="432">And there's lots of ideas that </span><span class="line" data-startTime="432">are pouring into this. </span> <span class="line" data-startTime="435">But we try to take the ones that </span><span class="line" data-startTime="435">are most effective, that </span><span class="line" data-startTime="440">are incredibly robust and </span><span class="line" data-startTime="440">predictable, and put them into </span><span class="line" data-startTime="443">the core set so that the </span><span class="line" data-startTime="443">out-of-the-box experience is </span><span class="line" data-startTime="445">really good. </span> <span class="line" data-startTime="446">And then there are a lot of </span><span class="line" data-startTime="446">other things that we are </span><span class="line" data-startTime="450">working on, that we're </span><span class="line" data-startTime="450">validating, that we're making </span><span class="line" data-startTime="452">sure are really solid </span><span class="line" data-startTime="452">and will make it in. </span></p>

<p><span class="line" data-startTime="453">And there's others that we think </span><span class="line" data-startTime="453">will probably always be </span><span class="line" data-startTime="457">kind of a manual configuration </span><span class="line" data-startTime="457">kind of option. </span> <span class="line" data-startTime="461">A good one of these is where </span><span class="line" data-startTime="461">we defer JavaScript. </span> <span class="line" data-startTime="465">That's a complicated thing to </span><span class="line" data-startTime="465">do and has generally amazing </span><span class="line" data-startTime="468">effects on websites. </span> <span class="line" data-startTime="469">But it is something that you </span><span class="line" data-startTime="469">want to hand-validate, and you </span><span class="line" data-startTime="471">don't want to just </span><span class="line" data-startTime="471">turn that on. </span></p>

<p class="speaker"><span class="line" data-starttime="472"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="472">So I think this highlights kind </span><span class="line" data-startTime="472">of a general point, which </span><span class="line" data-startTime="474">is to say there is a core set of </span><span class="line" data-startTime="474">filters that you should be </span><span class="line" data-startTime="478">able to turn on or that will be </span><span class="line" data-startTime="478">turned on once you install </span><span class="line" data-startTime="481">mod_pagespeed, and your site </span><span class="line" data-startTime="481">should just go faster. </span><span class="line" data-startTime="483">But depending on your site, </span><span class="line" data-startTime="483">you probably want to spend </span><span class="line" data-startTime="486">some time going through the </span><span class="line" data-startTime="486">available filters and just </span><span class="line" data-startTime="489">seeing which ones may </span><span class="line" data-startTime="489">apply to your site. </span><span class="line" data-startTime="491">And you'll be able to get more </span><span class="line" data-startTime="491">performance benefits out of </span><span class="line" data-startTime="495">mod_pagespeed. </span></p>

<p class="speaker"><span class="line" data-starttime="495"><span class="speakerName">Joshua Marantz</span>: Right. </span></p>

<p class="speaker"><span class="line" data-starttime="496"><span class="speakerName">Ilya Grigorik</span>: Very cool. </span><span class="line" data-startTime="497">So I think we're going </span><span class="line" data-startTime="497">to dive into the </span><span class="line" data-startTime="498">details of some of these. </span><span class="line" data-startTime="499">But I do want to touch on one </span><span class="line" data-startTime="499">point, which is we do support </span><span class="line" data-startTime="504">2.2 and 2.4 of Apache? </span></p>

<p class="speaker"><span class="line" data-starttime="507"><span class="speakerName">Joshua Marantz</span>: That's </span><span class="line" data-startTime="507">correct. </span><span class="line" data-startTime="508">Apache 2.4 support came </span><span class="line" data-startTime="508">out recently. </span><span class="line" data-startTime="510">And that's in our 1.0 </span><span class="line" data-startTime="510">release as well. </span></p>

<p class="speaker"><span class="line" data-starttime="512"><span class="speakerName">Ilya Grigorik</span>: Awesome. </span><span class="line" data-startTime="513">And you mentioned that it's </span><span class="line" data-startTime="513">just a couple of lines. </span><span class="line" data-startTime="515">So we have, I guess, packages </span><span class="line" data-startTime="515">for Debian and RPMs that you </span><span class="line" data-startTime="519">can just install. </span></p>

<p class="speaker"><span class="line" data-starttime="520"><span class="speakerName">Joshua Marantz</span>: We do, although </span><span class="line" data-startTime="520">external developers </span><span class="line" data-startTime="525">have generated packages for </span><span class="line" data-startTime="525">openSUSE and even for Windows. </span><span class="line" data-startTime="533">It's an open-source product. </span><span class="line" data-startTime="534">We have a build process and </span><span class="line" data-startTime="534">instructions for doing that. </span><span class="line" data-startTime="536">And so people can put </span><span class="line" data-startTime="536">up other packages. </span><span class="line" data-startTime="538">FreeBSD is another </span><span class="line" data-startTime="538">one has support. </span></p>

<p class="speaker"><span class="line" data-starttime="542"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="542">So I can just build it </span><span class="line" data-startTime="542">from source, right? </span></p>

<p class="speaker"><span class="line" data-starttime="544"><span class="speakerName">Joshua Marantz</span>: Yes. </span></p>

<p class="speaker"><span class="line" data-starttime="544"><span class="speakerName">Ilya Grigorik</span>: OK. </span><span class="line" data-startTime="544">Cool. </span><span class="line" data-startTime="544">And then one more </span><span class="line" data-startTime="544">thing for 1.0. </span><span class="line" data-startTime="546">I know that until recently, or </span><span class="line" data-startTime="546">until we ship 1.0, there was </span><span class="line" data-startTime="550">one release tree, if you </span><span class="line" data-startTime="550">will, or one package. </span><span class="line" data-startTime="554">And I think moving forward, </span><span class="line" data-startTime="554">once we release 1.0, we'll </span><span class="line" data-startTime="557">actually have two. </span></p>

<p class="speaker"><span class="line" data-starttime="558"><span class="speakerName">Joshua Marantz</span>: That's right. </span><span class="line" data-startTime="559">The current release package, if </span><span class="line" data-startTime="559">you're using mod_pagespeed </span><span class="line" data-startTime="562">today, you're on the </span><span class="line" data-startTime="562">beta channel if you </span><span class="line" data-startTime="564">installed from binaries. </span><span class="line" data-startTime="565">And we're going to continue </span><span class="line" data-startTime="565">to have that beta channel. </span><span class="line" data-startTime="568">But the 1.0 release introduces </span><span class="line" data-startTime="568">a new stable channel. </span><span class="line" data-startTime="571">And the way that this will work </span><span class="line" data-startTime="571">is that we will release </span><span class="line" data-startTime="575">new features into beta. </span><span class="line" data-startTime="576">And after we're really </span><span class="line" data-startTime="576">comfortable and solid with </span><span class="line" data-startTime="579">them, then we'll update </span><span class="line" data-startTime="579">the stable channel. </span><span class="line" data-startTime="581">And then when you update your </span><span class="line" data-startTime="581">packages and your operating </span><span class="line" data-startTime="585">system with yum update or </span><span class="line" data-startTime="585">updating the Debian package </span><span class="line" data-startTime="591">system, you'll upgrade </span><span class="line" data-startTime="591">based on the </span><span class="line" data-startTime="594">channel that you've selected. </span></p>

<p class="speaker"><span class="line" data-starttime="596"><span class="speakerName">Ilya Grigorik</span>: Cool. </span> <span class="line" data-startTime="596">That makes sense. </span> <span class="line" data-startTime="597">All right. </span> <span class="line" data-startTime="597">So let's dive into </span><span class="line" data-startTime="597">the guts of it. </span> <span class="line" data-startTime="600">But I think we touched </span><span class="line" data-startTime="600">on this already. </span> <span class="line" data-startTime="602">I'll just mention it briefly. </span> <span class="line" data-startTime="603">The whole point, I guess, with </span><span class="line" data-startTime="603">mod_pagespeed is to highlight </span><span class="line" data-startTime="606">the things that you </span><span class="line" data-startTime="606">don't need to do. </span> <span class="line" data-startTime="608">So instead of having to worry </span><span class="line" data-startTime="608">about it do I need to have an </span><span class="line" data-startTime="612">extra build process for </span><span class="line" data-startTime="612">optimizing images or </span><span class="line" data-startTime="616">concatenating my CSS or </span><span class="line" data-startTime="616">JavaScript or all the rest, </span><span class="line" data-startTime="618">all that is taken care </span><span class="line" data-startTime="618">of by mod_pagespeed. </span> <span class="line" data-startTime="621">And in fact, that means that </span><span class="line" data-startTime="621">I don't need to modify my </span><span class="line" data-startTime="623">current workflow or my team's </span><span class="line" data-startTime="623">workflow to take advantage of </span><span class="line" data-startTime="626">all these optimizations. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="628"><span class="speakerName">Joshua Marantz</span>: That's </span><span class="line" data-startTime="628">exactly the point. </span><span class="line" data-startTime="629">It's a drop-in solution for </span><span class="line" data-startTime="629">performing best practices for </span><span class="line" data-startTime="633">web clients. </span></p>

<p class="speaker"><span class="line" data-starttime="634"><span class="speakerName">Ilya Grigorik</span>: So the clients, </span><span class="line" data-startTime="634">or the visitors I should say, </span><span class="line" data-startTime="635">would see the optimized </span><span class="line" data-startTime="635">resources. </span><span class="line" data-startTime="637">I still have my original </span><span class="line" data-startTime="637">resources in my dev </span><span class="line" data-startTime="639">environment. </span><span class="line" data-startTime="640">And mod_pagespeed </span><span class="line" data-startTime="640">does the rest. </span></p>

<p class="speaker"><span class="line" data-starttime="641"><span class="speakerName">Joshua Marantz</span>: Exactly. </span></p>

<p class="speaker"><span class="line" data-starttime="642"><span class="speakerName">Ilya Grigorik</span>: Very cool. </span><span class="line" data-startTime="644">So you mentioned this earlier. </span><span class="line" data-startTime="646">We have over 100,000 </span><span class="line" data-startTime="646">mod_pagespeed installs today, </span><span class="line" data-startTime="649">since you guys announced </span><span class="line" data-startTime="649">the product. </span><span class="line" data-startTime="652">And in fact, there is a number </span><span class="line" data-startTime="652">of partners who have already </span><span class="line" data-startTime="656">installed it as part of their </span><span class="line" data-startTime="656">hosting infrastructure. </span><span class="line" data-startTime="661">So for example, I know that in </span><span class="line" data-startTime="661">DreamHost or Go Daddy, you can </span><span class="line" data-startTime="664">actually go into your control </span><span class="line" data-startTime="664">panel, click &mdash; </span><span class="line" data-startTime="667">I think it's in these </span><span class="line" data-startTime="667">settings. </span><span class="line" data-startTime="669">I'm not sure exactly where </span><span class="line" data-startTime="669">in the menu it is. </span><span class="line" data-startTime="672">But I know there </span><span class="line" data-startTime="672">is a check-box. </span><span class="line" data-startTime="673">You say, please accelerate </span><span class="line" data-startTime="673">my site. </span><span class="line" data-startTime="675">And all of a sudden, the </span><span class="line" data-startTime="675">site goes faster. </span><span class="line" data-startTime="676">And what happens under the </span><span class="line" data-startTime="676">hood is they enable </span><span class="line" data-startTime="678">mod_pagespeed for your site. </span></p>

<p class="speaker"><span class="line" data-starttime="680"><span class="speakerName">Joshua Marantz</span>: That's </span><span class="line" data-startTime="680">exactly right. </span><span class="line" data-startTime="682">Having that check-box to just </span><span class="line" data-startTime="682">turn it on is even easier than </span><span class="line" data-startTime="685">the three-step install process </span><span class="line" data-startTime="685">that I mentioned earlier. </span></p>

<p class="speaker"><span class="line" data-starttime="689"><span class="speakerName">Ilya Grigorik</span>: So it's </span><span class="line" data-startTime="689">like the Turbo button </span><span class="line" data-startTime="690">back in the old days. </span><span class="line" data-startTime="691">It's like make my site fast. </span><span class="line" data-startTime="693">Why wouldn't you turn that on? </span><span class="line" data-startTime="696">Very cool. </span><span class="line" data-startTime="697">So let's dive into, I guess, </span><span class="line" data-startTime="697">some of the guts. </span><span class="line" data-startTime="702">Here's an example. </span></p>

<p class="speaker"><span class="line" data-starttime="703"><span class="speakerName">Joshua Marantz</span>: Yeah. </span><span class="line" data-startTime="704">So the best way to see </span><span class="line" data-startTime="704">it in action, this </span><span class="line" data-startTime="707">is a shopping website. </span><span class="line" data-startTime="708">And we made a video comparing </span><span class="line" data-startTime="708">a first view of that site on </span><span class="line" data-startTime="717">Chrome with mod_pagespeed off </span><span class="line" data-startTime="717">and with mod_pagespeed on. </span><span class="line" data-startTime="721">And this is &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="722"><span class="speakerName">Ilya Grigorik</span>: So this </span><span class="line" data-startTime="722">is a side-by-side </span><span class="line" data-startTime="724">recording of on and off. </span><span class="line" data-startTime="727">Wow. </span></p>

<p class="speaker"><span class="line" data-starttime="728"><span class="speakerName">Joshua Marantz</span>: Correct. </span><span class="line" data-startTime="728">So this video was made with </span><span class="line" data-startTime="728">WebPagetest, which offers all </span><span class="line" data-startTime="731">kinds of opportunities &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="732"><span class="speakerName">Ilya Grigorik</span>: I'm going to play </span><span class="line" data-startTime="732">that again just so you </span><span class="line" data-startTime="733">guys can see it. </span><span class="line" data-startTime="735">So the page loads </span><span class="line" data-startTime="735">in 2.1 seconds. </span><span class="line" data-startTime="738">And then the other one takes </span><span class="line" data-startTime="738">about five seconds, if I </span><span class="line" data-startTime="740">scroll back here. </span><span class="line" data-startTime="743">And you can see that </span><span class="line" data-startTime="743">the mod_pagespeed </span><span class="line" data-startTime="745">one loads a lot faster. </span><span class="line" data-startTime="746">Now, there could be many reasons </span><span class="line" data-startTime="746">for this, right? </span><span class="line" data-startTime="748">I'm guessing it's a combination </span><span class="line" data-startTime="748">of filters that </span><span class="line" data-startTime="750">come into effect to make </span><span class="line" data-startTime="750">this difference. </span><span class="line" data-startTime="752">But it's 200% faster, </span><span class="line" data-startTime="752">or more, here. </span></p>

<p class="speaker"><span class="line" data-starttime="754"><span class="speakerName">Joshua Marantz</span>: Yeah. </span><span class="line" data-startTime="755">It's also important to note that </span><span class="line" data-startTime="755">even though the rendering </span><span class="line" data-startTime="759">takes 2.1 seconds, it's actually </span><span class="line" data-startTime="759">pretty visible after </span><span class="line" data-startTime="764">probably less than a second. </span></p>

<p class="speaker"><span class="line" data-starttime="767"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="767">So if I just scrub back here. </span><span class="line" data-startTime="770">So we have 1.8 seconds in, we </span><span class="line" data-startTime="770">already have the page, whereas </span><span class="line" data-startTime="774">the other one is blank. </span><span class="line" data-startTime="776">So that's a dramatic </span><span class="line" data-startTime="776">difference. </span></p>

<p class="speaker"><span class="line" data-starttime="778"><span class="speakerName">Joshua Marantz</span>: So we can see </span><span class="line" data-startTime="778">a little bit of why that </span><span class="line" data-startTime="779">happened by going to </span><span class="line" data-startTime="779">the next slide. </span><span class="line" data-startTime="785">So those that have dabbled in </span><span class="line" data-startTime="785">web performance have seen </span><span class="line" data-startTime="789">these waterfall diagrams </span><span class="line" data-startTime="789">that are available. </span></p>

<p class="speaker"><span class="line" data-starttime="791"><span class="speakerName">Ilya Grigorik</span>: That's the </span><span class="line" data-startTime="791">bread and butter. </span></p>

<p class="speaker"><span class="line" data-starttime="793"><span class="speakerName">Joshua Marantz</span>: They're </span><span class="line" data-startTime="793">available in Firebug and the </span><span class="line" data-startTime="795">Chrome Developer Tools. </span><span class="line" data-startTime="796">And these are from </span><span class="line" data-startTime="796">WebPagetest. </span><span class="line" data-startTime="800">Again, this is from Chrome. </span></p>

<p class="speaker"><span class="line" data-starttime="801"><span class="speakerName">Ilya Grigorik</span>: So this is </span><span class="line" data-startTime="801">the same website, right? </span><span class="line" data-startTime="803">We're just looking at the </span><span class="line" data-startTime="803">waterfall charts. </span></p>

<p class="speaker"><span class="line" data-starttime="804"><span class="speakerName">Joshua Marantz</span>: Exactly. </span> <span class="line" data-startTime="805">The same exact website. </span> <span class="line" data-startTime="806">On the left, the waterfall chart </span><span class="line" data-startTime="806">is tall, which means </span><span class="line" data-startTime="811">there's a lot of resources. </span> <span class="line" data-startTime="812">And it's wide. </span> <span class="line" data-startTime="813">There's a lot of </span><span class="line" data-startTime="813">wide blue bars. </span> <span class="line" data-startTime="816">Those wide blue bars are big </span><span class="line" data-startTime="816">images which don't need to be </span><span class="line" data-startTime="820">nearly that big. </span> <span class="line" data-startTime="822">And so on the right, they </span><span class="line" data-startTime="822">become a lot skinnier. </span> <span class="line" data-startTime="827">There's also a lot less bars. </span> <span class="line" data-startTime="829">So the two things that are most </span><span class="line" data-startTime="829">visible in the waterfall </span><span class="line" data-startTime="834">diagram, in terms of the effects </span><span class="line" data-startTime="834">of mod_pagespeed </span><span class="line" data-startTime="836">filters, are one, optimizing </span><span class="line" data-startTime="836">images. </span></p>

<p><span class="line" data-startTime="839">So there's actually three </span><span class="line" data-startTime="839">ways in which </span><span class="line" data-startTime="842">the images are optimized. </span> <span class="line" data-startTime="844">Number one, mod_pagespeed looks </span><span class="line" data-startTime="844">at the context in which </span><span class="line" data-startTime="847">images are displayed. </span> <span class="line" data-startTime="848">Very often, images are taken </span><span class="line" data-startTime="848">from cameras at full </span><span class="line" data-startTime="850">resolution and instantiated </span><span class="line" data-startTime="850">into very small divs or </span><span class="line" data-startTime="856">elements in HTML, 100 </span><span class="line" data-startTime="856">by 200 or something. </span> <span class="line" data-startTime="859">And there's way more pixels </span><span class="line" data-startTime="859">being sent down to the browser </span><span class="line" data-startTime="862">than the browser needs. </span> <span class="line" data-startTime="863">And this wastes bandwidth and </span><span class="line" data-startTime="863">it wastes CPU time on the </span><span class="line" data-startTime="865">browser resizing. </span> <span class="line" data-startTime="866">So it's much better to </span><span class="line" data-startTime="866">resize on the server. </span> <span class="line" data-startTime="868">But who wants to do that? </span><span class="line" data-startTime="870">Well, turn on mod_pagespeed and </span><span class="line" data-startTime="870">it happens automatically. </span> <span class="line" data-startTime="873">The other thing is that the </span><span class="line" data-startTime="873">images are typically at a much </span><span class="line" data-startTime="876">higher quality ratio than you </span><span class="line" data-startTime="876">need for an LCD display or a </span><span class="line" data-startTime="881">retina display. </span></p>

<p><span class="line" data-startTime="882">And it is pretty straightforward </span><span class="line" data-startTime="882">to remove a </span><span class="line" data-startTime="887">lot of the bytes of </span><span class="line" data-startTime="887">that image without </span><span class="line" data-startTime="888">reducing any visible quality. </span> <span class="line" data-startTime="890">And the third point is that </span><span class="line" data-startTime="890">modern web browsers, including </span><span class="line" data-startTime="894">Chrome and Opera, support a more </span><span class="line" data-startTime="894">modern format of image </span><span class="line" data-startTime="899">called WebP, which Google </span><span class="line" data-startTime="899">released over a year ago, </span><span class="line" data-startTime="904">which for the same quality can </span><span class="line" data-startTime="904">get you about 30% less bytes. </span> <span class="line" data-startTime="908">And so this is not something </span><span class="line" data-startTime="908">you would do manually. </span> <span class="line" data-startTime="911">But an automated tool can tune </span><span class="line" data-startTime="911">the experience, tune the HTML </span><span class="line" data-startTime="917">that's delivered and the images </span><span class="line" data-startTime="917">that are delivered to </span><span class="line" data-startTime="920">the browser in question. </span> <span class="line" data-startTime="921">So mod_pagespeed can take a JPEG </span><span class="line" data-startTime="921">resource and transcode it </span><span class="line" data-startTime="925">and deliver it as WebP to Chrome </span><span class="line" data-startTime="925">and Opera, and to other </span><span class="line" data-startTime="929">browsers deliver it as JPEG, so </span><span class="line" data-startTime="929">that it works either way. </span></p>

<p><span class="line" data-startTime="933">So between all of those, we </span><span class="line" data-startTime="933">shrunk this site way down. </span> <span class="line" data-startTime="936">And actually, the waterfall </span><span class="line" data-startTime="936">diagram, that blue line </span><span class="line" data-startTime="941">represents the onload event. </span> <span class="line" data-startTime="943">What happens after the onload </span><span class="line" data-startTime="943">event in this particular site </span><span class="line" data-startTime="946">is third-party widgets that are </span><span class="line" data-startTime="946">loading asynchronously, </span><span class="line" data-startTime="950">which is great. </span> <span class="line" data-startTime="951">So the site was built with </span><span class="line" data-startTime="951">that really well. </span> <span class="line" data-startTime="953">And so there's analytics </span><span class="line" data-startTime="953">running. </span> <span class="line" data-startTime="956">There's buttons from different </span><span class="line" data-startTime="956">third-party vendors that are </span><span class="line" data-startTime="960">loading at that point. </span> <span class="line" data-startTime="962">But it doesn't block onloads, </span><span class="line" data-startTime="962">so the user is fully </span><span class="line" data-startTime="964">interactive at the time of that </span><span class="line" data-startTime="964">blue line, which happens </span><span class="line" data-startTime="966">way earlier than on </span><span class="line" data-startTime="966">the other site. </span></p>

<p class="speaker"><span class="line" data-starttime="967"><span class="speakerName">Ilya Grigorik</span>: So it's really </span><span class="line" data-startTime="967">interesting that just by kind </span><span class="line" data-startTime="969">of blurring your eyes, we can </span><span class="line" data-startTime="969">look at this waterfall and </span><span class="line" data-startTime="972">just figure out what's happening </span><span class="line" data-startTime="972">just on the shape, </span><span class="line" data-startTime="975">without even looking </span><span class="line" data-startTime="975">at the resources. </span><span class="line" data-startTime="977">So you can say like, we </span><span class="line" data-startTime="977">optimized the images. </span><span class="line" data-startTime="979">We probably concatenated some </span><span class="line" data-startTime="979">files, which is why it became </span><span class="line" data-startTime="982">shorter, and a few </span><span class="line" data-startTime="982">other things. </span></p>

<p class="speaker"><span class="line" data-starttime="984"><span class="speakerName">Joshua Marantz</span>: Yeah. </span> <span class="line" data-startTime="984">I mean, mod_pagespeed is not </span><span class="line" data-startTime="984">necessarily all that you would </span><span class="line" data-startTime="989">ever want to do to make </span><span class="line" data-startTime="989">your site fast. </span> <span class="line" data-startTime="992">It's now running in </span><span class="line" data-startTime="992">two-point-something seconds. </span> <span class="line" data-startTime="993">So you could probably get it </span><span class="line" data-startTime="993">down to one second, because </span><span class="line" data-startTime="995">there's a lot of kind of </span><span class="line" data-startTime="995">cascading effect here. </span> <span class="line" data-startTime="997">And there's not much </span><span class="line" data-startTime="997">parallelism, </span><span class="line" data-startTime="999">especially after onload. </span> <span class="line" data-startTime="1002">And so diving deeper into the </span><span class="line" data-startTime="1002">waterfalls is something that </span><span class="line" data-startTime="1004">you might want to do if you </span><span class="line" data-startTime="1004">want that next level. </span> <span class="line" data-startTime="1006">But kind of without any effort </span><span class="line" data-startTime="1006">at all you can get &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="1009"><span class="speakerName">Ilya Grigorik</span>: Yeah. </span><span class="line" data-startTime="1010">I'll take it. </span><span class="line" data-startTime="1010">Right. </span><span class="line" data-startTime="1011">2X just for turning on a flag. </span><span class="line" data-startTime="1013">I'll take it. </span><span class="line" data-startTime="1016">All right. </span><span class="line" data-startTime="1016">So now we will go under the </span><span class="line" data-startTime="1016">hood of this thing. </span><span class="line" data-startTime="1023">OK. </span><span class="line" data-startTime="1023">So we'll start with </span><span class="line" data-startTime="1023">a simple one. </span><span class="line" data-startTime="1024">So HTML Collapse. </span><span class="line" data-startTime="1025">This is an example filter, a </span><span class="line" data-startTime="1025">very simple one but it will be </span><span class="line" data-startTime="1029">a good introduction to </span><span class="line" data-startTime="1029">some of the more </span><span class="line" data-startTime="1031">interesting ones later. </span></p>

<p class="speaker"><span class="line" data-starttime="1032"><span class="speakerName">Joshua Marantz</span>: Yeah. </span><span class="line" data-startTime="1033">So this is kind of the simplest </span><span class="line" data-startTime="1033">possible filter that </span><span class="line" data-startTime="1037">you can have. </span><span class="line" data-startTime="1037">And this is actually a filter </span><span class="line" data-startTime="1037">that we have in </span><span class="line" data-startTime="1039">mod_pagespeed today. </span><span class="line" data-startTime="1040">It's a little bit more involved </span><span class="line" data-startTime="1040">than this in reality. </span><span class="line" data-startTime="1043">But this is essentially it. </span><span class="line" data-startTime="1046">You can, as every filter can, </span><span class="line" data-startTime="1046">register for interest in </span><span class="line" data-startTime="1052">various HTML events, </span><span class="line" data-startTime="1052">as it were. </span><span class="line" data-startTime="1055">And as the events stream through </span><span class="line" data-startTime="1055">the system, we can </span><span class="line" data-startTime="1058">say, hey, this one's </span><span class="line" data-startTime="1058">interested in </span><span class="line" data-startTime="1059">a Characters node. </span><span class="line" data-startTime="1060">That's all Collapse Whitespace </span><span class="line" data-startTime="1060">cares about. </span><span class="line" data-startTime="1062">And then it basically just wipes </span><span class="line" data-startTime="1062">out extra spaces that </span><span class="line" data-startTime="1067">it's pretty sure can't matter. </span><span class="line" data-startTime="1070">And cases where it would matter </span><span class="line" data-startTime="1070">is if it's in a pre </span><span class="line" data-startTime="1072">tag, and there's other </span><span class="line" data-startTime="1072">cases as well. </span></p>

<p class="speaker"><span class="line" data-starttime="1074"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="1075">So it's not as simple </span><span class="line" data-startTime="1075">as it looks. </span><span class="line" data-startTime="1077">This is not like run a gsub </span><span class="line" data-startTime="1077">and remove all the spaces. </span><span class="line" data-startTime="1081">You're actually parsing </span><span class="line" data-startTime="1081">the HTML. </span><span class="line" data-startTime="1082">And you're saying, hey, this </span><span class="line" data-startTime="1082">is inside of a pre tag or a </span><span class="line" data-startTime="1085">script tag, so the white </span><span class="line" data-startTime="1085">space is significant. </span><span class="line" data-startTime="1088">But nonetheless, inside of your </span><span class="line" data-startTime="1088">regular HTML markup, you </span><span class="line" data-startTime="1091">can still compress the </span><span class="line" data-startTime="1091">extra white space. </span></p>

<p class="speaker"><span class="line" data-starttime="1094"><span class="speakerName">Joshua Marantz</span>: Exactly. </span><span class="line" data-startTime="1095">And this is a relatively </span><span class="line" data-startTime="1095">popular filter. </span><span class="line" data-startTime="1098">It's actually not </span><span class="line" data-startTime="1098">a core filter. </span></p>

<p class="speaker"><span class="line" data-starttime="1100"><span class="speakerName">Ilya Grigorik</span>: Interesting. </span></p>

<p class="speaker"><span class="line" data-starttime="1101"><span class="speakerName">Joshua Marantz</span>: And that's </span><span class="line" data-startTime="1101">because we are a little bit </span><span class="line" data-startTime="1103">conservative. </span><span class="line" data-startTime="1104">And it is quite possible for an </span><span class="line" data-startTime="1104">element to have its white </span><span class="line" data-startTime="1110">space become significant due to </span><span class="line" data-startTime="1110">a JavaScript event, which </span><span class="line" data-startTime="1114">is not something that </span><span class="line" data-startTime="1114">mod_pagespeed </span><span class="line" data-startTime="1116">currently looks at. </span><span class="line" data-startTime="1117">So this is a filter that's </span><span class="line" data-startTime="1117">pretty safe to do. </span><span class="line" data-startTime="1119">But we leave it up to users </span><span class="line" data-startTime="1119">to turn it on by default. </span><span class="line" data-startTime="1122">I've noticed a lot of users do </span><span class="line" data-startTime="1122">turn this on, because it's </span><span class="line" data-startTime="1124">mostly pretty safe. </span></p>

<p class="speaker"><span class="line" data-starttime="1125"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="1125">OK. </span><span class="line" data-startTime="1125">That makes sense. </span><span class="line" data-startTime="1130">So this is a more interesting </span><span class="line" data-startTime="1130">one, right? </span><span class="line" data-startTime="1132">So now we're talking combining </span><span class="line" data-startTime="1132">multiple CSS files. </span><span class="line" data-startTime="1135">So how does this work? </span></p>

<p class="speaker"><span class="line" data-starttime="1137"><span class="speakerName">Joshua Marantz</span>: Right. </span><span class="line" data-startTime="1137">So the basic idea here is that </span><span class="line" data-startTime="1137">as HTML is streaming through </span><span class="line" data-startTime="1145">mod_pagespeed, we're </span><span class="line" data-startTime="1145">parsing tags. </span><span class="line" data-startTime="1147">We're saying, hey, here's </span><span class="line" data-startTime="1147">four link tags. </span><span class="line" data-startTime="1152">Let's collect all of those </span><span class="line" data-startTime="1152">together, collect the contents </span><span class="line" data-startTime="1158">of those, and collect the </span><span class="line" data-startTime="1158">names of the CSS files. </span><span class="line" data-startTime="1162">And we'll get into how that </span><span class="line" data-startTime="1162">happens in a few minutes. </span><span class="line" data-startTime="1166">But what it is that happens is </span><span class="line" data-startTime="1166">that those four link tags get </span><span class="line" data-startTime="1171">replaced with a single </span><span class="line" data-startTime="1171">link tag. </span></p>

<p class="speaker"><span class="line" data-starttime="1173"><span class="speakerName">Ilya Grigorik</span>: Which </span><span class="line" data-startTime="1173">is the one we see </span><span class="line" data-startTime="1173">on the bottom, right? </span></p>

<p class="speaker"><span class="line" data-starttime="1174"><span class="speakerName">Joshua Marantz</span>: Which is the one </span><span class="line" data-startTime="1174">that we see on the bottom. </span><span class="line" data-startTime="1175">And it has the names of the </span><span class="line" data-startTime="1175">original CSS files separated </span><span class="line" data-startTime="1182">by plus signs, literally. </span><span class="line" data-startTime="1184">And then there is a .pagespeed </span><span class="line" data-startTime="1184">keyword, which is something </span><span class="line" data-startTime="1189">that we look for when </span><span class="line" data-startTime="1189">we are serving it. </span></p>

<p class="speaker"><span class="line" data-starttime="1191"><span class="speakerName">Ilya Grigorik</span>: It's </span><span class="line" data-startTime="1191">kind of a hint to </span><span class="line" data-startTime="1192">mod_pagespeed, if you will. </span></p>

<p class="speaker"><span class="line" data-starttime="1193"><span class="speakerName">Joshua Marantz</span>: Yeah. </span><span class="line" data-startTime="1194">And then there's a code </span><span class="line" data-startTime="1194">"cc," which actually </span><span class="line" data-startTime="1198">means Combine CSS. </span><span class="line" data-startTime="1199">And then there's a HASH. </span><span class="line" data-startTime="1200">And this HASH is </span><span class="line" data-startTime="1200">very important. </span><span class="line" data-startTime="1203">This HASH is the technology that </span><span class="line" data-startTime="1203">lets mod_pagespeed serve </span><span class="line" data-startTime="1206">any resource with a one-year </span><span class="line" data-startTime="1206">cache lifetime, because that </span><span class="line" data-startTime="1210">HASH is the MD5 sum of the </span><span class="line" data-startTime="1210">optimized resource. </span></p>

<p class="speaker"><span class="line" data-starttime="1215"><span class="speakerName">Ilya Grigorik</span>: So it's the MD5 </span><span class="line" data-startTime="1215">sum of the combined CSS files. </span></p>

<p class="speaker"><span class="line" data-starttime="1219"><span class="speakerName">Joshua Marantz</span>: Right. </span><span class="line" data-startTime="1219">So it's kind of a signature </span><span class="line" data-startTime="1219">for this file. </span><span class="line" data-startTime="1221">Or you could think of it as </span><span class="line" data-startTime="1221">a version of this file. </span></p>

<p class="speaker"><span class="line" data-starttime="1224"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="1224">So if I modify, let's say, </span><span class="line" data-startTime="1224">big.css, and I add extra white </span><span class="line" data-startTime="1227">space, and I save it, the MD5 </span><span class="line" data-startTime="1227">sum would change, and you </span><span class="line" data-startTime="1231">would regenerate </span><span class="line" data-startTime="1231">this resource. </span></p>

<p class="speaker"><span class="line" data-starttime="1233"><span class="speakerName">Joshua Marantz</span>: That's correct </span><span class="line" data-startTime="1233">if we didn't minify that CSS </span><span class="line" data-startTime="1237">file and get rid of </span><span class="line" data-startTime="1237">that white space. </span></p>

<p class="speaker"><span class="line" data-starttime="1238"><span class="speakerName">Ilya Grigorik</span>: OK. </span><span class="line" data-startTime="1238">Right. </span><span class="line" data-startTime="1239">So white space is </span><span class="line" data-startTime="1239">a bad example. </span></p>

<p class="speaker"><span class="line" data-starttime="1240"><span class="speakerName">Joshua Marantz</span>: But if you </span><span class="line" data-startTime="1240">actually change the content of </span><span class="line" data-startTime="1242">the CSS file, then we would </span><span class="line" data-startTime="1242">have a different MD5 sum. </span><span class="line" data-startTime="1247">So we might have cached </span><span class="line" data-startTime="1247">this one for a year. </span><span class="line" data-startTime="1249">And you might think it's stale, </span><span class="line" data-startTime="1249">but it's OK because </span><span class="line" data-startTime="1251">we'll never reference </span><span class="line" data-startTime="1251">it again. </span></p>

<p class="speaker"><span class="line" data-starttime="1253"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="1253">OK. </span><span class="line" data-startTime="1254">And I guess maybe to backtrack a </span><span class="line" data-startTime="1254">little bit, and the reason I </span><span class="line" data-startTime="1256">guess we want to do this is </span><span class="line" data-startTime="1256">fetching multiple files </span><span class="line" data-startTime="1260">consumes maybe additional </span><span class="line" data-startTime="1260">TCP connections. </span><span class="line" data-startTime="1263">So by combining it all </span><span class="line" data-startTime="1263">together, we have one </span><span class="line" data-startTime="1265">resource, which you can </span><span class="line" data-startTime="1265">fetch down faster. </span><span class="line" data-startTime="1268">And hopefully that'll lead to </span><span class="line" data-startTime="1268">a faster render on the page. </span></p>

<p class="speaker"><span class="line" data-starttime="1270"><span class="speakerName">Joshua Marantz</span>: Exactly. </span><span class="line" data-startTime="1271">This is kind of the height </span><span class="line" data-startTime="1271">of that waterfall </span><span class="line" data-startTime="1274">chart that you see. </span><span class="line" data-startTime="1276">If your waterfall chart, for </span><span class="line" data-startTime="1276">example, doesn't fit on your </span><span class="line" data-startTime="1278">screen, you know that you </span><span class="line" data-startTime="1278">have some work to do. </span></p>

<p class="speaker"><span class="line" data-starttime="1280"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="1281">Yes. </span><span class="line" data-startTime="1281">That's a good rule of </span><span class="line" data-startTime="1281">thumb, in general. </span></p>

<p class="speaker"><span class="line" data-starttime="1284"><span class="speakerName">Joshua Marantz</span>: The other point </span><span class="line" data-startTime="1284">that I want to make is </span><span class="line" data-startTime="1285">that by providing long cache </span><span class="line" data-startTime="1285">lifetimes, you make all the </span><span class="line" data-startTime="1289">caches that are in the network </span><span class="line" data-startTime="1289">in between the server and the </span><span class="line" data-startTime="1294">client more effective. </span><span class="line" data-startTime="1295">You make the browser cache </span><span class="line" data-startTime="1295">more effective. </span><span class="line" data-startTime="1297">You make any caching done at the </span><span class="line" data-startTime="1297">ISP layer more effective. </span><span class="line" data-startTime="1300">And you make content delivery </span><span class="line" data-startTime="1300">networks more effective, </span><span class="line" data-startTime="1302">because the versions of the </span><span class="line" data-startTime="1302">assets that they store, they </span><span class="line" data-startTime="1305">know that they don't have to </span><span class="line" data-startTime="1305">check back with the origin to </span><span class="line" data-startTime="1308">revalidate for a year. </span></p>

<p class="speaker"><span class="line" data-starttime="1310"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="1311">OK. </span><span class="line" data-startTime="1311">Very interesting. </span><span class="line" data-startTime="1314">So let's take a look at </span><span class="line" data-startTime="1314">the monster diagram. </span><span class="line" data-startTime="1318">So maybe you can just walk us </span><span class="line" data-startTime="1318">through what happens when an </span><span class="line" data-startTime="1324">HTTP request comes up. </span></p>

<p class="speaker"><span class="line" data-starttime="1324"><span class="speakerName">Joshua Marantz</span>: Sure. </span><span class="line" data-startTime="1325">So this is the view of what </span><span class="line" data-startTime="1325">happens in Apache. </span><span class="line" data-startTime="1330">Apache has a module </span><span class="line" data-startTime="1330">architecture, which allows </span><span class="line" data-startTime="1335">anybody to write their own </span><span class="line" data-startTime="1335">Apache module that can help </span><span class="line" data-startTime="1339">make some kind of transformation </span><span class="line" data-startTime="1339">to the content </span><span class="line" data-startTime="1341">or the networking. </span></p>

<p class="speaker"><span class="line" data-starttime="1341"><span class="speakerName">Ilya Grigorik</span>: Some examples </span><span class="line" data-startTime="1341">are, like, mod_deflate, </span><span class="line" data-startTime="1342">mod_security. </span><span class="line" data-startTime="1343">There's lots and lots </span><span class="line" data-startTime="1343">of these things. </span></p>

<p class="speaker"><span class="line" data-starttime="1345"><span class="speakerName">Joshua Marantz</span>: Actually, </span><span class="line" data-startTime="1345">mod_deflate is a really good </span><span class="line" data-startTime="1346">example, because what that one </span><span class="line" data-startTime="1346">does is &mdash; the most important </span><span class="line" data-startTime="1350">thing that you can do even </span><span class="line" data-startTime="1350">before you run mod_pagespeed </span><span class="line" data-startTime="1352">is make sure to always </span><span class="line" data-startTime="1352">compress your output. </span><span class="line" data-startTime="1356">And that is basically an output </span><span class="line" data-startTime="1356">filter that just looks </span><span class="line" data-startTime="1358">at the stream of bytes that are </span><span class="line" data-startTime="1358">coming through it and just </span><span class="line" data-startTime="1361">makes them smaller and adds the </span><span class="line" data-startTime="1361">header to say, by the way, </span><span class="line" data-startTime="1363">I gzipped it. </span></p>

<p class="speaker"><span class="line" data-starttime="1363"><span class="speakerName">Ilya Grigorik</span>: This is a little </span><span class="line" data-startTime="1363">bit of an aside, but </span><span class="line" data-startTime="1365">would you use mod_deflate </span><span class="line" data-startTime="1365">with mod_pagespeed? </span></p>

<p class="speaker"><span class="line" data-starttime="1368"><span class="speakerName">Joshua Marantz</span>: Actually, if </span><span class="line" data-startTime="1368">you have mod_pagespeed, we </span><span class="line" data-startTime="1371">will turn on mod_deflate. </span> <span class="line" data-startTime="1373">So they work together. </span> <span class="line" data-startTime="1375">Mod_pagespeed would be less </span><span class="line" data-startTime="1375">effective if mod_deflate </span><span class="line" data-startTime="1380">wasn't there. </span> <span class="line" data-startTime="1381">But they're complementary, </span><span class="line" data-startTime="1381">because mod_pagespeed doesn't </span><span class="line" data-startTime="1385">attempt to gzip assets itself. </span> <span class="line" data-startTime="1387">It depends on mod_deflate </span><span class="line" data-startTime="1387">to do that. </span> <span class="line" data-startTime="1389">But it does make them smaller </span><span class="line" data-startTime="1389">in the first place. </span> <span class="line" data-startTime="1392">And image compression is </span><span class="line" data-startTime="1392">not really addressed by </span><span class="line" data-startTime="1394">mod_deflate as well. </span> <span class="line" data-startTime="1396">So the way that an Apache module </span><span class="line" data-startTime="1396">works is that it can </span><span class="line" data-startTime="1400">install into the Apache kernel </span><span class="line" data-startTime="1400">an input filter, which takes </span><span class="line" data-startTime="1405">requests and mutates them in </span><span class="line" data-startTime="1405">some way that's particular to </span><span class="line" data-startTime="1407">the filter. </span> <span class="line" data-startTime="1410">Content generators can look at </span><span class="line" data-startTime="1410">URLs and say, either I know </span><span class="line" data-startTime="1416">how to handle that one. </span> <span class="line" data-startTime="1417">I'll take it over. </span> <span class="line" data-startTime="1418">Nobody else needs to </span><span class="line" data-startTime="1418">worry about it. </span></p>

<p><span class="line" data-startTime="1420">Or, that one's not for me. </span> <span class="line" data-startTime="1421">I decline it. </span> <span class="line" data-startTime="1422">I'll pass it on to </span><span class="line" data-startTime="1422">the next one. </span> <span class="line" data-startTime="1424">And they can install output </span><span class="line" data-startTime="1424">filters, which just get put </span><span class="line" data-startTime="1427">into the chain of the byte </span><span class="line" data-startTime="1427">stream as it goes through. </span></p>

<p class="speaker"><span class="line" data-starttime="1430"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="1431">So here in this diagram, you </span><span class="line" data-startTime="1431">just have the PHP handler. </span><span class="line" data-startTime="1434">So if I have a .PHP file, it </span><span class="line" data-startTime="1434">would intercept that and say, </span><span class="line" data-startTime="1437">hey, that's for me. </span><span class="line" data-startTime="1438">I will generate the </span><span class="line" data-startTime="1438">byte stream. </span></p>

<p class="speaker"><span class="line" data-starttime="1439"><span class="speakerName">Joshua Marantz</span>: Exactly. </span><span class="line" data-startTime="1441">So mod_pagespeed puts a handler </span><span class="line" data-startTime="1441">in which looks at </span><span class="line" data-startTime="1444">those .pagespeed .resources. </span></p>

<p class="speaker"><span class="line" data-starttime="1447"><span class="speakerName">Ilya Grigorik</span>: So it's like </span><span class="line" data-startTime="1447">a custom extension. </span></p>

<p class="speaker"><span class="line" data-starttime="1448"><span class="speakerName">Joshua Marantz</span>: Exactly. </span> <span class="line" data-startTime="1450">And that's for handling </span><span class="line" data-startTime="1450">resources, for handling </span><span class="line" data-startTime="1452">images, CSS, and JavaScript. </span> <span class="line" data-startTime="1455">For HTML, it installs an output </span><span class="line" data-startTime="1455">filter where it looks </span><span class="line" data-startTime="1459">at this stream of </span><span class="line" data-startTime="1459">bytes going by. </span> <span class="line" data-startTime="1460">And whenever it finds HTML, it </span><span class="line" data-startTime="1460">parses it and tries to make </span><span class="line" data-startTime="1465">optimizations in it as </span><span class="line" data-startTime="1465">it goes through. </span> <span class="line" data-startTime="1468">So if an HTML file comes into </span><span class="line" data-startTime="1468">Apache, what will typically </span><span class="line" data-startTime="1473">happen is it'll go through </span><span class="line" data-startTime="1473">the input filters. </span> <span class="line" data-startTime="1475">The PageSpeed resource handler </span><span class="line" data-startTime="1475">will look at it. </span> <span class="line" data-startTime="1478">But it won't do anything </span><span class="line" data-startTime="1478">with it, </span><span class="line" data-startTime="1479">because it's not a resource. </span> <span class="line" data-startTime="1481">The PHP handler, if PHP was </span><span class="line" data-startTime="1481">handling those, would take the </span><span class="line" data-startTime="1488">URL and generate HTML out, which </span><span class="line" data-startTime="1488">would then be sent to </span><span class="line" data-startTime="1492">mod_pagespeed's output filter, </span><span class="line" data-startTime="1492">which would start looking at </span><span class="line" data-startTime="1495">HTML and deciding, based on the </span><span class="line" data-startTime="1495">tags and the characters </span><span class="line" data-startTime="1499">that are parsed, whether </span><span class="line" data-startTime="1499">it wants to mutate </span><span class="line" data-startTime="1501">those bytes or not. </span></p>

<p><span class="line" data-startTime="1506">An important thing that </span><span class="line" data-startTime="1506">mod_pagespeed tries to do is </span><span class="line" data-startTime="1510">never slow down the page. </span> <span class="line" data-startTime="1512">So some of the things that </span><span class="line" data-startTime="1512">mod_pagespeed does are </span><span class="line" data-startTime="1514">actually compute-intensive </span><span class="line" data-startTime="1514">or rely on the network. </span></p>

<p class="speaker"><span class="line" data-starttime="1517"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="1517">That was actually going </span><span class="line" data-startTime="1517">to be my question. </span><span class="line" data-startTime="1518">It sounds like a lot of work. </span></p>

<p class="speaker"><span class="line" data-starttime="1520"><span class="speakerName">Joshua Marantz</span>: There is </span><span class="line" data-startTime="1520">definitely work going on. </span><span class="line" data-startTime="1522">So there's HTML parsing, but </span><span class="line" data-startTime="1522">streaming parsers go fast, so </span><span class="line" data-startTime="1525">that's not really a problem. </span><span class="line" data-startTime="1527">But when we have to go and </span><span class="line" data-startTime="1527">optimize an image &mdash; well, we </span><span class="line" data-startTime="1529">have to fetch images, we have to </span><span class="line" data-startTime="1529">optimize images &mdash; we'll do </span><span class="line" data-startTime="1532">that in the background, </span><span class="line" data-startTime="1532">typically, and also optimize </span><span class="line" data-startTime="1536">them in the background. </span><span class="line" data-startTime="1537">So we will only do the tag </span><span class="line" data-startTime="1537">replacement for images if we </span><span class="line" data-startTime="1544">already had that in cache. </span></p>

<p class="speaker"><span class="line" data-starttime="1546"><span class="speakerName">Ilya Grigorik</span>: Interesting. </span><span class="line" data-startTime="1547">So let's say I've just started </span><span class="line" data-startTime="1547">my web server. </span><span class="line" data-startTime="1551">Nobody has hit it. </span><span class="line" data-startTime="1552">And I make the first request, I </span><span class="line" data-startTime="1552">would still get the original </span><span class="line" data-startTime="1555">unoptimized resource them? </span></p>

<p class="speaker"><span class="line" data-starttime="1557"><span class="speakerName">Joshua Marantz</span>: That's right. </span><span class="line" data-startTime="1558">Probably for the most part, </span><span class="line" data-startTime="1558">your resources will come </span><span class="line" data-startTime="1561">through unoptimized, </span><span class="line" data-startTime="1561">but Collapse </span><span class="line" data-startTime="1563">Whitespace would work. </span></p>

<p class="speaker"><span class="line" data-starttime="1564"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="1564">OK. </span><span class="line" data-startTime="1565">So you would apply filters </span><span class="line" data-startTime="1565">that work really fast. </span><span class="line" data-startTime="1567">And then on the second hit, you </span><span class="line" data-startTime="1567">would actually serve me </span><span class="line" data-startTime="1569">the optimized content. </span></p>

<p class="speaker"><span class="line" data-starttime="1570"><span class="speakerName">Joshua Marantz</span>: Exactly. </span></p>

<p class="speaker"><span class="line" data-starttime="1571"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="1571">That's a very good point. </span><span class="line" data-startTime="1573">OK. </span><span class="line" data-startTime="1573">So maybe one more quick note, </span><span class="line" data-startTime="1573">which is to say we talked </span><span class="line" data-startTime="1577">about PHP, but I think it's </span><span class="line" data-startTime="1577">important to note that one of </span><span class="line" data-startTime="1580">the strong or popular </span><span class="line" data-startTime="1580">applications for Apache is </span><span class="line" data-startTime="1583">that it can act as a proxy. </span><span class="line" data-startTime="1585">So if you have some other server </span><span class="line" data-startTime="1585">running somewhere &mdash; </span><span class="line" data-startTime="1588">that can be another app server, </span><span class="line" data-startTime="1588">maybe it's a Ruby app </span><span class="line" data-startTime="1590">server, Java, what have you &mdash; </span><span class="line" data-startTime="1592">and you're using mod_proxy, </span><span class="line" data-startTime="1592">this still applies, right, </span><span class="line" data-startTime="1595">because it's effectively </span><span class="line" data-startTime="1595">another handler? </span></p>

<p class="speaker"><span class="line" data-starttime="1597"><span class="speakerName">Joshua Marantz</span>: That's </span><span class="line" data-startTime="1597">correct. </span><span class="line" data-startTime="1599">It's easy to set up </span><span class="line" data-startTime="1599">mod_pagespeed as a reverse </span><span class="line" data-startTime="1602">proxy or actually as a forward </span><span class="line" data-startTime="1602">proxy as well. </span><span class="line" data-startTime="1605">And that way, it can optimize </span><span class="line" data-startTime="1605">content that's not necessarily </span><span class="line" data-startTime="1612">even generated within </span><span class="line" data-startTime="1612">the Apache server. </span></p>

<p class="speaker"><span class="line" data-starttime="1614"><span class="speakerName">Ilya Grigorik</span>: So if I have a </span><span class="line" data-startTime="1614">Java server running right now </span><span class="line" data-startTime="1618">serving my assets, I could </span><span class="line" data-startTime="1618">actually put Apache in front, </span><span class="line" data-startTime="1621">turn on mod_pagespeed, and maybe </span><span class="line" data-startTime="1621">inherit some of these </span><span class="line" data-startTime="1623">observations for free. </span></p>

<p class="speaker"><span class="line" data-starttime="1624"><span class="speakerName">Joshua Marantz</span>: Right. </span><span class="line" data-startTime="1624">That would be a reverse </span><span class="line" data-startTime="1624">proxy application. </span></p>

<p class="speaker"><span class="line" data-starttime="1626"><span class="speakerName">Ilya Grigorik</span>: That's right. </span> <span class="line" data-startTime="1626">Very cool. </span> <span class="line" data-startTime="1628">So we talked a little </span><span class="line" data-startTime="1628">about images. </span> <span class="line" data-startTime="1630">And images are a big deal </span><span class="line" data-startTime="1630">on the internet today. </span> <span class="line" data-startTime="1634">Just prior to this, we were kind </span><span class="line" data-startTime="1634">of talking, and we said </span><span class="line" data-startTime="1637">that over 50% of all the </span><span class="line" data-startTime="1637">bandwidth on the internet is </span><span class="line" data-startTime="1641">video, which is moving </span><span class="line" data-startTime="1641">pictures. </span> <span class="line" data-startTime="1643">But then the second-biggest </span><span class="line" data-startTime="1643">component is still images. </span> <span class="line" data-startTime="1646">So you guys put a lot of work </span><span class="line" data-startTime="1646">into optimizing images, in </span><span class="line" data-startTime="1649">particular. </span> <span class="line" data-startTime="1650">And you already covered some </span><span class="line" data-startTime="1650">examples, but this is kind of </span><span class="line" data-startTime="1653">an in-depth look at </span><span class="line" data-startTime="1653">what happens. </span></p>

<p class="speaker"><span class="line" data-starttime="1655"><span class="speakerName">Joshua Marantz</span>: Yeah. </span> <span class="line" data-startTime="1655">This is kind of the life of an </span><span class="line" data-startTime="1655">image as it flies through </span><span class="line" data-startTime="1659">mod_pagespeed. </span> <span class="line" data-startTime="1662">You're right. </span> <span class="line" data-startTime="1662">A lot of the benefit of </span><span class="line" data-startTime="1662">mod_pagespeed, the real wins </span><span class="line" data-startTime="1667">in terms of bandwidth usage and </span><span class="line" data-startTime="1667">latency that mod_pagespeed </span><span class="line" data-startTime="1671">gets, at least in the core </span><span class="line" data-startTime="1671">filter set, on first view are </span><span class="line" data-startTime="1675">from making images smaller. </span> <span class="line" data-startTime="1676">And so we put a lot of </span><span class="line" data-startTime="1676">effort into that. </span> <span class="line" data-startTime="1677">And this is how it works </span><span class="line" data-startTime="1677">at a high level. </span> <span class="line" data-startTime="1681">So we install a filter called </span><span class="line" data-startTime="1681">the image rewriting filter, </span><span class="line" data-startTime="1684">which scans for elements with </span><span class="line" data-startTime="1684">image tags, and it looks for </span><span class="line" data-startTime="1690">the source attribute. </span> <span class="line" data-startTime="1693">And the way that it works, in </span><span class="line" data-startTime="1693">order to not slow down HTML </span><span class="line" data-startTime="1696">even on the first view, is it </span><span class="line" data-startTime="1696">looks in a metadata cache to </span><span class="line" data-startTime="1704">see if we've seen this resource </span><span class="line" data-startTime="1704">at this width and </span><span class="line" data-startTime="1707">height before. </span> <span class="line" data-startTime="1709">So because we're optimizing </span><span class="line" data-startTime="1709">images for the element that </span><span class="line" data-startTime="1713">they're going to be drawn into, </span><span class="line" data-startTime="1713">those all go into the </span><span class="line" data-startTime="1717">key of the metadata cache, </span><span class="line" data-startTime="1717">if you will. </span> <span class="line" data-startTime="1719">And so when that's a hit, if </span><span class="line" data-startTime="1719">we have a warm server, it </span><span class="line" data-startTime="1722">doesn't matter whether the </span><span class="line" data-startTime="1722">browser cache is warm or cold, </span><span class="line" data-startTime="1724">but if the server cache is warm, </span><span class="line" data-startTime="1724">then all we have to do </span><span class="line" data-startTime="1728">to deliver that optimized image </span><span class="line" data-startTime="1728">is swap out that source </span><span class="line" data-startTime="1732">attribute with the one that we </span><span class="line" data-startTime="1732">found in our metadata cache. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="1735"><span class="speakerName">Ilya Grigorik</span>: The optimized </span><span class="line" data-startTime="1735">version of the image. </span></p>

<p class="speaker"><span class="line" data-starttime="1736"><span class="speakerName">Joshua Marantz</span>: Exactly. </span><span class="line" data-startTime="1737">And so if it's a miss, though, </span><span class="line" data-startTime="1737">then we pretty much have to </span><span class="line" data-startTime="1743">give up on this round, because </span><span class="line" data-startTime="1743">we're not going to fetch a </span><span class="line" data-startTime="1744">large image and optimize it </span><span class="line" data-startTime="1744">on the fly it without </span><span class="line" data-startTime="1747">delaying the HTML. </span><span class="line" data-startTime="1749">So we spin up a machine that </span><span class="line" data-startTime="1749">runs in the background &mdash; </span><span class="line" data-startTime="1753">not a physical machine, but a </span><span class="line" data-startTime="1753">finite-state machine that runs </span><span class="line" data-startTime="1756">in the software &mdash; </span><span class="line" data-startTime="1758">and it goes off and </span><span class="line" data-startTime="1758">it does the fetch </span><span class="line" data-startTime="1764">of the image resource. </span><span class="line" data-startTime="1765">It runs the image optimization </span><span class="line" data-startTime="1765">algorithms. </span><span class="line" data-startTime="1767">And we discussed what </span><span class="line" data-startTime="1767">those were before. </span><span class="line" data-startTime="1769">So we can do transcoding. </span><span class="line" data-startTime="1770">We'll do resizing. </span><span class="line" data-startTime="1771">And we'll do recompression. </span></p>

<p class="speaker"><span class="line" data-starttime="1773"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="1773">And I'm guessing you guys also </span><span class="line" data-startTime="1773">do stuff like removing extra </span><span class="line" data-startTime="1776">metadata, which is </span><span class="line" data-startTime="1776">pretty popular in </span><span class="line" data-startTime="1778">like PNG images, right? </span></p>

<p class="speaker"><span class="line" data-starttime="1779"><span class="speakerName">Joshua Marantz</span>: Sure. </span><span class="line" data-startTime="1779">That's actually &mdash; </span><span class="line" data-startTime="1780">in the core set, we'll remove </span><span class="line" data-startTime="1780">the metadata and resize, and </span><span class="line" data-startTime="1784">then it's an option </span><span class="line" data-startTime="1784">to recompress. </span></p>

<p class="speaker"><span class="line" data-starttime="1787"><span class="speakerName">Ilya Grigorik</span>: Actually, I'll </span><span class="line" data-startTime="1787">highlight the resize, because </span><span class="line" data-startTime="1788">I think this is very </span><span class="line" data-startTime="1788">important. </span><span class="line" data-startTime="1790">You mentioned it, but I think </span><span class="line" data-startTime="1790">it's still worth talking about </span><span class="line" data-startTime="1793">for a little bit. </span><span class="line" data-startTime="1794">So if I have an image &mdash; </span><span class="line" data-startTime="1795">say if I have an image tag that </span><span class="line" data-startTime="1795">says the width of this </span><span class="line" data-startTime="1797">image is 100 pixels and </span><span class="line" data-startTime="1797">the height is 100 </span><span class="line" data-startTime="1800">pixels, so it's square &mdash; </span><span class="line" data-startTime="1802">but I can actually push a </span><span class="line" data-startTime="1802">larger image into it. </span><span class="line" data-startTime="1804">It can be 1,000 by 1,000, which </span><span class="line" data-startTime="1804">is actually not uncommon </span><span class="line" data-startTime="1806">on the internet. </span><span class="line" data-startTime="1807">Somebody takes a photo. </span><span class="line" data-startTime="1809">They resize it in </span><span class="line" data-startTime="1809">whatever editor. </span><span class="line" data-startTime="1811">They upload it. </span><span class="line" data-startTime="1812">And you're actually getting the </span><span class="line" data-startTime="1812">full-res image, which then </span><span class="line" data-startTime="1814">gets rescaled in the browser. </span><span class="line" data-startTime="1816">So just by providing the width </span><span class="line" data-startTime="1816">and height in the markup, </span><span class="line" data-startTime="1822">mod_pagespeed will be smart </span><span class="line" data-startTime="1822">enough to look at that and </span><span class="line" data-startTime="1824">say, yes, but the origin image </span><span class="line" data-startTime="1824">is much bigger, so let me </span><span class="line" data-startTime="1827">rescale that and serve </span><span class="line" data-startTime="1827">the proper version. </span></p>

<p class="speaker"><span class="line" data-starttime="1830"><span class="speakerName">Joshua Marantz</span>: Yeah. </span><span class="line" data-startTime="1830">I would go further to say not </span><span class="line" data-startTime="1830">only is it not uncommon, it's </span><span class="line" data-startTime="1833">quite common to take images </span><span class="line" data-startTime="1833">from your camera </span><span class="line" data-startTime="1836">and put them online. </span></p>

<p class="speaker"><span class="line" data-starttime="1837"><span class="speakerName">Ilya Grigorik</span>: So this alone </span><span class="line" data-startTime="1837">saves me a lot of time, </span><span class="line" data-startTime="1839">because if I'm thinking </span><span class="line" data-startTime="1839">about &mdash; </span><span class="line" data-startTime="1841">if I have a lot of images, </span><span class="line" data-startTime="1841">you mentioned kind of the </span><span class="line" data-startTime="1843">newspaper use case </span><span class="line" data-startTime="1843">earlier, right? </span><span class="line" data-startTime="1845">Lots of images there. </span><span class="line" data-startTime="1847">I can just define the width and </span><span class="line" data-startTime="1847">height and push kind of </span><span class="line" data-startTime="1849">the resizing logic </span><span class="line" data-startTime="1849">to mod_pagespeed. </span></p>

<p class="speaker"><span class="line" data-starttime="1852"><span class="speakerName">Joshua Marantz</span>: Exactly. </span></p>

<p class="speaker"><span class="line" data-starttime="1853"><span class="speakerName">Ilya Grigorik</span>: That's </span><span class="line" data-startTime="1853">very cool. </span></p>

<p class="speaker"><span class="line" data-starttime="1854"><span class="speakerName">Joshua Marantz</span>: And so we do </span><span class="line" data-startTime="1854">this kind of gauntlet of image </span><span class="line" data-startTime="1859">optimizations. </span><span class="line" data-startTime="1859">And when it comes out the other </span><span class="line" data-startTime="1859">side, we have a new URL </span><span class="line" data-startTime="1866">with kind of the instructions </span><span class="line" data-startTime="1866">on how that got created and </span><span class="line" data-startTime="1870">coded into it. </span><span class="line" data-startTime="1871">So this image in this </span><span class="line" data-startTime="1871">example &mdash; this is on </span><span class="line" data-startTime="1875">modpagespeed.com, which has </span><span class="line" data-startTime="1875">all of our examples. </span><span class="line" data-startTime="1878">On modpagespeed.com, you'll find </span><span class="line" data-startTime="1878">this Puzzle.jpg is the </span><span class="line" data-startTime="1882">origin image. </span><span class="line" data-startTime="1883">That's shown in green. </span><span class="line" data-startTime="1886">The width in which it was </span><span class="line" data-startTime="1886">displayed in our sample page </span><span class="line" data-startTime="1889">is 256 by 192. </span></p>

<p class="speaker"><span class="line" data-starttime="1890"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="1891">So this is from the </span><span class="line" data-startTime="1891">HTML markup. </span></p>

<p class="speaker"><span class="line" data-starttime="1893"><span class="speakerName">Joshua Marantz</span>: Exactly. </span><span class="line" data-startTime="1894">It was a JPG file originally, </span><span class="line" data-startTime="1894">but we were </span><span class="line" data-startTime="1897">displaying it in Chrome. </span><span class="line" data-startTime="1899">And we took it and now we're </span><span class="line" data-startTime="1899">going to transcode it to WebP </span><span class="line" data-startTime="1904">so that it's delivered </span><span class="line" data-startTime="1904">more efficiently. </span><span class="line" data-startTime="1906">We also put into the URL the MD5 </span><span class="line" data-startTime="1906">sum of this image file so </span><span class="line" data-startTime="1911">we can serve it for </span><span class="line" data-startTime="1911">a long time. </span><span class="line" data-startTime="1913">And even if I change Puzzle.jpg, </span><span class="line" data-startTime="1913">then it won't be a </span><span class="line" data-startTime="1918">problem with stale caches. </span></p>

<p class="speaker"><span class="line" data-starttime="1919"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="1919">It's kind of a similar </span><span class="line" data-startTime="1919">pattern to what we </span><span class="line" data-startTime="1920">saw with CSS earlier. </span></p>

<p class="speaker"><span class="line" data-starttime="1921"><span class="speakerName">Joshua Marantz</span>: Exactly. </span></p>

<p class="speaker"><span class="line" data-starttime="1922"><span class="speakerName">Ilya Grigorik</span>: OK. </span><span class="line" data-startTime="1922">And I guess the WebP one is </span><span class="line" data-startTime="1922">really interesting, because </span><span class="line" data-startTime="1926">this would get served &mdash; you </span><span class="line" data-startTime="1926">mentioned because this was in </span><span class="line" data-startTime="1928">Chrome, you'd get WebP. </span><span class="line" data-startTime="1930">But If I visited the same </span><span class="line" data-startTime="1930">website in, let's say, Firefox </span><span class="line" data-startTime="1933">browser, which currently does </span><span class="line" data-startTime="1933">not, unfortunately, support </span><span class="line" data-startTime="1936">WebP, I would still get a JPG. </span></p>

<p class="speaker"><span class="line" data-starttime="1938"><span class="speakerName">Joshua Marantz</span>: Exactly. </span><span class="line" data-startTime="1938">So as a site owner, you can </span><span class="line" data-startTime="1938">make a decision, by using </span><span class="line" data-startTime="1944">mod_pagespeed, that you're going </span><span class="line" data-startTime="1944">to serve images in a </span><span class="line" data-startTime="1947">modern web format that is not </span><span class="line" data-startTime="1947">supported by all browsers, but </span><span class="line" data-startTime="1950">your site will still work </span><span class="line" data-startTime="1950">well on all browsers. </span></p>

<p class="speaker"><span class="line" data-starttime="1953"><span class="speakerName">Ilya Grigorik</span>: Very cool. </span><span class="line" data-startTime="1954">So that's not even something </span><span class="line" data-startTime="1954">that I could do with a build </span><span class="line" data-startTime="1956">step, right? </span></p>

<p class="speaker"><span class="line" data-starttime="1957"><span class="speakerName">Joshua Marantz</span>: Correct. </span></p>

<p class="speaker"><span class="line" data-starttime="1959"><span class="speakerName">Ilya Grigorik</span>: Yes. </span><span class="line" data-startTime="1959">Very nice. </span></p>

<p class="speaker"><span class="line" data-starttime="1960"><span class="speakerName">Joshua Marantz</span>: So I wanted to </span><span class="line" data-startTime="1960">dive into a little bit of what </span><span class="line" data-startTime="1962">the PageSpeed Optimization </span><span class="line" data-startTime="1962">Library is. </span></p>

<p class="speaker"><span class="line" data-starttime="1964"><span class="speakerName">Ilya Grigorik</span>: So this is </span><span class="line" data-startTime="1964">the part that powers </span><span class="line" data-startTime="1966">modpagespeed.com, right? </span></p>

<p class="speaker"><span class="line" data-starttime="1967"><span class="speakerName">Joshua Marantz</span>: Right. </span><span class="line" data-startTime="1967">So this is a server-independent </span><span class="line" data-startTime="1967">library </span><span class="line" data-startTime="1971">that does all of these </span><span class="line" data-startTime="1971">optimizations. </span><span class="line" data-startTime="1974">And the way that it gets hooked </span><span class="line" data-startTime="1974">up to &mdash; and again, this </span><span class="line" data-startTime="1979">is completely open-source </span><span class="line" data-startTime="1979">software. </span><span class="line" data-startTime="1981">But the way that it gets hooked </span><span class="line" data-startTime="1981">into a server stack is </span><span class="line" data-startTime="1985">that whoever is doing that </span><span class="line" data-startTime="1985">supplies some mechanism to do </span><span class="line" data-startTime="1989">HTTP fetching and some mechanism </span><span class="line" data-startTime="1989">to do caching. </span><span class="line" data-startTime="1997">And in different environments, </span><span class="line" data-startTime="1997">there are different </span><span class="line" data-startTime="2001">technologies for accomplishing </span><span class="line" data-startTime="2001">these things. </span></p>

<p class="speaker"><span class="line" data-starttime="2002"><span class="speakerName">Ilya Grigorik</span>: These things </span><span class="line" data-startTime="2002">are implemented in Apache. </span><span class="line" data-startTime="2003">So Apache, I'm guessing, already </span><span class="line" data-startTime="2003">has an HTTP fetcher, </span><span class="line" data-startTime="2006">which you reuse, but the cache </span><span class="line" data-startTime="2006">is likely something that you </span><span class="line" data-startTime="2008">guys have implemented </span><span class="line" data-startTime="2008">yourself. </span></p>

<p class="speaker"><span class="line" data-starttime="2010"><span class="speakerName">Joshua Marantz</span>: Sure. </span><span class="line" data-startTime="2011">Actually, the cache that we use </span><span class="line" data-startTime="2011">for mod_pagespeed is also </span><span class="line" data-startTime="2017">open sourced and would be </span><span class="line" data-startTime="2017">the default setting. </span><span class="line" data-startTime="2022">But typically, in a serving </span><span class="line" data-startTime="2022">environment that has some </span><span class="line" data-startTime="2026">maturity to it, there will be </span><span class="line" data-startTime="2026">some other caching solution </span><span class="line" data-startTime="2028">you'll want to use instead </span><span class="line" data-startTime="2028">of the one that </span><span class="line" data-startTime="2029">we have open sourced. </span></p>

<p class="speaker"><span class="line" data-starttime="2031"><span class="speakerName">Ilya Grigorik</span>: So in fact, </span><span class="line" data-startTime="2031">maybe could I even use </span><span class="line" data-startTime="2032">something &mdash; like if I'm building </span><span class="line" data-startTime="2032">something with this </span><span class="line" data-startTime="2035">library, I could use </span><span class="line" data-startTime="2035">memcached, right? </span></p>

<p class="speaker"><span class="line" data-starttime="2037"><span class="speakerName">Joshua Marantz</span>: Yes. </span><span class="line" data-startTime="2039">Yes. </span><span class="line" data-startTime="2039">You're kind of forcing </span><span class="line" data-startTime="2039">me to tip my hand. </span><span class="line" data-startTime="2042">So a feature that we will be </span><span class="line" data-startTime="2042">releasing soon but is not yet </span><span class="line" data-startTime="2045">in 1.0 is support of memcached, </span><span class="line" data-startTime="2045">which is an </span><span class="line" data-startTime="2049">important feature for </span><span class="line" data-startTime="2049">scaling up websites. </span></p>

<p class="speaker"><span class="line" data-starttime="2053"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="2054">Nice. </span><span class="line" data-startTime="2056">OK. </span><span class="line" data-startTime="2056">So if I have a custom server, I </span><span class="line" data-startTime="2056">could actually take this and </span><span class="line" data-startTime="2062">build my own mod_pagespeed </span><span class="line" data-startTime="2062">variant. </span></p>

<p class="speaker"><span class="line" data-starttime="2064"><span class="speakerName">Joshua Marantz</span>: Exactly. </span><span class="line" data-startTime="2067">Yeah. </span><span class="line" data-startTime="2068">There's API documentation </span><span class="line" data-startTime="2068">on the web in </span><span class="line" data-startTime="2071">the developers' site. </span><span class="line" data-startTime="2073">And we would be happy to support </span><span class="line" data-startTime="2073">actively anybody </span><span class="line" data-startTime="2076">interested in porting this </span><span class="line" data-startTime="2076">to a new platform. </span></p>

<p class="speaker"><span class="line" data-starttime="2078"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="2078">And we'll mention this later, </span><span class="line" data-startTime="2078">but you guys do have an active </span><span class="line" data-startTime="2081">Google Group where people can </span><span class="line" data-startTime="2081">come in and discuss, propose </span><span class="line" data-startTime="2084">new filters, file bugs, all </span><span class="line" data-startTime="2084">that kind of stuff. </span></p>

<p class="speaker"><span class="line" data-starttime="2087"><span class="speakerName">Joshua Marantz</span>: Yeah. </span><span class="line" data-startTime="2088">There's actually a variety </span><span class="line" data-startTime="2088">of support forums. </span><span class="line" data-startTime="2091">There's the Google Groups. </span><span class="line" data-startTime="2092">There's the issues list. </span><span class="line" data-startTime="2096">People seem to be </span><span class="line" data-startTime="2096">fairly active on </span><span class="line" data-startTime="2098">Stack Overflow as well. </span><span class="line" data-startTime="2099">We try to be responsive. </span></p>

<p class="speaker"><span class="line" data-starttime="2099"><span class="speakerName">Ilya Grigorik</span>: Yeah. </span><span class="line" data-startTime="2099">I see a lot of questions </span><span class="line" data-startTime="2099">there. </span></p>

<p class="speaker"><span class="line" data-starttime="2101"><span class="speakerName">Joshua Marantz</span>: We try to </span><span class="line" data-startTime="2101">be responsive to that. </span><span class="line" data-startTime="2103">But we track everything in our </span><span class="line" data-startTime="2103">issues list, which is all </span><span class="line" data-startTime="2107">accessed off of code.google.com. </span></p>

<p class="speaker"><span class="line" data-starttime="2109"><span class="speakerName">Ilya Grigorik</span>: Right. </span> <span class="line" data-startTime="2109">OK. </span> <span class="line" data-startTime="2110">Perfect. </span> <span class="line" data-startTime="2112">So I wanted to highlight a few </span><span class="line" data-startTime="2112">kind of tips, configuration </span><span class="line" data-startTime="2115">tricks, and a few </span><span class="line" data-startTime="2115">other things. </span> <span class="line" data-startTime="2117">We looked at the guts. </span> <span class="line" data-startTime="2118">We talked about kind of </span><span class="line" data-startTime="2118">high-level things. </span> <span class="line" data-startTime="2120">But one question that I get </span><span class="line" data-startTime="2120">quite commonly with </span><span class="line" data-startTime="2123">mod_pagespeed is like, </span><span class="line" data-startTime="2123">OK, great. </span> <span class="line" data-startTime="2125">So I grabbed this, </span><span class="line" data-startTime="2125">installed it. </span> <span class="line" data-startTime="2126">I ran these three commands. </span> <span class="line" data-startTime="2127">Now it's on. </span> <span class="line" data-startTime="2130">What if it doesn't work, or </span><span class="line" data-startTime="2130">I'm scared, or how can I </span><span class="line" data-startTime="2133">experiment with mod_pagespeed? </span><span class="line" data-startTime="2135">And there's a couple </span><span class="line" data-startTime="2135">of ways to do that. </span> <span class="line" data-startTime="2137">First of all, because we have </span><span class="line" data-startTime="2137">this additional module </span><span class="line" data-startTime="2140">installed, you can actually </span><span class="line" data-startTime="2140">configure through a couple of </span><span class="line" data-startTime="2143">different ways. </span></p>

<p><span class="line" data-startTime="2144">So you can use query parameters </span><span class="line" data-startTime="2144">that will be </span><span class="line" data-startTime="2146">intercepted by mod_pagespeed. </span> <span class="line" data-startTime="2148">So for example in this rewrite </span><span class="line" data-startTime="2148">CSS example, we have </span><span class="line" data-startTime="2151">ModPagespeed=on, which basically </span><span class="line" data-startTime="2151">says turn on </span><span class="line" data-startTime="2154">mod_pagespeed for this </span><span class="line" data-startTime="2154">request only. </span> <span class="line" data-startTime="2157">So you can have it disabled, </span><span class="line" data-startTime="2157">but I'm going </span><span class="line" data-startTime="2159">to enable it here. </span> <span class="line" data-startTime="2160">And by the way, enable </span><span class="line" data-startTime="2160">this specific filter. </span> <span class="line" data-startTime="2163">So if I want to experiment with </span><span class="line" data-startTime="2163">some non-core filter, I </span><span class="line" data-startTime="2167">can just pass this in, see what </span><span class="line" data-startTime="2167">happens, kind of test the </span><span class="line" data-startTime="2171">waters, and then decide if I </span><span class="line" data-startTime="2171">want to make that the default </span><span class="line" data-startTime="2173">for my configuration or not. </span></p>

<p class="speaker"><span class="line" data-starttime="2175"><span class="speakerName">Joshua Marantz</span>: Yeah. </span><span class="line" data-startTime="2175">It's kind of a way to </span><span class="line" data-startTime="2175">interactively rapidly iterate </span><span class="line" data-startTime="2177">on your site without having to </span><span class="line" data-startTime="2177">restart Apache or anything. </span></p>

<p class="speaker"><span class="line" data-starttime="2179"><span class="speakerName">Ilya Grigorik</span>: I think it's one </span><span class="line" data-startTime="2179">of my favorite features. </span><span class="line" data-startTime="2181">I love just being able to </span><span class="line" data-startTime="2181">quickly get feedback on, how </span><span class="line" data-startTime="2184">is this going to look? </span><span class="line" data-startTime="2186">One alternative to that is to </span><span class="line" data-startTime="2186">actually send HTTP headers. </span><span class="line" data-startTime="2190">So if you have some sort of a </span><span class="line" data-startTime="2190">client or server solution that </span><span class="line" data-startTime="2192">you want to test with, </span><span class="line" data-startTime="2192">that's another way. </span><span class="line" data-startTime="2194">And then the last one is &mdash; we </span><span class="line" data-startTime="2194">actually mentioned this &mdash; the </span><span class="line" data-startTime="2197">mod_proxy forward proxy </span><span class="line" data-startTime="2197">example, where you can </span><span class="line" data-startTime="2200">actually say, please fetch me </span><span class="line" data-startTime="2200">this other site and run it </span><span class="line" data-startTime="2205">through PageSpeed and </span><span class="line" data-startTime="2205">show me what will </span><span class="line" data-startTime="2206">happen when we do that. </span></p>

<p class="speaker"><span class="line" data-starttime="2208"><span class="speakerName">Ilya Grigorik</span>: Yeah. </span><span class="line" data-startTime="2209">This is a very good way if </span><span class="line" data-startTime="2209">you're considering the option </span><span class="line" data-startTime="2212">of using mod_pagespeed on your </span><span class="line" data-startTime="2212">site, but you're nervous about </span><span class="line" data-startTime="2216">like installing it and rolling </span><span class="line" data-startTime="2216">out to your users without kind </span><span class="line" data-startTime="2219">of looking at it first &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2219"><span class="speakerName">Ilya Grigorik</span>: Yeah. </span><span class="line" data-startTime="2220">Let's install it on 1,000 </span><span class="line" data-startTime="2220">servers and see what happens. </span></p>

<p class="speaker"><span class="line" data-starttime="2222"><span class="speakerName">Joshua Marantz</span>:  &mdash; you can </span><span class="line" data-startTime="2222">install it on one server local </span><span class="line" data-startTime="2224">to your system, which is running </span><span class="line" data-startTime="2224">your origin content. </span><span class="line" data-startTime="2229">It's running as a proxy. </span><span class="line" data-startTime="2230">And then you can look at your </span><span class="line" data-startTime="2230">site through mod_pagespeed by </span><span class="line" data-startTime="2232">setting a browser proxy. </span></p>

<p class="speaker"><span class="line" data-starttime="2234"><span class="speakerName">Ilya Grigorik</span>: Right. </span> <span class="line" data-startTime="2234">That's a very handy tool. </span> <span class="line" data-startTime="2236">And in fact, all three of these </span><span class="line" data-startTime="2236">are documented really </span><span class="line" data-startTime="2240">well on the mod_pagespeed </span><span class="line" data-startTime="2240">site. </span> <span class="line" data-startTime="2242">So I have a link down here. </span> <span class="line" data-startTime="2244">But if you guys search on your </span><span class="line" data-startTime="2244">favorite search engine for </span><span class="line" data-startTime="2246">mod_pagespeed and experiment, </span><span class="line" data-startTime="2246">you'll find instructions for </span><span class="line" data-startTime="2250">how to set up the mod_proxy, </span><span class="line" data-startTime="2250">which is really handy. </span> <span class="line" data-startTime="2254">I wanted to highlight this, </span><span class="line" data-startTime="2254">which is we mentioned already </span><span class="line" data-startTime="2256">that there is a lot of </span><span class="line" data-startTime="2256">different filters. </span> <span class="line" data-startTime="2258">And we do have good </span><span class="line" data-startTime="2258">documentation. </span> <span class="line" data-startTime="2260">And there's a couple different </span><span class="line" data-startTime="2260">resources. </span></p>

<p><span class="line" data-startTime="2262">So one that you mentioned, which </span><span class="line" data-startTime="2262">is modpagespeed.com, </span><span class="line" data-startTime="2265">where we actually list </span><span class="line" data-startTime="2265">all the filters. </span> <span class="line" data-startTime="2267">And we actually also </span><span class="line" data-startTime="2267">provide the demos. </span> <span class="line" data-startTime="2270">So it's usually kind of a simple </span><span class="line" data-startTime="2270">file which illustrates </span><span class="line" data-startTime="2273">what the filter does. </span> <span class="line" data-startTime="2274">So if you guys want to take a </span><span class="line" data-startTime="2274">look at that, that's a very </span><span class="line" data-startTime="2276">good place. </span> <span class="line" data-startTime="2277">And another one is, once again, </span><span class="line" data-startTime="2277">the configuration, or </span><span class="line" data-startTime="2280">config filters, page on our </span><span class="line" data-startTime="2280">developers.google.com site, </span><span class="line" data-startTime="2285">where we actually explain </span><span class="line" data-startTime="2285">what each one does. </span> <span class="line" data-startTime="2288">And we also highlight which </span><span class="line" data-startTime="2288">ones are in the </span><span class="line" data-startTime="2290">core set and not. </span> <span class="line" data-startTime="2292">And another thing I'll mention </span><span class="line" data-startTime="2292">is that by default, when you </span><span class="line" data-startTime="2296">enable mod_pagespeed, </span><span class="line" data-startTime="2296">as Josh said, you </span><span class="line" data-startTime="2298">have your core filters. </span></p>

<p><span class="line" data-startTime="2299">But you can actually </span><span class="line" data-startTime="2299">say, don't worry </span><span class="line" data-startTime="2301">about the core filters. </span> <span class="line" data-startTime="2302">I'm going to hand-tune all </span><span class="line" data-startTime="2302">the filters myself. </span> <span class="line" data-startTime="2305">So you can customize it </span><span class="line" data-startTime="2305">completely for your site. </span></p>

<p class="speaker"><span class="line" data-starttime="2310"><span class="speakerName">Joshua Marantz</span>: Yeah. </span><span class="line" data-startTime="2310">By turning on the core filters, </span><span class="line" data-startTime="2310">what you're doing is </span><span class="line" data-startTime="2316">you're kind of letting us make </span><span class="line" data-startTime="2316">the decision as we move the </span><span class="line" data-startTime="2318">software and advance it of what </span><span class="line" data-startTime="2318">we think is safe for most </span><span class="line" data-startTime="2321">sites, and you'll take that. </span><span class="line" data-startTime="2323">If you want to have total </span><span class="line" data-startTime="2323">control, and when you upgrade </span><span class="line" data-startTime="2327">you'll decide which filters you </span><span class="line" data-startTime="2327">want to enable for the new </span><span class="line" data-startTime="2329">release, then you can put it in </span><span class="line" data-startTime="2329">pass-through mode and then </span><span class="line" data-startTime="2332">add the filters that you want. </span></p>

<p class="speaker"><span class="line" data-starttime="2333"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="2333">So that's a good point. </span><span class="line" data-startTime="2334">So I should probably, unless </span><span class="line" data-startTime="2334">I have a specific reason to </span><span class="line" data-startTime="2337">avoid core filters, I could </span><span class="line" data-startTime="2337">leave that on because maybe in </span><span class="line" data-startTime="2340">the subsequent release you guys </span><span class="line" data-startTime="2340">have added another filter </span><span class="line" data-startTime="2342">or improved another filter such </span><span class="line" data-startTime="2342">that now it's considered </span><span class="line" data-startTime="2345">safe, and that would just be </span><span class="line" data-startTime="2345">automatically included during </span><span class="line" data-startTime="2348">an upgrade. </span></p>

<p class="speaker"><span class="line" data-starttime="2349"><span class="speakerName">Joshua Marantz</span>: Yeah. </span> <span class="line" data-startTime="2349">I'll give you an example. </span> <span class="line" data-startTime="2352">I believe in the current </span><span class="line" data-startTime="2352">release, we have a filter </span><span class="line" data-startTime="2353">called Flatten CSS Imports. </span> <span class="line" data-startTime="2356">One of the biggest anti-patterns </span><span class="line" data-startTime="2356">for performance </span><span class="line" data-startTime="2360">in CSS files is to </span><span class="line" data-startTime="2360">use at-import. </span> <span class="line" data-startTime="2362">But it's incredibly convenient </span><span class="line" data-startTime="2362">to do it. </span> <span class="line" data-startTime="2364">As a designer, that's </span><span class="line" data-startTime="2364">what you want. </span> <span class="line" data-startTime="2366">You want to be able to </span><span class="line" data-startTime="2366">structure your code. </span> <span class="line" data-startTime="2368">You want modular code. </span> <span class="line" data-startTime="2370">So that's a good thing. </span></p>

<p><span class="line" data-startTime="2371">It's bad how it's delivered. </span> <span class="line" data-startTime="2373">Mod_pagespeed with the Flatten </span><span class="line" data-startTime="2373">CSS Imports filter will </span><span class="line" data-startTime="2378">flatten those all out so you get </span><span class="line" data-startTime="2378">the best performance when </span><span class="line" data-startTime="2380">you deliver it, but you don't </span><span class="line" data-startTime="2380">have to maintain that. </span> <span class="line" data-startTime="2384">That was something that </span><span class="line" data-startTime="2384">we built into the </span><span class="line" data-startTime="2387">product some time ago. </span> <span class="line" data-startTime="2389">But we wanted to do a lot of </span><span class="line" data-startTime="2389">testing on it to make sure it </span><span class="line" data-startTime="2391">was rock solid. </span> <span class="line" data-startTime="2392">That's being promoted into the </span><span class="line" data-startTime="2392">core filters in the next </span><span class="line" data-startTime="2396">release after 1.0. </span> <span class="line" data-startTime="2399">And so if you have </span><span class="line" data-startTime="2399">core filters then </span><span class="line" data-startTime="2400">you just get that. </span></p>

<p class="speaker"><span class="line" data-starttime="2401"><span class="speakerName">Ilya Grigorik</span>: Interesting OK. </span> <span class="line" data-startTime="2402">That's good to know. </span> <span class="line" data-startTime="2405">So we also touched on </span><span class="line" data-startTime="2405">some configuration. </span> <span class="line" data-startTime="2409">But one of the really nice </span><span class="line" data-startTime="2409">things about Apache is that </span><span class="line" data-startTime="2414">you can configure it in a </span><span class="line" data-startTime="2414">million different ways. </span> <span class="line" data-startTime="2416">So there's your Apache config, </span><span class="line" data-startTime="2416">where you can specify your </span><span class="line" data-startTime="2419">virtual hosts. </span> <span class="line" data-startTime="2420">So mod_pagespeed can be </span><span class="line" data-startTime="2420">configured at a v-host level. </span> <span class="line" data-startTime="2423">So an example, down here we're </span><span class="line" data-startTime="2423">saying mod_pagespeed is on for </span><span class="line" data-startTime="2427">this example site, and </span><span class="line" data-startTime="2427">pass-through is actually the </span><span class="line" data-startTime="2431">command that tells us, don't </span><span class="line" data-startTime="2431">include the core filters. </span></p>

<p><span class="line" data-startTime="2435">I'll hand-tune the filters </span><span class="line" data-startTime="2435">that I want. </span> <span class="line" data-startTime="2437">So we're just enabling these, I </span><span class="line" data-startTime="2437">guess, five filters for this </span><span class="line" data-startTime="2441">example site. </span> <span class="line" data-startTime="2442">But I can also be much </span><span class="line" data-startTime="2442">more granular. </span> <span class="line" data-startTime="2445">I can use the htaccess file. </span> <span class="line" data-startTime="2447">So for example, I </span><span class="line" data-startTime="2447">have my v-host. </span> <span class="line" data-startTime="2450">I have my example file. </span> <span class="line" data-startTime="2451">But in my slash, I don't know, </span><span class="line" data-startTime="2451">assets I want to have a </span><span class="line" data-startTime="2456">different set of filters, I </span><span class="line" data-startTime="2456">could actually drop in an </span><span class="line" data-startTime="2458">htaccess file with another </span><span class="line" data-startTime="2458">configuration. </span></p>

<p class="speaker"><span class="line" data-starttime="2462"><span class="speakerName">Joshua Marantz</span>: Right. </span><span class="line" data-startTime="2462">And there's yet another twist, </span><span class="line" data-startTime="2462">which is you can use a </span><span class="line" data-startTime="2465">directory scope in the </span><span class="line" data-startTime="2465">configuration file. </span></p>

<p class="speaker"><span class="line" data-starttime="2467"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="2467">So I could literally have </span><span class="line" data-startTime="2467">different filters running on </span><span class="line" data-startTime="2470">different subsections </span><span class="line" data-startTime="2470">of my website. </span></p>

<p class="speaker"><span class="line" data-starttime="2471"><span class="speakerName">Joshua Marantz</span>: Exactly. </span><span class="line" data-startTime="2474">Actually, the implementation </span><span class="line" data-startTime="2474">of just how the options get </span><span class="line" data-startTime="2478">configured is itself a pretty </span><span class="line" data-startTime="2478">big topic within the </span><span class="line" data-startTime="2481">mod_pagespeed codebase, because </span><span class="line" data-startTime="2481">you can configure my </span><span class="line" data-startTime="2484">request headers, by query </span><span class="line" data-startTime="2484">parameters, by virtual host, </span><span class="line" data-startTime="2486">by director scope, by virtual </span><span class="line" data-startTime="2486">host, and at the root. </span></p>

<p class="speaker"><span class="line" data-starttime="2488"><span class="speakerName">Ilya Grigorik</span>: Yeah. </span><span class="line" data-startTime="2489">But I think it highlights </span><span class="line" data-startTime="2489">the fact that our users </span><span class="line" data-startTime="2491">have asked for that. </span><span class="line" data-startTime="2492">So they are using all of </span><span class="line" data-startTime="2492">these mechanisms to </span><span class="line" data-startTime="2495">customize their sites. </span><span class="line" data-startTime="2497">So we needed to have it. </span><span class="line" data-startTime="2498">And it allows you a lot </span><span class="line" data-startTime="2498">of flexibility, </span><span class="line" data-startTime="2500">which is very nice. </span><span class="line" data-startTime="2505">And experiments. </span><span class="line" data-startTime="2506">So I think this is something </span><span class="line" data-startTime="2506">that you </span><span class="line" data-startTime="2507">guys added just recently. </span></p>

<p class="speaker"><span class="line" data-starttime="2509"><span class="speakerName">Joshua Marantz</span>: That's right. </span> <span class="line" data-startTime="2510">We've been traditionally using </span><span class="line" data-startTime="2510">WebPagetest, which is an </span><span class="line" data-startTime="2513">amazing tool for doing </span><span class="line" data-startTime="2513">detailed analysis. </span> <span class="line" data-startTime="2516">That's how we produced the </span><span class="line" data-startTime="2516">video and the waterfall </span><span class="line" data-startTime="2518">diagrams that we saw earlier. </span> <span class="line" data-startTime="2521">But WebPagetest will allow you </span><span class="line" data-startTime="2521">to run your tests from a set </span><span class="line" data-startTime="2529">of servers that are running in </span><span class="line" data-startTime="2529">some corner of the world. </span> <span class="line" data-startTime="2531">There's ones in Singapore, </span><span class="line" data-startTime="2531">in Dublin, in </span><span class="line" data-startTime="2534">Virginia, and so on. </span> <span class="line" data-startTime="2536">But what you really want to do </span><span class="line" data-startTime="2536">at some point after you deploy </span><span class="line" data-startTime="2541">is see what experience your </span><span class="line" data-startTime="2541">actual users are having. </span> <span class="line" data-startTime="2545">And so what this does is it </span><span class="line" data-startTime="2545">injects some performance </span><span class="line" data-startTime="2549">measurement, using Google </span><span class="line" data-startTime="2549">Analytics, right into the web </span><span class="line" data-startTime="2554">pages and allows you to bucket </span><span class="line" data-startTime="2554">users into experiment groups. </span> <span class="line" data-startTime="2559">And you can say, for example, </span><span class="line" data-startTime="2559">first of all you would </span><span class="line" data-startTime="2562">establish what Google Analytics </span><span class="line" data-startTime="2562">ID you want to </span><span class="line" data-startTime="2565">report the data to. </span> <span class="line" data-startTime="2567">And then you can say, well, I'm </span><span class="line" data-startTime="2567">going to send a third of </span><span class="line" data-startTime="2569">my users into kind of a control </span><span class="line" data-startTime="2569">bucket which doesn't </span><span class="line" data-startTime="2572">have any optimizations in it. </span></p>

<p><span class="line" data-startTime="2574">mod_pagespeed is running, but it </span><span class="line" data-startTime="2574">isn't doing anything except </span><span class="line" data-startTime="2577">injecting the Analytics </span><span class="line" data-startTime="2577">experiment. </span> <span class="line" data-startTime="2580">The second one we can say, </span><span class="line" data-startTime="2580">let's just have the image </span><span class="line" data-startTime="2583">compression and nothing else. </span> <span class="line" data-startTime="2585">And the third one, let's have </span><span class="line" data-startTime="2585">the default settings. </span> <span class="line" data-startTime="2587">Or there's a whole set of </span><span class="line" data-startTime="2587">options that you can do to </span><span class="line" data-startTime="2592">customize your experiments. </span> <span class="line" data-startTime="2593">Then you can let this run </span><span class="line" data-startTime="2593">for a day, a week. </span> <span class="line" data-startTime="2597">Depending on the experiments </span><span class="line" data-startTime="2597">you might leave a small </span><span class="line" data-startTime="2600">control group just to see how </span><span class="line" data-startTime="2600">it's doing, and go back to log </span><span class="line" data-startTime="2604">into Google Analytics and see </span><span class="line" data-startTime="2604">how users for each bucket are </span><span class="line" data-startTime="2610">faring in terms of the latency </span><span class="line" data-startTime="2610">that they're seeing </span><span class="line" data-startTime="2612">on their web pages. </span></p>

<p class="speaker"><span class="line" data-starttime="2613"><span class="speakerName">Ilya Grigorik</span>: So this </span><span class="line" data-startTime="2613">is really cool. </span><span class="line" data-startTime="2615">So what you've described there </span><span class="line" data-startTime="2615">is the difference being </span><span class="line" data-startTime="2617">synthetic testing and real </span><span class="line" data-startTime="2617">user measurement, which I </span><span class="line" data-startTime="2621">think is what you're referring </span><span class="line" data-startTime="2621">to when you're saying Google </span><span class="line" data-startTime="2624">Analytics, right? </span></p>

<p class="speaker"><span class="line" data-starttime="2624"><span class="speakerName">Joshua Marantz</span>: Yes. </span></p>

<p class="speaker"><span class="line" data-starttime="2626"><span class="speakerName">Ilya Grigorik</span>: And we actually </span><span class="line" data-startTime="2626">had an episode with Justin </span><span class="line" data-startTime="2628">Cutroni from Google Analytics </span><span class="line" data-startTime="2628">where we talked about </span><span class="line" data-startTime="2631">navigation timing and why </span><span class="line" data-startTime="2631">it's so important. </span> <span class="line" data-startTime="2633">And the point that Justin always </span><span class="line" data-startTime="2633">loves to make is that </span><span class="line" data-startTime="2638">it's great that the developers </span><span class="line" data-startTime="2638">want to optimize the site. </span> <span class="line" data-startTime="2640">They always want to </span><span class="line" data-startTime="2640">optimize the site. </span> <span class="line" data-startTime="2642">But how does it affect </span><span class="line" data-startTime="2642">my bottom line? </span><span class="line" data-startTime="2644">Like the business metrics, </span><span class="line" data-startTime="2644">the dollars as he put it. </span> <span class="line" data-startTime="2647">So this will actually </span><span class="line" data-startTime="2647">tell you. </span> <span class="line" data-startTime="2649">So we have three buckets here. </span> <span class="line" data-startTime="2651">And if I have in my Google </span><span class="line" data-startTime="2651">Analytics some conversion </span><span class="line" data-startTime="2655">metrics &mdash; that could be a </span><span class="line" data-startTime="2655">purchase, that could be a </span><span class="line" data-startTime="2658">registration, even time on </span><span class="line" data-startTime="2658">site or bounce rate &mdash; </span><span class="line" data-startTime="2661">now I could measure against </span><span class="line" data-startTime="2661">that and say, </span><span class="line" data-startTime="2663">well, you know what? </span><span class="line" data-startTime="2664">Users that get a faster </span><span class="line" data-startTime="2664">experience </span><span class="line" data-startTime="2667">are staying for longer. </span></p>

<p><span class="line" data-startTime="2668">Maybe they're converting </span><span class="line" data-startTime="2668">for more. </span> <span class="line" data-startTime="2669">And that makes for a very </span><span class="line" data-startTime="2669">compelling case to the rest of </span><span class="line" data-startTime="2671">the team to say, this is why </span><span class="line" data-startTime="2671">we should invest into more </span><span class="line" data-startTime="2673">performance optimization. </span></p>

<p class="speaker"><span class="line" data-starttime="2675"><span class="speakerName">Joshua Marantz</span>: Exactly. </span></p>

<p class="speaker"><span class="line" data-starttime="2676"><span class="speakerName">Ilya Grigorik</span>: Awesome. </span> <span class="line" data-startTime="2677">I love the business use case. </span> <span class="line" data-startTime="2679">It's not just like speed </span><span class="line" data-startTime="2679">for speed's sake. </span> <span class="line" data-startTime="2683">Although speed for speed's sake </span><span class="line" data-startTime="2683">is also good, because it </span><span class="line" data-startTime="2685">makes the web faster. </span> <span class="line" data-startTime="2688">So this example, this is </span><span class="line" data-startTime="2688">actually a very common </span><span class="line" data-startTime="2690">question that we see, which is </span><span class="line" data-startTime="2690">many people have already </span><span class="line" data-startTime="2695">applied some optimizations </span><span class="line" data-startTime="2695">to their site. </span> <span class="line" data-startTime="2697">So a good example of that </span><span class="line" data-startTime="2697">is something like domain </span><span class="line" data-startTime="2699">sharding, where the problem is </span><span class="line" data-startTime="2699">that modern browsers allow up </span><span class="line" data-startTime="2704">to six connections per host. </span></p>

<p><span class="line" data-startTime="2706">So if you're hosting a lot of </span><span class="line" data-startTime="2706">images on your domain, you may </span><span class="line" data-startTime="2709">get blocked as you're trying to </span><span class="line" data-startTime="2709">download a lot of images. </span> <span class="line" data-startTime="2711">So the general best practice for </span><span class="line" data-startTime="2711">that is to say, well, host </span><span class="line" data-startTime="2714">it on different subdomains. </span> <span class="line" data-startTime="2715">And then that will allow the </span><span class="line" data-startTime="2715">browser to open multiple </span><span class="line" data-startTime="2719">connections &mdash; </span><span class="line" data-startTime="2720">more than six, I should say. </span> <span class="line" data-startTime="2722">But that creates a little </span><span class="line" data-startTime="2722">bit of complexity for </span><span class="line" data-startTime="2724">mod_pagespeed. </span> <span class="line" data-startTime="2725">This is where you need to </span><span class="line" data-startTime="2725">kind of hand-tune your </span><span class="line" data-startTime="2727">configuration. </span> <span class="line" data-startTime="2728">So can you explain what's </span><span class="line" data-startTime="2728">happening here? </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="2732"><span class="speakerName">Joshua Marantz</span>: Sure. </span> <span class="line" data-startTime="2733">So the challenge is </span><span class="line" data-startTime="2733">that you want to &mdash; </span><span class="line" data-startTime="2742">well, there's a couple </span><span class="line" data-startTime="2742">challenges. </span> <span class="line" data-startTime="2744">So if somebody has hand-sharded </span><span class="line" data-startTime="2744">their domains or, </span><span class="line" data-startTime="2750">in many cases, just done a </span><span class="line" data-startTime="2750">simple best practice of moving </span><span class="line" data-startTime="2753">their resources to cookie-less </span><span class="line" data-startTime="2753">domains, which is all good, </span><span class="line" data-startTime="2758">the first thing that you </span><span class="line" data-startTime="2758">have to do if you want </span><span class="line" data-startTime="2761">mod_pagespeed to be effective </span><span class="line" data-startTime="2761">is you have to let us know </span><span class="line" data-startTime="2764">what those domains are, because </span><span class="line" data-startTime="2764">mod_pagespeed doesn't </span><span class="line" data-startTime="2765">know what the domain </span><span class="line" data-startTime="2765">mapping is. </span> <span class="line" data-startTime="2768">So we have pagespeed.com </span><span class="line" data-startTime="2768">settings to tell us. </span></p>

<p><span class="line" data-startTime="2770">So the first thing you have </span><span class="line" data-startTime="2770">to tell us is what are the </span><span class="line" data-startTime="2772">domains that are basically </span><span class="line" data-startTime="2772">equivalent on your site. </span> <span class="line" data-startTime="2778">And so if you have, like, </span><span class="line" data-startTime="2778">static.example.com, your HTML </span><span class="line" data-startTime="2785">is coming on www.example.com, </span><span class="line" data-startTime="2785">you have to authorize, at </span><span class="line" data-startTime="2788">least with ModPagespeedDomain, </span><span class="line" data-startTime="2788">static.example.com. </span> <span class="line" data-startTime="2794">And if you've done </span><span class="line" data-startTime="2794">hand-sharding, you may have to </span><span class="line" data-startTime="2796">authorize more than one of those </span><span class="line" data-startTime="2796">and tell us that they </span><span class="line" data-startTime="2799">are essentially equivalent by </span><span class="line" data-startTime="2799">mapping them to kind of a </span><span class="line" data-startTime="2802">canonical name. </span></p>

<p class="speaker"><span class="line" data-starttime="2803"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="2803">So if I'm running example.com, </span><span class="line" data-startTime="2803">and I'm serving images from </span><span class="line" data-startTime="2808">example.com, then mod_pagespeed </span><span class="line" data-startTime="2808">would say, yes, </span><span class="line" data-startTime="2811">I know that I'm hosting this. </span><span class="line" data-startTime="2812">Hence, I can optimize </span><span class="line" data-startTime="2812">this asset. </span></p>

<p class="speaker"><span class="line" data-starttime="2814"><span class="speakerName">Joshua Marantz</span>: Exactly. </span></p>

<p class="speaker"><span class="line" data-starttime="2814"><span class="speakerName">Ilya Grigorik</span>: But if I'm </span><span class="line" data-startTime="2814">hosting on a cdn.example.com, </span><span class="line" data-startTime="2817">that could be anywhere, or it </span><span class="line" data-startTime="2817">could be a third-party asset. </span><span class="line" data-startTime="2820">So mod_pagespeed won't touch </span><span class="line" data-startTime="2820">that by default. </span></p>

<p class="speaker"><span class="line" data-starttime="2823"><span class="speakerName">Joshua Marantz</span>: Right. </span> <span class="line" data-startTime="2823">If for example you're serving </span><span class="line" data-startTime="2823">an image on Flickr or </span><span class="line" data-startTime="2827">something, Flickr is not yet </span><span class="line" data-startTime="2827">running mod_pagespeed. </span> <span class="line" data-startTime="2832">And so if you just rewrite the </span><span class="line" data-startTime="2832">URL the way we did with the </span><span class="line" data-startTime="2836">.pagespeed [INAUDIBLE] </span><span class="line" data-startTime="2836">and it's on Flickr, then it </span><span class="line" data-startTime="2836">just won't work, because </span><span class="line" data-startTime="2840">Flickr won't be able to </span><span class="line" data-startTime="2840">decode that name. </span> <span class="line" data-startTime="2843">So we wouldn't necessarily </span><span class="line" data-startTime="2843">authorize that. </span> <span class="line" data-startTime="2849">But if you have images on your </span><span class="line" data-startTime="2849">site that you want to put onto </span><span class="line" data-startTime="2853">a CDN that knows how to reach </span><span class="line" data-startTime="2853">back to your origin, then you </span><span class="line" data-startTime="2857">can do a domain mapping to say, </span><span class="line" data-startTime="2857">I want to take the images </span><span class="line" data-startTime="2863">that are on example.com and put </span><span class="line" data-startTime="2863">them on cdn.example.com. </span> <span class="line" data-startTime="2867">Now when mod_pagespeed rewrites </span><span class="line" data-startTime="2867">that URL, when it </span><span class="line" data-startTime="2871">optimizes the image or the CSS </span><span class="line" data-startTime="2871">file, et cetera, it will </span><span class="line" data-startTime="2874">rewrite the domain to </span><span class="line" data-startTime="2874">go onto the CDN. </span> <span class="line" data-startTime="2876">This is, I think, kind of a </span><span class="line" data-startTime="2876">development feature which </span><span class="line" data-startTime="2880">allows you, for example, </span><span class="line" data-startTime="2880">to develop locally </span><span class="line" data-startTime="2883">and turn that off. </span></p>

<p><span class="line" data-startTime="2884">But then when you're ready to </span><span class="line" data-startTime="2884">actually push resources to the </span><span class="line" data-startTime="2886">CDN, you can turn that on. </span> <span class="line" data-startTime="2889">This also allows you </span><span class="line" data-startTime="2889">to apply sharding. </span> <span class="line" data-startTime="2892">So by establishing the shards, </span><span class="line" data-startTime="2892">if you want to, for example, </span><span class="line" data-startTime="2900">shard two ways, then you can use </span><span class="line" data-startTime="2900">the command that we gave </span><span class="line" data-startTime="2903">here, ModPagespeedShardDomain </span><span class="line" data-startTime="2903">example.com to </span><span class="line" data-startTime="2906">example1, and example2. </span></p>

<p class="speaker"><span class="line" data-starttime="2909"><span class="speakerName">Ilya Grigorik</span>: That's </span><span class="line" data-startTime="2909">the bottom one here. </span></p>

<p class="speaker"><span class="line" data-starttime="2910"><span class="speakerName">Joshua Marantz</span>: And then </span><span class="line" data-startTime="2910">mod_pagespeed will kind of </span><span class="line" data-startTime="2912">randomly disperse the resources </span><span class="line" data-startTime="2912">to those two domains </span><span class="line" data-startTime="2915">so that you can have more </span><span class="line" data-startTime="2915">parallel connections. </span></p>

<p class="speaker"><span class="line" data-starttime="2919"><span class="speakerName">Ilya Grigorik</span>: So this is </span><span class="line" data-startTime="2919">definitely a more advanced use </span><span class="line" data-startTime="2921">case where that's going </span><span class="line" data-startTime="2921">to reach deeper into </span><span class="line" data-startTime="2924">mod_pagespeed and also think </span><span class="line" data-startTime="2924">about how does this work in </span><span class="line" data-startTime="2927">the context of me using a CDN. </span><span class="line" data-startTime="2928">But that in itself is actually </span><span class="line" data-startTime="2928">an important point. </span><span class="line" data-startTime="2931">It is CDN-friendly. </span><span class="line" data-startTime="2933">So you can make it work with </span><span class="line" data-startTime="2933">your CDN provider and help </span><span class="line" data-startTime="2936">your CDN serve optimized </span><span class="line" data-startTime="2936">assets. </span></p>

<p class="speaker"><span class="line" data-starttime="2939"><span class="speakerName">Joshua Marantz</span>: Exactly. </span> <span class="line" data-startTime="2941">And this is something that </span><span class="line" data-startTime="2941">I think it's useful to </span><span class="line" data-startTime="2943">experiment with. </span> <span class="line" data-startTime="2943">One of the things that you </span><span class="line" data-startTime="2943">probably don't want to do is </span><span class="line" data-startTime="2946">try to hand-shard your resources </span><span class="line" data-startTime="2946">in your HTML file, </span><span class="line" data-startTime="2950">because the best practice </span><span class="line" data-startTime="2950">is to shard domains, </span><span class="line" data-startTime="2955">but exactly to what? </span><span class="line" data-startTime="2958">I've seen the right answer be </span><span class="line" data-startTime="2958">four, the right answer be two, </span><span class="line" data-startTime="2961">the right answer can sometimes </span><span class="line" data-startTime="2961">just be one. </span> <span class="line" data-startTime="2963">And so all the effort you do to </span><span class="line" data-startTime="2963">hacking your HTML to edit </span><span class="line" data-startTime="2967">the domains really is kind of </span><span class="line" data-startTime="2967">counter to the notion that you </span><span class="line" data-startTime="2972">want to experiment with it. </span> <span class="line" data-startTime="2973">And you can experiment very </span><span class="line" data-startTime="2973">easily by just iterating over </span><span class="line" data-startTime="2976">your pagespeed.conf file and </span><span class="line" data-startTime="2976">looking at WebPagetest. </span></p>

<p class="speaker"><span class="line" data-starttime="2978"><span class="speakerName">Ilya Grigorik</span>: Yes. </span> <span class="line" data-startTime="2978">That certainly makes </span><span class="line" data-startTime="2978">it a lot easier. </span> <span class="line" data-startTime="2981">Yeah. </span> <span class="line" data-startTime="2982">So we talked about the </span><span class="line" data-startTime="2982">forward proxy. </span> <span class="line" data-startTime="2985">But I recently came across a </span><span class="line" data-startTime="2985">blog post, I think it was </span><span class="line" data-startTime="2988">Frank Denis that wrote this </span><span class="line" data-startTime="2988">really awesome blog post that </span><span class="line" data-startTime="2992">kind of blew me away, because </span><span class="line" data-startTime="2992">what he did was he used </span><span class="line" data-startTime="2996">mod_pagespeed as a forwarding </span><span class="line" data-startTime="2996">proxy for his phone. </span> <span class="line" data-startTime="3000">And the basic observation was </span><span class="line" data-startTime="3000">that when you're on your </span><span class="line" data-startTime="3003">mobile device, you probably </span><span class="line" data-startTime="3003">don't have a Wi-Fi connection </span><span class="line" data-startTime="3008">most of the time. </span> <span class="line" data-startTime="3009">You're in 3G. </span> <span class="line" data-startTime="3009">If you're lucky, you're </span><span class="line" data-startTime="3009">in 4G, what have you. </span></p>

<p><span class="line" data-startTime="3012">And you're downloading these </span><span class="line" data-startTime="3012">massive websites. </span> <span class="line" data-startTime="3015">So instead of using </span><span class="line" data-startTime="3015">mod_pagespeed to accelerate </span><span class="line" data-startTime="3018">your site, why not use </span><span class="line" data-startTime="3018">mod_pagespeed to accelerate </span><span class="line" data-startTime="3020">the rest of the web </span><span class="line" data-startTime="3020">as you fetch it? </span><span class="line" data-startTime="3023">So in this diagram here, </span><span class="line" data-startTime="3023">I have my phone. </span> <span class="line" data-startTime="3025">We're sending a request through </span><span class="line" data-startTime="3025">this forward proxy, </span><span class="line" data-startTime="3028">which is running </span><span class="line" data-startTime="3028">mod_pagespeed. </span> <span class="line" data-startTime="3030">Mod_pagespeed requests the </span><span class="line" data-startTime="3030">actual site that I requested. </span> <span class="line" data-startTime="3033">I get this fat response back </span><span class="line" data-startTime="3033">with all kinds of unoptimized </span><span class="line" data-startTime="3037">images, et cetera. </span> <span class="line" data-startTime="3039">Mod_pagespeed crunches all </span><span class="line" data-startTime="3039">of that and sends me the </span><span class="line" data-startTime="3041">optimized assets, which </span><span class="line" data-startTime="3041">I thought was </span><span class="line" data-startTime="3043">really, really clever. </span></p>

<p><span class="line" data-startTime="3044">So he did this with </span><span class="line" data-startTime="3044">his iPhone. </span> <span class="line" data-startTime="3046">And he observed that for the </span><span class="line" data-startTime="3046">sites that he tested it on, he </span><span class="line" data-startTime="3050">got much faster renders </span><span class="line" data-startTime="3050">and much fewer bytes. </span> <span class="line" data-startTime="3053">And in fact, he shared </span><span class="line" data-startTime="3053">some examples. </span> <span class="line" data-startTime="3057">And we'll take a look </span><span class="line" data-startTime="3057">at those later. </span> <span class="line" data-startTime="3058">But these are the actual </span><span class="line" data-startTime="3058">filters that he used. </span> <span class="line" data-startTime="3061">So he shared those. </span> <span class="line" data-startTime="3062">And some examples that I wanted </span><span class="line" data-startTime="3062">to highlight was first, </span><span class="line" data-startTime="3065">he enabled core filters. </span> <span class="line" data-startTime="3066">So that's kind of by default. </span> <span class="line" data-startTime="3067">But I think he just </span><span class="line" data-startTime="3067">wanted to have it </span><span class="line" data-startTime="3068">in there to be explicit. </span> <span class="line" data-startTime="3070">He said, I'm going to rewrite </span><span class="line" data-startTime="3070">images, convert JPGs to WebP &mdash; </span><span class="line" data-startTime="3073">so he knows that he's accessing </span><span class="line" data-startTime="3073">this on Chrome on </span><span class="line" data-startTime="3078">iOS when he's using that &mdash; </span><span class="line" data-startTime="3080">convert PNG to JPG. </span> <span class="line" data-startTime="3082">And in fact, this is an </span><span class="line" data-startTime="3082">important one that you </span><span class="line" data-startTime="3083">mentioned earlier, when I'm on </span><span class="line" data-startTime="3083">a mobile device, I have a </span><span class="line" data-startTime="3087">small screen. </span></p>

<p><span class="line" data-startTime="3087">I probably don't want 100% </span><span class="line" data-startTime="3087">fidelity of all the pixels. </span> <span class="line" data-startTime="3090">I'm OK with the 75% </span><span class="line" data-startTime="3090">compression ratio. </span> <span class="line" data-startTime="3094">And that gives me a </span><span class="line" data-startTime="3094">lot of savings, </span><span class="line" data-startTime="3096">byte savings for images. </span> <span class="line" data-startTime="3098">So this is kind of an </span><span class="line" data-startTime="3098">interesting example. </span> <span class="line" data-startTime="3099">And he also did a couple of </span><span class="line" data-startTime="3099">aggressive filters, which say </span><span class="line" data-startTime="3103">defer all iframes until after </span><span class="line" data-startTime="3103">onload and other things, just </span><span class="line" data-startTime="3107">to accelerate his browsing. </span></p>

<p class="speaker"><span class="line" data-starttime="3110"><span class="speakerName">Joshua Marantz</span>: Yes. </span><span class="line" data-startTime="3111">And pointing out, in particular, </span><span class="line" data-startTime="3111">defer JavaScript </span><span class="line" data-startTime="3114">has a huge impact on the </span><span class="line" data-startTime="3114">speed of websites. </span><span class="line" data-startTime="3117">It's something that you want </span><span class="line" data-startTime="3117">to look at the results </span><span class="line" data-startTime="3120">of when you do it. </span><span class="line" data-startTime="3123">It was aggressive to put it into </span><span class="line" data-startTime="3123">a forward proxy, but he </span><span class="line" data-startTime="3126">was extremely happy </span><span class="line" data-startTime="3126">having done it. </span></p>

<p class="speaker"><span class="line" data-starttime="3128"><span class="speakerName">Ilya Grigorik</span>: Right. </span> <span class="line" data-startTime="3128">Yeah. </span> <span class="line" data-startTime="3128">And these are some examples. </span> <span class="line" data-startTime="3129">So of course, this is not </span><span class="line" data-startTime="3129">representative of the entire </span><span class="line" data-startTime="3132">web, but he kind of </span><span class="line" data-startTime="3132">highlighted a few. </span> <span class="line" data-startTime="3135">So for example, this over-blog </span><span class="line" data-startTime="3135">URL, it went from 400 </span><span class="line" data-startTime="3139">kilobytes to 271, which </span><span class="line" data-startTime="3139">is pretty significant. </span> <span class="line" data-startTime="3144">Going from 39 seconds of onloads </span><span class="line" data-startTime="3144">to 2 seconds is a big </span><span class="line" data-startTime="3148">improvement. </span> <span class="line" data-startTime="3149">And not only that, but you can </span><span class="line" data-startTime="3149">see that because he was </span><span class="line" data-startTime="3152">combining resources, it </span><span class="line" data-startTime="3152">went from 34 to 21. </span> <span class="line" data-startTime="3155">So the mobile browser had </span><span class="line" data-startTime="3155">to make fewer requests. </span> <span class="line" data-startTime="3158">All of those things are a win. </span> <span class="line" data-startTime="3160">And he got a better </span><span class="line" data-startTime="3160">mobile experience. </span> <span class="line" data-startTime="3163">Now this next one just kind of </span><span class="line" data-startTime="3163">completely blew me away, </span><span class="line" data-startTime="3166">because I didn't believe it. </span> <span class="line" data-startTime="3167">But it serves as </span><span class="line" data-startTime="3167">a good example. </span> <span class="line" data-startTime="3169">Cooking With Frank. </span></p>

<p><span class="line" data-startTime="3170">So this is a blog, </span><span class="line" data-startTime="3170">lots of pictures. </span> <span class="line" data-startTime="3172">And guess what? </span><span class="line" data-startTime="3174">The unoptimized version </span><span class="line" data-startTime="3174">is 3.15 megs. </span> <span class="line" data-startTime="3179">With compression, it comes </span><span class="line" data-startTime="3179">out to be 10 times </span><span class="line" data-startTime="3181">smaller, 340 kilobytes. </span> <span class="line" data-startTime="3183">So when I'm on my mobile data </span><span class="line" data-startTime="3183">plan, I probably want the 340 </span><span class="line" data-startTime="3187">kilobyte version. </span> <span class="line" data-startTime="3189">It'll load much faster. </span> <span class="line" data-startTime="3191">Instead of making 85 requests, </span><span class="line" data-startTime="3191">it made 28 requests. </span> <span class="line" data-startTime="3193">So this is a dramatic </span><span class="line" data-startTime="3193">difference. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="3195"><span class="speakerName">Joshua Marantz</span>: Yeah. </span><span class="line" data-startTime="3196">We're still learning exactly </span><span class="line" data-startTime="3196">what works really well on what </span><span class="line" data-startTime="3198">kind of mobile device and </span><span class="line" data-startTime="3198">what kind of connection. </span><span class="line" data-startTime="3202">But it seems likely that having </span><span class="line" data-startTime="3202">a lot less requests </span><span class="line" data-startTime="3206">will benefit mobile even more </span><span class="line" data-startTime="3206">than it will benefit desktop. </span></p>

<p class="speaker"><span class="line" data-starttime="3209"><span class="speakerName">Ilya Grigorik</span>: Yeah. </span> <span class="line" data-startTime="3209">So this, in general, seems like </span><span class="line" data-startTime="3209">a very interesting area </span><span class="line" data-startTime="3213">to explore for mod_pagespeed, </span><span class="line" data-startTime="3213">like I want this on my phone. </span> <span class="line" data-startTime="3220">So just a quick recap. </span> <span class="line" data-startTime="3221">We've covered a lot </span><span class="line" data-startTime="3221">of stuff here. </span> <span class="line" data-startTime="3223">So we talked about the </span><span class="line" data-startTime="3223">upcoming 1.0 release. </span> <span class="line" data-startTime="3226">It's an open-source </span><span class="line" data-startTime="3226">Apache module. </span> <span class="line" data-startTime="3228">It works with 2.2 and 2.4. </span> <span class="line" data-startTime="3231">Kind of the pitch, if you </span><span class="line" data-startTime="3231">will, is just-in-time </span><span class="line" data-startTime="3233">performance optimization </span><span class="line" data-startTime="3233">for your website. </span> <span class="line" data-startTime="3236">And it's already very widely </span><span class="line" data-startTime="3236">deployed across the web. </span></p>

<p><span class="line" data-startTime="3243">So we feel it's 1.0 ready. </span> <span class="line" data-startTime="3245">It's 1.0 ready by Google </span><span class="line" data-startTime="3245">standards, which </span><span class="line" data-startTime="3247">is perpetual beta. </span> <span class="line" data-startTime="3249">So that says a lot. </span> <span class="line" data-startTime="3251">But one question I do have for </span><span class="line" data-startTime="3251">you is, what's after 1.0? </span><span class="line" data-startTime="3255">Are we done? </span></p>

<p class="speaker"><span class="line" data-starttime="3257"><span class="speakerName">Joshua Marantz</span>: I feel </span><span class="line" data-startTime="3257">like we're at the </span><span class="line" data-startTime="3258">beginning of this process. </span><span class="line" data-startTime="3261">We've definitely discovered </span><span class="line" data-startTime="3261">that there is some meat to </span><span class="line" data-startTime="3265">chew on here. </span><span class="line" data-startTime="3267">There's a lot more </span><span class="line" data-startTime="3267">that we can do. </span><span class="line" data-startTime="3271">SPDY is an obvious topic. </span><span class="line" data-startTime="3275">The rules change when you're </span><span class="line" data-startTime="3275">working with SPDY. </span><span class="line" data-startTime="3277">Combining becomes less </span><span class="line" data-startTime="3277">important, because you can </span><span class="line" data-startTime="3280">multiplex multiple resources </span><span class="line" data-startTime="3280">over the same connection. </span><span class="line" data-startTime="3283">Inlining becomes </span><span class="line" data-startTime="3283">less important. </span></p>

<p class="speaker"><span class="line" data-starttime="3285"><span class="speakerName">Ilya Grigorik</span>: Same </span><span class="line" data-startTime="3285">reason, right? </span></p>

<p class="speaker"><span class="line" data-starttime="3288"><span class="speakerName">Joshua Marantz</span>: In the release </span><span class="line" data-startTime="3288">that is coming after the 1.0 </span><span class="line" data-startTime="3292">release, we'll start seeing </span><span class="line" data-startTime="3292">some of the deeper SPDY </span><span class="line" data-startTime="3296">integration. </span> <span class="line" data-startTime="3297">So Google also has a module </span><span class="line" data-startTime="3297">called mod_spdy, which we work </span><span class="line" data-startTime="3303">pretty well with. </span> <span class="line" data-startTime="3306">And look for more </span><span class="line" data-startTime="3306">in that space. </span> <span class="line" data-startTime="3313">I would say the big wins that </span><span class="line" data-startTime="3313">we have right now, images; </span><span class="line" data-startTime="3317">extending cache lifetime, which </span><span class="line" data-startTime="3317">is something that really </span><span class="line" data-startTime="3321">benefits repeat viewers to </span><span class="line" data-startTime="3321">things like news sites; </span><span class="line" data-startTime="3326">deferring JavaScript. </span> <span class="line" data-startTime="3328">There's kind of other big areas </span><span class="line" data-startTime="3328">where we're more aware </span><span class="line" data-startTime="3332">of the networking </span><span class="line" data-startTime="3332">characteristics of the page </span><span class="line" data-startTime="3334">and we're optimizing. </span> <span class="line" data-startTime="3338">I feel like we're relatively </span><span class="line" data-startTime="3338">early in our understanding. </span> <span class="line" data-startTime="3344">We've found a lot of </span><span class="line" data-startTime="3344">good things to do. </span> <span class="line" data-startTime="3346">But when we find good things to </span><span class="line" data-startTime="3346">do, it usually uncovers 10 </span><span class="line" data-startTime="3349">more that we don't have </span><span class="line" data-startTime="3349">time to do yet. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="3350"><span class="speakerName">Ilya Grigorik</span>: Yeah. </span><span class="line" data-startTime="3351">So I think that's very </span><span class="line" data-startTime="3351">representative of the web </span><span class="line" data-startTime="3354">performance community </span><span class="line" data-startTime="3354">in general. </span><span class="line" data-startTime="3356">I think we're still finding a </span><span class="line" data-startTime="3356">lot of interesting edge cases. </span><span class="line" data-startTime="3359">And the browsers are only </span><span class="line" data-startTime="3359">getting smarter. </span><span class="line" data-startTime="3361">We're only getting more and </span><span class="line" data-startTime="3361">more assets on the web. </span><span class="line" data-startTime="3363">So in fact, we know that the web </span><span class="line" data-startTime="3363">pages are growing, both in </span><span class="line" data-startTime="3366">size and number of requests. </span><span class="line" data-startTime="3368">So it sounds like there's </span><span class="line" data-startTime="3368">a lot of work to do. </span></p>

<p class="speaker"><span class="line" data-starttime="3372"><span class="speakerName">Joshua Marantz</span>: There's </span><span class="line" data-startTime="3372">an astounding </span><span class="line" data-startTime="3373">amount of work to do. </span><span class="line" data-startTime="3374">But I think that we've come to </span><span class="line" data-startTime="3374">a point now where we have a </span><span class="line" data-startTime="3379">stake in the ground where we </span><span class="line" data-startTime="3379">have demonstrable benefit. </span><span class="line" data-startTime="3382">We have adoption. </span><span class="line" data-startTime="3384">And we'd like to grow it. </span><span class="line" data-startTime="3385">And we're ready to take </span><span class="line" data-startTime="3385">off from here. </span></p>

<p class="speaker"><span class="line" data-starttime="3387"><span class="speakerName">Ilya Grigorik</span>: So I'm glad that </span><span class="line" data-startTime="3387">you guys are doing it, </span><span class="line" data-startTime="3388">because that makes my life </span><span class="line" data-startTime="3388">a little bit easier. </span><span class="line" data-startTime="3390">I can install this and inherit </span><span class="line" data-startTime="3390">all of the work that you've </span><span class="line" data-startTime="3393">put into this. </span><span class="line" data-startTime="3394">So I think for the last </span><span class="line" data-startTime="3394">slide here, we've </span><span class="line" data-startTime="3397">covered some of these. </span><span class="line" data-startTime="3399">But I want to highlight these, </span><span class="line" data-startTime="3399">because I get these questions </span><span class="line" data-startTime="3401">quite frequently on Stack </span><span class="line" data-startTime="3401">Overflow, through email, and </span><span class="line" data-startTime="3403">through other means. </span><span class="line" data-startTime="3404">So I kind of bucketed them. </span><span class="line" data-startTime="3406">We already talked about </span><span class="line" data-startTime="3406">mod_deflate, mod_expires. </span><span class="line" data-startTime="3410">So those work together </span><span class="line" data-startTime="3410">with mod_pagespeed. </span></p>

<p class="speaker"><span class="line" data-starttime="3413"><span class="speakerName">Joshua Marantz</span>: That's right. </span> <span class="line" data-startTime="3414">In fact, mod_pagespeed </span><span class="line" data-startTime="3414">turns mod_deflate on. </span> <span class="line" data-startTime="3417">And it's kind of dependent on </span><span class="line" data-startTime="3417">mod_expires, because we have </span><span class="line" data-startTime="3420">to know how often to pull </span><span class="line" data-startTime="3420">the origin resource. </span> <span class="line" data-startTime="3424">And you definitely want to </span><span class="line" data-startTime="3424">put an expires header. </span> <span class="line" data-startTime="3426">You want to use that. </span> <span class="line" data-startTime="3428">Tell us how often to check back </span><span class="line" data-startTime="3428">to see if your resource </span><span class="line" data-startTime="3431">has updated. </span> <span class="line" data-startTime="3432">Actually, I just want to point </span><span class="line" data-startTime="3432">out one other thing. </span> <span class="line" data-startTime="3434">Mod_pagespeed can also look </span><span class="line" data-startTime="3434">directly at the file system, </span><span class="line" data-startTime="3437">in which case it can just stat </span><span class="line" data-startTime="3437">the file to see if it's </span><span class="line" data-startTime="3439">changed, which is a little bit </span><span class="line" data-startTime="3439">more efficient if your files </span><span class="line" data-startTime="3444">are right there on the same </span><span class="line" data-startTime="3444">server, as opposed to being </span><span class="line" data-startTime="3447">generated by PHP or pulled </span><span class="line" data-startTime="3447">from somewhere else. </span></p>

<p class="speaker"><span class="line" data-starttime="3449"><span class="speakerName">Ilya Grigorik</span>: Actually, </span><span class="line" data-startTime="3449">that's a good point. </span><span class="line" data-startTime="3450">That's another config flag </span><span class="line" data-startTime="3450">that you can find in our </span><span class="line" data-startTime="3452">documentation. </span></p>

<p class="speaker"><span class="line" data-starttime="3452"><span class="speakerName">Joshua Marantz</span>: That's </span><span class="line" data-startTime="3452">correct. </span><span class="line" data-startTime="3453">So that's mod_pagespeed </span><span class="line" data-startTime="3453">load from file. </span><span class="line" data-startTime="3455">And I think that if the files </span><span class="line" data-startTime="3455">are there on your disk, just </span><span class="line" data-startTime="3458">get mod_pagespeed to look </span><span class="line" data-startTime="3458">at them directly. </span><span class="line" data-startTime="3460">But if they're not and we have </span><span class="line" data-startTime="3460">to do a fetch to get them, </span><span class="line" data-startTime="3463">then you definitely want to use </span><span class="line" data-startTime="3463">mod_expires to tell us how </span><span class="line" data-startTime="3466">often to do that fetch. </span></p>

<p class="speaker"><span class="line" data-starttime="3467"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="3467">OK. </span><span class="line" data-startTime="3469">For the CDN , I think we've </span><span class="line" data-startTime="3469">covered a little bit. </span></p>

<p class="speaker"><span class="line" data-starttime="3472"><span class="speakerName">Joshua Marantz</span>: Yeah. </span><span class="line" data-startTime="3472">We covered it. </span><span class="line" data-startTime="3473">CDNs are driven by the </span><span class="line" data-startTime="3473">cachability of resources we </span><span class="line" data-startTime="3478">make things cachable </span><span class="line" data-startTime="3478">for a year. </span></p>

<p class="speaker"><span class="line" data-starttime="3480"><span class="speakerName">Ilya Grigorik</span>: Which also, </span><span class="line" data-startTime="3480">I think, answers the next </span><span class="line" data-startTime="3481">question which is, if you're </span><span class="line" data-startTime="3481">using a CDN &mdash; or maybe if </span><span class="line" data-startTime="3483">you're not using a CDN, rather, </span><span class="line" data-startTime="3483">but you are using </span><span class="line" data-startTime="3486">another cache in front, maybe a </span><span class="line" data-startTime="3486">Squid, a Varnish, what have </span><span class="line" data-startTime="3489">you, maybe Nginx, those should </span><span class="line" data-startTime="3489">still work, right? </span></p>

<p class="speaker"><span class="line" data-starttime="3492"><span class="speakerName">Joshua Marantz</span>: Exactly. </span></p>

<p class="speaker"><span class="line" data-starttime="3493"><span class="speakerName">Ilya Grigorik</span>: They'd just </span><span class="line" data-startTime="3493">be more efficient. </span></p>

<p class="speaker"><span class="line" data-starttime="3495"><span class="speakerName">Joshua Marantz</span>: Exactly. </span><span class="line" data-startTime="3495">They'll just have to pull </span><span class="line" data-startTime="3495">the origin less often. </span></p>

<p class="speaker"><span class="line" data-starttime="3498"><span class="speakerName">Ilya Grigorik</span>: Yeah. </span><span class="line" data-startTime="3498">OK. </span><span class="line" data-startTime="3498">Perfect. </span><span class="line" data-startTime="3499">So we talked about or </span><span class="line" data-startTime="3499">we mentioned the </span><span class="line" data-startTime="3503">mod_pagespeed cache. </span><span class="line" data-startTime="3505">So mod_pagespeed has </span><span class="line" data-startTime="3505">its own cache. </span><span class="line" data-startTime="3506">We talked about the </span><span class="line" data-startTime="3506">upcoming memcache. </span><span class="line" data-startTime="3509">But as a developer, do I need </span><span class="line" data-startTime="3509">to worry about that? </span><span class="line" data-startTime="3512">So if I have my assets &mdash; </span><span class="line" data-startTime="3513">and who manages that? </span><span class="line" data-startTime="3515">If I update my asset, do I need </span><span class="line" data-startTime="3515">to worry about flushing </span><span class="line" data-startTime="3518">the cache, et cetera? </span></p>

<p class="speaker"><span class="line" data-starttime="3520"><span class="speakerName">Joshua Marantz</span>: So mod_pagespeed </span><span class="line" data-startTime="3520">comes </span><span class="line" data-startTime="3523">pre-configured to use the </span><span class="line" data-startTime="3523">file system as a cache. </span><span class="line" data-startTime="3527">And that works reasonably </span><span class="line" data-startTime="3527">well. </span><span class="line" data-startTime="3530">As you scale up websites, you </span><span class="line" data-startTime="3530">have to think a little bit. </span><span class="line" data-startTime="3535">We set the default cache, I </span><span class="line" data-startTime="3535">think, at 100 megabytes. </span><span class="line" data-startTime="3538">Is that enough for </span><span class="line" data-startTime="3538">your assets? </span><span class="line" data-startTime="3539">Or do you want to </span><span class="line" data-startTime="3539">make that grow? </span></p>

<p class="speaker"><span class="line" data-starttime="3540"><span class="speakerName">Ilya Grigorik</span>: So it's something </span><span class="line" data-startTime="3540">you can probably </span><span class="line" data-startTime="3541">tweak in the configuration. </span></p>

<p class="speaker"><span class="line" data-starttime="3542"><span class="speakerName">Joshua Marantz</span>: That's another </span><span class="line" data-startTime="3542">configuration parameter. </span><span class="line" data-startTime="3544">How often we go and garbage </span><span class="line" data-startTime="3544">collect that </span><span class="line" data-startTime="3547">cache is another question. </span><span class="line" data-startTime="3548">So when you change your assets, </span><span class="line" data-startTime="3548">you don't have to </span><span class="line" data-startTime="3549">manually purge the cache. </span><span class="line" data-startTime="3551">Mod_pagespeed will just </span><span class="line" data-startTime="3551">do it automatically. </span></p>

<p class="speaker"><span class="line" data-starttime="3553"><span class="speakerName">Ilya Grigorik</span>: And that was </span><span class="line" data-startTime="3553">actually that file name kind </span><span class="line" data-startTime="3555">of scheme that we looked </span><span class="line" data-startTime="3555">at earlier, right? </span></p>

<p class="speaker"><span class="line" data-starttime="3559"><span class="speakerName">Joshua Marantz</span>: Yeah. </span><span class="line" data-startTime="3559">Well, the files on the cache </span><span class="line" data-startTime="3559">have recognizable names. </span><span class="line" data-startTime="3564">But they're not exactly </span><span class="line" data-startTime="3564">that scheme. </span><span class="line" data-startTime="3568">But the hierarchy of your URL </span><span class="line" data-startTime="3568">space for your assets is </span><span class="line" data-startTime="3573">reflected in the cache. </span><span class="line" data-startTime="3574">So you can kind of poke around </span><span class="line" data-startTime="3574">the cache and see </span><span class="line" data-startTime="3576">what we have in there. </span><span class="line" data-startTime="3577">And you can just delete it. </span><span class="line" data-startTime="3578">They're just files. </span></p>

<p class="speaker"><span class="line" data-starttime="3579"><span class="speakerName">Ilya Grigorik</span>: But it sounds </span><span class="line" data-startTime="3579">like generally speaking, I </span><span class="line" data-startTime="3581">shouldn't be touching them. </span></p>

<p class="speaker"><span class="line" data-starttime="3582"><span class="speakerName">Joshua Marantz</span>: But you don't </span><span class="line" data-startTime="3582">really need to touch it. </span><span class="line" data-startTime="3583">You can just configure how big </span><span class="line" data-startTime="3583">you want it to be and how </span><span class="line" data-startTime="3585">often you think we should </span><span class="line" data-startTime="3585">go and purge it. </span></p>

<p class="speaker"><span class="line" data-starttime="3587"><span class="speakerName">Ilya Grigorik</span>: Perfect. </span></p>

<p class="speaker"><span class="line" data-starttime="3589"><span class="speakerName">Joshua Marantz</span>: And upcoming, </span><span class="line" data-startTime="3589">you'll be able to say, well, </span><span class="line" data-startTime="3593">instead of storing the files on </span><span class="line" data-startTime="3593">the disk, I want to store </span><span class="line" data-startTime="3596">them in memcache. </span><span class="line" data-startTime="3597">And here are the host </span><span class="line" data-startTime="3597">and port numbers </span><span class="line" data-startTime="3599">of my memcache instances. </span><span class="line" data-startTime="3601">And then you can share that </span><span class="line" data-startTime="3601">cache among multiple servers </span><span class="line" data-startTime="3605">so that you can scale up your </span><span class="line" data-startTime="3605">website a little bit better. </span></p>

<p class="speaker"><span class="line" data-starttime="3607"><span class="speakerName">Ilya Grigorik</span>: Yeah. </span> <span class="line" data-startTime="3607">That's very cool. </span> <span class="line" data-startTime="3609">So we actually talked about </span><span class="line" data-startTime="3609">affecting or not affecting the </span><span class="line" data-startTime="3613">page load time when the </span><span class="line" data-startTime="3613">cache is empty. </span> <span class="line" data-startTime="3615">So that was that if we don't </span><span class="line" data-startTime="3615">have the image resource </span><span class="line" data-startTime="3618">optimized, we will just serve </span><span class="line" data-startTime="3618">the original image. </span> <span class="line" data-startTime="3620">But on the next hit, you will </span><span class="line" data-startTime="3620">get the optimized resource. </span> <span class="line" data-startTime="3623">So as you said, the last thing </span><span class="line" data-startTime="3623">that mod_pagespeed wants to do </span><span class="line" data-startTime="3627">is to make your site slower. </span> <span class="line" data-startTime="3629">That would be the </span><span class="line" data-startTime="3629">anti-pattern. </span> <span class="line" data-startTime="3631">So that should never happen. </span> <span class="line" data-startTime="3633">But I'm guessing all </span><span class="line" data-startTime="3633">of this work does </span><span class="line" data-startTime="3636">consume some resources. </span> <span class="line" data-startTime="3637">So what should we expect? </span><span class="line" data-startTime="3639">If I install this on my </span><span class="line" data-startTime="3639">server is there kind </span><span class="line" data-startTime="3642">of an average number? </span><span class="line" data-startTime="3643">Does it really vary based on </span><span class="line" data-startTime="3643">the site, because it seems </span><span class="line" data-startTime="3645">like it would, right? </span></p>

<p class="speaker"><span class="line" data-starttime="3646"><span class="speakerName">Joshua Marantz</span>: Sure. </span><span class="line" data-startTime="3647">A very image-rich site that </span><span class="line" data-startTime="3647">installs mod_pagespeed for the </span><span class="line" data-startTime="3650">first time will go through </span><span class="line" data-startTime="3650">a period where we'll use </span><span class="line" data-startTime="3654">resources on the server to </span><span class="line" data-startTime="3654">optimize the images. </span><span class="line" data-startTime="3658">There will be a bounded </span><span class="line" data-startTime="3658">amount of resources. </span><span class="line" data-startTime="3661">This is actually another config </span><span class="line" data-startTime="3661">parameter that you can </span><span class="line" data-startTime="3664">set, because we don't know </span><span class="line" data-startTime="3664">exactly how many CPUs you have </span><span class="line" data-startTime="3668">or anything. </span><span class="line" data-startTime="3669">But by default, we will do, I </span><span class="line" data-startTime="3669">believe, eight concurrent </span><span class="line" data-startTime="3673">image optimizations maximum </span><span class="line" data-startTime="3673">per physical machine. </span></p>

<p class="speaker"><span class="line" data-starttime="3678"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="3678">So it's like background workers </span><span class="line" data-startTime="3679">optimizing these images. </span></p>

<p class="speaker"><span class="line" data-starttime="3681"><span class="speakerName">Joshua Marantz</span>: And </span><span class="line" data-startTime="3681">that's across all </span><span class="line" data-startTime="3681">of the Apache processes. </span><span class="line" data-startTime="3687">And so it doesn't just fan out </span><span class="line" data-startTime="3687">arbitrarily until it kills </span><span class="line" data-startTime="3692">your machine. </span></p>

<p class="speaker"><span class="line" data-starttime="3693"><span class="speakerName">Ilya Grigorik</span>: Right. </span><span class="line" data-startTime="3693">That would be an anti-pattern. </span></p>

<p class="speaker"><span class="line" data-starttime="3694"><span class="speakerName">Joshua Marantz</span>: Yes. </span><span class="line" data-startTime="3694">That would be another </span><span class="line" data-startTime="3694">anti-pattern for serving your </span><span class="line" data-startTime="3696">resources efficiently. </span><span class="line" data-startTime="3698">But what will happen is if you </span><span class="line" data-startTime="3698">have a page full of images, </span><span class="line" data-startTime="3703">and the first time somebody </span><span class="line" data-startTime="3703">goes to them, we'll start </span><span class="line" data-startTime="3704">spinning up the optimization </span><span class="line" data-startTime="3704">of those, once those are in </span><span class="line" data-startTime="3707">cache, that'll settle </span><span class="line" data-startTime="3707">back down. </span><span class="line" data-startTime="3709">So there will be typically </span><span class="line" data-startTime="3709">be a few minutes &mdash; </span><span class="line" data-startTime="3713">it would vary on the site &mdash; </span><span class="line" data-startTime="3714">of where all these images get </span><span class="line" data-startTime="3714">optimized, put into the cache, </span><span class="line" data-startTime="3718">and then you're good to go. </span><span class="line" data-startTime="3719">If the cache is too small, </span><span class="line" data-startTime="3719">then it might be ongoing. </span></p>

<p class="speaker"><span class="line" data-starttime="3722"><span class="speakerName">Ilya Grigorik</span>: So the most part, </span><span class="line" data-startTime="3722">if your website doesn't </span><span class="line" data-startTime="3725">change dramatically every couple </span><span class="line" data-startTime="3725">of minutes, chances are </span><span class="line" data-startTime="3729">your visitors will be just </span><span class="line" data-startTime="3729">hitting the cache. </span><span class="line" data-startTime="3730">And you would only see this </span><span class="line" data-startTime="3730">extra work being done when you </span><span class="line" data-startTime="3733">have new assets or, for whatever </span><span class="line" data-startTime="3733">reason, that asset </span><span class="line" data-startTime="3738">got evicted from the cache. </span></p>

<p class="speaker"><span class="line" data-starttime="3740"><span class="speakerName">Joshua Marantz</span>: Right. </span></p>

<p class="speaker"><span class="line" data-starttime="3740"><span class="speakerName">Ilya Grigorik</span>: And that's where </span><span class="line" data-startTime="3740">you may want to go back </span><span class="line" data-startTime="3742">and configure or check, is </span><span class="line" data-startTime="3742">your cache being used up? </span><span class="line" data-startTime="3746">Maybe you should increase </span><span class="line" data-startTime="3746">the size or </span><span class="line" data-startTime="3747">something to that extent. </span></p>

<p class="speaker"><span class="line" data-starttime="3748"><span class="speakerName">Joshua Marantz</span>: This is probably </span><span class="line" data-startTime="3748">also a good time to </span><span class="line" data-startTime="3750">point out that mod_pagespeed </span><span class="line" data-startTime="3750">offers some visibility into </span><span class="line" data-startTime="3753">what it's doing, because it </span><span class="line" data-startTime="3753">has a statistics page. </span><span class="line" data-startTime="3757">So on the local server, you </span><span class="line" data-startTime="3757">can go to mod_pagespeed </span><span class="line" data-startTime="3760">statistics, which by default </span><span class="line" data-startTime="3760">is accessible </span><span class="line" data-startTime="3762">only from local host. </span><span class="line" data-startTime="3765">But you can configure </span><span class="line" data-startTime="3765">that too. </span><span class="line" data-startTime="3767">And then you'll see how many </span><span class="line" data-startTime="3767">image rewrites are going on. </span><span class="line" data-startTime="3774">You'll see a variety of </span><span class="line" data-startTime="3774">statistics, which kind of give </span><span class="line" data-startTime="3776">you a way to put your finger on </span><span class="line" data-startTime="3776">the pulse of mod_pagespeed. </span></p>

<p class="speaker"><span class="line" data-starttime="3780"><span class="speakerName">Ilya Grigorik</span>: So I'm guessing </span><span class="line" data-startTime="3780">if I'm using some monitoring </span><span class="line" data-startTime="3781">system, I could probably get </span><span class="line" data-startTime="3781">the variables out of there, </span><span class="line" data-startTime="3784">shove it into Ganglia or some </span><span class="line" data-startTime="3784">other system, and track all </span><span class="line" data-startTime="3788">that performance </span><span class="line" data-startTime="3788">there as well. </span></p>

<p class="speaker"><span class="line" data-starttime="3789"><span class="speakerName">Joshua Marantz</span>: It's </span><span class="line" data-startTime="3789">very scrape-able. </span><span class="line" data-startTime="3790">And in fact, I think very soon </span><span class="line" data-startTime="3790">after mod_pagespeed was </span><span class="line" data-startTime="3792">released people started to say, </span><span class="line" data-startTime="3792">well, I've hooked this up </span><span class="line" data-startTime="3794">to this visualization system, </span><span class="line" data-startTime="3794">and here's what it's doing. </span></p>

<p class="speaker"><span class="line" data-starttime="3797"><span class="speakerName">Ilya Grigorik</span>: That's the first </span><span class="line" data-startTime="3797">thing that I would look </span><span class="line" data-startTime="3798">for as well. </span><span class="line" data-startTime="3798">That makes perfect sense. </span><span class="line" data-startTime="3800">So shifting gears a little bit, </span><span class="line" data-startTime="3800">we didn't specifically </span><span class="line" data-startTime="3804">talk about mobile, with the </span><span class="line" data-startTime="3804">exception, I guess, of the </span><span class="line" data-startTime="3806">forward proxy. </span><span class="line" data-startTime="3807">But is there anything in </span><span class="line" data-startTime="3807">particular that we need to be </span><span class="line" data-startTime="3810">aware about for mobile </span><span class="line" data-startTime="3810">and mod_pagespeed? </span></p>

<p class="speaker"><span class="line" data-starttime="3815"><span class="speakerName">Joshua Marantz</span>: Mod_pagespeed, </span><span class="line" data-startTime="3815">this is actually one of the </span><span class="line" data-startTime="3817">areas where I think we can do </span><span class="line" data-startTime="3817">a lot more in the future. </span><span class="line" data-startTime="3819">But we're already providing a </span><span class="line" data-startTime="3819">substantial benefit, making </span><span class="line" data-startTime="3823">things smaller and </span><span class="line" data-startTime="3823">less requests. </span><span class="line" data-startTime="3825">It's all good. </span></p>

<p class="speaker"><span class="line" data-starttime="3826"><span class="speakerName">Ilya Grigorik</span>: It's images. </span><span class="line" data-startTime="3826">We saw that, right? </span></p>

<p class="speaker"><span class="line" data-starttime="3827"><span class="speakerName">Joshua Marantz</span>: It's all good. </span><span class="line" data-startTime="3828">What Frank Denis did was </span><span class="line" data-startTime="3828">he cranked the quality </span><span class="line" data-startTime="3832">level down to 75. </span><span class="line" data-startTime="3834">Typically, we would recommend </span><span class="line" data-startTime="3834">if you want to do this for </span><span class="line" data-startTime="3837">desktop, we would say 85 </span><span class="line" data-startTime="3837">is a very safe number. </span><span class="line" data-startTime="3841">But for mobile, you might want </span><span class="line" data-startTime="3841">to crank it down further. </span><span class="line" data-startTime="3848">I can't think of anything that </span><span class="line" data-startTime="3848">mod_pagespeed does that would </span><span class="line" data-startTime="3851">be undesirable for mobile. </span><span class="line" data-startTime="3852">I think it's all good. </span></p>

<p class="speaker"><span class="line" data-starttime="3855"><span class="speakerName">Ilya Grigorik</span>: Smaller </span><span class="line" data-startTime="3855">resources, fewer requests, all </span><span class="line" data-startTime="3858">of those things are prime </span><span class="line" data-startTime="3858">candidates for improving </span><span class="line" data-startTime="3861">mobile performance. </span></p>

<p class="speaker"><span class="line" data-starttime="3862"><span class="speakerName">Joshua Marantz</span>: The </span><span class="line" data-startTime="3862">only question, is </span><span class="line" data-startTime="3863">there more we can do? </span><span class="line" data-startTime="3864">And the answer is absolutely. </span><span class="line" data-startTime="3867">Stay tuned. </span></p>

<p class="speaker"><span class="line" data-starttime="3868"><span class="speakerName">Ilya Grigorik</span>: Right. </span> <span class="line" data-startTime="3868">I think that's a good note </span><span class="line" data-startTime="3868">to kind of end this on. </span> <span class="line" data-startTime="3872">I'll just mention that we do </span><span class="line" data-startTime="3872">have a lot of online resources </span><span class="line" data-startTime="3876">about mod_pagespeed, if we </span><span class="line" data-startTime="3876">didn't answer your question. </span> <span class="line" data-startTime="3878">So good places to start </span><span class="line" data-startTime="3878">are modpagespeed.com. </span> <span class="line" data-startTime="3881">I think there's actually links </span><span class="line" data-startTime="3881">to the Google Group, the issue </span><span class="line" data-startTime="3883">list, and demos there. </span> <span class="line" data-startTime="3885">So that's a great place to </span><span class="line" data-startTime="3885">kind of kick off your </span><span class="line" data-startTime="3888">exploration. </span> <span class="line" data-startTime="3889">We do have a Google Group where </span><span class="line" data-startTime="3889">you can ask questions. </span> <span class="line" data-startTime="3892">And of course, you can also just </span><span class="line" data-startTime="3892">reach out to myself or </span><span class="line" data-startTime="3894">Josh, and we will be happy </span><span class="line" data-startTime="3894">to answer any questions. </span> <span class="line" data-startTime="3898">So thank you, guys. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="3899"><span class="speakerName">Joshua Marantz</span>: Thanks. </span></p></div>