<p class="speaker"><span class="line" data-starttime="6"><span class="speakerName">Seth Ladd</span>: OK, we are live. </span><span class="line" data-startTime="7">Here we are, special episode </span><span class="line" data-startTime="7">of "Dartisans," with Dart </span><span class="line" data-startTime="11">engineer Nicolas Geoffray. </span><span class="line" data-startTime="12">Hello, Nicolas. </span></p>

<p class="speaker"><span class="line" data-starttime="13"><span class="speakerName">Nicolas Geoffray</span>: Hello. </span></p>

<p class="speaker"><span class="line" data-starttime="15"><span class="speakerName">Seth Ladd</span>: Now where </span><span class="line" data-startTime="15">are you today? </span></p>

<p class="speaker"><span class="line" data-starttime="16"><span class="speakerName">Nicolas Geoffray</span>: I'm hanging </span><span class="line" data-startTime="16">out in Zurich. </span></p>

<p class="speaker"><span class="line" data-starttime="19"><span class="speakerName">Seth Ladd</span>: This is awesome. </span><span class="line" data-startTime="20">So you look like you're </span><span class="line" data-startTime="20">in a little car. </span><span class="line" data-startTime="21">Where are you? </span></p>

<p class="speaker"><span class="line" data-starttime="24"><span class="speakerName">Nicolas Geoffray</span>: I could make </span><span class="line" data-startTime="24">you a little tour, actually. </span><span class="line" data-startTime="27">I don't know how it's </span><span class="line" data-startTime="27">called in English, </span><span class="line" data-startTime="29">but it's like a skillet. </span></p>

<p class="speaker"><span class="line" data-starttime="30"><span class="speakerName">Seth Ladd</span>: I think it's </span><span class="line" data-startTime="30">a little gondola. </span></p>

<p class="speaker"><span class="line" data-starttime="32"><span class="speakerName">Nicolas Geoffray</span>: Gondola. </span></p>

<p class="speaker"><span class="line" data-starttime="35"><span class="speakerName">Seth Ladd</span>: I love the </span><span class="line" data-startTime="35">Zurich office. </span><span class="line" data-startTime="36">It's a very, very cool office. </span></p>

<p class="speaker"><span class="line" data-starttime="39"><span class="speakerName">Nicolas Geoffray</span>: Yeah, it's </span><span class="line" data-startTime="39">nice to hang out here. </span></p>

<p class="speaker"><span class="line" data-starttime="41"><span class="speakerName">Seth Ladd</span>: Well thank you </span><span class="line" data-startTime="41">for taking the time. </span><span class="line" data-startTime="43">So some really interesting </span><span class="line" data-startTime="43">developments over the past </span><span class="line" data-startTime="45">couple weeks. </span><span class="line" data-startTime="47">So we should start off with </span><span class="line" data-startTime="47">where do you normally work, </span><span class="line" data-startTime="50">and what project </span><span class="line" data-startTime="50">do you work on? </span></p>

<p class="speaker"><span class="line" data-starttime="53"><span class="speakerName">Nicolas Geoffray</span>: I normally </span><span class="line" data-startTime="53">work in Aarhus, Denmark. </span><span class="line" data-startTime="57">That's where lots of Dart </span><span class="line" data-startTime="57">stuff is happening. </span><span class="line" data-startTime="59">And I'm working on dart2js. </span><span class="line" data-startTime="62">That's the compiler that </span><span class="line" data-startTime="62">compiles Dart programs to </span><span class="line" data-startTime="66">JavaScript. </span></p>

<p class="speaker"><span class="line" data-starttime="68"><span class="speakerName">Seth Ladd</span>: And the dart2js </span><span class="line" data-startTime="68">compiler itself is written in </span><span class="line" data-startTime="71">Dart, correct? </span></p>

<p class="speaker"><span class="line" data-starttime="72"><span class="speakerName">Nicolas Geoffray</span>: It is. </span></p>

<p class="speaker"><span class="line" data-starttime="73"><span class="speakerName">Seth Ladd</span>: So that's </span><span class="line" data-startTime="73">pretty cool. </span><span class="line" data-startTime="74">So we're dog fooding our own </span><span class="line" data-startTime="74">language and tools to make </span><span class="line" data-startTime="77">more tools. </span><span class="line" data-startTime="78">I like that. </span><span class="line" data-startTime="81">We had a very interesting </span><span class="line" data-startTime="81">development last week. </span><span class="line" data-startTime="84">Why don't you go ahead and share </span><span class="line" data-startTime="84">your screen, and we'll </span><span class="line" data-startTime="87">talk about what happened. </span></p>

<p class="speaker"><span class="line" data-starttime="89"><span class="speakerName">Nicolas Geoffray</span>: Sounds good. </span><span class="line" data-startTime="94">Start screenshare. </span><span class="line" data-startTime="100">So here you can see </span><span class="line" data-startTime="100">what happened. </span></p>

<p class="speaker"><span class="line" data-starttime="102"><span class="speakerName">Seth Ladd</span>: Ah, look at </span><span class="line" data-startTime="102">those healthy bumps. </span><span class="line" data-startTime="105">So we're looking at the </span><span class="line" data-startTime="105">performance charts you can </span><span class="line" data-startTime="108">find on dartlang.org, where we </span><span class="line" data-startTime="108">track the performance of some </span><span class="line" data-startTime="113">well-known benchmarks across </span><span class="line" data-startTime="113">the V8 world, which is our </span><span class="line" data-startTime="116">JavaScript engine; the Dart VM </span><span class="line" data-startTime="116">world, which is the teal line </span><span class="line" data-startTime="121">on the top; and dart2js, which </span><span class="line" data-startTime="121">is the purple line. </span><span class="line" data-startTime="125">And Nicolas, what happened </span><span class="line" data-startTime="125">there last week? </span></p>

<p class="speaker"><span class="line" data-starttime="130"><span class="speakerName">Nicolas Geoffray</span>: You can see </span><span class="line" data-startTime="130">the small bumps here. </span><span class="line" data-startTime="133">I don't know if you can follow </span><span class="line" data-startTime="133">me with the mouse. </span><span class="line" data-startTime="137">But what actually happened is </span><span class="line" data-startTime="137">that now we have better </span><span class="line" data-startTime="142">tracking of types of fields and </span><span class="line" data-startTime="145">parameters given to a method. </span><span class="line" data-startTime="149">That enables us to do better </span><span class="line" data-startTime="149">optimizations inside methods. </span><span class="line" data-startTime="153">So we know what kind of fields, </span><span class="line" data-startTime="153">what kind of types </span><span class="line" data-startTime="155">we're getting in the field, and </span><span class="line" data-startTime="155">what kind of types we're </span><span class="line" data-startTime="157">getting when we're in a method </span><span class="line" data-startTime="157">for a parameter. </span><span class="line" data-startTime="164">So the small bumps that </span><span class="line" data-startTime="164">come into little &mdash; </span><span class="line" data-startTime="166">I mean, like this was last week, </span><span class="line" data-startTime="166">this was a few days ago. </span><span class="line" data-startTime="171">It's because we got better </span><span class="line" data-startTime="171">improvements on that type </span><span class="line" data-startTime="177">inferencing, as we call it. </span></p>

<p class="speaker"><span class="line" data-starttime="179"><span class="speakerName">Seth Ladd</span>: So it looks &mdash; </span><span class="line" data-startTime="181">and what's really interesting, </span><span class="line" data-startTime="181">maybe you can explain this to </span><span class="line" data-startTime="183">me, is the code which is the </span><span class="line" data-startTime="183">purple line here, that is </span><span class="line" data-startTime="186">output by dart2js &mdash; </span><span class="line" data-startTime="188">which is outputting </span><span class="line" data-startTime="188">JavaScript &mdash; </span><span class="line" data-startTime="190">is actually running </span><span class="line" data-startTime="190">faster than V8. </span><span class="line" data-startTime="193">Now of course when we run the </span><span class="line" data-startTime="193">output JavaScript on V8 &mdash; </span><span class="line" data-startTime="198">I mean, what are we </span><span class="line" data-startTime="198">looking at here? </span><span class="line" data-startTime="199">How can V8 run faster than V8? </span></p>

<p class="speaker"><span class="line" data-starttime="203"><span class="speakerName">Nicolas Geoffray</span>: So this </span><span class="line" data-startTime="203">is pretty funny. </span><span class="line" data-startTime="206">You would guess that we would </span><span class="line" data-startTime="206">run at 100% of V8 ideally. </span><span class="line" data-startTime="213">That's our goal in </span><span class="line" data-startTime="213">the dart2js team. </span><span class="line" data-startTime="216">What is happening is that we're </span><span class="line" data-startTime="216">getting pretty lucky </span><span class="line" data-startTime="221">with the V8 compiler, because </span><span class="line" data-startTime="221">we're reaching a nice path in </span><span class="line" data-startTime="228">the V8 compiler that </span><span class="line" data-startTime="228">allocates &mdash; </span><span class="line" data-startTime="231">that does better register </span><span class="line" data-startTime="231">allocation, things like that. </span><span class="line" data-startTime="236">So that's one explanation. </span><span class="line" data-startTime="237">A second explanation is that </span><span class="line" data-startTime="237">we're doing pretty aggressive </span><span class="line" data-startTime="240">aligning because we have </span><span class="line" data-startTime="240">better knowledge </span><span class="line" data-startTime="244">of the whole program. </span><span class="line" data-startTime="247">And that knowledge is kind of </span><span class="line" data-startTime="247">hard to gather with V8 when it </span><span class="line" data-startTime="254">runs the JavaScript version. </span></p>

<p class="speaker"><span class="line" data-starttime="257"><span class="speakerName">Seth Ladd</span>: OK, so the </span><span class="line" data-startTime="257">purple line isn't V8 </span><span class="line" data-startTime="261">running faster than V8. </span><span class="line" data-startTime="262">It's the outputted code from </span><span class="line" data-startTime="262">dart2js is just more </span><span class="line" data-startTime="268">intelligent than the handwritten </span><span class="line" data-startTime="268">benchmark code </span><span class="line" data-startTime="272">that V8 is running as the </span><span class="line" data-startTime="272">benchmark by which all other </span><span class="line" data-startTime="276">benchmarks are measured. </span></p>

<p class="speaker"><span class="line" data-starttime="277"><span class="speakerName">Nicolas Geoffray</span>: Yeah. </span><span class="line" data-startTime="278">That's correct. </span></p>

<p class="speaker"><span class="line" data-starttime="279"><span class="speakerName">Seth Ladd</span>: That's awesome </span><span class="line" data-startTime="279">So this is really cool. </span> <span class="line" data-startTime="282">And so everyone can check this </span><span class="line" data-startTime="282">out, dartlang.org/performance. </span> <span class="line" data-startTime="285">I would say expect more </span><span class="line" data-startTime="285">benchmarks soon. </span> <span class="line" data-startTime="289">There's only two operating now, </span><span class="line" data-startTime="289">DeltaBlue and Richards. </span> <span class="line" data-startTime="292">And from what I guess, your </span><span class="line" data-startTime="292">team is just getting </span><span class="line" data-startTime="294">started with this. </span> <span class="line" data-startTime="296">From what I'm hearing, you're </span><span class="line" data-startTime="296">even being a little </span><span class="line" data-startTime="298">conservative about how you </span><span class="line" data-startTime="298">apply these inferences. </span> <span class="line" data-startTime="301">So what's your feeling for the </span><span class="line" data-startTime="301">runway here in terms of just </span><span class="line" data-startTime="306">general dart2js performance? </span><span class="line" data-startTime="308">Do you have more work to do? </span></p>

<p class="speaker"><span class="line" data-starttime="311"><span class="speakerName">Nicolas Geoffray</span>: We have </span><span class="line" data-startTime="311">a lot of work to do. </span><span class="line" data-startTime="313">If you look at the benchmarks </span><span class="line" data-startTime="313">DeltaBlue and Richards, we </span><span class="line" data-startTime="318">cover a lot when it comes to </span><span class="line" data-startTime="318">doing type inferencing. </span><span class="line" data-startTime="323">There are some other benchmarks </span><span class="line" data-startTime="323">that we're still </span><span class="line" data-startTime="325">working on where the type </span><span class="line" data-startTime="325">inferencing still needs some </span><span class="line" data-startTime="331">improvements, and </span><span class="line" data-startTime="331">working on that. </span></p>

<p class="speaker"><span class="line" data-starttime="335"><span class="speakerName">Seth Ladd</span>: Cool. </span><span class="line" data-startTime="335">Well I know you prepared a </span><span class="line" data-startTime="335">couple slides here to walk us </span><span class="line" data-startTime="339">through exactly what global </span><span class="line" data-startTime="339">type inferencing means. </span><span class="line" data-startTime="343">Do you mind giving us kind of </span><span class="line" data-startTime="343">a tour behind the scenes on </span><span class="line" data-startTime="347">how you guys achieved </span><span class="line" data-startTime="347">these speed bumps? </span></p>

<p class="speaker"><span class="line" data-starttime="350"><span class="speakerName">Nicolas Geoffray</span>: Sure, so </span><span class="line" data-startTime="350">a small explanation. </span><span class="line" data-startTime="353">The global type inferencing </span><span class="line" data-startTime="353">looks at you whole program an </span><span class="line" data-startTime="357">looks at assignments to fields, </span><span class="line" data-startTime="357">assignments to local </span><span class="line" data-startTime="361">variables, parameters </span><span class="line" data-startTime="361">of methods. </span><span class="line" data-startTime="364">So every time you call a </span><span class="line" data-startTime="364">method, we look at what </span><span class="line" data-startTime="368">parameters you call it with. </span><span class="line" data-startTime="370">And when you gather all that </span><span class="line" data-startTime="370">information, at the end, you </span><span class="line" data-startTime="373">actually calculate or compute </span><span class="line" data-startTime="373">the types of the fields and </span><span class="line" data-startTime="380">the types given to parameters. </span><span class="line" data-startTime="383">And in order to be correct, </span><span class="line" data-startTime="383">you actually need to have </span><span class="line" data-startTime="387">global knowledge. </span><span class="line" data-startTime="389">And that's what we have when </span><span class="line" data-startTime="389">we compile the Dart </span><span class="line" data-startTime="392">application to JavaScript. </span></p>

<p class="speaker"><span class="line" data-starttime="395"><span class="speakerName">Seth Ladd</span>: And it's </span><span class="line" data-startTime="395">global now. </span><span class="line" data-startTime="396">What about the Dart &mdash; </span><span class="line" data-startTime="396">and by the way, all </span><span class="line" data-startTime="398">we see is your slide. </span><span class="line" data-startTime="399">So if you want to stop </span><span class="line" data-startTime="399">screensharing for a minute, </span><span class="line" data-startTime="402">I'll ask you a couple </span><span class="line" data-startTime="402">questions. </span><span class="line" data-startTime="403">Then we'll jump back </span><span class="line" data-startTime="403">to the slides. </span><span class="line" data-startTime="405">But what is it about </span><span class="line" data-startTime="405">Dart that &mdash; </span><span class="line" data-startTime="408">there you go. </span><span class="line" data-startTime="411">Hey. </span><span class="line" data-startTime="412">What is it about Dart </span><span class="line" data-startTime="412">that allows you </span><span class="line" data-startTime="413">to do global analysis? </span><span class="line" data-startTime="415">Why can't we do this &mdash; </span><span class="line" data-startTime="417">why can't V8 do this </span><span class="line" data-startTime="417">in JavaScript? </span></p>

<p class="speaker"><span class="line" data-starttime="421"><span class="speakerName">Nicolas Geoffray</span>: What happens </span><span class="line" data-startTime="421">in JavaScript is that you can </span><span class="line" data-startTime="425">download JavaScript </span><span class="line" data-startTime="425">code on demand. </span> <span class="line" data-startTime="432">You can dynamically extend </span><span class="line" data-startTime="432">your application with new </span><span class="line" data-startTime="438">calls, new assignments </span><span class="line" data-startTime="438">to fields. </span> <span class="line" data-startTime="440">And suddenly what you thought </span><span class="line" data-startTime="440">you knew about </span><span class="line" data-startTime="442">the world gets extended. </span> <span class="line" data-startTime="447">In V8 land, when it's a VM doing </span><span class="line" data-startTime="447">optimization, it needs </span><span class="line" data-startTime="452">to de-optimize. </span> <span class="line" data-startTime="453">Because now it sees, oh, this </span><span class="line" data-startTime="453">field is an int and not just a </span><span class="line" data-startTime="458">string or something like that. </span> <span class="line" data-startTime="460">So that's the difference. </span> <span class="line" data-startTime="462">With Dart, we actually have </span><span class="line" data-startTime="462">knowledge of the whole </span><span class="line" data-startTime="464">application. </span></p>

<p><span class="line" data-startTime="466">There's no dynamic loading, and </span><span class="line" data-startTime="466">it's pretty structured. </span> <span class="line" data-startTime="470">So we know when we analyze </span><span class="line" data-startTime="470">the program what kind of </span><span class="line" data-startTime="474">[INAUDIBLE] the fields </span><span class="line" data-startTime="474">will have. </span></p>

<p class="speaker"><span class="line" data-starttime="477"><span class="speakerName">Seth Ladd</span>: For everyone who's </span><span class="line" data-startTime="477">just joining us, we're here </span><span class="line" data-startTime="480">chatting with Nicolas Geoffray, </span><span class="line" data-startTime="480">one of the engineers </span><span class="line" data-startTime="482">on the dart2js project, who </span><span class="line" data-startTime="482">normally works in Aarhus, </span><span class="line" data-startTime="485">Denmark, but today is joining </span><span class="line" data-startTime="485">us in a gondola </span><span class="line" data-startTime="488">in the Zurich office. </span> <span class="line" data-startTime="489">And we were chatting about some </span><span class="line" data-startTime="489">of the recent performance </span><span class="line" data-startTime="492">bumps that he and his team have </span><span class="line" data-startTime="492">landed which have shown </span><span class="line" data-startTime="497">some pretty nice improvements </span><span class="line" data-startTime="497">with the </span><span class="line" data-startTime="499">benchmarks that we're tracking. </span> <span class="line" data-startTime="502">We're talking about global type </span><span class="line" data-startTime="502">inferencing and what the </span><span class="line" data-startTime="505">Dart language allows us to do </span><span class="line" data-startTime="505">above and beyond maybe what </span><span class="line" data-startTime="508">the JavaScript or V8 can </span><span class="line" data-startTime="508">do to get some of </span><span class="line" data-startTime="510">these performance bumps. </span> <span class="line" data-startTime="512">But one thing that I like to </span><span class="line" data-startTime="512">explain to people about Dart </span><span class="line" data-startTime="516">is that it has a known </span><span class="line" data-startTime="516">starting point. </span> <span class="line" data-startTime="518">Every Dart program starts </span><span class="line" data-startTime="518">with the main function. </span></p>

<p><span class="line" data-startTime="521">And from there, the program &mdash; </span><span class="line" data-startTime="523">the whole program analysis </span><span class="line" data-startTime="523">can start by holistically </span><span class="line" data-startTime="526">understanding the complete </span><span class="line" data-startTime="526">boundaries of that program. </span> <span class="line" data-startTime="528">And it sounds like you're able </span><span class="line" data-startTime="528">to take advantage of this by </span><span class="line" data-startTime="532">doing a global type inference </span><span class="line" data-startTime="532">across the entire program. </span></p>

<p class="speaker"><span class="line" data-starttime="536"><span class="speakerName">Nicolas Geoffray</span>: One thing I </span><span class="line" data-startTime="536">should probably also add is </span><span class="line" data-startTime="537">that in JavaScript, </span><span class="line" data-startTime="537">it's so dynamic. </span><span class="line" data-startTime="540">There's lots of functionalities </span><span class="line" data-startTime="540">like eval, and </span><span class="line" data-startTime="546">different ways of changing </span><span class="line" data-startTime="546">the value of a field. </span><span class="line" data-startTime="551">And that makes it very difficult </span><span class="line" data-startTime="551">for a static </span><span class="line" data-startTime="553">analysis to actually track </span><span class="line" data-startTime="553">types of variables. </span></p>

<p class="speaker"><span class="line" data-starttime="558"><span class="speakerName">Seth Ladd</span>: Right. </span><span class="line" data-startTime="560">And so one thing I should </span><span class="line" data-startTime="560">probably ask though is, we </span><span class="line" data-startTime="562">keep mentioning this global </span><span class="line" data-startTime="562">type inferencing. </span><span class="line" data-startTime="566">My understanding, of course, </span><span class="line" data-startTime="566">is Dart has an </span><span class="line" data-startTime="569">optional type system. </span><span class="line" data-startTime="570">Now for everyone following along </span><span class="line" data-startTime="570">at home, why don't you </span><span class="line" data-startTime="574">just respect those </span><span class="line" data-startTime="574">type annotations? </span><span class="line" data-startTime="577">I put those in there. </span><span class="line" data-startTime="579">But why you have to go to a </span><span class="line" data-startTime="579">global type inferencing? </span></p>

<p class="speaker"><span class="line" data-starttime="585"><span class="speakerName">Nicolas Geoffray</span>: The type </span><span class="line" data-startTime="585">system in Dart is optional. </span> <span class="line" data-startTime="587">You don't have to use it. </span> <span class="line" data-startTime="589">And we actually have &mdash; </span><span class="line" data-startTime="591">Dart actually has two modes </span><span class="line" data-startTime="591">for running applications. </span> <span class="line" data-startTime="595">One is called checked </span><span class="line" data-startTime="595">mode, and one is </span><span class="line" data-startTime="598">called unchecked mode. </span> <span class="line" data-startTime="602">In checked mode, the type </span><span class="line" data-startTime="602">annotations actually have </span><span class="line" data-startTime="605">meaning, that we will check that </span><span class="line" data-startTime="605">the types match what you </span><span class="line" data-startTime="611">put in a variable. </span> <span class="line" data-startTime="613">So if you string a equals 2, </span><span class="line" data-startTime="613">we'll check that and produce a </span><span class="line" data-startTime="617">runtime error. </span></p>

<p><span class="line" data-startTime="619">In unchecked mode, we don't </span><span class="line" data-startTime="619">look at that limitations. </span> <span class="line" data-startTime="622">We just go through. </span> <span class="line" data-startTime="624">So string a equals 2? </span><span class="line" data-startTime="625">Fine, we'll continue. </span> <span class="line" data-startTime="627">And that's the main reason </span><span class="line" data-startTime="627">we do not use those type </span><span class="line" data-startTime="630">annotations for optimizing. </span> <span class="line" data-startTime="633">It's like, if you see </span><span class="line" data-startTime="633">string a, well, </span><span class="line" data-startTime="638">nothing will make sure &mdash; </span><span class="line" data-startTime="641">in non-checked mode, nothing </span><span class="line" data-startTime="641">will make sure that your </span><span class="line" data-startTime="644">variable a will hold a string. </span> <span class="line" data-startTime="646">You can put anything in it. </span> <span class="line" data-startTime="648">So you need to analyze every </span><span class="line" data-startTime="648">assignment to that a variable </span><span class="line" data-startTime="652">to make sure it gets </span><span class="line" data-startTime="652">that type. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="657"><span class="speakerName">Seth Ladd</span>: Awesome. </span><span class="line" data-startTime="659">And as a developer, I actually </span><span class="line" data-startTime="659">really like the way Dart does </span><span class="line" data-startTime="662">this, in that I don't feel </span><span class="line" data-startTime="662">like I have to appease a </span><span class="line" data-startTime="665">ceremonial type checker just </span><span class="line" data-startTime="665">to get my program to run. </span><span class="line" data-startTime="667">And now that I see that the </span><span class="line" data-startTime="667">engineers, like the guys in </span><span class="line" data-startTime="670">the dart2js team, are able to </span><span class="line" data-startTime="670">analyze my program for me and </span><span class="line" data-startTime="674">infer these types anyway, I </span><span class="line" data-startTime="674">still feel like the tools and </span><span class="line" data-startTime="678">runtimes can take </span><span class="line" data-startTime="678">advantage of &mdash; </span><span class="line" data-startTime="681">if I use int everywhere, then </span><span class="line" data-startTime="681">you're going to start assuming </span><span class="line" data-startTime="684">that's an int and take advantage </span><span class="line" data-startTime="684">of that optimization </span><span class="line" data-startTime="686">by assuming it's an int. </span><span class="line" data-startTime="691">This a good time to jump over </span><span class="line" data-startTime="691">to the slides that you have, </span><span class="line" data-startTime="694">because I'm really curious to </span><span class="line" data-startTime="694">see actually how this works. </span><span class="line" data-startTime="697">So can you walk us through </span><span class="line" data-startTime="697">a little bit? </span></p>

<p class="speaker"><span class="line" data-starttime="699"><span class="speakerName">Nicolas Geoffray</span>: Yeah. </span><span class="line" data-startTime="703">I've taken a small </span><span class="line" data-startTime="703">code snippet of </span><span class="line" data-startTime="707">the DeltaBlue benchmark. </span><span class="line" data-startTime="711">Here you have the slides. </span></p>

<p class="speaker"><span class="line" data-starttime="714"><span class="speakerName">Seth Ladd</span>: I see me. </span></p>

<p class="speaker"><span class="line" data-starttime="718"><span class="speakerName">Nicolas Geoffray</span>: Oh, </span><span class="line" data-startTime="718">you only see you. </span></p>

<p class="speaker"><span class="line" data-starttime="720"><span class="speakerName">Seth Ladd</span>: Yep. </span></p>

<p class="speaker"><span class="line" data-starttime="723"><span class="speakerName">Nicolas Geoffray</span>: Screenshare. </span><span class="line" data-startTime="725">Let's try again. </span><span class="line" data-startTime="728">Desktop. </span><span class="line" data-startTime="733">There it is now. </span></p>

<p class="speaker"><span class="line" data-starttime="735"><span class="speakerName">Seth Ladd</span>: OK. </span><span class="line" data-startTime="735">I see it. </span><span class="line" data-startTime="735">Fire it up. </span></p>

<p class="speaker"><span class="line" data-starttime="737"><span class="speakerName">Nicolas Geoffray</span>: Present. </span></p>

<p class="speaker"><span class="line" data-starttime="746"><span class="speakerName">Seth Ladd</span>: And so before you </span><span class="line" data-startTime="746">jump into this though, let's </span><span class="line" data-startTime="748">talk a little bit about the </span><span class="line" data-startTime="748">benchmark that everyone's </span><span class="line" data-startTime="750">talking about, DeltaBlue. </span><span class="line" data-startTime="752">Where did this thing </span><span class="line" data-startTime="752">come from? </span><span class="line" data-startTime="753">What does it do? </span><span class="line" data-startTime="755">Do you know anything about </span><span class="line" data-startTime="755">its lineage or history? </span></p>

<p class="speaker"><span class="line" data-starttime="759"><span class="speakerName">Nicolas Geoffray</span>: Not really. </span> <span class="line" data-startTime="763">So DeltaBlue is a pretty popular </span><span class="line" data-startTime="763">benchmark that I think </span><span class="line" data-startTime="766">started with maybe Smalltalk &mdash; </span><span class="line" data-startTime="769">I'm actually not sure &mdash; </span><span class="line" data-startTime="771">and got ported to Java, </span><span class="line" data-startTime="771">and ported to </span><span class="line" data-startTime="775">JavaScript by the V8 team. </span> <span class="line" data-startTime="777">And now it's been ported to Dart </span><span class="line" data-startTime="777">by the same &mdash; well, the </span><span class="line" data-startTime="781">former V8 team, and </span><span class="line" data-startTime="781">now the Dart team. </span> <span class="line" data-startTime="784">It's a fairly &mdash; </span><span class="line" data-startTime="785">it's an object-oriented </span><span class="line" data-startTime="785">benchmark, uses typical </span><span class="line" data-startTime="789">objects, and object dispatch. </span> <span class="line" data-startTime="795">So it's the kind of benchmark </span><span class="line" data-startTime="795">that should represent a real </span><span class="line" data-startTime="800">application. </span></p>

<p class="speaker"><span class="line" data-starttime="801"><span class="speakerName">Seth Ladd</span>: OK, cool. </span><span class="line" data-startTime="802">So it has a long lineage that's </span><span class="line" data-startTime="802">been ported many times. </span><span class="line" data-startTime="806">And it's really stressing an </span><span class="line" data-startTime="807">object-oriented type of system. </span></p>

<p class="speaker"><span class="line" data-starttime="809"><span class="speakerName">Nicolas Geoffray</span>: Yes. </span><span class="line" data-startTime="811">So if you write applications </span><span class="line" data-startTime="811">really object-oriented, it </span><span class="line" data-startTime="815">should be pretty similar. </span></p>

<p class="speaker"><span class="line" data-starttime="817"><span class="speakerName">Seth Ladd</span>: So what are </span><span class="line" data-startTime="817">we looking at here? </span></p>

<p class="speaker"><span class="line" data-starttime="820"><span class="speakerName">Nicolas Geoffray</span>: This is a </span><span class="line" data-startTime="820">method written in Dart of the </span><span class="line" data-startTime="823">DeltaBlue benchmark. </span><span class="line" data-startTime="826">It's one of the hottest methods </span><span class="line" data-startTime="826">of the benchmark. </span><span class="line" data-startTime="832">I've taken a snipped. </span><span class="line" data-startTime="833">And you can see it's </span><span class="line" data-startTime="833">pretty simple. </span><span class="line" data-startTime="837">You've got a method with </span><span class="line" data-startTime="837">two parameters. </span><span class="line" data-startTime="840">And walk over the elements of </span><span class="line" data-startTime="840">the list and check if it </span><span class="line" data-startTime="851">satisfies some constraint, and </span><span class="line" data-startTime="851">then add it to another list. </span></p>

<p class="speaker"><span class="line" data-starttime="856"><span class="speakerName">Seth Ladd</span>: OK, pretty </span><span class="line" data-startTime="856">straightforward code here. </span></p>

<p class="speaker"><span class="line" data-starttime="861"><span class="speakerName">Nicolas Geoffray</span>: The next slide </span><span class="line" data-startTime="861">shows what we used to </span><span class="line" data-startTime="864">generate back then. </span><span class="line" data-startTime="866">That means like two weeks ago. </span></p>

<p class="speaker"><span class="line" data-starttime="870"><span class="speakerName">Seth Ladd</span>: We can </span><span class="line" data-startTime="870">see your mouse. </span><span class="line" data-startTime="872">So if you want to move your </span><span class="line" data-startTime="872">mouse to point to areas that </span><span class="line" data-startTime="875">you're talking about, </span><span class="line" data-startTime="875">go for it. </span></p>

<p class="speaker"><span class="line" data-starttime="876"><span class="speakerName">Nicolas Geoffray</span>: Oh, sure. </span> <span class="line" data-startTime="879">That's revision 19850, back </span><span class="line" data-startTime="879">when we didn't have global </span><span class="line" data-startTime="886">type inferencing. </span> <span class="line" data-startTime="888">And you can see it's </span><span class="line" data-startTime="888">not looking as </span><span class="line" data-startTime="891">good as the Dart version. </span> <span class="line" data-startTime="896">There's a lot of checking, like </span><span class="line" data-startTime="896">you were checking if a </span><span class="line" data-startTime="901">call to a length getter on some </span><span class="line" data-startTime="905">variable gives you a number. </span> <span class="line" data-startTime="908">And if it doesn't, we actually </span><span class="line" data-startTime="908">jump to a method </span><span class="line" data-startTime="911">that will handle it. </span> <span class="line" data-startTime="915">You can see that before, </span><span class="line" data-startTime="915">we used the Dart </span><span class="line" data-startTime="918">version as a for loop. </span> <span class="line" data-startTime="920">Now we can just have a while </span><span class="line" data-startTime="920">loop because we have all these </span><span class="line" data-startTime="924">statements that cannot be </span><span class="line" data-startTime="924">expressed in a for loop. </span> <span class="line" data-startTime="929">We need to break here </span><span class="line" data-startTime="929">to break the loop. </span> <span class="line" data-startTime="932">So it doesn't look as nice </span><span class="line" data-startTime="932">as the Dart version. </span> <span class="line" data-startTime="936">And today what we generate is </span><span class="line" data-startTime="936">actually pretty close to the </span><span class="line" data-startTime="940">Dart version, with a for loop, </span><span class="line" data-startTime="940">and just a check of the </span><span class="line" data-startTime="948">condition, and adding to a new </span><span class="line" data-startTime="948">collection, very similar to </span><span class="line" data-startTime="954">that Dart version. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="958"><span class="speakerName">Seth Ladd</span>: Now help me </span><span class="line" data-startTime="958">understand for the second </span><span class="line" data-startTime="962">slide, the original </span><span class="line" data-startTime="962">JavaScript. </span><span class="line" data-startTime="965">Why did you have to move </span><span class="line" data-startTime="965">to a while loop and </span><span class="line" data-startTime="968">put all those bailouts? </span></p>

<p class="speaker"><span class="line" data-starttime="972"><span class="speakerName">Nicolas Geoffray</span>: The reason we </span><span class="line" data-startTime="972">have those bailouts is to </span><span class="line" data-startTime="974">actually have good performance </span><span class="line" data-startTime="974">when running on top of </span><span class="line" data-startTime="980">JavaScript. </span><span class="line" data-startTime="981">If you were not to have all </span><span class="line" data-startTime="981">these checks here, we couldn't </span><span class="line" data-startTime="986">omit this less than </span><span class="line" data-startTime="986">directly, like </span><span class="line" data-startTime="988">JavaScript built-in operators. </span><span class="line" data-startTime="991">Dart has different semantics. </span><span class="line" data-startTime="994">And every object actually has </span><span class="line" data-startTime="994">its own less than method. </span><span class="line" data-startTime="1000">So it's not like we can use </span><span class="line" data-startTime="1000">the JavaScript built-in </span><span class="line" data-startTime="1003">operator for that. </span></p>

<p class="speaker"><span class="line" data-starttime="1006"><span class="speakerName">Seth Ladd</span>: Right, because at </span><span class="line" data-startTime="1006">that point you don't know it's </span><span class="line" data-startTime="1008">actually an int. </span><span class="line" data-startTime="1009">So first you'd say, is this </span><span class="line" data-startTime="1009">thing really an int. </span><span class="line" data-startTime="1013">If so, great. </span><span class="line" data-startTime="1013">Go ahead and use less than. </span><span class="line" data-startTime="1014">Because in Dart code, you have </span><span class="line" data-startTime="1014">operator overriding. </span><span class="line" data-startTime="1017">You could have any object &mdash; </span><span class="line" data-startTime="1018">or, sorry, any class implement </span><span class="line" data-startTime="1018">its own version of less than. </span><span class="line" data-startTime="1021">NICOLAS GEOFFRAY: </span><span class="line" data-startTime="1021">That's correct. </span><span class="line" data-startTime="1022">And you can see that I actually </span><span class="line" data-startTime="1022">have another check </span><span class="line" data-startTime="1024">here, which is always </span><span class="line" data-startTime="1024">v.get$constraints, an array. </span><span class="line" data-startTime="1029">And if it's not then I need to </span><span class="line" data-startTime="1029">go again in a bailout in the </span><span class="line" data-startTime="1034">non-optimized version. </span><span class="line" data-startTime="1035">And if it is, then great. </span><span class="line" data-startTime="1036">I can do typical array indexing, </span><span class="line" data-startTime="1036">like transcript </span><span class="line" data-startTime="1040">array indexing, and call &mdash; </span><span class="line" data-startTime="1044">yeah, so typical array </span><span class="line" data-startTime="1044">indexing here. </span></p>

<p class="speaker"><span class="line" data-starttime="1048"><span class="speakerName">Seth Ladd</span>: OK, so the original </span><span class="line" data-startTime="1048">code has to accommodate a very </span><span class="line" data-startTime="1053">dynamic world, because </span><span class="line" data-startTime="1053">he doesn't know </span><span class="line" data-startTime="1056">these objects can be. </span></p>

<p class="speaker"><span class="line" data-starttime="1057"><span class="speakerName">Nicolas Geoffray</span>: Yeah. </span><span class="line" data-startTime="1058">He doesn't know. </span></p>

<p class="speaker"><span class="line" data-starttime="1058"><span class="speakerName">Seth Ladd</span>: But, the new world. </span></p>

<p class="speaker"><span class="line" data-starttime="1061"><span class="speakerName">Nicolas Geoffray</span>: The new world, </span><span class="line" data-startTime="1061">which does a better </span><span class="line" data-startTime="1065">inferencing on variables, </span><span class="line" data-startTime="1065">does know all of this. </span><span class="line" data-startTime="1071">You can see it knows that t1 </span><span class="line" data-startTime="1071">here is a JavaScript array. </span><span class="line" data-startTime="1076">So v.constraints is a </span><span class="line" data-startTime="1076">JavaScript array. </span><span class="line" data-startTime="1081">So it can just use the </span><span class="line" data-startTime="1081">built-in less than of </span><span class="line" data-startTime="1085">JavaScript. </span><span class="line" data-startTime="1090">Again, it uses the built-in </span><span class="line" data-startTime="1090">indexing operator here. </span></p>

<p class="speaker"><span class="line" data-starttime="1096"><span class="speakerName">Seth Ladd</span>: That is so cool. </span><span class="line" data-startTime="1103">OK, so the new world. </span><span class="line" data-startTime="1109">How do you actually go about </span><span class="line" data-startTime="1109">analyzing and say, OK, i is </span><span class="line" data-startTime="1113">really an int now. </span><span class="line" data-startTime="1115">It looks like that's the </span><span class="line" data-startTime="1115">major change, isn't it? </span><span class="line" data-startTime="1117">Now you've been able to analyze </span><span class="line" data-startTime="1117">the program and say I </span><span class="line" data-startTime="1121">know for a fact that some of </span><span class="line" data-startTime="1121">these variables point to </span><span class="line" data-startTime="1125">objects of these types so I can </span><span class="line" data-startTime="1125">eliminate all bailouts. </span><span class="line" data-startTime="1129">That's basically what's </span><span class="line" data-startTime="1129">happening, right? </span></p>

<p class="speaker"><span class="line" data-starttime="1131"><span class="speakerName">Nicolas Geoffray</span>: That's </span><span class="line" data-startTime="1131">basically what's happening. </span><span class="line" data-startTime="1132">We have better information of </span><span class="line" data-startTime="1132">the types of some fields. </span><span class="line" data-startTime="1137">And we can do better. </span><span class="line" data-startTime="1138">I'll actually go through some </span><span class="line" data-startTime="1138">of them, just to show the </span><span class="line" data-startTime="1144">difference of some statements </span><span class="line" data-startTime="1144">of the [INAUDIBLE] code. </span><span class="line" data-startTime="1152">This is the old version. </span><span class="line" data-startTime="1155">And you can see that we're </span><span class="line" data-startTime="1155">actually calling a getter. </span><span class="line" data-startTime="1160">This is calling a getter </span><span class="line" data-startTime="1160">method on v. And that's </span><span class="line" data-startTime="1163">because we have no &mdash; </span><span class="line" data-startTime="1165">we don't know what v is. </span><span class="line" data-startTime="1168">So the Dart code that used to </span><span class="line" data-startTime="1168">do v.determinedBy will get </span><span class="line" data-startTime="1173">translated to </span><span class="line" data-startTime="1173">v.get$determinedBy. </span><span class="line" data-startTime="1175">Because we don't know if it's </span><span class="line" data-startTime="1175">a field or a getter. </span><span class="line" data-startTime="1181">But with the new type </span><span class="line" data-startTime="1181">inferencing, we actually know </span><span class="line" data-startTime="1184">that v is an object that has </span><span class="line" data-startTime="1184">a field and a getter called </span><span class="line" data-startTime="1187">determinedBy. </span></p>

<p class="speaker"><span class="line" data-starttime="1189"><span class="speakerName">Seth Ladd</span>: Oh, that's so cool. </span></p>

<p class="speaker"><span class="line" data-starttime="1190"><span class="speakerName">Nicolas Geoffray</span>: So we can just </span><span class="line" data-startTime="1190">inline the field access, </span><span class="line" data-startTime="1192">like JavaScript field access. </span><span class="line" data-startTime="1194">We know it won't </span><span class="line" data-startTime="1194">throw an error. </span><span class="line" data-startTime="1198">And we know v has that field. </span><span class="line" data-startTime="1203">So that's one improvement. </span><span class="line" data-startTime="1207">A second improvement </span><span class="line" data-startTime="1207">is the loop itself. </span><span class="line" data-startTime="1211">So I told you that before we </span><span class="line" data-startTime="1211">couldn't generate a for loop </span><span class="line" data-startTime="1214">because of all these checks. </span><span class="line" data-startTime="1218">These statements don't hold </span><span class="line" data-startTime="1218">in the for [INAUDIBLE] </span><span class="line" data-startTime="1222">condition update typical loop. </span><span class="line" data-startTime="1225">But with the new version, you </span><span class="line" data-startTime="1225">don't have these statements. </span><span class="line" data-startTime="1230">You're not checking anymore. </span><span class="line" data-startTime="1232">So you can actually just </span><span class="line" data-startTime="1232">generate something very </span><span class="line" data-startTime="1235">similar to the Dart code, which </span><span class="line" data-startTime="1235">is, oh, I'm fetching </span><span class="line" data-startTime="1239">constraints out of v. But </span><span class="line" data-startTime="1239">I know that the field </span><span class="line" data-startTime="1242">constraints of v is a </span><span class="line" data-startTime="1242">JavaScript array. </span><span class="line" data-startTime="1247">So I can just iterate </span><span class="line" data-startTime="1247">over the lengths. </span><span class="line" data-startTime="1253">And that makes it very easy </span><span class="line" data-startTime="1253">to generate a for loop. </span></p>

<p class="speaker"><span class="line" data-starttime="1257"><span class="speakerName">Seth Ladd</span>: And not only is this </span><span class="line" data-startTime="1257">faster code, but it's </span><span class="line" data-startTime="1259">also much easier to read. </span><span class="line" data-startTime="1261">So now the debugging of the </span><span class="line" data-startTime="1261">generated code, to me at </span><span class="line" data-startTime="1263">least, gets a lot easier. </span></p>

<p class="speaker"><span class="line" data-starttime="1265"><span class="speakerName">Nicolas Geoffray</span>: Yeah. </span> <span class="line" data-startTime="1265">If you look at the generated </span><span class="line" data-startTime="1265">code and the original code, it </span><span class="line" data-startTime="1268">looks very similar. </span> <span class="line" data-startTime="1269">So you actually can make sense </span><span class="line" data-startTime="1269">of, oh, I got an error here. </span> <span class="line" data-startTime="1274">How does that map </span><span class="line" data-startTime="1274">to my Dart code? </span><span class="line" data-startTime="1281">Another improvement is all </span><span class="line" data-startTime="1281">this checking again. </span> <span class="line" data-startTime="1285">You're checking if t1 is </span><span class="line" data-startTime="1285">actually an array. </span> <span class="line" data-startTime="1288">And you're doing &mdash; </span><span class="line" data-startTime="1290">so that's the check, right? </span><span class="line" data-startTime="1293">And since you don't know if i is </span><span class="line" data-startTime="1293">in the range of the array, </span><span class="line" data-startTime="1299">you do a range check here. </span> <span class="line" data-startTime="1302">And then you do the access, </span><span class="line" data-startTime="1302">because you know it's a </span><span class="line" data-startTime="1304">JavaScript array. </span> <span class="line" data-startTime="1306">You know that it's in bounds, </span><span class="line" data-startTime="1306">so you don't throw an error. </span> <span class="line" data-startTime="1312">And you can just access </span><span class="line" data-startTime="1312">directly. </span> <span class="line" data-startTime="1316">Because of the new type </span><span class="line" data-startTime="1316">inferencing, we now know that </span><span class="line" data-startTime="1320">t1 is a JavaScript array. </span></p>

<p><span class="line" data-startTime="1322">We know that i is in between </span><span class="line" data-startTime="1322">0 and t1.length. </span> <span class="line" data-startTime="1326">So we know it's not </span><span class="line" data-startTime="1326">out of bounds. </span> <span class="line" data-startTime="1328">So we don't need to emit </span><span class="line" data-startTime="1328">a bounds check. </span> <span class="line" data-startTime="1331">And we just generate the </span><span class="line" data-startTime="1331">[INAUDIBLE] access. </span></p>

<p class="speaker"><span class="line" data-starttime="1335"><span class="speakerName">Seth Ladd</span>: That's huge. </span><span class="line" data-startTime="1336">And one of the differences </span><span class="line" data-startTime="1336">there, thinking about the </span><span class="line" data-startTime="1339">original code, is the difference </span><span class="line" data-startTime="1339">in behavior in a </span><span class="line" data-startTime="1342">Dart list and a JavaScript array </span><span class="line" data-startTime="1342">when you access an index </span><span class="line" data-startTime="1345">out of bounds. </span><span class="line" data-startTime="1346">In Dart you'll get a &mdash; </span><span class="line" data-startTime="1347">forgive if I don't get the </span><span class="line" data-startTime="1347">right name, but it's like </span><span class="line" data-startTime="1349">index out of range error? </span></p>

<p class="speaker"><span class="line" data-starttime="1351"><span class="speakerName">Nicolas Geoffray</span>: I think </span><span class="line" data-startTime="1351">that's changed </span><span class="line" data-startTime="1352">to reg error now. </span></p>

<p class="speaker"><span class="line" data-starttime="1353"><span class="speakerName">Seth Ladd</span>: OK. </span> <span class="line" data-startTime="1355">You'll get a range error. </span> <span class="line" data-startTime="1356">But you'll get an actual </span><span class="line" data-startTime="1356">exception thrown when you try </span><span class="line" data-startTime="1359">to access an index that's out </span><span class="line" data-startTime="1359">of the range of the list. </span> <span class="line" data-startTime="1362">But in JavaScript, I believe </span><span class="line" data-startTime="1362">you'll just get undefined. </span> <span class="line" data-startTime="1365">So the original Dart code had </span><span class="line" data-startTime="1365">to match that behavior. </span> <span class="line" data-startTime="1369">But it looks like now you're </span><span class="line" data-startTime="1369">able to be even smarter and </span><span class="line" data-startTime="1371">say well, I know ahead of time </span><span class="line" data-startTime="1371">if these accesses are actually </span><span class="line" data-startTime="1375">out of range. </span> <span class="line" data-startTime="1376">And if I know that, I don't </span><span class="line" data-startTime="1376">need to put that check in. </span> <span class="line" data-startTime="1379">That is great. </span> <span class="line" data-startTime="1381">NICOLAS GEOFFRAY: </span><span class="line" data-startTime="1381">That's correct. </span> <span class="line" data-startTime="1382">If JavaScript was to throw an </span><span class="line" data-startTime="1382">error when we got out of </span><span class="line" data-startTime="1386">bounds, we wouldn't need </span><span class="line" data-startTime="1386">this code here. </span></p>

<p><span class="line" data-startTime="1390">But it doesn't. </span> <span class="line" data-startTime="1391">And what happens is you just </span><span class="line" data-startTime="1391">get undefined out of it. </span> <span class="line" data-startTime="1394">And then you maybe get </span><span class="line" data-startTime="1394">an error later. </span> <span class="line" data-startTime="1398">But with Dart, you do get the </span><span class="line" data-startTime="1398">bounds check early, just </span><span class="line" data-startTime="1403">before the access. </span> <span class="line" data-startTime="1405">But in that case, you actually </span><span class="line" data-startTime="1405">don't need it, because you </span><span class="line" data-startTime="1407">know i is within the range. </span></p>

<p class="speaker"><span class="line" data-starttime="1416"><span class="speakerName">Seth Ladd</span>: OK, I like that. </span></p>

<p class="speaker"><span class="line" data-starttime="1419"><span class="speakerName">Nicolas Geoffray</span>: I'm sorry? </span></p>

<p class="speaker"><span class="line" data-starttime="1420"><span class="speakerName">Seth Ladd</span>: I like what </span><span class="line" data-startTime="1420">I see so far. </span><span class="line" data-startTime="1421">This is great. </span></p>

<p class="speaker"><span class="line" data-starttime="1424"><span class="speakerName">Nicolas Geoffray</span>: I </span><span class="line" data-startTime="1424">think that's not </span><span class="line" data-startTime="1426">the last, but almost. </span> <span class="line" data-startTime="1429">That's another &mdash; </span><span class="line" data-startTime="1430">that's the last optimization </span><span class="line" data-startTime="1430">that triggered the jump, the </span><span class="line" data-startTime="1435">bump in the graph. </span> <span class="line" data-startTime="1438">It's knowing that when you're </span><span class="line" data-startTime="1438">doing an equals check &mdash; </span><span class="line" data-startTime="1444">so the original code is c double </span><span class="line" data-startTime="1444">equal determining. </span> <span class="line" data-startTime="1449">And when dart2js knows that </span><span class="line" data-startTime="1449">you're actually just doing an </span><span class="line" data-startTime="1455">identity check, because that </span><span class="line" data-startTime="1455">equals results in the object </span><span class="line" data-startTime="1459">equals in Dart. </span> <span class="line" data-startTime="1462">So you could just emit the </span><span class="line" data-startTime="1462">definition of the identity </span><span class="line" data-startTime="1469">check in Dart, which </span><span class="line" data-startTime="1469">is pretty complex. </span> <span class="line" data-startTime="1472">But the intent is that the </span><span class="line" data-startTime="1472">[INAUDIBLE] equals doesn't </span><span class="line" data-startTime="1476">have to check for null. </span> <span class="line" data-startTime="1479">So if you pass a null, if </span><span class="line" data-startTime="1479">the receiver is null &mdash; </span><span class="line" data-startTime="1489">I'm sorry. </span> <span class="line" data-startTime="1489">Let me revert. </span> <span class="line" data-startTime="1492">What I'm saying is that in </span><span class="line" data-startTime="1492">dart2js, we actually have two </span><span class="line" data-startTime="1497">nulls, because of some </span><span class="line" data-startTime="1497">dumb problems with </span><span class="line" data-startTime="1501">interaction with the DOM. </span></p>

<p><span class="line" data-startTime="1503">One is undefined, </span><span class="line" data-startTime="1503">just undefined. </span> <span class="line" data-startTime="1506">And the other is JavaScript </span><span class="line" data-startTime="1506">null. </span> <span class="line" data-startTime="1509">So we cannot just use triple </span><span class="line" data-startTime="1509">equal for checking if two </span><span class="line" data-startTime="1516">things are identical. </span> <span class="line" data-startTime="1519">We need to use double equal. </span> <span class="line" data-startTime="1520">That's what's happening here. </span> <span class="line" data-startTime="1522">c could be undefined of null. </span> <span class="line" data-startTime="1524">In that case, we need to </span><span class="line" data-startTime="1524">check if determining is </span><span class="line" data-startTime="1527">undefined or null. </span> <span class="line" data-startTime="1528">And that's what's </span><span class="line" data-startTime="1528">happening here. </span> <span class="line" data-startTime="1530">The most interesting is that </span><span class="line" data-startTime="1530">here, it's the identity check. </span> <span class="line" data-startTime="1535">And we don't need to go </span><span class="line" data-startTime="1535">through a method. </span> <span class="line" data-startTime="1536">We just use the JavaScript </span><span class="line" data-startTime="1536">identity check. </span></p>

<p class="speaker"><span class="line" data-starttime="1544"><span class="speakerName">Seth Ladd</span>: How does dart2js know </span><span class="line" data-startTime="1544">or infer that I'm doing </span><span class="line" data-startTime="1547">basically an identity check? </span></p>

<p class="speaker"><span class="line" data-starttime="1552"><span class="speakerName">Nicolas Geoffray</span>: It knows that </span><span class="line" data-startTime="1552">c, the [INAUDIBLE] equals </span><span class="line" data-startTime="1556">on c is the wanted object. </span></p>

<p class="speaker"><span class="line" data-starttime="1559"><span class="speakerName">Seth Ladd</span>: OK. </span><span class="line" data-startTime="1560">So this one, this particular </span><span class="line" data-startTime="1560">thing, wouldn't work if I </span><span class="line" data-startTime="1564">implemented my own equals </span><span class="line" data-startTime="1564">equals, of course. </span></p>

<p class="speaker"><span class="line" data-starttime="1567"><span class="speakerName">Nicolas Geoffray</span>: So if you </span><span class="line" data-startTime="1567">implemented your own, and the </span><span class="line" data-startTime="1571">type inferencing would know what </span><span class="line" data-startTime="1571">kind of variable, what </span><span class="line" data-startTime="1576">type that variable is. </span> <span class="line" data-startTime="1577">Then you would do actual direct </span><span class="line" data-startTime="1577">call of that method, of </span><span class="line" data-startTime="1582">that operator equal of yours. </span> <span class="line" data-startTime="1586">In that case here &mdash; before, </span><span class="line" data-startTime="1586">it actually didn't know </span><span class="line" data-startTime="1588">what c could be. </span> <span class="line" data-startTime="1593">Because of the way we generate </span><span class="line" data-startTime="1593">code, we cannot just call a </span><span class="line" data-startTime="1596">method on c. </span> <span class="line" data-startTime="1597">If c was to be an integer, for </span><span class="line" data-startTime="1597">example, I mean, it's a </span><span class="line" data-startTime="1602">JavaScript integer or number. </span> <span class="line" data-startTime="1606">It's not like you can call </span><span class="line" data-startTime="1606">something on it. </span> <span class="line" data-startTime="1608">So we need to code local </span><span class="line" data-startTime="1608">methods that will </span><span class="line" data-startTime="1611">do all these checks. </span> <span class="line" data-startTime="1613">But now we actually know </span><span class="line" data-startTime="1613">what c could be. </span></p>

<p><span class="line" data-startTime="1616">And we know that c, that you're </span><span class="line" data-startTime="1616">just doing an identity </span><span class="line" data-startTime="1620">check on c. </span> <span class="line" data-startTime="1621">And you only need to emit </span><span class="line" data-startTime="1621">this code instead. </span></p>

<p class="speaker"><span class="line" data-starttime="1624"><span class="speakerName">Seth Ladd</span>: Great. </span></p>

<p class="speaker"><span class="line" data-starttime="1627"><span class="speakerName">Nicolas Geoffray</span>: And the last </span><span class="line" data-startTime="1627">optimization I'll show you is </span><span class="line" data-startTime="1631">this check. </span><span class="line" data-startTime="1632">So the semantics in Dart of an </span><span class="line" data-startTime="1632">if check is that the condition </span><span class="line" data-startTime="1641">must evaluate true. </span><span class="line" data-startTime="1644">If it evaluates to anything </span><span class="line" data-startTime="1644">else, it's false. </span><span class="line" data-startTime="1648">And that's very different than </span><span class="line" data-startTime="1648">JavaScript, where lots of </span><span class="line" data-startTime="1652">things evaluate to true &mdash; </span><span class="line" data-startTime="1653">1, non 0, non null, </span><span class="line" data-startTime="1653">non undefined. </span></p>

<p class="speaker"><span class="line" data-starttime="1658"><span class="speakerName">Seth Ladd</span>: Right, many </span><span class="line" data-startTime="1658">truthy values. </span></p>

<p class="speaker"><span class="line" data-starttime="1661"><span class="speakerName">Nicolas Geoffray</span>: Exactly. </span><span class="line" data-startTime="1664">And Dart is very different, that </span><span class="line" data-startTime="1664">you have to be true to </span><span class="line" data-startTime="1668">actually pass an if test. </span><span class="line" data-startTime="1672">We generate a lot of triple </span><span class="line" data-startTime="1672">equals true when doing calls </span><span class="line" data-startTime="1675">in if checks, because we </span><span class="line" data-startTime="1675">don't know what this </span><span class="line" data-startTime="1682">method actually returns. </span><span class="line" data-startTime="1686">With the new type inferencing, </span><span class="line" data-startTime="1686">we know that all the </span><span class="line" data-startTime="1690">isSatisfied methods </span><span class="line" data-startTime="1690">in the benchmark </span><span class="line" data-startTime="1693">always return the Boolean. </span><span class="line" data-startTime="1697">It returns either false, the </span><span class="line" data-startTime="1697">JavaScript false, or the </span><span class="line" data-startTime="1700">JavaScript true. </span><span class="line" data-startTime="1702">So we don't need to compare. </span><span class="line" data-startTime="1704">If that evaluates to false, </span><span class="line" data-startTime="1704">then the condition will be </span><span class="line" data-startTime="1707">false and we won't go </span><span class="line" data-startTime="1707">in the if block. </span><span class="line" data-startTime="1711">If it evaluates to </span><span class="line" data-startTime="1711">true, then fine. </span><span class="line" data-startTime="1712">It will continue. </span></p>

<p class="speaker"><span class="line" data-starttime="1716"><span class="speakerName">Seth Ladd</span>: Yeah, this code </span><span class="line" data-startTime="1716">is so much smarter. </span><span class="line" data-startTime="1718">Good job. </span></p>

<p class="speaker"><span class="line" data-starttime="1724"><span class="speakerName">Nicolas Geoffray</span>: That's it, </span><span class="line" data-startTime="1724">comparing the old version of </span><span class="line" data-startTime="1729">what we generated and the new </span><span class="line" data-startTime="1729">version of what we generated. </span><span class="line" data-startTime="1731">I have a slide of what is the </span><span class="line" data-startTime="1731">actual implementation in the </span><span class="line" data-startTime="1737">JavaScript benchmark. </span></p>

<p class="speaker"><span class="line" data-starttime="1738"><span class="speakerName">Seth Ladd</span>: OK, so this is what </span><span class="line" data-startTime="1738">V8 has been running as its </span><span class="line" data-startTime="1742">version of DeltaBlue </span><span class="line" data-startTime="1742">for many years. </span><span class="line" data-startTime="1746">This is the one we </span><span class="line" data-startTime="1746">measure against. </span></p>

<p class="speaker"><span class="line" data-starttime="1747"><span class="speakerName">Nicolas Geoffray</span>: Yes, that's </span><span class="line" data-startTime="1747">the one idea of what is called </span><span class="line" data-startTime="1750">now the Octane benchmark. </span><span class="line" data-startTime="1755">This is the Dart version. </span><span class="line" data-startTime="1759">No. </span><span class="line" data-startTime="1760">This is not the Dart version. </span><span class="line" data-startTime="1761">That's the dart2js version. </span><span class="line" data-startTime="1767">Let me check if I have a Dart </span><span class="line" data-startTime="1767">version close to it. </span><span class="line" data-startTime="1775">No I don't. </span></p>

<p class="speaker"><span class="line" data-starttime="1777"><span class="speakerName">Seth Ladd</span>: I think we can flip </span><span class="line" data-startTime="1777">back and forth between the </span><span class="line" data-startTime="1780">dart2js version and the </span><span class="line" data-startTime="1780">original V8 version. </span><span class="line" data-startTime="1783">Because what's really </span><span class="line" data-startTime="1783">interesting to me is how did </span><span class="line" data-startTime="1787">dart2js generate a version of </span><span class="line" data-startTime="1787">that method that's faster than </span><span class="line" data-startTime="1793">the handwritten. </span><span class="line" data-startTime="1793">Which, I guess most people </span><span class="line" data-startTime="1793">would assume that the </span><span class="line" data-startTime="1795">handwritten benchmark is always </span><span class="line" data-startTime="1798">going to be the fastest. </span><span class="line" data-startTime="1799">So I think you you've got </span><span class="line" data-startTime="1799">a couple areas you're </span><span class="line" data-startTime="1801">going to point out. </span></p>

<p class="speaker"><span class="line" data-starttime="1802"><span class="speakerName">Nicolas Geoffray</span>: Yeah. </span> <span class="line" data-startTime="1804">So what's happening here, </span><span class="line" data-startTime="1804">actually I've highlighted what </span><span class="line" data-startTime="1809">is happening. </span> <span class="line" data-startTime="1812">If you look at those statements </span><span class="line" data-startTime="1812">where you're doing </span><span class="line" data-startTime="1817">something on cc and call, </span><span class="line" data-startTime="1817">the call variable &mdash; </span><span class="line" data-startTime="1825">how to start? </span><span class="line" data-startTime="1829">The JavaScript benchmark needs </span><span class="line" data-startTime="1829">to add some behavior to the </span><span class="line" data-startTime="1836">JavaScript array. </span> <span class="line" data-startTime="1841">There are multiple ways to </span><span class="line" data-startTime="1841">add new behaviors to </span><span class="line" data-startTime="1844">a JavaScript array. </span> <span class="line" data-startTime="1845">You can drop it so you have your </span><span class="line" data-startTime="1845">own object that grabs a </span><span class="line" data-startTime="1851">JavaScript array. </span> <span class="line" data-startTime="1852">And you do calls on </span><span class="line" data-startTime="1852">that object, and </span><span class="line" data-startTime="1855">you get that behavior. </span> <span class="line" data-startTime="1857">Another way is to </span><span class="line" data-startTime="1857">monkey patch. </span> <span class="line" data-startTime="1860">That's adding new </span><span class="line" data-startTime="1860">methods to the </span><span class="line" data-startTime="1864">JavaScript array prototype. </span></p>

<p><span class="line" data-startTime="1866">But that latter solution </span><span class="line" data-startTime="1866">doesn't really scale. </span> <span class="line" data-startTime="1871">If you start to monkey patching </span><span class="line" data-startTime="1871">in one component of </span><span class="line" data-startTime="1873">your application, then monkey </span><span class="line" data-startTime="1873">patching in another component </span><span class="line" data-startTime="1878">could just not work, because </span><span class="line" data-startTime="1878">you're adding the same method </span><span class="line" data-startTime="1883">name with different </span><span class="line" data-startTime="1883">parameters. </span></p>

<p class="speaker"><span class="line" data-starttime="1886"><span class="speakerName">Seth Ladd</span>: When you mix these </span><span class="line" data-startTime="1886">two worlds, you don't know </span><span class="line" data-startTime="1888">what's going to happen. </span></p>

<p class="speaker"><span class="line" data-starttime="1890"><span class="speakerName">Nicolas Geoffray</span>: Yes. </span> <span class="line" data-startTime="1892">So I guess that's the reason why </span><span class="line" data-startTime="1892">the JavaScript benchmark </span><span class="line" data-startTime="1897">wraps the JavaScript array in </span><span class="line" data-startTime="1897">order to add new behavior, so </span><span class="line" data-startTime="1906">the size, the add, and the add </span><span class="line" data-startTime="1906">under the new behavior. </span> <span class="line" data-startTime="1910">There's another method in the </span><span class="line" data-startTime="1910">benchmark that moves something </span><span class="line" data-startTime="1916">from your array that matches </span><span class="line" data-startTime="1916">a pattern, or </span><span class="line" data-startTime="1921">something like that. </span> <span class="line" data-startTime="1924">The benchmark actually wraps </span><span class="line" data-startTime="1924">a JavaScript array. </span> <span class="line" data-startTime="1927">And that's what Dart is also </span><span class="line" data-startTime="1927">doing with its list class. </span> <span class="line" data-startTime="1934">The list class in Dart has lots </span><span class="line" data-startTime="1934">of behavior, not just the </span><span class="line" data-startTime="1938">JavaScript array behavior. </span> <span class="line" data-startTime="1941">And what dart2js does is it </span><span class="line" data-startTime="1941">compiles a list object to a </span><span class="line" data-startTime="1947">JavaScript array. </span> <span class="line" data-startTime="1948">But in order to have that new </span><span class="line" data-startTime="1948">behavior in the JavaScript </span><span class="line" data-startTime="1953">array, it uses that </span><span class="line" data-startTime="1953">functionality called </span><span class="line" data-startTime="1956">interceptors that will hold </span><span class="line" data-startTime="1956">this new behavior. </span> <span class="line" data-startTime="1964">And that's the reason why </span><span class="line" data-startTime="1964">we could just generate a </span><span class="line" data-startTime="1967">JavaScript array out of </span><span class="line" data-startTime="1967">a list, a Dart list. </span></p>

<p><span class="line" data-startTime="1972">And when you call methods </span><span class="line" data-startTime="1972">that are on the list &mdash; </span><span class="line" data-startTime="1975">like filter &mdash; </span><span class="line" data-startTime="1978">well now it's called </span><span class="line" data-startTime="1978">RemoveWhere &mdash; </span><span class="line" data-startTime="1980">all these methods are in list </span><span class="line" data-startTime="1980">in a simple class called </span><span class="line" data-startTime="1984">[? iterable. ?] </span><span class="line" data-startTime="1985">All these methods will actually </span><span class="line" data-startTime="1985">go through an </span><span class="line" data-startTime="1987">interceptor that will implement </span><span class="line" data-startTime="1987">the behavior. </span></p>

<p class="speaker"><span class="line" data-starttime="1996"><span class="speakerName">Seth Ladd</span>: Let's see </span><span class="line" data-startTime="1996">the version that </span><span class="line" data-startTime="1997">dart2js spits out again. </span><span class="line" data-startTime="1999">I think that will make </span><span class="line" data-startTime="1999">it more clear. </span></p>

<p class="speaker"><span class="line" data-starttime="2006"><span class="speakerName">Nicolas Geoffray</span>: Since we </span><span class="line" data-startTime="2006">actually use a JavaScript </span><span class="line" data-startTime="2007">array for a Dart list, the </span><span class="line" data-startTime="2007">dart2js knows that you can </span><span class="line" data-startTime="2014">actually just do an </span><span class="line" data-startTime="2014">array access, a </span><span class="line" data-startTime="2018">JavaScript array access. </span><span class="line" data-startTime="2020">Like here, so you notice at t1 </span><span class="line" data-startTime="2020">is a Dart list that will map </span><span class="line" data-startTime="2024">to a JavaScript array. </span><span class="line" data-startTime="2026">So you can just do a direct </span><span class="line" data-startTime="2026">JavaScript array axis. </span><span class="line" data-startTime="2031">And the same for call here. </span><span class="line" data-startTime="2034">It knows that it's </span><span class="line" data-startTime="2034">a Dart list. </span><span class="line" data-startTime="2036">That means it knows it's a </span><span class="line" data-startTime="2036">JavaScript array at runtime. </span><span class="line" data-startTime="2040">So you can just call the push </span><span class="line" data-startTime="2040">method, which is something </span><span class="line" data-startTime="2043">that is on the JavaScript array </span><span class="line" data-startTime="2043">prototype by default. </span></p>

<p class="speaker"><span class="line" data-starttime="2048"><span class="speakerName">Seth Ladd</span>: And you can do this </span><span class="line" data-startTime="2048">because you've globally </span><span class="line" data-startTime="2050">analyzed the program and </span><span class="line" data-startTime="2050">you know what t1 is. </span></p>

<p class="speaker"><span class="line" data-starttime="2053"><span class="speakerName">Nicolas Geoffray</span>: Exactly. </span></p>

<p class="speaker"><span class="line" data-starttime="2055"><span class="speakerName">Seth Ladd</span>: That is awesome. </span><span class="line" data-startTime="2056">That is so cool. </span></p>

<p class="speaker"><span class="line" data-starttime="2057"><span class="speakerName">Nicolas Geoffray</span>: And we also </span><span class="line" data-startTime="2057">know that all the [INAUDIBLE] </span><span class="line" data-startTime="2060">of add constraints consuming </span><span class="line" data-startTime="2060">to pass an array </span><span class="line" data-startTime="2064">here, or a Dart list. </span></p>

<p class="speaker"><span class="line" data-starttime="2066"><span class="speakerName">Seth Ladd</span>: So that's actually </span><span class="line" data-startTime="2066">really good key point. </span><span class="line" data-startTime="2069">Again, when we say global type </span><span class="line" data-startTime="2069">inferencing, you mean not just </span><span class="line" data-startTime="2073">obviously inside a function, but </span><span class="line" data-startTime="2073">also everyone, and we mean </span><span class="line" data-startTime="2077">everybody who calls into </span><span class="line" data-startTime="2077">this function. </span><span class="line" data-startTime="2079">You know what they're passing </span><span class="line" data-startTime="2079">in, so you make a whole bunch </span><span class="line" data-startTime="2081">of assumptions then inside </span><span class="line" data-startTime="2081">the function. </span></p>

<p class="speaker"><span class="line" data-starttime="2084"><span class="speakerName">Nicolas Geoffray</span>: Yeah. </span><span class="line" data-startTime="2084">That's correct. </span></p>

<p class="speaker"><span class="line" data-starttime="2085"><span class="speakerName">Seth Ladd</span>: Yeah, cool. </span><span class="line" data-startTime="2087">That to me sounds like one of </span><span class="line" data-startTime="2087">the major differences between </span><span class="line" data-startTime="2092">how far V8's able to go and how </span><span class="line" data-startTime="2092">far dart2js or the VM is </span><span class="line" data-startTime="2095">able to go, based on &mdash; </span><span class="line" data-startTime="2098">we really have a closed world </span><span class="line" data-startTime="2098">assumption when we're thinking </span><span class="line" data-startTime="2101">about Dart applications. </span></p>

<p class="speaker"><span class="line" data-starttime="2103"><span class="speakerName">Nicolas Geoffray</span>: That's </span><span class="line" data-startTime="2103">basically it. </span><span class="line" data-startTime="2104">And since it's very </span><span class="line" data-startTime="2104">structured, it's </span><span class="line" data-startTime="2106">very easy to analyze. </span><span class="line" data-startTime="2107">Well, it's relatively </span><span class="line" data-startTime="2107">easy to analyze. </span><span class="line" data-startTime="2109">It's definitely easier </span><span class="line" data-startTime="2109">than JavaScript code. </span></p>

<p class="speaker"><span class="line" data-starttime="2112"><span class="speakerName">Seth Ladd</span>: So here's an </span><span class="line" data-startTime="2112">interesting point. </span><span class="line" data-startTime="2116">Your global type inferencing </span><span class="line" data-startTime="2116">system does not respect type </span><span class="line" data-startTime="2120">annotations at all, due to the </span><span class="line" data-startTime="2120">semantics of the types or the </span><span class="line" data-startTime="2124">type annotations. </span><span class="line" data-startTime="2125">So I means I could write a </span><span class="line" data-startTime="2125">program with zero type </span><span class="line" data-startTime="2128">annotations and still get the </span><span class="line" data-startTime="2128">exact same benefits from </span><span class="line" data-startTime="2132">dart2js today. </span></p>

<p class="speaker"><span class="line" data-starttime="2134"><span class="speakerName">Nicolas Geoffray</span>: Yeah. </span><span class="line" data-startTime="2135">Same benefits, and the same </span><span class="line" data-startTime="2135">applies to the VM. </span></p>

<p class="speaker"><span class="line" data-starttime="2138"><span class="speakerName">Seth Ladd</span>: Yeah. </span><span class="line" data-startTime="2138">That's a great point. </span></p>

<p class="speaker"><span class="line" data-starttime="2139"><span class="speakerName">Nicolas Geoffray</span>: The VM </span><span class="line" data-startTime="2139">doesn't look at type </span><span class="line" data-startTime="2140">annotations either. </span><span class="line" data-startTime="2141">So type annotations is really a </span><span class="line" data-startTime="2141">tool for the developer to do </span><span class="line" data-startTime="2146">refactoring and share some code </span><span class="line" data-startTime="2146">with other developers. </span></p>

<p class="speaker"><span class="line" data-starttime="2150"><span class="speakerName">Seth Ladd</span>: So it sounds like </span><span class="line" data-startTime="2150">if I as a developer want to </span><span class="line" data-startTime="2153">take advantage of some of these </span><span class="line" data-startTime="2153">nice new inferencing </span><span class="line" data-startTime="2156">optimizations, just make sure </span><span class="line" data-startTime="2156">that I assign a variable the </span><span class="line" data-startTime="2160">same type all the time, and </span><span class="line" data-startTime="2160">dart2js will respect that. </span></p>

<p class="speaker"><span class="line" data-starttime="2165"><span class="speakerName">Nicolas Geoffray</span>: Yeah. </span><span class="line" data-startTime="2165">There are some couple of things </span><span class="line" data-startTime="2165">that will make dart2js </span><span class="line" data-startTime="2168">very happy. </span><span class="line" data-startTime="2168">So if you start assigning the </span><span class="line" data-startTime="2168">same thing to a variable or a </span><span class="line" data-startTime="2172">field, it will be able to apply </span><span class="line" data-startTime="2176">optimization based on it. </span></p>

<p class="speaker"><span class="line" data-starttime="2178"><span class="speakerName">Seth Ladd</span>: So for everyone </span><span class="line" data-startTime="2178">following at home, use final </span><span class="line" data-startTime="2181">and don't change field types, </span><span class="line" data-startTime="2181">and you'll be much happier. </span></p>

<p class="speaker"><span class="line" data-starttime="2186"><span class="speakerName">Nicolas Geoffray</span>: And if you </span><span class="line" data-startTime="2186">have a field that is supposed </span><span class="line" data-startTime="2189">to hold a number, make sure </span><span class="line" data-startTime="2189">it holds a number. </span><span class="line" data-startTime="2192">And it can never be null. </span><span class="line" data-startTime="2198">So the Dart VM &mdash; </span><span class="line" data-startTime="2200">it shouldn't affect </span><span class="line" data-startTime="2200">the Dart VM much. </span><span class="line" data-startTime="2203">But for dart2js, it's very </span><span class="line" data-startTime="2203">important because of what's </span><span class="line" data-startTime="2205">happening in JavaScript. </span><span class="line" data-startTime="2206">In JavaScript, when you </span><span class="line" data-startTime="2206">do null plus 42, you </span><span class="line" data-startTime="2209">actually get 42. </span><span class="line" data-startTime="2210">To the null gets </span><span class="line" data-startTime="2210">converted to 0. </span></p>

<p class="speaker"><span class="line" data-starttime="2214"><span class="speakerName">Seth Ladd</span>: That's logical. </span></p>

<p class="speaker"><span class="line" data-starttime="2215"><span class="speakerName">Nicolas Geoffray</span>: In Dart, null </span><span class="line" data-startTime="2215">plus should throw you a </span><span class="line" data-startTime="2220">null pointer exception. </span><span class="line" data-startTime="2223">So if dart2js knows that this </span><span class="line" data-startTime="2223">field is always a number, it </span><span class="line" data-startTime="2229">won't have to do any checking. </span></p>

<p class="speaker"><span class="line" data-starttime="2233"><span class="speakerName">Seth Ladd</span>: So what I'm thinking </span><span class="line" data-startTime="2233">about now is when I </span><span class="line" data-startTime="2235">have classes that have fields </span><span class="line" data-startTime="2235">that should be numbers, make </span><span class="line" data-startTime="2239">sure I initialize them in </span><span class="line" data-startTime="2239">the initializer list. </span></p>

<p class="speaker"><span class="line" data-starttime="2245"><span class="speakerName">Nicolas Geoffray</span>: In the </span><span class="line" data-startTime="2245">initializer list, or where the </span><span class="line" data-startTime="2249">field is declared. </span><span class="line" data-startTime="2252">It makes the type </span><span class="line" data-startTime="2252">inferencing &mdash; </span><span class="line" data-startTime="2255">it makes the life of the type </span><span class="line" data-startTime="2255">inferencing a lot easier. </span></p>

<p class="speaker"><span class="line" data-starttime="2259"><span class="speakerName">Seth Ladd</span>: Wow, that </span><span class="line" data-startTime="2259">is a great tip. </span><span class="line" data-startTime="2260">I was going to ask is there </span><span class="line" data-startTime="2260">anything else that I need to </span><span class="line" data-startTime="2263">do as a developer to write code </span><span class="line" data-startTime="2263">in a special way to take </span><span class="line" data-startTime="2267">advantage of this. </span><span class="line" data-startTime="2267">And so the good tip is, if I'm </span><span class="line" data-startTime="2267">dealing with numbers, make </span><span class="line" data-startTime="2270">sure they're always initialized </span><span class="line" data-startTime="2270">to a number, and </span><span class="line" data-startTime="2271">don't change them from a number </span><span class="line" data-startTime="2271">to something else. </span></p>

<p class="speaker"><span class="line" data-starttime="2274"><span class="speakerName">Nicolas Geoffray</span>: Yeah. </span><span class="line" data-startTime="2276">Keep your fields sane. </span><span class="line" data-startTime="2279">That's what you should say. </span></p>

<p class="speaker"><span class="line" data-starttime="2281"><span class="speakerName">Seth Ladd</span>: Well I really, </span><span class="line" data-startTime="2281">really appreciate this. </span><span class="line" data-startTime="2284">This video is recorded. </span><span class="line" data-startTime="2285">We're going to post it up </span><span class="line" data-startTime="2285">for everyone to watch. </span><span class="line" data-startTime="2287">And so I am very encouraged </span><span class="line" data-startTime="2287">and happy to see the bumps </span><span class="line" data-startTime="2291">that you and your team are able </span><span class="line" data-startTime="2291">to push out for dart2js, </span><span class="line" data-startTime="2294">so excellent work there. </span><span class="line" data-startTime="2297">Can we expect more benchmarks? </span><span class="line" data-startTime="2299">And what we expect in terms of </span><span class="line" data-startTime="2299">how much you're rolling out </span><span class="line" data-startTime="2306">this type inferencing? </span></p>

<p class="speaker"><span class="line" data-starttime="2308"><span class="speakerName">Nicolas Geoffray</span>: So </span><span class="line" data-startTime="2308">it just started. </span> <span class="line" data-startTime="2310">It's been two weeks since we </span><span class="line" data-startTime="2310">started on type inferencing. </span> <span class="line" data-startTime="2313">And right now it's </span><span class="line" data-startTime="2313">pretty naive. </span> <span class="line" data-startTime="2316">There's a lot of improvements we </span><span class="line" data-startTime="2316">know we can do, except that </span><span class="line" data-startTime="2321">it gets more and more complex </span><span class="line" data-startTime="2321">to implement. </span> <span class="line" data-startTime="2328">We still have the same bar. </span> <span class="line" data-startTime="2330">We were generating JavaScript </span><span class="line" data-startTime="2330">code, and what we want is </span><span class="line" data-startTime="2333">actually to be as fast as </span><span class="line" data-startTime="2333">handwritten JavaScript code. </span> <span class="line" data-startTime="2337">And we're getting </span><span class="line" data-startTime="2337">closer to that. </span></p>

<p><span class="line" data-startTime="2339">If you look at DeltaBlue, </span><span class="line" data-startTime="2339">that's what's happening. </span> <span class="line" data-startTime="2343">We have some other benchmarks, </span><span class="line" data-startTime="2343">and we're getting close to the </span><span class="line" data-startTime="2347">same performance. </span> <span class="line" data-startTime="2349">They need more work, </span><span class="line" data-startTime="2349">obviously. </span> <span class="line" data-startTime="2351">The reason why they're not </span><span class="line" data-startTime="2351">public yet, those benchmarks, </span><span class="line" data-startTime="2355">is because publishing </span><span class="line" data-startTime="2355">a new benchmark is &mdash; </span><span class="line" data-startTime="2359">I mean, we need to make </span><span class="line" data-startTime="2359">sure they're relevant. </span> <span class="line" data-startTime="2362">And we need to make sure that </span><span class="line" data-startTime="2362">they apply to JavaScript and </span><span class="line" data-startTime="2365">Dart, and both versions have </span><span class="line" data-startTime="2365">equivalent functionalities and </span><span class="line" data-startTime="2371">stuff like that. </span> <span class="line" data-startTime="2373">So it's not that [INAUDIBLE] to </span><span class="line" data-startTime="2373">publish those benchmarks. </span></p>

<p class="speaker"><span class="line" data-starttime="2376"><span class="speakerName">Seth Ladd</span>: Right, but I get the </span><span class="line" data-startTime="2376">sense we'll see more over </span><span class="line" data-startTime="2378">time as we've tested them out </span><span class="line" data-startTime="2378">and making sure they're </span><span class="line" data-startTime="2383">relevant and correct. </span></p>

<p class="speaker"><span class="line" data-starttime="2384"><span class="speakerName">Nicolas Geoffray</span>: Yes. </span><span class="line" data-startTime="2385">I mean, the V8 benchmark suite </span><span class="line" data-startTime="2385">that is now Octane benchmark </span><span class="line" data-startTime="2389">suite, it took some time </span><span class="line" data-startTime="2389">to publish it. </span><span class="line" data-startTime="2393">It's not super obvious that all </span><span class="line" data-startTime="2393">those benchmarks actually </span><span class="line" data-startTime="2397">are relevant initially. </span></p>

<p class="speaker"><span class="line" data-starttime="2400"><span class="speakerName">Seth Ladd</span>: Well I like </span><span class="line" data-startTime="2400">what I see so far. </span> <span class="line" data-startTime="2404">Dart developers can take </span><span class="line" data-startTime="2404">advantage of this today. </span> <span class="line" data-startTime="2406">This is code that has </span><span class="line" data-startTime="2406">been checked in. </span> <span class="line" data-startTime="2409">When you get the dart SDK and </span><span class="line" data-startTime="2409">you compile the JavaScript, </span><span class="line" data-startTime="2414">they're going to see these </span><span class="line" data-startTime="2414">improvements, or at least the </span><span class="line" data-startTime="2416">beginnings of these </span><span class="line" data-startTime="2416">improvements. </span> <span class="line" data-startTime="2417">So this stuff is real </span><span class="line" data-startTime="2417">and available today. </span></p>

<p><span class="line" data-startTime="2422">Well, thank you on the behalf </span><span class="line" data-startTime="2422">of the Dartisans community. </span> <span class="line" data-startTime="2424">Nicolas, thanks for joining </span><span class="line" data-startTime="2424">us today and </span><span class="line" data-startTime="2426">preparing these slides. </span> <span class="line" data-startTime="2427">It was a great walkthrough, and </span><span class="line" data-startTime="2427">I really appreciate it and </span><span class="line" data-startTime="2429">learned a ton of stuff myself. </span> <span class="line" data-startTime="2432">So hopefully we'll have you back </span><span class="line" data-startTime="2432">again later when we've </span><span class="line" data-startTime="2436">got other cool stuff to show </span><span class="line" data-startTime="2436">from the dart2js world. </span></p>

<p class="speaker"><span class="line" data-starttime="2439"><span class="speakerName">Nicolas Geoffray</span>: My pleasure. </span><span class="line" data-startTime="2440">Maybe tomorrow. </span></p>

<p class="speaker"><span class="line" data-starttime="2443"><span class="speakerName">Seth Ladd</span>: You guys are fast. </span><span class="line" data-startTime="2445">Well thank you very much and </span><span class="line" data-startTime="2445">we'll see you next time. </span><span class="line" data-startTime="2448">Bye, Nicolas. </span></p>

<p class="speaker"><span class="line" data-starttime="2449"><span class="speakerName">Nicolas Geoffray</span>: See you. </span></p>