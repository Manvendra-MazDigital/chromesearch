<p><span class="line" data-startTime="3">Hi, my name is Brian Kennish. </span> <span class="line" data-startTime="3">I'm a developer advocate on the Google Chrome </span><span class="line" data-startTime="7">team. </span> <span class="line" data-startTime="7">And I'm going to show you how to build Google </span><span class="line" data-startTime="8">Chrome Extensions. </span> <span class="line" data-startTime="8">We'll start out with an overview of extension </span><span class="line" data-startTime="11">building. </span> <span class="line" data-startTime="11">Then, we'll walk through some code and put </span><span class="line" data-startTime="13">together an example step by step. </span> <span class="line" data-startTime="13">But before we get to the technical stuff, </span><span class="line" data-startTime="17">let's talk about what extensions are. </span> <span class="line" data-startTime="17">Google Chrome Extensions are mostly small </span><span class="line" data-startTime="20">programs that add bits of functionality to </span><span class="line" data-startTime="20">Google Chrome. </span> <span class="line" data-startTime="23">They install instantly without a browser restart. </span> <span class="line" data-startTime="23">And, like Google Chrome, they update silently </span><span class="line" data-startTime="28">when new versions are available. </span> <span class="line" data-startTime="28">We designed the extension system with web </span><span class="line" data-startTime="32">developers in mind. </span></p>

<p><span class="line" data-startTime="32">If you can create webpages, you know pretty </span><span class="line" data-startTime="35">much all you need to know to create Google </span><span class="line" data-startTime="35">Chrome extensions. </span> <span class="line" data-startTime="38">In fact, extensions are implemented with nothing </span><span class="line" data-startTime="38">but standard web technologies &mdash; HTML, CSS, </span><span class="line" data-startTime="45">JavaScript, and so on. </span> <span class="line" data-startTime="45">An extension is a compressed directory &mdash; a </span><span class="line" data-startTime="48">signed zip, to be exact &mdash; with a bunch of </span><span class="line" data-startTime="48">web files in it. </span> <span class="line" data-startTime="51">The one file every extension has to have is </span><span class="line" data-startTime="51">a manifest file. </span> <span class="line" data-startTime="55">It's also the one file that has to have a </span><span class="line" data-startTime="55">particular name, which is "manifest.json". </span> <span class="line" data-startTime="60">As the name implies, the manifest file is </span><span class="line" data-startTime="60">JSON-formatted data &mdash; specifically, metadata </span><span class="line" data-startTime="64">that describes the extension, lists permissions, </span><span class="line" data-startTime="64">and points to the extension's other components. </span> <span class="line" data-startTime="69">Those components are what give the extension </span><span class="line" data-startTime="69">its functionality. </span> <span class="line" data-startTime="72">An extension includes one or more of the following </span><span class="line" data-startTime="72">components. </span> <span class="line" data-startTime="76">Browser actions and page actions are the two </span><span class="line" data-startTime="76">UI surfaces the extension system ships with </span><span class="line" data-startTime="79">initially. </span> <span class="line" data-startTime="79">A browser action appears in the toolbar of </span><span class="line" data-startTime="83">every tab. </span></p>

<p><span class="line" data-startTime="83">A page action selectively appears in the omnibox </span><span class="line" data-startTime="86">and can be toggled on or off for each tab. </span> <span class="line" data-startTime="86">An extension can only have one UI surface </span><span class="line" data-startTime="91">or the other. </span> <span class="line" data-startTime="91">We'd like to encourage extension developers </span><span class="line" data-startTime="94">to be as minimal in their design decisions </span><span class="line" data-startTime="94">as the Google Chrome team is. </span> <span class="line" data-startTime="98">Content scripts are arbitrary CSS and JavaScript </span><span class="line" data-startTime="98">that are injected into selected pages. </span> <span class="line" data-startTime="103">They're similar to user scripts and can be </span><span class="line" data-startTime="103">used as a UI alternative to browser and page </span><span class="line" data-startTime="108">actions. </span> <span class="line" data-startTime="108">Background pages are long-running scripts </span><span class="line" data-startTime="110">that help you manage state and coordinate </span><span class="line" data-startTime="110">tasks across extension components. </span> <span class="line" data-startTime="115">As an extension gets more complex, it tends </span><span class="line" data-startTime="115">to need a background page. </span></p>

<p><span class="line" data-startTime="118">In addition to these components that are specific </span><span class="line" data-startTime="118">to Google Chrome Extensions, you can bundle </span><span class="line" data-startTime="123">any other web files with your extension &mdash; images, </span><span class="line" data-startTime="123">JavaScript libraries, Flash movies, whatever </span><span class="line" data-startTime="129">it is your extension needs. </span> <span class="line" data-startTime="129">The extension API is small and easy to learn. </span> <span class="line" data-startTime="134">It currently defines about 40 objects and </span><span class="line" data-startTime="134">40 methods. </span> <span class="line" data-startTime="139">"chrome" is the name of the top-level object </span><span class="line" data-startTime="139">automatically exposed to all extensions. </span> <span class="line" data-startTime="143">The API is split into six modules, which are </span><span class="line" data-startTime="143">represented by objects contained in the "chrome" </span><span class="line" data-startTime="148">object. </span> <span class="line" data-startTime="148">"chrome.extension" has properties and methods </span><span class="line" data-startTime="152">that let you send messages to communicate </span><span class="line" data-startTime="152">between extension components and resolve the </span><span class="line" data-startTime="157">URLs of extension files. </span> <span class="line" data-startTime="157">"chrome.browserAction" lets you set the appearance </span><span class="line" data-startTime="161">of browser actions and their badges, which </span><span class="line" data-startTime="161">are mini text areas overlaid on browser actions. </span></p>

<p><span class="line" data-startTime="166">"chrome.pageAction" lets you enable and disable </span><span class="line" data-startTime="166">page actions. </span> <span class="line" data-startTime="171">"chrome.windows" lets you open, close, look </span><span class="line" data-startTime="171">up, and update browser windows. </span> <span class="line" data-startTime="175">It requires "tabs" permission in your manifest </span><span class="line" data-startTime="175">file. </span> <span class="line" data-startTime="179">That's not a typo &mdash; windows and tabs are </span><span class="line" data-startTime="179">so closely related they share a common permission. </span> <span class="line" data-startTime="183">"chrome.tabs" lets you perform the same actions </span><span class="line" data-startTime="183">on tabs. </span> <span class="line" data-startTime="187">It also requires "tabs" permission. </span> <span class="line" data-startTime="187">And "chrome.bookmarks" lets you read from </span><span class="line" data-startTime="191">and write to the user's bookmark tree and </span><span class="line" data-startTime="191">requires "bookmarks" permission. </span> <span class="line" data-startTime="195">Now, let's try this stuff out by iteratively </span><span class="line" data-startTime="195">developing an extension. </span> <span class="line" data-startTime="198">Our extension will be a Google Chrome Twitter </span><span class="line" data-startTime="198">client, which we'll call Chritter. </span> <span class="line" data-startTime="202">First, we'll give the extension a basic, “hello </span><span class="line" data-startTime="202">world”-type UI. </span> <span class="line" data-startTime="206">Of course, we need a manifest file. </span></p>

<p><span class="line" data-startTime="206">In it, we specify the extension's name, version </span><span class="line" data-startTime="210">number, description, and icon. </span> <span class="line" data-startTime="210">For the UI part, we're going to pick a browser </span><span class="line" data-startTime="215">action because, well, we want our tweets handy </span><span class="line" data-startTime="215">at all times! </span><span class="line" data-startTime="218">We populate the browser-action fields with </span><span class="line" data-startTime="218">an icon that will appear in the toolbar, a </span><span class="line" data-startTime="222">tooltip that will appear when the user mouses </span><span class="line" data-startTime="222">over the icon, and a popup bubble that will </span><span class="line" data-startTime="226">appear when the user clicks on the icon. </span> <span class="line" data-startTime="226">For now, the popup is a trivial HTML file. </span> <span class="line" data-startTime="232">After installing our extension, we get &mdash; as </span><span class="line" data-startTime="232">advertised &mdash; an icon, a tooltip, and a popup. </span></p>

<p><span class="line" data-startTime="239">The popup asks: "Wouldn't it be nice to see </span><span class="line" data-startTime="239">some tweets here?" </span><span class="line" data-startTime="242">And I think it would be nice, so let's add </span><span class="line" data-startTime="242">some! </span><span class="line" data-startTime="244">We'll do so by fetching Twitter's public timeline </span><span class="line" data-startTime="244">with XMLHttpRequest. </span> <span class="line" data-startTime="249">Back in our manifest file, we ask for permission </span><span class="line" data-startTime="249">to make cross-origin requests to twitter.com </span><span class="line" data-startTime="254">so we can access Twitter's API. </span> <span class="line" data-startTime="254">We ask for "tabs" permission, as well, so </span><span class="line" data-startTime="258">we can open UI links in new tabs. </span> <span class="line" data-startTime="258">And in our popup file, we beef up the HTML </span><span class="line" data-startTime="262">by inserting a title and a template to present </span><span class="line" data-startTime="262">the attributes of each tweet &mdash; a link to </span><span class="line" data-startTime="268">the user's profile, their image and name, </span><span class="line" data-startTime="268">and the tweet itself. </span> <span class="line" data-startTime="273">We also have new JavaScript for retrieving </span><span class="line" data-startTime="273">and displaying the timeline. </span> <span class="line" data-startTime="276">When the load event fires, we run an "init" </span><span class="line" data-startTime="276">function to grab references to the different </span><span class="line" data-startTime="280">template elements via XPath. </span></p>

<p><span class="line" data-startTime="280">That function hands control over to another </span><span class="line" data-startTime="284">function to do the XHR work. </span> <span class="line" data-startTime="284">"getTweets" issues a simple request for a </span><span class="line" data-startTime="290">JSON feed, and in turn, hands control over </span><span class="line" data-startTime="290">to the callback function "processTweets". </span> <span class="line" data-startTime="295">The processing function deserializes the incoming </span><span class="line" data-startTime="295">JSON using V8's builtin JSON support and stores </span><span class="line" data-startTime="302">the result in an array. </span> <span class="line" data-startTime="302">Iterating through the array of tweets, the </span><span class="line" data-startTime="306">"update" function assigns each template attribute </span><span class="line" data-startTime="306">and appends the marked-up tweet to the popup. </span> <span class="line" data-startTime="311">Our extension has a lot more going on now, </span><span class="line" data-startTime="311">with a polished UI and the most recent public </span><span class="line" data-startTime="316">tweets to show off. </span></p>

<p><span class="line" data-startTime="316">Our implementation isn't ideal, though. </span> <span class="line" data-startTime="320">As a last step, let's improve the extension's </span><span class="line" data-startTime="320">performance and functionality by refactoring </span><span class="line" data-startTime="323">our code. </span> <span class="line" data-startTime="323">Namely, we should turn our popup into a dumb </span><span class="line" data-startTime="326">view so it only knows how to update its display </span><span class="line" data-startTime="326">and offload the rest of the work to a background </span><span class="line" data-startTime="331">page. </span> <span class="line" data-startTime="331">We'll go ahead and add a background page to </span><span class="line" data-startTime="333">our manifest. </span> <span class="line" data-startTime="333">Then, we can strip the XHR code out of our </span><span class="line" data-startTime="336">popup. </span> <span class="line" data-startTime="336">In place of that code, we throw in a reference </span><span class="line" data-startTime="339">to the background page, which is returned </span><span class="line" data-startTime="339">by the "getBackgroundPage" method. </span> <span class="line" data-startTime="343">The popup doesn't collect tweets anymore, </span><span class="line" data-startTime="343">so we use the background reference to iterate </span><span class="line" data-startTime="347">through the available tweets instead. </span></p>

<p><span class="line" data-startTime="347">We move the XHR code to its new digs in the </span><span class="line" data-startTime="352">background page, but not without a couple </span><span class="line" data-startTime="352">upgrades. </span> <span class="line" data-startTime="355">I mentioned we could improve performance and </span><span class="line" data-startTime="355">functionality and here's where we will. </span> <span class="line" data-startTime="358">Since the background page isn't tied to any </span><span class="line" data-startTime="358">DOM event, the page can fetch tweets on a </span><span class="line" data-startTime="362">continuous loop. </span> <span class="line" data-startTime="362">That way, we can batch tweets up and have </span><span class="line" data-startTime="365">them ready before the user even invokes the </span><span class="line" data-startTime="365">popup. </span> <span class="line" data-startTime="367">We specify a frequency for fetching &mdash; 10 </span><span class="line" data-startTime="367">seconds for demo purposes &mdash; and manage the </span><span class="line" data-startTime="373">process with the "setInterval" method. </span> <span class="line" data-startTime="373">While we're at it, we can also spiff up the </span><span class="line" data-startTime="378">UI. </span></p>

<p><span class="line" data-startTime="378">We now have a variable number of batched tweets, </span><span class="line" data-startTime="381">which is a perfect candidate for display with </span><span class="line" data-startTime="381">a browser-action badge. </span> <span class="line" data-startTime="384">We style the badge with "setBadgeBackgroundColor" </span><span class="line" data-startTime="384">and pass in the number of unread tweets with </span><span class="line" data-startTime="390">"setBadgeText". </span> <span class="line" data-startTime="390">Our extension doesn't look a whole lot different </span><span class="line" data-startTime="394">right away. </span> <span class="line" data-startTime="394">But if we let it think for a bit, we see a </span><span class="line" data-startTime="396">badge that dynamically updates the tweet count. </span> <span class="line" data-startTime="396">The popup should work identically, although </span><span class="line" data-startTime="401">we potentially have a lot more tweets to scroll </span><span class="line" data-startTime="401">through now. </span> <span class="line" data-startTime="405">While this version of Chritter makes for a </span><span class="line" data-startTime="405">nice toy, there are some features we'd want </span><span class="line" data-startTime="408">to add for it to be truly useful. </span></p>

<p><span class="line" data-startTime="408">On the top of that list would be incorporating </span><span class="line" data-startTime="412">the user's friend timeline &mdash; rather than </span><span class="line" data-startTime="412">the public timeline &mdash; which would require </span><span class="line" data-startTime="415">baking OAuth into the extension. </span> <span class="line" data-startTime="415">Things can get a little hairy there. </span> <span class="line" data-startTime="419">Luckily, we've already done the heavy lifting </span><span class="line" data-startTime="419">for you and have an example of Chritter with </span><span class="line" data-startTime="423">OAuth support. </span> <span class="line" data-startTime="423">We also have a further example that handles </span><span class="line" data-startTime="426">custom autoupdating. </span> <span class="line" data-startTime="426">To download that code, the code you just saw, </span><span class="line" data-startTime="430">and more, go to code.google.com/chrome/extensions. </span> <span class="line" data-startTime="430">Thanks for watching and have fun building </span><span class="line" data-startTime="437">Google Chrome Extensions! </span></p>

<p></p>