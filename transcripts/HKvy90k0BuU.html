<p class="speaker"><span class="line" data-starttime="0"><span class="speakerName">James Hawkins</span>: My name </span><span class="line" data-startTime="0">is James Hawkins. </span> <span class="line" data-startTime="3">I'm the tech lead of the Chrome </span><span class="line" data-startTime="3">team in Los Angeles. </span> <span class="line" data-startTime="5">And for the past year, we've </span><span class="line" data-startTime="5">been working very closely with </span><span class="line" data-startTime="8">the Google+ Photos team on a new </span><span class="line" data-startTime="8">product that's the Google+ </span><span class="line" data-startTime="12">Photos Chrome app. </span> <span class="line" data-startTime="14">So this is a Chrome </span><span class="line" data-startTime="14">packaged app. </span> <span class="line" data-startTime="17">And if you'll remember, packaged </span><span class="line" data-startTime="17">apps were announced a </span><span class="line" data-startTime="20">little over a year ago. </span> <span class="line" data-startTime="21">And this is the key piece of </span><span class="line" data-startTime="21">Chrome's app platform. </span> <span class="line" data-startTime="27">Packaged apps give you the </span><span class="line" data-startTime="27">ability to have extended </span><span class="line" data-startTime="30">permissions, you can do </span><span class="line" data-startTime="30">a little bit more. </span> <span class="line" data-startTime="32">You can have a more native look </span><span class="line" data-startTime="32">and feel with your app. </span></p>

<p><span class="line" data-startTime="35">It's a step above what </span><span class="line" data-startTime="35">you can do with the </span><span class="line" data-startTime="37">web platform today. </span> <span class="line" data-startTime="39">So we're going to talk about </span><span class="line" data-startTime="39">Google+ Photos Chrome app. </span> <span class="line" data-startTime="42">Actually, instead of </span><span class="line" data-startTime="42">talking about it, </span><span class="line" data-startTime="43">let's cut to the demo. </span> <span class="line" data-startTime="58">So this is Google+ Photos, </span><span class="line" data-startTime="58">the Chrome app. </span> <span class="line" data-startTime="61">This is my personal account. </span> <span class="line" data-startTime="62">I've got all my photos </span><span class="line" data-startTime="62">loaded up into it. </span> <span class="line" data-startTime="65">We're doing some </span><span class="line" data-startTime="65">nice scrolling. </span> <span class="line" data-startTime="67">And if you note, I'm on </span><span class="line" data-startTime="67">a Pixel right here. </span> <span class="line" data-startTime="69">So we obviously have touchscreen </span><span class="line" data-startTime="69">capabilities to do </span><span class="line" data-startTime="71">scrolling with this. </span></p>

<p><span class="line" data-startTime="74">OK, so we're viewing </span><span class="line" data-startTime="74">some photos. </span> <span class="line" data-startTime="76">Let's say I want to go in and </span><span class="line" data-startTime="76">check out a particular photo. </span> <span class="line" data-startTime="79">All right, I've got this photo, </span><span class="line" data-startTime="79">and I've got my nice </span><span class="line" data-startTime="81">information, my tags, </span><span class="line" data-startTime="81">and details. </span> <span class="line" data-startTime="84">Very neat. </span> <span class="line" data-startTime="87">But I just went and used my </span><span class="line" data-startTime="87">camera and took a bunch of </span><span class="line" data-startTime="90">pictures, and I've got </span><span class="line" data-startTime="90">it on an SD card. </span> <span class="line" data-startTime="92">I'd like to upload these </span><span class="line" data-startTime="92">to the Cloud. </span> <span class="line" data-startTime="94">I want to share with </span><span class="line" data-startTime="94">my friends. </span> <span class="line" data-startTime="94">So let's go ahead and do that. </span> <span class="line" data-startTime="104">Close this. </span> <span class="line" data-startTime="108">So here we go. </span> <span class="line" data-startTime="109">The app was already open. </span> <span class="line" data-startTime="111">And it's already started </span><span class="line" data-startTime="111">importing photos, and it's </span><span class="line" data-startTime="113">going to start uploading them. </span></p>

<p><span class="line" data-startTime="115">We can view the ones that </span><span class="line" data-startTime="115">are on this SD card. </span> <span class="line" data-startTime="119">Cool. </span> <span class="line" data-startTime="120">So these are the pictures </span><span class="line" data-startTime="120">that I just took. </span> <span class="line" data-startTime="122">Got a little notification that </span><span class="line" data-startTime="122">we had some photos copied, and </span><span class="line" data-startTime="125">they're being uploaded </span><span class="line" data-startTime="125">right now. </span> <span class="line" data-startTime="130">We got a notification that we're </span><span class="line" data-startTime="130">finding the best photos, </span><span class="line" data-startTime="132">and there we go. </span> <span class="line" data-startTime="133">What you just saw is something </span><span class="line" data-startTime="133">that you heard </span><span class="line" data-startTime="135">about in the keynote. </span> <span class="line" data-startTime="137">This is autocuration. </span></p>

<p><span class="line" data-startTime="138">So in the back end, Google said, </span><span class="line" data-startTime="138">we're looking at your </span><span class="line" data-startTime="142">photos, we want to see what </span><span class="line" data-startTime="142">are the best photos of the </span><span class="line" data-startTime="144">ones you just took. </span> <span class="line" data-startTime="145">Let's make it very simple for </span><span class="line" data-startTime="145">you to share the best photos </span><span class="line" data-startTime="149">that you have with your </span><span class="line" data-startTime="149">friends, your </span><span class="line" data-startTime="150">families, et cetera. </span> <span class="line" data-startTime="152">For example, this photo </span><span class="line" data-startTime="152">has been deemed to be </span><span class="line" data-startTime="155">underexposed. </span> <span class="line" data-startTime="156">Cool. </span> <span class="line" data-startTime="157">All right. </span> <span class="line" data-startTime="157">That's fine. </span> <span class="line" data-startTime="158">I'm not too picky. </span></p>

<p><span class="line" data-startTime="159">I just want the best </span><span class="line" data-startTime="159">photos to go up. </span> <span class="line" data-startTime="160">So we want to share these. </span> <span class="line" data-startTime="173">Cool. </span> <span class="line" data-startTime="173">I've shared it with my family. </span> <span class="line" data-startTime="175">Cool new photos. </span> <span class="line" data-startTime="188">And so these are the photos </span><span class="line" data-startTime="188">that I just shared. </span> <span class="line" data-startTime="192">We can change the name. </span> <span class="line" data-startTime="199">No, it's '13. </span> <span class="line" data-startTime="202">It is early after all. </span> <span class="line" data-startTime="204">Cool. </span> <span class="line" data-startTime="206">So this is Google+ Photos. </span> <span class="line" data-startTime="209">You've got the autocuration </span><span class="line" data-startTime="209">magic behind the scenes. </span> <span class="line" data-startTime="211">You've got a very </span><span class="line" data-startTime="211">slick interface. </span></p>

<p><span class="line" data-startTime="213">Very fast viewing of </span><span class="line" data-startTime="213">all your photos, </span><span class="line" data-startTime="216">just really nice scrolling. </span> <span class="line" data-startTime="218">And we're going to talk a bit </span><span class="line" data-startTime="218">today about what it took to </span><span class="line" data-startTime="222">develop this product </span><span class="line" data-startTime="222">as a Chrome </span><span class="line" data-startTime="224">packaged app on the platform. </span></p>

<p class="speaker"><span class="line" data-starttime="229"><span class="speakerName">Audience</span>: Is it available </span><span class="line" data-startTime="229">in the marketplace? </span></p>

<p class="speaker"><span class="line" data-starttime="231"><span class="speakerName">James Hawkins</span>: This is </span><span class="line" data-startTime="231">not available yet. </span> <span class="line" data-startTime="233">It'll be available soon. </span> <span class="line" data-startTime="236">So we started developing </span><span class="line" data-startTime="236">this product with a </span><span class="line" data-startTime="239">set of goals in mind. </span> <span class="line" data-startTime="240">What did we want </span><span class="line" data-startTime="240">to accomplish? </span><span class="line" data-startTime="243">When we started development, the </span><span class="line" data-startTime="243">only way to view photos in </span><span class="line" data-startTime="246">Chrome OS was through the file </span><span class="line" data-startTime="246">manager, and even then, that </span><span class="line" data-startTime="250">was not the best experience. </span> <span class="line" data-startTime="251">You could do some </span><span class="line" data-startTime="251">minimal editing. </span> <span class="line" data-startTime="253">You couldn't really </span><span class="line" data-startTime="253">share very easily. </span> <span class="line" data-startTime="255">And the viewing experience </span><span class="line" data-startTime="255">was just a stopgap. </span> <span class="line" data-startTime="259">That's not to say, </span><span class="line" data-startTime="259">it's not good. </span> <span class="line" data-startTime="260">But we wanted to do </span><span class="line" data-startTime="260">something better. </span></p>

<p><span class="line" data-startTime="262">We wanted a better photos </span><span class="line" data-startTime="262">experience for ChromeOS. </span> <span class="line" data-startTime="267">In addition, we wanted a place </span><span class="line" data-startTime="267">where the Google+ Photos team </span><span class="line" data-startTime="270">could experiment with new UI, </span><span class="line" data-startTime="270">new back end functionality </span><span class="line" data-startTime="274">like we're talking about </span><span class="line" data-startTime="274">with autocuration. </span> <span class="line" data-startTime="277">In fact, autocuration was not </span><span class="line" data-startTime="277">available to the public in the </span><span class="line" data-startTime="282">Google+ desktop until we just </span><span class="line" data-startTime="282">announced it at I/O </span><span class="line" data-startTime="285">a couple days ago. </span> <span class="line" data-startTime="286">And so this product was the </span><span class="line" data-startTime="286">only place where the </span><span class="line" data-startTime="290">autocuration team could see </span><span class="line" data-startTime="290">autocuration live, see how it </span><span class="line" data-startTime="293">worked out, get a lot of </span><span class="line" data-startTime="293">feedback on the feature. </span> <span class="line" data-startTime="296">And so this is going to continue </span><span class="line" data-startTime="296">to be one of the </span><span class="line" data-startTime="299">places where that feature </span><span class="line" data-startTime="299">development happens like </span><span class="line" data-startTime="302">sandboxed, if you will. </span> <span class="line" data-startTime="306">And coming from the Chrome team </span><span class="line" data-startTime="306">side of things, we wanted </span><span class="line" data-startTime="308">to make sure that the platform </span><span class="line" data-startTime="308">had everything that we needed </span><span class="line" data-startTime="312">in order to be very successful </span><span class="line" data-startTime="312">and very easy for people to </span><span class="line" data-startTime="315">develop apps. </span> <span class="line" data-startTime="316">What's missing? </span><span class="line" data-startTime="317">Could we identify it? </span><span class="line" data-startTime="318">What are the bugs? </span><span class="line" data-startTime="320">It's a very nascent platform, </span><span class="line" data-startTime="320">and a lot of the API's that </span><span class="line" data-startTime="323">are being developed are even, </span><span class="line" data-startTime="323">right now, in development. </span></p>

<p><span class="line" data-startTime="326">And we wanted to test them </span><span class="line" data-startTime="326">out, have a user for the </span><span class="line" data-startTime="329">platform instead of giving it to </span><span class="line" data-startTime="329">you guys, and you guys have </span><span class="line" data-startTime="333">to cut your teeth on it. </span> <span class="line" data-startTime="334">Which is not the best </span><span class="line" data-startTime="334">experience. </span> <span class="line" data-startTime="335">We wanted to do that ourselves </span><span class="line" data-startTime="335">to spare you guys some pain. </span> <span class="line" data-startTime="341">And as a part of that, as well, </span><span class="line" data-startTime="341">we are Chrome developers </span><span class="line" data-startTime="344">in addition to doing some </span><span class="line" data-startTime="344">of this front end stuff. </span> <span class="line" data-startTime="346">So when we did find areas that </span><span class="line" data-startTime="346">were lacking in the platform, </span><span class="line" data-startTime="349">we could go in and add those </span><span class="line" data-startTime="349">APIs that we were missing. </span> <span class="line" data-startTime="353">And I'll talk about one of those </span><span class="line" data-startTime="353">specifically later on. </span> <span class="line" data-startTime="359">So Chrome, as you know, has </span><span class="line" data-startTime="359">three core principles. </span></p>

<p><span class="line" data-startTime="363">You want your UI </span><span class="line" data-startTime="363">to be extremely </span><span class="line" data-startTime="365">quick, extremely fast. </span> <span class="line" data-startTime="366">You want animations to be </span><span class="line" data-startTime="366">very snappy and fluid. </span> <span class="line" data-startTime="369">When you have jink, you have </span><span class="line" data-startTime="369">stuttering, you have a really </span><span class="line" data-startTime="371">bad user experience. </span> <span class="line" data-startTime="372">It's jarring for the user. </span> <span class="line" data-startTime="375">Keeping your app very simple, </span><span class="line" data-startTime="375">to me, it means </span><span class="line" data-startTime="379">getting out of the way. </span> <span class="line" data-startTime="380">Get your UI out of the way of </span><span class="line" data-startTime="380">the user, out of the way of </span><span class="line" data-startTime="383">what they're trying to do. </span></p>

<p><span class="line" data-startTime="384">And sometimes that is actually </span><span class="line" data-startTime="384">the hardest thing to </span><span class="line" data-startTime="386">accomplish. </span> <span class="line" data-startTime="388">Security, obviously, is </span><span class="line" data-startTime="388">extremely important. </span> <span class="line" data-startTime="390">You want to keep your users </span><span class="line" data-startTime="390">secure not only from your app </span><span class="line" data-startTime="394">misbehaving but from malicious </span><span class="line" data-startTime="394">attackers that can use your </span><span class="line" data-startTime="401">app to harm your user. </span> <span class="line" data-startTime="403">You want to make sure that </span><span class="line" data-startTime="403">that is not possible. </span> <span class="line" data-startTime="405">So we took these principles to </span><span class="line" data-startTime="405">mind when we were developing </span><span class="line" data-startTime="408">in the app. </span> <span class="line" data-startTime="408">And the challenges that we faced </span><span class="line" data-startTime="408">when developing the app </span><span class="line" data-startTime="411">I'm going to frame around </span><span class="line" data-startTime="411">these core principles. </span> <span class="line" data-startTime="418">Speed. </span> <span class="line" data-startTime="419">You've got to be fast. </span></p>

<p><span class="line" data-startTime="420">Everybody wants to be fast. </span> <span class="line" data-startTime="424">One of the first problems we </span><span class="line" data-startTime="424">ran into was with having to </span><span class="line" data-startTime="428">have a client side photo and </span><span class="line" data-startTime="428">needing to know if we needed </span><span class="line" data-startTime="431">to upload it or not. </span> <span class="line" data-startTime="432">You obviously don't want to </span><span class="line" data-startTime="432">waste bandwidth if the user </span><span class="line" data-startTime="435">already has that photo </span><span class="line" data-startTime="435">in the Cloud. </span> <span class="line" data-startTime="437">And so the way we did that is </span><span class="line" data-startTime="437">to store SHA-512 hashes of </span><span class="line" data-startTime="441">these photos in the Cloud when </span><span class="line" data-startTime="441">it was already uploaded. </span></p>

<p><span class="line" data-startTime="444">And so when we have a new photo </span><span class="line" data-startTime="444">to upload, we have to </span><span class="line" data-startTime="447">calculate that hash to </span><span class="line" data-startTime="447">say hey, do you have </span><span class="line" data-startTime="449">this photo or not? </span><span class="line" data-startTime="450">And if not, we don't </span><span class="line" data-startTime="450">need to upload it. </span> <span class="line" data-startTime="456">So we have a little demo here. </span> <span class="line" data-startTime="458">This is a quite large image. </span> <span class="line" data-startTime="462">It's about 12 megabytes, </span><span class="line" data-startTime="462">I think. </span> <span class="line" data-startTime="464">And this is just one example </span><span class="line" data-startTime="464">of what the user could be </span><span class="line" data-startTime="466">uploading that we need </span><span class="line" data-startTime="466">to get the hash of. </span> <span class="line" data-startTime="470">And we found that the JavaScript </span><span class="line" data-startTime="470">implementation, </span><span class="line" data-startTime="473">while we could optimize it as </span><span class="line" data-startTime="473">much as we possibly could, it </span><span class="line" data-startTime="477">could never compare to a </span><span class="line" data-startTime="477">native implementation. </span> <span class="line" data-startTime="480">And we got that native </span><span class="line" data-startTime="480">implementation through Native </span><span class="line" data-startTime="483">Client, which allows </span><span class="line" data-startTime="483">you to run C++ </span><span class="line" data-startTime="485">binaries in your web app. </span></p>

<p><span class="line" data-startTime="487">It's a really amazing technology </span><span class="line" data-startTime="487">that is extremely </span><span class="line" data-startTime="490">useful, especially for these use </span><span class="line" data-startTime="490">cases where you need to do </span><span class="line" data-startTime="492">data processing, you want to get </span><span class="line" data-startTime="492">bare bones as close to the </span><span class="line" data-startTime="495">metal as possible. </span> <span class="line" data-startTime="497">So I'm going to do </span><span class="line" data-startTime="497">a little demo. </span> <span class="line" data-startTime="498">We have hashing done </span><span class="line" data-startTime="498">in JavaScript. </span> <span class="line" data-startTime="500">And we have hashing done </span><span class="line" data-startTime="500">in Native Client. </span> <span class="line" data-startTime="502">And we're going to get </span><span class="line" data-startTime="502">the timings of those. </span> <span class="line" data-startTime="504">And we'll see what the </span><span class="line" data-startTime="504">difference is. </span> <span class="line" data-startTime="510">OK. </span> <span class="line" data-startTime="511">Almost three seconds compared </span><span class="line" data-startTime="511">to 200 milliseconds. </span> <span class="line" data-startTime="514">That is an order of magnitude </span><span class="line" data-startTime="514">difference. </span> <span class="line" data-startTime="517">That's amazing. </span></p>

<p><span class="line" data-startTime="518">Not to mention the fact that </span><span class="line" data-startTime="518">Native Client doesn't block </span><span class="line" data-startTime="520">the UI, the main thread. </span> <span class="line" data-startTime="522">Whereas this JavaScript </span><span class="line" data-startTime="522">implementation does. </span> <span class="line" data-startTime="525">So if you're taking three </span><span class="line" data-startTime="525">seconds to hash an image, your </span><span class="line" data-startTime="528">user is doing nothing. </span> <span class="line" data-startTime="529">They're looking at your app </span><span class="line" data-startTime="529">not doing anything. </span> <span class="line" data-startTime="531">So Native Client saved </span><span class="line" data-startTime="531">us on this one. </span> <span class="line" data-startTime="534">And, in fact, with more </span><span class="line" data-startTime="534">native-like apps being </span><span class="line" data-startTime="538">produced for the web, I think </span><span class="line" data-startTime="538">we're going to see Native </span><span class="line" data-startTime="541">Client being used a </span><span class="line" data-startTime="541">tremendous amount. </span> <span class="line" data-startTime="543">One of the first big apps that </span><span class="line" data-startTime="543">was done with Native Client </span><span class="line" data-startTime="547">was actually games. </span></p>

<p><span class="line" data-startTime="548">That makes perfect sense. </span> <span class="line" data-startTime="549">You've got to have high, super </span><span class="line" data-startTime="549">high performance calculating </span><span class="line" data-startTime="552">with a lot of data. </span> <span class="line" data-startTime="561">So actually, I want to go in, </span><span class="line" data-startTime="561">and let's look at this and see </span><span class="line" data-startTime="563">how we hooked up with </span><span class="line" data-startTime="563">Native Client. </span> <span class="line" data-startTime="571">So we're going to go into </span><span class="line" data-startTime="571">the JavaScript. </span> <span class="line" data-startTime="578">And the meat of this is the </span><span class="line" data-startTime="578">NaCl hash for the NaCl </span><span class="line" data-startTime="582">implementation. </span> <span class="line" data-startTime="582">We'll ignore the JavaScript </span><span class="line" data-startTime="582">for now. </span> <span class="line" data-startTime="584">We're going to do document, </span><span class="line" data-startTime="584">the element ID file_io. </span> <span class="line" data-startTime="587">I/O. So let's go see </span><span class="line" data-startTime="587">what that was. </span> <span class="line" data-startTime="591">That is, I'm going to </span><span class="line" data-startTime="591">zoom this up so you </span><span class="line" data-startTime="592">guys can see it. </span> <span class="line" data-startTime="596">That's an embed of </span><span class="line" data-startTime="596">type X NaCl. </span></p>

<p><span class="line" data-startTime="600">This file_io.nmf is an </span><span class="line" data-startTime="600">NaCl manifest format. </span> <span class="line" data-startTime="604">And it specifies what </span><span class="line" data-startTime="604">the binary is for &mdash; </span><span class="line" data-startTime="608">I'm not going to open it up. </span> <span class="line" data-startTime="609">But it specifies what </span><span class="line" data-startTime="609">the binary is </span><span class="line" data-startTime="610">that needs to be run. </span> <span class="line" data-startTime="612">We communicate with this </span><span class="line" data-startTime="612">with postMessage. </span> <span class="line" data-startTime="616">So we postMessage the file </span><span class="line" data-startTime="616">name, and inside the </span><span class="line" data-startTime="619">implementation of the NaCl </span><span class="line" data-startTime="619">module, we take that file </span><span class="line" data-startTime="622">name, do the hashing on it in </span><span class="line" data-startTime="622">C++, that's compiled, and send </span><span class="line" data-startTime="627">a message back through the </span><span class="line" data-startTime="627">NaCl API to the app. </span> <span class="line" data-startTime="630">And we handle that </span><span class="line" data-startTime="630">message here. </span> <span class="line" data-startTime="633">So this is essentially </span><span class="line" data-startTime="633">how we were doing </span><span class="line" data-startTime="634">it in Native Client. </span></p>

<p><span class="line" data-startTime="635">It's actually really simple. </span> <span class="line" data-startTime="636">So this is what, maybe 10 </span><span class="line" data-startTime="636">lines total of code for </span><span class="line" data-startTime="640">handling this. </span> <span class="line" data-startTime="641">And C++ code on the </span><span class="line" data-startTime="641">other side. </span> <span class="line" data-startTime="644">The meat of it is getting the </span><span class="line" data-startTime="644">NaCl module built, which there </span><span class="line" data-startTime="647">are tons of tutorials </span><span class="line" data-startTime="647">out there. </span> <span class="line" data-startTime="648">It's not that hard. </span> <span class="line" data-startTime="659">Doesn't want to full screen. </span> <span class="line" data-startTime="666">OK, hold on. </span> <span class="line" data-startTime="680">Just one second. </span> <span class="line" data-startTime="688">Oh, yeah. </span> <span class="line" data-startTime="688">Thank you very much. </span> <span class="line" data-startTime="689">I was zoomed in. </span> <span class="line" data-startTime="700">So the next issue that we </span><span class="line" data-startTime="700">are running into is </span><span class="line" data-startTime="703">the data store layer. </span> <span class="line" data-startTime="704">So with Photos, there </span><span class="line" data-startTime="704">are users that </span><span class="line" data-startTime="706">have, say, 40,000 photos. </span></p>

<p><span class="line" data-startTime="709">This is a case that </span><span class="line" data-startTime="709">we have to handle. </span> <span class="line" data-startTime="710">It's very difficult. </span> <span class="line" data-startTime="712">And the fact that this app needs </span><span class="line" data-startTime="712">to be native, needs to </span><span class="line" data-startTime="715">act like a real app on your </span><span class="line" data-startTime="715">platform, you have to have </span><span class="line" data-startTime="718">offline support, which means you </span><span class="line" data-startTime="718">need to store your users' </span><span class="line" data-startTime="721">data locally to some degree. </span> <span class="line" data-startTime="723">You don't have to store </span><span class="line" data-startTime="723">everything but </span><span class="line" data-startTime="724">at least the metadata. </span> <span class="line" data-startTime="726">For Photos, you would have maybe </span><span class="line" data-startTime="726">a link to where the file </span><span class="line" data-startTime="730">is on the file system and the </span><span class="line" data-startTime="730">dimensions of the photo and </span><span class="line" data-startTime="733">any other metadata </span><span class="line" data-startTime="733">that you have. </span></p>

<p><span class="line" data-startTime="736">This needs to be stored </span><span class="line" data-startTime="736">somewhere in your data layer, </span><span class="line" data-startTime="738">and we use IndexedDB do this. </span> <span class="line" data-startTime="743">The problem that we ran </span><span class="line" data-startTime="743">into with our initial </span><span class="line" data-startTime="745">implementation is that we were </span><span class="line" data-startTime="745">not using transactions in </span><span class="line" data-startTime="749">IndexedDB appropriately. </span> <span class="line" data-startTime="751">And this was kind of killer </span><span class="line" data-startTime="751">because it's not immediately </span><span class="line" data-startTime="754">obvious what you're doing wrong </span><span class="line" data-startTime="754">when your reads are </span><span class="line" data-startTime="757">going really slowly </span><span class="line" data-startTime="757">unless you're very </span><span class="line" data-startTime="759">familiar with the API. </span> <span class="line" data-startTime="760">So I'll give you a demo here. </span> <span class="line" data-startTime="763">We have writing 1,000 records, </span><span class="line" data-startTime="763">reading, removing them, et </span><span class="line" data-startTime="767">cetera, and with transaction </span><span class="line" data-startTime="767">and with no transaction. </span> <span class="line" data-startTime="770">We'll see what the </span><span class="line" data-startTime="770">differences are. </span> <span class="line" data-startTime="776">OK, it's taking a long time. </span></p>

<p><span class="line" data-startTime="779">And this is even worse. </span> <span class="line" data-startTime="780">This is two orders of magnitude </span><span class="line" data-startTime="780">worse without </span><span class="line" data-startTime="783">transactions. </span> <span class="line" data-startTime="785">And it's very simple. </span> <span class="line" data-startTime="785">Let's go in and see what </span><span class="line" data-startTime="785">the transactions do. </span> <span class="line" data-startTime="799">So you open a transaction, </span><span class="line" data-startTime="799">we'll zoom this up. </span> <span class="line" data-startTime="802">And I thank you very much. </span> <span class="line" data-startTime="804">I will zoom back out when </span><span class="line" data-startTime="804">I'm done with this. </span> <span class="line" data-startTime="813">So we have a notification when </span><span class="line" data-startTime="813">the transaction is complete. </span> <span class="line" data-startTime="815">That is when we say I've done </span><span class="line" data-startTime="815">all of my 1,000 operations. </span> <span class="line" data-startTime="819">And you just do all of your </span><span class="line" data-startTime="819">operations at once using the </span><span class="line" data-startTime="822">transaction object. </span></p>

<p><span class="line" data-startTime="824">You get the object store out </span><span class="line" data-startTime="824">from the transaction. </span> <span class="line" data-startTime="828">You do your operation </span><span class="line" data-startTime="828">on the store. </span> <span class="line" data-startTime="830">And once this goes </span><span class="line" data-startTime="830">out of scope, the </span><span class="line" data-startTime="832">transaction will be complete. </span> <span class="line" data-startTime="834">And we'll be done. </span> <span class="line" data-startTime="835">The implementation that doesn't </span><span class="line" data-startTime="835">use transaction has </span><span class="line" data-startTime="841">one database transaction </span><span class="line" data-startTime="841">per call. </span> <span class="line" data-startTime="844">So every time you are doing a </span><span class="line" data-startTime="844">new call, you're creating a </span><span class="line" data-startTime="846">new transaction. </span> <span class="line" data-startTime="847">Very inefficient. </span> <span class="line" data-startTime="863">So I think the biggest part </span><span class="line" data-startTime="863">of making this app very </span><span class="line" data-startTime="866">performant is the scrolling </span><span class="line" data-startTime="866">performance. </span> <span class="line" data-startTime="869">And this was the biggest </span><span class="line" data-startTime="869">challenge for us to solve. </span> <span class="line" data-startTime="872">There's a lot of optimizations </span><span class="line" data-startTime="872">you have to do </span><span class="line" data-startTime="874">all across the board. </span></p>

<p><span class="line" data-startTime="875">You have to make sure that </span><span class="line" data-startTime="875">you don't have any leaks. </span> <span class="line" data-startTime="877">You have to make sure that </span><span class="line" data-startTime="877">you're doing the right thing </span><span class="line" data-startTime="879">in order to be on fast </span><span class="line" data-startTime="879">scroll path. </span> <span class="line" data-startTime="882">This needs to be very </span><span class="line" data-startTime="882">non-choppy. </span> <span class="line" data-startTime="885">Otherwise, if it is choppy, </span><span class="line" data-startTime="885">your users are jarred. </span> <span class="line" data-startTime="888">And they're just </span><span class="line" data-startTime="888">very confused. </span> <span class="line" data-startTime="889">It looks like not </span><span class="line" data-startTime="889">a native app. </span> <span class="line" data-startTime="891">It looks like a web app. </span> <span class="line" data-startTime="894">And so the solution for this </span><span class="line" data-startTime="894">is a fast scroll path. </span> <span class="line" data-startTime="898">The fast scroll path is </span><span class="line" data-startTime="898">where the GPU does the </span><span class="line" data-startTime="901">scrolling for you. </span> <span class="line" data-startTime="903">Offload the processing for </span><span class="line" data-startTime="903">handling this chunk of video </span><span class="line" data-startTime="907">memory, you've got everything </span><span class="line" data-startTime="907">rendered into it, and whenever </span><span class="line" data-startTime="910">you scroll, you just ask the </span><span class="line" data-startTime="910">GPU to do the [? offset ?] </span><span class="line" data-startTime="912">for you. </span> <span class="line" data-startTime="913">This is common in games, </span><span class="line" data-startTime="913">graphics, whatever. </span></p>

<p><span class="line" data-startTime="915">And we're starting to </span><span class="line" data-startTime="915">add this to the </span><span class="line" data-startTime="916">browser in a lot of places. </span> <span class="line" data-startTime="918">Keep in mind that this is very </span><span class="line" data-startTime="918">preliminary, and the GPU team </span><span class="line" data-startTime="922">is working very hard on this. </span> <span class="line" data-startTime="923">But there are a lot of things </span><span class="line" data-startTime="923">you have to keep in mind. </span> <span class="line" data-startTime="927">When you do scrolling, the </span><span class="line" data-startTime="927">element that you scroll has to </span><span class="line" data-startTime="930">be the body element. </span> <span class="line" data-startTime="931">That's the first thing. </span> <span class="line" data-startTime="932">And I say that right off the bat </span><span class="line" data-startTime="932">because it's not obvious </span><span class="line" data-startTime="936">that is a requirement </span><span class="line" data-startTime="936">or a constraint. </span> <span class="line" data-startTime="939">And you can set up your DOM, </span><span class="line" data-startTime="939">your HTML structure, in such a </span><span class="line" data-startTime="942">way that it's very hard </span><span class="line" data-startTime="942">after the fact to move </span><span class="line" data-startTime="946">scrolling to the body. </span> <span class="line" data-startTime="947">And we ran into that problem. </span></p>

<p><span class="line" data-startTime="949">It was a total pain. </span> <span class="line" data-startTime="951">For example, let's go look </span><span class="line" data-startTime="951">at the app for a second. </span> <span class="line" data-startTime="958">We have our main content </span><span class="line" data-startTime="958">here in the middle. </span> <span class="line" data-startTime="960">And I'm going to go into </span><span class="line" data-startTime="960">the single photo </span><span class="line" data-startTime="961">view to show you more. </span> <span class="line" data-startTime="962">In the toolbar on the top and </span><span class="line" data-startTime="962">this sidebar on the right, the </span><span class="line" data-startTime="966">toolbar and the sidebar were </span><span class="line" data-startTime="966">siblings of the main content. </span> <span class="line" data-startTime="969">And this was all in one wrapper </span><span class="line" data-startTime="971">that could be scrolled. </span> <span class="line" data-startTime="972">This doesn't work because </span><span class="line" data-startTime="972">you're not on the body. </span> <span class="line" data-startTime="974">And in order to be on the body </span><span class="line" data-startTime="974">element, we had to make the </span><span class="line" data-startTime="977">toolbar and the sidebar </span><span class="line" data-startTime="977">fixed position. </span></p>

<p><span class="line" data-startTime="980">And that has its own </span><span class="line" data-startTime="980">intricacies. </span> <span class="line" data-startTime="983">Like for example, the scroll </span><span class="line" data-startTime="983">bar goes all way the up </span><span class="line" data-startTime="986">through the toolbar. </span> <span class="line" data-startTime="987">There's really not anything we </span><span class="line" data-startTime="987">can do about that right now. </span> <span class="line" data-startTime="990">And if that's the worst of our </span><span class="line" data-startTime="990">problems that gets us this </span><span class="line" data-startTime="992">type of scrolling, this fast </span><span class="line" data-startTime="992">scrolling, then it's </span><span class="line" data-startTime="994">definitely worth it. </span> <span class="line" data-startTime="1000">You also want to make sure </span><span class="line" data-startTime="1000">when you're handling the </span><span class="line" data-startTime="1002">scroll event, that you're </span><span class="line" data-startTime="1002">not doing too much work. </span></p>

<p><span class="line" data-startTime="1005">This is when the browser is </span><span class="line" data-startTime="1005">saying I'm about to scroll, </span><span class="line" data-startTime="1009">I'm about to change </span><span class="line" data-startTime="1009">your UI, the page. </span> <span class="line" data-startTime="1011">If you start doing a lot of </span><span class="line" data-startTime="1011">processing, maybe start </span><span class="line" data-startTime="1013">loading a bunch of image </span><span class="line" data-startTime="1013">elements, a lot of photo </span><span class="line" data-startTime="1015">elements, that inherently is </span><span class="line" data-startTime="1015">going to make the scrolling a </span><span class="line" data-startTime="1019">lot worse, a lot slower. </span> <span class="line" data-startTime="1021">So you want to offload your </span><span class="line" data-startTime="1021">processing to a time that is </span><span class="line" data-startTime="1025">not in your body scrolling. </span> <span class="line" data-startTime="1026">Perhaps queueing up and batching </span><span class="line" data-startTime="1026">operations that could </span><span class="line" data-startTime="1029">be done later. </span> <span class="line" data-startTime="1031">And we'll talk about that </span><span class="line" data-startTime="1031">in one of our solutions. </span></p>

<p><span class="line" data-startTime="1033">One thing that we had to do </span><span class="line" data-startTime="1033">was to reduce image loads. </span> <span class="line" data-startTime="1036">So when you set the source </span><span class="line" data-startTime="1036">attribute on an image element, </span><span class="line" data-startTime="1040">the browser, no matter whether </span><span class="line" data-startTime="1040">it's in the view port or not, </span><span class="line" data-startTime="1043">the image element has </span><span class="line" data-startTime="1043">to decode the image. </span> <span class="line" data-startTime="1046">And we found that the decoding </span><span class="line" data-startTime="1046">can be very expensive, and it </span><span class="line" data-startTime="1048">obviously scales with the </span><span class="line" data-startTime="1048">size of the image. </span> <span class="line" data-startTime="1051">So you want to question </span><span class="line" data-startTime="1051">expensive </span><span class="line" data-startTime="1054">operations like that. </span> <span class="line" data-startTime="1057">And setting image source is </span><span class="line" data-startTime="1057">one of those expensive </span><span class="line" data-startTime="1059">operations. </span> <span class="line" data-startTime="1061">So we talked about batching your </span><span class="line" data-startTime="1061">heavy processing so that </span><span class="line" data-startTime="1065">you're not doing everything </span><span class="line" data-startTime="1065">in your scroll. </span> <span class="line" data-startTime="1067">One way to do this, and the best </span><span class="line" data-startTime="1067">way right now, is to have </span><span class="line" data-startTime="1071">a callback to this method call </span><span class="line" data-startTime="1071">RequestAnimationFrame. </span></p>

<p><span class="line" data-startTime="1074">This method is a way for the </span><span class="line" data-startTime="1074">browser to alert you, hey, I'm </span><span class="line" data-startTime="1078">about to do an animation, and </span><span class="line" data-startTime="1078">you should do some heavy </span><span class="line" data-startTime="1083">processing in this time period, </span><span class="line" data-startTime="1083">batch it all up. </span> <span class="line" data-startTime="1085">Do everything at once because </span><span class="line" data-startTime="1085">we're going to </span><span class="line" data-startTime="1087">swap everything out. </span> <span class="line" data-startTime="1088">And this is a way for the </span><span class="line" data-startTime="1088">browser to say this will be </span><span class="line" data-startTime="1091">less janky. </span> <span class="line" data-startTime="1093">And so whenever we do </span><span class="line" data-startTime="1093">scrolling, we do </span><span class="line" data-startTime="1096">RequestAnimationFrame, and then </span><span class="line" data-startTime="1096">we obviously need to load </span><span class="line" data-startTime="1099">more elements. </span> <span class="line" data-startTime="1100">So when we </span><span class="line" data-startTime="1100">RequestAnimationFrame, the </span><span class="line" data-startTime="1101">callback, we do that </span><span class="line" data-startTime="1101">image loading then. </span> <span class="line" data-startTime="1104">Because that's when the browser </span><span class="line" data-startTime="1104">says, do your heavy, </span><span class="line" data-startTime="1106">intensive processing. </span> <span class="line" data-startTime="1107">And this is really great </span><span class="line" data-startTime="1107">to have high </span><span class="line" data-startTime="1110">performance in your scrolling. </span> <span class="line" data-startTime="1113">Another thing that I think is </span><span class="line" data-startTime="1113">starting to be more well </span><span class="line" data-startTime="1116">known, but it is not that well </span><span class="line" data-startTime="1116">known I think, and it's not </span><span class="line" data-startTime="1119">very necessarily intuitive, is </span><span class="line" data-startTime="1119">that when you measure certain </span><span class="line" data-startTime="1122">properties on DOM elements, you </span><span class="line" data-startTime="1122">can cause reflows, which </span><span class="line" data-startTime="1126">may cause repaints. </span></p>

<p><span class="line" data-startTime="1127">And painting is the one </span><span class="line" data-startTime="1127">thing you want to </span><span class="line" data-startTime="1129">minimize at all costs. </span> <span class="line" data-startTime="1131">If you're doing a bunch of </span><span class="line" data-startTime="1131">paints, then you don't have </span><span class="line" data-startTime="1133">the benefit of the GPU doing </span><span class="line" data-startTime="1133">the scroll for you. </span> <span class="line" data-startTime="1135">Because you're just thrashing </span><span class="line" data-startTime="1135">what the GPU had. </span> <span class="line" data-startTime="1139">ScrollTop, for example. </span> <span class="line" data-startTime="1140">If you're reading scrollTop, not </span><span class="line" data-startTime="1140">writing to it, if you read </span><span class="line" data-startTime="1143">it, you're going to do a </span><span class="line" data-startTime="1143">reflow, and you could </span><span class="line" data-startTime="1145">potentially repaint. </span> <span class="line" data-startTime="1147">Another one is </span><span class="line" data-startTime="1148">getClientBoundingRect on elements. </span></p>

<p><span class="line" data-startTime="1150">And you know what, it's kind </span><span class="line" data-startTime="1150">of iffy on some of these </span><span class="line" data-startTime="1153">whether it will cause </span><span class="line" data-startTime="1153">a reflow or not. </span> <span class="line" data-startTime="1155">There are several good articles, </span><span class="line" data-startTime="1155">and I recommend </span><span class="line" data-startTime="1157">looking up reflow, HTML reflow, </span><span class="line" data-startTime="1157">to get a lot of </span><span class="line" data-startTime="1161">information about this. </span> <span class="line" data-startTime="1162">But this is something that </span><span class="line" data-startTime="1162">you have to keep in mind. </span> <span class="line" data-startTime="1165">This is the next stage </span><span class="line" data-startTime="1165">of app development. </span> <span class="line" data-startTime="1167">And this type of performance is </span><span class="line" data-startTime="1167">what these apps are going </span><span class="line" data-startTime="1171">to be doing. </span> <span class="line" data-startTime="1172">And you want your app to </span><span class="line" data-startTime="1172">be this performant. </span> <span class="line" data-startTime="1176">Garbage collection is nasty. </span> <span class="line" data-startTime="1178">JavaScript is a fun language. </span> <span class="line" data-startTime="1180">And, obviously, the way the </span><span class="line" data-startTime="1180">memory layout works is very </span><span class="line" data-startTime="1186">fortunate in some ways, but </span><span class="line" data-startTime="1186">garbage collection is not one </span><span class="line" data-startTime="1188">of those ways. </span></p>

<p><span class="line" data-startTime="1189">So you want to try to minimize </span><span class="line" data-startTime="1189">garbage collection by </span><span class="line" data-startTime="1192">minimizing the pressure </span><span class="line" data-startTime="1192">buildup on memory. </span> <span class="line" data-startTime="1195">One of the ways that we do that </span><span class="line" data-startTime="1195">in this Photos app is if </span><span class="line" data-startTime="1201">you consider it, you have your </span><span class="line" data-startTime="1201">main viewport, and you have </span><span class="line" data-startTime="1204">image elements for each </span><span class="line" data-startTime="1204">of the photos that the </span><span class="line" data-startTime="1206">user wants to see. </span> <span class="line" data-startTime="1207">And we obviously have to </span><span class="line" data-startTime="1207">preload before and </span><span class="line" data-startTime="1209">after the view port. </span> <span class="line" data-startTime="1211">And that could be 40,000 </span><span class="line" data-startTime="1211">DOM nodes. </span> <span class="line" data-startTime="1213">That's too many. </span> <span class="line" data-startTime="1214">That's going to cause a lot of </span><span class="line" data-startTime="1214">garbage collection, a lot of </span><span class="line" data-startTime="1216">memory pressure that </span><span class="line" data-startTime="1216">you don't need. </span> <span class="line" data-startTime="1218">Consider that you can compress </span><span class="line" data-startTime="1218">those nodes given like say a </span><span class="line" data-startTime="1223">square of 1,024 by 768 </span><span class="line" data-startTime="1223">higher up that is not </span><span class="line" data-startTime="1227">visible in the viewport. </span> <span class="line" data-startTime="1229">Get rid of all those nodes, </span><span class="line" data-startTime="1229">you can either store them </span><span class="line" data-startTime="1231">around somewhere, but at least </span><span class="line" data-startTime="1231">keep them out of the tree, and </span><span class="line" data-startTime="1234">replace them with one </span><span class="line" data-startTime="1234">div that's sized </span><span class="line" data-startTime="1237">the exact same size. </span> <span class="line" data-startTime="1238">So that's like compressing </span><span class="line" data-startTime="1238">what you had before. </span></p>

<p><span class="line" data-startTime="1240">And that will keep the structure </span><span class="line" data-startTime="1240">of your document, </span><span class="line" data-startTime="1243">will not change the size </span><span class="line" data-startTime="1243">of the entire body. </span> <span class="line" data-startTime="1245">So the user won't even </span><span class="line" data-startTime="1245">be aware that </span><span class="line" data-startTime="1247">you've taken nodes out. </span> <span class="line" data-startTime="1249">A nifty little trick </span><span class="line" data-startTime="1249">you can do. </span> <span class="line" data-startTime="1252">It's really important. </span> <span class="line" data-startTime="1253">Leaks are bad. </span> <span class="line" data-startTime="1253">Everybody knows that. </span> <span class="line" data-startTime="1254">But you've got to pay </span><span class="line" data-startTime="1254">attention to it. </span> <span class="line" data-startTime="1257">The profiler inside of </span><span class="line" data-startTime="1257">Chrome itself can </span><span class="line" data-startTime="1261">really help with this. </span> <span class="line" data-startTime="1262">Let's take a look real quick. </span> <span class="line" data-startTime="1268">Nope. </span> <span class="line" data-startTime="1272">So profiles here allows you </span><span class="line" data-startTime="1272">to take a heap snapshot. </span> <span class="line" data-startTime="1278">Obviously, the heap snapshot </span><span class="line" data-startTime="1278">for this is not going to be </span><span class="line" data-startTime="1280">entirely interesting. </span></p>

<p><span class="line" data-startTime="1282">But it does show you some of the </span><span class="line" data-startTime="1282">objects that are going on. </span> <span class="line" data-startTime="1285">So we have like this slide </span><span class="line" data-startTime="1285">deck object, and </span><span class="line" data-startTime="1287">there are two of them. </span> <span class="line" data-startTime="1288">So I may question if I only have </span><span class="line" data-startTime="1288">one set of slides, why do </span><span class="line" data-startTime="1292">I have two slide decks? </span><span class="line" data-startTime="1294">I don't know the </span><span class="line" data-startTime="1294">answer to that. </span> <span class="line" data-startTime="1295">Could be a leak. </span> <span class="line" data-startTime="1297">We found, in many instances of </span><span class="line" data-startTime="1297">just going through this, and </span><span class="line" data-startTime="1300">you can arrange things by, for </span><span class="line" data-startTime="1300">example, dominators, which are </span><span class="line" data-startTime="1303">saying this thing is huge. </span> <span class="line" data-startTime="1305">Obviously, you want to go </span><span class="line" data-startTime="1305">through the native stuff at </span><span class="line" data-startTime="1307">the top that's not yours, but </span><span class="line" data-startTime="1307">get down to where you're </span><span class="line" data-startTime="1310">allocating stuff and say </span><span class="line" data-startTime="1310">this is too heavy. </span> <span class="line" data-startTime="1314">This slide deck is too </span><span class="line" data-startTime="1314">heavy, for example. </span> <span class="line" data-startTime="1318">And that's just one way to say I </span><span class="line" data-startTime="1318">need to go in here and start </span><span class="line" data-startTime="1322">looking for places where </span><span class="line" data-startTime="1322">I may be leaking. </span></p>

<p><span class="line" data-startTime="1323">I may not be freeing references, </span><span class="line" data-startTime="1323">removing </span><span class="line" data-startTime="1326">references, et cetera. </span> <span class="line" data-startTime="1328">There are a lot of tools that </span><span class="line" data-startTime="1328">can help with this. </span> <span class="line" data-startTime="1330">They're, in our experience, </span><span class="line" data-startTime="1330">not very great. </span> <span class="line" data-startTime="1332">There's not a lot of tools right </span><span class="line" data-startTime="1332">now that have a very low </span><span class="line" data-startTime="1335">false positive rate. </span> <span class="line" data-startTime="1336">But it can point you in </span><span class="line" data-startTime="1336">the right direction. </span> <span class="line" data-startTime="1339">And it doesn't hurt to just run </span><span class="line" data-startTime="1339">it every once in awhile </span><span class="line" data-startTime="1342">and say these are the known </span><span class="line" data-startTime="1342">false positives. </span> <span class="line" data-startTime="1344">These are the ones </span><span class="line" data-startTime="1344">we need to fix. </span> <span class="line" data-startTime="1347">Listeners can get </span><span class="line" data-startTime="1347">very expensive. </span> <span class="line" data-startTime="1348">We had an instance where you </span><span class="line" data-startTime="1348">would start the app with no </span><span class="line" data-startTime="1351">photos, and we had </span><span class="line" data-startTime="1351">40,000 listeners. </span></p>

<p><span class="line" data-startTime="1355">What are they listening to? </span><span class="line" data-startTime="1357">I mean, that doesn't </span><span class="line" data-startTime="1357">even make sense. </span> <span class="line" data-startTime="1359">You need to make sure that </span><span class="line" data-startTime="1359">things are being detached </span><span class="line" data-startTime="1361">appropriately. </span> <span class="line" data-startTime="1361">They stop listening. </span> <span class="line" data-startTime="1363">They can be dangerous not just </span><span class="line" data-startTime="1363">in the memory footprint but </span><span class="line" data-startTime="1366">also in the processing </span><span class="line" data-startTime="1366">footprint. </span> <span class="line" data-startTime="1368">If these listeners are being </span><span class="line" data-startTime="1368">fired on events, and they </span><span class="line" data-startTime="1371">don't need to be listening, then </span><span class="line" data-startTime="1371">they're going to do some </span><span class="line" data-startTime="1373">processing that is </span><span class="line" data-startTime="1373">unnecessary. </span> <span class="line" data-startTime="1375">And that's going to hurt your </span><span class="line" data-startTime="1375">performance as well. </span> <span class="line" data-startTime="1378">And we already talked about </span><span class="line" data-startTime="1378">profiling memory usage, so </span><span class="line" data-startTime="1380">we'll skip that. </span></p>

<p><span class="line" data-startTime="1383">So back to simplicity. </span> <span class="line" data-startTime="1385">I truly think this is one of the </span><span class="line" data-startTime="1385">most difficult things that </span><span class="line" data-startTime="1389">you have to solve in an app, how </span><span class="line" data-startTime="1389">to get out of the way so </span><span class="line" data-startTime="1393">that the user can just see what </span><span class="line" data-startTime="1393">they want to see, do what </span><span class="line" data-startTime="1396">they want to do, minimize your </span><span class="line" data-startTime="1396">UI footprint, et cetera. </span> <span class="line" data-startTime="1400">And the Chrome platform is </span><span class="line" data-startTime="1400">really starting to take over </span><span class="line" data-startTime="1404">this and give you APIs </span><span class="line" data-startTime="1404">that allow you to </span><span class="line" data-startTime="1406">get out of the way. </span> <span class="line" data-startTime="1410">One of the big ones we </span><span class="line" data-startTime="1410">had was with sign-in. </span> <span class="line" data-startTime="1414">Signing into an app really feels </span><span class="line" data-startTime="1414">like a web page that you </span><span class="line" data-startTime="1418">have to sign into. </span> <span class="line" data-startTime="1419">Especially if you don't have </span><span class="line" data-startTime="1419">the ability to sign in once </span><span class="line" data-startTime="1422">and have that persistent across </span><span class="line" data-startTime="1422">multiple lifetimes, </span><span class="line" data-startTime="1425">multiple instances of the app, </span><span class="line" data-startTime="1425">it just doesn't feel native. </span></p>

<p><span class="line" data-startTime="1429">And we do, that's our goal </span><span class="line" data-startTime="1429">is to feel native. </span> <span class="line" data-startTime="1432">Also, if you're signing in, </span><span class="line" data-startTime="1432">that's a step, that's a road </span><span class="line" data-startTime="1434">block to the user getting to </span><span class="line" data-startTime="1434">do what they want to do. </span> <span class="line" data-startTime="1437">And so we really needed </span><span class="line" data-startTime="1437">a way around this. </span> <span class="line" data-startTime="1439">And thankfully, the Chrome </span><span class="line" data-startTime="1439">platform has a way. </span> <span class="line" data-startTime="1444">There is this thing called the </span><span class="line" data-startTime="1444">Identity API which allows you </span><span class="line" data-startTime="1447">to retrieve the OAuth2 token </span><span class="line" data-startTime="1447">of the user that's </span><span class="line" data-startTime="1450">currently signed in. </span> <span class="line" data-startTime="1452">Now this app is right now </span><span class="line" data-startTime="1452">designed for ChromeOS. </span> <span class="line" data-startTime="1454">But the Identity API works </span><span class="line" data-startTime="1454">on all platforms. </span> <span class="line" data-startTime="1458">So if the user is signed into </span><span class="line" data-startTime="1458">the browser, you can get their </span><span class="line" data-startTime="1460">OAuth2 token for their </span><span class="line" data-startTime="1460">Google account. </span> <span class="line" data-startTime="1463">For example, in this app, I </span><span class="line" data-startTime="1463">didn't have to sign in. </span> <span class="line" data-startTime="1468">There is no sign in </span><span class="line" data-startTime="1468">button anywhere. </span> <span class="line" data-startTime="1469">When you start the app, I don't </span><span class="line" data-startTime="1469">ask you to sign in, or </span><span class="line" data-startTime="1472">I'm not asked to sign in. </span> <span class="line" data-startTime="1474">And that all comes from the </span><span class="line" data-startTime="1474">Identity API and the fact that </span><span class="line" data-startTime="1477">on ChromeOS, specifically, </span><span class="line" data-startTime="1477">you're always </span><span class="line" data-startTime="1479">signed into the browser. </span></p>

<p><span class="line" data-startTime="1480">So for an app on ChromeOS, you </span><span class="line" data-startTime="1480">shouldn't have to sign in if </span><span class="line" data-startTime="1483">you're using Google Accounts. </span> <span class="line" data-startTime="1485">Now you may not be using Google </span><span class="line" data-startTime="1485">Accounts, and the </span><span class="line" data-startTime="1489">Identity API has a solution </span><span class="line" data-startTime="1489">for that. </span> <span class="line" data-startTime="1491">It's called launch </span><span class="line" data-startTime="1491">WebAuth flow. </span> <span class="line" data-startTime="1494">And so with that API, you can </span><span class="line" data-startTime="1494">pass in a third party URL in </span><span class="line" data-startTime="1498">point for OAuth2, and under </span><span class="line" data-startTime="1498">the hood, all of </span><span class="line" data-startTime="1502">the workings happen. </span> <span class="line" data-startTime="1504">A pop-up is shown that allows </span><span class="line" data-startTime="1504">the user to login. </span> <span class="line" data-startTime="1508">Now, obviously, that doesn't </span><span class="line" data-startTime="1508">solve the issue of getting out </span><span class="line" data-startTime="1511">of the way and not having </span><span class="line" data-startTime="1511">a dialogue. </span> <span class="line" data-startTime="1513">But if you're not using Google </span><span class="line" data-startTime="1513">Accounts, which is a fair </span><span class="line" data-startTime="1515">point, you need a way to sign </span><span class="line" data-startTime="1515">in the user to your app. </span> <span class="line" data-startTime="1518">And that token can be </span><span class="line" data-startTime="1518">persisted across </span><span class="line" data-startTime="1522">instances of the app. </span></p>

<p><span class="line" data-startTime="1523">So, for example, in this code </span><span class="line" data-startTime="1523">sample here, we are calling </span><span class="line" data-startTime="1527">getAuthToken, and we're </span><span class="line" data-startTime="1527">storing that token. </span> <span class="line" data-startTime="1530">So for the lifetime of the app, </span><span class="line" data-startTime="1530">we don't have to keep </span><span class="line" data-startTime="1532">calling getAuthToken, we just </span><span class="line" data-startTime="1532">have the token around. </span> <span class="line" data-startTime="1535">And we build our requests </span><span class="line" data-startTime="1535">with this token. </span> <span class="line" data-startTime="1539">For example, the Photos </span><span class="line" data-startTime="1539">back end at Google. </span> <span class="line" data-startTime="1542">We're going to do a request </span><span class="line" data-startTime="1542">to read all the </span><span class="line" data-startTime="1544">photos of the user. </span> <span class="line" data-startTime="1546">And so what we've done is we </span><span class="line" data-startTime="1546">have the token stored. </span> <span class="line" data-startTime="1549">We just keep using this same </span><span class="line" data-startTime="1549">token for all of our requests </span><span class="line" data-startTime="1552">in the app. </span> <span class="line" data-startTime="1552">It's really easy to use. </span> <span class="line" data-startTime="1561">So like I said, I had </span><span class="line" data-startTime="1561">a camera, and I had </span><span class="line" data-startTime="1563">an SD card in it. </span></p>

<p><span class="line" data-startTime="1565">And I plugged it in, and the </span><span class="line" data-startTime="1565">right thing just happened. </span> <span class="line" data-startTime="1570">It's a Photos app. </span> <span class="line" data-startTime="1571">I've installed this app. </span> <span class="line" data-startTime="1573">I said I trust this app to </span><span class="line" data-startTime="1573">do what I need it to do, </span><span class="line" data-startTime="1576">including the fact that </span><span class="line" data-startTime="1576">it says it has </span><span class="line" data-startTime="1578">access to your media. </span> <span class="line" data-startTime="1581">Currently, in the web today, </span><span class="line" data-startTime="1581">and in most native apps as </span><span class="line" data-startTime="1584">well, you have to select the </span><span class="line" data-startTime="1584">media specifically, say by the </span><span class="line" data-startTime="1589">file open dialog, which I </span><span class="line" data-startTime="1589">consider the worst piece of UI </span><span class="line" data-startTime="1592">in browser history. </span> <span class="line" data-startTime="1593">It's awful. </span> <span class="line" data-startTime="1594">But everybody has to </span><span class="line" data-startTime="1594">go through that. </span> <span class="line" data-startTime="1597">The alternative is Flash, but </span><span class="line" data-startTime="1597">even then, you still have to </span><span class="line" data-startTime="1599">do file directory browsing, </span><span class="line" data-startTime="1599">et cetera. </span> <span class="line" data-startTime="1602">We wanted to get rid of that. </span> <span class="line" data-startTime="1606">The solution to this was the </span><span class="line" data-startTime="1606">Media Gallery API, which is </span><span class="line" data-startTime="1609">like the pinnacle </span><span class="line" data-startTime="1609">API in this app. </span></p>

<p><span class="line" data-startTime="1611">It's what makes this app pop. </span> <span class="line" data-startTime="1612">It's what makes it real. </span> <span class="line" data-startTime="1614">The Media Galleries API allows </span><span class="line" data-startTime="1614">the developer to have access </span><span class="line" data-startTime="1620">to media devices, so SD cards, </span><span class="line" data-startTime="1620">platform media, like my </span><span class="line" data-startTime="1625">pictures or the photos </span><span class="line" data-startTime="1625">on a Mac. </span> <span class="line" data-startTime="1629">And it has a seamless access. </span> <span class="line" data-startTime="1630">You don't have to ask the user </span><span class="line" data-startTime="1630">at the time of app running, at </span><span class="line" data-startTime="1634">the app running, only </span><span class="line" data-startTime="1634">at installation and </span><span class="line" data-startTime="1635">only that one time. </span> <span class="line" data-startTime="1637">So in this app, we have UI that </span><span class="line" data-startTime="1637">shows up a notification </span><span class="line" data-startTime="1641">that says you just plugged </span><span class="line" data-startTime="1641">in a card, we're </span><span class="line" data-startTime="1642">going to start uploading. </span></p>

<p><span class="line" data-startTime="1643">And you have the ability to stop </span><span class="line" data-startTime="1643">the uploading, but that </span><span class="line" data-startTime="1646">action happens right away. </span> <span class="line" data-startTime="1648">The user doesn't have to wait, </span><span class="line" data-startTime="1648">and the user doesn't have to </span><span class="line" data-startTime="1650">do the file open dialog, </span><span class="line" data-startTime="1650">which is just awful. </span> <span class="line" data-startTime="1655">So here's a little code snapshot </span><span class="line" data-startTime="1655">of how to use this. </span> <span class="line" data-startTime="1658">The API call is </span><span class="line" data-startTime="1658">getMediaFileSystems. </span> <span class="line" data-startTime="1661">And if you're familiar with </span><span class="line" data-startTime="1661">it, it returns a DOM file </span><span class="line" data-startTime="1665">system, which has its own file </span><span class="line" data-startTime="1665">entries inside of that. </span> <span class="line" data-startTime="1669">Its directory structure, you can </span><span class="line" data-startTime="1669">read through this with the </span><span class="line" data-startTime="1672">file system API. </span> <span class="line" data-startTime="1673">So this is really neat. </span> <span class="line" data-startTime="1676">We just have this one little </span><span class="line" data-startTime="1676">layer on top of the already </span><span class="line" data-startTime="1679">existing file system API that </span><span class="line" data-startTime="1679">restricts what is shown to the </span><span class="line" data-startTime="1684">app to just media locations. </span> <span class="line" data-startTime="1686">For example, when I plugged in </span><span class="line" data-startTime="1686">the SD card, it knew that it </span><span class="line" data-startTime="1691">had a DCIM folder and said </span><span class="line" data-startTime="1691">we think this is a media. </span></p>

<p><span class="line" data-startTime="1694">It's a simple heuristic, but </span><span class="line" data-startTime="1694">it really solves 90% of the </span><span class="line" data-startTime="1698">use cases that we're </span><span class="line" data-startTime="1698">looking for. </span> <span class="line" data-startTime="1700">If you plugged in an external </span><span class="line" data-startTime="1700">drive, and it had a DCIM </span><span class="line" data-startTime="1702">directory, we would say </span><span class="line" data-startTime="1702">that it probably has </span><span class="line" data-startTime="1705">photos on it as well. </span> <span class="line" data-startTime="1706">And we would start </span><span class="line" data-startTime="1706">loading that. </span> <span class="line" data-startTime="1715">So the first time I saw the </span><span class="line" data-startTime="1715">Pixel screen, it was detached </span><span class="line" data-startTime="1719">from the actual laptop. </span> <span class="line" data-startTime="1720">It was not even put </span><span class="line" data-startTime="1720">together yet. </span> <span class="line" data-startTime="1722">It was this little piece. </span> <span class="line" data-startTime="1724">And he said, you have to </span><span class="line" data-startTime="1724">see this, one of the </span><span class="line" data-startTime="1725">developers of the Pixel. </span> <span class="line" data-startTime="1726">And he showed it to me, and it </span><span class="line" data-startTime="1726">was just mind blowing, the </span><span class="line" data-startTime="1730">picture that he showed on it. </span> <span class="line" data-startTime="1731">I'd never seen something </span><span class="line" data-startTime="1731">like this. </span></p>

<p><span class="line" data-startTime="1733">And then he started swiping it </span><span class="line" data-startTime="1733">and moving things around, the </span><span class="line" data-startTime="1736">touch on this one screen, </span><span class="line" data-startTime="1736">it was just amazing. </span> <span class="line" data-startTime="1739">And so you have the ability when </span><span class="line" data-startTime="1739">writing apps not just for </span><span class="line" data-startTime="1743">this but say for tablets as </span><span class="line" data-startTime="1743">well, like high DPI tablets, </span><span class="line" data-startTime="1747">you obviously have MacBooks </span><span class="line" data-startTime="1747">that have Retina Display. </span> <span class="line" data-startTime="1751">You want to make sure that </span><span class="line" data-startTime="1751">you're optimizing for these </span><span class="line" data-startTime="1753">form factors which are becoming </span><span class="line" data-startTime="1755">more and more prevalent. </span> <span class="line" data-startTime="1759">And for the high resolution </span><span class="line" data-startTime="1759">display, it's not hard. </span> <span class="line" data-startTime="1763">You just provide 2x assets, </span><span class="line" data-startTime="1763">high-resolution assets. </span> <span class="line" data-startTime="1767">The API to do this </span><span class="line" data-startTime="1767">is in CSS itself. </span> <span class="line" data-startTime="1769">It's called WebKit Media Set. </span></p>

<p><span class="line" data-startTime="1771">And you can specify </span><span class="line" data-startTime="1771">the multiplicative </span><span class="line" data-startTime="1774">factor, so 1x or 2x. </span> <span class="line" data-startTime="1777">And you just pass in the right </span><span class="line" data-startTime="1777">resource through that. </span> <span class="line" data-startTime="1780">One thing to keep in mind is </span><span class="line" data-startTime="1780">that you want to make sure to </span><span class="line" data-startTime="1782">set the background size of your </span><span class="line" data-startTime="1782">asset to the low res. </span> <span class="line" data-startTime="1787">So we have this close icon, </span><span class="line" data-startTime="1787">and it's 32 pixels in the </span><span class="line" data-startTime="1791">low-res asset. </span> <span class="line" data-startTime="1793">When we load the high-res asset, </span><span class="line" data-startTime="1793">we still want it to be </span><span class="line" data-startTime="1795">32 pixels on the screen. </span> <span class="line" data-startTime="1799">So that doesn't blow up </span><span class="line" data-startTime="1799">un-proportionally. </span> <span class="line" data-startTime="1801">We just have it more dense </span><span class="line" data-startTime="1801">inside of those 32 pixels. </span> <span class="line" data-startTime="1806">You want to make sure you do </span><span class="line" data-startTime="1806">this especially if your user </span><span class="line" data-startTime="1809">is going to be on a </span><span class="line" data-startTime="1809">high-resolution display </span><span class="line" data-startTime="1811">because on most browsers and </span><span class="line" data-startTime="1811">definitely in Chrome, the </span><span class="line" data-startTime="1816">scaling algorithm for images to </span><span class="line" data-startTime="1816">scale up to high resolution </span><span class="line" data-startTime="1819">is optimized for speed, </span><span class="line" data-startTime="1819">not quality. </span></p>

<p><span class="line" data-startTime="1821">You'll get very blurry images, </span><span class="line" data-startTime="1821">and your users are going to </span><span class="line" data-startTime="1825">get a headache after a while. </span> <span class="line" data-startTime="1826">It looks really bad. </span> <span class="line" data-startTime="1827">We had a regression one time </span><span class="line" data-startTime="1827">where the high-resolution </span><span class="line" data-startTime="1830">assets were not being </span><span class="line" data-startTime="1830">loaded properly. </span> <span class="line" data-startTime="1832">And every body was like, oh </span><span class="line" data-startTime="1832">my gosh, this is awful. </span> <span class="line" data-startTime="1835">Something is clearly wrong </span><span class="line" data-startTime="1835">with this app. </span> <span class="line" data-startTime="1837">And imagine if your user </span><span class="line" data-startTime="1837">saw that, they're </span><span class="line" data-startTime="1839">not expecting it. </span> <span class="line" data-startTime="1840">They just know something </span><span class="line" data-startTime="1840">is wrong. </span></p>

<p><span class="line" data-startTime="1845">And to touch support. </span> <span class="line" data-startTime="1847">This is a really fun </span><span class="line" data-startTime="1847">thing to touch. </span> <span class="line" data-startTime="1849">And they always say, why would </span><span class="line" data-startTime="1849">you touch this laptop screen? </span><span class="line" data-startTime="1852">People don't want to reach over </span><span class="line" data-startTime="1852">their keyboard to do it. </span> <span class="line" data-startTime="1855">But the more you use this, the </span><span class="line" data-startTime="1855">more you start touching </span><span class="line" data-startTime="1858">everything around you. </span> <span class="line" data-startTime="1859">Like you reach over </span><span class="line" data-startTime="1859">everything. </span> <span class="line" data-startTime="1861">I touch my work 32-inch monitor </span><span class="line" data-startTime="1864">expecting it to do something. </span> <span class="line" data-startTime="1866">And it doesn't. </span> <span class="line" data-startTime="1866">It's extremely frustrating. </span> <span class="line" data-startTime="1868">More and more, displays are </span><span class="line" data-startTime="1868">going to be touch, whether </span><span class="line" data-startTime="1870">it's a hybrid, whether it can </span><span class="line" data-startTime="1870">be converted, et cetera. </span></p>

<p><span class="line" data-startTime="1874">Your app should really handle, </span><span class="line" data-startTime="1874">if not touch gestures </span><span class="line" data-startTime="1877">specifically like dragging and </span><span class="line" data-startTime="1877">touch start, touch end, to </span><span class="line" data-startTime="1883">consider what your user </span><span class="line" data-startTime="1883">actions should be. </span> <span class="line" data-startTime="1885">For example, consider </span><span class="line" data-startTime="1885">the Photos view. </span> <span class="line" data-startTime="1891">So we have this photo here. </span> <span class="line" data-startTime="1894">I admit, I was in the wrong </span><span class="line" data-startTime="1894">when we were having this </span><span class="line" data-startTime="1896">discussion. </span> <span class="line" data-startTime="1897">I felt that we should </span><span class="line" data-startTime="1897">have double-click to </span><span class="line" data-startTime="1899">activate these objects. </span> <span class="line" data-startTime="1901">So if I wanted to go into the </span><span class="line" data-startTime="1901">single photo view for this </span><span class="line" data-startTime="1904">photo, I should have </span><span class="line" data-startTime="1904">double-click. </span> <span class="line" data-startTime="1906">And that was me coming from </span><span class="line" data-startTime="1906">wanting to have a more native </span><span class="line" data-startTime="1909">experience. </span> <span class="line" data-startTime="1910">And in native apps and in the </span><span class="line" data-startTime="1910">file system browsing around </span><span class="line" data-startTime="1915">things, you double-click to </span><span class="line" data-startTime="1915">activate for the most part. </span> <span class="line" data-startTime="1917">And I thought that would be </span><span class="line" data-startTime="1917">a more native experience. </span></p>

<p><span class="line" data-startTime="1919">But then we had the issue of </span><span class="line" data-startTime="1919">well, what do you do when </span><span class="line" data-startTime="1922">you're tapping? </span><span class="line" data-startTime="1923">Do you double tap the screen? </span><span class="line" data-startTime="1925">No. </span> <span class="line" data-startTime="1926">That doesn't work. </span> <span class="line" data-startTime="1927">We could have it where you, with </span><span class="line" data-startTime="1927">a mouse or a track pad, </span><span class="line" data-startTime="1930">that you double-click, and </span><span class="line" data-startTime="1930">then with touch, you </span><span class="line" data-startTime="1933">single-click. </span> <span class="line" data-startTime="1934">But then you have a very </span><span class="line" data-startTime="1934">confusing UX, your user </span><span class="line" data-startTime="1937">doesn't know what to do. </span> <span class="line" data-startTime="1938">And then they're going to start </span><span class="line" data-startTime="1938">doing the wrong thing </span><span class="line" data-startTime="1940">the entire time. </span> <span class="line" data-startTime="1940">They're going to start double </span><span class="line" data-startTime="1940">touching the screen. </span> <span class="line" data-startTime="1944">So the key takeaway for this one </span><span class="line" data-startTime="1944">is just to consider that </span><span class="line" data-startTime="1948">tap support is very important. </span> <span class="line" data-startTime="1950">Users are going to start using </span><span class="line" data-startTime="1950">tap and touch screens. </span></p>

<p><span class="line" data-startTime="1955">And you don't necessarily have </span><span class="line" data-startTime="1955">to have full touch support. </span> <span class="line" data-startTime="1958">Just think about what your </span><span class="line" data-startTime="1958">UX is going to be. </span> <span class="line" data-startTime="1960">I know a lot of you are </span><span class="line" data-startTime="1960">engineers, maybe some of you </span><span class="line" data-startTime="1962">are designers in UX. </span> <span class="line" data-startTime="1964">But it's all our responsibility </span><span class="line" data-startTime="1964">to create the </span><span class="line" data-startTime="1965">best looking app. </span> <span class="line" data-startTime="1970">So on to security, that </span><span class="line" data-startTime="1970">last principle. </span> <span class="line" data-startTime="1974">This section, it can come </span><span class="line" data-startTime="1974">off a little dry. </span> <span class="line" data-startTime="1977">It's kind of difficult to deal </span><span class="line" data-startTime="1977">with, but security is </span><span class="line" data-startTime="1980">extremely important </span><span class="line" data-startTime="1980">for the user. </span></p>

<p><span class="line" data-startTime="1986">And there are a lot of things in </span><span class="line" data-startTime="1986">the platform that at first </span><span class="line" data-startTime="1989">feel like you have to deal with, </span><span class="line" data-startTime="1989">but at the end, assuming </span><span class="line" data-startTime="1992">you start designing your app </span><span class="line" data-startTime="1992">the right way from the </span><span class="line" data-startTime="1994">beginning, you're </span><span class="line" data-startTime="1994">much better off. </span> <span class="line" data-startTime="1997">Your user is much safer. </span> <span class="line" data-startTime="2002">So content security policy is </span><span class="line" data-startTime="2002">this essentially white list, </span><span class="line" data-startTime="2007">black list that says your app </span><span class="line" data-startTime="2007">has access to these resources, </span><span class="line" data-startTime="2010">these remote URLs, these </span><span class="line" data-startTime="2010">domains, et cetera. </span> <span class="line" data-startTime="2013">And by default, you really don't </span><span class="line" data-startTime="2013">have access to hardly </span><span class="line" data-startTime="2017">anything at all. </span> <span class="line" data-startTime="2018">As you're adding a white list </span><span class="line" data-startTime="2018">for resources your app should </span><span class="line" data-startTime="2020">have access to, you consider </span><span class="line" data-startTime="2020">like your back end server, you </span><span class="line" data-startTime="2024">obviously need access to </span><span class="line" data-startTime="2024">that, and nothing else. </span> <span class="line" data-startTime="2027">So if an attacker gets a hold </span><span class="line" data-startTime="2027">of your app, something gets </span><span class="line" data-startTime="2031">injected, and starts making </span><span class="line" data-startTime="2031">requests to some malicious </span><span class="line" data-startTime="2035">server, those requests are going </span><span class="line" data-startTime="2035">to be denied because </span><span class="line" data-startTime="2038">they're blocked by content </span><span class="line" data-startTime="2038">security policy. </span></p>

<p><span class="line" data-startTime="2041">The key thing here is to start </span><span class="line" data-startTime="2041">designing your app from the </span><span class="line" data-startTime="2044">very beginning with content </span><span class="line" data-startTime="2044">security policy in mind. </span> <span class="line" data-startTime="2047">You can't load remote scripts. </span> <span class="line" data-startTime="2049">You can't use eval. </span> <span class="line" data-startTime="2050">And, for us, this was kind of </span><span class="line" data-startTime="2050">a problem because we were </span><span class="line" data-startTime="2054">getting JSON objects back from </span><span class="line" data-startTime="2054">the server, and so we had to </span><span class="line" data-startTime="2057">translate those into objects </span><span class="line" data-startTime="2057">using eval, and </span><span class="line" data-startTime="2060">we couldn't do that. </span> <span class="line" data-startTime="2062">So what we ended up doing was </span><span class="line" data-startTime="2062">having a sandboxed iframe that </span><span class="line" data-startTime="2065">had the use of eval inside of </span><span class="line" data-startTime="2065">it, and we passed the JSON </span><span class="line" data-startTime="2069">objects into this iframe. </span> <span class="line" data-startTime="2070">It would do the eval, get the </span><span class="line" data-startTime="2070">object back, and then post a </span><span class="line" data-startTime="2074">message back to the </span><span class="line" data-startTime="2074">app, this object. </span></p>

<p><span class="line" data-startTime="2076">So if something malicious goes </span><span class="line" data-startTime="2076">on, the eval is going wonky, </span><span class="line" data-startTime="2079">that sandbox iframe has no </span><span class="line" data-startTime="2079">permissions whatsoever. </span> <span class="line" data-startTime="2082">All it can do is communicate </span><span class="line" data-startTime="2082">back and forth. </span> <span class="line" data-startTime="2084">So you're pretty safe </span><span class="line" data-startTime="2084">as far as that goes. </span> <span class="line" data-startTime="2091">Making requests. </span> <span class="line" data-startTime="2092">So you can't say image </span><span class="line" data-startTime="2092">source equal remote. </span> <span class="line" data-startTime="2095">You actually have to pull down </span><span class="line" data-startTime="2095">the bits for that image. </span> <span class="line" data-startTime="2098">So all of these photos, we have </span><span class="line" data-startTime="2098">to pull them down from </span><span class="line" data-startTime="2100">the server. </span> <span class="line" data-startTime="2101">XML HTTP requests is </span><span class="line" data-startTime="2101">the way we do this. </span> <span class="line" data-startTime="2104">You just create your URL for </span><span class="line" data-startTime="2104">the request, send it off. </span></p>

<p><span class="line" data-startTime="2108">You get your response, you </span><span class="line" data-startTime="2108">should save it in your data </span><span class="line" data-startTime="2111">layer obviously. </span> <span class="line" data-startTime="2112">And then once you get that, </span><span class="line" data-startTime="2112">the data gets bubbled up </span><span class="line" data-startTime="2115">through your UI. </span> <span class="line" data-startTime="2120">And another tip as far as </span><span class="line" data-startTime="2120">thinking what you should do </span><span class="line" data-startTime="2123">from the beginning, designing </span><span class="line" data-startTime="2123">from the beginning, resource </span><span class="line" data-startTime="2126">compilation comes in very handy </span><span class="line" data-startTime="2126">with packaged apps. </span> <span class="line" data-startTime="2129">We particularly use Closure, but </span><span class="line" data-startTime="2129">there are a lot of tools </span><span class="line" data-startTime="2132">that you can use to </span><span class="line" data-startTime="2132">do the same thing. </span> <span class="line" data-startTime="2135">You're going to say, </span><span class="line" data-startTime="2135">essentially, in your main HTML </span><span class="line" data-startTime="2138">of the packaged app, script </span><span class="line" data-startTime="2138">equals some local file. </span></p>

<p><span class="line" data-startTime="2142">You could say a bunch of local </span><span class="line" data-startTime="2142">files, but it's a lot easier </span><span class="line" data-startTime="2145">to just have your code compiled, </span><span class="line" data-startTime="2145">have it minified, et </span><span class="line" data-startTime="2148">cetera, and say script equals </span><span class="line" data-startTime="2148">this local file. </span> <span class="line" data-startTime="2154">So to wrap it up, we look back </span><span class="line" data-startTime="2154">at what our goals were, and I </span><span class="line" data-startTime="2160">think we really achieved </span><span class="line" data-startTime="2160">those goals. </span> <span class="line" data-startTime="2163">We identified holes </span><span class="line" data-startTime="2163">in the platform, </span><span class="line" data-startTime="2166">APIs that were missing. </span> <span class="line" data-startTime="2167">We added media gallery APIs. </span> <span class="line" data-startTime="2169">We tested a lot of features </span><span class="line" data-startTime="2169">from Google+ Photos. </span> <span class="line" data-startTime="2173">We got autocuration working </span><span class="line" data-startTime="2173">really well. </span> <span class="line" data-startTime="2176">And we just pushed the platform </span><span class="line" data-startTime="2176">to its limits. </span></p>

<p><span class="line" data-startTime="2178">How far can you go with this? </span><span class="line" data-startTime="2180">How hard is it for developers </span><span class="line" data-startTime="2180">to use this? </span><span class="line" data-startTime="2183">I think the answer </span><span class="line" data-startTime="2183">is not very hard. </span> <span class="line" data-startTime="2185">The biggest thing you have to </span><span class="line" data-startTime="2185">do is to understand your </span><span class="line" data-startTime="2187">constraints from the </span><span class="line" data-startTime="2187">very beginning. </span> <span class="line" data-startTime="2189">Understand that you don't have </span><span class="line" data-startTime="2189">access to remote URLs. </span> <span class="line" data-startTime="2193">Understand that if you want fast </span><span class="line" data-startTime="2193">scrolling, you need to </span><span class="line" data-startTime="2195">scroll your body. </span> <span class="line" data-startTime="2196">And, obviously, the platform is </span><span class="line" data-startTime="2196">constantly changing, things </span><span class="line" data-startTime="2199">are being fixed. </span> <span class="line" data-startTime="2200">I know I've reached out to the </span><span class="line" data-startTime="2200">GPU team a lot to say, this is </span><span class="line" data-startTime="2205">not easy enough. </span> <span class="line" data-startTime="2206">We have to fix this. </span></p>

<p><span class="line" data-startTime="2207">And just imagine the evolution </span><span class="line" data-startTime="2207">that's happening right now. </span> <span class="line" data-startTime="2212">You can see it at I/O. This </span><span class="line" data-startTime="2212">platform is just moving </span><span class="line" data-startTime="2215">forward at the speed of light, </span><span class="line" data-startTime="2215">the things that you're going </span><span class="line" data-startTime="2217">to be able to do. </span> <span class="line" data-startTime="2218">It's getting a lot easier. </span> <span class="line" data-startTime="2220">And it's getting a lot better. </span> <span class="line" data-startTime="2222">So packaged apps, yeah, we </span><span class="line" data-startTime="2222">definitely want that. </span> <span class="line" data-startTime="2227">And I think the way to think </span><span class="line" data-startTime="2227">about it in terms of how does </span><span class="line" data-startTime="2230">it relate to web apps is that </span><span class="line" data-startTime="2230">you could have the core of </span><span class="line" data-startTime="2234">your app have functionality </span><span class="line" data-startTime="2234">that is available </span><span class="line" data-startTime="2237">cross-platform, is not </span><span class="line" data-startTime="2237">necessarily specific to </span><span class="line" data-startTime="2239">Chrome, doesn't have these </span><span class="line" data-startTime="2239">extended APIs and permissions </span><span class="line" data-startTime="2243">that are requested. </span></p>

<p><span class="line" data-startTime="2244">And in doing that, you're going </span><span class="line" data-startTime="2244">to have a lot safer API. </span> <span class="line" data-startTime="2247">For example, you've got to use </span><span class="line" data-startTime="2247">XML HTTP requests, you're </span><span class="line" data-startTime="2251">going to have content security </span><span class="line" data-startTime="2251">policy support, all of that </span><span class="line" data-startTime="2254">from the get-go. </span> <span class="line" data-startTime="2255">And that's just your </span><span class="line" data-startTime="2255">core bundle. </span> <span class="line" data-startTime="2257">Layered on top of this is all </span><span class="line" data-startTime="2257">the goodies that you get from </span><span class="line" data-startTime="2260">the platform. </span> <span class="line" data-startTime="2260">You get the Identity </span><span class="line" data-startTime="2260">API, so use it. </span> <span class="line" data-startTime="2263">If you have it, use it. </span> <span class="line" data-startTime="2264">You get Media Galleries API. </span> <span class="line" data-startTime="2266">Use it. </span> <span class="line" data-startTime="2266">And if not, degrade </span><span class="line" data-startTime="2266">gracefully. </span> <span class="line" data-startTime="2268">And this is how if you build </span><span class="line" data-startTime="2268">your app, whether it's for </span><span class="line" data-startTime="2272">Chrome packaged apps </span><span class="line" data-startTime="2272">specifically, or if you're </span><span class="line" data-startTime="2274">going to deploy it on the web </span><span class="line" data-startTime="2274">across multiple browsers, if </span><span class="line" data-startTime="2277">you do this, you can have one </span><span class="line" data-startTime="2277">product that can work on </span><span class="line" data-startTime="2280">multiple platforms. </span></p>

<p><span class="line" data-startTime="2281">And on some platforms, it just </span><span class="line" data-startTime="2281">has more functionality. </span> <span class="line" data-startTime="2285">We've done that with Google+ </span><span class="line" data-startTime="2285">Photos Chrome app. </span> <span class="line" data-startTime="2287">And we think it's working </span><span class="line" data-startTime="2287">out really well. </span> <span class="line" data-startTime="2290">So I actually think we don't </span><span class="line" data-startTime="2290">have time for questions. </span> <span class="line" data-startTime="2294">We only have about </span><span class="line" data-startTime="2294">a minute left. </span> <span class="line" data-startTime="2295">But I will be at the Office </span><span class="line" data-startTime="2295">Hours bar if you want to come </span><span class="line" data-startTime="2299">by and ask any questions </span><span class="line" data-startTime="2299">you have. </span> <span class="line" data-startTime="2301">It's been a real pleasure. </span> <span class="line" data-startTime="2302">Thank you very much </span><span class="line" data-startTime="2302">for attending. </span> <span class="line" data-startTime="2304">And I hope to see </span><span class="line" data-startTime="2304">you guys soon. </span> <span class="line" data-startTime="2306">[APPLAUSE] </span></p>

<p></p>