<p><span class="line" data-startTime="9">But what I thought I would do, </span><span class="line" data-startTime="9">is I thought I'd take a step </span><span class="line" data-startTime="11">back for us now and I thought </span><span class="line" data-startTime="11">I'd visualize the speakers for </span><span class="line" data-startTime="14">you by help of a trustee </span><span class="line" data-startTime="14">Venn diagram. </span> <span class="line" data-startTime="18">Now on the left, we </span><span class="line" data-startTime="18">have bald people. </span> <span class="line" data-startTime="21">On the right, we have Pauls. </span> <span class="line" data-startTime="23">Colt, firmly in the bald camp. </span> <span class="line" data-startTime="28">Professor Irish, firmly </span><span class="line" data-startTime="28">in the Paul. </span> <span class="line" data-startTime="31">Me, making up the middle &mdash; </span><span class="line" data-startTime="34">the intersection, if you will. </span> <span class="line" data-startTime="36">But unfortunately we have Jake </span><span class="line" data-startTime="36">who's thinning up top and </span><span class="line" data-startTime="41">trying to get into bald. </span></p>

<p><span class="line" data-startTime="45">I wish him well. </span> <span class="line" data-startTime="50">Now what I wanted to do is I </span><span class="line" data-startTime="50">want to set the scene and I </span><span class="line" data-startTime="54">feel like resetting the scene. </span> <span class="line" data-startTime="57">Talking about rendering </span><span class="line" data-startTime="57">performance, there's a lot of </span><span class="line" data-startTime="58">people that kind of go, I'm not </span><span class="line" data-startTime="58">so sure, what does he mean </span><span class="line" data-startTime="62">by rendering, this </span><span class="line" data-startTime="62">performance chat. </span> <span class="line" data-startTime="65">And what we've done I think is </span><span class="line" data-startTime="65">we've gone, OK, how long does </span><span class="line" data-startTime="69">this thing take to load? </span><span class="line" data-startTime="71">How many requests am I making? </span><span class="line" data-startTime="73">Have I got gzip switched on? </span><span class="line" data-startTime="74">And what about ETags? </span><span class="line" data-startTime="75">They're dead. </span> <span class="line" data-startTime="77">I don't know what to do. </span> <span class="line" data-startTime="78">And I think I understand why </span><span class="line" data-startTime="78">we've done it, but the thing </span><span class="line" data-startTime="83">is it's only part </span><span class="line" data-startTime="83">of the picture. </span> <span class="line" data-startTime="87">It's only part of the problem. </span> <span class="line" data-startTime="89">Because as we discussed with </span><span class="line" data-startTime="89">the &mdash; or Colt discussed with </span><span class="line" data-startTime="92">the memory thing &mdash; </span><span class="line" data-startTime="93">that's something that </span><span class="line" data-startTime="93">doesn't fit into </span><span class="line" data-startTime="94">page load time, right? </span><span class="line" data-startTime="95">And that's a part </span><span class="line" data-startTime="95">of performance. </span> <span class="line" data-startTime="97">So it's sort of a bit </span><span class="line" data-startTime="97">of a question. </span></p>

<p><span class="line" data-startTime="99">And so what I'm going to do is </span><span class="line" data-startTime="99">just a quick, highly technical </span><span class="line" data-startTime="104">graph, or chart, for myself, </span><span class="line" data-startTime="104">of two apps. </span> <span class="line" data-startTime="109">App one is fast to load and slow </span><span class="line" data-startTime="109">to render and app two is </span><span class="line" data-startTime="112">slow to load and </span><span class="line" data-startTime="112">fast to render. </span> <span class="line" data-startTime="115">And which is worse? </span><span class="line" data-startTime="117">Which is better? </span><span class="line" data-startTime="118">And the answer, of course, is </span><span class="line" data-startTime="118">both of those are going to </span><span class="line" data-startTime="120">hack off your users. </span> <span class="line" data-startTime="122">They are not going to be happy </span><span class="line" data-startTime="122">with you, so it matters. </span> <span class="line" data-startTime="125">So what I thought I would then </span><span class="line" data-startTime="125">do is take us through the </span><span class="line" data-startTime="128">pipeline, a little </span><span class="line" data-startTime="128">bit like this. </span> <span class="line" data-startTime="132">The idea here is I'm going from </span><span class="line" data-startTime="132">a page load perspective, </span><span class="line" data-startTime="135">because that means we will hit </span><span class="line" data-startTime="135">every part of the pipeline. </span> <span class="line" data-startTime="138">I want to get through from how </span><span class="line" data-startTime="138">the browser does a request and </span><span class="line" data-startTime="142">gets pixels onto the screen. </span></p>

<p><span class="line" data-startTime="144">That's actually the job </span><span class="line" data-startTime="144">of the browser. </span> <span class="line" data-startTime="146">It's there to get content </span><span class="line" data-startTime="146">on your users' screens. </span> <span class="line" data-startTime="149">So it's good to understand it. </span> <span class="line" data-startTime="151">And then when your users are </span><span class="line" data-startTime="151">scrolling and dragging stuff </span><span class="line" data-startTime="153">about and just generally using </span><span class="line" data-startTime="153">your site or your app, then </span><span class="line" data-startTime="157">we'll hit parts of this pipeline </span><span class="line" data-startTime="157">again, so it's good </span><span class="line" data-startTime="159">to understand it. </span> <span class="line" data-startTime="161">This is part one of two, because </span><span class="line" data-startTime="161">I would normally talk </span><span class="line" data-startTime="164">about the DevTools-y part of </span><span class="line" data-startTime="164">this where you can figure out </span><span class="line" data-startTime="166">how your project is </span><span class="line" data-startTime="166">actually working. </span> <span class="line" data-startTime="170">But Paul Irish is going </span><span class="line" data-startTime="170">to actually do </span><span class="line" data-startTime="171">that part later on. </span></p>

<p><span class="line" data-startTime="172">So think of this as a sort </span><span class="line" data-startTime="172">of scene setter, a </span><span class="line" data-startTime="174">part one if you will. </span> <span class="line" data-startTime="177">Now, we start off our journey </span><span class="line" data-startTime="177">with the humble get </span><span class="line" data-startTime="180">request, like so. </span> <span class="line" data-startTime="183">Our server is going to respond </span><span class="line" data-startTime="183">for us with some HTML &mdash; </span><span class="line" data-startTime="188">all pretty awesome. </span> <span class="line" data-startTime="190">And the first thing that the </span><span class="line" data-startTime="190">browser is going to do &mdash; and </span><span class="line" data-startTime="193">it does clever stuff with </span><span class="line" data-startTime="193">doing the streamed and </span><span class="line" data-startTime="196">lookaheads and all this </span><span class="line" data-startTime="196">kind of stuff &mdash; </span><span class="line" data-startTime="197">but it starts to parse that and </span><span class="line" data-startTime="197">when you look in DevTools </span><span class="line" data-startTime="201">you'll see things </span><span class="line" data-startTime="201">like parse HTML. </span> <span class="line" data-startTime="202">Which is this process, really, </span><span class="line" data-startTime="202">of taking tag soup and turning </span><span class="line" data-startTime="206">it into this, which </span><span class="line" data-startTime="206">is the DOM. </span> <span class="line" data-startTime="210">And that's the DOM for that </span><span class="line" data-startTime="210">HTML, so we'll just make our </span><span class="line" data-startTime="214">lives a little bit easier and </span><span class="line" data-startTime="214">just call it the DOM. </span> <span class="line" data-startTime="218">And then what we do is </span><span class="line" data-startTime="218">we take the CSS &mdash; </span><span class="line" data-startTime="222">we're just going to add </span><span class="line" data-startTime="222">that plus in there &mdash; </span><span class="line" data-startTime="224">we take the CSS, and some of </span><span class="line" data-startTime="224">that CSS will come part of the </span><span class="line" data-startTime="227">browser as the default style </span><span class="line" data-startTime="227">sheets with the browser, </span><span class="line" data-startTime="230">there's the stuff you put in </span><span class="line" data-startTime="230">line, there's the stuff that's </span><span class="line" data-startTime="232">in your style sheets &mdash; </span><span class="line" data-startTime="233">and we start to actually figure </span><span class="line" data-startTime="233">out from the DOM what </span><span class="line" data-startTime="238">CSS applies to what. </span></p>

<p><span class="line" data-startTime="239">And historically, people have </span><span class="line" data-startTime="239">spent quite a lot of time </span><span class="line" data-startTime="243">trying to optimize </span><span class="line" data-startTime="243">CSS selectors. </span> <span class="line" data-startTime="246">How quickly &mdash; </span><span class="line" data-startTime="247">and it's actually a bit of a </span><span class="line" data-startTime="247">waste of your time because the </span><span class="line" data-startTime="250">browser's very, very, </span><span class="line" data-startTime="250">very fast at </span><span class="line" data-startTime="253">doing selector matching. </span> <span class="line" data-startTime="254">So just bear that one in mind. </span> <span class="line" data-startTime="255">Anyway, this will show up in </span><span class="line" data-startTime="255">DevTools as Recalculate Style. </span> <span class="line" data-startTime="260">So what happens &mdash; and I'm about </span><span class="line" data-startTime="260">to do a sound effect, I </span><span class="line" data-startTime="261">can feel it coming along &mdash; </span><span class="line" data-startTime="263">we put these together </span><span class="line" data-startTime="263">like [PBBTH] </span><span class="line" data-startTime="265">that and we get the </span><span class="line" data-startTime="265">render tree. </span> <span class="line" data-startTime="270">Paul Irish is happy </span><span class="line" data-startTime="270">with that noise. </span> <span class="line" data-startTime="272">He's happy with that. </span> <span class="line" data-startTime="273">Now the render tree looks </span><span class="line" data-startTime="273">distinctly like the DOM, </span><span class="line" data-startTime="276">except that things are missing, </span><span class="line" data-startTime="276">like the head, for </span><span class="line" data-startTime="278">example, or our scripts. </span></p>

<p><span class="line" data-startTime="280">They're not there because we're </span><span class="line" data-startTime="280">not going to render </span><span class="line" data-startTime="282">them, so they don't appear </span><span class="line" data-startTime="282">in that tree. </span> <span class="line" data-startTime="286">But let's say, for example, I </span><span class="line" data-startTime="286">decide that in my style sheets </span><span class="line" data-startTime="289">I'm going to put section p. </span> <span class="line" data-startTime="291">[BOOP] </span><span class="line" data-startTime="291">I'm going to say display none. </span> <span class="line" data-startTime="293">That will disappear from the </span><span class="line" data-startTime="293">render tree because it's set </span><span class="line" data-startTime="295">to display none. </span> <span class="line" data-startTime="296">It's not something we're </span><span class="line" data-startTime="296">going to draw. </span> <span class="line" data-startTime="297">It's not something </span><span class="line" data-startTime="297">we care about. </span> <span class="line" data-startTime="300">Equally, I could have a pseudo </span><span class="line" data-startTime="300">element and that would add </span><span class="line" data-startTime="303">something into the </span><span class="line" data-startTime="303">render tree. </span> <span class="line" data-startTime="305">So the render tree as I said, it </span><span class="line" data-startTime="305">looks like the DOM but it's </span><span class="line" data-startTime="308">not the DOM. </span></p>

<p><span class="line" data-startTime="309">It's the styles applied </span><span class="line" data-startTime="309">to the DOM. </span> <span class="line" data-startTime="312">So that's that. </span> <span class="line" data-startTime="314">Now the next job &mdash; and it's </span><span class="line" data-startTime="314">going to look like a really </span><span class="line" data-startTime="318">simple job &mdash; we've </span><span class="line" data-startTime="318">got all this CSS </span><span class="line" data-startTime="320">that we want to apply. </span> <span class="line" data-startTime="321">And it's basically like widths </span><span class="line" data-startTime="321">and heights, and display blog, </span><span class="line" data-startTime="326">position absolute, all </span><span class="line" data-startTime="326">this kind of stuff. </span> <span class="line" data-startTime="327">And what the browser has to do </span><span class="line" data-startTime="327">is take that and go, where </span><span class="line" data-startTime="332">does everything live </span><span class="line" data-startTime="332">on screen? </span><span class="line" data-startTime="334">What are the boxes here? </span><span class="line" data-startTime="337">And, as you probably know, </span><span class="line" data-startTime="337">this can actually get </span><span class="line" data-startTime="339">extremely expensive because </span><span class="line" data-startTime="339">everything tends to be </span><span class="line" data-startTime="342">contingent on everything else. </span></p>

<p><span class="line" data-startTime="344">So if I were to change the </span><span class="line" data-startTime="344">height of body, everything </span><span class="line" data-startTime="347">that's inside body needs </span><span class="line" data-startTime="347">to be recalculated. </span> <span class="line" data-startTime="350">And this will show itself up </span><span class="line" data-startTime="350">in DevTools as layout. </span> <span class="line" data-startTime="353">And that's where all those </span><span class="line" data-startTime="353">boxes are coming from. </span> <span class="line" data-startTime="357">Good. </span> <span class="line" data-startTime="359">So the next job that we </span><span class="line" data-startTime="359">have is to actually </span><span class="line" data-startTime="362">fill in some pixels. </span> <span class="line" data-startTime="363">We know where those boxes are, </span><span class="line" data-startTime="363">but they now need filling in </span><span class="line" data-startTime="368">with pixels, so we need </span><span class="line" data-startTime="368">a rasterizer. </span> <span class="line" data-startTime="370">Now just a bit of terminology </span><span class="line" data-startTime="370">in case you don't spend the </span><span class="line" data-startTime="374">time looking at this stuff. </span></p>

<p><span class="line" data-startTime="375">Vectors are basically shapes </span><span class="line" data-startTime="375">that we have the mathematical </span><span class="line" data-startTime="379">formulae for or we have the </span><span class="line" data-startTime="379">positions of the corners, for </span><span class="line" data-startTime="383">example, in the case </span><span class="line" data-startTime="383">of a triangle. </span> <span class="line" data-startTime="385">We're interested in </span><span class="line" data-startTime="385">actually pixels. </span> <span class="line" data-startTime="387">So what we actually have to do </span><span class="line" data-startTime="387">is we have to figure out from </span><span class="line" data-startTime="390">our triangle which pixels we </span><span class="line" data-startTime="390">need to fill in and what color </span><span class="line" data-startTime="393">they need to be. </span> <span class="line" data-startTime="393">And this is the process </span><span class="line" data-startTime="393">of converting </span><span class="line" data-startTime="394">vector to raster, OK? </span><span class="line" data-startTime="396">All pretty simple. </span> <span class="line" data-startTime="397">Now if you and I were to have a </span><span class="line" data-startTime="397">fun afternoon and we were to </span><span class="line" data-startTime="401">create a rasterizer, we'd </span><span class="line" data-startTime="401">probably include </span><span class="line" data-startTime="406">methods like this. </span> <span class="line" data-startTime="407">And I know that we would because </span><span class="line" data-startTime="407">these are the ones </span><span class="line" data-startTime="409">from Chrome's rasterizer, </span><span class="line" data-startTime="409">which is called Skia. </span></p>

<p><span class="line" data-startTime="411">And so you can imagine that </span><span class="line" data-startTime="411">I'd drawPoints, drawOvals, </span><span class="line" data-startTime="414">drawRectangles, drawBitmaps, </span><span class="line" data-startTime="414">draw some text. </span> <span class="line" data-startTime="419">And if you've worked with the </span><span class="line" data-startTime="419">HTML5 canvas, a lot of this </span><span class="line" data-startTime="422">stuff will actually look </span><span class="line" data-startTime="422">quite similar. </span> <span class="line" data-startTime="424">It's the rasterizer, </span><span class="line" data-startTime="424">basically. </span> <span class="line" data-startTime="427">So now what we can do &mdash; </span><span class="line" data-startTime="429">I actually ran that HTML &mdash; </span><span class="line" data-startTime="431">I actually ran it through Skia </span><span class="line" data-startTime="431">and said, what did you do? </span><span class="line" data-startTime="435">And it told me. </span> <span class="line" data-startTime="436">So I thought I'd show </span><span class="line" data-startTime="436">you what it does. </span> <span class="line" data-startTime="438">Ta-daa! </span><span class="line" data-startTime="440">But you probably didn't see </span><span class="line" data-startTime="440">what was going on, so why </span><span class="line" data-startTime="442">don't we have ourselves </span><span class="line" data-startTime="442">an instant replay? </span><span class="line" data-startTime="444">Now, you'll see that as we get </span><span class="line" data-startTime="444">through each of these calls </span><span class="line" data-startTime="447">we're starting to build up </span><span class="line" data-startTime="447">the picture of what's </span><span class="line" data-startTime="449">actually going on. </span></p>

<p><span class="line" data-startTime="450">Draw a rounded rectangle, which </span><span class="line" data-startTime="450">isn't that clear but </span><span class="line" data-startTime="452">that's the drop shadow. </span> <span class="line" data-startTime="453">Draw the path, here we go, draw </span><span class="line" data-startTime="453">the bitmap, which is my </span><span class="line" data-startTime="456">face, do a bit of tidy up, </span><span class="line" data-startTime="456">and we'll call it a day. </span> <span class="line" data-startTime="459">DevTools is going to show </span><span class="line" data-startTime="459">you that as paint. </span> <span class="line" data-startTime="461">That's how it goes about letting </span><span class="line" data-startTime="461">you know that it did </span><span class="line" data-startTime="464">some of that work. </span> <span class="line" data-startTime="466">Now, some of this bears </span><span class="line" data-startTime="466">a little bit </span><span class="line" data-startTime="468">more scrutiny, I think. </span> <span class="line" data-startTime="470">Specifically, drawBitmap. </span> <span class="line" data-startTime="472">Now, I was a good developer. </span> <span class="line" data-startTime="474">I sent through my tiny JPEG, I </span><span class="line" data-startTime="474">compressed it, I'm good on the </span><span class="line" data-startTime="478">page load time, I'm happy, </span><span class="line" data-startTime="478">well done me. </span></p>

<p><span class="line" data-startTime="480">But you'll notice that it's </span><span class="line" data-startTime="480">called drawBitmap and not </span><span class="line" data-startTime="484">drawJpeg, or drawPng, </span><span class="line" data-startTime="484">or drawGif &mdash; </span><span class="line" data-startTime="488">"jif," gif. </span> <span class="line" data-startTime="489">Hands up for gif &mdash; </span><span class="line" data-startTime="492">ooh it's going to be close &mdash; </span><span class="line" data-startTime="493">hands up for "jif." </span><span class="line" data-startTime="493">You're wrong. </span> <span class="line" data-startTime="497">[LAUGHTER] </span><span class="line" data-startTime="502">They're not "jraphics", </span><span class="line" data-startTime="502">are they? </span><span class="line" data-startTime="507">So now we have our JPEG and we </span><span class="line" data-startTime="507">basically go through and we're </span><span class="line" data-startTime="511">going to decode out an </span><span class="line" data-startTime="511">image into a bitmap &mdash; </span><span class="line" data-startTime="516">red, green, blue, and </span><span class="line" data-startTime="516">possibly alpha. </span> <span class="line" data-startTime="519">But the thing is we are also </span><span class="line" data-startTime="519">maybe doing a bit of </span><span class="line" data-startTime="520">responsive web design, so we </span><span class="line" data-startTime="520">also have to do some re-sizes </span><span class="line" data-startTime="523">as well on the other side. </span> <span class="line" data-startTime="524">So these are extremely </span><span class="line" data-startTime="524">expensive. </span> <span class="line" data-startTime="527">They show up in DevTools &mdash; </span><span class="line" data-startTime="528">you can spin down Paint records </span><span class="line" data-startTime="528">and you'll see image </span><span class="line" data-startTime="530">decodes and image re-sizes &mdash; </span><span class="line" data-startTime="533">and they will kill your frames </span><span class="line" data-startTime="533">per second if you have them, </span><span class="line" data-startTime="538">particularly re-sizes </span><span class="line" data-startTime="538">actually. </span> <span class="line" data-startTime="541">OK, so we've spent some </span><span class="line" data-startTime="541">time with drawBitmap. </span> <span class="line" data-startTime="544">The next thing we want to </span><span class="line" data-startTime="544">look at is quite fancy. </span> <span class="line" data-startTime="547">We're going to do a </span><span class="line" data-startTime="547">bit of animation. </span></p>

<p><span class="line" data-startTime="548">What we're going to actually end </span><span class="line" data-startTime="548">up doing is we're going to </span><span class="line" data-startTime="550">move that picture of </span><span class="line" data-startTime="550">me up to there. </span> <span class="line" data-startTime="553">Now when this happens, we </span><span class="line" data-startTime="553">basically took this rectangle </span><span class="line" data-startTime="557">around everything and said, this </span><span class="line" data-startTime="557">is now damaged and dirty. </span> <span class="line" data-startTime="561">This area needs fixing. </span> <span class="line" data-startTime="563">This needs repainting. </span> <span class="line" data-startTime="566">So we actually have to step </span><span class="line" data-startTime="566">through one by one and re-run </span><span class="line" data-startTime="570">all those commands, with the </span><span class="line" data-startTime="570">drop shadow, and the white </span><span class="line" data-startTime="573">box, and the bitmap. </span> <span class="line" data-startTime="576">And it doesn't take much </span><span class="line" data-startTime="576">imagination to figure out that </span><span class="line" data-startTime="578">if we have a lot of things that </span><span class="line" data-startTime="578">need painting, or we move </span><span class="line" data-startTime="582">something a really, really </span><span class="line" data-startTime="582">long way, that could be a </span><span class="line" data-startTime="585">hugely expensive thing </span><span class="line" data-startTime="585">that we just did. </span></p>

<p><span class="line" data-startTime="588">So what we do to work around </span><span class="line" data-startTime="588">that is we do these things </span><span class="line" data-startTime="591">called layers. </span> <span class="line" data-startTime="591">Instead of having one surface </span><span class="line" data-startTime="591">that we render into, that we </span><span class="line" data-startTime="595">rasterize into, we </span><span class="line" data-startTime="595">have several. </span> <span class="line" data-startTime="597">So this is my website and </span><span class="line" data-startTime="597">this is actually &mdash; </span><span class="line" data-startTime="601">the masthead thing </span><span class="line" data-startTime="601">is a canvas &mdash; </span><span class="line" data-startTime="603">so why don't we just boost </span><span class="line" data-startTime="603">that out a little bit. </span> <span class="line" data-startTime="605">Now what happens is, we can </span><span class="line" data-startTime="605">basically do this so that when </span><span class="line" data-startTime="608">we want to change something in </span><span class="line" data-startTime="608">the masthead, we don't have to </span><span class="line" data-startTime="610">worry about repainting </span><span class="line" data-startTime="610">the thing behind. </span></p>

<p><span class="line" data-startTime="612">We keep it separate. </span> <span class="line" data-startTime="613">This is extremely useful. </span> <span class="line" data-startTime="615">What's also interesting about </span><span class="line" data-startTime="615">this, or at least to me </span><span class="line" data-startTime="617">because I'm a nerd, is the Next </span><span class="line" data-startTime="617">and Previous buttons are </span><span class="line" data-startTime="622">actually DOM elements </span><span class="line" data-startTime="622">on their own, right? </span><span class="line" data-startTime="624">But they're sitting on top of </span><span class="line" data-startTime="624">something that was just </span><span class="line" data-startTime="626">boosted out to its own layer. </span> <span class="line" data-startTime="628">So what Chrome actually ends </span><span class="line" data-startTime="628">up doing, is it ends up </span><span class="line" data-startTime="630">creating more layers </span><span class="line" data-startTime="630">just for those. </span> <span class="line" data-startTime="633">So you actually end up with </span><span class="line" data-startTime="633">four of the suckers. </span></p>

<p><span class="line" data-startTime="637">And these all get sent across </span><span class="line" data-startTime="637">the GPU, which we'll talk </span><span class="line" data-startTime="639">about in a second, and then </span><span class="line" data-startTime="639">composite layers is what </span><span class="line" data-startTime="641">you're going to see </span><span class="line" data-startTime="641">in DevTools. </span> <span class="line" data-startTime="643">That's when it's taking all </span><span class="line" data-startTime="643">these layers and all this </span><span class="line" data-startTime="644">stuff and it's basically </span><span class="line" data-startTime="644">going [SHOOP] </span><span class="line" data-startTime="647">putting them all </span><span class="line" data-startTime="647">together again. </span> <span class="line" data-startTime="649">Figuring out what layers it </span><span class="line" data-startTime="649">needs, where they need to </span><span class="line" data-startTime="652">live, all that kind of stuff. </span> <span class="line" data-startTime="655">So those are the layers. </span> <span class="line" data-startTime="656">They're pretty cool. </span> <span class="line" data-startTime="657">And you might be asking </span><span class="line" data-startTime="657">yourself, so </span><span class="line" data-startTime="660">how do I get a layer? </span><span class="line" data-startTime="661">That's exciting to me. </span> <span class="line" data-startTime="662">You'll notice it's subject </span><span class="line" data-startTime="662">to change because it's an </span><span class="line" data-startTime="664">implementation detail. </span></p>

<p><span class="line" data-startTime="665">But all the same, let's </span><span class="line" data-startTime="665">have a look at them. </span> <span class="line" data-startTime="668">3D or perspective transform &mdash; </span><span class="line" data-startTime="670">anybody use an old </span><span class="line" data-startTime="670">transform hack? </span><span class="line" data-startTime="671">Anybody translateZ(0) happy? </span><span class="line" data-startTime="674">Yeah? </span><span class="line" data-startTime="674">Work for you? </span><span class="line" data-startTime="675">Good, OK that's the </span><span class="line" data-startTime="675">classic one. </span> <span class="line" data-startTime="678">Video elements, canvas elements, </span><span class="line" data-startTime="678">composited plugins </span><span class="line" data-startTime="680">like Flash or Silverlight, </span><span class="line" data-startTime="680">an animation on opacity, </span><span class="line" data-startTime="684">interesting &mdash; </span><span class="line" data-startTime="685">transform, filters like blur and </span><span class="line" data-startTime="685">all those ones, and then </span><span class="line" data-startTime="689">the last one, which are my Next </span><span class="line" data-startTime="689">and Previous buttons, </span><span class="line" data-startTime="691">those are rendered on top </span><span class="line" data-startTime="691">of another layer. </span></p>

<p><span class="line" data-startTime="695">So those are the ones, you could </span><span class="line" data-startTime="695">imagine that we might </span><span class="line" data-startTime="697">add some more, we might. </span> <span class="line" data-startTime="700">So the last little part &mdash; </span><span class="line" data-startTime="700">and this is the </span><span class="line" data-startTime="702">website from tonight &mdash; </span><span class="line" data-startTime="703">is to actually take those </span><span class="line" data-startTime="703">rastered images and send them </span><span class="line" data-startTime="707">across the GPU. </span> <span class="line" data-startTime="708">The thing to bear in mind, all </span><span class="line" data-startTime="708">that rasterization we did was </span><span class="line" data-startTime="711">done actually on the CPU. </span> <span class="line" data-startTime="713">And when we do rasterization &mdash; </span><span class="line" data-startTime="715">this is a small detail, I just </span><span class="line" data-startTime="715">wanted to include it for </span><span class="line" data-startTime="717">completeness' sake &mdash; </span><span class="line" data-startTime="718">we actually rasterize </span><span class="line" data-startTime="718">into tiles. </span></p>

<p><span class="line" data-startTime="721">Doesn't make any difference to </span><span class="line" data-startTime="721">us as developers, but I just </span><span class="line" data-startTime="724">like to include it. </span> <span class="line" data-startTime="726">So there we go. </span> <span class="line" data-startTime="728">That doesn't matter for what </span><span class="line" data-startTime="728">we do, but we have the CPU. </span> <span class="line" data-startTime="732">All this work so far has </span><span class="line" data-startTime="732">happened on the CPU. </span> <span class="line" data-startTime="734">So when people are talking about </span><span class="line" data-startTime="734">hardware accelerated </span><span class="line" data-startTime="736">this and that, so far </span><span class="line" data-startTime="736">everything we've </span><span class="line" data-startTime="739">done was on the CPU. </span> <span class="line" data-startTime="741">The last thing that we actually </span><span class="line" data-startTime="741">end up doing at this </span><span class="line" data-startTime="743">point is sending those tiles </span><span class="line" data-startTime="743">across to the GPU &mdash; </span><span class="line" data-startTime="747">happy days. </span> <span class="line" data-startTime="748">And that was a nice simple </span><span class="line" data-startTime="748">animation, but the bandwidth </span><span class="line" data-startTime="750">between CPU and GPU might </span><span class="line" data-startTime="750">be quite constrained. </span> <span class="line" data-startTime="753">Especially on a mobile device, </span><span class="line" data-startTime="753">it's very easy to </span><span class="line" data-startTime="756">saturate that link. </span> <span class="line" data-startTime="757">And if you're having </span><span class="line" data-startTime="757">to send across &mdash; </span><span class="line" data-startTime="760">if you're doing a lot of </span><span class="line" data-startTime="760">repainting, and you're sending </span><span class="line" data-startTime="761">a lot of stuff across </span><span class="line" data-startTime="761">to the GPU, you </span><span class="line" data-startTime="763">might really struggle. </span></p>

<p><span class="line" data-startTime="765">So it's a finely </span><span class="line" data-startTime="765">balanced thing. </span> <span class="line" data-startTime="766">Anyway, that's going to show </span><span class="line" data-startTime="766">up as composite layers. </span> <span class="line" data-startTime="769">And finally, [WHOOSH] </span><span class="line" data-startTime="770">there we go, we end up with </span><span class="line" data-startTime="770">something on screen. </span> <span class="line" data-startTime="773">So now we know how you get from </span><span class="line" data-startTime="773">the humble get request </span><span class="line" data-startTime="777">all the way through to some </span><span class="line" data-startTime="777">pixels on screen. </span> <span class="line" data-startTime="781">So with that said, I am now </span><span class="line" data-startTime="781">interested in the bit where we </span><span class="line" data-startTime="784">control the workload. </span> <span class="line" data-startTime="787">I really want to ask, are you </span><span class="line" data-startTime="787">the captain of your ship? </span><span class="line" data-startTime="790">Arrr. </span></p>

<p><span class="line" data-startTime="791">But I'm not going to. </span> <span class="line" data-startTime="793">But we are, and so seeing as </span><span class="line" data-startTime="793">we're in control, let's talk </span><span class="line" data-startTime="795">about some millisecond </span><span class="line" data-startTime="795">stuff for a second. </span> <span class="line" data-startTime="797">Let's frame what we're </span><span class="line" data-startTime="797">interested in. </span> <span class="line" data-startTime="801">When a user interacts with your </span><span class="line" data-startTime="801">site or your application, </span><span class="line" data-startTime="805">we have 100 milliseconds in </span><span class="line" data-startTime="805">which to respond for that user </span><span class="line" data-startTime="811">to feel like it was an </span><span class="line" data-startTime="811">instant response. </span> <span class="line" data-startTime="813">If we take more than 100 </span><span class="line" data-startTime="813">milliseconds to respond to the </span><span class="line" data-startTime="816">user's interaction, </span><span class="line" data-startTime="816">we have failed. </span> <span class="line" data-startTime="820">They will notice. </span> <span class="line" data-startTime="821">The second thing that we care </span><span class="line" data-startTime="821">about is 16 milliseconds. </span> <span class="line" data-startTime="825">If we're doing anything like </span><span class="line" data-startTime="825">scrolling, or dragging, or </span><span class="line" data-startTime="830">anything that's regularly </span><span class="line" data-startTime="830">animating and updating the </span><span class="line" data-startTime="833">screen, we have 16 milliseconds </span><span class="line" data-startTime="833">in which to get </span><span class="line" data-startTime="836">all the work done. </span></p>

<p><span class="line" data-startTime="838">So this is just to frame </span><span class="line" data-startTime="838">our argument here. </span> <span class="line" data-startTime="841">Response time, 100 milliseconds, </span><span class="line" data-startTime="841">frame time, 16 </span><span class="line" data-startTime="843">milliseconds. </span> <span class="line" data-startTime="846">Now all I'm going to do at this </span><span class="line" data-startTime="846">point &mdash; as I say normally </span><span class="line" data-startTime="849">I'd show you some DevTools, </span><span class="line" data-startTime="849">but I'm going to just talk </span><span class="line" data-startTime="851">about some stuff you want to </span><span class="line" data-startTime="851">look at, some stuff you need </span><span class="line" data-startTime="853">to be careful of, and then Paul </span><span class="line" data-startTime="853">will actually run you </span><span class="line" data-startTime="856">through DevTools and the tools </span><span class="line" data-startTime="856">that are available to you. </span> <span class="line" data-startTime="860">Small style changes can have </span><span class="line" data-startTime="860">big layout knock-ons. </span> <span class="line" data-startTime="863">If you're, say, changing body </span><span class="line" data-startTime="863">like I explained before, we </span><span class="line" data-startTime="869">have to re-layout everything. </span> <span class="line" data-startTime="871">Huge deal if you're trying </span><span class="line" data-startTime="871">to do that in an </span><span class="line" data-startTime="874">animation, for example. </span> <span class="line" data-startTime="875">You decide you're going to </span><span class="line" data-startTime="875">change some high level element </span><span class="line" data-startTime="879">instead of one or two </span><span class="line" data-startTime="879">levels into the DOM. </span></p>

<p><span class="line" data-startTime="881">Everything's probably going </span><span class="line" data-startTime="881">to get recalculated. </span> <span class="line" data-startTime="883">That will kill you in terms </span><span class="line" data-startTime="883">of your frame rate. </span> <span class="line" data-startTime="888">This is something of a common </span><span class="line" data-startTime="888">misconception that layout is </span><span class="line" data-startTime="891">somehow always triggered </span><span class="line" data-startTime="891">by JavaScript. </span> <span class="line" data-startTime="894">It's not. </span> <span class="line" data-startTime="895">You can have a transition that's </span><span class="line" data-startTime="895">in response to a hover. </span> <span class="line" data-startTime="899">It's not done by JavaScript, but </span><span class="line" data-startTime="899">it's layouts all the same. </span> <span class="line" data-startTime="905">And layout isn't painting. </span> <span class="line" data-startTime="907">Now that you've been through </span><span class="line" data-startTime="907">that pipeline with me, again </span><span class="line" data-startTime="910">there's often a misunderstanding </span><span class="line" data-startTime="910">that layout </span><span class="line" data-startTime="912">is somehow painting, but </span><span class="line" data-startTime="912">actually layout &mdash; </span><span class="line" data-startTime="915">if you do change the position </span><span class="line" data-startTime="915">of something, we </span><span class="line" data-startTime="917">might need to repaint. </span></p>

<p><span class="line" data-startTime="918">And we'll have a look </span><span class="line" data-startTime="918">at something that's </span><span class="line" data-startTime="919">doing that in a second. </span> <span class="line" data-startTime="922">There's a thing that looks </span><span class="line" data-startTime="922">a little bit like </span><span class="line" data-startTime="924">this and the code &mdash; </span><span class="line" data-startTime="925">it doesn't really matter too </span><span class="line" data-startTime="925">much what the code is doing. </span> <span class="line" data-startTime="927">I'll tell you what it's doing </span><span class="line" data-startTime="927">anyway, just for a laugh. </span> <span class="line" data-startTime="929">We're going through some </span><span class="line" data-startTime="929">paragraphs and we've got some </span><span class="line" data-startTime="933">other element we want to match </span><span class="line" data-startTime="933">the widths of all our </span><span class="line" data-startTime="936">paragraphs to. </span> <span class="line" data-startTime="938">So the first thing we do is we </span><span class="line" data-startTime="938">ask for the width of this </span><span class="line" data-startTime="941">thing called greenBlock. </span> <span class="line" data-startTime="943">And we ask for its offset width, </span><span class="line" data-startTime="943">which causes Chrome &mdash; </span><span class="line" data-startTime="946">and in fact any WebKit or </span><span class="line" data-startTime="946">Blink-based browser &mdash; </span><span class="line" data-startTime="949">to go off and do a layout </span><span class="line" data-startTime="949">operation, go, what's the </span><span class="line" data-startTime="953">width of the green </span><span class="line" data-startTime="953">block please? </span><span class="line" data-startTime="955">And then we set the first </span><span class="line" data-startTime="955">paragraph's width. </span> <span class="line" data-startTime="958">And then we go through that loop </span><span class="line" data-startTime="958">over and over and over </span><span class="line" data-startTime="960">and over and over again and </span><span class="line" data-startTime="960">that is effectively </span><span class="line" data-startTime="963">read-write-read- </span><span class="line" data-startTime="963">write-read-write </span><span class="line" data-startTime="963">-read-write-read-write &mdash; </span><span class="line" data-startTime="967">and that's not a good thing. </span></p>

<p><span class="line" data-startTime="969">Because every single write </span><span class="line" data-startTime="969">invalidates the previous read. </span> <span class="line" data-startTime="972">This is called layout </span><span class="line" data-startTime="972">thrashing. </span> <span class="line" data-startTime="975">You do not want this in </span><span class="line" data-startTime="975">your applications. </span> <span class="line" data-startTime="979">What you wanted to do &mdash; </span><span class="line" data-startTime="980">there we go &mdash; </span><span class="line" data-startTime="981">was to ask for the width once. </span> <span class="line" data-startTime="985">Read-write-write </span><span class="line" data-startTime="985">-write-write-write. </span> <span class="line" data-startTime="988">Happy days. </span> <span class="line" data-startTime="989">Paint &mdash; </span><span class="line" data-startTime="990">I'll show you this demo. </span> <span class="line" data-startTime="992">There's this brilliant tool </span><span class="line" data-startTime="992">called Show paint rectangles. </span> <span class="line" data-startTime="995">If you're ever wondering whether </span><span class="line" data-startTime="995">something's painting </span><span class="line" data-startTime="997">in Chrome, that is your tool. </span> <span class="line" data-startTime="1000">And what's going to happen is so </span><span class="line" data-startTime="1000">I select some text, right, </span><span class="line" data-startTime="1003">and you get this red </span><span class="line" data-startTime="1003">box around it. </span> <span class="line" data-startTime="1005">And that's basically Chrome </span><span class="line" data-startTime="1005">saying, I had to do some </span><span class="line" data-startTime="1007">repainting here, Paul. </span></p>

<p><span class="line" data-startTime="1010">Thanks, Chrome. </span> <span class="line" data-startTime="1012">I expected you to do </span><span class="line" data-startTime="1012">it and you did. </span> <span class="line" data-startTime="1014">You are so reliable. </span> <span class="line" data-startTime="1015">Anyway, so what I've got is I've </span><span class="line" data-startTime="1015">got these buttons &mdash; oh, </span><span class="line" data-startTime="1018">yeah, scroll bar, that's getting </span><span class="line" data-startTime="1018">repainted &mdash; now I've </span><span class="line" data-startTime="1021">got this button up here </span><span class="line" data-startTime="1021">that says Animate. </span> <span class="line" data-startTime="1023">It is a highly realistic </span><span class="line" data-startTime="1023">animation. </span> <span class="line" data-startTime="1028">Now the interesting thing here </span><span class="line" data-startTime="1028">is that this one big area </span><span class="line" data-startTime="1034">needed repainting because we're </span><span class="line" data-startTime="1036">moving everything inside. </span> <span class="line" data-startTime="1037">But we can also figure out </span><span class="line" data-startTime="1037">that they've all been </span><span class="line" data-startTime="1040">flattened down to one surface, </span><span class="line" data-startTime="1040">one layer that we're actually </span><span class="line" data-startTime="1044">painting into, right? </span><span class="line" data-startTime="1045">So this is the thing that's </span><span class="line" data-startTime="1045">getting invalidated. </span></p>

<p><span class="line" data-startTime="1047">It needs repainting. </span> <span class="line" data-startTime="1049">That might be slow, so </span><span class="line" data-startTime="1049">we're quite smart. </span> <span class="line" data-startTime="1051">What we want to do is we're </span><span class="line" data-startTime="1051">going to use the translateZ(0) </span><span class="line" data-startTime="1053">hack to isolate all those boxes </span><span class="line" data-startTime="1053">and all we're doing is </span><span class="line" data-startTime="1058">moving them around. </span> <span class="line" data-startTime="1059">And the GPU is really good at </span><span class="line" data-startTime="1059">just moving stuff around. </span> <span class="line" data-startTime="1061">It's fantastic at it. </span> <span class="line" data-startTime="1063">So we're going to do that. </span> <span class="line" data-startTime="1064">There we go. </span> <span class="line" data-startTime="1064">Change it to black just </span><span class="line" data-startTime="1064">so it's a bit easier. </span> <span class="line" data-startTime="1066">And then moving you see we're </span><span class="line" data-startTime="1066">not painting anymore. </span></p>

<p><span class="line" data-startTime="1068">Because we painted them once, </span><span class="line" data-startTime="1068">all these layers, and then we </span><span class="line" data-startTime="1071">just asked the GPU to </span><span class="line" data-startTime="1071">move them around. </span> <span class="line" data-startTime="1072">This is an awesome way of using </span><span class="line" data-startTime="1072">the translateZ(0) hack. </span> <span class="line" data-startTime="1075">I've come full circle. </span> <span class="line" data-startTime="1076">I used to hate it, now I love </span><span class="line" data-startTime="1076">it just for this reason. </span> <span class="line" data-startTime="1080">The danger that we then have &mdash; </span><span class="line" data-startTime="1083">I'm just hovering </span><span class="line" data-startTime="1083">over in this &mdash; </span><span class="line" data-startTime="1085">animate the radii. </span> <span class="line" data-startTime="1087">Now these boxes have a slightly </span><span class="line" data-startTime="1087">rounded corner. </span> <span class="line" data-startTime="1091">What I've got is I've got an </span><span class="line" data-startTime="1091">animation queued up that's </span><span class="line" data-startTime="1093">going to change the border </span><span class="line" data-startTime="1093">radius of each of those boxes. </span> <span class="line" data-startTime="1098">Ready? </span><span class="line" data-startTime="1100">[AUGH] </span><span class="line" data-startTime="1102">Look how much it crawls. </span> <span class="line" data-startTime="1105">So it's not always a good thing </span><span class="line" data-startTime="1105">to isolate everything </span><span class="line" data-startTime="1111">and put a translateZ(0) </span><span class="line" data-startTime="1111">hack on it. </span></p>

<p><span class="line" data-startTime="1112">Because you can end up creating </span><span class="line" data-startTime="1112">a lot of extra work. </span> <span class="line" data-startTime="1115">If you end up having to paint </span><span class="line" data-startTime="1115">each one of these things, </span><span class="line" data-startTime="1118">these all need re-rasterizing </span><span class="line" data-startTime="1118">and then they all need copying </span><span class="line" data-startTime="1122">over to the GPU. </span> <span class="line" data-startTime="1124">Eww should be what you feel. </span> <span class="line" data-startTime="1127">So this tool is amazing when </span><span class="line" data-startTime="1127">you want to figure out is </span><span class="line" data-startTime="1129">something getting repainted, </span><span class="line" data-startTime="1129">what's getting repainted, </span><span class="line" data-startTime="1131">switch on that tool, have </span><span class="line" data-startTime="1131">a look at what goes red. </span> <span class="line" data-startTime="1133">If you see a big red flash </span><span class="line" data-startTime="1133">across your whole screen, </span><span class="line" data-startTime="1136">you've probably got </span><span class="line" data-startTime="1136">a problem, OK? </span><span class="line" data-startTime="1138">So that's a good way </span><span class="line" data-startTime="1138">to find that out. </span></p>

<p><span class="line" data-startTime="1141">So painting, avoid it. </span> <span class="line" data-startTime="1144">You can't avoid it on the first </span><span class="line" data-startTime="1144">time your page loads, </span><span class="line" data-startTime="1146">but you want to try </span><span class="line" data-startTime="1146">after that. </span> <span class="line" data-startTime="1149">You can promote elements </span><span class="line" data-startTime="1149">to isolate them. </span> <span class="line" data-startTime="1152">If you have one element that </span><span class="line" data-startTime="1152">is moving around and maybe </span><span class="line" data-startTime="1156">does need repainting, promoting </span><span class="line" data-startTime="1156">it is actually often </span><span class="line" data-startTime="1159">a really good way to just make </span><span class="line" data-startTime="1159">sure that nothing else has to </span><span class="line" data-startTime="1161">be repainted unnecessarily. </span> <span class="line" data-startTime="1163">But bear in mind that it can </span><span class="line" data-startTime="1163">also spawn other layers like I </span><span class="line" data-startTime="1166">showed with the Next and </span><span class="line" data-startTime="1166">Previous buttons. </span> <span class="line" data-startTime="1168">You just want to be </span><span class="line" data-startTime="1168">careful with it. </span> <span class="line" data-startTime="1169">Layers themselves do actually </span><span class="line" data-startTime="1169">have a knock-on effect for </span><span class="line" data-startTime="1172">memory, the management, and the </span><span class="line" data-startTime="1172">transfers I've mentioned. </span> <span class="line" data-startTime="1175">So just be careful with that. </span></p>

<p><span class="line" data-startTime="1177">Often people say, well, how </span><span class="line" data-startTime="1177">many layers can I have? </span><span class="line" data-startTime="1179">And there isn't a good answer to </span><span class="line" data-startTime="1179">that because it depends on </span><span class="line" data-startTime="1182">the device that you're talking </span><span class="line" data-startTime="1182">about and whatever else you're </span><span class="line" data-startTime="1185">actually trying to do. </span> <span class="line" data-startTime="1185">So you just profile it and see </span><span class="line" data-startTime="1185">if you can see how your frames </span><span class="line" data-startTime="1190">per second is doing and respond </span><span class="line" data-startTime="1190">to that, really. </span> <span class="line" data-startTime="1193">Paint storms &mdash; we were debating </span><span class="line" data-startTime="1193">this term earlier, </span><span class="line" data-startTime="1196">what it really means. </span> <span class="line" data-startTime="1197">What it really comes down to </span><span class="line" data-startTime="1197">is you wouldn't want to be </span><span class="line" data-startTime="1199">caught in an actual storm, you </span><span class="line" data-startTime="1199">don't want to be caught in a </span><span class="line" data-startTime="1202">paint storm, either. </span> <span class="line" data-startTime="1203">It's generally you're </span><span class="line" data-startTime="1203">doing paint that you </span><span class="line" data-startTime="1205">shouldn't be doing. </span></p>

<p><span class="line" data-startTime="1206">You're either painting too much </span><span class="line" data-startTime="1206">or you're painting too </span><span class="line" data-startTime="1208">often, all those </span><span class="line" data-startTime="1208">kind of things. </span> <span class="line" data-startTime="1210">It's just a nice name for saying </span><span class="line" data-startTime="1210">it's not what you want. </span> <span class="line" data-startTime="1213">You're doing too much paint, </span><span class="line" data-startTime="1213">so don't do that. </span> <span class="line" data-startTime="1217">Interestingly, because the GPU </span><span class="line" data-startTime="1217">is exceptionally good at these </span><span class="line" data-startTime="1221">things particularly, they often </span><span class="line" data-startTime="1221">don't cause paints. </span> <span class="line" data-startTime="1224">If you isolate an element and </span><span class="line" data-startTime="1224">then monkey around with it's </span><span class="line" data-startTime="1228">opacity and transforms, </span><span class="line" data-startTime="1228">we won't be repainted. </span> <span class="line" data-startTime="1231">Like those boxes, they </span><span class="line" data-startTime="1231">didn't repaint. </span> <span class="line" data-startTime="1233">Happy days, we all smiled </span><span class="line" data-startTime="1233">a happy smile. </span> <span class="line" data-startTime="1236">Image decodes and re-sizes, </span><span class="line" data-startTime="1236">those are done on demand. </span></p>

<p><span class="line" data-startTime="1239">So when we're rasterizing we </span><span class="line" data-startTime="1239">hit one of those drawBitmap </span><span class="line" data-startTime="1242">calls, we actually queue up </span><span class="line" data-startTime="1242">the decodes and re-sizes. </span> <span class="line" data-startTime="1244">So it can make for very </span><span class="line" data-startTime="1244">sporadic frame </span><span class="line" data-startTime="1248">rates, let's call it. </span> <span class="line" data-startTime="1250">Because we do it on demand. </span> <span class="line" data-startTime="1252">So when something comes into </span><span class="line" data-startTime="1252">view that we need to </span><span class="line" data-startTime="1255">rasterize, we go and get the </span><span class="line" data-startTime="1255">image, we decode it, which </span><span class="line" data-startTime="1257">could kill us, and for all </span><span class="line" data-startTime="1257">intents and purposes that's </span><span class="line" data-startTime="1261">not a good thing. </span> <span class="line" data-startTime="1263">So bear in mind that handling </span><span class="line" data-startTime="1263">images is expensive. </span> <span class="line" data-startTime="1267">You can't really avoid images </span><span class="line" data-startTime="1267">on the web, but just bear in </span><span class="line" data-startTime="1271">mind that handling them is </span><span class="line" data-startTime="1271">expensive so you want to see </span><span class="line" data-startTime="1273">if you can mitigate it. </span></p>

<p><span class="line" data-startTime="1274">And one of the best ways to </span><span class="line" data-startTime="1274">do that is actually avoid </span><span class="line" data-startTime="1277">resizing them when you can. </span> <span class="line" data-startTime="1278">And I say that frustratedly </span><span class="line" data-startTime="1278">because responsive web design </span><span class="line" data-startTime="1283">is, a, popular and </span><span class="line" data-startTime="1283">b, quite cool. </span> <span class="line" data-startTime="1287">But it does put a really heavy </span><span class="line" data-startTime="1287">tax on the browser. </span> <span class="line" data-startTime="1292">So if you're going to do it, </span><span class="line" data-startTime="1292">just know that there's a tax </span><span class="line" data-startTime="1296">and be happy to pay the tax. </span> <span class="line" data-startTime="1299">There you go. </span> <span class="line" data-startTime="1300">Now requesting an animation </span><span class="line" data-startTime="1300">frame, if you've </span><span class="line" data-startTime="1303">not come across it. </span> <span class="line" data-startTime="1305">When you are changing things on </span><span class="line" data-startTime="1305">screen, please avoid these. </span> <span class="line" data-startTime="1310">They are not timed to the </span><span class="line" data-startTime="1310">browser's refresh cycle. </span> <span class="line" data-startTime="1316">So they will just run whatever </span><span class="line" data-startTime="1316">suits, and that could be at </span><span class="line" data-startTime="1318">the worst possible time </span><span class="line" data-startTime="1318">for the browser. </span></p>

<p><span class="line" data-startTime="1322">What you want to do is </span><span class="line" data-startTime="1322">use friendly green </span><span class="line" data-startTime="1324">requestAnimationFrame. </span> <span class="line" data-startTime="1326">It is so helpful. </span> <span class="line" data-startTime="1329">Anybody use jQuery? </span><span class="line" data-startTime="1332">Yeah? </span><span class="line" data-startTime="1332">Anybody use jQuery animate? </span><span class="line" data-startTime="1334">Yeah? </span><span class="line" data-startTime="1335">OK. </span> <span class="line" data-startTime="1336">It currently uses </span><span class="line" data-startTime="1336">set interval. </span> <span class="line" data-startTime="1337">I would love that to change, </span><span class="line" data-startTime="1337">in fact I actually double </span><span class="line" data-startTime="1340">checked that from the </span><span class="line" data-startTime="1340">jQuery source. </span> <span class="line" data-startTime="1342">It does use set interval. </span> <span class="line" data-startTime="1345">There are patches that you can </span><span class="line" data-startTime="1345">apply, then switch it back to </span><span class="line" data-startTime="1348">requestAnimationFrame. </span> <span class="line" data-startTime="1350">Simple enough thing to do and it </span><span class="line" data-startTime="1350">might be worth it for your </span><span class="line" data-startTime="1353">project if you are using </span><span class="line" data-startTime="1353">jQuery animate </span><span class="line" data-startTime="1357">as it stands today. </span></p>

<p><span class="line" data-startTime="1360">Scrolling performance is a </span><span class="line" data-startTime="1360">big, big deal actually, </span><span class="line" data-startTime="1362">because most of the time people </span><span class="line" data-startTime="1362">scroll on the web. </span> <span class="line" data-startTime="1365">Apparently it happens </span><span class="line" data-startTime="1365">quite a lot. </span> <span class="line" data-startTime="1369">Scrolling then, it does cause </span><span class="line" data-startTime="1369">paints because as content </span><span class="line" data-startTime="1373">becomes visible we have to </span><span class="line" data-startTime="1373">rasterize, we have to paint </span><span class="line" data-startTime="1377">that stuff. </span> <span class="line" data-startTime="1379">So we want to make sure </span><span class="line" data-startTime="1379">that when we do it </span><span class="line" data-startTime="1380">we keep things light. </span> <span class="line" data-startTime="1386">The easiest thing to do with </span><span class="line" data-startTime="1386">scrolling is to avoid doing </span><span class="line" data-startTime="1390">anything in scrolling. </span> <span class="line" data-startTime="1393">There's a really good one </span><span class="line" data-startTime="1393">actually that you might want </span><span class="line" data-startTime="1395">to look at, which is &mdash; </span><span class="line" data-startTime="1399">it doesn't take too much </span><span class="line" data-startTime="1399">imagination &mdash; if you're </span><span class="line" data-startTime="1400">scrolling through and you </span><span class="line" data-startTime="1400">trigger a hover on an element </span><span class="line" data-startTime="1404">as you're scrolling, then we </span><span class="line" data-startTime="1404">have to repaint the thing that </span><span class="line" data-startTime="1407">you hovered. </span> <span class="line" data-startTime="1408">Then you keep scrolling, and you </span><span class="line" data-startTime="1408">hover out and we have to </span><span class="line" data-startTime="1410">repaint the thing that you now </span><span class="line" data-startTime="1410">hovered out, just because you </span><span class="line" data-startTime="1412">were scrolling past it. </span></p>

<p><span class="line" data-startTime="1414">OK, now if your hover effects </span><span class="line" data-startTime="1414">are really expensive, that's </span><span class="line" data-startTime="1418">going to be awful. </span> <span class="line" data-startTime="1419">What you want to do is you want </span><span class="line" data-startTime="1419">to basically switch off </span><span class="line" data-startTime="1424">anything changing. </span> <span class="line" data-startTime="1425">So you basically add a class </span><span class="line" data-startTime="1425">or something that basically </span><span class="line" data-startTime="1428">switches off hover effects </span><span class="line" data-startTime="1428">while you're scrolling. </span> <span class="line" data-startTime="1432">Wait a little bit of time then </span><span class="line" data-startTime="1432">switch them back on again. </span> <span class="line" data-startTime="1433">Happy days. </span> <span class="line" data-startTime="1434">There's a HTML5 Rocks article </span><span class="line" data-startTime="1434">about that, that I wrote. </span> <span class="line" data-startTime="1438">Pretty good. </span> <span class="line" data-startTime="1440">I mean the idea is good, </span><span class="line" data-startTime="1440">it wasn't my idea, I </span><span class="line" data-startTime="1443">just wrote it up. </span></p>

<p><span class="line" data-startTime="1443">Anyway, debounce scroll </span><span class="line" data-startTime="1443">handlers. </span> <span class="line" data-startTime="1447">What do you possibly </span><span class="line" data-startTime="1447">mean, Paul? </span><span class="line" data-startTime="1449">I mean this. </span> <span class="line" data-startTime="1451">If you add a scroll listener to </span><span class="line" data-startTime="1451">your window, in this case, </span><span class="line" data-startTime="1458">don't do anything inside </span><span class="line" data-startTime="1458">that scroll handler. </span> <span class="line" data-startTime="1460">Please, for the love of all that </span><span class="line" data-startTime="1460">is decent, don't do it. </span> <span class="line" data-startTime="1464">What you do, store the value if </span><span class="line" data-startTime="1464">you need to, great, super, </span><span class="line" data-startTime="1467">and then schedule a </span><span class="line" data-startTime="1467">requestAnimationFrame to </span><span class="line" data-startTime="1470">handle the scroll &mdash; </span><span class="line" data-startTime="1471">the thing that happened. </span> <span class="line" data-startTime="1472">Because you can get 5, 10, 20 </span><span class="line" data-startTime="1472">of these events, but really </span><span class="line" data-startTime="1476">you probably only want one. </span> <span class="line" data-startTime="1477">You want the last one most </span><span class="line" data-startTime="1477">likely to know the current </span><span class="line" data-startTime="1480">scroll position because you're </span><span class="line" data-startTime="1480">doing the parallax site. </span> <span class="line" data-startTime="1489">Just because it's cool doesn't </span><span class="line" data-startTime="1489">mean it's right. </span></p>

<p><span class="line" data-startTime="1494">Just throw that out there </span><span class="line" data-startTime="1494">if anybody's listening. </span> <span class="line" data-startTime="1498">OK, the last thing I want to do, </span><span class="line" data-startTime="1498">because we're running low </span><span class="line" data-startTime="1501">on time, is to just do a little </span><span class="line" data-startTime="1501">bit of myth busting. </span> <span class="line" data-startTime="1504">JavaScript &mdash; </span><span class="line" data-startTime="1505">and you'll notice I haven't </span><span class="line" data-startTime="1505">talked about it at all. </span> <span class="line" data-startTime="1507">You maybe thought </span><span class="line" data-startTime="1507">I would, right? </span><span class="line" data-startTime="1509">Because when we're not talking </span><span class="line" data-startTime="1509">about page load time we're </span><span class="line" data-startTime="1511">talking about JavaScript and how </span><span class="line" data-startTime="1511">slow it is, and horrible. </span> <span class="line" data-startTime="1516">But it's not, actually. </span> <span class="line" data-startTime="1517">Work is often triggered </span><span class="line" data-startTime="1517">by your JavaScript. </span> <span class="line" data-startTime="1519">You maybe change a class with </span><span class="line" data-startTime="1519">dot classname or classlist or </span><span class="line" data-startTime="1523">something, or whatever. </span> <span class="line" data-startTime="1524">It's often triggered by </span><span class="line" data-startTime="1524">JavaScript but the work that's </span><span class="line" data-startTime="1527">actually running is often </span><span class="line" data-startTime="1527">carried out in C++. </span> <span class="line" data-startTime="1529">Layout is not done </span><span class="line" data-startTime="1529">in JavaScript. </span> <span class="line" data-startTime="1532">Layout is done in C++, </span><span class="line" data-startTime="1532">it's done lower down. </span></p>

<p><span class="line" data-startTime="1535">So bear that in mind. </span> <span class="line" data-startTime="1537">And slow JavaScript is this </span><span class="line" data-startTime="1537">kind of idea that, oh </span><span class="line" data-startTime="1540">JavaScript is slow and that's </span><span class="line" data-startTime="1540">why the mobile web is slow. </span> <span class="line" data-startTime="1543">No, it's not actually the </span><span class="line" data-startTime="1543">reason most of the time. </span> <span class="line" data-startTime="1547">Because it's not JavaScript </span><span class="line" data-startTime="1547">that's actually running. </span> <span class="line" data-startTime="1548">It's the other stuff that's </span><span class="line" data-startTime="1548">inside the browser that's </span><span class="line" data-startTime="1550">actually running. </span> <span class="line" data-startTime="1551">Unless you're making </span><span class="line" data-startTime="1551">a game, or &mdash; </span><span class="line" data-startTime="1553">there are classes of </span><span class="line" data-startTime="1553">applications that do rely on </span><span class="line" data-startTime="1555">JavaScript quite heavily. </span> <span class="line" data-startTime="1558">I do want to say that I'd like </span><span class="line" data-startTime="1558">you to start treating </span><span class="line" data-startTime="1560">JavaScript benchmarks with deep, </span><span class="line" data-startTime="1560">unyielding cynicism. </span></p>

<p><span class="line" data-startTime="1566">Because JavaScript probably </span><span class="line" data-startTime="1566">isn't your bottleneck. </span> <span class="line" data-startTime="1570">Layout probably is </span><span class="line" data-startTime="1570">your bottleneck. </span> <span class="line" data-startTime="1571">Paint is probably </span><span class="line" data-startTime="1571">your bottleneck. </span> <span class="line" data-startTime="1574">So if you start seeing it's </span><span class="line" data-startTime="1574">really fast with JavaScript &mdash; </span><span class="line" data-startTime="1579">yay, so. </span> <span class="line" data-startTime="1582">And then the other thing </span><span class="line" data-startTime="1582">is the DOM is slow. </span> <span class="line" data-startTime="1584">You hear this one quite a lot </span><span class="line" data-startTime="1584">for fairly similar reasons to </span><span class="line" data-startTime="1587">the last, actually. </span> <span class="line" data-startTime="1588">Interacting with the </span><span class="line" data-startTime="1588">DOM is actually </span><span class="line" data-startTime="1590">quite fast, as it happens. </span> <span class="line" data-startTime="1593">The problem is that changes to </span><span class="line" data-startTime="1593">the DOM probably incur changes </span><span class="line" data-startTime="1596">that are layout, or recalc </span><span class="line" data-startTime="1596">style, layout, paint, </span><span class="line" data-startTime="1600">composite, misery. </span> <span class="line" data-startTime="1602">So be careful. </span> <span class="line" data-startTime="1604">Now, going forth, aim for </span><span class="line" data-startTime="1604">60 frames a second. </span> <span class="line" data-startTime="1608">It is well and truly </span><span class="line" data-startTime="1608">achievable. </span> <span class="line" data-startTime="1610">You control the browser's </span><span class="line" data-startTime="1610">workload. </span> <span class="line" data-startTime="1612">You are in fact the </span><span class="line" data-startTime="1612">ship's captain. </span> <span class="line" data-startTime="1614">I brought it in. </span></p>

<p><span class="line" data-startTime="1617">Performance is a feature, </span><span class="line" data-startTime="1617">it is not a unit test. </span> <span class="line" data-startTime="1620">It's not something you get to </span><span class="line" data-startTime="1620">the end of the project &mdash; </span><span class="line" data-startTime="1622">am I fast? </span><span class="line" data-startTime="1623">No &mdash; </span><span class="line" data-startTime="1626">ship anyway. </span> <span class="line" data-startTime="1627">Nobody'll notice. </span> <span class="line" data-startTime="1628">Wait until they complain, </span><span class="line" data-startTime="1628">that's what we'll do. </span> <span class="line" data-startTime="1631">No, think of it, put </span><span class="line" data-startTime="1631">it on the list. </span> <span class="line" data-startTime="1635">It might be two, three, </span><span class="line" data-startTime="1635">four, but make </span><span class="line" data-startTime="1636">sure it's on the list. </span> <span class="line" data-startTime="1637">Ideally put it number one. </span> <span class="line" data-startTime="1639">I do, oh I love that. </span> <span class="line" data-startTime="1642">Profile, and then fix. </span> <span class="line" data-startTime="1644">A lot of times you'll read </span><span class="line" data-startTime="1644">things that are like, this is </span><span class="line" data-startTime="1646">fast, do this. </span> <span class="line" data-startTime="1648">And that's fine. </span> <span class="line" data-startTime="1649">Sometimes you need to do that. </span> <span class="line" data-startTime="1650">But you end up writing things </span><span class="line" data-startTime="1650">that don't fix the problem </span><span class="line" data-startTime="1654">you've got. </span></p>

<p><span class="line" data-startTime="1654">You end up writing something </span><span class="line" data-startTime="1654">that makes paint better, but </span><span class="line" data-startTime="1657">you've got a layout problem. </span> <span class="line" data-startTime="1659">Profile, use DevTools, Paul </span><span class="line" data-startTime="1659">will show you how. </span> <span class="line" data-startTime="1662">Profile your stuff, figure out </span><span class="line" data-startTime="1662">where you're actually slow, </span><span class="line" data-startTime="1664">then fix that thing. </span> <span class="line" data-startTime="1666">Sounds simple enough, </span><span class="line" data-startTime="1666">because it is. </span> <span class="line" data-startTime="1667">Profile early, profile often. </span> <span class="line" data-startTime="1670">Smile a happy smile. </span> <span class="line" data-startTime="1671">Do it. </span> <span class="line" data-startTime="1672">Thanks. </span> <span class="line" data-startTime="1674">[APPLAUSE] </span></p>