<p class="speaker"><span class="line" data-starttime="9"><span class="speakerName">Male Speaker</span>: So yeah, </span><span class="line" data-startTime="9">this is going to be a quiz. </span> <span class="line" data-startTime="12">So if you're not on the Wi-Fi, </span><span class="line" data-startTime="12">get yourself on the Wi-Fi now. </span> <span class="line" data-startTime="16">The username and </span><span class="line" data-startTime="16">password is on there. </span> <span class="line" data-startTime="18">And then once you've done that, </span><span class="line" data-startTime="18">if you want to go to this URL </span><span class="line" data-startTime="20">and make up your own </span><span class="line" data-startTime="20">username and password. </span> <span class="line" data-startTime="24">Obviously not the same username </span><span class="line" data-startTime="24">and password, or a bunch of you </span><span class="line" data-startTime="27">will be on the same account. </span> <span class="line" data-startTime="29">You won't be able </span><span class="line" data-startTime="29">to get to that URL </span><span class="line" data-startTime="30">if you're not on that Wi-Fi </span><span class="line" data-startTime="30">network, so make sure you are. </span></p>

<p><span class="line" data-startTime="34">And if you're watching this on </span><span class="line" data-startTime="34">the live stream, tough luck, </span><span class="line" data-startTime="36">I'm afraid. </span> <span class="line" data-startTime="37">You've just got to play </span><span class="line" data-startTime="37">along using your brain. </span> <span class="line" data-startTime="39">And you can write </span><span class="line" data-startTime="39">things down on paper </span><span class="line" data-startTime="41">and score yourself if you want. </span> <span class="line" data-startTime="44">The reason I'm asking you </span><span class="line" data-startTime="44">for a username and password </span><span class="line" data-startTime="46">is just so you can switch </span><span class="line" data-startTime="46">devices halfway through in case </span><span class="line" data-startTime="49">your phone starts </span><span class="line" data-startTime="49">running out of battery, </span><span class="line" data-startTime="51">and you want to </span><span class="line" data-startTime="51">switch to your laptop. </span> <span class="line" data-startTime="53">Just use the same </span><span class="line" data-startTime="53">username and password, </span><span class="line" data-startTime="54">and everything will work. </span></p>

<p><span class="line" data-startTime="56">The password is stored in </span><span class="line" data-startTime="56">plain text on my machine. </span> <span class="line" data-startTime="58">So don't use your credit </span><span class="line" data-startTime="58">card number or anything </span><span class="line" data-startTime="61">like that unless you're </span><span class="line" data-startTime="61">intending to make a donation, </span><span class="line" data-startTime="64">and that will be gratefully </span><span class="line" data-startTime="64">received, thank you very much. </span> <span class="line" data-startTime="67">I'm going to assume </span><span class="line" data-startTime="67">everyone's ready to go. </span> <span class="line" data-startTime="69">I will keep the URL in </span><span class="line" data-startTime="69">the corner of the screen, </span><span class="line" data-startTime="71">so if anyone loses it, you'll </span><span class="line" data-startTime="71">be able to pick it back up. </span> <span class="line" data-startTime="77">I hacked this </span><span class="line" data-startTime="77">together on a plane. </span> <span class="line" data-startTime="79">You could probably break </span><span class="line" data-startTime="79">it by trying to break it, </span><span class="line" data-startTime="82">so please don't </span><span class="line" data-startTime="82">try and break it. </span> <span class="line" data-startTime="84">I've made it so little </span><span class="line" data-startTime="84">Bobby Tables can play. </span> <span class="line" data-startTime="86">That's not going to break it. </span> <span class="line" data-startTime="88">But there are </span><span class="line" data-startTime="88">probably other things. </span></p>

<p><span class="line" data-startTime="89">You could probably doss it, </span><span class="line" data-startTime="89">so please don't do that. </span> <span class="line" data-startTime="92">And I want to stress that </span><span class="line" data-startTime="92">this quiz is pretty tough. </span> <span class="line" data-startTime="95">I've seen it get </span><span class="line" data-startTime="95">the better of people </span><span class="line" data-startTime="96">who do this kind of study of </span><span class="line" data-startTime="96">browser quirks for a living. </span> <span class="line" data-startTime="100">So if you're the kind of </span><span class="line" data-startTime="100">person who gets really angry </span><span class="line" data-startTime="103">and starts flipping over </span><span class="line" data-startTime="103">tables when you don't win, </span><span class="line" data-startTime="105">then just maybe stay away from </span><span class="line" data-startTime="105">the tables for a little while, </span><span class="line" data-startTime="109">OK? </span><span class="line" data-startTime="110">Of course, what </span><span class="line" data-startTime="110">kind of a quiz would </span><span class="line" data-startTime="112">be complete without a prize? </span><span class="line" data-startTime="115">The Chromebook Pixel is </span><span class="line" data-startTime="115">Google's latest laptop </span><span class="line" data-startTime="118">featuring an I5 1.8 gigahertz </span><span class="line" data-startTime="118">dual core processor, </span><span class="line" data-startTime="122">four gigabytes of RAM, and </span><span class="line" data-startTime="122">a touch screen with a higher </span><span class="line" data-startTime="124">DPI than a MacBook Pro. </span> <span class="line" data-startTime="126">Couldn't get hold </span><span class="line" data-startTime="126">of one of those. </span> <span class="line" data-startTime="128">Sorry. </span> <span class="line" data-startTime="128">They wouldn't let me. </span></p>

<p><span class="line" data-startTime="130">But what I did get </span><span class="line" data-startTime="130">is a Chromecast </span><span class="line" data-startTime="133">so I've got one of </span><span class="line" data-startTime="133">those to give away </span><span class="line" data-startTime="134">for whoever gets </span><span class="line" data-startTime="134">the highest score. </span> <span class="line" data-startTime="136">So it's not quite a Pixel, </span><span class="line" data-startTime="136">but it's very, very good. </span> <span class="line" data-startTime="139">So let's start. </span> <span class="line" data-startTime="140">Let's start off really simple. </span> <span class="line" data-startTime="142">And so the URL's there on </span><span class="line" data-startTime="142">the bottom of the screen </span><span class="line" data-startTime="144">if you need it again. </span> <span class="line" data-startTime="145">But here's a nice, easy start. </span> <span class="line" data-startTime="147">You've all worked with </span><span class="line" data-startTime="147">images in HTML, right? </span><span class="line" data-startTime="149">OK, so here's a div, but it has </span><span class="line" data-startTime="149">a source like an image might. </span> <span class="line" data-startTime="154">Which browsers do </span><span class="line" data-startTime="154">you think are going </span><span class="line" data-startTime="155">to make a request </span><span class="line" data-startTime="155">for that image? </span><span class="line" data-startTime="157">Now, on your phones </span><span class="line" data-startTime="157">or on your laptops, </span><span class="line" data-startTime="159">you should be presented </span><span class="line" data-startTime="159">with the options. </span> <span class="line" data-startTime="161">So you pick which ones you think </span><span class="line" data-startTime="161">are going to make a request, </span><span class="line" data-startTime="163">and then hit "submit." </span><span class="line" data-startTime="164">If it's not appearing </span><span class="line" data-startTime="164">on the screen, </span><span class="line" data-startTime="166">or the icons aren't, you can </span><span class="line" data-startTime="166">just give the page a refresh, </span><span class="line" data-startTime="168">and that should come through. </span></p>

<p><span class="line" data-startTime="169">When we're talking </span><span class="line" data-startTime="169">about these browsers, </span><span class="line" data-startTime="171">I mean the latest versions of </span><span class="line" data-startTime="171">each one, so IE 10, et cetera. </span> <span class="line" data-startTime="175">You get one point if you get it </span><span class="line" data-startTime="175">right for a particular browser. </span> <span class="line" data-startTime="178">You lose a point if you get it </span><span class="line" data-startTime="178">wrong for a particular browser. </span> <span class="line" data-startTime="181">So there's a maximum of </span><span class="line" data-startTime="181">four points per question </span><span class="line" data-startTime="183">and a minimum of minus 4. </span> <span class="line" data-startTime="184">You can score negatively. </span> <span class="line" data-startTime="187">You can assume the </span><span class="line" data-startTime="187">HTML5 doc type, </span><span class="line" data-startTime="189">and there's nothing </span><span class="line" data-startTime="189">hidden going on. </span> <span class="line" data-startTime="191">I'm not going to </span><span class="line" data-startTime="191">turn round and say, </span><span class="line" data-startTime="193">oh but there's a base </span><span class="line" data-startTime="193">element that's changing URLs. </span> <span class="line" data-startTime="195">There'll be none of that. </span></p>

<p><span class="line" data-startTime="196">It's just what's there on </span><span class="line" data-startTime="196">the screen, that one line. </span> <span class="line" data-startTime="199">What we're seeing here is a live </span><span class="line" data-startTime="199">opinion of the room as well. </span> <span class="line" data-startTime="202">So the needle swings one way </span><span class="line" data-startTime="202">when you're saying collectively </span><span class="line" data-startTime="205">that yes, the browser </span><span class="line" data-startTime="205">will make a request. </span> <span class="line" data-startTime="207">It'll swing the other </span><span class="line" data-startTime="207">way if you're saying no. </span> <span class="line" data-startTime="209">But I'm going to </span><span class="line" data-startTime="209">randomize which way </span><span class="line" data-startTime="210">is yes and no for each </span><span class="line" data-startTime="210">question, so you can't just </span><span class="line" data-startTime="213">look at the screen and </span><span class="line" data-startTime="213">vote along with the room. </span> <span class="line" data-startTime="215">OK, that's probably enough time. </span> <span class="line" data-startTime="217">I'm going to close the </span><span class="line" data-startTime="217">question in three, two, one. </span></p>

<p><span class="line" data-startTime="221">OK, we can see from </span><span class="line" data-startTime="221">this that you're </span><span class="line" data-startTime="223">saying Chrome is going </span><span class="line" data-startTime="223">to make a request here. </span> <span class="line" data-startTime="226">You're less sure about </span><span class="line" data-startTime="226">the other browsers. </span> <span class="line" data-startTime="228">And the answer is no. </span> <span class="line" data-startTime="231">None of the browsers is going </span><span class="line" data-startTime="231">to make a request in this. </span> <span class="line" data-startTime="233">But it's not actually </span><span class="line" data-startTime="233">as mad as it seems. </span> <span class="line" data-startTime="236">This doesn't work in HTML5, </span><span class="line" data-startTime="236">but it was proposed in XHTML2. </span> <span class="line" data-startTime="243">XHTML2 allows you to do </span><span class="line" data-startTime="243">this: put a source attribute </span><span class="line" data-startTime="246">on anything, and it </span><span class="line" data-startTime="246">would replace the content </span><span class="line" data-startTime="248">with what you had in the source. </span> <span class="line" data-startTime="249">And this is really </span><span class="line" data-startTime="249">good, because it </span><span class="line" data-startTime="251">meant that the old attribute </span><span class="line" data-startTime="251">on the images became redundant, </span><span class="line" data-startTime="254">because you could replace </span><span class="line" data-startTime="254">real semantic content. </span> <span class="line" data-startTime="257">Pretty cool idea, but XHTML2 </span><span class="line" data-startTime="257">was backwards incompatible, </span><span class="line" data-startTime="260">and it carried with it XML's </span><span class="line" data-startTime="260">draconian error handling. </span> <span class="line" data-startTime="263">And once you invite XML into </span><span class="line" data-startTime="263">your home, it XML's everything. </span></p>

<p><span class="line" data-startTime="267">XMLs all over the </span><span class="line" data-startTime="267">floor, up the walls. </span> <span class="line" data-startTime="269">And in the same way that Smurfs </span><span class="line" data-startTime="269">stick the word "Smurf" in front </span><span class="line" data-startTime="272">of everything to make </span><span class="line" data-startTime="272">it a Smurf thing, </span><span class="line" data-startTime="274">XML does it with X. You don't </span><span class="line" data-startTime="274">want HTML, you want XHTML. </span> <span class="line" data-startTime="279">You don't want frames, </span><span class="line" data-startTime="279">you want Xframes. </span> <span class="line" data-startTime="282">You don't want forms, </span><span class="line" data-startTime="282">you want Xforms. </span> <span class="line" data-startTime="287">If you let XML take </span><span class="line" data-startTime="287">over your life, </span><span class="line" data-startTime="288">it will turn your </span><span class="line" data-startTime="288">boyfriend or girlfriend </span><span class="line" data-startTime="290">into an ex-boyfriend </span><span class="line" data-startTime="290">or girlfriend. </span> <span class="line" data-startTime="294">And XML's cool with </span><span class="line" data-startTime="294">that, because you </span><span class="line" data-startTime="296">don't need a partner any more. </span> <span class="line" data-startTime="297">You've got XML to </span><span class="line" data-startTime="297">look after you. </span> <span class="line" data-startTime="299">It seems fitting </span><span class="line" data-startTime="299">that in 2009, XHTML </span><span class="line" data-startTime="301">became an ex-specification, and </span><span class="line" data-startTime="301">it was completely abandoned. </span> <span class="line" data-startTime="304">And no browsers ever implemented </span><span class="line" data-startTime="304">that source attributes </span><span class="line" data-startTime="307">on elements other than </span><span class="line" data-startTime="307">images and the things </span><span class="line" data-startTime="309">they work on now. </span> <span class="line" data-startTime="310">OK, but what about this? </span><span class="line" data-startTime="312">Here we've got an image element. </span></p>

<p><span class="line" data-startTime="314">It's got a source. </span> <span class="line" data-startTime="314">It's in the page, but I've </span><span class="line" data-startTime="314">spelled "image ' incorrectly. </span> <span class="line" data-startTime="318">I've put it I-M-A-G-E </span><span class="line" data-startTime="318">rather than I-M-G. </span> <span class="line" data-startTime="321">Does the browser treat </span><span class="line" data-startTime="321">it as an unknown element, </span><span class="line" data-startTime="324">or does it make the request? </span><span class="line" data-startTime="325">The browser only has </span><span class="line" data-startTime="325">to make the request. </span> <span class="line" data-startTime="327">It doesn't have to </span><span class="line" data-startTime="327">display it on the page, </span><span class="line" data-startTime="329">in case you think that matters. </span> <span class="line" data-startTime="330">XML was too strict </span><span class="line" data-startTime="330">to work with the web, </span><span class="line" data-startTime="332">but is HTML best lenient? </span><span class="line" data-startTime="334">Or are the browsers more </span><span class="line" data-startTime="334">lenient than the spec? </span><span class="line" data-startTime="336">Just get your </span><span class="line" data-startTime="336">answers in quickly. </span></p>

<p><span class="line" data-startTime="337">I'm going to close the </span><span class="line" data-startTime="337">question in three, two, one, </span><span class="line" data-startTime="342">and it's closed. </span> <span class="line" data-startTime="343">So we're edging towards </span><span class="line" data-startTime="343">no in all of the browsers. </span> <span class="line" data-startTime="348">All the browsers will make </span><span class="line" data-startTime="348">a request for this image, </span><span class="line" data-startTime="350">and they will display it. </span> <span class="line" data-startTime="353">Because in the past, a browser </span><span class="line" data-startTime="353">decided that I-M-G is quite </span><span class="line" data-startTime="357">difficult for </span><span class="line" data-startTime="357">developers to remember, </span><span class="line" data-startTime="359">so they should support </span><span class="line" data-startTime="359">I-M-A-G-E as well. </span> <span class="line" data-startTime="362">And we've been stuck </span><span class="line" data-startTime="362">with it ever since. </span> <span class="line" data-startTime="364">Which browser </span><span class="line" data-startTime="364">engine do you think </span><span class="line" data-startTime="366">we've got to thank for this? </span><span class="line" data-startTime="367">Yep, you've guessed it. </span> <span class="line" data-startTime="368">It is Mosaic back in 1993. </span></p>

<p><span class="line" data-startTime="373">The people who </span><span class="line" data-startTime="373">invented the image tag, </span><span class="line" data-startTime="375">they put this alias in. </span> <span class="line" data-startTime="376">And a study in 2005 showed </span><span class="line" data-startTime="376">that 0.2 percent of pages </span><span class="line" data-startTime="379">were using this </span><span class="line" data-startTime="379">misspelled image tag. </span> <span class="line" data-startTime="382">So any browser that </span><span class="line" data-startTime="382">wants to work on the web </span><span class="line" data-startTime="384">that we have today has </span><span class="line" data-startTime="384">to duplicate this alias. </span> <span class="line" data-startTime="387">The WHATWG recognized this, </span><span class="line" data-startTime="387">and they added it to the spec. </span> <span class="line" data-startTime="389">This is the parsing spec. </span> <span class="line" data-startTime="391">Start tag, name image, </span><span class="line" data-startTime="391">change the token to IMG, </span><span class="line" data-startTime="394">and reprocess it. </span></p>

<p><span class="line" data-startTime="395">Don't ask, which is great. </span> <span class="line" data-startTime="397">But this was actually used </span><span class="line" data-startTime="397">in a clever hack recently. </span> <span class="line" data-startTime="399">Alexei10 came up with </span><span class="line" data-startTime="399">this, which I really liked. </span> <span class="line" data-startTime="402">You would use this in place </span><span class="line" data-startTime="402">of your image elements. </span> <span class="line" data-startTime="404">What it does is it loads an SVG, </span><span class="line" data-startTime="404">for browsers that support SVG, </span><span class="line" data-startTime="408">and it loads a PNG for </span><span class="line" data-startTime="408">browsers that don't. </span> <span class="line" data-startTime="411">So the way a modern browser </span><span class="line" data-startTime="411">would parse it is it sees SVG, </span><span class="line" data-startTime="413">and it goes OK, it's got a </span><span class="line" data-startTime="413">width and height of 100%, </span><span class="line" data-startTime="416">so about 100 pixels. </span> <span class="line" data-startTime="418">And it sees this, </span><span class="line" data-startTime="418">and this is a &mdash; it </span><span class="line" data-startTime="420">sees this as an SVG image </span><span class="line" data-startTime="420">element. 'Cause in SVG, images </span><span class="line" data-startTime="423">are spelled out full, </span><span class="line" data-startTime="423">rather than IMG. </span> <span class="line" data-startTime="425">It's got a width and a height, </span><span class="line" data-startTime="425">and I'm going to load this. </span> <span class="line" data-startTime="428">Because this is how you define </span><span class="line" data-startTime="428">the source of an image in SVG. </span></p>

<p><span class="line" data-startTime="431">Because why have links </span><span class="line" data-startTime="431">when you could have Xlinks? </span><span class="line" data-startTime="436">And then it sees this, and </span><span class="line" data-startTime="436">that doesn't mean anything </span><span class="line" data-startTime="438">to SVG images, so it's ignored. </span> <span class="line" data-startTime="440">So we're now showing </span><span class="line" data-startTime="440">the SVG image. </span> <span class="line" data-startTime="442">An older browser such as </span><span class="line" data-startTime="442">Android 2 or IE8 and below, </span><span class="line" data-startTime="446">they will parse it like </span><span class="line" data-startTime="446">this: No idea what that is. </span> <span class="line" data-startTime="449">I'm going to ignore it. </span> <span class="line" data-startTime="450">I'm going to treat it </span><span class="line" data-startTime="450">like an unknown element. </span> <span class="line" data-startTime="452">Oh look, the developer has </span><span class="line" data-startTime="452">spelled "image " wrong. </span> <span class="line" data-startTime="454">It's OK. </span> <span class="line" data-startTime="454">I'm going to </span><span class="line" data-startTime="454">correct it for them. </span></p>

<p><span class="line" data-startTime="456">It's 100 by 100. </span> <span class="line" data-startTime="458">No idea what that means, </span><span class="line" data-startTime="458">so I'll ignore that. </span> <span class="line" data-startTime="461">And then oh, there's </span><span class="line" data-startTime="461">the source of the image. </span> <span class="line" data-startTime="463">I've got to download the PNG. </span> <span class="line" data-startTime="464">So it's kind of nice, because </span><span class="line" data-startTime="464">it doesn't require JavaScript, </span><span class="line" data-startTime="467">and it's a nice way </span><span class="line" data-startTime="467">to conditionally load </span><span class="line" data-startTime="469">the kind of file that </span><span class="line" data-startTime="469">the browser supports. </span> <span class="line" data-startTime="471">We got quite excited about it, </span><span class="line" data-startTime="471">and we were tweeting about it. </span> <span class="line" data-startTime="474">The mistake we made </span><span class="line" data-startTime="474">is we did not test it. </span> <span class="line" data-startTime="476">So a few of us did just </span><span class="line" data-startTime="476">that, and we found out </span><span class="line" data-startTime="478">something interesting. </span> <span class="line" data-startTime="480">All of these </span><span class="line" data-startTime="480">browsers support SVG, </span><span class="line" data-startTime="483">but which browsers will </span><span class="line" data-startTime="483">download the PNG as well? </span><span class="line" data-startTime="486">And I'll give you a clue. </span> <span class="line" data-startTime="487">It's not all of them. </span> <span class="line" data-startTime="488">Not all of them get it wrong. </span></p>

<p><span class="line" data-startTime="489">It's just one or </span><span class="line" data-startTime="489">some of the browsers </span><span class="line" data-startTime="491">are going to get this </span><span class="line" data-startTime="491">wrong, and they end up </span><span class="line" data-startTime="494">downloading both </span><span class="line" data-startTime="494">the PNG and the SVG. </span> <span class="line" data-startTime="497">I'm going to close the </span><span class="line" data-startTime="497">question in three, two, one. </span> <span class="line" data-startTime="503">OK, we're saying no in all </span><span class="line" data-startTime="503">the browsers and yes in IE. </span> <span class="line" data-startTime="506">It's almost like </span><span class="line" data-startTime="506">you've been burned </span><span class="line" data-startTime="508">by that browser in the past. </span> <span class="line" data-startTime="510">Well, the answer </span><span class="line" data-startTime="510">is you are right. </span> <span class="line" data-startTime="513">Internet Explorer will make a </span><span class="line" data-startTime="513">request for two images here. </span> <span class="line" data-startTime="515">It's because all </span><span class="line" data-startTime="515">modern browsers, </span><span class="line" data-startTime="517">they've got two parsers </span><span class="line" data-startTime="517">built into them. </span> <span class="line" data-startTime="518">It's a relatively new </span><span class="line" data-startTime="518">thing for them to have, </span><span class="line" data-startTime="520">but they all have it. </span> <span class="line" data-startTime="522">One parser runs ahead, and it </span><span class="line" data-startTime="522">goes, and it tries and finds </span><span class="line" data-startTime="525">things like it should download, </span><span class="line" data-startTime="525">like scripts and images </span><span class="line" data-startTime="527">or whatever. </span> <span class="line" data-startTime="527">And the other parser comes along </span><span class="line" data-startTime="527">and does the heavy lifting, </span><span class="line" data-startTime="530">like building the DOM tree, </span><span class="line" data-startTime="530">parsing scripts, et cetera. </span></p>

<p><span class="line" data-startTime="534">And this has a </span><span class="line" data-startTime="534">really large benefit. </span> <span class="line" data-startTime="535">A study we did at Google, </span><span class="line" data-startTime="535">we looked at 2,000 sites, </span><span class="line" data-startTime="538">and then we added </span><span class="line" data-startTime="538">this preloader, </span><span class="line" data-startTime="540">and we got a 20% </span><span class="line" data-startTime="540">speed improvement </span><span class="line" data-startTime="541">to get to DOM content loaded, </span><span class="line" data-startTime="541">so it's really useful. </span> <span class="line" data-startTime="545">But in order to be </span><span class="line" data-startTime="545">quick, this pre-parser </span><span class="line" data-startTime="547">is a little bit stupid. </span> <span class="line" data-startTime="548">And in Internet Explorer, it's </span><span class="line" data-startTime="548">a bit too stupid at the moment. </span> <span class="line" data-startTime="551">It gets over excited. </span> <span class="line" data-startTime="552">It's like oh, look, I'm </span><span class="line" data-startTime="552">going to show this PNG. </span> <span class="line" data-startTime="554">I'm going to show this PNG. </span> <span class="line" data-startTime="555">Here I go showing the PNG. </span> <span class="line" data-startTime="557">Oh, no, actually, I won't. </span></p>

<p><span class="line" data-startTime="558">It's actually an SVG. </span> <span class="line" data-startTime="560">I'll do that instead. </span> <span class="line" data-startTime="561">So the main parser sees the </span><span class="line" data-startTime="561">markup and it sees the image, </span><span class="line" data-startTime="564">but it misses the SVG context. </span> <span class="line" data-startTime="566">And then the main </span><span class="line" data-startTime="566">parser comes along </span><span class="line" data-startTime="567">and goes why am I </span><span class="line" data-startTime="567">downloading PNG? </span><span class="line" data-startTime="570">And it cancels that download </span><span class="line" data-startTime="570">and goes for the SVG instead. </span> <span class="line" data-startTime="573">But by that point, it's </span><span class="line" data-startTime="573">made the connection. </span> <span class="line" data-startTime="575">It's probably got all of </span><span class="line" data-startTime="575">the image by that point. </span> <span class="line" data-startTime="578">The moral here is don't </span><span class="line" data-startTime="578">trust performance tips. </span> <span class="line" data-startTime="581">Make sure you test things. </span> <span class="line" data-startTime="583">At Chrome we say "tools, </span><span class="line" data-startTime="583">not rules," which rhymes, </span><span class="line" data-startTime="586">so I guess it must be true. </span> <span class="line" data-startTime="587">But always be on the lookout for </span><span class="line" data-startTime="587">existing data or existing tests </span><span class="line" data-startTime="591">that you can run. </span></p>

<p><span class="line" data-startTime="593">One of my favorite stories </span><span class="line" data-startTime="593">in science, or a tale, </span><span class="line" data-startTime="595">I don't know how </span><span class="line" data-startTime="595">true it is but it </span><span class="line" data-startTime="597">involves this man, </span><span class="line" data-startTime="597">August Weismann. </span> <span class="line" data-startTime="598">And he wanted to disprove </span><span class="line" data-startTime="598">that life experience was </span><span class="line" data-startTime="602">part of evolution, like </span><span class="line" data-startTime="602">something that happened </span><span class="line" data-startTime="604">to you during your life would </span><span class="line" data-startTime="604">be passed down as evolution. </span> <span class="line" data-startTime="607">So the way he was </span><span class="line" data-startTime="607">going to disprove </span><span class="line" data-startTime="609">this is he took two mice, </span><span class="line" data-startTime="609">and he cut their tails off </span><span class="line" data-startTime="611">and bred them together. </span> <span class="line" data-startTime="612">And then he took </span><span class="line" data-startTime="612">the offspring there, </span><span class="line" data-startTime="614">and he cut their tails off </span><span class="line" data-startTime="614">and bred them together. </span> <span class="line" data-startTime="616">The idea was we shouldn't </span><span class="line" data-startTime="616">end up with mice </span><span class="line" data-startTime="618">being born without tails, right? </span><span class="line" data-startTime="620">And he was running </span><span class="line" data-startTime="620">this test for quite a </span><span class="line" data-startTime="621">while until one of his </span><span class="line" data-startTime="621">colleagues pointed out, August, </span><span class="line" data-startTime="624">you do realize that Jewish </span><span class="line" data-startTime="624">people have been inadvertently </span><span class="line" data-startTime="628">carrying out this experiment </span><span class="line" data-startTime="628">a lot longer than you have. </span> <span class="line" data-startTime="632">Oh, yeah. </span> <span class="line" data-startTime="633">So he stopped his test, and </span><span class="line" data-startTime="633">he just used that as evidence. </span></p>

<p><span class="line" data-startTime="637">So what about this? </span><span class="line" data-startTime="638">We've got a div. </span> <span class="line" data-startTime="639">It's displaying non </span><span class="line" data-startTime="639">as an image inside it. </span> <span class="line" data-startTime="641">So the image won't be </span><span class="line" data-startTime="641">displayed, but which browsers </span><span class="line" data-startTime="643">are going to download it anyway? </span><span class="line" data-startTime="646">So yeah, it's not </span><span class="line" data-startTime="646">going to render. </span> <span class="line" data-startTime="649">So you could say it was a </span><span class="line" data-startTime="649">waste of bytes to do so. </span> <span class="line" data-startTime="652">Or maybe some browser's </span><span class="line" data-startTime="652">going to get it just </span><span class="line" data-startTime="654">in preparation, thinking </span><span class="line" data-startTime="654">it might be shown. </span> <span class="line" data-startTime="656">I'm going to close the </span><span class="line" data-startTime="656">question in three, two, one. </span></p>

<p><span class="line" data-startTime="661">OK, we're sort of leaning </span><span class="line" data-startTime="661">towards yes for every browser. </span> <span class="line" data-startTime="663">We're quite certain it's going </span><span class="line" data-startTime="663">to happen in Internet Explorer. </span> <span class="line" data-startTime="665">The answer, collectively </span><span class="line" data-startTime="665">you are correct. </span> <span class="line" data-startTime="667">Yes, all of the </span><span class="line" data-startTime="667">browsers here are </span><span class="line" data-startTime="669">going to download that image. </span> <span class="line" data-startTime="671">And this behavior </span><span class="line" data-startTime="671">is part of the spec. </span> <span class="line" data-startTime="673">So in the browser in the </span><span class="line" data-startTime="673">beginning, there is nothing, </span><span class="line" data-startTime="675">and then the browser gets </span><span class="line" data-startTime="675">sprayed with HTML text. </span> <span class="line" data-startTime="678">And it will convert that </span><span class="line" data-startTime="678">text into a tree of elements </span><span class="line" data-startTime="680">that we know as the DOM. </span> <span class="line" data-startTime="683">When is this is HTML? </span><span class="line" data-startTime="684">When an element is </span><span class="line" data-startTime="684">turned into &mdash; when </span><span class="line" data-startTime="686">a tag is turned into an </span><span class="line" data-startTime="686">element, the construction steps </span><span class="line" data-startTime="688">for that element have run. </span> <span class="line" data-startTime="690">And for image, it's really </span><span class="line" data-startTime="690">complicated, actually, </span><span class="line" data-startTime="693">creating an image element. </span> <span class="line" data-startTime="694">But step 14 down </span><span class="line" data-startTime="694">here at the bottom </span><span class="line" data-startTime="696">is where it actually makes the </span><span class="line" data-startTime="696">request and requests the image, </span><span class="line" data-startTime="699">so visibility doesn't </span><span class="line" data-startTime="699">matter at all. </span> <span class="line" data-startTime="701">It doesn't come into it. </span></p>

<p><span class="line" data-startTime="702">And that's kind of </span><span class="line" data-startTime="702">good, because it </span><span class="line" data-startTime="703">means that your images can </span><span class="line" data-startTime="703">download before your CSS is </span><span class="line" data-startTime="706">downloaded, before your </span><span class="line" data-startTime="706">scripts have downloaded. </span> <span class="line" data-startTime="708">As a downside, it meant that </span><span class="line" data-startTime="708">responsive images polyfills did </span><span class="line" data-startTime="711">not work because by the </span><span class="line" data-startTime="711">time your JavaScript gets </span><span class="line" data-startTime="714">to the image, it's </span><span class="line" data-startTime="714">already started </span><span class="line" data-startTime="716">to download the thing </span><span class="line" data-startTime="716">that was there already. </span> <span class="line" data-startTime="718">You're just going to </span><span class="line" data-startTime="718">add a second download </span><span class="line" data-startTime="719">by changing the source. </span> <span class="line" data-startTime="721">This won't be a </span><span class="line" data-startTime="721">problem in the future. </span> <span class="line" data-startTime="723">The resource priority </span><span class="line" data-startTime="723">spec we've specified </span><span class="line" data-startTime="725">the postpone attribute, </span><span class="line" data-startTime="725">which tells an image that it </span><span class="line" data-startTime="728">shouldn't display if </span><span class="line" data-startTime="728">it's displaying non, </span><span class="line" data-startTime="730">among other things. </span></p>

<p><span class="line" data-startTime="732">But what if we are using CSS? </span><span class="line" data-startTime="735">What then? </span><span class="line" data-startTime="736">So here we've got a div </span><span class="line" data-startTime="736">that's displaying non, </span><span class="line" data-startTime="737">and inside there's a div </span><span class="line" data-startTime="737">with a background image. </span> <span class="line" data-startTime="740">So it's kind of similar </span><span class="line" data-startTime="740">to the image one. </span> <span class="line" data-startTime="742">But we saw that images </span><span class="line" data-startTime="742">are ignoring CSS, </span><span class="line" data-startTime="744">but here we're actually </span><span class="line" data-startTime="744">in CSS land already. </span> <span class="line" data-startTime="746">So are there any browsers that </span><span class="line" data-startTime="746">are going to download that, </span><span class="line" data-startTime="749">or are they just </span><span class="line" data-startTime="749">going to ignore it? </span><span class="line" data-startTime="751">Because once again, it's </span><span class="line" data-startTime="751">not going to be displayed. </span> <span class="line" data-startTime="753">So you could consider </span><span class="line" data-startTime="753">it a waste of bytes. </span> <span class="line" data-startTime="755">I'm going to close the </span><span class="line" data-startTime="755">question in three, two, one. </span> <span class="line" data-startTime="760">We're kind of edging towards </span><span class="line" data-startTime="760">yes in every browser. </span> <span class="line" data-startTime="763">I'm afraid not. </span> <span class="line" data-startTime="764">No browsers are going to </span><span class="line" data-startTime="764">download it here, none at all. </span> <span class="line" data-startTime="766">And that's kind </span><span class="line" data-startTime="766">of &mdash; I suppose you </span><span class="line" data-startTime="768">could see that as a good thing. </span> <span class="line" data-startTime="769">It's saving bytes. </span></p>

<p><span class="line" data-startTime="770">But what if we did this? </span><span class="line" data-startTime="771">Similar question. </span> <span class="line" data-startTime="772">It's a div displaying non, </span><span class="line" data-startTime="772">and it has a background image. </span> <span class="line" data-startTime="776">The difference in </span><span class="line" data-startTime="776">the last question </span><span class="line" data-startTime="778">is it's all on one element. </span> <span class="line" data-startTime="779">It's not &mdash; the image isn't </span><span class="line" data-startTime="779">inside another element that's </span><span class="line" data-startTime="782">displaying non. </span> <span class="line" data-startTime="783">Does that change things? </span><span class="line" data-startTime="784">Once again, it's not going to </span><span class="line" data-startTime="784">need that background image. </span> <span class="line" data-startTime="787">I'm going to close the </span><span class="line" data-startTime="787">question in three, two, one. </span> <span class="line" data-startTime="792">We're edging towards </span><span class="line" data-startTime="792">yes in every browser. </span> <span class="line" data-startTime="794">A little bit more </span><span class="line" data-startTime="794">confident in Chrome. </span> <span class="line" data-startTime="797">Most browsers will. </span> <span class="line" data-startTime="798">Firefox will not. </span> <span class="line" data-startTime="800">So what's going on here? </span><span class="line" data-startTime="803">Once the browser has </span><span class="line" data-startTime="803">this tree of elements, </span><span class="line" data-startTime="804">it needs to work out </span><span class="line" data-startTime="804">what they look like </span><span class="line" data-startTime="806">and where they go on the page. </span> <span class="line" data-startTime="807">And the first step of this </span><span class="line" data-startTime="807">is a style calculation. </span></p>

<p><span class="line" data-startTime="809">So it calculates all the styles. </span> <span class="line" data-startTime="811">It goes through the </span><span class="line" data-startTime="811">CSS cascade, the style </span><span class="line" data-startTime="812">attributes, the font tags </span><span class="line" data-startTime="812">if you're from the '90s. </span> <span class="line" data-startTime="815">And works out what style </span><span class="line" data-startTime="815">applies to each element. </span> <span class="line" data-startTime="817">But not everything gets </span><span class="line" data-startTime="817">its style calculated, </span><span class="line" data-startTime="819">so this div up at the top </span><span class="line" data-startTime="819">turned out to be displaying non. </span> <span class="line" data-startTime="822">The browser stops there. </span> <span class="line" data-startTime="823">It doesn't calculate </span><span class="line" data-startTime="823">for the children, </span><span class="line" data-startTime="825">because those elements </span><span class="line" data-startTime="825">have no impact </span><span class="line" data-startTime="827">on the rendering of the page. </span> <span class="line" data-startTime="828">So it short cuts. </span> <span class="line" data-startTime="830">So if these elements </span><span class="line" data-startTime="830">have a background image, </span><span class="line" data-startTime="831">the browser just never </span><span class="line" data-startTime="831">finds out about it. </span></p>

<p><span class="line" data-startTime="834">This div up at the top </span><span class="line" data-startTime="834">here is displaying non, </span><span class="line" data-startTime="836">but it did have its </span><span class="line" data-startTime="836">style calculated in order </span><span class="line" data-startTime="838">to find that out. </span> <span class="line" data-startTime="838">And that's when the browser will </span><span class="line" data-startTime="838">discover the background image. </span> <span class="line" data-startTime="841">Firefox is a little bit smarter </span><span class="line" data-startTime="841">here and avoids the download. </span> <span class="line" data-startTime="844">But if you change that to, </span><span class="line" data-startTime="844">instead of displaying non, </span><span class="line" data-startTime="846">you use visibility </span><span class="line" data-startTime="846">hidden or opacity zero, </span><span class="line" data-startTime="850">Firefox would download as well. </span> <span class="line" data-startTime="852">Who's getting it right </span><span class="line" data-startTime="852">according to the specification? </span><span class="line" data-startTime="855">Everyone is. </span> <span class="line" data-startTime="856">The spec is really vague here. </span> <span class="line" data-startTime="858">It says the browser </span><span class="line" data-startTime="858">may optimize, </span><span class="line" data-startTime="859">even if the element </span><span class="line" data-startTime="859">is just obscured </span><span class="line" data-startTime="861">or it's underneath another one. </span> <span class="line" data-startTime="863">But no browsers are that smart. </span> <span class="line" data-startTime="865">This kind of freedom </span><span class="line" data-startTime="865">in specifications </span><span class="line" data-startTime="867">is kind of good, </span><span class="line" data-startTime="867">because it means </span><span class="line" data-startTime="869">the browser can do </span><span class="line" data-startTime="869">the right thing given </span><span class="line" data-startTime="871">the device, the connectivity, </span><span class="line" data-startTime="871">maybe even the battery percent, </span><span class="line" data-startTime="874">how much battery </span><span class="line" data-startTime="874">you've got left. </span></p>

<p><span class="line" data-startTime="876">But it's also scary, </span><span class="line" data-startTime="876">because it means </span><span class="line" data-startTime="877">you're going to get the browsers </span><span class="line" data-startTime="877">doing different things as they </span><span class="line" data-startTime="880">try new stuff with </span><span class="line" data-startTime="880">that freedom they have. </span> <span class="line" data-startTime="882">But I think that </span><span class="line" data-startTime="882">kind of diversity </span><span class="line" data-startTime="883">is what makes the web great. </span> <span class="line" data-startTime="885">It's not one company driving </span><span class="line" data-startTime="885">forward with its own interests. </span> <span class="line" data-startTime="889">It's lots of companies </span><span class="line" data-startTime="889">driving forward </span><span class="line" data-startTime="891">in different directions. </span> <span class="line" data-startTime="892">And we get this kind of car </span><span class="line" data-startTime="892">crash, but with a happy ending. </span> <span class="line" data-startTime="896">And that's the web </span><span class="line" data-startTime="896">that we have today. </span> <span class="line" data-startTime="900">If you want to avoid </span><span class="line" data-startTime="900">downloading a CSS background, </span><span class="line" data-startTime="903">hiding an element isn't enough. </span></p>

<p><span class="line" data-startTime="904">You need to put it inside an </span><span class="line" data-startTime="904">element that is displaying non. </span> <span class="line" data-startTime="907">But when you do </span><span class="line" data-startTime="907">this, you're just </span><span class="line" data-startTime="908">relying on what </span><span class="line" data-startTime="908">browsers do today. </span> <span class="line" data-startTime="911">It's not specified behavior. </span> <span class="line" data-startTime="912">Browsers may change. </span> <span class="line" data-startTime="913">The only sure-fire way is </span><span class="line" data-startTime="913">make sure the browser doesn't </span><span class="line" data-startTime="916">find out about that </span><span class="line" data-startTime="916">background image. </span> <span class="line" data-startTime="918">Don't add the class name </span><span class="line" data-startTime="918">that adds that background. </span> <span class="line" data-startTime="920">Or don't add the </span><span class="line" data-startTime="920">element to the DOM </span><span class="line" data-startTime="922">at all until you really need it. </span> <span class="line" data-startTime="925">OK, things have </span><span class="line" data-startTime="925">been relatively easy </span><span class="line" data-startTime="927">so far because we weren't </span><span class="line" data-startTime="927">involving JavaScript. </span> <span class="line" data-startTime="929">So let's get </span><span class="line" data-startTime="929">JavaScript involved. </span> <span class="line" data-startTime="931">What about this? </span><span class="line" data-startTime="931">I'm creating an image, </span><span class="line" data-startTime="931">I'm giving it a source. </span> <span class="line" data-startTime="933">I'm not putting it </span><span class="line" data-startTime="933">in the document, </span><span class="line" data-startTime="935">and I'm spelling "image" </span><span class="line" data-startTime="935">incorrectly like we did before. </span> <span class="line" data-startTime="938">So we saw in HTML that it </span><span class="line" data-startTime="938">was also correcting I-M-A-G-E </span><span class="line" data-startTime="943">to I-M-G. But does it </span><span class="line" data-startTime="943">do the same in the DOM? </span><span class="line" data-startTime="947">Do images even download when </span><span class="line" data-startTime="947">they're not in the document? </span><span class="line" data-startTime="949">Because once again, </span><span class="line" data-startTime="949">this is not &mdash; </span><span class="line" data-startTime="951">the browser doesn't </span><span class="line" data-startTime="951">need to render this yet, </span><span class="line" data-startTime="953">or it can't render this yet. </span></p>

<p><span class="line" data-startTime="954">I'm going to close the </span><span class="line" data-startTime="954">question three, two, one. </span> <span class="line" data-startTime="959">This is the point in the </span><span class="line" data-startTime="959">quiz where the audience just </span><span class="line" data-startTime="962">gets broken, and the </span><span class="line" data-startTime="962">needles just drift </span><span class="line" data-startTime="964">towards the center of I </span><span class="line" data-startTime="964">don't know what's going on. </span> <span class="line" data-startTime="967">In this case, most </span><span class="line" data-startTime="967">browsers will download. </span> <span class="line" data-startTime="971">Firefox won't, and </span><span class="line" data-startTime="971">there are three parts </span><span class="line" data-startTime="974">to this explanation. </span> <span class="line" data-startTime="975">As we saw before, </span><span class="line" data-startTime="975">the DOM gets parsed, </span><span class="line" data-startTime="978">and the creation steps </span><span class="line" data-startTime="978">of the elements are run. </span></p>

<p><span class="line" data-startTime="980">This animation took </span><span class="line" data-startTime="980">me a long time, </span><span class="line" data-startTime="981">which is why you've </span><span class="line" data-startTime="981">seen it three times </span><span class="line" data-startTime="983">already, but that </span><span class="line" data-startTime="983">is the last time. </span> <span class="line" data-startTime="985">But when an element is </span><span class="line" data-startTime="985">created using DOM stuff, </span><span class="line" data-startTime="987">it's still going to </span><span class="line" data-startTime="987">run the creation steps, </span><span class="line" data-startTime="989">and we solve for </span><span class="line" data-startTime="989">images in step 14. </span> <span class="line" data-startTime="991">That is going to be when </span><span class="line" data-startTime="991">it downloads the image. </span> <span class="line" data-startTime="993">We can use this </span><span class="line" data-startTime="993">to our advantage, </span><span class="line" data-startTime="995">because this one line, you </span><span class="line" data-startTime="995">can make a "get" request </span><span class="line" data-startTime="997">to anything that the </span><span class="line" data-startTime="997">machine can access. </span> <span class="line" data-startTime="1000">And in fact, images have </span><span class="line" data-startTime="1000">their own DOM constructor, </span><span class="line" data-startTime="1004">unlike a lot of other elements. </span></p>

<p><span class="line" data-startTime="1005">So that tiny bit </span><span class="line" data-startTime="1005">of code: instant </span><span class="line" data-startTime="1007">get request to anywhere else. </span> <span class="line" data-startTime="1008">And this is pretty much how </span><span class="line" data-startTime="1008">Google Analytics talks back </span><span class="line" data-startTime="1011">to the server. </span> <span class="line" data-startTime="1012">But we saw before that Firefox </span><span class="line" data-startTime="1012">didn't make the request, </span><span class="line" data-startTime="1014">so what's going on there? </span><span class="line" data-startTime="1016">When we create this, most </span><span class="line" data-startTime="1016">browsers &mdash; Chrome, Safari, IE &mdash; </span><span class="line" data-startTime="1020">will give us an HTML image </span><span class="line" data-startTime="1020">element back, whereas Firefox </span><span class="line" data-startTime="1023">will give us an HTML element. </span> <span class="line" data-startTime="1025">It's not an image. </span> <span class="line" data-startTime="1026">If you add it to the page, </span><span class="line" data-startTime="1026">it won't display an image. </span> <span class="line" data-startTime="1029">And the interesting </span><span class="line" data-startTime="1029">thing is here, </span><span class="line" data-startTime="1031">it's the only one </span><span class="line" data-startTime="1031">getting it right. </span></p>

<p><span class="line" data-startTime="1033">We saw before, this </span><span class="line" data-startTime="1033">is how the browser </span><span class="line" data-startTime="1036">or how the spec </span><span class="line" data-startTime="1036">deals with images </span><span class="line" data-startTime="1037">that are spelled incorrectly. </span> <span class="line" data-startTime="1038">But this is in the </span><span class="line" data-startTime="1038">parsing spec, and we </span><span class="line" data-startTime="1041">bypassed parsing by </span><span class="line" data-startTime="1041">using create element, </span><span class="line" data-startTime="1044">completely bypassing the parser. </span> <span class="line" data-startTime="1046">So it should &mdash; Firefox </span><span class="line" data-startTime="1046">gives us an HTML element. </span> <span class="line" data-startTime="1050">It should give us an </span><span class="line" data-startTime="1050">HTML unknown element, </span><span class="line" data-startTime="1052">which it does if you do </span><span class="line" data-startTime="1052">create an element fubar. </span> <span class="line" data-startTime="1054">Firefox is doing something </span><span class="line" data-startTime="1054">special for these images. </span> <span class="line" data-startTime="1057">But it's getting it more </span><span class="line" data-startTime="1057">right than other browsers. </span> <span class="line" data-startTime="1060">I think I preferred it when we </span><span class="line" data-startTime="1060">were developing for browsers. </span> <span class="line" data-startTime="1063">It was like there </span><span class="line" data-startTime="1063">was one bad guy, </span><span class="line" data-startTime="1064">and it was Internet </span><span class="line" data-startTime="1064">Explorer 6 or 7 or 8. </span> <span class="line" data-startTime="1067">And all the other browsers </span><span class="line" data-startTime="1067">seemed perfect in comparison. </span></p>

<p><span class="line" data-startTime="1069">But I see the browser-scape as </span><span class="line" data-startTime="1069">being like an orchestra where </span><span class="line" data-startTime="1073">Internet Explorer </span><span class="line" data-startTime="1073">8 was just this kid </span><span class="line" data-startTime="1075">hitting two cymbals </span><span class="line" data-startTime="1075">together and screaming. </span> <span class="line" data-startTime="1077">But once we finally kick </span><span class="line" data-startTime="1077">the screaming child out </span><span class="line" data-startTime="1079">of the room, and we come back </span><span class="line" data-startTime="1079">and we start conducting again, </span><span class="line" data-startTime="1082">we realize oh, </span><span class="line" data-startTime="1082">everyone is actually </span><span class="line" data-startTime="1084">a little bit out of tune. </span> <span class="line" data-startTime="1085">We just didn't realize because </span><span class="line" data-startTime="1085">of the screaming cymbal child </span><span class="line" data-startTime="1088">of Internet Explorer. </span></p>

<p><span class="line" data-startTime="1090">So let's just get CSS involved </span><span class="line" data-startTime="1090">again, but JavaScript as well. </span> <span class="line" data-startTime="1094">What about this? </span><span class="line" data-startTime="1095">I'm creating a div, </span><span class="line" data-startTime="1095">giving it a background. </span> <span class="line" data-startTime="1097">It's not in the document, </span><span class="line" data-startTime="1097">but everything's </span><span class="line" data-startTime="1099">spelled right and valid. </span> <span class="line" data-startTime="1101">We saw images download </span><span class="line" data-startTime="1101">at this point, </span><span class="line" data-startTime="1103">but what about when </span><span class="line" data-startTime="1103">CSS is involved? </span><span class="line" data-startTime="1105">Are we going to see </span><span class="line" data-startTime="1105">things download there? </span><span class="line" data-startTime="1107">Get your answers in quickly. </span> <span class="line" data-startTime="1108">I'm going to close the </span><span class="line" data-startTime="1108">question in three, two, one. </span> <span class="line" data-startTime="1113">Once again, the </span><span class="line" data-startTime="1113">needles are starting </span><span class="line" data-startTime="1115">to drift into the middle. </span></p>

<p><span class="line" data-startTime="1117">The answer here is no. </span> <span class="line" data-startTime="1118">No browsers will download here. </span> <span class="line" data-startTime="1120">This is the same as </span><span class="line" data-startTime="1120">the display non case. </span> <span class="line" data-startTime="1123">The browser won't calculate </span><span class="line" data-startTime="1123">the style of elements </span><span class="line" data-startTime="1125">that display non, and </span><span class="line" data-startTime="1125">it also won't calculate </span><span class="line" data-startTime="1127">the styles of </span><span class="line" data-startTime="1127">elements that aren't </span><span class="line" data-startTime="1129">in the document, because </span><span class="line" data-startTime="1129">there's no point. </span> <span class="line" data-startTime="1130">It doesn't affect the </span><span class="line" data-startTime="1130">rendering of the page at all. </span> <span class="line" data-startTime="1133">OK, I'm going to be cruel now. </span> <span class="line" data-startTime="1135">What about this? </span><span class="line" data-startTime="1136">So same again. </span> <span class="line" data-startTime="1137">I'm adding it to the document. </span> <span class="line" data-startTime="1139">Then I'm removing it again. </span> <span class="line" data-startTime="1141">Is it in the document long </span><span class="line" data-startTime="1141">enough for the browser </span><span class="line" data-startTime="1143">to go oh, I should download </span><span class="line" data-startTime="1143">this background image? </span><span class="line" data-startTime="1146">Or does it not get to </span><span class="line" data-startTime="1146">see it long enough? </span><span class="line" data-startTime="1149">Does it not bother? </span><span class="line" data-startTime="1151">I'm going to close the </span><span class="line" data-startTime="1151">question in three, two, one. </span> <span class="line" data-startTime="1157">OK, we're suggesting </span><span class="line" data-startTime="1157">yes because yes, it </span><span class="line" data-startTime="1158">has entered the document. </span></p>

<p><span class="line" data-startTime="1161">I'm afraid you are all </span><span class="line" data-startTime="1161">wrong with that one, all </span><span class="line" data-startTime="1163">the people who said that. </span> <span class="line" data-startTime="1164">The browser doesn't want to </span><span class="line" data-startTime="1164">think about styles or layout </span><span class="line" data-startTime="1166">until the very last moment. </span> <span class="line" data-startTime="1168">And that's normally </span><span class="line" data-startTime="1168">rendering, when it actually </span><span class="line" data-startTime="1170">needs to change </span><span class="line" data-startTime="1170">pixels on the screen. </span> <span class="line" data-startTime="1172">And we can't do that, </span><span class="line" data-startTime="1172">or we don't do that, </span><span class="line" data-startTime="1174">while we're in the </span><span class="line" data-startTime="1174">middle of JavaScript. </span> <span class="line" data-startTime="1176">So the browser </span><span class="line" data-startTime="1176">actually sits back </span><span class="line" data-startTime="1177">and waits for that </span><span class="line" data-startTime="1177">JavaScript block to execute. </span> <span class="line" data-startTime="1179">And then afterwards it will </span><span class="line" data-startTime="1179">go and look at what's changed </span><span class="line" data-startTime="1182">and react to that when </span><span class="line" data-startTime="1182">it needs to render next. </span> <span class="line" data-startTime="1185">But does this change that? </span><span class="line" data-startTime="1186">So same code again, but in </span><span class="line" data-startTime="1186">between adding and removing it </span><span class="line" data-startTime="1189">to the document, </span><span class="line" data-startTime="1189">I'm going to ask </span><span class="line" data-startTime="1190">for the text content </span><span class="line" data-startTime="1190">of the element. </span></p>

<p><span class="line" data-startTime="1192">Now, the text content is </span><span class="line" data-startTime="1192">going to be an empty string, </span><span class="line" data-startTime="1194">because it is an empty element. </span> <span class="line" data-startTime="1196">But is just accessing </span><span class="line" data-startTime="1196">that property </span><span class="line" data-startTime="1198">going to change things? </span><span class="line" data-startTime="1199">I'm not even assigning </span><span class="line" data-startTime="1199">it to a variable. </span> <span class="line" data-startTime="1202">Is it just even going to be </span><span class="line" data-startTime="1202">optimized away by JavaScript </span><span class="line" data-startTime="1204">because it has no impact? </span><span class="line" data-startTime="1206">I'm going to close the </span><span class="line" data-startTime="1206">question in three, two, one. </span> <span class="line" data-startTime="1210">Almost dead in the middle. </span> <span class="line" data-startTime="1211">Excellent. </span> <span class="line" data-startTime="1212">The answer is no. </span> <span class="line" data-startTime="1214">No browsers will make a request. </span> <span class="line" data-startTime="1215">Getting the text </span><span class="line" data-startTime="1215">content is easy. </span> <span class="line" data-startTime="1217">It's just going to go through </span><span class="line" data-startTime="1217">the DOM, find the text nodes, </span><span class="line" data-startTime="1219">concatenate the values together. </span> <span class="line" data-startTime="1222">What about this? </span><span class="line" data-startTime="1222">Similar question, but this </span><span class="line" data-startTime="1222">time enter HTML rather than </span><span class="line" data-startTime="1225">text content. </span> <span class="line" data-startTime="1226">Once again, it's going to be </span><span class="line" data-startTime="1226">an empty string that comes back </span><span class="line" data-startTime="1228">there, because the </span><span class="line" data-startTime="1228">element is empty. </span> <span class="line" data-startTime="1230">But does it behave </span><span class="line" data-startTime="1230">differently to text content? </span><span class="line" data-startTime="1234">Are the browsers going to </span><span class="line" data-startTime="1234">do something different? </span><span class="line" data-startTime="1236">I'm going to close the </span><span class="line" data-startTime="1236">question in three, two, one. </span></p>

<p><span class="line" data-startTime="1241">We're saying no here. </span> <span class="line" data-startTime="1243">Well, you're mostly right. </span> <span class="line" data-startTime="1246">Internet Explorer will </span><span class="line" data-startTime="1246">make a download here. </span> <span class="line" data-startTime="1248">And the reason for that is </span><span class="line" data-startTime="1248">because in Internet Explorer &mdash; </span><span class="line" data-startTime="1253">I don't know. </span> <span class="line" data-startTime="1254">I have absolutely no idea. </span> <span class="line" data-startTime="1256">Some things in the world </span><span class="line" data-startTime="1256">cannot be explained, </span><span class="line" data-startTime="1259">and this is one of them. </span> <span class="line" data-startTime="1260">Like how it takes three </span><span class="line" data-startTime="1260">attempts to plug in a USB cable, </span><span class="line" data-startTime="1263">even though there are </span><span class="line" data-startTime="1263">only two possibilities, </span><span class="line" data-startTime="1265">some things cannot be explained. </span> <span class="line" data-startTime="1268">OK, on the same theme again, </span><span class="line" data-startTime="1268">but this time in the text. </span> <span class="line" data-startTime="1272">Once again, like </span><span class="line" data-startTime="1272">the other two, this </span><span class="line" data-startTime="1274">is going to come back as an </span><span class="line" data-startTime="1274">empty string, because it's </span><span class="line" data-startTime="1276">an empty element. </span></p>

<p><span class="line" data-startTime="1277">But is that going to </span><span class="line" data-startTime="1277">behave differently? </span><span class="line" data-startTime="1278">Is Internet Explorer still </span><span class="line" data-startTime="1278">going to make the request </span><span class="line" data-startTime="1280">erroneously, like it did before? </span><span class="line" data-startTime="1282">Is it going to get </span><span class="line" data-startTime="1282">it correct this time? </span><span class="line" data-startTime="1284">Who knows? </span><span class="line" data-startTime="1285">I'm going to close the </span><span class="line" data-startTime="1285">question in three, two, one. </span> <span class="line" data-startTime="1290">We're edging towards no. </span> <span class="line" data-startTime="1291">Little bit less sure </span><span class="line" data-startTime="1291">on Internet Explorer. </span></p>

<p class="speaker"><span class="line" data-starttime="1293"><span class="speakerName">The answer</span>: yes. </span> <span class="line" data-startTime="1295">Most browsers will </span><span class="line" data-startTime="1295">make a request here. </span> <span class="line" data-startTime="1297">And this actually kind of </span><span class="line" data-startTime="1297">makes sense in an odd way. </span> <span class="line" data-startTime="1301">Let's make a div. </span> <span class="line" data-startTime="1302">It's got a background image, </span><span class="line" data-startTime="1302">and it's got some inner HTML. </span> <span class="line" data-startTime="1305">It's got Hello World inside </span><span class="line" data-startTime="1305">it, but World is inside </span><span class="line" data-startTime="1307">a div of its own. </span> <span class="line" data-startTime="1308">We add it to the document. </span> <span class="line" data-startTime="1310">We ask for its text content. </span> <span class="line" data-startTime="1311">It's Hello World, </span><span class="line" data-startTime="1311">but when we ask </span><span class="line" data-startTime="1312">for the inner text in, </span><span class="line" data-startTime="1312">i.e., Safari and Chrome, </span><span class="line" data-startTime="1316">it's going to return this. </span></p>

<p><span class="line" data-startTime="1317">It's got a line </span><span class="line" data-startTime="1317">break in the middle. </span> <span class="line" data-startTime="1318">And the reason for this is inner </span><span class="line" data-startTime="1318">text isn't just a text content. </span> <span class="line" data-startTime="1322">It's more like </span><span class="line" data-startTime="1322">what you would get </span><span class="line" data-startTime="1323">if you copied &mdash; if you </span><span class="line" data-startTime="1323">highlighted the element </span><span class="line" data-startTime="1325">and copied it. </span> <span class="line" data-startTime="1326">And because of this, it's </span><span class="line" data-startTime="1326">got style information, </span><span class="line" data-startTime="1329">because the World is </span><span class="line" data-startTime="1329">on a different line, </span><span class="line" data-startTime="1331">because the div is block level. </span> <span class="line" data-startTime="1332">Or it is by default, </span><span class="line" data-startTime="1332">and it is in this case. </span> <span class="line" data-startTime="1335">So what actually happens </span><span class="line" data-startTime="1335">here is the browser &mdash; </span><span class="line" data-startTime="1337">we asked for the text content. </span></p>

<p><span class="line" data-startTime="1339">It just gets that back, but </span><span class="line" data-startTime="1339">when you ask for the inner text, </span><span class="line" data-startTime="1342">the browser has to go Ah! </span><span class="line" data-startTime="1344">I need to know what the </span><span class="line" data-startTime="1344">layout of this element </span><span class="line" data-startTime="1345">is in order to return this. </span> <span class="line" data-startTime="1347">I need to find out if that </span><span class="line" data-startTime="1347">div's block level, where am I </span><span class="line" data-startTime="1349">going to put my line breaks? </span><span class="line" data-startTime="1351">Oh, look, there's a </span><span class="line" data-startTime="1351">background image there. </span> <span class="line" data-startTime="1352">And then it downloads </span><span class="line" data-startTime="1352">it, because it </span><span class="line" data-startTime="1354">forces it to look at the styles. </span> <span class="line" data-startTime="1356">Most of the time, </span><span class="line" data-startTime="1356">the browser will </span><span class="line" data-startTime="1357">defer looking at styles </span><span class="line" data-startTime="1357">as late as it can. </span> <span class="line" data-startTime="1360">But here we forced </span><span class="line" data-startTime="1360">it to happen sooner, </span><span class="line" data-startTime="1361">because we've </span><span class="line" data-startTime="1361">asked for something </span><span class="line" data-startTime="1363">that's style dependent. </span> <span class="line" data-startTime="1364">Firefox didn't make </span><span class="line" data-startTime="1364">a request, because it </span><span class="line" data-startTime="1367">doesn't support inner text. </span></p>

<p><span class="line" data-startTime="1368">It doesn't support </span><span class="line" data-startTime="1368">the property at all, </span><span class="line" data-startTime="1370">so that's just undefined. </span> <span class="line" data-startTime="1372">That was quite cruel. </span> <span class="line" data-startTime="1373">But if we used any </span><span class="line" data-startTime="1373">of these properties, </span><span class="line" data-startTime="1376">like out of text &mdash; </span><span class="line" data-startTime="1376">not out of text, </span><span class="line" data-startTime="1378">but offset left, </span><span class="line" data-startTime="1378">offset parens, Firefox </span><span class="line" data-startTime="1381">would have made the </span><span class="line" data-startTime="1381">request as well. </span> <span class="line" data-startTime="1384">So ignorance of </span><span class="line" data-startTime="1384">those elements that </span><span class="line" data-startTime="1387">will require style information, </span><span class="line" data-startTime="1387">that's one of the number </span><span class="line" data-startTime="1391">one problems with performance </span><span class="line" data-startTime="1391">that we see on the web. </span> <span class="line" data-startTime="1394">Because also you can do </span><span class="line" data-startTime="1394">some nice hackery with it. </span> <span class="line" data-startTime="1396">If you look at code like this, </span><span class="line" data-startTime="1396">it looks really expensive, </span><span class="line" data-startTime="1399">but it's not. </span> <span class="line" data-startTime="1399">It's really cheap, </span><span class="line" data-startTime="1399">because the browser's just </span><span class="line" data-startTime="1401">going to sit back and </span><span class="line" data-startTime="1401">watch you just writing </span><span class="line" data-startTime="1403">this property to an object. </span></p>

<p><span class="line" data-startTime="1406">And it's not going to care </span><span class="line" data-startTime="1406">about it until that block ends. </span> <span class="line" data-startTime="1410">And once that's all done, it </span><span class="line" data-startTime="1410">will just look at the results, </span><span class="line" data-startTime="1414">and in this case, there's </span><span class="line" data-startTime="1414">no pixel difference. </span> <span class="line" data-startTime="1417">This can lead to some </span><span class="line" data-startTime="1417">unexpected results, not just </span><span class="line" data-startTime="1420">graphical performance, but &mdash; </span><span class="line" data-startTime="1422">So imagine &mdash; let's have a </span><span class="line" data-startTime="1422">look at a practical example. </span> <span class="line" data-startTime="1426">Here is Paul Lewis and me. </span> <span class="line" data-startTime="1427">We work together. </span> <span class="line" data-startTime="1429">We want to go over there. </span> <span class="line" data-startTime="1430">You can tell, because </span><span class="line" data-startTime="1430">we're pointing. </span> <span class="line" data-startTime="1431">Let's do it with code. </span> <span class="line" data-startTime="1433">We're going to say left 0%, </span><span class="line" data-startTime="1433">going to set a transition, </span><span class="line" data-startTime="1436">and then left 100%. </span> <span class="line" data-startTime="1437">We run that code. </span> <span class="line" data-startTime="1438">Hey, off we go. </span></p>

<p><span class="line" data-startTime="1440">Excellent. </span> <span class="line" data-startTime="1440">We win at code. </span> <span class="line" data-startTime="1442">But if we run that code </span><span class="line" data-startTime="1442">again, nothing happens. </span> <span class="line" data-startTime="1446">And the reason </span><span class="line" data-startTime="1446">nothing happens is </span><span class="line" data-startTime="1447">the browser's going to batch </span><span class="line" data-startTime="1447">up these style changes. </span> <span class="line" data-startTime="1449">So we've got &mdash; we're </span><span class="line" data-startTime="1449">setting "left" twice, </span><span class="line" data-startTime="1451">but the browser's only going </span><span class="line" data-startTime="1451">to listen to the last one. </span> <span class="line" data-startTime="1454">And we're essentially </span><span class="line" data-startTime="1454">saying transition to 100%, </span><span class="line" data-startTime="1457">but we're already at </span><span class="line" data-startTime="1457">100%, so it doesn't move. </span> <span class="line" data-startTime="1460">You might have </span><span class="line" data-startTime="1460">encountered this and tried </span><span class="line" data-startTime="1462">to fix it with set timeouts in </span><span class="line" data-startTime="1462">an arbitrary number in there. </span> <span class="line" data-startTime="1465">But what you actually want </span><span class="line" data-startTime="1465">to do is at this point, </span><span class="line" data-startTime="1467">just after we set </span><span class="line" data-startTime="1467">the first left, </span><span class="line" data-startTime="1468">you want the browser to </span><span class="line" data-startTime="1468">go look at that style </span><span class="line" data-startTime="1471">and actually think about it. </span></p>

<p><span class="line" data-startTime="1472">And we can actually do that by </span><span class="line" data-startTime="1472">putting one of those properties </span><span class="line" data-startTime="1474">in: offset width or whatever. </span> <span class="line" data-startTime="1476">And once we do that, we can </span><span class="line" data-startTime="1476">run that code as many times </span><span class="line" data-startTime="1479">as we want, and it </span><span class="line" data-startTime="1479">will work every time. </span> <span class="line" data-startTime="1481">But you are relying on </span><span class="line" data-startTime="1481">unspecified behavior </span><span class="line" data-startTime="1483">when you do that. </span> <span class="line" data-startTime="1484">The web animations API </span><span class="line" data-startTime="1484">will save us there. </span> <span class="line" data-startTime="1487">And just before I </span><span class="line" data-startTime="1487">get kicked off stage, </span><span class="line" data-startTime="1489">I want to go through </span><span class="line" data-startTime="1489">the bad side of that. </span> <span class="line" data-startTime="1492">Normally, using things </span><span class="line" data-startTime="1492">that offset width </span><span class="line" data-startTime="1494">in the middle of </span><span class="line" data-startTime="1494">your code can lead </span><span class="line" data-startTime="1496">to a performance difficulty. </span> <span class="line" data-startTime="1497">And here's an example of that. </span></p>

<p><span class="line" data-startTime="1498">Here I've got a page with </span><span class="line" data-startTime="1498">a load of paragraphs. </span> <span class="line" data-startTime="1501">What I'm going to </span><span class="line" data-startTime="1501">do is I'm going </span><span class="line" data-startTime="1502">to set Chrome's timeline </span><span class="line" data-startTime="1502">recording, which </span><span class="line" data-startTime="1504">is going to record </span><span class="line" data-startTime="1504">everything that's going on, </span><span class="line" data-startTime="1505">resize this green box, and </span><span class="line" data-startTime="1505">I'm going to hit that button. </span> <span class="line" data-startTime="1507">When I hit that button, </span><span class="line" data-startTime="1507">all of these paragraphs </span><span class="line" data-startTime="1509">are going to become the </span><span class="line" data-startTime="1509">same size as the green box. </span> <span class="line" data-startTime="1512">So do that, press the </span><span class="line" data-startTime="1512">button, and they all change. </span> <span class="line" data-startTime="1515">And that was quite slow. </span> <span class="line" data-startTime="1516">We can see in the timeline </span><span class="line" data-startTime="1516">there's a little spike there. </span> <span class="line" data-startTime="1519">And if we have a look at the </span><span class="line" data-startTime="1519">number that comes up there, </span><span class="line" data-startTime="1522">it's 1.27 seconds. </span> <span class="line" data-startTime="1525">It's very slow. </span> <span class="line" data-startTime="1526">But this is the little </span><span class="line" data-startTime="1526">Warning icon on there, </span><span class="line" data-startTime="1528">and if we look into that, we </span><span class="line" data-startTime="1528">get a clue of what's going on. </span> <span class="line" data-startTime="1531">We get this recalculate style </span><span class="line" data-startTime="1531">layout, recalculate style </span><span class="line" data-startTime="1533">layout happening </span><span class="line" data-startTime="1533">over and over again, </span><span class="line" data-startTime="1535">and that's not looking great. </span> <span class="line" data-startTime="1537">The code we're using </span><span class="line" data-startTime="1537">is really simple. </span></p>

<p><span class="line" data-startTime="1539">We just looped through </span><span class="line" data-startTime="1539">all of those paragraphs </span><span class="line" data-startTime="1541">and set the offset width of the </span><span class="line" data-startTime="1541">green block to the paragraph. </span> <span class="line" data-startTime="1544">Now, the first time we </span><span class="line" data-startTime="1544">go through this loop, </span><span class="line" data-startTime="1546">we ask the browser what is </span><span class="line" data-startTime="1546">the size of the green box? </span><span class="line" data-startTime="1548">And it goes oh, I </span><span class="line" data-startTime="1548">know the answer, </span><span class="line" data-startTime="1551">because I've just drawn it. </span> <span class="line" data-startTime="1552">Here's your answer. </span> <span class="line" data-startTime="1553">Easy peasy. </span> <span class="line" data-startTime="1554">And then we set the </span><span class="line" data-startTime="1554">width of the paragraph. </span> <span class="line" data-startTime="1556">But the next time we </span><span class="line" data-startTime="1556">come around the loop, </span><span class="line" data-startTime="1558">we ask the browser what's </span><span class="line" data-startTime="1558">the width of the green box? </span><span class="line" data-startTime="1560">And it's like hmm, </span><span class="line" data-startTime="1560">I used to know </span><span class="line" data-startTime="1562">the answer to that question, </span><span class="line" data-startTime="1562">but since then you've </span><span class="line" data-startTime="1564">been playing around </span><span class="line" data-startTime="1564">with styles on the page. </span> <span class="line" data-startTime="1566">So I need to go away and have a </span><span class="line" data-startTime="1566">think about what you've changed </span><span class="line" data-startTime="1569">and see if it affects the </span><span class="line" data-startTime="1569">width of the green block. </span> <span class="line" data-startTime="1573">And that's going to </span><span class="line" data-startTime="1573">happen on every loop. </span> <span class="line" data-startTime="1574">This is layout thrashing. </span> <span class="line" data-startTime="1576">This is interleaving </span><span class="line" data-startTime="1576">style reads and writes, </span><span class="line" data-startTime="1578">and it's a performance killer. </span></p>

<p><span class="line" data-startTime="1580">What we actually want to </span><span class="line" data-startTime="1580">do is just cache that, </span><span class="line" data-startTime="1582">do the reads first outside the </span><span class="line" data-startTime="1582">loop, get the green box width, </span><span class="line" data-startTime="1585">and then go through the loop. </span> <span class="line" data-startTime="1586">And the difference is </span><span class="line" data-startTime="1586">absolutely astounding. </span> <span class="line" data-startTime="1588">So recording that, changing </span><span class="line" data-startTime="1588">the width of the green box, </span><span class="line" data-startTime="1591">click the button, it </span><span class="line" data-startTime="1591">just happens instantly, </span><span class="line" data-startTime="1592">and it's a massive difference. </span> <span class="line" data-startTime="1594">And that was like </span><span class="line" data-startTime="1594">60 milliseconds </span><span class="line" data-startTime="1595">all in for everything, </span><span class="line" data-startTime="1595">versus over a second. </span> <span class="line" data-startTime="1599">So if you need to read something </span><span class="line" data-startTime="1599">that's style dependent, </span><span class="line" data-startTime="1602">do it before you start </span><span class="line" data-startTime="1602">making style changes. </span> <span class="line" data-startTime="1605">Am I out of time? </span><span class="line" data-startTime="1606">Am I done? </span><span class="line" data-startTime="1607">OK, but before we do that, we'll </span><span class="line" data-startTime="1607">have a look at the final scores </span><span class="line" data-startTime="1611">and see who managed </span><span class="line" data-startTime="1611">to win the Chromecast. </span> <span class="line" data-startTime="1614">If I can get my mouse </span><span class="line" data-startTime="1614">pointer over here. </span> <span class="line" data-startTime="1617">Right. </span> <span class="line" data-startTime="1620">A moment of tension. </span></p>

<p><span class="line" data-startTime="1622">Where's my mouse pointer? </span><span class="line" data-startTime="1624">Let's see if this works. </span> <span class="line" data-startTime="1630">OK. </span> <span class="line" data-startTime="1631">Oh, we've got a draw. </span> <span class="line" data-startTime="1634">That's how many? </span><span class="line" data-startTime="1635">We've got one Chromecast. </span> <span class="line" data-startTime="1637">We can get another one. </span> <span class="line" data-startTime="1638">That's excellent. </span> <span class="line" data-startTime="1638">And I do have a bonus round, </span><span class="line" data-startTime="1638">but we're definitely out time. </span> <span class="line" data-startTime="1641">Where are you two people? </span><span class="line" data-startTime="1644">Where are you? </span><span class="line" data-startTime="1646">Oh, one here, and there &mdash; </span><span class="line" data-startTime="1646">Oh, congratulations, guys. </span> <span class="line" data-startTime="1650">A round of applause </span><span class="line" data-startTime="1650">for these guys. </span> <span class="line" data-startTime="1656">And with that, I say </span><span class="line" data-startTime="1656">thank you very much, </span><span class="line" data-startTime="1658">and I'm going to make </span><span class="line" data-startTime="1658">way for someone else. </span> <span class="line" data-startTime="1660">Thank you very much, guys. </span> <span class="line" data-startTime="1661">Cheers. </span></p>

<p></p>