<style>* {font-family: "Open Sans", sans-serif}
a {color: #77aaff}
a.video {border-bottom: 1px solid #ddd; display: block; margin: 0 0 2em 0; padding: 0 0 2em 0}
h2 {color: #444; font-size: 18px;}
span.speakerName {color: black; font-weight: 900;}
body {padding: 2em}
p {color: #444; margin: 0; text-indent: 1.5em;}
p.speaker {margin: 1em 0 0 0; text-indent: 0;}
div#transcript > p:first-child {text-indent: 0;}
</style>

<h1>Edge Conference &mdash; Panel 3: Performance</h1>

<h2>Matt Delaney, Rowan Beenje, Pavel Feldman, Paul, Chris Lord, Pete</h2>

<a class="video" href="http://youtu.be/3-WYu_p5rdU">youtu.be/3-WYu_p5rdU</a><div id="transcript"><p class="speaker"><span class="line" data-starttime="5"><span class="speakerName">Matt Delaney</span>: Hi, everyone. </span> <span class="line" data-startTime="6">So to start off this performance </span><span class="line" data-startTime="6">talk, welcome to </span><span class="line" data-startTime="8">potentially the juiciest </span><span class="line" data-startTime="8">talk of the day. </span> <span class="line" data-startTime="10">You have people who are nice and </span><span class="line" data-startTime="10">hangry before lunch here. </span> <span class="line" data-startTime="13">So just to be clear, there were </span><span class="line" data-startTime="13">some kind of questions in </span><span class="line" data-startTime="18">our moderation tool for this </span><span class="line" data-startTime="18">panel that were kind of </span><span class="line" data-startTime="21">overlapping with some </span><span class="line" data-startTime="21">previous talks. </span> <span class="line" data-startTime="23">Because performance is </span><span class="line" data-startTime="23">everywhere, right? </span><span class="line" data-startTime="25">So if you look at some of the </span><span class="line" data-startTime="25">questions relating to strictly </span><span class="line" data-startTime="29">kind of network performance </span><span class="line" data-startTime="29">things, those are mostly </span><span class="line" data-startTime="32">covered in previous talks. </span> <span class="line" data-startTime="33">We'll mostly skip over those. </span> <span class="line" data-startTime="34">So now is your moment to put in </span><span class="line" data-startTime="34">any juicier questions for </span><span class="line" data-startTime="37">front end things, especially </span><span class="line" data-startTime="37">graphics, and all the kind of </span><span class="line" data-startTime="40">client side related performance </span><span class="line" data-startTime="42">concerns you guys have. </span> <span class="line" data-startTime="44">So very quickly, I'm going </span><span class="line" data-startTime="44">to run through. </span></p>

<p><span class="line" data-startTime="45">We've got our opening speaker </span><span class="line" data-startTime="45">here, Shane O'Sullivan. </span> <span class="line" data-startTime="49">So he's from Facebook, </span><span class="line" data-startTime="49">a UI engineer. </span> <span class="line" data-startTime="51">He'll introduce himself </span><span class="line" data-startTime="51">a little bit more. </span> <span class="line" data-startTime="53">We have Pavel Feldman </span><span class="line" data-startTime="53">from Google. </span> <span class="line" data-startTime="56">He has worked on Chrome </span><span class="line" data-startTime="56">dev tools. </span> <span class="line" data-startTime="59">And we have Rowan Beesje? </span></p>

<p class="speaker"><span class="line" data-starttime="62"><span class="speakerName">Rowan Beenje</span>: Beenje. </span></p>

<p class="speaker"><span class="line" data-starttime="63"><span class="speakerName">Matt Delaney</span>: OK. </span> <span class="line" data-startTime="64">Knew I was going to </span><span class="line" data-startTime="64">mess that one up. </span> <span class="line" data-startTime="65">So he works at FT Labs </span><span class="line" data-startTime="65">with Andrew, and is </span><span class="line" data-startTime="68">known for FT Scroller. </span> <span class="line" data-startTime="71">And then we have Chris Lord </span><span class="line" data-startTime="71">from Mozilla, who is a </span><span class="line" data-startTime="74">platform engineer for </span><span class="line" data-startTime="74">Firefox mobile, so </span><span class="line" data-startTime="79">primarily on Android. </span> <span class="line" data-startTime="81">So to start, Shane has a little </span><span class="line" data-startTime="81">opening talk for us to </span><span class="line" data-startTime="83">give us a bit of the </span><span class="line" data-startTime="83">lay of the land of </span><span class="line" data-startTime="85">performance at the moment. </span> <span class="line" data-startTime="95">SHANE O'SULLIVAN: </span><span class="line" data-startTime="95">So hi, everyone. </span> <span class="line" data-startTime="98">I'm Shane O'Sullivan. </span></p>

<p><span class="line" data-startTime="99">I work as a UI engineer </span><span class="line" data-startTime="99">at Facebook. </span> <span class="line" data-startTime="102">I spent a couple of years </span><span class="line" data-startTime="102">on the mobile site. </span> <span class="line" data-startTime="104">And now I work on our </span><span class="line" data-startTime="104">business interfaces. </span> <span class="line" data-startTime="107">As he said, I'm here with </span><span class="line" data-startTime="107">Ron, Chris, and Pavel. </span> <span class="line" data-startTime="111">And we're going to talk a bit </span><span class="line" data-startTime="111">about some of the potholes </span><span class="line" data-startTime="115">that are in the road to actually </span><span class="line" data-startTime="115">having a performant </span><span class="line" data-startTime="119">and fast and non-stuttery </span><span class="line" data-startTime="119">website. </span> <span class="line" data-startTime="124">The two main things I'm really </span><span class="line" data-startTime="124">going to talk about are </span><span class="line" data-startTime="126">scrolling performance of complex </span><span class="line" data-startTime="126">content, which is more </span><span class="line" data-startTime="133">or less a stress test </span><span class="line" data-startTime="133">for all rendering </span><span class="line" data-startTime="134">platforms, not just web. </span> <span class="line" data-startTime="136">People also have a problem </span><span class="line" data-startTime="136">with this on iOS. </span> <span class="line" data-startTime="138">God knows they have a problem </span><span class="line" data-startTime="138">with it on Android. </span> <span class="line" data-startTime="141">And it more or less </span><span class="line" data-startTime="141">forces us to solve </span><span class="line" data-startTime="143">all the other problems. </span></p>

<p><span class="line" data-startTime="144">And second one is memory </span><span class="line" data-startTime="144">management, </span><span class="line" data-startTime="146">which is quite related. </span> <span class="line" data-startTime="149">So to start off, let's </span><span class="line" data-startTime="149">say what the goal is. </span> <span class="line" data-startTime="150">The goal is 60 frames per </span><span class="line" data-startTime="150">second animation with no </span><span class="line" data-startTime="153">dropped frames. </span> <span class="line" data-startTime="155">This is kind of the panacea. </span> <span class="line" data-startTime="156">Everybody wants to get here. </span> <span class="line" data-startTime="160">But it's not always possible. </span> <span class="line" data-startTime="162">So let's have a fallback goal. </span> <span class="line" data-startTime="165">And say, if we can get to 30 </span><span class="line" data-startTime="165">frames per second animations. </span> <span class="line" data-startTime="169">Make this reliable. </span> <span class="line" data-startTime="170">Make it have no stuttering. </span> <span class="line" data-startTime="173">This often is achievable. </span> <span class="line" data-startTime="175">And in a lot of user tests that </span><span class="line" data-startTime="175">we've done, this tends to </span><span class="line" data-startTime="179">perform a lot better than having </span><span class="line" data-startTime="179">something that runs at </span><span class="line" data-startTime="181">60 frames per second some of the </span><span class="line" data-startTime="181">time, and even 40 frames </span><span class="line" data-startTime="185">per second some of the time. </span> <span class="line" data-startTime="186">So if it goes from some 60 down </span><span class="line" data-startTime="186">to 40, back up to 60, </span><span class="line" data-startTime="191">people often see that as being </span><span class="line" data-startTime="191">worse than just having a </span><span class="line" data-startTime="192">steady 30 frames per </span><span class="line" data-startTime="192">second animation. </span></p>

<p><span class="line" data-startTime="197">So nice to have 60. </span> <span class="line" data-startTime="199">If we can get a steady 30, </span><span class="line" data-startTime="199">you're generally in a fairly </span><span class="line" data-startTime="201">good place. </span> <span class="line" data-startTime="204">So what's stopping </span><span class="line" data-startTime="204">us getting there? </span><span class="line" data-startTime="205">There's a whole bunch </span><span class="line" data-startTime="205">of things. </span> <span class="line" data-startTime="207">To start of with is the </span><span class="line" data-startTime="207">large DOM size. </span> <span class="line" data-startTime="210">If you want to take something </span><span class="line" data-startTime="210">like Facebook newsfeed, you </span><span class="line" data-startTime="212">have variable height rows made </span><span class="line" data-startTime="212">up of large images, small </span><span class="line" data-startTime="216">images, no images, variable </span><span class="line" data-startTime="216">length text, everything </span><span class="line" data-startTime="219">changes size, and you don't </span><span class="line" data-startTime="219">know what size it is until </span><span class="line" data-startTime="222">you're trying to show </span><span class="line" data-startTime="222">it to somebody. </span> <span class="line" data-startTime="226">And also, if you have thousands </span><span class="line" data-startTime="226">of these, which you </span><span class="line" data-startTime="228">technically could, the browser </span><span class="line" data-startTime="228">just starts running into </span><span class="line" data-startTime="232">serious memory problems. </span> <span class="line" data-startTime="234">So you have to decide things. </span></p>

<p><span class="line" data-startTime="235">When do you create it? </span><span class="line" data-startTime="235">Do you create it up front </span><span class="line" data-startTime="235">and take an upfront hit? </span><span class="line" data-startTime="239">Do you create it lazily, and </span><span class="line" data-startTime="239">take a hit as people are using </span><span class="line" data-startTime="243">your application? </span><span class="line" data-startTime="245">That often depends on what </span><span class="line" data-startTime="245">you're trying to build. </span> <span class="line" data-startTime="247">For example, Gmail takes </span><span class="line" data-startTime="247">a hit up front. </span> <span class="line" data-startTime="249">Because they expect you to leave </span><span class="line" data-startTime="249">the tab open for weeks. </span> <span class="line" data-startTime="252">Facebook goes the other way, </span><span class="line" data-startTime="252">because it's more of a random </span><span class="line" data-startTime="255">browsing experience. </span> <span class="line" data-startTime="256">And they try to make the upfront </span><span class="line" data-startTime="256">hit very small, and </span><span class="line" data-startTime="260">render later. </span> <span class="line" data-startTime="265">OK. </span> <span class="line" data-startTime="265">So one of the main problems we </span><span class="line" data-startTime="265">have is, if you want to keep </span><span class="line" data-startTime="268">the DOM small, that basically </span><span class="line" data-startTime="268">means you've got to change it </span><span class="line" data-startTime="272">on the fly. </span> <span class="line" data-startTime="272">If you have a lot of data to </span><span class="line" data-startTime="272">show, and you don't want to </span><span class="line" data-startTime="274">have a big tree, you've got </span><span class="line" data-startTime="274">to change it on the fly. </span></p>

<p><span class="line" data-startTime="276">And that basically is great. </span> <span class="line" data-startTime="278">You've got a nice, small DOM. </span> <span class="line" data-startTime="280">But that introduces a whole </span><span class="line" data-startTime="280">bunch of other problems, which </span><span class="line" data-startTime="282">we're going to get into. </span> <span class="line" data-startTime="284">One solution people come up </span><span class="line" data-startTime="284">with is have a pool of </span><span class="line" data-startTime="286">reusable DOM elements. </span> <span class="line" data-startTime="288">Say you have 20 different </span><span class="line" data-startTime="288">types of </span><span class="line" data-startTime="290">rows you want to show. </span> <span class="line" data-startTime="291">Have a pool of each of </span><span class="line" data-startTime="291">them, and reuse them. </span> <span class="line" data-startTime="293">So that way you don't go from a </span><span class="line" data-startTime="293">small image to a big image, </span><span class="line" data-startTime="297">back to a small image. </span> <span class="line" data-startTime="298">Something with no images, </span><span class="line" data-startTime="298">something with text only. </span> <span class="line" data-startTime="302">So this can help. </span> <span class="line" data-startTime="304">But you still end up with </span><span class="line" data-startTime="304">kicking off page reflows if </span><span class="line" data-startTime="307">you're not careful. </span> <span class="line" data-startTime="311">Also, when you do start changing </span><span class="line" data-startTime="311">things, say you go </span><span class="line" data-startTime="315">from a small bit of text to a </span><span class="line" data-startTime="315">long bit of text, even inside </span><span class="line" data-startTime="318">of something that you haven't </span><span class="line" data-startTime="318">technically changed the </span><span class="line" data-startTime="319">structure of, you can change </span><span class="line" data-startTime="319">the height of it, you can </span><span class="line" data-startTime="321">change the width of it. </span></p>

<p><span class="line" data-startTime="323">And often, you need </span><span class="line" data-startTime="323">to know this. </span> <span class="line" data-startTime="324">If you haven't measured </span><span class="line" data-startTime="324">everything ahead of time, then </span><span class="line" data-startTime="327">you need to know how </span><span class="line" data-startTime="327">big something is. </span> <span class="line" data-startTime="329">For example, if you want to show </span><span class="line" data-startTime="329">somebody a scroll bar, </span><span class="line" data-startTime="331">they have to know </span><span class="line" data-startTime="331">what size it is. </span> <span class="line" data-startTime="334">But the main problem with this </span><span class="line" data-startTime="334">is that touching the </span><span class="line" data-startTime="337">DOM makes Ryan sad. </span> <span class="line" data-startTime="339">It makes him very, very sad. </span> <span class="line" data-startTime="341">And you don't want </span><span class="line" data-startTime="341">to make Ryan sad. </span> <span class="line" data-startTime="343">So measuring the size of a DOM </span><span class="line" data-startTime="343">load, it basically stops </span><span class="line" data-startTime="348">everything. </span></p>

<p><span class="line" data-startTime="349">Makes the browser flush all its </span><span class="line" data-startTime="349">pending operations, and </span><span class="line" data-startTime="353">slows everything down. </span> <span class="line" data-startTime="354">So what do we do? </span><span class="line" data-startTime="356">We'd like to keep it </span><span class="line" data-startTime="356">off the UI thread. </span> <span class="line" data-startTime="358">This is possible in native. </span> <span class="line" data-startTime="360">For example, the Facebook for </span><span class="line" data-startTime="360">iOS app has a completely </span><span class="line" data-startTime="362">separate thread that more or </span><span class="line" data-startTime="362">less does everything the UI </span><span class="line" data-startTime="364">thread does, but does it </span><span class="line" data-startTime="364">off the UI thread. </span> <span class="line" data-startTime="367">Measures everything, renders </span><span class="line" data-startTime="367">everything, and then just </span><span class="line" data-startTime="368">passes it over. </span> <span class="line" data-startTime="369">That would be lovely. </span></p>

<p><span class="line" data-startTime="370">We can't do that. </span> <span class="line" data-startTime="372">One reason is we don't </span><span class="line" data-startTime="372">always have workers </span><span class="line" data-startTime="375">on the latest iOS. </span> <span class="line" data-startTime="376">We do on Android. </span> <span class="line" data-startTime="379">But we don't always. </span> <span class="line" data-startTime="380">Also workers on a single </span><span class="line" data-startTime="380">CPU are slow. </span> <span class="line" data-startTime="382">If you're trying to run a worker </span><span class="line" data-startTime="382">on iPhone 4, which only </span><span class="line" data-startTime="385">has a single core, you're not </span><span class="line" data-startTime="385">really getting any gain. </span> <span class="line" data-startTime="388">I mean yes, it's different </span><span class="line" data-startTime="388">thread. </span> <span class="line" data-startTime="390">But it runs on the same CPU. </span> <span class="line" data-startTime="392">And anyway, workers </span><span class="line" data-startTime="392">can't be DOM. </span> <span class="line" data-startTime="394">So this doesn't really </span><span class="line" data-startTime="394">help you. </span> <span class="line" data-startTime="398">So what can we do? </span><span class="line" data-startTime="400">Hide the scroll bar. </span> <span class="line" data-startTime="401">Don't tell people how </span><span class="line" data-startTime="401">much stuff's there. </span> <span class="line" data-startTime="402">It's a dirty hack, </span><span class="line" data-startTime="402">but it works. </span> <span class="line" data-startTime="406">You don't have to measure a </span><span class="line" data-startTime="406">thousand rows, because just </span><span class="line" data-startTime="409">don't tell them. </span> <span class="line" data-startTime="409">Just tell them keep scrolling. </span> <span class="line" data-startTime="411">But some people like </span><span class="line" data-startTime="411">scroll bars. </span></p>

<p><span class="line" data-startTime="413">So another thing you can do </span><span class="line" data-startTime="413">is measure when not busy. </span> <span class="line" data-startTime="416">This can be fairly tricky. </span> <span class="line" data-startTime="417">Because when are you not busy? </span><span class="line" data-startTime="419">You're not touching it now. </span> <span class="line" data-startTime="420">What if you start measuring, </span><span class="line" data-startTime="420">you say, I'm going to spend </span><span class="line" data-startTime="423">100 milliseconds measuring </span><span class="line" data-startTime="423">the next X things. </span> <span class="line" data-startTime="426">Then in the middle of that 100 </span><span class="line" data-startTime="426">milliseconds, someone touches </span><span class="line" data-startTime="428">a page and you miss it because </span><span class="line" data-startTime="428">your JavaScript is running. </span> <span class="line" data-startTime="432">You can try and measure in the </span><span class="line" data-startTime="432">middle of a frame, which we've </span><span class="line" data-startTime="435">done before, where we figured, </span><span class="line" data-startTime="435">I spent five milliseconds out </span><span class="line" data-startTime="438">of the 16 or 32 millisecond </span><span class="line" data-startTime="438">frame. </span> <span class="line" data-startTime="441">And I'm going to use the </span><span class="line" data-startTime="441">rest to render ahead. </span> <span class="line" data-startTime="444">That can work. </span></p>

<p><span class="line" data-startTime="445">But it's really tricky to do. </span> <span class="line" data-startTime="447">Something that we're starting to </span><span class="line" data-startTime="447">play with now a bit as well </span><span class="line" data-startTime="449">is measuring on the server, </span><span class="line" data-startTime="449">which is just something we're </span><span class="line" data-startTime="453">only prototyping </span><span class="line" data-startTime="453">at the moment. </span> <span class="line" data-startTime="454">But we figure in our use case, </span><span class="line" data-startTime="454">we have at max a few thousand </span><span class="line" data-startTime="457">different ways to arrange all </span><span class="line" data-startTime="457">the individual types of things </span><span class="line" data-startTime="462">on the newsfeed. </span> <span class="line" data-startTime="463">And if you have an app like </span><span class="line" data-startTime="463">that, then you can technically </span><span class="line" data-startTime="465">the DOM ahead of time. </span> <span class="line" data-startTime="466">Figure out what you fit into. </span> <span class="line" data-startTime="467">And just never measure </span><span class="line" data-startTime="467">the DOM at all. </span> <span class="line" data-startTime="471">I'm hopeful this might help. </span> <span class="line" data-startTime="472">But it doesn't fit </span><span class="line" data-startTime="472">every use case. </span></p>

<p><span class="line" data-startTime="475">But if it does, then measure </span><span class="line" data-startTime="475">things once, and then never </span><span class="line" data-startTime="478">measure them again. </span> <span class="line" data-startTime="482">Another annoying thing </span><span class="line" data-startTime="482">is repaints. </span> <span class="line" data-startTime="485">Most of this comes in because </span><span class="line" data-startTime="485">images are unpredictable. </span> <span class="line" data-startTime="488">They load when you don't want </span><span class="line" data-startTime="488">them to load, like when you're </span><span class="line" data-startTime="490">in the middle of an animation. </span> <span class="line" data-startTime="492">They load the wrong size, so </span><span class="line" data-startTime="492">you end up clipping them, </span><span class="line" data-startTime="494">which has its own cost. </span> <span class="line" data-startTime="495">Or you end up resizing them, </span><span class="line" data-startTime="495">and it has a massive cost, </span><span class="line" data-startTime="498">which some of the people were </span><span class="line" data-startTime="498">talking about earlier. </span> <span class="line" data-startTime="499">Not just network costs, but </span><span class="line" data-startTime="499">obviously performance cost. </span> <span class="line" data-startTime="502">And finally, they have </span><span class="line" data-startTime="502">to be decoded. </span> <span class="line" data-startTime="504">As we just heard, WebP takes </span><span class="line" data-startTime="504">longer to decode than JPEG, </span><span class="line" data-startTime="507">and JPEG is bad enough </span><span class="line" data-startTime="507">as it is. </span></p>

<p><span class="line" data-startTime="509">So if you're decoding things in </span><span class="line" data-startTime="509">the middle of an animation, </span><span class="line" data-startTime="511">then you're going to </span><span class="line" data-startTime="511">have a bad time. </span> <span class="line" data-startTime="515">So what do you do? </span><span class="line" data-startTime="516">Some people defer all </span><span class="line" data-startTime="516">image loading until </span><span class="line" data-startTime="518">you finish an animation. </span> <span class="line" data-startTime="520">This is for new images. </span> <span class="line" data-startTime="521">That can work. </span> <span class="line" data-startTime="522">But it looks bad. </span> <span class="line" data-startTime="524">You have a big, empty thing </span><span class="line" data-startTime="524">scrolling by with a little bit </span><span class="line" data-startTime="527">of black text and a </span><span class="line" data-startTime="527">couple of links. </span> <span class="line" data-startTime="528">And when you stop, everything </span><span class="line" data-startTime="528">pops in. </span> <span class="line" data-startTime="530">It works. </span> <span class="line" data-startTime="531">You get nice animation. </span> <span class="line" data-startTime="532">And as a start, it's good. </span> <span class="line" data-startTime="535">Other people use low res images, </span><span class="line" data-startTime="535">which have a lower </span><span class="line" data-startTime="537">decode cost. </span> <span class="line" data-startTime="538">But it still costs paint. </span></p>

<p><span class="line" data-startTime="542">And what we're doing now, or </span><span class="line" data-startTime="542">trying to do, is figure out </span><span class="line" data-startTime="546">how much time each particular </span><span class="line" data-startTime="546">operation, including text </span><span class="line" data-startTime="548">changes and image changes, </span><span class="line" data-startTime="548">take per animation frame. </span> <span class="line" data-startTime="552">And we figure we have a 16 </span><span class="line" data-startTime="552">millisecond animation frame. </span> <span class="line" data-startTime="555">We have used 10 milliseconds. </span> <span class="line" data-startTime="557">It normally takes 6 </span><span class="line" data-startTime="557">milliseconds to </span><span class="line" data-startTime="559">draw a small image. </span> <span class="line" data-startTime="560">So we still have time. </span> <span class="line" data-startTime="562">And if we don't, then </span><span class="line" data-startTime="562">we defer it. </span> <span class="line" data-startTime="563">And you do get a blank image. </span> <span class="line" data-startTime="564">And that gives you the nice </span><span class="line" data-startTime="564">effect of, sometimes you'll </span><span class="line" data-startTime="567">see images scrolling past or </span><span class="line" data-startTime="567">images popping in in the </span><span class="line" data-startTime="570">middle of a scroll. </span> <span class="line" data-startTime="570">Sometimes, you don't get to </span><span class="line" data-startTime="570">it, but it tends to look </span><span class="line" data-startTime="574">better than the first one. </span> <span class="line" data-startTime="576">That's very hard. </span></p>

<p><span class="line" data-startTime="576">You've got to write </span><span class="line" data-startTime="576">that yourself. </span> <span class="line" data-startTime="578">You've got to write </span><span class="line" data-startTime="578">it in JavaScript. </span> <span class="line" data-startTime="580">Would be nice if browsers did </span><span class="line" data-startTime="580">these things for you. </span> <span class="line" data-startTime="582">But hopefully, we might get </span><span class="line" data-startTime="582">there at some point. </span> <span class="line" data-startTime="585">And another one is resizing. </span> <span class="line" data-startTime="587">A lot of people think that </span><span class="line" data-startTime="587">resizing images, like just </span><span class="line" data-startTime="589">don't resize. </span> <span class="line" data-startTime="590">Don't do it, just clip them. </span> <span class="line" data-startTime="592">Often, you can't, as people were </span><span class="line" data-startTime="592">talking about earlier. </span> <span class="line" data-startTime="595">Like Jackson was mentioning </span><span class="line" data-startTime="595">at Facebook, we have four </span><span class="line" data-startTime="597">different sizes of images </span><span class="line" data-startTime="597">that we use. </span> <span class="line" data-startTime="598">And if you clip them too much, </span><span class="line" data-startTime="598">then it just looks terrible. </span> <span class="line" data-startTime="600">You cut off people's heads, </span><span class="line" data-startTime="600">and that kind of thing. </span> <span class="line" data-startTime="603">And saying OK, just ship </span><span class="line" data-startTime="603">the right size. </span> <span class="line" data-startTime="607">Shipping the right </span><span class="line" data-startTime="607">size is hard. </span></p>

<p><span class="line" data-startTime="608">You've got massive </span><span class="line" data-startTime="608">server costs. </span> <span class="line" data-startTime="610">It helps you to be a large </span><span class="line" data-startTime="610">corporation, where you can </span><span class="line" data-startTime="614">tell like Akamai, we really, </span><span class="line" data-startTime="614">really need a solution here. </span> <span class="line" data-startTime="618">And they will help you. </span> <span class="line" data-startTime="619">If you're not a large </span><span class="line" data-startTime="619">corporation, </span><span class="line" data-startTime="620">you can't do that. </span> <span class="line" data-startTime="622">It's very hard to say that if </span><span class="line" data-startTime="622">say I want a 57 by 57 pixel </span><span class="line" data-startTime="626">image, you must serve </span><span class="line" data-startTime="626">it to me. </span> <span class="line" data-startTime="629">So one thing you can do is get </span><span class="line" data-startTime="629">designers to calm down a </span><span class="line" data-startTime="631">little bit. </span> <span class="line" data-startTime="633">And just tell them, don't try </span><span class="line" data-startTime="633">loading images in subtly </span><span class="line" data-startTime="636">different pixel sizes. </span></p>

<p><span class="line" data-startTime="638">Do you really need a 50 </span><span class="line" data-startTime="638">and a 52 pixel image? </span><span class="line" data-startTime="641">Maybe you don't. </span> <span class="line" data-startTime="643">Then just have a single 50 pixel </span><span class="line" data-startTime="643">image and you're done. </span> <span class="line" data-startTime="647">Designers like to have a free </span><span class="line" data-startTime="647">hand in everything. </span> <span class="line" data-startTime="649">But reality has to come into </span><span class="line" data-startTime="649">play at some point. </span> <span class="line" data-startTime="654">So one of the final things </span><span class="line" data-startTime="654">is decoding JPEGs. </span> <span class="line" data-startTime="657">A lot of people don't </span><span class="line" data-startTime="657">think about this. </span> <span class="line" data-startTime="659">A lot of people, they look at </span><span class="line" data-startTime="659">the timeline on Chrome. </span> <span class="line" data-startTime="663">And you see a lot of paints </span><span class="line" data-startTime="663">and that kind of thing. </span> <span class="line" data-startTime="665">But decoding JPEGs can be a very </span><span class="line" data-startTime="665">large hit, almost as much </span><span class="line" data-startTime="668">as painting sometimes. </span> <span class="line" data-startTime="670">One thing we're playing </span><span class="line" data-startTime="670">with is doing </span><span class="line" data-startTime="672">it in a worker thread. </span> <span class="line" data-startTime="673">Doing XHR to the server, get </span><span class="line" data-startTime="673">down the data for a JPEG. </span></p>

<p><span class="line" data-startTime="676">Decode it in JavaScript on a </span><span class="line" data-startTime="676">worker thread, ship the data </span><span class="line" data-startTime="679">UI off to the image </span><span class="line" data-startTime="679">on the UI thread. </span> <span class="line" data-startTime="681">And then you're only paying </span><span class="line" data-startTime="681">for the paint. </span> <span class="line" data-startTime="683">In some cases, that works. </span> <span class="line" data-startTime="684">In some cases, it doesn't. </span> <span class="line" data-startTime="685">We've only rolled out a test. </span> <span class="line" data-startTime="686">But for large images, </span><span class="line" data-startTime="686">it seems to work. </span> <span class="line" data-startTime="689">For small images, it doesn't. </span> <span class="line" data-startTime="690">It's horrible. </span> <span class="line" data-startTime="691">And I wish we could have off </span><span class="line" data-startTime="691">thread JPEG decoding. </span> <span class="line" data-startTime="693">But such as it is, it still </span><span class="line" data-startTime="693">slows down our scrolling. </span> <span class="line" data-startTime="698">Alex looks thoughtful. </span> <span class="line" data-startTime="703">Obviously, there are other </span><span class="line" data-startTime="703">good solutions to this. </span> <span class="line" data-startTime="704">But hopefully, the guys will </span><span class="line" data-startTime="704">know some of them. </span></p>

<p><span class="line" data-startTime="706">And the last one that we're </span><span class="line" data-startTime="706">probably going to end up </span><span class="line" data-startTime="709">mentioning is GC, which </span><span class="line" data-startTime="709">everybody knows stands for </span><span class="line" data-startTime="713">Gremlin Carnage. </span> <span class="line" data-startTime="716">OK, it really stands for </span><span class="line" data-startTime="716">garbage collection. </span> <span class="line" data-startTime="717">But it might as well stand </span><span class="line" data-startTime="717">for Gremlin Carnage. </span> <span class="line" data-startTime="719">Because it's just this random </span><span class="line" data-startTime="719">little monster that runs </span><span class="line" data-startTime="721">around, and makes </span><span class="line" data-startTime="721">you very sad. </span> <span class="line" data-startTime="724">Unless when he looks really </span><span class="line" data-startTime="724">cute like that, and then </span><span class="line" data-startTime="726">everything's good. </span> <span class="line" data-startTime="727">So with garbage collection, you </span><span class="line" data-startTime="727">put all this effort into </span><span class="line" data-startTime="731">having a fantastically good, </span><span class="line" data-startTime="731">smooth animation. </span> <span class="line" data-startTime="735">And then something random comes </span><span class="line" data-startTime="735">in and takes up 100 </span><span class="line" data-startTime="737">milliseconds and kills </span><span class="line" data-startTime="737">everything. </span> <span class="line" data-startTime="739">V8 has, in the last </span><span class="line" data-startTime="739">year or so &mdash; </span><span class="line" data-startTime="741">year, 18 months &mdash; come up with </span><span class="line" data-startTime="741">incremental GC, which spreads </span><span class="line" data-startTime="745">the load a bit. </span></p>

<p><span class="line" data-startTime="745">But you still get hit by these </span><span class="line" data-startTime="745">large mark sweep things that </span><span class="line" data-startTime="748">can still take a large </span><span class="line" data-startTime="748">amount of time. </span> <span class="line" data-startTime="751">One thing you can do is just </span><span class="line" data-startTime="751">go through your whole code, </span><span class="line" data-startTime="753">and micro-optimize absolutely </span><span class="line" data-startTime="753">every tiny little piece to not </span><span class="line" data-startTime="756">use memory, to reuse events, to </span><span class="line" data-startTime="756">reuse all sorts of things. </span> <span class="line" data-startTime="760">It's painstaking. </span> <span class="line" data-startTime="760">It takes forever. </span> <span class="line" data-startTime="762">And I don't know of </span><span class="line" data-startTime="762">a silver bullet. </span> <span class="line" data-startTime="764">But we will be discussing this, </span><span class="line" data-startTime="764">and hopefully somebody </span><span class="line" data-startTime="768">has a silver bullet, </span><span class="line" data-startTime="768">because I want one. </span> <span class="line" data-startTime="771">All right. </span> <span class="line" data-startTime="772">And with that, let's get </span><span class="line" data-startTime="772">on with the questions. </span></p>

<p class="speaker"><span class="line" data-starttime="774"><span class="speakerName">Matt Delaney</span>: Thanks, Shane. </span><span class="line" data-startTime="782">So I'm not sure exactly where, </span><span class="line" data-startTime="782">but somewhere out there </span><span class="line" data-startTime="785">there's another mic. </span><span class="line" data-startTime="785">So just keep in mind for this </span><span class="line" data-startTime="785">panel, we have a roving mic </span><span class="line" data-startTime="788">that will magically appear </span><span class="line" data-startTime="788">as you need it. </span><span class="line" data-startTime="790">So we're hoping for even more </span><span class="line" data-startTime="790">people talking in this talk </span><span class="line" data-startTime="794">from the audience, because </span><span class="line" data-startTime="794">everyone deals with </span><span class="line" data-startTime="795">performance. </span><span class="line" data-startTime="797">OK. </span><span class="line" data-startTime="797">So the first question here. </span><span class="line" data-startTime="804">So from our very own Andrew </span><span class="line" data-startTime="804">Betts, we have the first </span><span class="line" data-startTime="807">question which is, with longer </span><span class="line" data-startTime="807">and longer lived pages, will </span><span class="line" data-startTime="810">web developers start having </span><span class="line" data-startTime="810">to spend time on memory </span><span class="line" data-startTime="813">management? </span><span class="line" data-startTime="813">And is that a good thing? </span><span class="line" data-startTime="815">And I'd like to start off Rowan </span><span class="line" data-startTime="815">with this question. </span></p>

<p class="speaker"><span class="line" data-starttime="818"><span class="speakerName">Rowan Beenje</span>: Well, I </span><span class="line" data-startTime="818">think Shane, you've </span><span class="line" data-startTime="820">covered some of it there. </span><span class="line" data-startTime="823">I think Shane did cover </span><span class="line" data-startTime="823">some of it there. </span><span class="line" data-startTime="824">We are going to have to worry </span><span class="line" data-startTime="824">a lot more about memory, </span><span class="line" data-startTime="827">especially on memory constraint </span><span class="line" data-startTime="828">stuff like mobile devices. </span><span class="line" data-startTime="830">And the tooling has </span><span class="line" data-startTime="830">got better. </span><span class="line" data-startTime="834">Garbage collection </span><span class="line" data-startTime="834">has got better. </span><span class="line" data-startTime="837">I don't know how much &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="838"><span class="speakerName">Audience</span>: You had the </span><span class="line" data-startTime="838">mic [INAUDIBLE]. </span></p>

<p class="speaker"><span class="line" data-starttime="840"><span class="speakerName">Rowan Beenje</span>: I don't know how </span><span class="line" data-startTime="840">much everyone knows about &mdash; </span><span class="line" data-startTime="845">I don't know how much everyone </span><span class="line" data-startTime="845">knows about the current memory </span><span class="line" data-startTime="848">implementations. </span><span class="line" data-startTime="848">But it's no longer retain </span><span class="line" data-startTime="848">release stuff. </span><span class="line" data-startTime="850">It's all very nice. </span><span class="line" data-startTime="853">Is anything still attached </span><span class="line" data-startTime="853">to the documents? </span><span class="line" data-startTime="855">So no longer cycles </span><span class="line" data-startTime="855">to worry about. </span><span class="line" data-startTime="858">But you do still have to keep </span><span class="line" data-startTime="858">very careful track of objects, </span><span class="line" data-startTime="862">and make sure you don't have </span><span class="line" data-startTime="862">to attach DOM trees. </span><span class="line" data-startTime="864">Massive memory loss there. </span><span class="line" data-startTime="866">And Chrome tools have got </span><span class="line" data-startTime="866">a lot better in this. </span><span class="line" data-startTime="869">You can do heap snapshots. </span><span class="line" data-startTime="870">You can dip your </span><span class="line" data-startTime="870">heap snapshots. </span><span class="line" data-startTime="871">You can work out where you're </span><span class="line" data-startTime="871">leaking objects in your </span><span class="line" data-startTime="877">application life cycle. </span><span class="line" data-startTime="878">But we are going to have to </span><span class="line" data-startTime="878">worry about a lot more. </span><span class="line" data-startTime="880">As Shane said, reuse isn't </span><span class="line" data-startTime="880">silver bullet. </span><span class="line" data-startTime="883">But it's what we have to work </span><span class="line" data-startTime="883">with for the time being. </span></p>

<p class="speaker"><span class="line" data-starttime="888"><span class="speakerName">Matt Delaney</span>: Anyone else? </span></p>

<p class="speaker"><span class="line" data-starttime="890"><span class="speakerName">Pavel Feldman</span>: It's a bad thing </span><span class="line" data-startTime="890">that we need to care </span><span class="line" data-startTime="892">about memory. </span> <span class="line" data-startTime="892">But it's inevitable. </span> <span class="line" data-startTime="894">We'll need to take </span><span class="line" data-startTime="894">care of memory. </span> <span class="line" data-startTime="896">And we need to make it a </span><span class="line" data-startTime="896">standard part of our </span><span class="line" data-startTime="899">development practice. </span> <span class="line" data-startTime="901">And not only we should care </span><span class="line" data-startTime="901">about the present state, but </span><span class="line" data-startTime="903">about the regressions as well. </span> <span class="line" data-startTime="906">Because you don't want to fix </span><span class="line" data-startTime="906">everything, and then lose it </span><span class="line" data-startTime="908">all with some regression bug. </span> <span class="line" data-startTime="910">And on the tools front, we are </span><span class="line" data-startTime="910">working on exposing better and </span><span class="line" data-startTime="914">better pictures. </span> <span class="line" data-startTime="914">We're currently working on </span><span class="line" data-startTime="914">native memory instrumentation, </span><span class="line" data-startTime="918">so that you saw how much DOM and </span><span class="line" data-startTime="918">strings and resources and </span><span class="line" data-startTime="922">images and decoded images </span><span class="line" data-startTime="922">are taking. </span> <span class="line" data-startTime="924">But what we can see is </span><span class="line" data-startTime="924">that apps [? model ?] </span><span class="line" data-startTime="927">is most likely a source of the </span><span class="line" data-startTime="927">memory leak and involved with </span><span class="line" data-startTime="932">memory growth. </span></p>

<p><span class="line" data-startTime="932">So you should be using heap </span><span class="line" data-startTime="932">profiler for that. </span> <span class="line" data-startTime="936">And yes, it's complex. </span> <span class="line" data-startTime="937">And yes, heap profiling and </span><span class="line" data-startTime="937">memory leak hunting is kind of </span><span class="line" data-startTime="942">a last resort. </span> <span class="line" data-startTime="943">You don't want to do that. </span> <span class="line" data-startTime="944">But you end up doing it. </span> <span class="line" data-startTime="946">And you end up doing it not </span><span class="line" data-startTime="946">only for web, but in any </span><span class="line" data-startTime="950">development platform. </span> <span class="line" data-startTime="951">So just make it a standard </span><span class="line" data-startTime="951">practice. </span> <span class="line" data-startTime="958">SHANE O'SULLIVAN: One thing that </span><span class="line" data-startTime="958">we've run into is that </span><span class="line" data-startTime="960">often, you know when your app </span><span class="line" data-startTime="960">is not doing anything. </span> <span class="line" data-startTime="963">And you know that, for example, </span><span class="line" data-startTime="963">right after someone </span><span class="line" data-startTime="966">finishes scrolling, they're </span><span class="line" data-startTime="966">going to stop and read </span><span class="line" data-startTime="967">something for at least 100 </span><span class="line" data-startTime="967">milliseconds before they start </span><span class="line" data-startTime="970">doing interactions again. </span> <span class="line" data-startTime="972">And one of the things that would </span><span class="line" data-startTime="972">be fantastic is if you </span><span class="line" data-startTime="974">could just say, I know my app </span><span class="line" data-startTime="974">state Now clean it up. </span></p>

<p><span class="line" data-startTime="978">But don't do it in two </span><span class="line" data-startTime="978">seconds time when </span><span class="line" data-startTime="980">they're scrolling again. </span> <span class="line" data-startTime="982">Clean up now. </span> <span class="line" data-startTime="982">And I know this has been </span><span class="line" data-startTime="982">brought up before, too. </span> <span class="line" data-startTime="984">Everybody who ever built a </span><span class="line" data-startTime="984">garbage collector, and they </span><span class="line" data-startTime="988">always say, it's always best </span><span class="line" data-startTime="988">guess, or maybe that isn't the </span><span class="line" data-startTime="992">best time to do it, and all </span><span class="line" data-startTime="992">that kind of stuff. </span> <span class="line" data-startTime="995">But being someone who doesn't </span><span class="line" data-startTime="995">actually know how the </span><span class="line" data-startTime="997">internals work, why is that? </span></p>

<p class="speaker"><span class="line" data-starttime="1001"><span class="speakerName">Pavel Feldman</span>: I'm not </span><span class="line" data-startTime="1001">commenting on the GC, </span><span class="line" data-startTime="1003">controlling GC questions. </span><span class="line" data-startTime="1005">It's a tough area. </span><span class="line" data-startTime="1006">And you should be really </span><span class="line" data-startTime="1006">talking to the </span><span class="line" data-startTime="1009">virtual machine engineers. </span><span class="line" data-startTime="1011">And they have the </span><span class="line" data-startTime="1011">official story. </span><span class="line" data-startTime="1013">Paul, what is our </span><span class="line" data-startTime="1013">official story? </span></p>

<p class="speaker"><span class="line" data-starttime="1016"><span class="speakerName">Paul</span>: I have no idea. </span></p>

<p class="speaker"><span class="line" data-starttime="1018"><span class="speakerName">Pavel Feldman</span>: So the answer </span><span class="line" data-startTime="1018">that you get from the </span><span class="line" data-startTime="1021">[? vendors ?] is always, we are </span><span class="line" data-startTime="1021">going to do best for you. </span><span class="line" data-startTime="1025">You don't want to control it. </span><span class="line" data-startTime="1027">Or otherwise, you will </span><span class="line" data-startTime="1027">lead us into trouble. </span><span class="line" data-startTime="1029">But you really need to go into </span><span class="line" data-startTime="1029">the details, and talk to the </span><span class="line" data-startTime="1032">actual engineers. </span><span class="line" data-startTime="1034">SHANE O'SULLIVAN: Do we have </span><span class="line" data-startTime="1034">any of them in the room? </span></p>

<p class="speaker"><span class="line" data-starttime="1042"><span class="speakerName">Matt Delaney</span>: This relates </span><span class="line" data-startTime="1042">directly to the </span><span class="line" data-startTime="1043">next question, it's &mdash; </span><span class="line" data-startTime="1044">SHANE O'SULLIVAN: Or a dozen of </span><span class="line" data-startTime="1044">next questions like that. </span></p>

<p class="speaker"><span class="line" data-starttime="1046"><span class="speakerName">Matt Delaney</span>: What's that? </span><span class="line" data-startTime="1046">SHANE O'SULLIVAN: Or a dozen </span><span class="line" data-startTime="1046">of next questions on this. </span></p>

<p class="speaker"><span class="line" data-starttime="1049"><span class="speakerName">Matt Delaney</span>: Right. </span> <span class="line" data-startTime="1050">So this is kind of an </span><span class="line" data-startTime="1050">interesting thing from a </span><span class="line" data-startTime="1052">standpoint of perhaps getting </span><span class="line" data-startTime="1052">the answer from them. </span> <span class="line" data-startTime="1056">But the next person asks, which </span><span class="line" data-startTime="1056">is Shapir from Israel, </span><span class="line" data-startTime="1060">is, should JavaScript be allowed </span><span class="line" data-startTime="1060">to explicitly trigger </span><span class="line" data-startTime="1063">garbage collection when you </span><span class="line" data-startTime="1063">the app is idling, say? </span><span class="line" data-startTime="1065">Or if the app knows when </span><span class="line" data-startTime="1065">it's OK to do so? </span><span class="line" data-startTime="1068">Or should it be allowed to </span><span class="line" data-startTime="1068">prevent GC when actually </span><span class="line" data-startTime="1071">performing time critical </span><span class="line" data-startTime="1071">operations? </span><span class="line" data-startTime="1073">So this is currently something </span><span class="line" data-startTime="1073">that people don't really have </span><span class="line" data-startTime="1075">control over. </span> <span class="line" data-startTime="1075">But, hear your take on it. </span></p>

<p class="speaker"><span class="line" data-starttime="1080"><span class="speakerName">Rowan Beenje</span>: I think the only </span><span class="line" data-startTime="1080">other thing to bear in mind is </span><span class="line" data-startTime="1082">that there are occasions when </span><span class="line" data-startTime="1082">the browser is going to have </span><span class="line" data-startTime="1085">to garbage collect if it's </span><span class="line" data-startTime="1085">running out of memory. </span><span class="line" data-startTime="1087">So there's always going </span><span class="line" data-startTime="1087">to be points where you </span><span class="line" data-startTime="1088">can't control it. </span><span class="line" data-startTime="1089">But perhaps we could hint, </span><span class="line" data-startTime="1089">I'd like the next 16 </span><span class="line" data-startTime="1092">milliseconds, perhaps. </span><span class="line" data-startTime="1093">Please don't garbage collect </span><span class="line" data-startTime="1093">during that time. </span></p>

<p class="speaker"><span class="line" data-starttime="1095"><span class="speakerName">Audience</span>: So do you see </span><span class="line" data-startTime="1095">observability as a </span><span class="line" data-startTime="1099">major issue at TC39? </span><span class="line" data-startTime="1100">So one of the things that I </span><span class="line" data-startTime="1100">wind up doing is one of </span><span class="line" data-startTime="1103">Google's representatives to </span><span class="line" data-startTime="1103">the standards body for </span><span class="line" data-startTime="1105">JavaScript. </span> <span class="line" data-startTime="1106">And so being able to know </span><span class="line" data-startTime="1106">exactly when garbage </span><span class="line" data-startTime="1110">collection happens has </span><span class="line" data-startTime="1110">potentially very serious side </span><span class="line" data-startTime="1114">effects for cross-document and </span><span class="line" data-startTime="1114">cross-origin communication, </span><span class="line" data-startTime="1118">which are not friendly. </span> <span class="line" data-startTime="1119">There's also the concern that </span><span class="line" data-startTime="1119">exposing GC will bake into the </span><span class="line" data-startTime="1125">web heuristics which are likely </span><span class="line" data-startTime="1125">to be proven wrong </span><span class="line" data-startTime="1129">anytime now. </span> <span class="line" data-startTime="1129">So in the history of V8, we've </span><span class="line" data-startTime="1129">gone from having a </span><span class="line" data-startTime="1134">generational GC to having </span><span class="line" data-startTime="1134">many, many, many other </span><span class="line" data-startTime="1138">variance of generational GC. </span> <span class="line" data-startTime="1140">And if you bake in invariants </span><span class="line" data-startTime="1140">in your code based on V8, </span><span class="line" data-startTime="1144">they'll be wrong under Nitro. </span></p>

<p><span class="line" data-startTime="1147">And they'll be wrong under </span><span class="line" data-startTime="1147">IonMonkey, or whatever the </span><span class="line" data-startTime="1150">next thing is out of </span><span class="line" data-startTime="1150">the next vendor. </span> <span class="line" data-startTime="1153">And so the optimizations you'll </span><span class="line" data-startTime="1153">employ are likely to </span><span class="line" data-startTime="1155">get you into a place where not </span><span class="line" data-startTime="1155">only will you be wrong in the </span><span class="line" data-startTime="1157">future version of the VM that </span><span class="line" data-startTime="1157">you're currently attempting to </span><span class="line" data-startTime="1160">tickle in the right way, you'll </span><span class="line" data-startTime="1160">certainly be wrong on </span><span class="line" data-startTime="1163">the other VMs, too. </span> <span class="line" data-startTime="1164">So it's a nasty place to </span><span class="line" data-startTime="1164">end your code base up. </span></p>

<p class="speaker"><span class="line" data-starttime="1174"><span class="speakerName">Chris Lord</span>: I don't have </span><span class="line" data-startTime="1174">anything to add to that. </span></p>

<p class="speaker"><span class="line" data-starttime="1176"><span class="speakerName">Matt Delaney</span>: Have you guys run </span><span class="line" data-startTime="1176">into any situations where </span><span class="line" data-startTime="1178">you felt like it would be a much </span><span class="line" data-startTime="1178">better thing to be able </span><span class="line" data-startTime="1179">have control over these? </span><span class="line" data-startTime="1181">Because in a lot of native </span><span class="line" data-startTime="1181">platforms, you have, of </span><span class="line" data-startTime="1183">course, different controls over </span><span class="line" data-startTime="1183">the VMs, like say in JVM </span><span class="line" data-startTime="1186">and whatnot. </span> <span class="line" data-startTime="1187">Are there any other times in </span><span class="line" data-startTime="1187">your experience where you've </span><span class="line" data-startTime="1189">dealt with wanting something </span><span class="line" data-startTime="1189">like this? </span><span class="line" data-startTime="1195">SHANE O'SULLIVAN: Yeah. </span> <span class="line" data-startTime="1196">It's more from an extremely </span><span class="line" data-startTime="1196">high level, rather than be </span><span class="line" data-startTime="1199">able to observe specific things, </span><span class="line" data-startTime="1199">or even know when it's </span><span class="line" data-startTime="1202">going to run. </span></p>

<p><span class="line" data-startTime="1203">More from a point of view of </span><span class="line" data-startTime="1203">telling it, like you said, I'm </span><span class="line" data-startTime="1207">starting to do something </span><span class="line" data-startTime="1207">really complicated now. </span> <span class="line" data-startTime="1209">Just calm down. </span> <span class="line" data-startTime="1210">And if my memory grows by </span><span class="line" data-startTime="1210">another 20 megabytes while </span><span class="line" data-startTime="1214">you're waiting to GC, please </span><span class="line" data-startTime="1214">wait until I'm finished. </span> <span class="line" data-startTime="1217">And then feel free to hit </span><span class="line" data-startTime="1217">me with a big thing. </span> <span class="line" data-startTime="1219">I know, it may not </span><span class="line" data-startTime="1219">be possible. </span> <span class="line" data-startTime="1221">But &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="1221"><span class="speakerName">Audience</span>: It can't </span><span class="line" data-startTime="1221">be that simple. </span><span class="line" data-startTime="1223">Because we're trying to balance </span><span class="line" data-startTime="1223">the interests of the </span><span class="line" data-startTime="1227">user, who may have triggered </span><span class="line" data-startTime="1227">your page to allocate those 20 </span><span class="line" data-startTime="1231">megabytes, versus, should </span><span class="line" data-startTime="1231">they go to swap now? </span><span class="line" data-startTime="1233">What else should they be doing </span><span class="line" data-startTime="1233">here in order to &mdash; </span><span class="line" data-startTime="1235">what's the most valuable thing </span><span class="line" data-startTime="1235">to do with those 20 megabytes? </span><span class="line" data-startTime="1238">And the answer may </span><span class="line" data-startTime="1238">not be your app. </span><span class="line" data-startTime="1240">You may think it is. </span><span class="line" data-startTime="1241">But you may not have a global </span><span class="line" data-startTime="1241">view on what the user agent is </span><span class="line" data-startTime="1243">doing for the user. </span></p>

<p class="speaker"><span class="line" data-starttime="1245"><span class="speakerName">Chris Lord</span>: And I think to some </span><span class="line" data-startTime="1245">extent here, we're kind </span><span class="line" data-startTime="1248">of trying to have our </span><span class="line" data-startTime="1248">cake and eat it. </span> <span class="line" data-startTime="1250">You kind of do have some </span><span class="line" data-startTime="1250">control over GC to some </span><span class="line" data-startTime="1253">extent, in that you can just not </span><span class="line" data-startTime="1253">write things in a way that </span><span class="line" data-startTime="1257">will end up with objects </span><span class="line" data-startTime="1257">to collect. </span> <span class="line" data-startTime="1260">It sounds kind of silly. </span> <span class="line" data-startTime="1263">But that's how like in Java on </span><span class="line" data-startTime="1263">Firefox mobile for Android, we </span><span class="line" data-startTime="1268">have these problems in a lot </span><span class="line" data-startTime="1268">of our codes, like while </span><span class="line" data-startTime="1271">you're panning and so </span><span class="line" data-startTime="1271">on is Java code. </span></p>

<p><span class="line" data-startTime="1274">And if we create a load of </span><span class="line" data-startTime="1274">objects during those frames, </span><span class="line" data-startTime="1277">then at some point, GC will </span><span class="line" data-startTime="1277">comes along at a completely </span><span class="line" data-startTime="1280">random time and take more </span><span class="line" data-startTime="1280">than a frame's worth of </span><span class="line" data-startTime="1284">time to do its work. </span> <span class="line" data-startTime="1286">And the way we work around </span><span class="line" data-startTime="1286">that is just </span><span class="line" data-startTime="1288">by not doing that. </span> <span class="line" data-startTime="1289">We can't change the </span><span class="line" data-startTime="1289">garbage collector. </span> <span class="line" data-startTime="1291">And we probably wouldn't </span><span class="line" data-startTime="1291">want to anyway, really. </span> <span class="line" data-startTime="1294">Because then other things are </span><span class="line" data-startTime="1294">going to break, and other </span><span class="line" data-startTime="1296">assumptions we've made </span><span class="line" data-startTime="1296">are going to break. </span> <span class="line" data-startTime="1299">You can just write your code </span><span class="line" data-startTime="1299">in such a way that it won't </span><span class="line" data-startTime="1302">cause a lot of GC. </span></p>

<p><span class="line" data-startTime="1307">SHANE O'SULLIVAN: </span><span class="line" data-startTime="1307">No, that's true. </span> <span class="line" data-startTime="1309">Yeah, that's true. </span> <span class="line" data-startTime="1310">And you should be doing </span><span class="line" data-startTime="1310">that anyway. </span> <span class="line" data-startTime="1311">But it does just get to the </span><span class="line" data-startTime="1311">point at some point. </span> <span class="line" data-startTime="1313">I mean, if you're trying to do </span><span class="line" data-startTime="1313">things like I was saying </span><span class="line" data-startTime="1315">there, or keep your DOM small, </span><span class="line" data-startTime="1315">and have some sort of complex </span><span class="line" data-startTime="1318">controller that does all these </span><span class="line" data-startTime="1318">things and recycles views and </span><span class="line" data-startTime="1320">all that kind of stuff. </span> <span class="line" data-startTime="1324">You're doing all this to get </span><span class="line" data-startTime="1324">around the problem of large </span><span class="line" data-startTime="1327">DOM and to avoid repaint, and </span><span class="line" data-startTime="1327">get as much reuse as you can. </span> <span class="line" data-startTime="1330">That inevitably leads to </span><span class="line" data-startTime="1330">large memory usage. </span> <span class="line" data-startTime="1333">If you have static content, like </span><span class="line" data-startTime="1333">buttons and icons, and </span><span class="line" data-startTime="1337">you're swiping through those. </span></p>

<p><span class="line" data-startTime="1338">Absolutely. </span> <span class="line" data-startTime="1338">But if you simply have megabytes </span><span class="line" data-startTime="1338">of data that, as a </span><span class="line" data-startTime="1342">person scrolls through, you've </span><span class="line" data-startTime="1342">got to show them a piece at a </span><span class="line" data-startTime="1343">time, it gets fairly difficult </span><span class="line" data-startTime="1343">to start avoiding things. </span> <span class="line" data-startTime="1347">Even when you cut it down </span><span class="line" data-startTime="1347">as much as possible. </span></p>

<p class="speaker"><span class="line" data-starttime="1352"><span class="speakerName">Chris Lord</span>: I guess you kind </span><span class="line" data-startTime="1352">of want to balance the two. </span></p>

<p class="speaker"><span class="line" data-starttime="1358"><span class="speakerName">Matt Delaney</span>: I'm moving on. </span><span class="line" data-startTime="1359">So we've got a third question </span><span class="line" data-startTime="1359">here, from Jonno </span><span class="line" data-startTime="1362">from London, or Yonno? </span><span class="line" data-startTime="1363">Is that a person in here? </span><span class="line" data-startTime="1365">Yonno? </span><span class="line" data-startTime="1366">Anyway. </span><span class="line" data-startTime="1367">So we've got a very talked about </span><span class="line" data-startTime="1367">topic here, but with </span><span class="line" data-startTime="1371">respect to tooling this time. </span><span class="line" data-startTime="1372">So when you're using CSS to </span><span class="line" data-startTime="1372">manually trigger hardware </span><span class="line" data-startTime="1374">acceleration of DOM elements for </span><span class="line" data-startTime="1374">animations, for example, </span><span class="line" data-startTime="1378">the hack of using translateZ(0), </span><span class="line" data-startTime="1378">is there a tool </span><span class="line" data-startTime="1381">or any way to measure how this </span><span class="line" data-startTime="1381">impacts the users and GPU? </span><span class="line" data-startTime="1385">They ask. </span><span class="line" data-startTime="1386">Let's start with Feldman. </span></p>

<p class="speaker"><span class="line" data-starttime="1389"><span class="speakerName">Pavel Feldman</span>: Yeah. </span> <span class="line" data-startTime="1390">So you measure it </span><span class="line" data-startTime="1390">using timeline. </span> <span class="line" data-startTime="1393">And I won't comment on whether </span><span class="line" data-startTime="1393">it's a good practice or not to </span><span class="line" data-startTime="1397">force the hardware </span><span class="line" data-startTime="1398">acceleration using that technique. </span> <span class="line" data-startTime="1399">And Paul can cover that one. </span> <span class="line" data-startTime="1402">But once you've done that, you </span><span class="line" data-startTime="1402">can, in Chrome, and it covers </span><span class="line" data-startTime="1408">good part of WebKit, you can use </span><span class="line" data-startTime="1408">timeline to measure both </span><span class="line" data-startTime="1414">paints times, and just </span><span class="line" data-startTime="1414">compare those. </span> <span class="line" data-startTime="1418">That will obviously depend </span><span class="line" data-startTime="1418">on whether you are using </span><span class="line" data-startTime="1422">[? retna ?] </span><span class="line" data-startTime="1422">or not, size of the screen, </span><span class="line" data-startTime="1422">[? whatever, ?] </span><span class="line" data-startTime="1425">accelerator. </span> <span class="line" data-startTime="1426">But you can do that. </span> <span class="line" data-startTime="1428">You'll need to have an </span><span class="line" data-startTime="1428">inventory for that. </span> <span class="line" data-startTime="1430">Because equipment differs. </span> <span class="line" data-startTime="1432">And do you want to comment </span><span class="line" data-startTime="1432">on the translating? </span><span class="line" data-startTime="1438">[? PAUL: ?] </span><span class="line" data-startTime="1439">Just one thing about the </span><span class="line" data-startTime="1439">translate zed for me is that </span><span class="line" data-startTime="1446">the way, certainly in Chrome, </span><span class="line" data-startTime="1446">it's handled is that it </span><span class="line" data-startTime="1449">creates you a new layer, </span><span class="line" data-startTime="1449">but also a layer </span><span class="line" data-startTime="1450">with a backing surface. </span></p>

<p><span class="line" data-startTime="1453">So that effectively really maps </span><span class="line" data-startTime="1453">down to a texture that </span><span class="line" data-startTime="1457">needs to be uploaded </span><span class="line" data-startTime="1457">to the GPU. </span> <span class="line" data-startTime="1460">So the net result of this is </span><span class="line" data-startTime="1460">that if you've got a translate </span><span class="line" data-startTime="1462">zed or across a lot of </span><span class="line" data-startTime="1462">elements, on desktop </span><span class="line" data-startTime="1464">you might be fine. </span> <span class="line" data-startTime="1465">Because you've got a lot </span><span class="line" data-startTime="1465">more VRAM to play with. </span> <span class="line" data-startTime="1468">But on mobile, you're going </span><span class="line" data-startTime="1468">to get punished. </span> <span class="line" data-startTime="1470">Because now you've got a lot of </span><span class="line" data-startTime="1470">textures that needs to be </span><span class="line" data-startTime="1471">uploaded to your GPU. </span> <span class="line" data-startTime="1473">And the upload time might be </span><span class="line" data-startTime="1473">quite slow to get those </span><span class="line" data-startTime="1476">textures from the CPU up to </span><span class="line" data-startTime="1476">the GPU, depending on the </span><span class="line" data-startTime="1479">actual hardware you're </span><span class="line" data-startTime="1479">running on. </span></p>

<p><span class="line" data-startTime="1480">So it's one of these things </span><span class="line" data-startTime="1480">that it's sort </span><span class="line" data-startTime="1483">of used with caution. </span> <span class="line" data-startTime="1485">And it may be that in your </span><span class="line" data-startTime="1485">specific implementation it </span><span class="line" data-startTime="1488">speeds things up, because you've </span><span class="line" data-startTime="1488">got enough VRAM to kind </span><span class="line" data-startTime="1491">of cover that debt that you're </span><span class="line" data-startTime="1491">kind of creating for yourself. </span> <span class="line" data-startTime="1494">And it also is good because, </span><span class="line" data-startTime="1494">again, in Chrome, if it's </span><span class="line" data-startTime="1498">possible, switch the rendering </span><span class="line" data-startTime="1498">mode over to thread </span><span class="line" data-startTime="1500">compositing, which is often a </span><span class="line" data-startTime="1500">good thing, especially if </span><span class="line" data-startTime="1503">you've got a lot </span><span class="line" data-startTime="1503">of animations. </span> <span class="line" data-startTime="1504">But you might just see, as </span><span class="line" data-startTime="1504">again, a mobile, you might see </span><span class="line" data-startTime="1508">it crush your performance </span><span class="line" data-startTime="1508">if you do it too much. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="1511"><span class="speakerName">Chris Lord</span>: Yeah, this is the </span><span class="line" data-startTime="1511">same case in Firefox, as well, </span><span class="line" data-startTime="1513">where if you add any kind of </span><span class="line" data-startTime="1513">transformation, then it will </span><span class="line" data-startTime="1517">end up not optimizing it, but </span><span class="line" data-startTime="1517">sort of making it appear on </span><span class="line" data-startTime="1521">its own layer. </span> <span class="line" data-startTime="1523">There are other things to </span><span class="line" data-startTime="1523">consider, as well, when you're </span><span class="line" data-startTime="1525">forcing layers and elements </span><span class="line" data-startTime="1525">and that. </span> <span class="line" data-startTime="1528">If you force something to become </span><span class="line" data-startTime="1528">a new layer, you're </span><span class="line" data-startTime="1530">also forcing layers to be </span><span class="line" data-startTime="1530">underneath it and over it, </span><span class="line" data-startTime="1533">depending on the structure </span><span class="line" data-startTime="1533">of the document. </span> <span class="line" data-startTime="1536">And again, depending on the </span><span class="line" data-startTime="1536">structure of the document, </span><span class="line" data-startTime="1538">you'd also be forcing things </span><span class="line" data-startTime="1538">like alpha blending to happen. </span> <span class="line" data-startTime="1541">You're forcing things like </span><span class="line" data-startTime="1541">increased overdraw to happen, </span><span class="line" data-startTime="1544">all of these. </span> <span class="line" data-startTime="1546">And you'd have memory </span><span class="line" data-startTime="1546">hit, you'd have </span><span class="line" data-startTime="1547">GPU time hit as well. </span></p>

<p><span class="line" data-startTime="1550">And at some point, like </span><span class="line" data-startTime="1550">translateZ(0) might end up </span><span class="line" data-startTime="1554">just being a null op anyway. </span></p>

<p class="speaker"><span class="line" data-starttime="1556"><span class="speakerName">Rowan Beenje</span>: It is </span><span class="line" data-startTime="1556">already on WebKit. </span><span class="line" data-startTime="1558">It's been kind of deprecated </span><span class="line" data-startTime="1558">[INAUDIBLE]. </span></p>

<p class="speaker"><span class="line" data-starttime="1560"><span class="speakerName">Paul</span>: Yeah, they may be like &mdash; </span><span class="line" data-startTime="1562">there are other ways to trigger </span><span class="line" data-startTime="1562">the same behavior so </span><span class="line" data-startTime="1565">that the warning [? shot ?] </span><span class="line" data-startTime="1566">is, this one might </span><span class="line" data-startTime="1566">become null. </span><span class="line" data-startTime="1568">But developers might gravitate </span><span class="line" data-startTime="1568">towards an alternative way of </span><span class="line" data-startTime="1573">triggering the same effect. </span><span class="line" data-startTime="1575">It is exactly what </span><span class="line" data-startTime="1575">you're saying. </span><span class="line" data-startTime="1576">It depends on the context of </span><span class="line" data-startTime="1576">when you're using it as to </span><span class="line" data-startTime="1578">whether it's actually a suitable </span><span class="line" data-startTime="1578">thing to do, really. </span></p>

<p class="speaker"><span class="line" data-starttime="1581"><span class="speakerName">Matt Delaney</span>: So there's really </span><span class="line" data-startTime="1581">a lot of knowledge </span><span class="line" data-startTime="1583">here, and a lot of gotchas, </span><span class="line" data-startTime="1583">depending upon the platform </span><span class="line" data-startTime="1585">and what they fall down into </span><span class="line" data-startTime="1585">doing, what actual rendering </span><span class="line" data-startTime="1587">paths, right? </span><span class="line" data-startTime="1588">But I guess for this question, </span><span class="line" data-startTime="1588">it'd be really interesting to </span><span class="line" data-startTime="1590">point out maybe, especially </span><span class="line" data-startTime="1590">with people in the more </span><span class="line" data-startTime="1592">constrained environments on </span><span class="line" data-startTime="1592">mobile, what do you guys see </span><span class="line" data-startTime="1595">out there for tooling to measure </span><span class="line" data-startTime="1595">the impact of their </span><span class="line" data-startTime="1598">apps usage of this hack upon </span><span class="line" data-startTime="1598">what they're doing? </span></p>

<p class="speaker"><span class="line" data-starttime="1602"><span class="speakerName">Chris Lord</span>: This is quite </span><span class="line" data-startTime="1602">a difficult thing. </span> <span class="line" data-startTime="1604">Because GPU behavior is wildly </span><span class="line" data-startTime="1604">different, depending on what </span><span class="line" data-startTime="1610">vendor you have. </span> <span class="line" data-startTime="1611">So Firefox does have a profiling </span><span class="line" data-startTime="1611">tool built in, which </span><span class="line" data-startTime="1615">will profile at the native level </span><span class="line" data-startTime="1615">where time is spent. </span> <span class="line" data-startTime="1620">And it goes into JavaScript, </span><span class="line" data-startTime="1620">as well. </span> <span class="line" data-startTime="1622">So if you run your page or </span><span class="line" data-startTime="1622">your web GL app, and you </span><span class="line" data-startTime="1626">scroll around with the profiler </span><span class="line" data-startTime="1626">enabled and you stop, </span><span class="line" data-startTime="1629">you can see where time </span><span class="line" data-startTime="1629">is being spent. </span> <span class="line" data-startTime="1632">But in terms of getting really </span><span class="line" data-startTime="1632">granular results, </span><span class="line" data-startTime="1635">that's quite hard. </span> <span class="line" data-startTime="1636">Like GL drivers quite often, </span><span class="line" data-startTime="1636">they'll defer work to the </span><span class="line" data-startTime="1641">latest point possible. </span> <span class="line" data-startTime="1642">So you might find that although </span><span class="line" data-startTime="1642">you're doing a load </span><span class="line" data-startTime="1646">of vertex upload or something, </span><span class="line" data-startTime="1646">you're uploading a load of </span><span class="line" data-startTime="1650">data to the GPU, or you're </span><span class="line" data-startTime="1650">uploading a load of things, </span><span class="line" data-startTime="1654">you might find that actually all </span><span class="line" data-startTime="1654">of that takes zero time. </span></p>

<p><span class="line" data-startTime="1657">And swap takes all </span><span class="line" data-startTime="1657">of your time. </span> <span class="line" data-startTime="1660">Or clear takes all of your time, </span><span class="line" data-startTime="1660">or flush, or some other </span><span class="line" data-startTime="1663">command where the GPU's like, </span><span class="line" data-startTime="1663">right, OK, we can't defer </span><span class="line" data-startTime="1666">things any longer. </span> <span class="line" data-startTime="1667">We have to flush out </span><span class="line" data-startTime="1667">all the work. </span> <span class="line" data-startTime="1669">And we can't really counteract </span><span class="line" data-startTime="1669">that without doing, I guess, </span><span class="line" data-startTime="1674">other clever things like having </span><span class="line" data-startTime="1674">a shim for the GL </span><span class="line" data-startTime="1677">functions and the JavaScript, </span><span class="line" data-startTime="1677">so that we can log what </span><span class="line" data-startTime="1680">commands you are using, and use </span><span class="line" data-startTime="1680">some kind of context to </span><span class="line" data-startTime="1684">say, well, maybe you shouldn't </span><span class="line" data-startTime="1684">be doing all of this. </span></p>

<p><span class="line" data-startTime="1686">Maybe you shouldn't be uploading </span><span class="line" data-startTime="1686">all of this data </span><span class="line" data-startTime="1688">here, or maybe you should think </span><span class="line" data-startTime="1688">of using more VPOs and </span><span class="line" data-startTime="1696">batching your drawing, rather </span><span class="line" data-startTime="1696">than doing lots of separate </span><span class="line" data-startTime="1699">drawing and things like this. </span> <span class="line" data-startTime="1701">But I think it's going to be </span><span class="line" data-startTime="1701">quite difficult, nigh on </span><span class="line" data-startTime="1704">impossible, to have a really </span><span class="line" data-startTime="1704">granular general profiler when </span><span class="line" data-startTime="1709">it comes to GPU use. </span> <span class="line" data-startTime="1713">But yeah, Firefox has </span><span class="line" data-startTime="1713">a built in profiler. </span> <span class="line" data-startTime="1717">If it's not in the current </span><span class="line" data-startTime="1717">release, it's probably in 19 </span><span class="line" data-startTime="1720">or 20, I forget. </span> <span class="line" data-startTime="1721">And also for the record, </span><span class="line" data-startTime="1721">we have incremental GC </span><span class="line" data-startTime="1724">also in 19 or 20. </span></p>

<p class="speaker"><span class="line" data-starttime="1727"><span class="speakerName">Pavel Feldman</span>: So before </span><span class="line" data-startTime="1727">it gets to Firefox, </span><span class="line" data-startTime="1730">we have it in Chrome. </span> <span class="line" data-startTime="1733">And the way you look at it &mdash; so </span><span class="line" data-startTime="1733">there is no GPU profiling. </span> <span class="line" data-startTime="1738">But there are interesting cases </span><span class="line" data-startTime="1738">on the timeline where </span><span class="line" data-startTime="1741">you see your CPU time spent </span><span class="line" data-startTime="1741">for just JavaScript </span><span class="line" data-startTime="1745">[? layer ?] painting. </span> <span class="line" data-startTime="1746">And it all adds up to some </span><span class="line" data-startTime="1746">reasonable amount. </span> <span class="line" data-startTime="1749">And then there is this </span><span class="line" data-startTime="1749">transparent bar. </span> <span class="line" data-startTime="1751">And you don't know why your </span><span class="line" data-startTime="1751">frame has been skipped. </span> <span class="line" data-startTime="1754">And the reason for that is the </span><span class="line" data-startTime="1754">browser was waiting for GPU. </span> <span class="line" data-startTime="1759">We don't really see that </span><span class="line" data-startTime="1759">happening a lot in practice, </span><span class="line" data-startTime="1763">on non-heavy 3D apps </span><span class="line" data-startTime="1763">whatsoever. </span> <span class="line" data-startTime="1766">So in most cases, first thing </span><span class="line" data-startTime="1766">you check is timeline. </span></p>

<p><span class="line" data-startTime="1770">And you're most likely OK. </span> <span class="line" data-startTime="1772">And the detailed GPU profiling </span><span class="line" data-startTime="1772">is still ahead </span><span class="line" data-startTime="1775">for Chrome, as well. </span></p>

<p class="speaker"><span class="line" data-starttime="1777"><span class="speakerName">Chris Lord</span>: Yeah. </span> <span class="line" data-startTime="1777">It's much better on desktop </span><span class="line" data-startTime="1777">than it is on mobile. </span> <span class="line" data-startTime="1780">And most of my experience is </span><span class="line" data-startTime="1780">mobile, so I'm probably going </span><span class="line" data-startTime="1782">to be speaking from </span><span class="line" data-startTime="1782">that perspective. </span> <span class="line" data-startTime="1785">You worry less. </span> <span class="line" data-startTime="1786">I guess everything is </span><span class="line" data-startTime="1786">better on desktop. </span> <span class="line" data-startTime="1789">The state of mobile GPUs, at </span><span class="line" data-startTime="1789">least certainly on Android, </span><span class="line" data-startTime="1794">although it's getting better, </span><span class="line" data-startTime="1794">is like Android-based system </span><span class="line" data-startTime="1798">tends to use GPUs more. </span> <span class="line" data-startTime="1799">Like, drivers have some pretty </span><span class="line" data-startTime="1799">awful and incorrect behavior, </span><span class="line" data-startTime="1804">and just flat out bugs that will </span><span class="line" data-startTime="1804">cause things like this. </span> <span class="line" data-startTime="1809">You'll have hitches that will </span><span class="line" data-startTime="1809">be very hard to trace. </span> <span class="line" data-startTime="1812">And it will come down to </span><span class="line" data-startTime="1812">something like, you've </span><span class="line" data-startTime="1816">triggered something </span><span class="line" data-startTime="1816">which might do &mdash; </span><span class="line" data-startTime="1818">like it might update </span><span class="line" data-startTime="1818">part of a texture. </span> <span class="line" data-startTime="1820">And that GPU driver subimage </span><span class="line" data-startTime="1820">uploads are </span><span class="line" data-startTime="1824">actually just terrible. </span></p>

<p><span class="line" data-startTime="1824">And you should never do them. </span> <span class="line" data-startTime="1826">We try and work around these </span><span class="line" data-startTime="1826">things, but I don't know. </span> <span class="line" data-startTime="1829">It's on mobile it's hard. </span> <span class="line" data-startTime="1830">But on desktop, it's less </span><span class="line" data-startTime="1830">of a concern, I guess. </span></p>

<p class="speaker"><span class="line" data-starttime="1833"><span class="speakerName">Matt Delaney</span>: Also we </span><span class="line" data-startTime="1833">have a question from </span><span class="line" data-startTime="1834">the audience here. </span><span class="line" data-startTime="1835">What's your name? </span></p>

<p class="speaker"><span class="line" data-starttime="1837"><span class="speakerName">Audience</span>: Hi, I'm </span><span class="line" data-startTime="1837">DJ Fazzyfist. </span><span class="line" data-startTime="1838">No, I'm kidding. </span><span class="line" data-startTime="1839">[INAUDIBLE] </span><span class="line" data-startTime="1839">from Google. </span><span class="line" data-startTime="1840">It's also worth noting that for </span><span class="line" data-startTime="1840">those of you daring souls </span><span class="line" data-startTime="1843">in here who compile Chromium, </span><span class="line" data-startTime="1843">that there is access to the </span><span class="line" data-startTime="1846">Skia debugger, which is actually </span><span class="line" data-startTime="1846">sort of the hardware </span><span class="line" data-startTime="1850">GPU compositor. </span><span class="line" data-startTime="1851">It's actually amazing </span><span class="line" data-startTime="1851">the insight you can </span><span class="line" data-startTime="1853">get from Skia debugger. </span><span class="line" data-startTime="1854">You can actually see the GPU </span><span class="line" data-startTime="1854">performance for each CSS </span><span class="line" data-startTime="1856">element on your page. </span><span class="line" data-startTime="1857">You can actually see what your </span><span class="line" data-startTime="1857">DOM is doing, and what each </span><span class="line" data-startTime="1860">button and how long that's </span><span class="line" data-startTime="1860">taking on the GPU. </span><span class="line" data-startTime="1863">It's amazing insight if you're </span><span class="line" data-startTime="1863">seeing problems in this area, </span><span class="line" data-startTime="1865">and definitely worth checking </span><span class="line" data-startTime="1865">out if you're willing to </span><span class="line" data-startTime="1867">compile Chromium. </span></p>

<p class="speaker"><span class="line" data-starttime="1868"><span class="speakerName">Audience</span>: How do you spell it? </span></p>

<p class="speaker"><span class="line" data-starttime="1869"><span class="speakerName">Audience</span>: Skia? </span><span class="line" data-startTime="1870">S-K-I-A. Skia debugger, </span><span class="line" data-startTime="1870">check it out. </span><span class="line" data-startTime="1875">Hi. </span></p>

<p class="speaker"><span class="line" data-starttime="1876"><span class="speakerName">Matt Delaney</span>: Sounds </span><span class="line" data-startTime="1876">pretty good. </span></p>

<p class="speaker"><span class="line" data-starttime="1879"><span class="speakerName">Pavel Feldman</span>: Does it already </span><span class="line" data-startTime="1879">provide traceability from DOM </span><span class="line" data-startTime="1882">and CSS literally? </span><span class="line" data-startTime="1883">Because it was bound </span><span class="line" data-startTime="1883">to instructions. </span><span class="line" data-startTime="1886">And you couldn't really trace </span><span class="line" data-startTime="1886">it into particular </span><span class="line" data-startTime="1888">[? selector ?] </span><span class="line" data-startTime="1888">and/or CSS property. </span><span class="line" data-startTime="1892">I don't believe you can now. </span></p>

<p class="speaker"><span class="line" data-starttime="1894"><span class="speakerName">Audience</span>: [INAUDIBLE]. </span></p>

<p class="speaker"><span class="line" data-starttime="1896"><span class="speakerName">Pete</span>: Mic? </span></p>

<p class="speaker"><span class="line" data-starttime="1898"><span class="speakerName">Audience</span>: Thanks, Pete. </span><span class="line" data-startTime="1900">The latest one that I was </span><span class="line" data-startTime="1900">playing with had some </span><span class="line" data-startTime="1902">abilities there. </span><span class="line" data-startTime="1903">Obviously, the tooling needs to </span><span class="line" data-startTime="1903">get better across the board </span><span class="line" data-startTime="1905">for getting GPU insight for </span><span class="line" data-startTime="1905">these sorts of things. </span><span class="line" data-startTime="1908">Since kind of the future of web </span><span class="line" data-startTime="1908">compositing performance is </span><span class="line" data-startTime="1911">on the GPU anyway. </span><span class="line" data-startTime="1912">So for those of you who want </span><span class="line" data-startTime="1912">to kind of try out and give </span><span class="line" data-startTime="1914">feedback for this early stuff, </span><span class="line" data-startTime="1914">definitely check out Skia </span><span class="line" data-startTime="1916">debugger and kind of get a </span><span class="line" data-startTime="1916">chance to chart where these </span><span class="line" data-startTime="1919">tools are going in the future. </span></p>

<p class="speaker"><span class="line" data-starttime="1921"><span class="speakerName">Pavel Feldman</span>: So the way it </span><span class="line" data-startTime="1921">works pretty much, if I </span><span class="line" data-startTime="1924">remember it correctly, </span><span class="line" data-startTime="1924">is it logs </span><span class="line" data-startTime="1926">everything that is happening. </span><span class="line" data-startTime="1927">And then it replays it. </span><span class="line" data-startTime="1928">And while replaying, you can </span><span class="line" data-startTime="1928">assess the performance of the </span><span class="line" data-startTime="1932">instructions that were made. </span><span class="line" data-startTime="1935">So basic idea. </span></p>

<p class="speaker"><span class="line" data-starttime="1936"><span class="speakerName">Chris Lord</span>: I think we do </span><span class="line" data-startTime="1936">actually, I remember now, on </span><span class="line" data-startTime="1939">the [INAUDIBLE] </span><span class="line" data-startTime="1940">last year, we have a similar </span><span class="line" data-startTime="1940">tool for recording GPU </span><span class="line" data-startTime="1944">behavior and then </span><span class="line" data-startTime="1944">playing it back. </span><span class="line" data-startTime="1946">But I can't tell you </span><span class="line" data-startTime="1946">anything about it. </span><span class="line" data-startTime="1949">I've just forgotten, and </span><span class="line" data-startTime="1949">it's not finished. </span><span class="line" data-startTime="1951">So I think that sounds </span><span class="line" data-startTime="1951">really cool. </span><span class="line" data-startTime="1954">You're definitely well </span><span class="line" data-startTime="1954">ahead there. </span></p>

<p class="speaker"><span class="line" data-starttime="1957"><span class="speakerName">Rowan Beenje</span>: And I think the </span><span class="line" data-startTime="1957">Chrome dev tools are just </span><span class="line" data-startTime="1959">starting to expose the </span><span class="line" data-startTime="1959">amounts of GP memory </span><span class="line" data-startTime="1961">used, is that correct? </span><span class="line" data-startTime="1962">That's coming up? </span></p>

<p class="speaker"><span class="line" data-starttime="1963"><span class="speakerName">Pavel Feldman</span>: Not yet. </span></p>

<p class="speaker"><span class="line" data-starttime="1964"><span class="speakerName">Rowan Beenje</span>: But it's coming? </span></p>

<p class="speaker"><span class="line" data-starttime="1965"><span class="speakerName">Pavel Feldman</span>: It's </span><span class="line" data-startTime="1965">coming, yes. </span></p>

<p class="speaker"><span class="line" data-starttime="1966"><span class="speakerName">Rowan Beenje</span>: Very soon. </span></p>

<p class="speaker"><span class="line" data-starttime="1967"><span class="speakerName">Pavel Feldman</span>: So native memory </span><span class="line" data-startTime="1967">instrumentation started </span><span class="line" data-startTime="1970">with the renderer. </span><span class="line" data-startTime="1971">And the GPU for us is outside </span><span class="line" data-startTime="1971">of the renderer. </span></p>

<p class="speaker"><span class="line" data-starttime="1976"><span class="speakerName">Chris Lord</span>: I'm not sure if &mdash; </span><span class="line" data-startTime="1977">like, we have, if you go to </span><span class="line" data-startTime="1977">About Memory in Firefox, </span><span class="line" data-startTime="1980">you'll see lots of details </span><span class="line" data-startTime="1980">about where your memory's </span><span class="line" data-startTime="1982">being used. </span><span class="line" data-startTime="1983">I'm not sure if that goes </span><span class="line" data-startTime="1983">to GPU memory, though. </span><span class="line" data-startTime="1987">That also works &mdash; </span><span class="line" data-startTime="1988">I think it works, it should </span><span class="line" data-startTime="1988">work &mdash; on mobile. </span></p>

<p class="speaker"><span class="line" data-starttime="1993"><span class="speakerName">Matt Delaney</span>: Great. </span><span class="line" data-startTime="1993">So that's quite a bit </span><span class="line" data-startTime="1993">about the tooling. </span><span class="line" data-startTime="1994">So how about we move over to </span><span class="line" data-startTime="1994">the next question, which is </span><span class="line" data-startTime="1997">related and kind of touched on a </span><span class="line" data-startTime="1997">bit in the beginning of this </span><span class="line" data-startTime="1999">one, was, how do you guys feel </span><span class="line" data-startTime="1999">about frame developers and </span><span class="line" data-startTime="2002">their understanding of which </span><span class="line" data-startTime="2002">performance metrics they </span><span class="line" data-startTime="2005">should actually be looking </span><span class="line" data-startTime="2005">at these days? </span><span class="line" data-startTime="2007">Say both, of course on a </span><span class="line" data-startTime="2007">desktop, but more importantly </span><span class="line" data-startTime="2011">mobile, the more constrained </span><span class="line" data-startTime="2011">environment. </span><span class="line" data-startTime="2013">Should they be looking, </span><span class="line" data-startTime="2013">rendering, </span><span class="line" data-startTime="2015">compositing, layout? </span><span class="line" data-startTime="2017">How should they be used </span><span class="line" data-startTime="2017">in the tools? </span></p>

<p class="speaker"><span class="line" data-starttime="2022"><span class="speakerName">Chris Lord</span>: I guess there </span><span class="line" data-startTime="2022">aren't too many. </span><span class="line" data-startTime="2024">We've not done as good a job </span><span class="line" data-startTime="2024">as we should have, in that </span><span class="line" data-startTime="2028">there aren't tools to measure </span><span class="line" data-startTime="2028">certain things that you'd </span><span class="line" data-startTime="2031">really want to know. </span><span class="line" data-startTime="2032">Or at least, the tools are </span><span class="line" data-startTime="2032">things like, oh, just use an </span><span class="line" data-startTime="2036">HDMI video capture unit and do </span><span class="line" data-startTime="2036">frame analysis, which is </span><span class="line" data-startTime="2040">obviously not feasible for </span><span class="line" data-startTime="2040">most people, I would say. </span></p>

<p class="speaker"><span class="line" data-starttime="2047"><span class="speakerName">Pavel Feldman</span>: Can we turn that </span><span class="line" data-startTime="2047">to the audience, and may </span><span class="line" data-startTime="2049">I ask, how many of you have </span><span class="line" data-startTime="2049">experienced issues, </span><span class="line" data-startTime="2052">challenges, profiling, fighting </span><span class="line" data-startTime="2052">for rendering </span><span class="line" data-startTime="2056">performance? </span><span class="line" data-startTime="2057">If you could raise your hand. </span><span class="line" data-startTime="2058">Rendering performance? </span><span class="line" data-startTime="2061">OK. </span><span class="line" data-startTime="2062">And how many of you were </span><span class="line" data-startTime="2062">using timeline to </span><span class="line" data-startTime="2067">capture what's happening? </span><span class="line" data-startTime="2069">OK, so it's pretty much </span><span class="line" data-startTime="2069">half of [? us. ?] </span><span class="line" data-startTime="2072">So that's your answer. </span><span class="line" data-startTime="2073">So half of us realize what needs </span><span class="line" data-startTime="2073">to be done tooling wise. </span></p>

<p class="speaker"><span class="line" data-starttime="2082"><span class="speakerName">Audience</span>: [INAUDIBLE]. </span><span class="line" data-startTime="2088">So how would it help me </span><span class="line" data-startTime="2088">in a web view iOS? </span><span class="line" data-startTime="2091">It's great that we have all </span><span class="line" data-startTime="2091">these tools in our browsers, </span><span class="line" data-startTime="2093">but a lot of performance </span><span class="line" data-startTime="2093">of HTML5 is </span><span class="line" data-startTime="2095">in the closed platforms. </span><span class="line" data-startTime="2097">So what can we do to get those </span><span class="line" data-startTime="2097">closed platforms to get the </span><span class="line" data-startTime="2100">cool tools that we're </span><span class="line" data-startTime="2100">building? </span></p>

<p class="speaker"><span class="line" data-starttime="2102"><span class="speakerName">Pavel Feldman</span>: So those </span><span class="line" data-startTime="2102">platforms diverge, especially </span><span class="line" data-startTime="2105">on the rendering front. </span> <span class="line" data-startTime="2106">It is truth. </span> <span class="line" data-startTime="2108">On the CPU front, though, they </span><span class="line" data-startTime="2108">are very much alike. </span> <span class="line" data-startTime="2112">So you have a good clue on </span><span class="line" data-startTime="2112">what's happening in iOS web </span><span class="line" data-startTime="2114">view when looking at Chrome, </span><span class="line" data-startTime="2114">unless you enable threaded </span><span class="line" data-startTime="2119">compositing or something </span><span class="line" data-startTime="2119">like that. </span> <span class="line" data-startTime="2122">And it often gives </span><span class="line" data-startTime="2122">you a good clue. </span> <span class="line" data-startTime="2125">And image decode time will </span><span class="line" data-startTime="2125">be proportional. </span> <span class="line" data-startTime="2128">Because what you're assessing </span><span class="line" data-startTime="2128">is basically the CPU and the </span><span class="line" data-startTime="2132">architecture of what </span><span class="line" data-startTime="2132">you're running on. </span></p>

<p><span class="line" data-startTime="2135">So you have some clue. </span> <span class="line" data-startTime="2136">You have some good </span><span class="line" data-startTime="2136">clue on that. </span> <span class="line" data-startTime="2138">But it is not precise. </span> <span class="line" data-startTime="2141">SHANE O'SULLIVAN: But also what </span><span class="line" data-startTime="2141">you should care about, I </span><span class="line" data-startTime="2144">don't think should be what any </span><span class="line" data-startTime="2144">one tool gives you, or any one </span><span class="line" data-startTime="2148">performance metric &mdash; </span><span class="line" data-startTime="2149">I mean, performance is </span><span class="line" data-startTime="2149">not a goal in itself. </span> <span class="line" data-startTime="2152">Performance should be there to </span><span class="line" data-startTime="2152">get you to increase whatever </span><span class="line" data-startTime="2155">metric matters to you. </span> <span class="line" data-startTime="2157">So for example, in Facebook, </span><span class="line" data-startTime="2157">the reason we care so much </span><span class="line" data-startTime="2159">about scrolling is that we did </span><span class="line" data-startTime="2159">a test where we artificially </span><span class="line" data-startTime="2163">introduced for some small </span><span class="line" data-startTime="2163">number of people, 20, 30 </span><span class="line" data-startTime="2166">million or something, where </span><span class="line" data-startTime="2166">we said, we'll have your </span><span class="line" data-startTime="2170">scrolling framework on Android </span><span class="line" data-startTime="2170">and iOS, just artificially. </span></p>

<p><span class="line" data-startTime="2173">We know you can do 60 </span><span class="line" data-startTime="2173">FPS on an iPhone 5. </span> <span class="line" data-startTime="2176">We will give you 30 FPS. </span> <span class="line" data-startTime="2177">And engagement collapsed. </span> <span class="line" data-startTime="2179">You would still get &mdash; </span><span class="line" data-startTime="2180">we didn't introduce jerking, </span><span class="line" data-startTime="2180">we just slowed </span><span class="line" data-startTime="2182">down the frame rate. </span> <span class="line" data-startTime="2183">And engagement dropped. </span> <span class="line" data-startTime="2185">So we said, OK, therefore, </span><span class="line" data-startTime="2185">scrolling matters to </span><span class="line" data-startTime="2188">engagement. </span> <span class="line" data-startTime="2188">And engagement is </span><span class="line" data-startTime="2188">what matters. </span> <span class="line" data-startTime="2190">So if what you care about &mdash; </span><span class="line" data-startTime="2193">test all the different </span><span class="line" data-startTime="2193">things for your app </span><span class="line" data-startTime="2194">that actually matter. </span> <span class="line" data-startTime="2195">If speed, time to interaction </span><span class="line" data-startTime="2195">is what's important to you, </span><span class="line" data-startTime="2200">emphasize for that. </span> <span class="line" data-startTime="2201">If scrolling is important to </span><span class="line" data-startTime="2201">you, and you do stuff like </span><span class="line" data-startTime="2204">newsfeed, or any kind of image </span><span class="line" data-startTime="2204">heavy thing, then optimize for </span><span class="line" data-startTime="2209">not resizing images. </span> <span class="line" data-startTime="2210">Optimize for not doing paint </span><span class="line" data-startTime="2210">reflows on complex content. </span> <span class="line" data-startTime="2218">If you really care about </span><span class="line" data-startTime="2218">TTI, do server render. </span> <span class="line" data-startTime="2221">It's faster. </span> <span class="line" data-startTime="2222">So try out 10 different </span><span class="line" data-startTime="2222">things. </span></p>

<p><span class="line" data-startTime="2225">I know it's time consuming. </span> <span class="line" data-startTime="2226">But the metric you should </span><span class="line" data-startTime="2226">be looking at is </span><span class="line" data-startTime="2229">what matters to you. </span> <span class="line" data-startTime="2230">Do you care that people look </span><span class="line" data-startTime="2230">at 50 photos in an hour? </span><span class="line" data-startTime="2233">You're a photo app, fine, </span><span class="line" data-startTime="2233">optimize for that. </span> <span class="line" data-startTime="2236">So yeah, I don't think there's </span><span class="line" data-startTime="2236">any one sole [? rebuttal ?] </span><span class="line" data-startTime="2239">for this stuff. </span></p>

<p class="speaker"><span class="line" data-starttime="2240"><span class="speakerName">Pavel Feldman</span>: So the same </span><span class="line" data-startTime="2240">happened to Chrome. </span> <span class="line" data-startTime="2241">We consider scrolling </span><span class="line" data-startTime="2241">very important. </span> <span class="line" data-startTime="2243">And there is actually a tooling </span><span class="line" data-startTime="2243">to detect regressions </span><span class="line" data-startTime="2249">on that front. </span> <span class="line" data-startTime="2250">So there is a telemetry, the </span><span class="line" data-startTime="2250">remote control for Chrome. </span> <span class="line" data-startTime="2253">And the rendering team </span><span class="line" data-startTime="2253">is using it in </span><span class="line" data-startTime="2256">the following matter. </span> <span class="line" data-startTime="2256">This tool can connect to remote </span><span class="line" data-startTime="2256">devices such as Android </span><span class="line" data-startTime="2261">phones and Chrome OS and </span><span class="line" data-startTime="2261">desktops, different builds, </span><span class="line" data-startTime="2264">different versions of builds. </span> <span class="line" data-startTime="2265">So it connects to those, runs </span><span class="line" data-startTime="2265">regression testing, uses </span><span class="line" data-startTime="2269">timeline to get raw data back, </span><span class="line" data-startTime="2269">and builds the graphs. </span> <span class="line" data-startTime="2273">And any degrade in that graph </span><span class="line" data-startTime="2273">is a show stopper, and we </span><span class="line" data-startTime="2277">change that. </span></p>

<p><span class="line" data-startTime="2278">[? Regressions ?] </span><span class="line" data-startTime="2279">gets rolled out [? of them. ?] </span><span class="line" data-startTime="2280">So the same thing that happens </span><span class="line" data-startTime="2280">on the vendor front should be </span><span class="line" data-startTime="2284">happening on that app front. </span> <span class="line" data-startTime="2285">And I'm sure it does. </span> <span class="line" data-startTime="2286">So the metric is scrolling </span><span class="line" data-startTime="2286">matches here. </span></p>

<p class="speaker"><span class="line" data-starttime="2291"><span class="speakerName">Chris Lord</span>: I think, on a slight </span><span class="line" data-startTime="2291">tangent, there are some </span><span class="line" data-startTime="2295">practical things that are worth </span><span class="line" data-startTime="2296">knowing before you even &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2300"><span class="speakerName">Matt Delaney</span>: 30 seconds. </span></p>

<p class="speaker"><span class="line" data-starttime="2301"><span class="speakerName">Chris Lord</span>: While you're </span><span class="line" data-startTime="2301">making a site. </span> <span class="line" data-startTime="2304">You should take these things </span><span class="line" data-startTime="2304">into consideration. </span> <span class="line" data-startTime="2306">So it's worth knowing to some </span><span class="line" data-startTime="2306">extent what things cause new </span><span class="line" data-startTime="2311">stacking context to be </span><span class="line" data-startTime="2311">created, for example. </span> <span class="line" data-startTime="2313">Because if you create a new </span><span class="line" data-startTime="2313">stacking context, likelihood </span><span class="line" data-startTime="2316">is you're going to create </span><span class="line" data-startTime="2316">a new layer, as well. </span> <span class="line" data-startTime="2318">Not necessarily, but it's a </span><span class="line" data-startTime="2318">reasonable kind of rule of </span><span class="line" data-startTime="2323">thumb to go by. </span> <span class="line" data-startTime="2324">Try and reduce the amount </span><span class="line" data-startTime="2324">of stacking context. </span> <span class="line" data-startTime="2327">Try to reduce the amount of, for </span><span class="line" data-startTime="2327">example, if you have text, </span><span class="line" data-startTime="2335">not having it on a solid </span><span class="line" data-startTime="2335">background means that you're </span><span class="line" data-startTime="2337">going to force alpha blending, </span><span class="line" data-startTime="2337">and you're going to force that </span><span class="line" data-startTime="2339">text to be rendered twice. </span></p>

<p><span class="line" data-startTime="2341">First optics or anti-aliasing, </span><span class="line" data-startTime="2341">maybe not on mobile. </span> <span class="line" data-startTime="2343">We'd probably just </span><span class="line" data-startTime="2343">use grayscale. </span> <span class="line" data-startTime="2345">But there are lots of little </span><span class="line" data-startTime="2345">things like this. </span> <span class="line" data-startTime="2348">Like if you're going to have </span><span class="line" data-startTime="2348">gradients in your backgrounds, </span><span class="line" data-startTime="2352">CSS gradients, don't change </span><span class="line" data-startTime="2352">them all the time. </span> <span class="line" data-startTime="2355">Don't resize them if </span><span class="line" data-startTime="2355">you can help it. </span> <span class="line" data-startTime="2359">Try and avoid fixed </span><span class="line" data-startTime="2359">backgrounds. </span> <span class="line" data-startTime="2362">Because again, you're going to </span><span class="line" data-startTime="2362">force the foreground layers to </span><span class="line" data-startTime="2364">have an alpha channel and force </span><span class="line" data-startTime="2364">blending and so on. </span></p>

<p><span class="line" data-startTime="2368">Just sort of small tips that &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2370"><span class="speakerName">Matt Delaney</span>: Lots of good </span><span class="line" data-startTime="2370">strategic advice there. </span><span class="line" data-startTime="2374">Move on to the next </span><span class="line" data-startTime="2374">one here, sorry. </span><span class="line" data-startTime="2375">So we've got a pretty </span><span class="line" data-startTime="2375">interesting question, I think, </span><span class="line" data-startTime="2378">from James Ford. </span><span class="line" data-startTime="2379">Kind of an age old question, </span><span class="line" data-startTime="2379">perhaps, but does using SVGs </span><span class="line" data-startTime="2382">and font icons for graphics over </span><span class="line" data-startTime="2382">GIFs and PINGs have an </span><span class="line" data-startTime="2385">impact on the performance </span><span class="line" data-startTime="2385">of a web page? </span><span class="line" data-startTime="2387">How about more from your actual </span><span class="line" data-startTime="2390">experience of using such? </span></p>

<p class="speaker"><span class="line" data-starttime="2393"><span class="speakerName">Chris Lord</span>: I was going to say </span><span class="line" data-startTime="2393">recently, we switched SVG to </span><span class="line" data-startTime="2398">rather than going from like a </span><span class="line" data-startTime="2398">single node in our display </span><span class="line" data-startTime="2401">list to using all of our </span><span class="line" data-startTime="2401">display list nodes. </span> <span class="line" data-startTime="2405">So if you have an SVG that's </span><span class="line" data-startTime="2405">got like 1,000 different </span><span class="line" data-startTime="2412">render nodes in it, then that </span><span class="line" data-startTime="2412">will be represented in our </span><span class="line" data-startTime="2415">display list. </span> <span class="line" data-startTime="2417">And we have open bugs. </span> <span class="line" data-startTime="2419">This did cause performance </span><span class="line" data-startTime="2419">issues. </span> <span class="line" data-startTime="2420">Because as you scroll through </span><span class="line" data-startTime="2420">the page and you expose new </span><span class="line" data-startTime="2423">areas of SVG, we have to iterate </span><span class="line" data-startTime="2423">that whole list, and </span><span class="line" data-startTime="2427">render it and sort it into </span><span class="line" data-startTime="2427">layers, decide which bits have </span><span class="line" data-startTime="2430">changed and which haven't </span><span class="line" data-startTime="2430">and so on. </span> <span class="line" data-startTime="2433">So yeah, SVGs are </span><span class="line" data-startTime="2433">going to be &mdash; </span><span class="line" data-startTime="2436">you can cache them. </span></p>

<p><span class="line" data-startTime="2438">But assuming that you're </span><span class="line" data-startTime="2438">using them for a reason </span><span class="line" data-startTime="2440">and you're not just &mdash; </span><span class="line" data-startTime="2441">I mean, if you weren't going </span><span class="line" data-startTime="2441">to plan on showing them at </span><span class="line" data-startTime="2445">different sizes or a site. </span> <span class="line" data-startTime="2451">Assuming that you are using </span><span class="line" data-startTime="2451">SVG for a reason and you </span><span class="line" data-startTime="2453">couldn't have just used a static </span><span class="line" data-startTime="2453">image kind of thing, </span><span class="line" data-startTime="2456">they are more expensive to use </span><span class="line" data-startTime="2456">than just static images. </span> <span class="line" data-startTime="2460">And the same with </span><span class="line" data-startTime="2460">fonts, as well. </span></p>

<p><span class="line" data-startTime="2461">Fonts are quite expensive </span><span class="line" data-startTime="2461">to render. </span> <span class="line" data-startTime="2465">So the answer is </span><span class="line" data-startTime="2465">yeah, I guess. </span> <span class="line" data-startTime="2468">They're more expensive. </span></p>

<p class="speaker"><span class="line" data-starttime="2469"><span class="speakerName">Audience</span>: So maybe one example </span><span class="line" data-startTime="2469">that I found recently, </span><span class="line" data-startTime="2471">actually the Apple site uses </span><span class="line" data-startTime="2471">SVGs quite well and badly. </span> <span class="line" data-startTime="2476">Well in the sense that they </span><span class="line" data-startTime="2476">use them everywhere, for </span><span class="line" data-startTime="2479">example for the logo </span><span class="line" data-startTime="2479">and all the rest. </span> <span class="line" data-startTime="2480">But I think what a lot of people </span><span class="line" data-startTime="2480">miss is a complex SVG </span><span class="line" data-startTime="2483">with a lot of paths is actually </span><span class="line" data-startTime="2483">very expensive, even </span><span class="line" data-startTime="2489">in network bytes. </span> <span class="line" data-startTime="2490">If you look at the complexity of </span><span class="line" data-startTime="2490">the SVGs that they use, you </span><span class="line" data-startTime="2494">can get like a 5x improvement if </span><span class="line" data-startTime="2494">you just save it as a PNG. </span> <span class="line" data-startTime="2497">So it's retina friendly, which </span><span class="line" data-startTime="2497">is what Apple wants. </span></p>

<p><span class="line" data-startTime="2501">But it's actually worse off for </span><span class="line" data-startTime="2501">like render time of your </span><span class="line" data-startTime="2504">page and network performance. </span></p>

<p class="speaker"><span class="line" data-starttime="2506"><span class="speakerName">Chris Lord</span>: Yeah. </span></p>

<p class="speaker"><span class="line" data-starttime="2508"><span class="speakerName">Rowan Beenje</span>: Does anyone have </span><span class="line" data-startTime="2508">any comparative information </span><span class="line" data-startTime="2511">about icon fonts versus SVG? </span></p>

<p class="speaker"><span class="line" data-starttime="2516"><span class="speakerName">Pavel Feldman</span>: We </span><span class="line" data-startTime="2516">need to measure. </span><span class="line" data-startTime="2517">And if we can't measure </span><span class="line" data-startTime="2517">it, we need to </span><span class="line" data-startTime="2519">make sure we can measure. </span><span class="line" data-startTime="2520">MATT DELANEY: [INAUDIBLE] </span><span class="line" data-startTime="2522">in the back? </span><span class="line" data-startTime="2531">Never mind. </span><span class="line" data-startTime="2537">No experience from </span><span class="line" data-startTime="2537">Facebook on this? </span><span class="line" data-startTime="2541">SHANE O'SULLIVAN: No experience </span><span class="line" data-startTime="2541">by me at Facebook </span><span class="line" data-startTime="2542">at the very least, no. </span></p>

<p class="speaker"><span class="line" data-starttime="2545"><span class="speakerName">Matt Delaney</span>: All right, so </span><span class="line" data-startTime="2545">let's move on to the next </span><span class="line" data-startTime="2547">question then. </span><span class="line" data-startTime="2547">A little bit of time </span><span class="line" data-startTime="2547">here left. </span><span class="line" data-startTime="2549">How much on the clock? </span><span class="line" data-startTime="2552">15? </span><span class="line" data-startTime="2553">So kind of a bit of a loaded </span><span class="line" data-startTime="2553">question, but how can I find </span><span class="line" data-startTime="2560">which CSS rules and properties </span><span class="line" data-startTime="2560">are expensive to render on a </span><span class="line" data-startTime="2563">particular page? </span><span class="line" data-startTime="2565">Is a next question, a little </span><span class="line" data-startTime="2565">bit of clarification. </span></p>

<p class="speaker"><span class="line" data-starttime="2569"><span class="speakerName">Pavel Feldman</span>: We are </span><span class="line" data-startTime="2569">working on that. </span> <span class="line" data-startTime="2571">But it's a hard one. </span> <span class="line" data-startTime="2572">You need to trace it all the way </span><span class="line" data-startTime="2572">from the CSS property to </span><span class="line" data-startTime="2576">the GL instruction or paint </span><span class="line" data-startTime="2576">instruction, Skia instruction. </span> <span class="line" data-startTime="2580">And it's a long way to go. </span> <span class="line" data-startTime="2582">There is a permanent solution, </span><span class="line" data-startTime="2582">though, that we've introduced </span><span class="line" data-startTime="2585">recently as an experiment. </span> <span class="line" data-startTime="2587">We can now put browser into the </span><span class="line" data-startTime="2587">continuous repaint mode, </span><span class="line" data-startTime="2591">where it continuously repaints, </span><span class="line" data-startTime="2591">even if it doesn't </span><span class="line" data-startTime="2594">need to, and it shows you the </span><span class="line" data-startTime="2594">frame rate it can do it at. </span> <span class="line" data-startTime="2598">And if you're not touching a </span><span class="line" data-startTime="2598">page, you can see that OK, </span><span class="line" data-startTime="2603">where it says number </span><span class="line" data-startTime="2603">of milliseconds, </span><span class="line" data-startTime="2605">it's paints per frame. </span></p>

<p><span class="line" data-startTime="2606">So it says, 3 milliseconds </span><span class="line" data-startTime="2606">per frame. </span> <span class="line" data-startTime="2609">That's a good frame. </span> <span class="line" data-startTime="2609">You'll achieve 60 </span><span class="line" data-startTime="2609">FPS with that. </span> <span class="line" data-startTime="2612">If it shows you 60, or 100 </span><span class="line" data-startTime="2612">milliseconds, then you can go </span><span class="line" data-startTime="2617">and bisect your DOM. </span> <span class="line" data-startTime="2618">So that's the best we can </span><span class="line" data-startTime="2618">offer at the moment. </span> <span class="line" data-startTime="2620">You go through DOM, </span><span class="line" data-startTime="2620">you hide things. </span> <span class="line" data-startTime="2623">It toggles visibility </span><span class="line" data-startTime="2623">to [INAUDIBLE]. </span> <span class="line" data-startTime="2625">And the number of milliseconds </span><span class="line" data-startTime="2625">reduce. </span> <span class="line" data-startTime="2627">And then you figure out what </span><span class="line" data-startTime="2627">is the part that was </span><span class="line" data-startTime="2631">statically positioned, or had </span><span class="line" data-startTime="2631">a complex background, or had </span><span class="line" data-startTime="2634">some gradient whatsoever. </span></p>

<p><span class="line" data-startTime="2637">It's a manual process. </span> <span class="line" data-startTime="2639">But it is already way </span><span class="line" data-startTime="2639">better than nothing. </span> <span class="line" data-startTime="2642">SHANE O'SULLIVAN: Will this help </span><span class="line" data-startTime="2642">in the case where you're </span><span class="line" data-startTime="2646">showing and hiding things, but </span><span class="line" data-startTime="2646">let's say I modify something </span><span class="line" data-startTime="2648">that will trigger both a </span><span class="line" data-startTime="2648">repaint and a reflow. </span> <span class="line" data-startTime="2651">Does this capture it </span><span class="line" data-startTime="2651">in that second? </span></p>

<p class="speaker"><span class="line" data-starttime="2654"><span class="speakerName">Pavel Feldman</span>: So this one </span><span class="line" data-startTime="2654">is only about paint. </span><span class="line" data-startTime="2656">And paint meaning layout </span><span class="line" data-startTime="2656">does not change. </span><span class="line" data-startTime="2659">DOM does not change. </span><span class="line" data-startTime="2660">So it's only about CSS </span><span class="line" data-startTime="2660">and DOM that you have </span><span class="line" data-startTime="2662">presented on the screen. </span><span class="line" data-startTime="2665">For the rest of the </span><span class="line" data-startTime="2665">information, </span><span class="line" data-startTime="2666">you go to the timeline. </span><span class="line" data-startTime="2669">There are similar techniques </span><span class="line" data-startTime="2669">on figuring out the recalc </span><span class="line" data-startTime="2673">style or layout performance. </span><span class="line" data-startTime="2675">They often end up </span><span class="line" data-startTime="2675">with bisecting, </span><span class="line" data-startTime="2678">unfortunately, as well. </span><span class="line" data-startTime="2679">And we're working on </span><span class="line" data-startTime="2679">improving that. </span><span class="line" data-startTime="2683">SHANE O'SULLIVAN: Anything cool </span><span class="line" data-startTime="2683">coming up in Firefox? </span></p>

<p class="speaker"><span class="line" data-starttime="2686"><span class="speakerName">Chris Lord</span>: Not much </span><span class="line" data-startTime="2686">to add, really. </span><span class="line" data-startTime="2689">On mobile, I guess, it's worth </span><span class="line" data-startTime="2689">considering that certain pages </span><span class="line" data-startTime="2695">and complex pages, and on </span><span class="line" data-startTime="2695">certain mobile devices, it's </span><span class="line" data-startTime="2698">really not feasible to expect </span><span class="line" data-startTime="2698">the page to render very </span><span class="line" data-startTime="2702">quickly, as in within a </span><span class="line" data-startTime="2702">reasonable 60 hertz or 30 </span><span class="line" data-startTime="2707">hertz time frame. </span><span class="line" data-startTime="2709">But we have asynchronous </span><span class="line" data-startTime="2709">compositing to counter that. </span><span class="line" data-startTime="2712">And what your goal then really </span><span class="line" data-startTime="2712">is to kind of do your work at </span><span class="line" data-startTime="2716">clever times, and partition it </span><span class="line" data-startTime="2716">in clever ways so that you </span><span class="line" data-startTime="2720">don't interrupt the asynchronous </span><span class="line" data-startTime="2720">compositing at </span><span class="line" data-startTime="2723">inopportune times, </span><span class="line" data-startTime="2723">or for too long. </span></p>

<p class="speaker"><span class="line" data-starttime="2731"><span class="speakerName">Matt Delaney</span>: We're on to </span><span class="line" data-startTime="2731">the next question here. </span> <span class="line" data-startTime="2732">So this is perhaps a little </span><span class="line" data-startTime="2732">bit redundant, but it's </span><span class="line" data-startTime="2736">interesting to get the </span><span class="line" data-startTime="2736">perspective real quick from </span><span class="line" data-startTime="2738">both the Chrome and </span><span class="line" data-startTime="2738">Firefox person. </span> <span class="line" data-startTime="2741">So we use translateZ(0) to </span><span class="line" data-startTime="2741">trigger hardware rendering, as </span><span class="line" data-startTime="2745">people think. </span> <span class="line" data-startTime="2746">Should we have an API to </span><span class="line" data-startTime="2746">explicitly do this? </span><span class="line" data-startTime="2748">So this is obviously </span><span class="line" data-startTime="2748">a bit tough. </span> <span class="line" data-startTime="2751">And I think we can get some </span><span class="line" data-startTime="2751">audience input to this. </span> <span class="line" data-startTime="2753">But should there be, perhaps in </span><span class="line" data-startTime="2753">general, any feedback from </span><span class="line" data-startTime="2757">the app side to get a little </span><span class="line" data-startTime="2757">bit of hopeful kick into </span><span class="line" data-startTime="2763">acceleration? </span><span class="line" data-startTime="2764">Because if people are using </span><span class="line" data-startTime="2764">this, and they're finding it </span><span class="line" data-startTime="2766">to good effect, is it something </span><span class="line" data-startTime="2766">that maybe we want </span><span class="line" data-startTime="2770">to make more real? </span></p>

<p class="speaker"><span class="line" data-starttime="2772"><span class="speakerName">Pavel Feldman</span>: So I think Paul </span><span class="line" data-startTime="2772">and Alex have already covered </span><span class="line" data-startTime="2774">this one from the platform </span><span class="line" data-startTime="2774">perspective. </span><span class="line" data-startTime="2778">When you were talking to GC, </span><span class="line" data-startTime="2778">many things applied to this </span><span class="line" data-startTime="2780">thing as well. </span></p>

<p class="speaker"><span class="line" data-starttime="2784"><span class="speakerName">Chris Lord</span>: Yeah. </span><span class="line" data-startTime="2784">This has come up a few times, </span><span class="line" data-startTime="2784">really, like do we want apps </span><span class="line" data-startTime="2788">to be able to hint to </span><span class="line" data-startTime="2788">GC when to collect? </span><span class="line" data-startTime="2791">And do we want &mdash; </span><span class="line" data-startTime="2793">it's like every bit of control </span><span class="line" data-startTime="2793">that you add is kind of &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2798"><span class="speakerName">Matt Delaney</span>: From your work </span><span class="line" data-startTime="2798">on Android, have you found </span><span class="line" data-startTime="2801">times where it would've been </span><span class="line" data-startTime="2801">more useful for the app </span><span class="line" data-startTime="2802">developer to give you a hint </span><span class="line" data-startTime="2802">that they need that? </span></p>

<p class="speaker"><span class="line" data-starttime="2806"><span class="speakerName">Chris Lord</span>: Not really, </span><span class="line" data-startTime="2806">I guess. </span> <span class="line" data-startTime="2809">I think really, we should </span><span class="line" data-startTime="2809">just be cleverer </span><span class="line" data-startTime="2811">about doing these things. </span> <span class="line" data-startTime="2813">I think if you put that kind of </span><span class="line" data-startTime="2813">control into users' hands, </span><span class="line" data-startTime="2816">things are going to change too </span><span class="line" data-startTime="2816">much pretty quickly, to the </span><span class="line" data-startTime="2819">point where it would </span><span class="line" data-startTime="2819">just force bad </span><span class="line" data-startTime="2821">behavior in future versions. </span> <span class="line" data-startTime="2826">SHANE O'SULLIVAN: From the point </span><span class="line" data-startTime="2826">of view of people who </span><span class="line" data-startTime="2827">write apps, yes, it </span><span class="line" data-startTime="2827">would be lovely. </span> <span class="line" data-startTime="2831">I don't know if it's </span><span class="line" data-startTime="2831">feasible or not. </span> <span class="line" data-startTime="2833">It's just that on the web, as </span><span class="line" data-startTime="2833">everybody knows, one of the </span><span class="line" data-startTime="2836">reasons we're sitting here right </span><span class="line" data-startTime="2836">now is that performance </span><span class="line" data-startTime="2839">is a problem. </span> <span class="line" data-startTime="2841">And on some of the platforms, </span><span class="line" data-startTime="2841">you do have the option of </span><span class="line" data-startTime="2844">dropping down to a lower level </span><span class="line" data-startTime="2844">if you need to, and if you </span><span class="line" data-startTime="2848">have people who are </span><span class="line" data-startTime="2848">sufficiently good </span><span class="line" data-startTime="2849">enough to do so. </span></p>

<p><span class="line" data-startTime="2851">And I don't know if that's </span><span class="line" data-startTime="2851">feasible on the web. </span> <span class="line" data-startTime="2854">It would be nice if it was. </span> <span class="line" data-startTime="2856">I admit, things change </span><span class="line" data-startTime="2856">all the time. </span> <span class="line" data-startTime="2857">We're constantly updating our </span><span class="line" data-startTime="2857">browsers, or even updating </span><span class="line" data-startTime="2859">them in the background now. </span> <span class="line" data-startTime="2860">So things do change </span><span class="line" data-startTime="2860">all the time. </span> <span class="line" data-startTime="2861">And even on iOS, things </span><span class="line" data-startTime="2861">change once a year. </span> <span class="line" data-startTime="2865">So yes, it would probably </span><span class="line" data-startTime="2865">break everything. </span> <span class="line" data-startTime="2868">But when you try to do smart </span><span class="line" data-startTime="2868">things in general, often </span><span class="line" data-startTime="2876">you're going to be missing </span><span class="line" data-startTime="2876">an edge case. </span> <span class="line" data-startTime="2879">And an edge case could be 25% </span><span class="line" data-startTime="2879">of all implementations. </span></p>

<p><span class="line" data-startTime="2882">So I don't know. </span> <span class="line" data-startTime="2884">If there was a way to drop down </span><span class="line" data-startTime="2884">lower and just say look, </span><span class="line" data-startTime="2886">I know what I'm doing, trust </span><span class="line" data-startTime="2886">me, it would be great. </span> <span class="line" data-startTime="2889">Like I said, you can do it </span><span class="line" data-startTime="2889">on native platforms. </span></p>

<p class="speaker"><span class="line" data-starttime="2892"><span class="speakerName">Chris Lord</span>: I guess you've </span><span class="line" data-startTime="2892">got Canvas and WebGL. </span><span class="line" data-startTime="2895">You can do it like that. </span><span class="line" data-startTime="2897">SHANE O'SULLIVAN: True. </span></p>

<p class="speaker"><span class="line" data-starttime="2901"><span class="speakerName">Matt Delaney</span>: Is there </span><span class="line" data-startTime="2901">maybe time for one </span><span class="line" data-startTime="2902">more question here? </span><span class="line" data-startTime="2905">So the question from Christina </span><span class="line" data-startTime="2905">Auckland, from Hampshire, is </span><span class="line" data-startTime="2909">there an overhead to using </span><span class="line" data-startTime="2909">media queries, especially </span><span class="line" data-startTime="2911">bubbling media queries in </span><span class="line" data-startTime="2911">your experience, guys? </span></p>

<p class="speaker"><span class="line" data-starttime="2917"><span class="speakerName">Pavel Feldman</span>: I don't know. </span></p>

<p class="speaker"><span class="line" data-starttime="2919"><span class="speakerName">Chris Lord</span>: No idea. </span><span class="line" data-startTime="2920">SHANE O'SULLIVAN: Not a clue. </span></p>

<p class="speaker"><span class="line" data-starttime="2922"><span class="speakerName">Matt Delaney</span>: Then one </span><span class="line" data-startTime="2922">more question. </span><span class="line" data-startTime="2928">Oh man. </span><span class="line" data-startTime="2929">Nope. </span><span class="line" data-startTime="2932">We talked about this question </span><span class="line" data-startTime="2932">for about five hours last </span><span class="line" data-startTime="2935">night, off and on, like </span><span class="line" data-startTime="2935">beating a dead horse. </span><span class="line" data-startTime="2939">Would it be possible to </span><span class="line" data-startTime="2939">accelerate reflows, hardware </span><span class="line" data-startTime="2942">accelerate? </span><span class="line" data-startTime="2943">So I think this question's a </span><span class="line" data-startTime="2943">bit confused into what it's </span><span class="line" data-startTime="2946">asking, perhaps. </span><span class="line" data-startTime="2947">But it did bring up some </span><span class="line" data-startTime="2947">interesting things last night. </span><span class="line" data-startTime="2949">So give you a moment to just </span><span class="line" data-startTime="2949">talk about what reflows are, </span><span class="line" data-startTime="2952">perhaps from you guys, and how </span><span class="line" data-startTime="2952">that may possibly be hardware </span><span class="line" data-startTime="2956">accelerated. </span></p>

<p class="speaker"><span class="line" data-starttime="2957"><span class="speakerName">Pavel Feldman</span>: I think Google </span><span class="line" data-startTime="2957">is definitely hiring. </span><span class="line" data-startTime="2959">So if someone has some bright </span><span class="line" data-startTime="2959">ideas on that, they'd be </span><span class="line" data-startTime="2962">definitely interested. </span></p>

<p class="speaker"><span class="line" data-starttime="2963"><span class="speakerName">Chris Lord</span>: Ditto. </span> <span class="line" data-startTime="2966">I guess, yeah, I think </span><span class="line" data-startTime="2966">the question </span><span class="line" data-startTime="2967">might be slightly confused. </span> <span class="line" data-startTime="2969">So to kind of go to semi-fast </span><span class="line" data-startTime="2969">principles, I'm going to </span><span class="line" data-startTime="2973">assume that DOM tree is </span><span class="line" data-startTime="2973">something that we all know. </span> <span class="line" data-startTime="2977">But browsers tend to, after you </span><span class="line" data-startTime="2977">get a DOM tree, it will </span><span class="line" data-startTime="2980">get passed into a frame tree, </span><span class="line" data-startTime="2980">which is a better </span><span class="line" data-startTime="2982">representation of how </span><span class="line" data-startTime="2982">it will get drawn. </span> <span class="line" data-startTime="2985">And then the frame tree will get </span><span class="line" data-startTime="2985">processed, where it will </span><span class="line" data-startTime="2988">calculate where the position </span><span class="line" data-startTime="2988">and size of things are. </span></p>

<p><span class="line" data-startTime="2991">And that bit is the reflow. </span> <span class="line" data-startTime="2993">So when you change something </span><span class="line" data-startTime="2993">that causes a size to change, </span><span class="line" data-startTime="2996">then reflow needs to happen. </span> <span class="line" data-startTime="2998">Because the size of certain </span><span class="line" data-startTime="2998">elements will be dependent on </span><span class="line" data-startTime="3000">the other elements. </span> <span class="line" data-startTime="3002">I say elements, that's </span><span class="line" data-startTime="3002">not quite true. </span> <span class="line" data-startTime="3003">Because we're in the </span><span class="line" data-startTime="3003">frame tree now, but </span><span class="line" data-startTime="3006">for the most part. </span> <span class="line" data-startTime="3008">So that's not something </span><span class="line" data-startTime="3008">you could put on &mdash; </span><span class="line" data-startTime="3012">I mean, you could put it </span><span class="line" data-startTime="3012">on the GPU, I guess. </span> <span class="line" data-startTime="3013">But it'd be pretty pointless. </span> <span class="line" data-startTime="3016">All of that is in </span><span class="line" data-startTime="3016">system memory. </span> <span class="line" data-startTime="3017">So you'd be shoving that over </span><span class="line" data-startTime="3017">to GP memory, and writing a </span><span class="line" data-startTime="3020">really complex set of shaders, </span><span class="line" data-startTime="3020">I guess, to work on it. </span> <span class="line" data-startTime="3025">And then shovel it back. </span></p>

<p><span class="line" data-startTime="3027">Basically, the answer is no. </span> <span class="line" data-startTime="3029">But maybe there are some other </span><span class="line" data-startTime="3029">things that we're not </span><span class="line" data-startTime="3034">accelerating right now that we </span><span class="line" data-startTime="3034">could, which might be an </span><span class="line" data-startTime="3036">interesting question. </span> <span class="line" data-startTime="3037">So from the frame tree, Firefox, </span><span class="line" data-startTime="3037">or Gecko rather, will </span><span class="line" data-startTime="3042">make a display list which </span><span class="line" data-startTime="3042">represents how it </span><span class="line" data-startTime="3045">would draw the page. </span> <span class="line" data-startTime="3046">And then it processes the </span><span class="line" data-startTime="3046">display list to create the </span><span class="line" data-startTime="3048">layer tree. </span> <span class="line" data-startTime="3049">And I think a similar process </span><span class="line" data-startTime="3049">happens in WebKit, possibly </span><span class="line" data-startTime="3052">minus display list or depending </span><span class="line" data-startTime="3052">on what fork you're </span><span class="line" data-startTime="3055">using, judging from the </span><span class="line" data-startTime="3055">conversation last night. </span></p>

<p><span class="line" data-startTime="3060">Are there other things that </span><span class="line" data-startTime="3060">we could accelerate, maybe </span><span class="line" data-startTime="3063">between those things or like </span><span class="line" data-startTime="3063">during that thing? </span><span class="line" data-startTime="3065">So for Firefox, most of </span><span class="line" data-startTime="3065">the rendering will </span><span class="line" data-startTime="3069">happen on your CPU. </span> <span class="line" data-startTime="3071">Certain things will be hardware </span><span class="line" data-startTime="3071">accelerated, like </span><span class="line" data-startTime="3074">drawing a big image. </span> <span class="line" data-startTime="3075">That might end up being uploaded </span><span class="line" data-startTime="3075">to the GPU and </span><span class="line" data-startTime="3078">scaled, for example, </span><span class="line" data-startTime="3078">in the GPU. </span> <span class="line" data-startTime="3080">Or transforms happen on GPU. </span> <span class="line" data-startTime="3083">Blending happens on the GPU. </span> <span class="line" data-startTime="3084">But maybe there are other </span><span class="line" data-startTime="3084">things that could </span><span class="line" data-startTime="3086">happen on the GPU. </span> <span class="line" data-startTime="3087">Like we don't draw gradients </span><span class="line" data-startTime="3087">on the GPU at the moment. </span></p>

<p><span class="line" data-startTime="3090">And gradients are a huge hit. </span> <span class="line" data-startTime="3092">That's something we </span><span class="line" data-startTime="3092">could do, maybe. </span> <span class="line" data-startTime="3094">And other elements as well. </span> <span class="line" data-startTime="3096">There might be other element </span><span class="line" data-startTime="3096">types that would be able to </span><span class="line" data-startTime="3099">take advantage of hardware </span><span class="line" data-startTime="3099">accelerated rendering. </span></p>

<p class="speaker"><span class="line" data-starttime="3103"><span class="speakerName">Pavel Feldman</span>: Another hint is </span><span class="line" data-startTime="3103">that if you're experiencing </span><span class="line" data-startTime="3106">really slowly, most likely you </span><span class="line" data-startTime="3106">are doing a total reflow. </span> <span class="line" data-startTime="3110">And in WebKit, you are doing </span><span class="line" data-startTime="3110">total reflow if your layout </span><span class="line" data-startTime="3113">root is root of the document. </span> <span class="line" data-startTime="3115">Which means in this very </span><span class="line" data-startTime="3115">message, you mutated two ports </span><span class="line" data-startTime="3118">of non-intersecting DOMs. </span> <span class="line" data-startTime="3121">And they ended up being </span><span class="line" data-startTime="3121">the root layout. </span> <span class="line" data-startTime="3125">So you figure out what </span><span class="line" data-startTime="3125">your layout root is. </span> <span class="line" data-startTime="3129">There are simple rules to follow </span><span class="line" data-startTime="3129">to make your element </span><span class="line" data-startTime="3132">layout root. </span> <span class="line" data-startTime="3133">And make sure you </span><span class="line" data-startTime="3133">don't screw it. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="3141"><span class="speakerName">Chris Lord</span>: I think we've kind </span><span class="line" data-startTime="3141">of mentioned this already. </span> <span class="line" data-startTime="3143">But just in case, a lot of the </span><span class="line" data-startTime="3143">optimizations that happen on </span><span class="line" data-startTime="3148">the kind of rendering process </span><span class="line" data-startTime="3148">are to do with delaying tasks </span><span class="line" data-startTime="3153">and splitting them up. </span> <span class="line" data-startTime="3154">So things like, if you can make </span><span class="line" data-startTime="3154">everything like a set </span><span class="line" data-startTime="3159">width and height, and never move </span><span class="line" data-startTime="3159">it, that would be great. </span> <span class="line" data-startTime="3163">But if you do have need to </span><span class="line" data-startTime="3163">change something, like if you </span><span class="line" data-startTime="3168">change the width of something, </span><span class="line" data-startTime="3168">that is going to trigger a </span><span class="line" data-startTime="3172">reflow probably at some point. </span> <span class="line" data-startTime="3175">But that point could be any time </span><span class="line" data-startTime="3175">between the time you do </span><span class="line" data-startTime="3178">it and the time that </span><span class="line" data-startTime="3178">the frame comes. </span> <span class="line" data-startTime="3180">And stuff might happen </span><span class="line" data-startTime="3180">in between. </span> <span class="line" data-startTime="3182">And if possible, we'll coalesce </span><span class="line" data-startTime="3182">these reflows. </span> <span class="line" data-startTime="3186">On the other hand, if you change </span><span class="line" data-startTime="3186">a width, and then you </span><span class="line" data-startTime="3188">immediately read back the </span><span class="line" data-startTime="3188">width of an element that </span><span class="line" data-startTime="3191">depended on that width, you're </span><span class="line" data-startTime="3191">forcing that reflow to happen </span><span class="line" data-startTime="3194">immediately. </span> <span class="line" data-startTime="3195">And then if you change something </span><span class="line" data-startTime="3195">after that, then </span><span class="line" data-startTime="3198">you've got a double </span><span class="line" data-startTime="3198">reflow situation. </span></p>

<p><span class="line" data-startTime="3201">So I guess an attempt to maybe </span><span class="line" data-startTime="3201">batch stuff is a sort of </span><span class="line" data-startTime="3206">general tip to avoid that. </span></p>

<p class="speaker"><span class="line" data-starttime="3207"><span class="speakerName">Pavel Feldman</span>: Yeah, so to add </span><span class="line" data-startTime="3207">to that, we've often seen five </span><span class="line" data-startTime="3212">total reflows happen </span><span class="line" data-startTime="3212">within a frame. </span><span class="line" data-startTime="3214">So it's not that the </span><span class="line" data-startTime="3214">reflow is slow. </span><span class="line" data-startTime="3216">It's that it's continuously </span><span class="line" data-startTime="3216">happening </span><span class="line" data-startTime="3218">within the same message. </span><span class="line" data-startTime="3219">And we have good </span><span class="line" data-startTime="3219">tools for that. </span><span class="line" data-startTime="3222">We will show you all the </span><span class="line" data-startTime="3222">layouts, and we will show you </span><span class="line" data-startTime="3225">[INAUDIBLE] stacks that </span><span class="line" data-startTime="3225">invalidated re-layout, and </span><span class="line" data-startTime="3228">that forced it. </span><span class="line" data-startTime="3229">And you can see a continuous </span><span class="line" data-startTime="3229">invocation of </span><span class="line" data-startTime="3231">like five of them. </span><span class="line" data-startTime="3232">And you cut it into a single </span><span class="line" data-startTime="3232">one, and all of a sudden your </span><span class="line" data-startTime="3236">performance is OK again. </span></p>

<p class="speaker"><span class="line" data-starttime="3240"><span class="speakerName">Matt Delaney</span>: So actually, real </span><span class="line" data-startTime="3240">final question here from </span><span class="line" data-startTime="3243">the audience is from Paul </span><span class="line" data-startTime="3243">Kinlan, he says, yes, does </span><span class="line" data-startTime="3246">scrolling performance in </span><span class="line" data-startTime="3246">client-side performance affect </span><span class="line" data-startTime="3249">the time on the site, balance </span><span class="line" data-startTime="3249">rate, et cetera? </span><span class="line" data-startTime="3251">And Shane was actually talking </span><span class="line" data-startTime="3251">about something pretty </span><span class="line" data-startTime="3252">interesting last night about </span><span class="line" data-startTime="3252">what he's seen from Facebook's </span><span class="line" data-startTime="3256">perspective. </span> <span class="line" data-startTime="3256">SHANE O'SULLIVAN: Yeah, I kind </span><span class="line" data-startTime="3256">of mentioned it a bit earlier. </span></p>

<p><span class="line" data-startTime="3259">But yeah, it absolutely does. </span> <span class="line" data-startTime="3260">What we find on Facebook is that </span><span class="line" data-startTime="3260">regardless of what you </span><span class="line" data-startTime="3264">do, people have kind of assigned </span><span class="line" data-startTime="3264">a certain amount of </span><span class="line" data-startTime="3267">time every day to spend </span><span class="line" data-startTime="3267">on the site. </span> <span class="line" data-startTime="3269">And the more things that you can </span><span class="line" data-startTime="3269">get them to do within say, </span><span class="line" data-startTime="3275">they only spend 20 </span><span class="line" data-startTime="3275">minutes a day. </span> <span class="line" data-startTime="3277">And if you can show them twice </span><span class="line" data-startTime="3277">as many pages during that day, </span><span class="line" data-startTime="3281">then it will do twice </span><span class="line" data-startTime="3281">as many things. </span> <span class="line" data-startTime="3283">The same goes for if people tend </span><span class="line" data-startTime="3283">to scroll down, we found </span><span class="line" data-startTime="3288">that when they scroll more, </span><span class="line" data-startTime="3288">they see more stories. </span></p>

<p><span class="line" data-startTime="3290">They click like more, they </span><span class="line" data-startTime="3290">comment on more things. </span> <span class="line" data-startTime="3293">They see people's faces, </span><span class="line" data-startTime="3293">and the site </span><span class="line" data-startTime="3295">sends them more messages. </span> <span class="line" data-startTime="3296">And when we did add friction </span><span class="line" data-startTime="3296">to scrolling, when we added </span><span class="line" data-startTime="3302">varying scroll rates, or when </span><span class="line" data-startTime="3302">we added consistently slow </span><span class="line" data-startTime="3305">scroll rates, as soon as we made </span><span class="line" data-startTime="3305">anything non-optimal when </span><span class="line" data-startTime="3309">it comes to scrolling, then </span><span class="line" data-startTime="3309">people often might stay on the </span><span class="line" data-startTime="3313">site as long. </span> <span class="line" data-startTime="3314">So it didn't really affect </span><span class="line" data-startTime="3314">bounce rates. </span> <span class="line" data-startTime="3315">But they would do far fewer </span><span class="line" data-startTime="3315">things, which is why we spend </span><span class="line" data-startTime="3319">so much time obsessing </span><span class="line" data-startTime="3319">about scroll rates. </span> <span class="line" data-startTime="3323">So scroll rates directly affect </span><span class="line" data-startTime="3323">user engagement on </span><span class="line" data-startTime="3327">native, on wave, </span><span class="line" data-startTime="3327">on everything. </span> <span class="line" data-startTime="3331">Which means our basic site, </span><span class="line" data-startTime="3331">which only serves HTML and </span><span class="line" data-startTime="3334">goes on to Nokia phones, gets </span><span class="line" data-startTime="3334">fantastic engagement if you </span><span class="line" data-startTime="3337">put it on an iPhone. </span></p>

<p><span class="line" data-startTime="3339">It's extremely fast. </span> <span class="line" data-startTime="3340">It's tiny. </span> <span class="line" data-startTime="3341">It looks ugly. </span> <span class="line" data-startTime="3341">And people engage with it </span><span class="line" data-startTime="3341">really, really quickly. </span> <span class="line" data-startTime="3344">And you know what? </span><span class="line" data-startTime="3345">It scrolls at 60 frames </span><span class="line" data-startTime="3345">per second. </span> <span class="line" data-startTime="3347">Because there's no JavaScript. </span> <span class="line" data-startTime="3351">Yeah, who knew? </span></p>

<p class="speaker"><span class="line" data-starttime="3354"><span class="speakerName">Matt Delaney</span>: Any </span><span class="line" data-startTime="3354">last thoughts? </span></p>

<p class="speaker"><span class="line" data-starttime="3359"><span class="speakerName">Chris Lord</span>: Not really. </span> <span class="line" data-startTime="3361">Maybe it'd be nice, like </span><span class="line" data-startTime="3361">we're talking a lot </span><span class="line" data-startTime="3364">about scrolling here. </span> <span class="line" data-startTime="3364">It's obviously very important. </span> <span class="line" data-startTime="3366">And scroll behavior differs </span><span class="line" data-startTime="3366">between basically every mobile </span><span class="line" data-startTime="3370">browser in quite big ways. </span> <span class="line" data-startTime="3374">Maybe this is something we </span><span class="line" data-startTime="3374">should be, or should have been </span><span class="line" data-startTime="3376">collaborating on before. </span> <span class="line" data-startTime="3380">Maybe there should be an API </span><span class="line" data-startTime="3380">for that, like some kind of </span><span class="line" data-startTime="3382">meta tag or something. </span> <span class="line" data-startTime="3385">SHANE O'SULLIVAN: I heard Chrome </span><span class="line" data-startTime="3385">team were going to </span><span class="line" data-startTime="3387">start looking at scroll </span><span class="line" data-startTime="3387">performance as something to </span><span class="line" data-startTime="3391">instrument, or something </span><span class="line" data-startTime="3391">like that. </span></p>

<p class="speaker"><span class="line" data-starttime="3393"><span class="speakerName">Pavel Feldman</span>: Yeah, so that </span><span class="line" data-startTime="3393">telemeter that I was talking </span><span class="line" data-startTime="3395">about is the regression testing </span><span class="line" data-startTime="3395">for the scrolling </span><span class="line" data-startTime="3398">performance. </span> <span class="line" data-startTime="3399">And there is a huge scrolling </span><span class="line" data-startTime="3399">effort that, among other </span><span class="line" data-startTime="3402">things, moved the painting to </span><span class="line" data-startTime="3402">the impulse side, including </span><span class="line" data-startTime="3407">the image decode and resize. </span> <span class="line" data-startTime="3409">And that's already available </span><span class="line" data-startTime="3409">on Chrome for Android now. </span> <span class="line" data-startTime="3413">Yeah, it's already enabled </span><span class="line" data-startTime="3413">for Chrome for Android. </span> <span class="line" data-startTime="3416">It's in the About Flags </span><span class="line" data-startTime="3416">on the desktop Chrome. </span> <span class="line" data-startTime="3418">So you can take a </span><span class="line" data-startTime="3418">look at that. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="3421"><span class="speakerName">Chris Lord</span>: Sorry, and </span><span class="line" data-startTime="3421">one last thing I just </span><span class="line" data-startTime="3424">remembered as well. </span> <span class="line" data-startTime="3425">In the Firefox built in profile, </span><span class="line" data-startTime="3425">we have a mode that </span><span class="line" data-startTime="3429">we call junk mode, the </span><span class="line" data-startTime="3429">like ticker box. </span> <span class="line" data-startTime="3433">And then when you start the </span><span class="line" data-startTime="3433">profiler and you do some </span><span class="line" data-startTime="3435">stuff, and you stop it, it </span><span class="line" data-startTime="3435">will basically show you &mdash; </span><span class="line" data-startTime="3439">it will highlight on </span><span class="line" data-startTime="3439">the profile exactly </span><span class="line" data-startTime="3441">any hitches in panning. </span> <span class="line" data-startTime="3443">So any frame that took longer </span><span class="line" data-startTime="3443">than 16 milliseconds or </span><span class="line" data-startTime="3447">whatever to draw. </span> <span class="line" data-startTime="3448">You can drill down into just the </span><span class="line" data-startTime="3448">operations that were going </span><span class="line" data-startTime="3451">on during that frame. </span> <span class="line" data-startTime="3452">And I think, no yeah, </span><span class="line" data-startTime="3452">I'm sure, that </span><span class="line" data-startTime="3456">profiler works over ADB. </span> <span class="line" data-startTime="3461">So you can run it on your phone </span><span class="line" data-startTime="3461">and profile it on the </span><span class="line" data-startTime="3464">desktop, which is </span><span class="line" data-startTime="3464">pretty handy. </span></p>

<p><span class="line" data-startTime="3466">So just letting you know. </span></p>

<p class="speaker"><span class="line" data-starttime="3471"><span class="speakerName">Matt Delaney</span>: So thanks. </span><span class="line" data-startTime="3471">That was Performance Channel. </span></p></div>