<style>* {font-family: "Open Sans", sans-serif}
a {color: #77aaff}
a.video {border-bottom: 1px solid #ddd; display: block; margin: 0 0 2em 0; padding: 0 0 2em 0}
h2 {color: #444; font-size: 18px;}
span.speakerName {color: black; font-weight: 900;}
body {padding: 2em}
p {color: #444; margin: 0; text-indent: 1.5em;}
p.speaker {margin: 1em 0 0 0; text-indent: 0;}
div#transcript > p:first-child {text-indent: 0;}
</style>

<h1>Google I/O 2012 &mdash; Jank Busters: Building Performant Web Apps</h1>

<h2>Nat Duca, Tom Tom Wiltzius, Tom Wiltzius</h2>

<a class="video" href="http://youtu.be/hAzhayTnhEI">youtu.be/hAzhayTnhEI</a><div id="transcript"><p class="speaker"><span class="line" data-starttime="2"><span class="speakerName">Nat Duca</span>: All right. It's time to talk about </span><span class="line" data-startTime="2">jank, everybody. </span> <span class="line" data-startTime="8">Before I even do introductions, which is what </span><span class="line" data-startTime="8">usually comes first, I want to actually teach </span><span class="line" data-startTime="14">you the word jank. </span> <span class="line" data-startTime="14">Jank spotting, right? We all should do it, </span><span class="line" data-startTime="19">and that's the first part of this talk. </span> <span class="line" data-startTime="19">So if you go to HTML5 Rocks, hopefully everybody </span><span class="line" data-startTime="24">has done this. It's a great resource. And </span><span class="line" data-startTime="24">you scroll up and down in an article, sometimes </span><span class="line" data-startTime="30">it janks. And especially on bigger screens </span><span class="line" data-startTime="30">or slower computers, it feels yucky. </span> <span class="line" data-startTime="36">Now, let's define yucky. Watch the scroll </span><span class="line" data-startTime="36">bar as I scroll. See how it jumps? Watch on </span><span class="line" data-startTime="44">your own computer. Scroll up and down. That's </span><span class="line" data-startTime="44">jank. It's the screen not updating in some </span><span class="line" data-startTime="48">way. </span> <span class="line" data-startTime="48">So the purpose of our talk today is to get </span><span class="line" data-startTime="53">you, so that when you walk out the door, you </span><span class="line" data-startTime="53">can make your site or HTML5 Rocks, take your </span><span class="line" data-startTime="58">pick, so that when I do the same thing, no </span><span class="line" data-startTime="58">jank. Right? </span><span class="line" data-startTime="63">This is our goal. I hope we succeed at it. </span></p>

<p><span class="line" data-startTime="63">The reason that we're up here is we work on </span><span class="line" data-startTime="68">jank all the time. I'm Nat Duca, I'm on the </span><span class="line" data-startTime="68">Chrome Developer team. I work on the rendering </span><span class="line" data-startTime="75">engine for Chrome, GPU, 60 frames a second, </span><span class="line" data-startTime="75">blah-blah-blah. </span></p>

<p class="speaker"><span class="line" data-starttime="76"><span class="speakerName">Tom Tom Wiltzius</span>: I'm Tom Wiltzius, I'm the </span><span class="line" data-startTime="76">project manager on the Chrome graphics team </span><span class="line" data-startTime="79">thinking about all the same stuff. </span></p>

<p class="speaker"><span class="line" data-starttime="79"><span class="speakerName">Nat Duca</span>: So we care a lot about this and </span><span class="line" data-startTime="84">we want you to as well. </span><span class="line" data-startTime="84">So a nice smooth Web app is about feeding </span><span class="line" data-startTime="91">your display. So you've got many displays </span><span class="line" data-startTime="91">surrounding you. These are displays. </span><span class="line" data-startTime="97">There's a lot of variety as it turns out. </span><span class="line" data-startTime="97">For various reasons, for budget reasons, for </span><span class="line" data-startTime="103">power reasons, different screens update at </span><span class="line" data-startTime="103">different rates. </span><span class="line" data-startTime="106">Now, what is this update thing? </span><span class="line" data-startTime="106">You've heard the word vsync thrown around </span><span class="line" data-startTime="110">over the course of I/O a few times. And what </span><span class="line" data-startTime="110">this is is your screen is going to pull into </span><span class="line" data-startTime="114">memory somewhere and just pull out picture </span><span class="line" data-startTime="114">from the GPU or whatever and put it up on </span><span class="line" data-startTime="119">either the LCD or the CRT, and it's going </span><span class="line" data-startTime="119">to do that in a fixed heartbeat. You can't </span><span class="line" data-startTime="125">control it, especially not from software. </span><span class="line" data-startTime="125">It's just going to do that. </span><span class="line" data-startTime="129">Now, this is mostly a good thing. And being </span><span class="line" data-startTime="129">smooth, having a smooth animation, something </span><span class="line" data-startTime="134">that slides across the screen and looks really, </span><span class="line" data-startTime="134">really nice and buttery, is about having your </span><span class="line" data-startTime="139">picture ready when that happens, just before </span><span class="line" data-startTime="139">it happens. And you have to do so being aware </span><span class="line" data-startTime="146">of the fact that different screens are going </span><span class="line" data-startTime="146">to do that at different rates. </span><span class="line" data-startTime="151">So in the yesteryear and even up to last year, </span><span class="line" data-startTime="151">some of the best JavaScript libraries out </span><span class="line" data-startTime="157">there animated would set timeout. jQuery, </span><span class="line" data-startTime="157">for instance, I think had an eight-millisecond </span><span class="line" data-startTime="161">set timeout thing. And we're here today to </span><span class="line" data-startTime="161">say &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="164"><span class="speakerName">Tom Tom Wiltzius</span>: Don't do it. </span></p>

<p class="speaker"><span class="line" data-starttime="164"><span class="speakerName">Nat Duca</span>: Please don't do it. </span> <span class="line" data-startTime="168">Now, it's kind of complicated why you shouldn't </span><span class="line" data-startTime="168">do it, so we built a simulation here for you </span><span class="line" data-startTime="173">to help you understand this. </span> <span class="line" data-startTime="173">So what you're seeing here is a couple of </span><span class="line" data-startTime="177">sliders. This determines my refresh rate of </span><span class="line" data-startTime="177">the screen. </span> <span class="line" data-startTime="181">So you know, if I'm a low power Chromebook </span><span class="line" data-startTime="181">that's unplugged and decided that it should </span><span class="line" data-startTime="187">go into low power mode, it's at 50-hertz and </span><span class="line" data-startTime="187">the blue line means in time it's going to </span><span class="line" data-startTime="191">update the screen at that point. </span> <span class="line" data-startTime="191">Let's bring that back up to 60 for a minute. </span> <span class="line" data-startTime="195">So then we've got our set timeout, right, </span><span class="line" data-startTime="195">the old school animation approach, and that's </span><span class="line" data-startTime="201">at 16. </span> <span class="line" data-startTime="201">So here's the thing. There is our set timeout. </span> <span class="line" data-startTime="204">It fires, then it fires again, exactly 16 </span><span class="line" data-startTime="204">milliseconds later. And then again, so on </span><span class="line" data-startTime="212">and so forth. </span> <span class="line" data-startTime="212">Now, see the relationship between the timer </span><span class="line" data-startTime="216">firing and the blue line? It's moving. And </span><span class="line" data-startTime="216">in fact, you see this arrow, which is showing </span><span class="line" data-startTime="222">when whatever you did in that set timeout, </span><span class="line" data-startTime="222">the arrow draws a line to where the monitor </span><span class="line" data-startTime="228">&mdash; which refresh of that monitor is going </span><span class="line" data-startTime="228">to pick up your picture. So if each one of </span><span class="line" data-startTime="232">those timeouts moves something to the left </span><span class="line" data-startTime="232">by one pixel, you will get a picture showing </span><span class="line" data-startTime="237">up when the vsync line runs. </span></p>

<p><span class="line" data-startTime="237">Now, here's the problem. 16 into 60-hertz </span><span class="line" data-startTime="243">does not equally go, right? 16 milliseconds </span><span class="line" data-startTime="243">and 16.6 are the two numbers that really &mdash; 16.6 </span><span class="line" data-startTime="251">repeating are your two magic numbers, and </span><span class="line" data-startTime="251">that's only for a 60-hertz display. The problem </span><span class="line" data-startTime="256">here &mdash; there are really two. The first problem </span><span class="line" data-startTime="256">is that as you go on in time &mdash; I'm just scrolling </span><span class="line" data-startTime="261">to the right to show you more and more of </span><span class="line" data-startTime="261">these patterns. Sometimes you get a situation </span><span class="line" data-startTime="266">where the same 16-millisecond time lap fires </span><span class="line" data-startTime="266">twice in the same VBlank interval, these two </span><span class="line" data-startTime="273">lines. So this red X'd one never made it on </span><span class="line" data-startTime="273">the screen. So that's going to be an apparent </span><span class="line" data-startTime="279">jank. You won't see that, so all of a sudden </span><span class="line" data-startTime="279">just for one fraction of a second you'll see </span><span class="line" data-startTime="284">&mdash; you'll feel like, oh, something's wrong. </span> <span class="line" data-startTime="284">The other problem is that these lines are </span><span class="line" data-startTime="292">varying in angle. Now, what that means is </span><span class="line" data-startTime="292">if you're moving something at a constant stream, </span><span class="line" data-startTime="297">trying to move something smoothly across the </span><span class="line" data-startTime="297">screen, the steeper the line, the more the </span><span class="line" data-startTime="304">velocity, the apparent velocity of your image </span><span class="line" data-startTime="304">will match what you're computing. But the </span><span class="line" data-startTime="310">more slanted the line, the more it will appear </span><span class="line" data-startTime="310">to your eyes to slow down. So in this case </span><span class="line" data-startTime="316">if I just moved something slowly across the </span><span class="line" data-startTime="316">screen, you would at a very, very subtle level </span><span class="line" data-startTime="322">feel like the object was slowing down and </span><span class="line" data-startTime="322">then suddenly would skip and then it would </span><span class="line" data-startTime="327">slow down, but it would be very, very minor. </span></p>

<p><span class="line" data-startTime="327">So this is not buttery smooth. </span></p>

<p class="speaker"><span class="line" data-starttime="331"><span class="speakerName">Tom Tom Wiltzius</span>: No. We even call it sometimes </span><span class="line" data-startTime="331">an uncanny value of smoothness. You may be </span><span class="line" data-startTime="336">thinking in a 60-hertz setup does it really </span><span class="line" data-startTime="336">matter so much if I drop one frame in 50, </span><span class="line" data-startTime="341">like if I'm going to drop the 50th frame? </span><span class="line" data-startTime="341">And the answer is yes, it does. You'll notice </span><span class="line" data-startTime="345">these things, but it's more, as Nat is saying, </span><span class="line" data-startTime="345">a feel. So this is the kind of thing that </span><span class="line" data-startTime="350">we can become very attuned to, and if you </span><span class="line" data-startTime="350">start to notice it you're going to see these </span><span class="line" data-startTime="355">tiny little hitches. </span></p>

<p class="speaker"><span class="line" data-starttime="355"><span class="speakerName">Nat Duca</span>: And tweaking the number doesn't </span><span class="line" data-startTime="358">make it better. You can turn it to 10, it </span><span class="line" data-startTime="358">just drops more frames. You're gonna get more </span><span class="line" data-startTime="363">jank. If you turn it up to 17 because, hey, </span><span class="line" data-startTime="363">17 is closer to 16.6, you'll get the same </span><span class="line" data-startTime="367">thing, it's just gonna longer for that to </span><span class="line" data-startTime="367">happen. </span> <span class="line" data-startTime="371">And if you want to pass 16.6, the browser </span><span class="line" data-startTime="371">will drop that decimal point on the floor </span><span class="line" data-startTime="376">and give you 16 anyway. </span> <span class="line" data-startTime="376">So don't use set timeout. We're sort of beating </span><span class="line" data-startTime="381">this point because there's been discussion </span><span class="line" data-startTime="381">in the world about whether this is a good </span><span class="line" data-startTime="385">thing. </span> <span class="line" data-startTime="385">So what should you do? Well, stay on time </span><span class="line" data-startTime="388">every time by using requestAnimationFrame. </span> <span class="line" data-startTime="388">It's a drop in replacement for set timeout. </span> <span class="line" data-startTime="394">The quality of the implementation of requestAnimationFrame </span><span class="line" data-startTime="394">is not 100% on all browsers right now. Some </span><span class="line" data-startTime="399">browsers are trying to get little nitty-gritty </span><span class="line" data-startTime="399">corner cases just perfect, but unlike set </span><span class="line" data-startTime="406">timeout, which is sort of permanently messed </span><span class="line" data-startTime="406">up, we have hope as Chrome or Mozilla or any </span><span class="line" data-startTime="412">of these to make it better. So please do use </span><span class="line" data-startTime="412">it. </span></p>

<p><span class="line" data-startTime="416">And the reason is because then when you're </span><span class="line" data-startTime="416">on a high-speed monitor or a low-powered screen, </span><span class="line" data-startTime="421">your rAF is always on time. </span></p>

<p class="speaker"><span class="line" data-starttime="421"><span class="speakerName">Tom Tom Wiltzius</span>: This is supported in all the </span><span class="line" data-startTime="426">major browsers at this point. This is very </span><span class="line" data-startTime="426">much the direction everyone is going. </span></p>

<p class="speaker"><span class="line" data-starttime="428"><span class="speakerName">Nat Duca</span>: But this is not the only thing </span><span class="line" data-startTime="428">that you need to do to be jank-free because </span><span class="line" data-startTime="436">otherwise we could all leave and go get drunk </span><span class="line" data-startTime="436">or something. </span> <span class="line" data-startTime="438">So anyway, we can't do that, we have to also </span><span class="line" data-startTime="438">keep in budget. So let's talk about budget. </span> <span class="line" data-startTime="445">So what I have here is a requestAnimationFrame </span><span class="line" data-startTime="445">script that's just rotating this thing, right? </span><span class="line" data-startTime="450">Pretty straightforward. And what I've also </span><span class="line" data-startTime="450">done is I've graphed, just with the canvas, </span><span class="line" data-startTime="455">the time that I'm getting between these requestAnimationFrames. </span> <span class="line" data-startTime="455">And you can see they're nice and regular. </span> <span class="line" data-startTime="461">There's a good line here. </span> <span class="line" data-startTime="461">Now, this big jank button, right, it's a big </span><span class="line" data-startTime="466">red button, don't press it, but if you press </span><span class="line" data-startTime="466">it, it puts it to sleep, just puts V8 to sleep </span><span class="line" data-startTime="471">for awhile and what happens is there are two </span><span class="line" data-startTime="471">things to watch. You will see the spike on </span><span class="line" data-startTime="477">the graph, right? But also look at the actual </span><span class="line" data-startTime="477">spinner. See how it's sort of jumping? So </span><span class="line" data-startTime="483">this isn't terribly surprising, but this visualization </span><span class="line" data-startTime="483">of seeing this graph spike is incredibly useful </span><span class="line" data-startTime="489">and it's so useful that we've actually built </span><span class="line" data-startTime="489">it right into devtools. </span></p>

<p><span class="line" data-startTime="494">So a new feature announcement, or you've seen </span><span class="line" data-startTime="494">it maybe, this is Chrome devtools frame mode </span><span class="line" data-startTime="499">and it's recording now and what we're seeing </span><span class="line" data-startTime="499">is that same graph of the time between frames </span><span class="line" data-startTime="505">live, plotted up top, so you see a long frame. </span> <span class="line" data-startTime="505">So let's try it out. Let's go here. I'm gonna </span><span class="line" data-startTime="510">start a new recording. I'm going to press </span><span class="line" data-startTime="510">the big jank button. </span> <span class="line" data-startTime="515">Go back. So now that nice, beautiful, flat </span><span class="line" data-startTime="515">thing that we saw now has these nasty things </span><span class="line" data-startTime="521">in it. And your eye should be drawn to that </span><span class="line" data-startTime="521">because that's jank. </span> <span class="line" data-startTime="525">So if I zoom in on this, right, if I click </span><span class="line" data-startTime="525">on one of these, one of the cool things you're </span><span class="line" data-startTime="529">seeing is these are good frames. These individual </span><span class="line" data-startTime="529">columns are nice, smooth 16-millisecond frames. </span></p>

<p><span class="line" data-startTime="537">16, 17, it will be a little bit noisy. </span> <span class="line" data-startTime="537">But this one &mdash; that one is right out. </span> <span class="line" data-startTime="544">Tom, is a 100-millisecond frame smooth? </span></p>

<p class="speaker"><span class="line" data-starttime="544"><span class="speakerName">Tom Tom Wiltzius</span>: Nope. </span></p>

<p class="speaker"><span class="line" data-starttime="547"><span class="speakerName">Nat Duca</span>: He's good. He's a good PM. </span> <span class="line" data-startTime="547">So this is the jank that we introduced. And </span><span class="line" data-startTime="552">in fact, devtools is awesome. We can go to </span><span class="line" data-startTime="552">here, see that big timer-fired event and see </span><span class="line" data-startTime="560">that that's the big jank button. </span> <span class="line" data-startTime="560">Now, it's not just about avoiding the big </span><span class="line" data-startTime="566">timeouts in your code, like you could just </span><span class="line" data-startTime="566">write a memo and say "Don't sleep for 100 </span><span class="line" data-startTime="570">milliseconds," okay, now your Web page is </span><span class="line" data-startTime="570">jank-free, but not quite. </span> <span class="line" data-startTime="574">So the other part of this puzzle is sticking </span><span class="line" data-startTime="574">within your budget. So I've got two buttons </span><span class="line" data-startTime="581">here, this early button. And as you can see, </span><span class="line" data-startTime="581">there's a little bit of noise, but that's </span><span class="line" data-startTime="586">not me clicking the button. I'm pressing this </span><span class="line" data-startTime="586">button really hard and the frame graph is </span><span class="line" data-startTime="589">pretty stable, right? </span><span class="line" data-startTime="589">And then I'm going to do the same thing, and </span><span class="line" data-startTime="592">I have this eight milliseconds late thing, </span><span class="line" data-startTime="592">and you can see we're getting regular jumps. </span> <span class="line" data-startTime="596">Now, let's go back to the recording. I had </span><span class="line" data-startTime="596">a recording going. </span></p>

<p><span class="line" data-startTime="601">So here are the ones when I pressed early. </span> <span class="line" data-startTime="601">Okay? See how the line here didn't go up? </span><span class="line" data-startTime="609">What this is saying to me is that I used some </span><span class="line" data-startTime="609">time during my frame to do JavaScript, but </span><span class="line" data-startTime="615">I didn't push out my frame. </span> <span class="line" data-startTime="615">Now, let's look at this down in the bottom </span><span class="line" data-startTime="619">bin. So if I scroll down I have to sort of </span><span class="line" data-startTime="619">find it. </span> <span class="line" data-startTime="621">The recording is a little long, so bear with </span><span class="line" data-startTime="621">me. There it is. </span> <span class="line" data-startTime="628">So here's our eight-millisecond fired call. </span> <span class="line" data-startTime="628">And we fit it in between these two frames. </span> <span class="line" data-startTime="633">See how it just fit right in? </span><span class="line" data-startTime="633">So because it just fit right in, it didn't </span><span class="line" data-startTime="637">push out the frame. But if I go over here </span><span class="line" data-startTime="637">and look at this one &mdash; so there's one of </span><span class="line" data-startTime="643">those timers that actually fired. And you </span><span class="line" data-startTime="643">can &mdash; even without zooming in too far on </span><span class="line" data-startTime="647">it, you can see that basically we started </span><span class="line" data-startTime="647">too late and so we pushed out the frame, and </span><span class="line" data-startTime="653">this frame ran long. This frame is 21 milliseconds, </span><span class="line" data-startTime="653">right, instead of the 16. </span></p>

<p><span class="line" data-startTime="659">So this would have janked. And in fact, if </span><span class="line" data-startTime="659">you sit there in these slides and really pound </span><span class="line" data-startTime="663">on the eight milliseconds late button, just </span><span class="line" data-startTime="663">hitting it, you will start seeing the spinner </span><span class="line" data-startTime="667">feel a little bit janky. </span> <span class="line" data-startTime="667">So the rule here is you've got 16 milliseconds </span><span class="line" data-startTime="674">to do everything, including all this stuff </span><span class="line" data-startTime="674">that Chrome needs to do to put the picture </span><span class="line" data-startTime="676">on the screen. </span> <span class="line" data-startTime="676">If you're going to do work, you've got to </span><span class="line" data-startTime="681">stay in that budget and you've got to measure </span><span class="line" data-startTime="681">it in order to verify that you're staying </span><span class="line" data-startTime="687">in the budget. </span> <span class="line" data-startTime="687">So that's a nice toy example. It's one type </span><span class="line" data-startTime="693">of example, but what do we do in the Web browser </span><span class="line" data-startTime="693">most of the time? We scroll. Almost all of </span><span class="line" data-startTime="701">my Web browsing time is scrolling. </span> <span class="line" data-startTime="701">So you can get janked there, too, and in fact </span><span class="line" data-startTime="706">we showed it once. </span> <span class="line" data-startTime="706">Here's a toy example Number 2 of jank scrolling. </span></p>

<p><span class="line" data-startTime="711">So this code moves these divs around in an </span><span class="line" data-startTime="711">onscroll handler. </span> <span class="line" data-startTime="717">Is it's a pretty straightforward example. </span> <span class="line" data-startTime="717">It's not exactly the prettiest thing in the </span><span class="line" data-startTime="721">world, but we want to show you two things. </span> <span class="line" data-startTime="721">First I want to make you very, very comfortable </span><span class="line" data-startTime="726">with when you see this kind of pattern, just </span><span class="line" data-startTime="726">pop into the timeline and take a recording. </span> <span class="line" data-startTime="731">So let's do that. Up and down, we're having </span><span class="line" data-startTime="731">some fun here. Hopefully we're having some </span><span class="line" data-startTime="737">fun. </span> <span class="line" data-startTime="737">There it is. So here are some frames. So the </span><span class="line" data-startTime="741">first thing that should stand out to you is </span><span class="line" data-startTime="741">look at the size of these things. </span> <span class="line" data-startTime="750">Again, back to jank expert. Are these fast? </span></p>

<p class="speaker"><span class="line" data-starttime="750"><span class="speakerName">Tom Tom Wiltzius</span>: Only on a five-hertz screen. </span></p>

<p class="speaker"><span class="line" data-starttime="752"><span class="speakerName">Nat Duca</span>: These are long frames. This is </span><span class="line" data-startTime="752">not okay. So we need to make this okayer. </span> <span class="line" data-startTime="757">Technical term alert, okayer. </span> <span class="line" data-startTime="757">So what I'm seeing here between these two </span><span class="line" data-startTime="762">lines, just pick any pair of lines, I'm seeing </span><span class="line" data-startTime="762">some green, which is painting, and I'm seeing </span><span class="line" data-startTime="768">some event. </span> <span class="line" data-startTime="768">If I expand this out you see just tons and </span><span class="line" data-startTime="772">tons of stuff happening in this event. </span> <span class="line" data-startTime="772">So what I think when I see this is I go, let's </span><span class="line" data-startTime="776">hit this. This is pretty obvious or maybe </span><span class="line" data-startTime="776">it's obvious. </span> <span class="line" data-startTime="779">So when we pop into the source code for this, </span><span class="line" data-startTime="779">what the Chrome devtools is pointing us at </span><span class="line" data-startTime="786">is this line. </span></p>

<p><span class="line" data-startTime="786">So what this is doing is it's trying to pull </span><span class="line" data-startTime="790">up &mdash; the test is just trying to pull up the </span><span class="line" data-startTime="790">scrolltop in order to then use it in a formula. </span> <span class="line" data-startTime="796">Now, one of the key parts of most Web browsers </span><span class="line" data-startTime="796">is that when you ask for layout information </span><span class="line" data-startTime="803">or style, and scrolltop is part of that, it </span><span class="line" data-startTime="803">has to recalculate the world essentially or </span><span class="line" data-startTime="809">a lot of the world. </span> <span class="line" data-startTime="809">And in this case that means figuring out all </span><span class="line" data-startTime="814">the div positions and everything and doing </span><span class="line" data-startTime="814">a big think, and then it will give you back </span><span class="line" data-startTime="817">the scrolltop. </span> <span class="line" data-startTime="817">Now, then we take the value that we've computed </span><span class="line" data-startTime="823">and we shove it into this left position of </span><span class="line" data-startTime="823">our item, which goes and tells the browser, </span><span class="line" data-startTime="828">"Hey, the world has changed again. If you </span><span class="line" data-startTime="828">get asked about the world's state again, recompute </span><span class="line" data-startTime="832">again." </span><span class="line" data-startTime="832">So what's happening here is that we compute </span><span class="line" data-startTime="837">style, we dirty style, we go around the loop </span><span class="line" data-startTime="837">again and we do this over and over and over </span><span class="line" data-startTime="843">again. And this is why we're seeing so many </span><span class="line" data-startTime="843">purple entries in the timeline. Of course, </span><span class="line" data-startTime="848">this being the demo I have made that behind </span><span class="line" data-startTime="848">a check box, right? </span><span class="line" data-startTime="852">So in theory this should be faster now, right, </span><span class="line" data-startTime="852">but don't believe it. Trace it or record it. </span></p>

<p><span class="line" data-startTime="859">So I've got a recording going and we're going </span><span class="line" data-startTime="859">to scroll again. </span> <span class="line" data-startTime="862">Oh, happy day, it's gone. </span> <span class="line" data-startTime="862">But hey, Tom, is that fast yet? </span></p>

<p class="speaker"><span class="line" data-starttime="866"><span class="speakerName">Tom Tom Wiltzius</span>: Still not fast enough. </span></p>

<p class="speaker"><span class="line" data-starttime="866"><span class="speakerName">Nat Duca</span>: It's not smooth yet. I need a </span><span class="line" data-startTime="869">light that's are we smooth yet? So our paint </span><span class="line" data-startTime="869">is a problem and we've got to hit this too. </span> <span class="line" data-startTime="878">So painting, what's painting? </span><span class="line" data-startTime="878">So painting is the part where we take the </span><span class="line" data-startTime="882">styles that you've given us and we do the </span><span class="line" data-startTime="882">drawing. So Line 2, fill, draw image, do a </span><span class="line" data-startTime="889">blur. All of that stuff, and it takes time. </span> <span class="line" data-startTime="889">So when you see big paintings, start looking </span><span class="line" data-startTime="894">at things that could be costly. So when I </span><span class="line" data-startTime="894">look at this doc and I look in the elements </span><span class="line" data-startTime="899">inspector &mdash; the only thing up here really </span><span class="line" data-startTime="899">is a bunch of images, so it's a pretty easy </span><span class="line" data-startTime="904">case. </span></p>

<p><span class="line" data-startTime="904">But we look at these images and we've just </span><span class="line" data-startTime="907">got tons of styles on them. We've got, you </span><span class="line" data-startTime="907">know, background image, we've got a box shadow, </span><span class="line" data-startTime="913">you know. </span> <span class="line" data-startTime="913">Hmm, let's remove that. So I've got a heavy </span><span class="line" data-startTime="916">painting class this is all in. So if I toggle </span><span class="line" data-startTime="916">that off like that and we hit record again, </span><span class="line" data-startTime="925">this should be better. </span> <span class="line" data-startTime="925">And in fact, because of a bug in devtools </span><span class="line" data-startTime="930">it's not completely smooth, but if you look </span><span class="line" data-startTime="930">at the actual costs, remember our paint time </span><span class="line" data-startTime="935">was &mdash; what was it, like 40 something? </span><span class="line" data-startTime="935">So it's gone from 40 something to about four </span><span class="line" data-startTime="941">milliseconds. So definitely those CSS files </span><span class="line" data-startTime="941">that I toggled off are to blame. And in fact, </span><span class="line" data-startTime="948">when devtools is off this is nice and smooth. </span> <span class="line" data-startTime="948">So we busted some jank in some synthetic demos, </span><span class="line" data-startTime="956">kind of cool, but in general what we're trying </span><span class="line" data-startTime="956">to teach you is keep your eye open for costly </span><span class="line" data-startTime="963">things, long frames. Anything bigger than </span><span class="line" data-startTime="963">16 is right at you've got to bust it. </span> <span class="line" data-startTime="968">Garbage collection can do this to you, just </span><span class="line" data-startTime="968">manipulating lots of DOM, heavy script obviously. </span> <span class="line" data-startTime="974">Timers are particularly something you have </span><span class="line" data-startTime="974">to be careful of. Be aware of a timer that </span><span class="line" data-startTime="978">comes in just about at the end of the frame </span><span class="line" data-startTime="978">because it can push out that frame. Same goes </span><span class="line" data-startTime="983">for XHR. Use the devtools features in order </span><span class="line" data-startTime="983">to bust this stuff up and make your website </span><span class="line" data-startTime="988">smoother. </span> <span class="line" data-startTime="988">But there's more and Tom is going to tell </span><span class="line" data-startTime="991">you about it. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="991"><span class="speakerName">Tom Tom Wiltzius</span>: Thanks, Nat. </span> <span class="line" data-startTime="993">So Nat's been talking a lot about sort of </span><span class="line" data-startTime="993">what JavaScript, et cetera, can get in the </span><span class="line" data-startTime="999">way of your animations running smoothly. And </span><span class="line" data-startTime="999">there's sort of an implied limitation to what </span><span class="line" data-startTime="1003">the browser can do in everything that Nat's </span><span class="line" data-startTime="1003">just said. And that's that why can't some </span><span class="line" data-startTime="1008">of this happen at the same time? It doesn't </span><span class="line" data-startTime="1008">really seem like there should be anything </span><span class="line" data-startTime="1012">related between handling some XHR callback </span><span class="line" data-startTime="1012">in JavaScript and the browser painting, like </span><span class="line" data-startTime="1019">you might not be actually touching the DOM </span><span class="line" data-startTime="1019">at all. </span> <span class="line" data-startTime="1021">But unfortunately for better or worse, the </span><span class="line" data-startTime="1021">way browsers are today it's a pretty good </span><span class="line" data-startTime="1026">assumption that everything happening in a </span><span class="line" data-startTime="1026">given tab happens on one thread; i.e., that </span><span class="line" data-startTime="1031">XHR callback can block painting, right? </span><span class="line" data-startTime="1031">Also, that XHR callback could block your requestAnimationFrame </span><span class="line" data-startTime="1038">from running. </span> <span class="line" data-startTime="1038">So if you remember, we've got this requestAnimationFrame </span><span class="line" data-startTime="1042">that's ticking at the vsync heartbeat, but </span><span class="line" data-startTime="1042">it can't run if some heavy block of JavaScript </span><span class="line" data-startTime="1048">is running. This is a pretty severe limitation, </span><span class="line" data-startTime="1048">right, because this means that you can't really </span><span class="line" data-startTime="1052">be running in animation at the time when you've </span><span class="line" data-startTime="1052">got to do more than 16 milliseconds of JavaScript </span><span class="line" data-startTime="1056">work at a time. </span></p>

<p><span class="line" data-startTime="1056">Either you have to break up your JavaScript </span><span class="line" data-startTime="1059">into really little bite-sized increments and </span><span class="line" data-startTime="1059">handle them in the rAF callback or you can </span><span class="line" data-startTime="1064">use CSS animation. </span> <span class="line" data-startTime="1064">CSS animation is one of the exceptions to </span><span class="line" data-startTime="1068">everything happens in one thread rule. We </span><span class="line" data-startTime="1068">brought to Chrome for Android first, so we're </span><span class="line" data-startTime="1072">going to do a demo Android in a second, but </span><span class="line" data-startTime="1072">pretty soon this is going to be everywhere, </span><span class="line" data-startTime="1076">including on desktop Chrome. So let's switch </span><span class="line" data-startTime="1076">to the demo here. </span> <span class="line" data-startTime="1081">I'm going to turn on the projector over on </span><span class="line" data-startTime="1081">the left, that's going to open up the source </span><span class="line" data-startTime="1087">on my right. So if I look at this simple, </span><span class="line" data-startTime="1087">simple demo, this should look familiar, this </span><span class="line" data-startTime="1097">is the same thing that we saw earlier, and </span><span class="line" data-startTime="1097">what Nat was showing earlier as this logo </span><span class="line" data-startTime="1101">spun around was driven by requestAnimationFrame. </span></p>

<p><span class="line" data-startTime="1101">This is driven by CSS animation. You can see </span><span class="line" data-startTime="1108">that I mention this is only on Chrome for </span><span class="line" data-startTime="1108">Android now, so for comparison's sake, if </span><span class="line" data-startTime="1112">Nat hits the sleep button, you can see that </span><span class="line" data-startTime="1112">little bit of jank happening, right? Like </span><span class="line" data-startTime="1116">that little hitch in the animation that's </span><span class="line" data-startTime="1116">the kind of thing that you want to be attuned </span><span class="line" data-startTime="1120">to. Whereas if I hit that same button on this, </span><span class="line" data-startTime="1120">JavaScript still just spins for 180 milliseconds, </span><span class="line" data-startTime="1128">but the animation is smooth, right? This is </span><span class="line" data-startTime="1128">huge. This is a big deal because it means </span><span class="line" data-startTime="1132">that you can run arbitrary JavaScript and </span><span class="line" data-startTime="1132">the CSS animations are all going to run. </span> <span class="line" data-startTime="1135">It's kind of like the easy mode of getting </span><span class="line" data-startTime="1135">your animations to run smoothly, because you </span><span class="line" data-startTime="1141">just need to define an animation in CSS, which </span><span class="line" data-startTime="1141">is fairly natural for most Web authors anyway, </span><span class="line" data-startTime="1146">then let Chrome do the rest. </span> <span class="line" data-startTime="1146">So this applies to both CSS transitions and </span><span class="line" data-startTime="1154">CSS key frame animations and like requestAnimationFrame </span><span class="line" data-startTime="1154">you get some stuff for free. You get a lot </span><span class="line" data-startTime="1160">of benefits. You get better time, smoother </span><span class="line" data-startTime="1160">looking animations, which is what we just </span><span class="line" data-startTime="1162">showed you. </span></p>

<p><span class="line" data-startTime="1162">You also get better battery life, because </span><span class="line" data-startTime="1164">we get pause animations that are in background </span><span class="line" data-startTime="1164">tabs. You get more graceful degradation because </span><span class="line" data-startTime="1168">if there are a lot of things animating on </span><span class="line" data-startTime="1168">the screen, we can drop the browser's refresh </span><span class="line" data-startTime="1173">rate to 30-hertz instead of 60, for instance </span><span class="line" data-startTime="1173">and keep it regular, rather than almost making </span><span class="line" data-startTime="1178">it 60 but missing frames every once in a while. </span> <span class="line" data-startTime="1178">Because for all of the reasons that we were </span><span class="line" data-startTime="1182">talking about earlier, missing that frame </span><span class="line" data-startTime="1182">every once in a while is what your eye notices. </span> <span class="line" data-startTime="1186">Right? </span><span class="line" data-startTime="1186">So it's much better to be very, very regular, </span><span class="line" data-startTime="1192">but a bit slower, than it is to be variable </span><span class="line" data-startTime="1192">and almost good enough. And this is the kind </span><span class="line" data-startTime="1195">of thing that the browser can handle for you. </span></p>

<p><span class="line" data-startTime="1195">CSS animations are particularly good if you </span><span class="line" data-startTime="1200">are doing some sort of continuous animation </span><span class="line" data-startTime="1200">like this silly Chrome logo spinning, if you've </span><span class="line" data-startTime="1205">got some logo like that, and you want to be </span><span class="line" data-startTime="1205">doing anything on your page, like all of your </span><span class="line" data-startTime="1210">social widgets are firing timers all of the </span><span class="line" data-startTime="1210">time, for instance, this is going to get in </span><span class="line" data-startTime="1215">the way of something like the requestAnimationFrame, </span><span class="line" data-startTime="1215">driven animation, but it will not get in the </span><span class="line" data-startTime="1221">way of the CSS animation. </span> <span class="line" data-startTime="1221">It's also good for UI substitution effects, </span><span class="line" data-startTime="1224">so you can imagine whatever GML wants to sort </span><span class="line" data-startTime="1224">of nicely animate the opening of their compose </span><span class="line" data-startTime="1230">window, they can do that with CSS animations, </span><span class="line" data-startTime="1230">and it's much easier to do all of the heavy </span><span class="line" data-startTime="1234">lifting in the background of building up document </span><span class="line" data-startTime="1234">fragments and doing DOM manipulation and parsing </span><span class="line" data-startTime="1241">the email text. All of the stuff that you </span><span class="line" data-startTime="1241">have got to do to make your app run that you </span><span class="line" data-startTime="1244">don't want to have to think about in the same </span><span class="line" data-startTime="1244">way that you are thinking about the animation </span><span class="line" data-startTime="1247">running. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="1247"><span class="speakerName">Nat Duca</span>: Yeah. So we can't underscore this </span><span class="line" data-startTime="1250">enough. CSS animation is your get out of jail </span><span class="line" data-startTime="1250">free card. When you have something, you can't </span><span class="line" data-startTime="1255">keep it to your 16 millisecond budget, you </span><span class="line" data-startTime="1255">know, break out of that 16 millisecond jail </span><span class="line" data-startTime="1262">temporarily by throwing up a nice animation. </span></p>

<p class="speaker"><span class="line" data-starttime="1262"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah, that's right. I also </span><span class="line" data-startTime="1266">want to &mdash; before we go further, I should </span><span class="line" data-startTime="1266">note that we talk a lot about 16 milliseconds </span><span class="line" data-startTime="1270">because that's about right. But all of this </span><span class="line" data-startTime="1270">stuff about browser and screen refresh rates </span><span class="line" data-startTime="1276">still apply and I want to point out that just </span><span class="line" data-startTime="1276">because you are within budget on your computer, </span><span class="line" data-startTime="1281">doesn't necessarily mean that you're going </span><span class="line" data-startTime="1281">to be within budget on most people's computers </span><span class="line" data-startTime="1284">which are probably slower than your computers </span><span class="line" data-startTime="1284">and doesn't mean that you're going to be within </span><span class="line" data-startTime="1287">budget on phone and tablets, and all of this </span><span class="line" data-startTime="1287">stuff. All of this is very, very machine dependent. </span> <span class="line" data-startTime="1292">Right? So you need to be diligent about doing </span><span class="line" data-startTime="1292">the kind of measurements that we're talking </span><span class="line" data-startTime="1296">about throughout this talk to make sure that </span><span class="line" data-startTime="1296">you're actually comfortably within budget </span><span class="line" data-startTime="1301">and can even withstand some variation like </span><span class="line" data-startTime="1301">machine speed. So &mdash; so now we're going to </span><span class="line" data-startTime="1306">go back to the demo we opened with. And we're </span><span class="line" data-startTime="1306">going to try to fix this up. We're going to </span><span class="line" data-startTime="1313">sort of show you the process that we went </span><span class="line" data-startTime="1313">through to speed up this page. On this projector's </span><span class="line" data-startTime="1319">resolution, the results aren't quite as dramatic, </span><span class="line" data-startTime="1319">but you should still be able to see them, </span><span class="line" data-startTime="1323">especially if, as imploring you use devtools </span><span class="line" data-startTime="1323">and actually like really note the times. I'm </span><span class="line" data-startTime="1329">going to pop up devtools here and I'm going </span><span class="line" data-startTime="1329">to look around and I'm going to take a timeline </span><span class="line" data-startTime="1336">recording of this page that we say scrolls </span><span class="line" data-startTime="1336">jangly. If I zoom in on some of those frames, </span><span class="line" data-startTime="1344">what do I see? I see big swaths of green, </span><span class="line" data-startTime="1344">right? I see all of this paint time, which </span><span class="line" data-startTime="1351">is completely blowing the frame budget. These </span><span class="line" data-startTime="1351">frames are like 45 plus milliseconds long </span><span class="line" data-startTime="1357">and they are dominated, I mean they are not </span><span class="line" data-startTime="1357">dominated, the only thing going on is painting, </span><span class="line" data-startTime="1361">right? So before we were talking about JavaScript </span><span class="line" data-startTime="1361">getting in the way sort of complicated interaction </span><span class="line" data-startTime="1365">between the browser painting and JavaScript </span><span class="line" data-startTime="1365">running and style recalculation. None of that </span><span class="line" data-startTime="1370">is going on here. This is a static Web page, </span><span class="line" data-startTime="1370">not complicated in the slightest. It still </span><span class="line" data-startTime="1376">scrolls really slowly. It scrolls slowly on </span><span class="line" data-startTime="1376">this like fancy MacBook Pro. You can imagine </span><span class="line" data-startTime="1382">how well this scrolls on most people's computers </span><span class="line" data-startTime="1382">which are not nearly as fast, right? So what </span><span class="line" data-startTime="1388">do we do? How do you diagnose those big, pretty, </span><span class="line" data-startTime="1388">opaque big green paint blocks. When you are </span><span class="line" data-startTime="1394">diagnosing a long paint time, there are a </span><span class="line" data-startTime="1394">few basic questions that you want to start </span><span class="line" data-startTime="1398">with. What element was slow or what element </span><span class="line" data-startTime="1398">is causing you to be slow and what styles </span><span class="line" data-startTime="1403">are causing you to be slow? The way we answer </span><span class="line" data-startTime="1403">the first question is that we do this really </span><span class="line" data-startTime="1409">dumb thing where we just turn off parts of </span><span class="line" data-startTime="1409">the DOM. Right? We just get rid of elements </span><span class="line" data-startTime="1414">and say did getting rid of this element improve </span><span class="line" data-startTime="1414">my paint times? </span><span class="line" data-startTime="1418">Maybe we decide we don't need that or we're </span><span class="line" data-startTime="1418">going to do some sort of visual reengineering, </span><span class="line" data-startTime="1423">so it's not as big of a problem, et cetera. </span></p>

<p><span class="line" data-startTime="1423">So we can start with something like that here. </span> <span class="line" data-startTime="1429">Again, I'm going to switch to devtools, pop </span><span class="line" data-startTime="1429">open the elements view, and I'm going to start </span><span class="line" data-startTime="1436">just looking for things to turn off. So I'm </span><span class="line" data-startTime="1436">going to start with trying to turn off this </span><span class="line" data-startTime="1440">header, because I'm sort of suspicious of </span><span class="line" data-startTime="1440">that. It's on the screen all the time. And </span><span class="line" data-startTime="1445">I'm just going to flip this to display none. </span> <span class="line" data-startTime="1445">This feels a little smoother to my finger </span><span class="line" data-startTime="1452">on the track pad, but it's hard to tell that </span><span class="line" data-startTime="1452">from the audience. So again, be diligent, </span><span class="line" data-startTime="1456">take a recording. We switch back to timeline, </span><span class="line" data-startTime="1456">we take a recording. Did we get better? Ah, </span><span class="line" data-startTime="1463">we got a little bit better. There were some </span><span class="line" data-startTime="1463">that were above 45 seconds before, so I maybe </span><span class="line" data-startTime="1468">would count this a win, but it's not that </span><span class="line" data-startTime="1468">significant, right? Plus there's a down side </span><span class="line" data-startTime="1473">here. I just got rid of the header. This is </span><span class="line" data-startTime="1473">like pretty integral to my site, right? </span><span class="line" data-startTime="1477">[ Laughter ] </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="1477"><span class="speakerName">Nat Duca</span>: You can do it, you can go push </span><span class="line" data-startTime="1479">this, right? Sometimes that sort of a thing </span><span class="line" data-startTime="1479">will be a real hit. It's not unsurprising </span><span class="line" data-startTime="1485">that we'll see websites that just lose 90% </span><span class="line" data-startTime="1485">of their speed to one element. But in this </span><span class="line" data-startTime="1490">case, it's sort of marginal and it's kind </span><span class="line" data-startTime="1490">of cool. Like I like that orange thing. </span></p>

<p class="speaker"><span class="line" data-starttime="1495"><span class="speakerName">Tom Tom Wiltzius</span>: Right. </span></p>

<p class="speaker"><span class="line" data-starttime="1495"><span class="speakerName">Nat Duca</span>: So we should keep it, right? </span></p>

<p class="speaker"><span class="line" data-starttime="1497"><span class="speakerName">Tom Tom Wiltzius</span>: Right. So we're going to try </span><span class="line" data-startTime="1497">not to make our UI designers, et cetera, angry </span><span class="line" data-startTime="1504">by telling them that their layout is too complicated. </span><span class="line" data-startTime="1504">And instead we're going to move on to the </span><span class="line" data-startTime="1508">second question, which is, well, we're stuck </span><span class="line" data-startTime="1508">painting everything that we're going to paint </span><span class="line" data-startTime="1512">and we're not going to worry about why it's </span><span class="line" data-startTime="1512">being painted. Instead we're just going to </span><span class="line" data-startTime="1515">say what made this take so long? Like given </span><span class="line" data-startTime="1515">that we can't change it. </span><span class="line" data-startTime="1519">The answer is always going to be CSS styles, </span><span class="line" data-startTime="1519">right? CSS styles define what the page looks </span><span class="line" data-startTime="1525">like, it defines what an element looks like, </span><span class="line" data-startTime="1525">it also defines how an element renders, right? </span><span class="line" data-startTime="1529">So when we tell an element to go draw itself, </span><span class="line" data-startTime="1529">we being like WebKit, right, the amount of </span><span class="line" data-startTime="1535">time that that takes is highly variable depending </span><span class="line" data-startTime="1535">on CSS styles. We wish it was the case that </span><span class="line" data-startTime="1540">all CSS styles sort of took equal cost to </span><span class="line" data-startTime="1540">paint because it would make &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="1543"><span class="speakerName">Nat Duca</span>: I want a pony as well. </span></p>

<p class="speaker"><span class="line" data-starttime="1543"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah, yeah. It would make </span><span class="line" data-startTime="1546">performance optimization much easier, but </span><span class="line" data-startTime="1546">that's just not true. But so as much as Nat </span><span class="line" data-startTime="1552">said earlier, sometimes one element can really </span><span class="line" data-startTime="1552">slow you down. Similarly sometimes just one </span><span class="line" data-startTime="1558">or two styles or like the intersection of </span><span class="line" data-startTime="1558">a couple can really, really kill you when </span><span class="line" data-startTime="1562">it comes to paint times. </span><span class="line" data-startTime="1562">So we're going to start doing the same dumb </span><span class="line" data-startTime="1566">trick. Right? We're just going to start turning </span><span class="line" data-startTime="1566">stuff off and seeing if we can identify a </span><span class="line" data-startTime="1571">couple of things that are really causing us </span><span class="line" data-startTime="1571">pain. </span><span class="line" data-startTime="1574">So again I'm going to flip open devtools, </span><span class="line" data-startTime="1574">go to the elements view and I'm going to start </span><span class="line" data-startTime="1581">poking around. The first thing that I'm going </span><span class="line" data-startTime="1581">to look at is maybe this background. It's </span><span class="line" data-startTime="1585">on a lot of the screen. Like the reason I'm </span><span class="line" data-startTime="1585">choosing this is because it looks kind of </span><span class="line" data-startTime="1589">complicated, especially if I inspect it here. </span><span class="line" data-startTime="1589">Oh, there's all of this like 20 lines of CSS </span><span class="line" data-startTime="1597">declaration for this thing. And it's all over </span><span class="line" data-startTime="1597">the place. So I'm assuming maybe it's going </span><span class="line" data-startTime="1602">to take some time. </span></p>

<p class="speaker"><span class="line" data-starttime="1602"><span class="speakerName">Nat Duca</span>: Even more amusingly on your projectors </span><span class="line" data-startTime="1604">it's showing up as gray. But when you look </span><span class="line" data-startTime="1604">at it here, it's got this nice little checker-boardy </span><span class="line" data-startTime="1612">thing and it's all gorgeous and textured. </span></p>

<p class="speaker"><span class="line" data-starttime="1612"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah, I apologize. </span></p>

<p class="speaker"><span class="line" data-starttime="1614"><span class="speakerName">Nat Duca</span>: And &mdash; we're not going to see </span><span class="line" data-startTime="1614">it, but maybe we're paying a lot for that, </span><span class="line" data-startTime="1617">all of that CSS. </span></p>

<p class="speaker"><span class="line" data-starttime="1617"><span class="speakerName">Tom Tom Wiltzius</span>: Right. So we're going to go </span><span class="line" data-startTime="1620">back to the timeline view again, we're going </span><span class="line" data-startTime="1620">to take a recording, we're going to scroll </span><span class="line" data-startTime="1626">down, we're going to see what changed. Huh. </span><span class="line" data-startTime="1626">A lot changed, right? </span><span class="line" data-startTime="1630">So now I've turned off that background and </span><span class="line" data-startTime="1630">my frame times are now like in the high 20s. </span></p>

<p class="speaker"><span class="line" data-starttime="1637"><span class="speakerName">Nat Duca</span>: Tom, I think we classify that </span><span class="line" data-startTime="1637">as a win. </span></p>

<p class="speaker"><span class="line" data-starttime="1639"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah, right. This is &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="1639"><span class="speakerName">Nat Duca</span>: Brush metal aside. </span></p>

<p class="speaker"><span class="line" data-starttime="1643"><span class="speakerName">Tom Tom Wiltzius</span>: Right, but again there's this </span><span class="line" data-startTime="1643">tradeoff between the visual effect that you've </span><span class="line" data-startTime="1649">achieved with the styles that you've used </span><span class="line" data-startTime="1649">and what they are costing you. So &mdash; and so </span><span class="line" data-startTime="1653">this process, this is only the beginning. </span> <span class="line" data-startTime="1653">What &mdash; as we disable things &mdash; and I'm going </span><span class="line" data-startTime="1658">to disable something else, too. As we disable </span><span class="line" data-startTime="1658">things, like we're making the page look different. </span> <span class="line" data-startTime="1665">So this is only the beginning. The next step </span><span class="line" data-startTime="1665">is adding stuff back in or trying to achieve </span><span class="line" data-startTime="1671">the same visual effect via different styles </span><span class="line" data-startTime="1671">that won't have the same sort of like pathologically </span><span class="line" data-startTime="1678">bad cost. </span> <span class="line" data-startTime="1678">So in this case, there's one more thing I </span><span class="line" data-startTime="1682">want to try. Thanks to Nat's demo earlier, </span><span class="line" data-startTime="1682">I'm thinking maybe like box shadows are a </span><span class="line" data-startTime="1688">bad idea, so I'm going to turn off box shadows </span><span class="line" data-startTime="1688">and maybe the backgrounds of these things, </span><span class="line" data-startTime="1692">too, for the same reason that I turned it </span><span class="line" data-startTime="1692">off on the body. And looking at this, it feels </span><span class="line" data-startTime="1701">a lot smoother to my finger, but once again, </span><span class="line" data-startTime="1701">I'm not going to trust it, I'm going to go </span><span class="line" data-startTime="1707">to timeline, take a recording. And like, wow, </span><span class="line" data-startTime="1707">that just got way better, right? </span><span class="line" data-startTime="1712">There's one big one at the beginning. But </span><span class="line" data-startTime="1712">almost all of these times like look how low </span><span class="line" data-startTime="1718">these are. We started off at like what was </span><span class="line" data-startTime="1718">it? </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="1722"><span class="speakerName">Nat Duca</span>: Janktastic. </span></p>

<p class="speaker"><span class="line" data-starttime="1722"><span class="speakerName">Tom Tom Wiltzius</span>: Like 50 milliseconds a frame. </span></p>

<p class="speaker"><span class="line" data-starttime="1724"><span class="speakerName">Nat Duca</span>: Some big number. </span></p>

<p class="speaker"><span class="line" data-starttime="1724"><span class="speakerName">Tom Tom Wiltzius</span>: Like i.e., five frames worth </span><span class="line" data-startTime="1728">in one frame and now these paint times they </span><span class="line" data-startTime="1728">are like so small I'm having trouble clicking </span><span class="line" data-startTime="1733">on them. They are in the like few millisecond </span><span class="line" data-startTime="1733">range, like one millisecond range. And again, </span><span class="line" data-startTime="1741">you are saying well, that's great but you </span><span class="line" data-startTime="1741">changed the way the page looks, right? And </span><span class="line" data-startTime="1745">that's totally fair. </span></p>

<p class="speaker"><span class="line" data-starttime="1745"><span class="speakerName">Nat Duca</span>: And I mean this is PM versus programmer, </span><span class="line" data-startTime="1748">so I'm going, I'm good with this, right? But </span><span class="line" data-startTime="1748">this creates the right tension, right, between </span><span class="line" data-startTime="1754">design and technical that you can then use. </span></p>

<p class="speaker"><span class="line" data-starttime="1754"><span class="speakerName">Tom Tom Wiltzius</span>: And even at a technical level, </span><span class="line" data-startTime="1758">again, like you can then start building your </span><span class="line" data-startTime="1758">way back up. Now that you've identified what's </span><span class="line" data-startTime="1763">causing your problems &mdash; because again I didn't </span><span class="line" data-startTime="1763">change that much here, right? I got rid of </span><span class="line" data-startTime="1767">the box shadow and the background, and that's </span><span class="line" data-startTime="1767">it. And it's like that completely removed </span><span class="line" data-startTime="1772">the problem. So the question is how do I get </span><span class="line" data-startTime="1772">that nice background gradient and how do I </span><span class="line" data-startTime="1776">get the nice drop shadow effect, but without </span><span class="line" data-startTime="1776">all of the paint time cost. So I have this </span><span class="line" data-startTime="1781">version, oops, going to leave that open for </span><span class="line" data-startTime="1781">later. I have this version that I fixed up </span><span class="line" data-startTime="1785">a little bit. And I did it exactly what I </span><span class="line" data-startTime="1785">just showed you. I just started hunting around </span><span class="line" data-startTime="1792">for stuff. I went straight for the ones that </span><span class="line" data-startTime="1792">I found eventually first in this &mdash; in the </span><span class="line" data-startTime="1796">interest of time, so you didn't have to sit </span><span class="line" data-startTime="1796">through anything too boring. But like you </span><span class="line" data-startTime="1801">can imagine how this process goes, right? </span><span class="line" data-startTime="1801">And then I built it back up so that it visually </span><span class="line" data-startTime="1805">looks almost the same. I did this quickly </span><span class="line" data-startTime="1805">so there are a few differences, but you can </span><span class="line" data-startTime="1809">imagine getting there, right? I just used </span><span class="line" data-startTime="1809">images. I honestly just took screen shots </span><span class="line" data-startTime="1814">of the background and just like tiled them </span><span class="line" data-startTime="1814">and that was way faster. So now you can see </span><span class="line" data-startTime="1820">that like this thing is zippy. </span> <span class="line" data-startTime="1820">And if I open up devtools, switch to timeline, </span><span class="line" data-startTime="1825">take a recording, like we're not at the one </span><span class="line" data-startTime="1825">millisecond paint times that we were before, </span><span class="line" data-startTime="1832">but what are these costing, three milliseconds. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="1832"><span class="speakerName">Nat Duca</span>: That's butter. </span></p>

<p class="speaker"><span class="line" data-starttime="1836"><span class="speakerName">Tom Tom Wiltzius</span>: It's an order of magnitude </span><span class="line" data-startTime="1836">faster than it was before and it looks the </span><span class="line" data-startTime="1840">same. Right? Like this is significant and </span><span class="line" data-startTime="1840">all that I did was change two styles. </span><span class="line" data-startTime="1845">So the point is sometimes &mdash; this was like </span><span class="line" data-startTime="1845">a live website, right, like this is a live </span><span class="line" data-startTime="1850">website that Google made. </span><span class="line" data-startTime="1850">[ Laughter ] </span></p>

<p class="speaker"><span class="line" data-starttime="1852"><span class="speakerName">Tom Tom Wiltzius</span>: So &mdash; so the point is there </span><span class="line" data-startTime="1852">are plenty of times when just changing a few </span><span class="line" data-startTime="1858">little things is going to have a huge impact. </span> <span class="line" data-startTime="1858">But the hard part is how do you find those </span><span class="line" data-startTime="1863">things and that's what we're trying to impart </span><span class="line" data-startTime="1863">today, right? We're trying to explain to you </span><span class="line" data-startTime="1867">the process and the tools that you can use </span><span class="line" data-startTime="1867">to identify those bad, bad cases. </span> <span class="line" data-startTime="1874">There is one more trick I pulled in between </span><span class="line" data-startTime="1874">the good version and the bad version, which </span><span class="line" data-startTime="1879">I'm going to open back up again. </span> <span class="line" data-startTime="1879">And the way I found this trick, the way I </span><span class="line" data-startTime="1885">found this thing that was additionally slowing </span><span class="line" data-startTime="1885">me down was through abouttracing. So devtools </span><span class="line" data-startTime="1889">is great and we recommend everyone start with </span><span class="line" data-startTime="1889">devtools and the new features in timeline </span><span class="line" data-startTime="1893">are particularly compelling for this. But </span><span class="line" data-startTime="1893">&mdash; but if this is not enough for you, you </span><span class="line" data-startTime="1899">can get a lot closer to the middle by using </span><span class="line" data-startTime="1899">abouttracing, which is a special tab in Chrome. </span> <span class="line" data-startTime="1903">It's what we use to debug performance problems </span><span class="line" data-startTime="1903">in the Web browser. And it can be really useful </span><span class="line" data-startTime="1908">for you if timeline isn't enough for you or </span><span class="line" data-startTime="1908">if you are just stuck. And it will show you </span><span class="line" data-startTime="1912">a lot of stuff that's happening inside of </span><span class="line" data-startTime="1912">the browser. It exposes Chrome's multi-process </span><span class="line" data-startTime="1917">model. It is a lot more complicated and not </span><span class="line" data-startTime="1917">nearly as user friendly, but there is some </span><span class="line" data-startTime="1922">documentation that the two of us wrote up, </span><span class="line" data-startTime="1922">we put it up on the Chromium dev site so you </span><span class="line" data-startTime="1927">can check that out from there. </span></p>

<p><span class="line" data-startTime="1927">The trick that I discovered for this particular </span><span class="line" data-startTime="1932">page using abouttracing is something that </span><span class="line" data-startTime="1932">doesn't show up inside of devtools right now, </span><span class="line" data-startTime="1938">and that's image decode costs &mdash; so as I mentioned </span><span class="line" data-startTime="1938">earlier, that green paint block, that we see </span><span class="line" data-startTime="1944">in the devtools timeline, today it's totally </span><span class="line" data-startTime="1944">opaque, right? </span><span class="line" data-startTime="1948">You don't get any granularity until like what </span><span class="line" data-startTime="1948">is the Web browser doing? </span><span class="line" data-startTime="1951">We're working on that. Those of you who saw </span><span class="line" data-startTime="1951">Pavel's talk before with Sam, you guys know </span><span class="line" data-startTime="1957">that there is some good stuff coming from </span><span class="line" data-startTime="1957">devtools that's going to expose more detailed </span><span class="line" data-startTime="1962">information. But in the meantime, like that </span><span class="line" data-startTime="1962">wasn't obvious to me from devtools, but I </span><span class="line" data-startTime="1966">saw these long JPEG like decodes and resizes </span><span class="line" data-startTime="1966"> &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="1971"><span class="speakerName">Nat Duca</span>: What happens is that he'll show </span><span class="line" data-startTime="1971">you the trick in a minute or maybe you can </span><span class="line" data-startTime="1974">bring up the bit. You would scroll, it felt </span><span class="line" data-startTime="1974">really good, but the first time you loaded </span><span class="line" data-startTime="1982">it, just the first time, every once in a while </span><span class="line" data-startTime="1982">you would see something, like what in the </span><span class="line" data-startTime="1984">heck was that, felt a little janky, right? </span><span class="line" data-startTime="1984">It was in the uncanny valley territory. This </span><span class="line" data-startTime="1989">page started off as really just terrible. </span><span class="line" data-startTime="1989">Right? </span><span class="line" data-startTime="1992">But there's still this uncanny valley and </span><span class="line" data-startTime="1992">it was showing up as long paints, but you </span><span class="line" data-startTime="1997">couldn't tell why. So that's where you jump </span><span class="line" data-startTime="1997">into &mdash; if you care, you jump into tracing </span><span class="line" data-startTime="2001">to figure that last bit out. </span></p>

<p class="speaker"><span class="line" data-starttime="2001"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. And so in this case, </span><span class="line" data-startTime="2004">again, there were some JPEG decodes that were </span><span class="line" data-startTime="2004">showing up, these can take upwards of like </span><span class="line" data-startTime="2011">40 to 60 milliseconds even on this fast computer. </span> <span class="line" data-startTime="2011">This is huge, right, because again that happens </span><span class="line" data-startTime="2017">within a frame because the Web browser is </span><span class="line" data-startTime="2017">not doing anything else while it's decoding </span><span class="line" data-startTime="2020">that image at least in the renderer, right? </span><span class="line" data-startTime="2020">Which means you just missed five frames, like </span><span class="line" data-startTime="2026">you just stalled, you are done. </span> <span class="line" data-startTime="2026">And this is bad. </span> <span class="line" data-startTime="2030">So how do you avoid this? Well, in this case </span><span class="line" data-startTime="2030">the reason that these scales were happening </span><span class="line" data-startTime="2036">was because the images weren't sized at the </span><span class="line" data-startTime="2036">resolution that they were being displayed. </span> <span class="line" data-startTime="2042">Right? So devtools will tell you this, it </span><span class="line" data-startTime="2042">just doesn't show up as a component of the </span><span class="line" data-startTime="2047">paint time. So if you moused over this image </span><span class="line" data-startTime="2047">in devtools, you will see that it's being </span><span class="line" data-startTime="2050">displayed at 300 by 300 pixels, but in fact </span><span class="line" data-startTime="2050">it's a 512 by 512 pixel image. Again, like </span><span class="line" data-startTime="2056">that JPEG scale probably doesn't seem like </span><span class="line" data-startTime="2056">a big deal, but it starts to become a big </span><span class="line" data-startTime="2060">deal when you start thinking about things </span><span class="line" data-startTime="2060">on the order of milliseconds, right? Because </span><span class="line" data-startTime="2065">a 40-millisecond image resizing operation </span><span class="line" data-startTime="2065">actually becomes quite painful. So from the </span><span class="line" data-startTime="2071">good version to the bad version that I was </span><span class="line" data-startTime="2071">showing earlier, in addition to making those </span><span class="line" data-startTime="2075">two style changes, I also resized all the </span><span class="line" data-startTime="2075">images so that they were displaying natively. </span></p>

<p><span class="line" data-startTime="2080">This is a simple trick any of you can pull </span><span class="line" data-startTime="2080">because this has no visual impact, right? </span><span class="line" data-startTime="2084">This is just a perf point &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2084"><span class="speakerName">Nat Duca</span>: But it will cause jank. Most websites, </span><span class="line" data-startTime="2088">this is a really common one, so go &mdash; go to </span><span class="line" data-startTime="2088">your websites now. </span></p>

<p class="speaker"><span class="line" data-starttime="2093"><span class="speakerName">Tom Tom Wiltzius</span>: So this is the kind of thing </span><span class="line" data-startTime="2093"> &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2094"><span class="speakerName">Nat Duca</span>: Fix it, okay? </span></p>

<p class="speaker"><span class="line" data-starttime="2094"><span class="speakerName">Tom Tom Wiltzius</span>: The point here, lest Nat get </span><span class="line" data-startTime="2100">too emphatic, the point here is not here are </span><span class="line" data-startTime="2100">some magic bullets to go make your websites </span><span class="line" data-startTime="2106">faster. </span><span class="line" data-startTime="2106">The point is the process, right? This is all </span><span class="line" data-startTime="2109">about the tools that you can use and the techniques </span><span class="line" data-startTime="2109">that you can follow in order to figure out </span><span class="line" data-startTime="2114">what's slowing down your site. Browsers evolve </span><span class="line" data-startTime="2114">really fast. And like &mdash; to the people who </span><span class="line" data-startTime="2119">are like trying to evolve the browser really </span><span class="line" data-startTime="2119">fast &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2121"><span class="speakerName">Nat Duca</span>: To blame. </span></p>

<p class="speaker"><span class="line" data-starttime="2121"><span class="speakerName">Tom Tom Wiltzius</span>: Right. So all of the specifics </span><span class="line" data-startTime="2125">of what we're talking about here, the drop </span><span class="line" data-startTime="2125">shadows, the background gradients, the image </span><span class="line" data-startTime="2129">resizing, like we are actually working actively </span><span class="line" data-startTime="2129">working on making all of this faster, so hopefully </span><span class="line" data-startTime="2133">in six months they aren't going to be a problem. </span></p>

<p class="speaker"><span class="line" data-starttime="2133"><span class="speakerName">Nat Duca</span>: But then there will be another </span><span class="line" data-startTime="2136">style or another new hotness and that one </span><span class="line" data-startTime="2136">will be tickling the corner case in the browser </span><span class="line" data-startTime="2141">and it will make the browser sneeze or it </span><span class="line" data-startTime="2141">will be fast in IE or fast in Chrome. </span></p>

<p class="speaker"><span class="line" data-starttime="2144"><span class="speakerName">Tom Tom Wiltzius</span>: Right. </span></p>

<p class="speaker"><span class="line" data-starttime="2144"><span class="speakerName">Nat Duca</span>: It's this wild world out there. </span></p>

<p class="speaker"><span class="line" data-starttime="2146"><span class="speakerName">Tom Tom Wiltzius</span>: Browser variation, also huge, </span><span class="line" data-startTime="2146">right? Like, as we care more and more about </span><span class="line" data-startTime="2152">performance on the Web, like it starts to </span><span class="line" data-startTime="2152">become a problem that like different browsers </span><span class="line" data-startTime="2155">do things slightly differently, et cetera, </span><span class="line" data-startTime="2155">et cetera. </span><span class="line" data-startTime="2157">So the point is use the tools. Like start </span><span class="line" data-startTime="2157">to train your eye to notice jank. Follow the </span><span class="line" data-startTime="2165">architectural best practices that we have </span><span class="line" data-startTime="2165">laid out, because these are true across browsers </span><span class="line" data-startTime="2169">and will be true across time, too. Use requestAnimationFrame, </span><span class="line" data-startTime="2169">use CSS animation, make sure you don't have </span><span class="line" data-startTime="2175">like one-second long parsing JavaScript operation </span><span class="line" data-startTime="2175">going on. </span></p>

<p class="speaker"><span class="line" data-starttime="2179"><span class="speakerName">Nat Duca</span>: Rendering. </span></p>

<p class="speaker"><span class="line" data-starttime="2179"><span class="speakerName">Tom Tom Wiltzius</span>: Right. </span> <span class="line" data-startTime="2181">I mean, like kick stuff to worker threads, </span><span class="line" data-startTime="2181">right, or like break stuff into queues and </span><span class="line" data-startTime="2185">yields, right, like anything that you can </span><span class="line" data-startTime="2185">do to like not clog the main thread with all </span><span class="line" data-startTime="2190">of the other crap your other applications </span><span class="line" data-startTime="2190">are doing is good, right? But again, the specifics </span><span class="line" data-startTime="2195">are all going to change. </span> <span class="line" data-startTime="2195">So once you start to notice Jank, you're going </span><span class="line" data-startTime="2199">to see it everywhere, and hopefully you've </span><span class="line" data-startTime="2199">got a passion for making things faster, you </span><span class="line" data-startTime="2202">want to make your site faster, et cetera, </span><span class="line" data-startTime="2202">et cetera, so you're going to use the devtools </span><span class="line" data-startTime="2206">timeline, you're going to use about tracing, </span><span class="line" data-startTime="2206">you're going to do this funny trick we did </span><span class="line" data-startTime="2210">where we just bisecting down what's slow by </span><span class="line" data-startTime="2210">turning things off and re-enabling them, and </span><span class="line" data-startTime="2216">with that, hopefully you'll be better equipped </span><span class="line" data-startTime="2216">than you were before to make this stuff fast. </span> <span class="line" data-startTime="2223">If you're hungry for more, these slides and </span><span class="line" data-startTime="2223">other resources are off of Jankfree.com, and </span><span class="line" data-startTime="2228">we are actually going to be &mdash; we're going </span><span class="line" data-startTime="2228">to take questions in a couple of minutes, </span><span class="line" data-startTime="2232">but we're also going to be at office hours </span><span class="line" data-startTime="2232">in the Chrome area, just around the corner, </span><span class="line" data-startTime="2236">I think, right after this talk. We like doing </span><span class="line" data-startTime="2236">this. If you have a site that's janky, and </span><span class="line" data-startTime="2242">you want to come by, like, we'll take a crack </span><span class="line" data-startTime="2242">at speeding it up. We'd love to do that, like, </span><span class="line" data-startTime="2247">for an audience, too, so if anyone wants to </span><span class="line" data-startTime="2247">come by and try that, we'll give it a shot, </span><span class="line" data-startTime="2252">and with that, I think we're going to say </span><span class="line" data-startTime="2252">thanks, and take questions... </span></p>

<p><span class="line" data-startTime="2257">[ Applause ] </span><span class="line" data-startTime="2257">Anyone got anything? </span></p>

<p class="speaker"><span class="line" data-starttime="2260"><span class="speakerName">Audience member</span>: I have one. </span></p>

<p class="speaker"><span class="line" data-starttime="2260"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah, please. </span></p>

<p class="speaker"><span class="line" data-starttime="2266"><span class="speakerName">Audience member</span>: The CSS animation transition threading, </span><span class="line" data-startTime="2266">will that or does that apply to Web view? </span></p>

<p class="speaker"><span class="line" data-starttime="2277"><span class="speakerName">Nat Duca</span>: Talking about Android Webview? </span><span class="line" data-startTime="2277">So, you know, the Web moves really fast and </span><span class="line" data-startTime="2285">there are like a zillion different ports, </span><span class="line" data-startTime="2285">and CSS spec in general, the animation spec, </span><span class="line" data-startTime="2292">it allows this, so it's good to design for </span><span class="line" data-startTime="2292">even if it's not working today, it will start </span><span class="line" data-startTime="2297">working everywhere within the next, you know </span><span class="line" data-startTime="2297"> &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2300"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. </span></p>

<p class="speaker"><span class="line" data-starttime="2300"><span class="speakerName">Audience member</span>: Nat Duca: But this is very much our plan. </span><span class="line" data-startTime="2302">The next soon; that's a unit of time. >>Tom </span></p>

<p class="speaker"><span class="line" data-starttime="2302"><span class="speakerName">Tom Wiltzius</span>: Yeah, and like there is going to </span><span class="line" data-startTime="2305">be other stuff like this, like basically we're </span><span class="line" data-startTime="2305">trying to kind of move away from the model </span><span class="line" data-startTime="2310">of everything happens on the single thread </span><span class="line" data-startTime="2310">in the renderer, right, and this is kind of </span><span class="line" data-startTime="2315">the beginning of that, but there will be more </span><span class="line" data-startTime="2315">things like this as well, so, yeah &mdash; please, </span><span class="line" data-startTime="2321">yeah. </span></p>

<p class="speaker"><span class="line" data-starttime="2321"><span class="speakerName">Audience member</span>: So one of the use cases between mobile </span><span class="line" data-startTime="2323">browsers and desktop browsers is that mobile </span><span class="line" data-startTime="2323">browsers tend to zoom a lot, right? So what </span><span class="line" data-startTime="2328">can you say about that and handling that, </span><span class="line" data-startTime="2328">like your image case, it's useless if it's </span><span class="line" data-startTime="2333">only 300 x 300 if you're actually zooming </span><span class="line" data-startTime="2333">in, you cant actually see that extra detail. </span></p>

<p class="speaker"><span class="line" data-starttime="2339"><span class="speakerName">Tom Tom Wiltzius</span>: Uh-huh, yeah, so I would say </span><span class="line" data-startTime="2339">&mdash; you might also say like for high resolution </span><span class="line" data-startTime="2344">screens like I want that image to be able </span><span class="line" data-startTime="2344">to be resized at a larger resolution, right? </span><span class="line" data-startTime="2350">Like there are a lot of cases where you're </span><span class="line" data-startTime="2350">going to make tradeoffs between like quality </span><span class="line" data-startTime="2355">essentially and performance, right, like these </span><span class="line" data-startTime="2355">things are almost always going to be in tension. </span><span class="line" data-startTime="2359">I think in that case, you probably are going </span><span class="line" data-startTime="2359">to have to decide where on that &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2363"><span class="speakerName">Nat Duca</span>: You're totally right. Mobile browsers </span><span class="line" data-startTime="2363">are the forefront of awesomeness in terms </span><span class="line" data-startTime="2370">of like stuff behind the scenes. </span></p>

<p class="speaker"><span class="line" data-starttime="2370"><span class="speakerName">Tom Tom Wiltzius</span>: Like PERF winds because the </span><span class="line" data-startTime="2373">part &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2373"><span class="speakerName">Nat Duca</span>: So that will bite you in the case </span><span class="line" data-startTime="2377">of a pinch zoom, but mobile browsers have </span><span class="line" data-startTime="2377">&mdash; especially Chrome Android has some very </span><span class="line" data-startTime="2384">severe magic so that you wouldn't even notice </span><span class="line" data-startTime="2384">this in the first place during a pinch zoom. </span> <span class="line" data-startTime="2391">We'll probably blog about the magic at some </span><span class="line" data-startTime="2391">point, but essentially, you know, when you </span><span class="line" data-startTime="2396">use Chrome Android, you can time it, you can </span><span class="line" data-startTime="2396">pinch zoom, and you'll actually see that in </span><span class="line" data-startTime="2403">that case you won't get a jank and so then </span><span class="line" data-startTime="2403">you won't care. That's the best answer I can </span><span class="line" data-startTime="2404">give you. </span></p>

<p class="speaker"><span class="line" data-starttime="2404"><span class="speakerName">Tom Tom Wiltzius</span>: We can talk more about that </span><span class="line" data-startTime="2405">at office hours. The full &mdash; the full sort </span><span class="line" data-startTime="2405">of magic explanation is really complicated. </span><span class="line" data-startTime="2410">We'll be happy to talk about it more. </span></p>

<p class="speaker"><span class="line" data-starttime="2410"><span class="speakerName">Nat Duca</span>: Measure. </span></p>

<p class="speaker"><span class="line" data-starttime="2414"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. </span></p>

<p class="speaker"><span class="line" data-starttime="2414"><span class="speakerName">Audience member</span>: Great presentation. You hinted at some </span><span class="line" data-startTime="2419">more tools that you were going to be adding </span><span class="line" data-startTime="2419">to the frame view and the profiler, can you </span><span class="line" data-startTime="2424">give us some hints as in updates on what those </span><span class="line" data-startTime="2424">are going to be? </span></p>

<p class="speaker"><span class="line" data-starttime="2426"><span class="speakerName">Nat Duca</span>: Well, how about you tell us what </span><span class="line" data-startTime="2426">you want. </span></p>

<p class="speaker"><span class="line" data-starttime="2428"><span class="speakerName">Audience member</span>: I would love to be able to see the element </span><span class="line" data-startTime="2428">that takes the longest and just be able to </span><span class="line" data-startTime="2434">go right to it. </span></p>

<p class="speaker"><span class="line" data-starttime="2434"><span class="speakerName">Tom Tom Wiltzius</span>: Right, yeah. That sounds cool. </span></p>

<p class="speaker"><span class="line" data-starttime="2438"><span class="speakerName">Nat Duca</span>: We should totally do that. </span></p>

<p class="speaker"><span class="line" data-starttime="2438"><span class="speakerName">Tom Tom Wiltzius</span>: Should tell that to Pavel. </span></p>

<p class="speaker"><span class="line" data-starttime="2440"><span class="speakerName">Nat Duca</span>: We're on the team and we're pushing &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2440"><span class="speakerName">Tom Tom Wiltzius</span>: We bug Pavel who is standing </span><span class="line" data-startTime="2445">in the back, and just talk about devtools </span><span class="line" data-startTime="2445">all the time for like &mdash; yeah, we totally </span><span class="line" data-startTime="2449">want things like this. </span></p>

<p class="speaker"><span class="line" data-starttime="2449"><span class="speakerName">Audience member</span>: Maybe line numbers and like function &mdash; or </span><span class="line" data-startTime="2452">functions that take the longest time which </span><span class="line" data-startTime="2452">is where you're spending the most time instead </span><span class="line" data-startTime="2455">of JavaScript functions would be awesome. </span></p>

<p class="speaker"><span class="line" data-starttime="2455"><span class="speakerName">Nat Duca</span>: So my hope, and my boss &mdash; my </span><span class="line" data-startTime="2460">actual boss is in this room, so I hope to </span><span class="line" data-startTime="2460">be able to stand here next year and instead </span><span class="line" data-startTime="2464">of having to say, oh, look at this big green </span><span class="line" data-startTime="2464">thing, and then spend &mdash; how long did we spend, </span><span class="line" data-startTime="2468">like 20 minutes trying to explain what was </span><span class="line" data-startTime="2468">slow about the &mdash; I'll push a button and it </span><span class="line" data-startTime="2473">will be like that one, that would be great. </span><span class="line" data-startTime="2473">Whether we can get there, yeah, TBD, but that </span><span class="line" data-startTime="2477">would be a nice thing. </span></p>

<p class="speaker"><span class="line" data-starttime="2477"><span class="speakerName">Tom Tom Wiltzius</span>: Definitely &mdash; definitely granularity </span><span class="line" data-startTime="2480">in like paint cost is something we're looking </span><span class="line" data-startTime="2480">at. I think like some of the &mdash; some of the </span><span class="line" data-startTime="2486">JavaScript stuff may be better served by improving </span><span class="line" data-startTime="2486">the profiler than improving timeline, right, </span><span class="line" data-startTime="2490">but, like it's a point well taken. </span></p>

<p class="speaker"><span class="line" data-starttime="2490"><span class="speakerName">Audience member</span>: Great, thanks again. </span></p>

<p class="speaker"><span class="line" data-starttime="2494"><span class="speakerName">Nat Duca</span>: Feel free to file new.crbug.com, </span><span class="line" data-startTime="2494">because we really do read all that stuff, </span><span class="line" data-startTime="2500">and so like crazy ideas are awesome, because </span><span class="line" data-startTime="2500">we can tell you you're crazy, but then we'll </span><span class="line" data-startTime="2505">listen, and make a note, we'll try to do it. </span></p>

<p class="speaker"><span class="line" data-starttime="2505"><span class="speakerName">Audience member</span>: So this trace and recording, they really </span><span class="line" data-startTime="2513">slow down the Web page? So if I disable that, </span><span class="line" data-startTime="2513">will the Web page work faster? </span></p>

<p class="speaker"><span class="line" data-starttime="2519"><span class="speakerName">Tom Tom Wiltzius</span>: In some cases, yeah, like </span><span class="line" data-startTime="2519">so you even saw like Nat at some point during </span><span class="line" data-startTime="2525">his demo, was like, yeah, this still looks </span><span class="line" data-startTime="2525">&mdash; even though I've disabled my heavy onscroll </span><span class="line" data-startTime="2528">handler and my costly CSS styles, it's still </span><span class="line" data-startTime="2528">a little janky, and as soon as you close devtools, </span><span class="line" data-startTime="2536">it got a lot smoother, so there is some instrumentation </span><span class="line" data-startTime="2536">overhead especially with devtools. That's </span><span class="line" data-startTime="2541">going to be fixed. Pavel is going to fix that. </span></p>

<p class="speaker"><span class="line" data-starttime="2541"><span class="speakerName">Nat Duca</span>: So the high level is &mdash; we won't </span><span class="line" data-startTime="2548">&mdash; we're trying not build things that have </span><span class="line" data-startTime="2548">those corners. Right? </span><span class="line" data-startTime="2552">When you're using &mdash; this is bleeding edge, </span><span class="line" data-startTime="2552">this stuff that we showed today, it's the </span><span class="line" data-startTime="2554"> &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2554"><span class="speakerName">Tom Tom Wiltzius</span>: Like this is yesterday's Canary. </span></p>

<p class="speaker"><span class="line" data-starttime="2556"><span class="speakerName">Nat Duca</span>: This is like the Canary. By the </span><span class="line" data-startTime="2556">time this is stable, it will be totally awesome, </span><span class="line" data-startTime="2562">and you may hit a corner case, but it's very, </span><span class="line" data-startTime="2562">very unlikely. Does that answer your question? </span></p>

<p class="speaker"><span class="line" data-starttime="2566"><span class="speakerName">Tom Tom Wiltzius</span>: And there should be &mdash; there </span><span class="line" data-startTime="2566">should be like &mdash; there is sufficient granularity </span><span class="line" data-startTime="2571">in the timeline already that like &mdash; we saw </span><span class="line" data-startTime="2571">some problems where like there's &mdash; there's </span><span class="line" data-startTime="2575">some instrumentation overhead and you don't </span><span class="line" data-startTime="2575">get the frame times you want, but we still </span><span class="line" data-startTime="2579">know pretty well how long the paints take, </span><span class="line" data-startTime="2579">for instance, and that kind of thing shouldn't </span><span class="line" data-startTime="2584">be as dramatically affected by tool overhead. </span></p>

<p class="speaker"><span class="line" data-starttime="2584"><span class="speakerName">Audience member</span>: I still cannot use it for stats. </span></p>

<p class="speaker"><span class="line" data-starttime="2591"><span class="speakerName">Nat Duca</span>: What's that? </span></p>

<p class="speaker"><span class="line" data-starttime="2591"><span class="speakerName">Audience member</span>: I still cannot use it for stats? </span></p>

<p class="speaker"><span class="line" data-starttime="2592"><span class="speakerName">Tom Tom Wiltzius</span>: You can't maybe use it for, </span><span class="line" data-startTime="2592">in that case, like frame time stats, but you </span><span class="line" data-startTime="2595">can use it for like &mdash; if you cut your paint </span><span class="line" data-startTime="2595">time in half, you have cut your paint time </span><span class="line" data-startTime="2598">in half. </span></p>

<p class="speaker"><span class="line" data-starttime="2598"><span class="speakerName">Audience member</span>: I cannot save my page when they're like </span><span class="line" data-startTime="2601">60 frames per second. </span></p>

<p class="speaker"><span class="line" data-starttime="2601"><span class="speakerName">Nat Duca</span>: Yeah, you can. </span></p>

<p class="speaker"><span class="line" data-starttime="2603"><span class="speakerName">Tom Tom Wiltzius</span>: You can see that within a </span><span class="line" data-startTime="2603">frame you didn't take &mdash; like your page only </span><span class="line" data-startTime="2609">consumed whatever, like ten milliseconds worth </span><span class="line" data-startTime="2609">of stuff, right, and then if you close devtools </span><span class="line" data-startTime="2618">and it's fast and you're good, right. </span></p>

<p class="speaker"><span class="line" data-starttime="2618"><span class="speakerName">Audience member</span>: But if it's recording then &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2620"><span class="speakerName">Nat Duca</span>: It's not that &mdash; it's not that </span><span class="line" data-startTime="2620">heavy and it's not on that process, especially </span><span class="line" data-startTime="2624">like &mdash; yes, on an Android you might get a </span><span class="line" data-startTime="2624">slight, slight penalty, but to be totally </span><span class="line" data-startTime="2628">honest, by the time we're done, it should </span><span class="line" data-startTime="2628">be maybe one or two percent overhead, which </span><span class="line" data-startTime="2635">one or two percent overhead on 16 milliseconds </span><span class="line" data-startTime="2635">is nonzero, but it's not so much that I think </span><span class="line" data-startTime="2639">it will perturb the average Web page enough </span><span class="line" data-startTime="2639">that you'll notice, okay? </span></p>

<p class="speaker"><span class="line" data-starttime="2647"><span class="speakerName">Audience member</span>: Yeah, thanks. </span></p>

<p class="speaker"><span class="line" data-starttime="2647"><span class="speakerName">Audience member</span>: Awesome presentation, awesome tool, totally </span><span class="line" data-startTime="2649">stoked that we have it. My question is now </span><span class="line" data-startTime="2649">we have high DPI devices, not necessarily </span><span class="line" data-startTime="2658">Chrome, I mean &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2658"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah, sure. </span></p>

<p class="speaker"><span class="line" data-starttime="2660"><span class="speakerName">Audience member</span>: Like the iPhone. And so using background </span><span class="line" data-startTime="2660">size, you need to use background size to take </span><span class="line" data-startTime="2663">these huge images so that they're high DPI </span><span class="line" data-startTime="2663">in your example &mdash; so is there any way to </span><span class="line" data-startTime="2668">measure it on &mdash; like I know your tools only </span><span class="line" data-startTime="2668">work for Chrome, but how can we force it into </span><span class="line" data-startTime="2673">a high DPI without buying the new MacBook </span><span class="line" data-startTime="2673">Pro that's higher DPI? </span></p>

<p class="speaker"><span class="line" data-starttime="2677"><span class="speakerName">Nat Duca</span>: So probably a question for Pavel, </span><span class="line" data-startTime="2677">who you could turn around and walk to &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2682"><span class="speakerName">Tom Tom Wiltzius</span>: Well, I mean, I can give you </span><span class="line" data-startTime="2682">some starter hints. One, there's a way to </span><span class="line" data-startTime="2686">turn, if you've got a non-high resolution </span><span class="line" data-startTime="2686">MacBook, you can flip it, if you install some </span><span class="line" data-startTime="2688">tools, you can flip it into like a fake high </span><span class="line" data-startTime="2688">DPI mode, won't be as accurate because you </span><span class="line" data-startTime="2693">can't get the whole thing so you can't get </span><span class="line" data-startTime="2693">like the cost of full page repaints, for instance, </span><span class="line" data-startTime="2697">because it's only a quarter of the screen, </span><span class="line" data-startTime="2697">but at least you can see how things will look </span><span class="line" data-startTime="2700">and you can get a sense for some of the timing </span><span class="line" data-startTime="2700">which is a start. There are ways to avoid </span><span class="line" data-startTime="2706">like using JavaScript and stuff, you can only </span><span class="line" data-startTime="2706">load like &mdash; I think this was the first part </span><span class="line" data-startTime="2711">of your question, like you can only load high </span><span class="line" data-startTime="2711">resolution assets if you need them. </span></p>

<p><span class="line" data-startTime="2714">You can use media queries for instance, so </span><span class="line" data-startTime="2714">that will sort of avoid unnecessarily taking </span><span class="line" data-startTime="2719">the hits, and as for profiling what the hit </span><span class="line" data-startTime="2719">is like, you can kind of again fake it, but </span><span class="line" data-startTime="2727">to really test, yeah, you probably got to </span><span class="line" data-startTime="2727">buy a new computer. </span></p>

<p class="speaker"><span class="line" data-starttime="2730"><span class="speakerName">Nat Duca</span>: I do have one like ignoring the </span><span class="line" data-startTime="2730">image discussion. There is one caveat for </span><span class="line" data-startTime="2734">all of you, which is high DPI means that your </span><span class="line" data-startTime="2734">paint times double, not exactly, but that's </span><span class="line" data-startTime="2741">your risk, right? You're painting twice &mdash; well, </span><span class="line" data-startTime="2741">four times as much, look at me doing math. </span></p>

<p class="speaker"><span class="line" data-starttime="2748"><span class="speakerName">Audience member</span>: Sometimes it's quadruple. </span></p>

<p class="speaker"><span class="line" data-starttime="2748"><span class="speakerName">Nat Duca</span>: Yeah, no, this is me doing math </span><span class="line" data-startTime="2749">in a really funny way. Four is the number. </span><span class="line" data-startTime="2749">I shouldn't work for Google, should I? </span></p>

<p class="speaker"><span class="line" data-starttime="2755"><span class="speakerName">Tom Tom Wiltzius</span>: High DPI &mdash; the point is high </span><span class="line" data-startTime="2755">DPI stuff is going to have significant &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2759"><span class="speakerName">Nat Duca</span>: So you gotta keep your base loads. </span><span class="line" data-startTime="2759">So if you're like on this MacBook Pro, this </span><span class="line" data-startTime="2764">is like a two-year-old MacBook, and it's really </span><span class="line" data-startTime="2764">chugging and it's hitting like fifteen millisecond </span><span class="line" data-startTime="2768">paints, then you're really, really &mdash; this </span><span class="line" data-startTime="2768">is not going to work on a good &mdash; on one of </span><span class="line" data-startTime="2773">the new ones because the paint is only going </span><span class="line" data-startTime="2773">to go up. It might be a slightly faster Intel </span><span class="line" data-startTime="2775">CPU &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2775"><span class="speakerName">Tom Tom Wiltzius</span>: About four times faster. </span><span class="line" data-startTime="2775">Nat Duca: &mdash; but you got to just &mdash; you </span><span class="line" data-startTime="2775">gotta keep it small, right, and give yourself </span><span class="line" data-startTime="2782">head room for the higher end devices. And </span><span class="line" data-startTime="2782">the lower end. </span></p>

<p class="speaker"><span class="line" data-starttime="2784"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah, and I mentioned this </span><span class="line" data-startTime="2784">&mdash; I mentioned this a little like really briefly </span><span class="line" data-startTime="2787">as an aside during the presentation, but I </span><span class="line" data-startTime="2787">do want to put a plug in, too, for like most </span><span class="line" data-startTime="2791">of you are Web developers, most of you have </span><span class="line" data-startTime="2791">very fast, very fancy computer, like think </span><span class="line" data-startTime="2795">about the computers your users have because </span><span class="line" data-startTime="2795">they are not MacBook Pros, right? And like </span><span class="line" data-startTime="2801">we collect stats, like anonymous stats about </span><span class="line" data-startTime="2801">like the common sort of like system configurations </span><span class="line" data-startTime="2807">of Chrome users, and like I'll tell you, like, </span><span class="line" data-startTime="2807">the average Chrome user has like a really </span><span class="line" data-startTime="2812">crappy three-year-old laptop, right? And like </span><span class="line" data-startTime="2812">this is &mdash; this is what the internet population </span><span class="line" data-startTime="2817">is, so for some things this doesn't matter, </span><span class="line" data-startTime="2817">but for like really sensitive performance </span><span class="line" data-startTime="2822">stuff, like I'm trying to make a 16 millisecond </span><span class="line" data-startTime="2822">paint &mdash; frame budget, it's huge, right? </span><span class="line" data-startTime="2829">So think about that. Like I wouldn't even </span><span class="line" data-startTime="2829">recommend maybe testing on not your development </span><span class="line" data-startTime="2833">machine for instance, but that's just me. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="2833"><span class="speakerName">Audience member</span>: Literally exactly on that point, and maybe </span><span class="line" data-startTime="2839">this for Pavel. </span></p>

<p class="speaker"><span class="line" data-starttime="2839"><span class="speakerName">Tom Tom Wiltzius</span>: He's not a plant. </span></p>

<p class="speaker"><span class="line" data-starttime="2842"><span class="speakerName">Audience member</span>: Can you guys just add a &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2842"><span class="speakerName">Nat Duca</span>: Slow me down &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2845"><span class="speakerName">Audience member</span>: Yeah, exactly. </span></p>

<p class="speaker"><span class="line" data-starttime="2845"><span class="speakerName">Tom Tom Wiltzius</span>: We talked about it. It's a </span><span class="line" data-startTime="2849">little hard to do super accurately. We've </span><span class="line" data-startTime="2849">talked about like making it do something like, </span><span class="line" data-startTime="2853">ah, just like paint everything ten times, </span><span class="line" data-startTime="2853">right? Because that way even small paint time </span><span class="line" data-startTime="2859">problems will be really (inaudible), I think </span><span class="line" data-startTime="2859">we probably need more fine grained instrumentation </span><span class="line" data-startTime="2866">before that is going to be really useful. </span></p>

<p class="speaker"><span class="line" data-starttime="2866"><span class="speakerName">Nat Duca</span>: That is geeky cool. We should </span><span class="line" data-startTime="2869">figure out how to make something with your </span><span class="line" data-startTime="2869">intent to work. </span></p>

<p class="speaker"><span class="line" data-starttime="2871"><span class="speakerName">Tom Tom Wiltzius</span>: It's a good idea. I think </span><span class="line" data-startTime="2871">your intent is spot on. </span></p>

<p class="speaker"><span class="line" data-starttime="2873"><span class="speakerName">Nat Duca</span>: I think your intent is really </span><span class="line" data-startTime="2873">key. You want to be able to, from your computer, </span><span class="line" data-startTime="2876">understand the performance of this content </span><span class="line" data-startTime="2876">somewhere else, and that's hard right now, </span><span class="line" data-startTime="2882">so maybe we should figure out maybe as a community </span><span class="line" data-startTime="2882">how to do better there. </span></p>

<p class="speaker"><span class="line" data-starttime="2886"><span class="speakerName">Audience member</span>: Yeah, I mean, you know, Pavel was saying </span><span class="line" data-startTime="2886">in the previous session, you know, the devtools, </span><span class="line" data-startTime="2888">the realtime and all that kind of stuff, you </span><span class="line" data-startTime="2888">know, having to right now have a bunch of </span><span class="line" data-startTime="2894">VMs or a bunch of like Chrome books, and these </span><span class="line" data-startTime="2894">kind of things, it just doesn't really scale, </span><span class="line" data-startTime="2898">versus I have a slider in my devtools, that </span><span class="line" data-startTime="2898">I can be like okay, I want to run at 20%, </span><span class="line" data-startTime="2903">see how this feels, oh, I can have the &mdash; all </span><span class="line" data-startTime="2903">the same timelines, all these kinds of things, </span><span class="line" data-startTime="2907">now the ability to improve my performance </span><span class="line" data-startTime="2907">on, you know, substandard machines dramatically </span><span class="line" data-startTime="2912">improves. </span></p>

<p class="speaker"><span class="line" data-starttime="2912"><span class="speakerName">Nat Duca</span>: Great point. I totally hear you. </span><span class="line" data-startTime="2915">Thank you. </span></p>

<p class="speaker"><span class="line" data-starttime="2915"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. </span></p>

<p class="speaker"><span class="line" data-starttime="2916"><span class="speakerName">Audience member</span>: I have two questions. First one was so </span><span class="line" data-startTime="2916">an example you had with like drop shadow and </span><span class="line" data-startTime="2922">(indiscernible) HTML5, you said you replaced </span><span class="line" data-startTime="2922">them with images to improve the performance, </span><span class="line" data-startTime="2925">is that right? Audience member: Yeah, but that is obviously </span><span class="line" data-startTime="2925">not ideal from like a Web development. </span></p>

<p class="speaker"><span class="line" data-starttime="2929"><span class="speakerName">Tom Tom Wiltzius</span>: Like the &mdash; like the &mdash; like </span><span class="line" data-startTime="2929">the spec people are going to kill me, right, </span><span class="line" data-startTime="2933">like I'm just like &mdash; I'm just saying don't </span><span class="line" data-startTime="2933">use any of this, it's not fast enough. </span></p>

<p class="speaker"><span class="line" data-starttime="2935"><span class="speakerName">Audience member</span>: Right, right, so like I mean are there </span><span class="line" data-startTime="2935">other techniques we can use now or is there </span><span class="line" data-startTime="2938">something browsers could do to optimize that </span><span class="line" data-startTime="2938">more? Because like I would assume the browsers </span><span class="line" data-startTime="2941">would pre-render shadows and cache them and </span><span class="line" data-startTime="2941">not have to re-render them all the time. </span></p>

<p class="speaker"><span class="line" data-starttime="2945"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. No, there are things </span><span class="line" data-startTime="2945">like that that we're doing, and this is why </span><span class="line" data-startTime="2947">we ended like with don't listen to the specifics </span><span class="line" data-startTime="2947">because they're going to change, the way &mdash; like </span><span class="line" data-startTime="2953">there are even bigger changes than that afoot </span><span class="line" data-startTime="2953">in like Chrome's rendering pipeline, to some </span><span class="line" data-startTime="2957">extent, and there's going to be caching at </span><span class="line" data-startTime="2957">like a much higher level, where we like stuff </span><span class="line" data-startTime="2961">on the GPU, so we don't need to repaint that </span><span class="line" data-startTime="2961">anymore, and like, yeah, that's all going </span><span class="line" data-startTime="2965">to be happening, so like it may end up being </span><span class="line" data-startTime="2965">that the one-time cost of like rendering those </span><span class="line" data-startTime="2972">shadows, say, actually turns out to be pretty </span><span class="line" data-startTime="2972">insignificant for you, and so I guess the </span><span class="line" data-startTime="2977">short answer is, yes, the browser is going </span><span class="line" data-startTime="2977">to try to take care of this for you. I don't </span><span class="line" data-startTime="2981">&mdash; I don't want you to sweat like drop shadow </span><span class="line" data-startTime="2981">too much, like this was very much a demo that </span><span class="line" data-startTime="2986">was meant to show you, like, how to find something </span><span class="line" data-startTime="2986">that is taking a disproportionate amount of </span><span class="line" data-startTime="2991">time and then dealing with it right now, right? </span><span class="line" data-startTime="2991">But I absolutely agree that the browser should </span><span class="line" data-startTime="2996">be solving this problem, and we're trying. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="2996"><span class="speakerName">Audience member</span>: And the other quick question is one of </span><span class="line" data-startTime="3000">your slides you mentioned something like performance.webkitnow, </span><span class="line" data-startTime="3000">but I don't think you talked about it. I was </span><span class="line" data-startTime="3006">just curious what that was. </span></p>

<p class="speaker"><span class="line" data-starttime="3006"><span class="speakerName">Nat Duca</span>: Yeah, we slipped that in there. </span><span class="line" data-startTime="3008">You've got a good eye. You can Google it. </span><span class="line" data-startTime="3008">Date.now is how we've always measured time, </span><span class="line" data-startTime="3014">and something that we slipped out there, and </span><span class="line" data-startTime="3014">it's going to be pretty much everywhere including </span><span class="line" data-startTime="3018">IE, is window.performance.now. There's this </span><span class="line" data-startTime="3018">whole prefix game, right? But it gives you </span><span class="line" data-startTime="3025">time at a submicrosecond resolution, it gives </span><span class="line" data-startTime="3025">you the fastest that your computer can give </span><span class="line" data-startTime="3030">you, so now you can timestamp individual functions </span><span class="line" data-startTime="3030">even and get reasonably good numbers out of </span><span class="line" data-startTime="3036">it. Totally use it. We used it, but, you know, </span><span class="line" data-startTime="3036">we didn't want to go into too much detail, </span><span class="line" data-startTime="3040">but it's a pretty cool addition to the platform. </span><span class="line" data-startTime="3040">And it's very useful for things like this, </span><span class="line" data-startTime="3045">when you're thinking on like &mdash; like &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="3045"><span class="speakerName">Audience member</span>: A millisecond, six percent error. </span></p>

<p class="speaker"><span class="line" data-starttime="3049"><span class="speakerName">Tom Tom Wiltzius</span>: Exactly, correct, yeah, it </span><span class="line" data-startTime="3049">ends up being very important to have submillisecond </span><span class="line" data-startTime="3054">precision and so we're finally bringing that </span><span class="line" data-startTime="3054">to the browser which is good. We're actually </span><span class="line" data-startTime="3061">going to even change like out of &mdash; for any </span><span class="line" data-startTime="3061">of you who already knew about request animation </span><span class="line" data-startTime="3065">frame and think like, oh, this is all old </span><span class="line" data-startTime="3065">hat, like we're actually changing the request </span><span class="line" data-startTime="3068">animation frame specs slightly to use the </span><span class="line" data-startTime="3068">new high resolution timer, so like you get </span><span class="line" data-startTime="3074">a time stamp with the rAF callback and it </span><span class="line" data-startTime="3074">used to be measured in milliseconds, since </span><span class="line" data-startTime="3079">EPOC now it's measured in whatever the high </span><span class="line" data-startTime="3079">resolution timer is which is like since page </span><span class="line" data-startTime="3084">load, so if you were using it already, check </span><span class="line" data-startTime="3084">your sites. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="3090"><span class="speakerName">Nat Duca</span>: Did you get the answer you're </span><span class="line" data-startTime="3090">looking for? </span></p>

<p class="speaker"><span class="line" data-starttime="3092"><span class="speakerName">Audience member</span>: Yeah. </span></p>

<p class="speaker"><span class="line" data-starttime="3092"><span class="speakerName">Nat Duca</span>: Great. Thank you. </span></p>

<p class="speaker"><span class="line" data-starttime="3092"><span class="speakerName">Audience member</span>: Actually part of my question so that you </span><span class="line" data-startTime="3092">could get some metrics from the field, with </span><span class="line" data-startTime="3095">this kind of stuff. It's nice as a developer, </span><span class="line" data-startTime="3095">but if the device diversity is so huge, especially </span><span class="line" data-startTime="3101">with the new GL stuff, because I'm trying </span><span class="line" data-startTime="3101">to make UIs in GL now, and it's really cool </span><span class="line" data-startTime="3106">to beat the 60 fps one, but it's really terrible </span><span class="line" data-startTime="3106">if you have to do it in FireFox as well and </span><span class="line" data-startTime="3110">all of these other things. And so my question </span><span class="line" data-startTime="3110">to you is how do you see the 60 fps domain </span><span class="line" data-startTime="3115">with browser diversity, because you guys are </span><span class="line" data-startTime="3115">optimizing in ways that you have to adapt </span><span class="line" data-startTime="3119">to to get that 60 fps, and everybody else </span><span class="line" data-startTime="3119">is doing something. </span></p>

<p class="speaker"><span class="line" data-starttime="3122"><span class="speakerName">Audience member</span>: Well, actually, so in theory, let me game </span><span class="line" data-startTime="3122">something out with you, and let's hear your </span><span class="line" data-startTime="3128">feedback. Like FireFox is actually like at </span><span class="line" data-startTime="3128">this minute, the Mozilla team is adjusting </span><span class="line" data-startTime="3134">their rAF implementation to do a lot better. </span><span class="line" data-startTime="3134">It used to be that their rAF implementation </span><span class="line" data-startTime="3137">didn't actually hit 60, and they're changing </span><span class="line" data-startTime="3137">it to actually hit 60 as we speak, so good </span><span class="line" data-startTime="3146">content that does what we think the right </span><span class="line" data-startTime="3146">thing is for the platform then drives the </span><span class="line" data-startTime="3150">browser vendors to optimize &mdash; or to make </span><span class="line" data-startTime="3150">things work correctly. All of this stuff is </span><span class="line" data-startTime="3157">so new that there's a lot of diversity in </span><span class="line" data-startTime="3157">the correctness of the implementations. So </span><span class="line" data-startTime="3161">my theory, may be wrong, is that this will </span><span class="line" data-startTime="3161">get a lot better in about a year as people </span><span class="line" data-startTime="3168">really catch up in their implementation quality </span><span class="line" data-startTime="3168">of the spec. I think the spec's about right, </span><span class="line" data-startTime="3173">plus or minus some nasty details, but we need </span><span class="line" data-startTime="3173">to really polish. </span></p>

<p class="speaker"><span class="line" data-starttime="3178"><span class="speakerName">Audience member</span>: Right. </span></p>

<p class="speaker"><span class="line" data-starttime="3178"><span class="speakerName">Nat Duca</span>: Is that responsive to your question? </span></p>

<p class="speaker"><span class="line" data-starttime="3181"><span class="speakerName">Audience member</span>: You're optimizing, right, so you're profiling </span><span class="line" data-startTime="3181">and optimizing, and that means that you get </span><span class="line" data-startTime="3184">case specific for browsers to try to make </span><span class="line" data-startTime="3184">things faster. I'm just wondering how you </span><span class="line" data-startTime="3187">see that evolve? Is it going to stay within </span><span class="line" data-startTime="3187">the spec or &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="3189"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah, I mean, I think at a </span><span class="line" data-startTime="3189">meta level, like you're absolutely right, </span><span class="line" data-startTime="3192">that this is &mdash; this is a problem for the </span><span class="line" data-startTime="3192">ecosystem, right, like the potential for performance </span><span class="line" data-startTime="3199">profile divergence, amongst like the browser </span><span class="line" data-startTime="3199">vendors is like potentially very serious, </span><span class="line" data-startTime="3203">right, and like we actually have probably </span><span class="line" data-startTime="3203">a lot more in common with FireFox than we </span><span class="line" data-startTime="3209">do with say like IE, but like you want your </span><span class="line" data-startTime="3209">stuff to work on IE too, and like it's implemented </span><span class="line" data-startTime="3214">very differently. I don't &mdash; we don't have </span><span class="line" data-startTime="3214"> &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="3215"><span class="speakerName">Audience member</span>: Are you responding to the 60 fps thing? </span></p>

<p class="speaker"><span class="line" data-starttime="3215"><span class="speakerName">Tom Tom Wiltzius</span>: I use usually like super key </span><span class="line" data-startTime="3220">nonperformance now. There's super key nonperformance </span><span class="line" data-startTime="3220">in spec compliance, and like they don't move </span><span class="line" data-startTime="3224">as fast as we do, because they don't want </span><span class="line" data-startTime="3224">to drive things forward as quickly, but like </span><span class="line" data-startTime="3227">they're &mdash; they &mdash; they were very support </span><span class="line" data-startTime="3227">of cross animation frame from the &mdash; this </span><span class="line" data-startTime="3231">is &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="3231"><span class="speakerName">Nat Duca</span>: Let me be clear, at least to my </span><span class="line" data-startTime="3234">understanding, there are two &mdash; there's a </span><span class="line" data-startTime="3234">branch here, so there's the techniques like </span><span class="line" data-startTime="3238">request animation frame, and keeping within </span><span class="line" data-startTime="3238">a budget. That applies to IE as well, especially </span><span class="line" data-startTime="3244">IE that have request animation frame which </span><span class="line" data-startTime="3244">is I believe nine plus. Might be ten, but </span><span class="line" data-startTime="3252">I'm sorry, you always want to keep that 6, </span><span class="line" data-startTime="3252">that is not a fact of a browser, that's a </span><span class="line" data-startTime="3255">fact of these stupid display thingies that </span><span class="line" data-startTime="3255">we love. The place where there is browser-to-browser </span><span class="line" data-startTime="3263">divergence is which CSS effects get you in </span><span class="line" data-startTime="3263">trouble or which DOM manipulations? Or to </span><span class="line" data-startTime="3268">a certain extent GLL, but that is usually </span><span class="line" data-startTime="3268">just because of GPUs. </span></p>

<p class="speaker"><span class="line" data-starttime="3273"><span class="speakerName">Audience member</span>: I missed it. Is that going to go into </span><span class="line" data-startTime="3273">IE at some point? </span></p>

<p class="speaker"><span class="line" data-starttime="3276"><span class="speakerName">Tom Tom Wiltzius</span>: Ask them. </span></p>

<p class="speaker"><span class="line" data-starttime="3276"><span class="speakerName">Nat Duca</span>: That's way above my pay grade. </span></p>

<p class="speaker"><span class="line" data-starttime="3277"><span class="speakerName">Audience member</span>: I mean, if we're optimizing we have to </span><span class="line" data-startTime="3277">sort of look at what we're targeting, right? </span></p>

<p class="speaker"><span class="line" data-starttime="3283"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah, totally, I &mdash; I mean, </span><span class="line" data-startTime="3283">it is my sincere hope that IE adopts Web GL, </span><span class="line" data-startTime="3290">they're the only browser who hasn't so far, </span><span class="line" data-startTime="3290">and I say this as the like the Chrome graphics </span><span class="line" data-startTime="3295">PM. Obviously that's what I want. </span></p>

<p class="speaker"><span class="line" data-starttime="3295"><span class="speakerName">Audience member</span>: Well, same here but &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="3296"><span class="speakerName">Tom Tom Wiltzius</span>: It is unclear what they're </span><span class="line" data-startTime="3296">going to do in like the 3D on the Web space. </span><span class="line" data-startTime="3300">I think they will do something pretty soon </span><span class="line" data-startTime="3300">is my suspicion, but what it is, they're pretty </span><span class="line" data-startTime="3305">quiet. I don't know. </span></p>

<p class="speaker"><span class="line" data-starttime="3305"><span class="speakerName">Audience member</span>: Good stuff, guys. </span></p>

<p class="speaker"><span class="line" data-starttime="3308"><span class="speakerName">Nat Duca</span>: Yeah, feel free to reach out. </span></p>

<p class="speaker"><span class="line" data-starttime="3308"><span class="speakerName">Tom Tom Wiltzius</span>: We're happy to talk more about </span><span class="line" data-startTime="3313">that kind of thing afterwards. Any other questions? </span><span class="line" data-startTime="3313">Otherwise we'll wrap up. </span></p>

<p class="speaker"><span class="line" data-starttime="3314"><span class="speakerName">Nat Duca</span>: Thank you, and we'll be out in </span><span class="line" data-startTime="3314">the &mdash; in the area where Chrome is if you </span><span class="line" data-startTime="3318">want to bring us over a slow website. </span></p></div>