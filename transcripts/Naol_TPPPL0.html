<style>* {font-family: "Open Sans", sans-serif}
a {color: #77aaff}
a.video {border-bottom: 1px solid #ddd; display: block; margin: 0 0 2em 0; padding: 0 0 2em 0}
h2 {color: #444; font-size: 18px;}
span.speakerName {color: black; font-weight: 900;}
body {padding: 2em}
p {color: #444; margin: 0; text-indent: 1.5em;}
p.speaker {margin: 1em 0 0 0; text-indent: 0;}
div#transcript > p:first-child {text-indent: 0;}
</style>

<h1>Google I/O 2009 &mdash; Exploring Chrome Internals</h1>

<h2>Darin Fisher</h2>

<a class="video" href="http://youtu.be/Naol_TPPPL0">youtu.be/Naol_TPPPL0</a><div id="transcript"><p class="speaker"><span class="line" data-starttime="1"><span class="speakerName">Darin Fisher</span>: Gonna talk to you </span><span class="line" data-startTime="1">about Chrome internals. </span> <span class="line" data-startTime="3">So I'm Darin Fisher. </span> <span class="line" data-startTime="5">I'm a member </span><span class="line" data-startTime="5">of the Chrome team. </span> <span class="line" data-startTime="6">I've actually been with </span><span class="line" data-startTime="6">the project since inception, </span><span class="line" data-startTime="8">back in 2006. </span> <span class="line" data-startTime="10">And today is just </span><span class="line" data-startTime="10">an opportunity to go through </span><span class="line" data-startTime="12">all of the stuff that's </span><span class="line" data-startTime="12">underneath the hood. </span> <span class="line" data-startTime="16">And so there'll be things </span><span class="line" data-startTime="16">that you may </span><span class="line" data-startTime="18">have heard about before </span><span class="line" data-startTime="18">if you've read the comic. </span> <span class="line" data-startTime="20">But, you know, </span><span class="line" data-startTime="20">I just wanted to cover </span><span class="line" data-startTime="22">as much ground as I could </span><span class="line" data-startTime="23">and discuss </span><span class="line" data-startTime="23">all the different things </span><span class="line" data-startTime="25">that go into </span><span class="line" data-startTime="25">Chrome's architecture. </span> <span class="line" data-startTime="29">So this was our guiding </span><span class="line" data-startTime="29">principle from day one. </span> <span class="line" data-startTime="32">We really wanted </span><span class="line" data-startTime="32">to make sure </span><span class="line" data-startTime="33">that we were stressing a very </span><span class="line" data-startTime="33">simple interface to Chrome. </span> <span class="line" data-startTime="36">And, you know, </span><span class="line" data-startTime="36">that would allow people </span><span class="line" data-startTime="40">to very easily and naturally </span><span class="line" data-startTime="41">get to a very fast browser, </span><span class="line" data-startTime="41">a very powerful browser, </span><span class="line" data-startTime="44">leveraging this, you know, </span><span class="line" data-startTime="44">powerful architecture, </span><span class="line" data-startTime="46">but they don't see </span><span class="line" data-startTime="46">or be burdened </span><span class="line" data-startTime="48">by the architecture. </span></p>

<p><span class="line" data-startTime="50">This sort of reminded us </span><span class="line" data-startTime="53">of the way Google.com's </span><span class="line" data-startTime="53">search experience was, </span><span class="line" data-startTime="56">and so here's just </span><span class="line" data-startTime="56">a little image of Chrome, </span><span class="line" data-startTime="59">very simple Chrome </span><span class="line" data-startTime="59">that you've all seen </span><span class="line" data-startTime="60">in a little photo of &mdash; </span><span class="line" data-startTime="62">taken off of </span><span class="line" data-startTime="62">one of the design docs of &mdash; </span><span class="line" data-startTime="63">for Chrome's architecture. </span> <span class="line" data-startTime="67">Just a little aside, </span><span class="line" data-startTime="69">this is actually rendered </span><span class="line" data-startTime="69">using HTML. </span> <span class="line" data-startTime="72">Actually thought I would </span><span class="line" data-startTime="72">just quickly show this, </span><span class="line" data-startTime="74">because it's interesting. </span> <span class="line" data-startTime="76">It's using </span><span class="line" data-startTime="76">a WebKit gradient effect </span><span class="line" data-startTime="78">on a straight-off image. </span></p>

<p><span class="line" data-startTime="80">So it's kind of neat </span><span class="line" data-startTime="83">that you can do all this </span><span class="line" data-startTime="83">kinds of stuff in WebKit, </span><span class="line" data-startTime="86">which Chrome is based on. </span> <span class="line" data-startTime="90">Okay, so here's </span><span class="line" data-startTime="90">a little quote </span><span class="line" data-startTime="92">that I'm not really sure </span><span class="line" data-startTime="92">who to attribute it to, </span><span class="line" data-startTime="94">but back in 2006 </span><span class="line" data-startTime="94">it was something </span><span class="line" data-startTime="97">that we were all thinking </span><span class="line" data-startTime="97">about it at the time. </span> <span class="line" data-startTime="98">"Modern browsers </span><span class="line" data-startTime="98">really resemble </span><span class="line" data-startTime="100">co-operatively multi-tasked </span><span class="line" data-startTime="100">operating systems of the past." </span><span class="line" data-startTime="103">So what do I mean? </span><span class="line" data-startTime="104">You can think back to </span><span class="line" data-startTime="104">older versions of Windows, </span><span class="line" data-startTime="107">older versions of Mac OS, </span><span class="line" data-startTime="107">where if any process, </span><span class="line" data-startTime="111">any application </span><span class="line" data-startTime="111">on your system </span><span class="line" data-startTime="113">decided to go into </span><span class="line" data-startTime="113">an infinite loop or crashed, </span><span class="line" data-startTime="116">it could bring down your </span><span class="line" data-startTime="116">whole entire operating system, </span><span class="line" data-startTime="118">and you'd lose </span><span class="line" data-startTime="118">all your applications. </span></p>

<p><span class="line" data-startTime="120">And this was what the state </span><span class="line" data-startTime="120">of browsers were back then. </span> <span class="line" data-startTime="124">And it seemed </span><span class="line" data-startTime="124">very unfortunate, </span><span class="line" data-startTime="126">especially as web applications </span><span class="line" data-startTime="126">were getting larger </span><span class="line" data-startTime="128">and more complicated. </span> <span class="line" data-startTime="129">I mean, oftentimes </span><span class="line" data-startTime="129">you'd have the experience </span><span class="line" data-startTime="131">of going &mdash; composing an e-mail </span><span class="line" data-startTime="131">and suddenly deciding, </span><span class="line" data-startTime="135">you know, I want </span><span class="line" data-startTime="135">to go do a search, </span><span class="line" data-startTime="136">I want to go do something else, </span><span class="line" data-startTime="138">and branching off </span><span class="line" data-startTime="138">to go get some information </span><span class="line" data-startTime="140">and venturing to a website </span><span class="line" data-startTime="140">that maybe somehow </span><span class="line" data-startTime="142">unfortunately triggers </span><span class="line" data-startTime="142">a browser bug, </span><span class="line" data-startTime="144">and then you completely lose </span><span class="line" data-startTime="144">what you were working on </span><span class="line" data-startTime="147">in that other tab. </span> <span class="line" data-startTime="148">This just seemed like a very </span><span class="line" data-startTime="148">unfortunate situation to us, </span><span class="line" data-startTime="150">and we were just thinking, </span><span class="line" data-startTime="150">you know, </span><span class="line" data-startTime="152">modern operating systems </span><span class="line" data-startTime="152">solved this </span><span class="line" data-startTime="153">by separation of applications </span><span class="line" data-startTime="153">into different processes. </span></p>

<p><span class="line" data-startTime="156">So couldn't we exploit that? </span><span class="line" data-startTime="160">And the goals of &mdash; </span><span class="line" data-startTime="162">Speaking more about goals </span><span class="line" data-startTime="162">for Chrome back in the day, </span><span class="line" data-startTime="164">beyond just a simple interface, </span><span class="line" data-startTime="164">we really wanted to see </span><span class="line" data-startTime="167">what we could do </span><span class="line" data-startTime="167">to really move the bar </span><span class="line" data-startTime="169">in terms of speed, </span><span class="line" data-startTime="169">stability, and security. </span> <span class="line" data-startTime="171">We felt like, as applications </span><span class="line" data-startTime="171">were getting more complicated, </span><span class="line" data-startTime="174">you know, </span><span class="line" data-startTime="174">speed was very important. </span> <span class="line" data-startTime="176">As applications </span><span class="line" data-startTime="176">were getting more complicated, </span><span class="line" data-startTime="177">it was more likely that you </span><span class="line" data-startTime="177">could have instability issues </span><span class="line" data-startTime="180">causing problems, </span><span class="line" data-startTime="181">and so how could we solve </span><span class="line" data-startTime="181">all these problems? </span><span class="line" data-startTime="183">Again, multi-process </span><span class="line" data-startTime="183">architecture. </span> <span class="line" data-startTime="185">If we could divide </span><span class="line" data-startTime="185">the application </span><span class="line" data-startTime="187">over multiple processes, </span><span class="line" data-startTime="187">you know, </span><span class="line" data-startTime="189">it'd be great </span><span class="line" data-startTime="189">if you could have web apps </span><span class="line" data-startTime="191">each having their own thread, </span><span class="line" data-startTime="191">and you get this </span><span class="line" data-startTime="192">if each web app </span><span class="line" data-startTime="192">has its own process. </span></p>

<p><span class="line" data-startTime="194">Separate address spaces. </span> <span class="line" data-startTime="195">If each web application </span><span class="line" data-startTime="195">has its own address space, </span><span class="line" data-startTime="198">its own process, </span><span class="line" data-startTime="198">then there's some insulation </span><span class="line" data-startTime="200">in case one of the applications </span><span class="line" data-startTime="200">happens to trigger a bug </span><span class="line" data-startTime="203">and cause a crash. </span> <span class="line" data-startTime="205">Similarly, if your applications </span><span class="line" data-startTime="205">are consuming a lot of memory </span><span class="line" data-startTime="208">and they're all sharing </span><span class="line" data-startTime="208">one giant heap together, </span><span class="line" data-startTime="211">you can have </span><span class="line" data-startTime="211">performance problems. </span> <span class="line" data-startTime="213">But with separate app processes </span><span class="line" data-startTime="213">and separate address spaces, </span><span class="line" data-startTime="215">each one having </span><span class="line" data-startTime="215">its own memory pools, </span><span class="line" data-startTime="217">you have a lot </span><span class="line" data-startTime="217">of smaller memory pools, </span><span class="line" data-startTime="218">and better performance ensues. </span> <span class="line" data-startTime="220">Security. </span></p>

<p><span class="line" data-startTime="222">So given that we were </span><span class="line" data-startTime="222">actually leveraging </span><span class="line" data-startTime="224">operating system processes, </span><span class="line" data-startTime="226">and operating systems </span><span class="line" data-startTime="226">already have the idea </span><span class="line" data-startTime="228">that a process might have </span><span class="line" data-startTime="228">certain capabilities </span><span class="line" data-startTime="232">based on the use </span><span class="line" data-startTime="232">associated with that process. </span> <span class="line" data-startTime="235">Seems like we could leverage </span><span class="line" data-startTime="235">the operating system's support </span><span class="line" data-startTime="239">for taking away privileges </span><span class="line" data-startTime="239">from a process </span><span class="line" data-startTime="242">or limiting the privileges </span><span class="line" data-startTime="242">of a process, </span><span class="line" data-startTime="244">and thereby achieve a sandbox </span><span class="line" data-startTime="244">to run web applications. </span> <span class="line" data-startTime="247">And this would be great </span><span class="line" data-startTime="247">because, well, </span><span class="line" data-startTime="250">we know that software </span><span class="line" data-startTime="250">is just enormously complicated. </span></p>

<p><span class="line" data-startTime="253">And if there's </span><span class="line" data-startTime="253">any kind of bug, </span><span class="line" data-startTime="255">and that bug </span><span class="line" data-startTime="255">allows an attacker </span><span class="line" data-startTime="257">to get code running with </span><span class="line" data-startTime="257">the privileges of the user, </span><span class="line" data-startTime="261">then they can do things </span><span class="line" data-startTime="262">that would potentially </span><span class="line" data-startTime="262">harm the user, </span><span class="line" data-startTime="264">'cause they have </span><span class="line" data-startTime="264">the power of the user. </span> <span class="line" data-startTime="265">And so we really </span><span class="line" data-startTime="265">liked the idea </span><span class="line" data-startTime="267">of there being </span><span class="line" data-startTime="267">this belt and suspenders, </span><span class="line" data-startTime="269">this secondary level </span><span class="line" data-startTime="269">of protection, the sandbox. </span> <span class="line" data-startTime="272">And we get all this, </span><span class="line" data-startTime="272">it's all possible </span><span class="line" data-startTime="274">because we can divide </span><span class="line" data-startTime="274">the application, the browser </span><span class="line" data-startTime="276">into multiple processes. </span> <span class="line" data-startTime="278">Okay, but I mentioned before </span><span class="line" data-startTime="278">speed. </span> <span class="line" data-startTime="280">Speed is very important. </span> <span class="line" data-startTime="282">And so in the early days </span><span class="line" data-startTime="282">we were thinking </span><span class="line" data-startTime="284">it's one thing </span><span class="line" data-startTime="284">to divide the browser </span><span class="line" data-startTime="286">into multiple processes, </span><span class="line" data-startTime="288">and that allows </span><span class="line" data-startTime="288">the applications </span><span class="line" data-startTime="289">to not stomp on one another </span><span class="line" data-startTime="291">and to achieve </span><span class="line" data-startTime="291">good performance there, </span><span class="line" data-startTime="292">good scaling </span><span class="line" data-startTime="292">across multiple cores. </span> <span class="line" data-startTime="294">But we just want </span><span class="line" data-startTime="294">the rendering engine </span><span class="line" data-startTime="296">to be very fast as well. </span></p>

<p><span class="line" data-startTime="297">So that informed our choice </span><span class="line" data-startTime="297">of rendering engine, </span><span class="line" data-startTime="300">and we went with WebKit </span><span class="line" data-startTime="300">because it was, well &mdash; </span><span class="line" data-startTime="303">We really wanted to &mdash; </span><span class="line" data-startTime="304">We knew that Chrome </span><span class="line" data-startTime="304">was going to be open source, </span><span class="line" data-startTime="306">and we chose upon &mdash; </span><span class="line" data-startTime="308">took a look at all </span><span class="line" data-startTime="308">the open source options </span><span class="line" data-startTime="310">and WebKit was just </span><span class="line" data-startTime="310">really fast, </span><span class="line" data-startTime="312">and it has </span><span class="line" data-startTime="312">a very small footprint. </span> <span class="line" data-startTime="314">Back in '06, </span><span class="line" data-startTime="314">you could see that WebKit </span><span class="line" data-startTime="316">was starting to become </span><span class="line" data-startTime="316">the popular choice </span><span class="line" data-startTime="318">amongst mobile browsers. </span></p>

<p><span class="line" data-startTime="319">And this all had to do </span><span class="line" data-startTime="319">with, you know, </span><span class="line" data-startTime="321">just how good WebKit is. </span> <span class="line" data-startTime="322">But there was one thing </span><span class="line" data-startTime="322">that we saw </span><span class="line" data-startTime="323">as a big opportunity, </span><span class="line" data-startTime="325">and that was </span><span class="line" data-startTime="325">JavaScript performance. </span> <span class="line" data-startTime="326">Back in '06, the JavaScript </span><span class="line" data-startTime="326">engine in WebKit </span><span class="line" data-startTime="329">was a very straightforward, </span><span class="line" data-startTime="329">simple interpreted </span><span class="line" data-startTime="332">JavaScript engine. </span> <span class="line" data-startTime="333">And we had a team at Google </span><span class="line" data-startTime="333">who recognized </span><span class="line" data-startTime="337">that there was </span><span class="line" data-startTime="337">this great opportunity </span><span class="line" data-startTime="338">to apply some of </span><span class="line" data-startTime="338">the more modern approaches </span><span class="line" data-startTime="340">to BM technology, BMs, </span><span class="line" data-startTime="340">to build a JavaScript engine </span><span class="line" data-startTime="344">that was GIT-based </span><span class="line" data-startTime="345">and leveraged a lot </span><span class="line" data-startTime="345">of other techniques </span><span class="line" data-startTime="348">to make </span><span class="line" data-startTime="348">dynamic programs like &mdash; </span><span class="line" data-startTime="350">Dynamic programming languages, </span><span class="line" data-startTime="350">like JavaScript, </span><span class="line" data-startTime="352">run so much faster. </span> <span class="line" data-startTime="354">And the V8 team was very </span><span class="line" data-startTime="354">successful, in my opinion. </span></p>

<p><span class="line" data-startTime="357">I mean, compared to where </span><span class="line" data-startTime="357">we were in '06, </span><span class="line" data-startTime="358">they've come </span><span class="line" data-startTime="358">order of magnitude, </span><span class="line" data-startTime="360">or one or two </span><span class="line" data-startTime="360">orders of magnitude </span><span class="line" data-startTime="362">depending on what kinds of tests </span><span class="line" data-startTime="362">you're talking about. </span> <span class="line" data-startTime="365">And that's just outstanding. </span> <span class="line" data-startTime="368">Don't you just love </span><span class="line" data-startTime="368">silent auto-update? </span><span class="line" data-startTime="372">I do. </span> <span class="line" data-startTime="375">Okay, so under the hood. </span> <span class="line" data-startTime="379">The major components </span><span class="line" data-startTime="379">of Chrome. </span> <span class="line" data-startTime="381">So this is sort of &mdash; </span><span class="line" data-startTime="385">gives you a big picture </span><span class="line" data-startTime="385">of some of the major modules. </span> <span class="line" data-startTime="388">And Chromium </span><span class="line" data-startTime="388">is the source base </span><span class="line" data-startTime="390">from which Chrome is derived, </span><span class="line" data-startTime="392">Chrome being the application. </span></p>

<p><span class="line" data-startTime="393">And Chromium depends </span><span class="line" data-startTime="393">on WebKit. </span> <span class="line" data-startTime="396">I've mentioned </span><span class="line" data-startTime="396">WebKit already and V8. </span> <span class="line" data-startTime="398">And Skia, </span><span class="line" data-startTime="398">Skia's our graphics engine. </span> <span class="line" data-startTime="400">This actually comes </span><span class="line" data-startTime="400">from the android project. </span> <span class="line" data-startTime="402">It's a 2-D graphics engine </span><span class="line" data-startTime="403">that's highly optimized </span><span class="line" data-startTime="403">for mobile environments. </span> <span class="line" data-startTime="405">And so it really runs well </span><span class="line" data-startTime="405">on a desktop system. </span> <span class="line" data-startTime="409">And so </span><span class="line" data-startTime="409">in the Chromium world, </span><span class="line" data-startTime="412">how these </span><span class="line" data-startTime="412">are all glued together, </span><span class="line" data-startTime="414">Chromium embeds WebKit. </span> <span class="line" data-startTime="415">WebKit renders to Skia. </span> <span class="line" data-startTime="417">Chromium also renders </span><span class="line" data-startTime="417">its own UI to Skia. </span></p>

<p><span class="line" data-startTime="420">And WebKit talks to V8 </span><span class="line" data-startTime="420">to run JavaScript. </span> <span class="line" data-startTime="423">But Chromium also talks </span><span class="line" data-startTime="423">directly to V8 </span><span class="line" data-startTime="425">for things </span><span class="line" data-startTime="425">like proxy auto-config </span><span class="line" data-startTime="427">and other usages </span><span class="line" data-startTime="427">of JavaScript in a browser </span><span class="line" data-startTime="429">besides just that </span><span class="line" data-startTime="429">related to web content. </span> <span class="line" data-startTime="432">So Chromium itself, </span><span class="line" data-startTime="432">the code base, </span><span class="line" data-startTime="434">includes all the other stuff </span><span class="line" data-startTime="434">that's not WebKit </span><span class="line" data-startTime="436">that's not V8, not Skia, </span><span class="line" data-startTime="438">and other libraries </span><span class="line" data-startTime="438">that we incorporate. </span> <span class="line" data-startTime="440">But it includes </span><span class="line" data-startTime="440">things like the UI, </span><span class="line" data-startTime="443">the tab strip, </span><span class="line" data-startTime="443">and the Omnibox &mdash; </span><span class="line" data-startTime="444">these are all </span><span class="line" data-startTime="444">native UI elements. </span> <span class="line" data-startTime="446">We chose to go </span><span class="line" data-startTime="446">with a native UI for Chrome </span><span class="line" data-startTime="449">because we really wanted </span><span class="line" data-startTime="449">to make sure </span><span class="line" data-startTime="451">that we could get all of </span><span class="line" data-startTime="451">the look and feel just right. </span> <span class="line" data-startTime="455">We wanted to have a very </span><span class="line" data-startTime="455">lightweight, fast browser. </span></p>

<p><span class="line" data-startTime="457">We wanted to have a browser </span><span class="line" data-startTime="457">that was highly tuned </span><span class="line" data-startTime="460">for Windows </span><span class="line" data-startTime="460">and then again for Mac </span><span class="line" data-startTime="462">and then again for Linux. </span> <span class="line" data-startTime="464">And so for Windows, </span><span class="line" data-startTime="464">we went about &mdash; </span><span class="line" data-startTime="467">we went about building </span><span class="line" data-startTime="467">this native tab strip, </span><span class="line" data-startTime="469">this native Omnibox. </span> <span class="line" data-startTime="470">And, however, not all </span><span class="line" data-startTime="470">of our UI is native. </span> <span class="line" data-startTime="474">The new tab page, </span><span class="line" data-startTime="474">the downloads page, </span><span class="line" data-startTime="476">the history panel, </span><span class="line" data-startTime="478">these appear </span><span class="line" data-startTime="478">in the tab contents area. </span> <span class="line" data-startTime="480">And so they are naturally </span><span class="line" data-startTime="480">HTML-based </span><span class="line" data-startTime="484">so that you get </span><span class="line" data-startTime="484">the same look and feel </span><span class="line" data-startTime="486">that you would </span><span class="line" data-startTime="486">for a web app. </span></p>

<p><span class="line" data-startTime="487">And this turned out </span><span class="line" data-startTime="487">to work very well for us. </span> <span class="line" data-startTime="490">So basically, </span><span class="line" data-startTime="490">the amount of native code </span><span class="line" data-startTime="492">is minimized to just that </span><span class="line" data-startTime="494">of the frame </span><span class="line" data-startTime="494">or the window manager. </span> <span class="line" data-startTime="497">So that's pretty much </span><span class="line" data-startTime="497">all I'm gonna talk about </span><span class="line" data-startTime="499">as far as UI is concerned. </span> <span class="line" data-startTime="501">The other main components </span><span class="line" data-startTime="501">in Chromium though </span><span class="line" data-startTime="503">are multi-process </span><span class="line" data-startTime="503">architecture. </span> <span class="line" data-startTime="504">That's sort of the thing that &mdash; </span><span class="line" data-startTime="504">the goop that binds </span><span class="line" data-startTime="507">this whole collection </span><span class="line" data-startTime="507">of processes together. </span> <span class="line" data-startTime="511">And they history system </span><span class="line" data-startTime="511">is fairly complicated, </span><span class="line" data-startTime="513">based around Sequel Light, </span><span class="line" data-startTime="515">and there's </span><span class="line" data-startTime="515">a full text index there. </span> <span class="line" data-startTime="517">The network stack </span><span class="line" data-startTime="517">runs in the main process. </span> <span class="line" data-startTime="519">I'll actually talk more </span><span class="line" data-startTime="519">about processes in detail later. </span></p>

<p><span class="line" data-startTime="522">And then there's a sandbox </span><span class="line" data-startTime="522">piece of module </span><span class="line" data-startTime="525">within </span><span class="line" data-startTime="525">the Chromium source base. </span> <span class="line" data-startTime="528">So moving on. </span> <span class="line" data-startTime="529">Multi-process architecture. </span> <span class="line" data-startTime="532">Just getting into this </span><span class="line" data-startTime="532">a little bit more. </span> <span class="line" data-startTime="533">So I've been talking </span><span class="line" data-startTime="533">about processes. </span> <span class="line" data-startTime="535">So this is what I mean. </span> <span class="line" data-startTime="536">This picture here shows </span><span class="line" data-startTime="538">that this main coordinating </span><span class="line" data-startTime="538">browser process </span><span class="line" data-startTime="540">that all of the child processes </span><span class="line" data-startTime="540">talk to. </span> <span class="line" data-startTime="543">And we have a sequence &mdash; </span><span class="line" data-startTime="543">a set of different renderers. </span> <span class="line" data-startTime="546">Each of the rendering processes </span><span class="line" data-startTime="548">are the processes </span><span class="line" data-startTime="548">that embed WebKit </span><span class="line" data-startTime="549">to render web pages, </span><span class="line" data-startTime="551">and they talk back </span><span class="line" data-startTime="551">to the browser </span><span class="line" data-startTime="552">for things like IO. </span> <span class="line" data-startTime="554">So because of the sandbox, </span><span class="line" data-startTime="555">the renderers </span><span class="line" data-startTime="555">actually don't have access </span><span class="line" data-startTime="557">to direct &mdash; direct access </span><span class="line" data-startTime="557">to the system, </span><span class="line" data-startTime="559">and they must proxy through </span><span class="line" data-startTime="559">the browser for everything. </span></p>

<p><span class="line" data-startTime="561">So this is sort of </span><span class="line" data-startTime="561">a hub and spoke design. </span> <span class="line" data-startTime="563">I've shown some other </span><span class="line" data-startTime="563">processes here &mdash; </span><span class="line" data-startTime="565">worker processes, </span><span class="line" data-startTime="565">plug-in processes. </span> <span class="line" data-startTime="567">So worker processes are </span><span class="line" data-startTime="567">the new web workers coming of &mdash; </span><span class="line" data-startTime="571">that you start to see </span><span class="line" data-startTime="571">various browsers implementing. </span> <span class="line" data-startTime="574">These allow for a web page </span><span class="line" data-startTime="574">to have a background thread </span><span class="line" data-startTime="578">or a background set of threads </span><span class="line" data-startTime="578">that do work. </span> <span class="line" data-startTime="580">And there's </span><span class="line" data-startTime="580">a very asynchronous way </span><span class="line" data-startTime="583">of communicating to those </span><span class="line" data-startTime="583">background threads, </span><span class="line" data-startTime="585">which lends itself </span><span class="line" data-startTime="585">very naturally </span><span class="line" data-startTime="587">to having those workers </span><span class="line" data-startTime="587">be out of process. </span> <span class="line" data-startTime="591">And there can be </span><span class="line" data-startTime="591">many of them. </span> <span class="line" data-startTime="593">Plug-ins &mdash; Plug-ins actually </span><span class="line" data-startTime="593">run outside the sandbox </span><span class="line" data-startTime="595">in their own process. </span> <span class="line" data-startTime="597">So when I say plug-ins here, </span><span class="line" data-startTime="597">I don't mean, like, </span><span class="line" data-startTime="599">Firefox extensions </span><span class="line" data-startTime="599">or things like that. </span></p>

<p><span class="line" data-startTime="601">I mean the traditional </span><span class="line" data-startTime="601">browser plug-ins </span><span class="line" data-startTime="602">like Flash, Java, </span><span class="line" data-startTime="602">Silverlight, and so on </span><span class="line" data-startTime="605">that use things like NPAPI </span><span class="line" data-startTime="605">or ActiveX. </span> <span class="line" data-startTime="607">And so for these &mdash; </span><span class="line" data-startTime="607">for each of these plug-ins, </span><span class="line" data-startTime="610">we load them </span><span class="line" data-startTime="610">in their own process, </span><span class="line" data-startTime="612">so there's a Flash process </span><span class="line" data-startTime="612">and a Java process and so on. </span> <span class="line" data-startTime="617">Now I've made </span><span class="line" data-startTime="617">some mention here </span><span class="line" data-startTime="619">of trust, untrusted, </span><span class="line" data-startTime="619">and so on. </span> <span class="line" data-startTime="620">So it's important to note </span><span class="line" data-startTime="623">that we really would like </span><span class="line" data-startTime="623">to have sandboxed plug-ins. </span> <span class="line" data-startTime="627">We would liked to have </span><span class="line" data-startTime="627">included them in the sandbox, </span><span class="line" data-startTime="628">but because they are </span><span class="line" data-startTime="628">basically already software </span><span class="line" data-startTime="632">that's on the system, </span><span class="line" data-startTime="632">they have dependencies </span><span class="line" data-startTime="635">on being able to actually </span><span class="line" data-startTime="635">access the system directly. </span></p>

<p><span class="line" data-startTime="637">They just can't be </span><span class="line" data-startTime="637">included in the sandbox. </span> <span class="line" data-startTime="640">A good example is Flash. </span> <span class="line" data-startTime="641">It actually needs to be able </span><span class="line" data-startTime="641">to auto-update itself. </span> <span class="line" data-startTime="644">Well, if we denied its ability </span><span class="line" data-startTime="644">to access your system, </span><span class="line" data-startTime="646">it wouldn't be able </span><span class="line" data-startTime="646">to update itself. </span> <span class="line" data-startTime="649">So it has to run </span><span class="line" data-startTime="649">outside of the sandbox. </span> <span class="line" data-startTime="652">But it still runs </span><span class="line" data-startTime="652">in its own process </span><span class="line" data-startTime="653">so that we get some insulation </span><span class="line" data-startTime="653">from, you know, </span><span class="line" data-startTime="656">page faults and so on. </span> <span class="line" data-startTime="661">So inter-process </span><span class="line" data-startTime="661">communication, </span><span class="line" data-startTime="663">just a few words </span><span class="line" data-startTime="663">about that. </span> <span class="line" data-startTime="666">We decided early on </span><span class="line" data-startTime="666">that we really &mdash; </span><span class="line" data-startTime="668">You know, there were </span><span class="line" data-startTime="668">many applications </span><span class="line" data-startTime="670">that you could point to that </span><span class="line" data-startTime="670">were multi-process already, </span><span class="line" data-startTime="674">on your Windows desktop </span><span class="line" data-startTime="674">or wherever. </span></p>

<p><span class="line" data-startTime="676">And a lot of times, </span><span class="line" data-startTime="676">performance can &mdash; </span><span class="line" data-startTime="679">It's very easy to build </span><span class="line" data-startTime="679">a multi-process application </span><span class="line" data-startTime="681">that doesn't perform well. </span> <span class="line" data-startTime="683">And one of the key things </span><span class="line" data-startTime="683">we really went for </span><span class="line" data-startTime="684">was this so-called </span><span class="line" data-startTime="684">a permanent model, </span><span class="line" data-startTime="686">where we want to make sure </span><span class="line" data-startTime="686">that individual processes </span><span class="line" data-startTime="688">or really individual threads </span><span class="line" data-startTime="690">really can run </span><span class="line" data-startTime="690">as independently as possible </span><span class="line" data-startTime="691">and rely on more of </span><span class="line" data-startTime="691">an asynchronous communication, </span><span class="line" data-startTime="695">locking between </span><span class="line" data-startTime="695">the processes, </span><span class="line" data-startTime="696">locking between the threads </span><span class="line" data-startTime="696">as minimally as possible. </span> <span class="line" data-startTime="700">So we went for an asynchronous </span><span class="line" data-startTime="700">communication system. </span> <span class="line" data-startTime="702">Early on, we tried using </span><span class="line" data-startTime="702">existing systems on Windows, </span><span class="line" data-startTime="706">like Windows messages that &mdash; </span><span class="line" data-startTime="708">You can so asynchronous </span><span class="line" data-startTime="708">Windows messages. </span></p>

<p><span class="line" data-startTime="710">We looked at using comm. </span> <span class="line" data-startTime="712">All these systems </span><span class="line" data-startTime="712">were fairly complicated, </span><span class="line" data-startTime="714">and in order to achieve &mdash; </span><span class="line" data-startTime="716">In order to get the kind </span><span class="line" data-startTime="716">of control we wanted </span><span class="line" data-startTime="718">over the IPC, </span><span class="line" data-startTime="718">we went with named pipes. </span> <span class="line" data-startTime="720">Plus named pipes </span><span class="line" data-startTime="720">are much more portable. </span> <span class="line" data-startTime="722">And we knew we would </span><span class="line" data-startTime="722">eventually be bringing this </span><span class="line" data-startTime="725">to Mac and Linux, </span><span class="line" data-startTime="725">and so it made sense </span><span class="line" data-startTime="726">to go with named pipes. </span> <span class="line" data-startTime="728">We do have some support </span><span class="line" data-startTime="728">for limited blocking calls, </span><span class="line" data-startTime="730">because that's required </span><span class="line" data-startTime="730">for some of the &mdash; </span><span class="line" data-startTime="732">to support some of </span><span class="line" data-startTime="732">the web interfaces </span><span class="line" data-startTime="734">that we need to support. </span> <span class="line" data-startTime="736">And I can talk </span><span class="line" data-startTime="736">about that more later. </span></p>

<p><span class="line" data-startTime="738">There's some use </span><span class="line" data-startTime="738">of shared memory, </span><span class="line" data-startTime="740">but we basically </span><span class="line" data-startTime="740">don't use shared memory </span><span class="line" data-startTime="741">unless it really </span><span class="line" data-startTime="741">gives a big benefit, </span><span class="line" data-startTime="743">because it just adds </span><span class="line" data-startTime="743">complexity to the system. </span> <span class="line" data-startTime="746">So basically you can imagine, </span><span class="line" data-startTime="746">if you will, </span><span class="line" data-startTime="749">these different processes </span><span class="line" data-startTime="751">that are basically having </span><span class="line" data-startTime="751">a stream of events </span><span class="line" data-startTime="754">asynchronously flowing </span><span class="line" data-startTime="754">to one process or the other. </span> <span class="line" data-startTime="757">And it's sort of like </span><span class="line" data-startTime="757">a big interconnected network </span><span class="line" data-startTime="762">of data being passed around. </span></p>

<p><span class="line" data-startTime="765">And we're trying </span><span class="line" data-startTime="765">to keep this thing </span><span class="line" data-startTime="767">running as smoothly as possible </span><span class="line" data-startTime="767">and avoiding hiccups. </span> <span class="line" data-startTime="769">That's basically the goal </span><span class="line" data-startTime="771">of the inter-process </span><span class="line" data-startTime="771">communication. </span> <span class="line" data-startTime="774">This diagram here just shows </span><span class="line" data-startTime="775">that in order to keep things </span><span class="line" data-startTime="775">running smoothly, </span><span class="line" data-startTime="777">we dedicate a thread </span><span class="line" data-startTime="777">in each process </span><span class="line" data-startTime="779">to run and service the IPC. </span> <span class="line" data-startTime="781">That way, if the UI thread, </span><span class="line" data-startTime="781">T(UI), in the browser, </span><span class="line" data-startTime="785">were to go off </span><span class="line" data-startTime="785">and produce a whole bunch </span><span class="line" data-startTime="789">of IPCs that he wants </span><span class="line" data-startTime="789">to send to the renderer </span><span class="line" data-startTime="791">but then not yield control </span><span class="line" data-startTime="791">to the system </span><span class="line" data-startTime="794">that actually sends </span><span class="line" data-startTime="794">the IPCs, </span><span class="line" data-startTime="796">that could be bad. </span> <span class="line" data-startTime="797">So instead, </span><span class="line" data-startTime="797">there's a background thread </span><span class="line" data-startTime="799">who picks up that queue </span><span class="line" data-startTime="799">of outbound requests </span><span class="line" data-startTime="800">and sends them along. </span> <span class="line" data-startTime="802">Meanwhile, the browser's </span><span class="line" data-startTime="802">doing other things, </span><span class="line" data-startTime="803">possibly expensive things, </span><span class="line" data-startTime="803">but the IPC is flowing. </span></p>

<p><span class="line" data-startTime="806">And then the renderer, </span><span class="line" data-startTime="806">the same deal. </span> <span class="line" data-startTime="807">JavaScript application could be </span><span class="line" data-startTime="807">consuming T(WebKit), </span><span class="line" data-startTime="811">but we still have </span><span class="line" data-startTime="811">an IO thread </span><span class="line" data-startTime="813">that's pumping events </span><span class="line" data-startTime="813">and doing things </span><span class="line" data-startTime="815">and keeping things </span><span class="line" data-startTime="815">running smoothly. </span> <span class="line" data-startTime="816">That's just sort of </span><span class="line" data-startTime="816">a bird's-eye view </span><span class="line" data-startTime="819">of what the inter-process </span><span class="line" data-startTime="819">communication looks like. </span> <span class="line" data-startTime="822">Process assignments. </span> <span class="line" data-startTime="826">What do I mean by this? </span><span class="line" data-startTime="828">Given that Chrome </span><span class="line" data-startTime="828">has many rendering processes </span><span class="line" data-startTime="831">and we really would love, </span><span class="line" data-startTime="831">ideally, </span><span class="line" data-startTime="833">to be able to assign </span><span class="line" data-startTime="833">a single web application </span><span class="line" data-startTime="835">to a single process, </span><span class="line" data-startTime="835">thereby giving </span><span class="line" data-startTime="838">the best separation </span><span class="line" data-startTime="838">between web applications. </span> <span class="line" data-startTime="840">There's some realities </span><span class="line" data-startTime="840">to the web </span><span class="line" data-startTime="842">that force us to group </span><span class="line" data-startTime="842">some applications or some &mdash; </span><span class="line" data-startTime="847">What do I mean by applications? </span><span class="line" data-startTime="847">Web pages. </span></p>

<p><span class="line" data-startTime="848">Some web pages have to be </span><span class="line" data-startTime="848">grouped together in processes. </span> <span class="line" data-startTime="853">And then there's </span><span class="line" data-startTime="853">opportunities to decide </span><span class="line" data-startTime="855">when we should actually </span><span class="line" data-startTime="855">create a new process. </span> <span class="line" data-startTime="857">And coming up with </span><span class="line" data-startTime="857">a good formula here </span><span class="line" data-startTime="859">is a little tricky, </span><span class="line" data-startTime="860">'cause there's </span><span class="line" data-startTime="860">some realistic limitations. </span> <span class="line" data-startTime="862">Like we don't want to have </span><span class="line" data-startTime="862">too many processes. </span> <span class="line" data-startTime="864">At some point, </span><span class="line" data-startTime="864">you start to pay a cost </span><span class="line" data-startTime="866">by having many processes. </span> <span class="line" data-startTime="868">So we have a process limit. </span> <span class="line" data-startTime="869">If that limit's reached, </span><span class="line" data-startTime="869">we'll start reusing processes. </span> <span class="line" data-startTime="872">If there's a potential </span><span class="line" data-startTime="872">script connection </span><span class="line" data-startTime="874">between two web pages, </span><span class="line" data-startTime="875">well, they need to be </span><span class="line" data-startTime="875">in the same process. </span> <span class="line" data-startTime="877">We could have built </span><span class="line" data-startTime="877">the system </span><span class="line" data-startTime="879">so that there was </span><span class="line" data-startTime="879">a complex way of &mdash; </span><span class="line" data-startTime="884">a bridge or so </span><span class="line" data-startTime="884">between the script </span><span class="line" data-startTime="886">running in one page </span><span class="line" data-startTime="886">and the script in another page, </span><span class="line" data-startTime="888">but that seemed like it would </span><span class="line" data-startTime="888">be overly complicated </span><span class="line" data-startTime="889">and potentially lead to a lot </span><span class="line" data-startTime="889">of performance problems. </span></p>

<p><span class="line" data-startTime="892">So instead we thought, </span><span class="line" data-startTime="892">well, a web application &mdash; </span><span class="line" data-startTime="894">Well, if we think </span><span class="line" data-startTime="894">of a web application </span><span class="line" data-startTime="896">that might have many pages </span><span class="line" data-startTime="898">as probably sharing </span><span class="line" data-startTime="898">script connections, </span><span class="line" data-startTime="901">then it kind of makes sense </span><span class="line" data-startTime="901">for those many pages </span><span class="line" data-startTime="903">to all be grouped </span><span class="line" data-startTime="903">in the same process. </span> <span class="line" data-startTime="905">And so this idea of just </span><span class="line" data-startTime="905">looking at any page </span><span class="line" data-startTime="909">that's open from WebKit </span><span class="line" data-startTime="909">as potentially being a page </span><span class="line" data-startTime="913">that should be </span><span class="line" data-startTime="913">in the same process, </span><span class="line" data-startTime="916">that seemed to make sense. </span> <span class="line" data-startTime="917">And it works out pretty well </span><span class="line" data-startTime="917">for a lot of applications. </span></p>

<p><span class="line" data-startTime="920">You'd think, </span><span class="line" data-startTime="920">interestingly enough, </span><span class="line" data-startTime="922">Target blank &mdash; </span><span class="line" data-startTime="922">I put this up here </span><span class="line" data-startTime="924">'cause you'd think that when </span><span class="line" data-startTime="924">a user clicks on target blank, </span><span class="line" data-startTime="926">and that means </span><span class="line" data-startTime="926">open a new window, </span><span class="line" data-startTime="928">that there should be </span><span class="line" data-startTime="928">no script connection </span><span class="line" data-startTime="929">between that and the page </span><span class="line" data-startTime="929">that you opened </span><span class="line" data-startTime="932">that the link was clicked on. </span> <span class="line" data-startTime="934">Well, it turns out </span><span class="line" data-startTime="935">that there is </span><span class="line" data-startTime="935">a very real script connection. </span> <span class="line" data-startTime="937">When that new page </span><span class="line" data-startTime="937">is opened, </span><span class="line" data-startTime="939">it's actually got </span><span class="line" data-startTime="939">a dot opener property, </span><span class="line" data-startTime="942">and the dot opener property </span><span class="line" data-startTime="942">allows it to see the guy &mdash; </span><span class="line" data-startTime="944">the page from which </span><span class="line" data-startTime="944">he was opened. </span></p>

<p><span class="line" data-startTime="948">Now that's okay. </span> <span class="line" data-startTime="951">So okay, well, </span><span class="line" data-startTime="951">then in that case, </span><span class="line" data-startTime="953">if it's the same origin, </span><span class="line" data-startTime="953">you know, </span><span class="line" data-startTime="955">'cause JavaScript allows </span><span class="line" data-startTime="955">scripting </span><span class="line" data-startTime="957">provided origin A </span><span class="line" data-startTime="957">and origin B are the same, </span><span class="line" data-startTime="960">then they &mdash; </span><span class="line" data-startTime="960">they then, you know &mdash; </span><span class="line" data-startTime="962">Okay, we would only group them </span><span class="line" data-startTime="962">in the same process if &mdash; </span><span class="line" data-startTime="966">if the new page </span><span class="line" data-startTime="966">is of the same origin. </span> <span class="line" data-startTime="970">And that's actually </span><span class="line" data-startTime="970">not good enough, </span><span class="line" data-startTime="971">because it might be that </span><span class="line" data-startTime="971">you are clicking a link from &mdash; </span><span class="line" data-startTime="974">opening a new window </span><span class="line" data-startTime="974">from origin A to origin B, </span><span class="line" data-startTime="977">but origin B </span><span class="line" data-startTime="977">might have a sub frame </span><span class="line" data-startTime="980">that's also on origin A. </span></p>

<p><span class="line" data-startTime="981">And origin &mdash; </span><span class="line" data-startTime="981">the page over here </span><span class="line" data-startTime="983">can actually find </span><span class="line" data-startTime="983">that frame by name. </span> <span class="line" data-startTime="986">And so sort of after the fact, </span><span class="line" data-startTime="986">after a window's created, </span><span class="line" data-startTime="989">there might be </span><span class="line" data-startTime="989">a script connection </span><span class="line" data-startTime="990">that become established. </span> <span class="line" data-startTime="992">So we need to keep those </span><span class="line" data-startTime="992">in the same process. </span> <span class="line" data-startTime="994">Okay, but then there's </span><span class="line" data-startTime="994">some heuristics </span><span class="line" data-startTime="996">to try to get out of </span><span class="line" data-startTime="996">these sort of situations. </span> <span class="line" data-startTime="1000">Turns out that a lot </span><span class="line" data-startTime="1000">of web applications </span><span class="line" data-startTime="1002">use window.open </span><span class="line" data-startTime="1002">to navigate </span><span class="line" data-startTime="1006">from the application </span><span class="line" data-startTime="1006">to a new page. </span> <span class="line" data-startTime="1010">For example, Gmail, </span><span class="line" data-startTime="1010">when you click a link, </span><span class="line" data-startTime="1012">it wants to take you </span><span class="line" data-startTime="1012">to a new page for that link. </span></p>

<p><span class="line" data-startTime="1016">And the thing though </span><span class="line" data-startTime="1016">is that Gmail </span><span class="line" data-startTime="1018">really has no interest in there </span><span class="line" data-startTime="1018">being a script connection </span><span class="line" data-startTime="1021">between Gmail </span><span class="line" data-startTime="1021">and that new page. </span> <span class="line" data-startTime="1024">It even goes so far </span><span class="line" data-startTime="1024">to set the opener property </span><span class="line" data-startTime="1028">of that new page </span><span class="line" data-startTime="1028">to null </span><span class="line" data-startTime="1030">before navigating </span><span class="line" data-startTime="1030">that new page </span><span class="line" data-startTime="1032">to the URL </span><span class="line" data-startTime="1032">that you clicked on. </span> <span class="line" data-startTime="1034">Those kinds </span><span class="line" data-startTime="1034">of tricks are done </span><span class="line" data-startTime="1035">to sort of sever </span><span class="line" data-startTime="1035">the script connection, </span><span class="line" data-startTime="1037">at least as far as </span><span class="line" data-startTime="1037">that rendering process </span><span class="line" data-startTime="1040">would be concerned. </span> <span class="line" data-startTime="1041">Well, we sort of use that </span><span class="line" data-startTime="1041">as a clue, as a heuristic </span><span class="line" data-startTime="1044">to determine that &mdash; </span><span class="line" data-startTime="1044">Oh, I see. </span> <span class="line" data-startTime="1046">There's no script connection </span><span class="line" data-startTime="1046">because it's been removed. </span></p>

<p><span class="line" data-startTime="1048">We can just fork that off </span><span class="line" data-startTime="1048">into another process. </span> <span class="line" data-startTime="1051">And so that's the kind </span><span class="line" data-startTime="1051">of heuristic that we've applied </span><span class="line" data-startTime="1054">to get sort of a good </span><span class="line" data-startTime="1054">distribution of processes </span><span class="line" data-startTime="1056">when, say, Gmail is the source </span><span class="line" data-startTime="1056">of all your new tabs, </span><span class="line" data-startTime="1060">because you're </span><span class="line" data-startTime="1060">clicking links there, </span><span class="line" data-startTime="1062">or other applications </span><span class="line" data-startTime="1062">like Gmail. </span> <span class="line" data-startTime="1064">All right, another topic </span><span class="line" data-startTime="1064">about process assignments. </span> <span class="line" data-startTime="1067">When you are just typing </span><span class="line" data-startTime="1067">a URL in the location bar, </span><span class="line" data-startTime="1071">you're saying, </span><span class="line" data-startTime="1071">"Replace the current tab </span><span class="line" data-startTime="1075">with new contents </span><span class="line" data-startTime="1075">from this new location." </span><span class="line" data-startTime="1077">And we recognize </span><span class="line" data-startTime="1077">that if what you're typing </span><span class="line" data-startTime="1080">is a URL with a new domain, </span><span class="line" data-startTime="1084">effectively it's </span><span class="line" data-startTime="1084">an opportunity for us to say, </span><span class="line" data-startTime="1087">"It's like closing the tab </span><span class="line" data-startTime="1087">and opening a new tab." </span><span class="line" data-startTime="1091">And so what you achieve there </span><span class="line" data-startTime="1091">is an opportunity </span><span class="line" data-startTime="1094">to switch processes </span><span class="line" data-startTime="1094">out from under the system </span><span class="line" data-startTime="1097">without the user </span><span class="line" data-startTime="1097">really being aware </span><span class="line" data-startTime="1099">that there was </span><span class="line" data-startTime="1099">a process switch. </span> <span class="line" data-startTime="1100">And this becomes a really </span><span class="line" data-startTime="1100">natural and nice point </span><span class="line" data-startTime="1102">for garbage collection. </span></p>

<p><span class="line" data-startTime="1104">So frequently in Chrome, </span><span class="line" data-startTime="1107">you're just typing </span><span class="line" data-startTime="1107">in the location bar, </span><span class="line" data-startTime="1108">you go to a &mdash; </span><span class="line" data-startTime="1108">enter a new URL up there, </span><span class="line" data-startTime="1111">and unbeknownst to you, </span><span class="line" data-startTime="1113">we're actually swapping </span><span class="line" data-startTime="1113">processes underneath. </span> <span class="line" data-startTime="1117">Oh, yes, </span><span class="line" data-startTime="1117">process per domain. </span> <span class="line" data-startTime="1120">So some people </span><span class="line" data-startTime="1120">might have heard </span><span class="line" data-startTime="1122">about the research project, </span><span class="line" data-startTime="1122">the Gisele browser, </span><span class="line" data-startTime="1125">which basically </span><span class="line" data-startTime="1125">implemented this idea </span><span class="line" data-startTime="1128">of actually having a separate </span><span class="line" data-startTime="1128">rendering process per domain, </span><span class="line" data-startTime="1131">rather than a separate </span><span class="line" data-startTime="1131">rendering process per tab. </span></p>

<p><span class="line" data-startTime="1133">This was something that </span><span class="line" data-startTime="1133">we looked at very hard as well, </span><span class="line" data-startTime="1136">because it seems </span><span class="line" data-startTime="1136">very attractive. </span> <span class="line" data-startTime="1138">And our conclusions </span><span class="line" data-startTime="1138">were very similar to theirs &mdash; </span><span class="line" data-startTime="1140">that you suffer some &mdash; </span><span class="line" data-startTime="1142">It turns out, you suffer </span><span class="line" data-startTime="1142">some web compatibility hit </span><span class="line" data-startTime="1145">for trying to make </span><span class="line" data-startTime="1145">this kind of change. </span> <span class="line" data-startTime="1147">But it still seems </span><span class="line" data-startTime="1147">so attractive. </span> <span class="line" data-startTime="1149">Wouldn't it be nice </span><span class="line" data-startTime="1149">if you could have </span><span class="line" data-startTime="1150">one rendering engine </span><span class="line" data-startTime="1150">dedicated for one domain? </span><span class="line" data-startTime="1153">And then you could </span><span class="line" data-startTime="1153">start to apply </span><span class="line" data-startTime="1154">some of these </span><span class="line" data-startTime="1154">multi-process benefits </span><span class="line" data-startTime="1157">to actual domains. </span> <span class="line" data-startTime="1159">You could say, "All the data </span><span class="line" data-startTime="1159">associated to Food.com </span><span class="line" data-startTime="1163">would only be available </span><span class="line" data-startTime="1163">to that rendering process." </span><span class="line" data-startTime="1166">And you wouldn't be able </span><span class="line" data-startTime="1166">to ever see data for Bar.com. </span></p>

<p><span class="line" data-startTime="1168">That's sort of the holy grail </span><span class="line" data-startTime="1168">of multi-process architecture. </span> <span class="line" data-startTime="1171">But there's some real </span><span class="line" data-startTime="1171">web compat challenges </span><span class="line" data-startTime="1173">that we face with that. </span> <span class="line" data-startTime="1176">For example, </span><span class="line" data-startTime="1176">third-party cookies </span><span class="line" data-startTime="1178">are a big problem. </span> <span class="line" data-startTime="1179">It turns out the web page </span><span class="line" data-startTime="1179">can dabble with cookies </span><span class="line" data-startTime="1184">that are not its own. </span> <span class="line" data-startTime="1190">All right, so sandbox. </span> <span class="line" data-startTime="1191">So I've been talking </span><span class="line" data-startTime="1191">about the sandbox, </span><span class="line" data-startTime="1193">but here's a little more </span><span class="line" data-startTime="1193">detail about it. </span> <span class="line" data-startTime="1196">Primary goal of the sandbox </span><span class="line" data-startTime="1198">was really all about protecting </span><span class="line" data-startTime="1198">the user against malware. </span> <span class="line" data-startTime="1202">There's so many things </span><span class="line" data-startTime="1202">that you might wish to sandbox. </span></p>

<p><span class="line" data-startTime="1204">Like you might wish to, </span><span class="line" data-startTime="1204">as I was just saying, </span><span class="line" data-startTime="1206">you might wish to protect </span><span class="line" data-startTime="1206">one origin from another origin &mdash; </span><span class="line" data-startTime="1210">Food.com from Bar.com. </span> <span class="line" data-startTime="1211">But that wasn't something </span><span class="line" data-startTime="1211">we strove to achieve initially. </span> <span class="line" data-startTime="1214">The first goal of the sandbox </span><span class="line" data-startTime="1216">was really just </span><span class="line" data-startTime="1216">as a catchall </span><span class="line" data-startTime="1219">to protect the user </span><span class="line" data-startTime="1219">against malware. </span> <span class="line" data-startTime="1222">If somehow there was a bug </span><span class="line" data-startTime="1223">exploited </span><span class="line" data-startTime="1223">in the renderering engine, </span><span class="line" data-startTime="1225">it should not turn itself </span><span class="line" data-startTime="1225">into a vehicle </span><span class="line" data-startTime="1228">to allow people </span><span class="line" data-startTime="1228">to distribute malware. </span> <span class="line" data-startTime="1231">So Chrome </span><span class="line" data-startTime="1231">has several features, </span><span class="line" data-startTime="1232">several anti-malware features. </span> <span class="line" data-startTime="1234">It has the sandbox, </span><span class="line" data-startTime="1234">of course, </span><span class="line" data-startTime="1235">but it also has </span><span class="line" data-startTime="1235">the safe browsing feature, </span><span class="line" data-startTime="1238">much like what you find </span><span class="line" data-startTime="1238">in other browsers, </span><span class="line" data-startTime="1241">where once you venture </span><span class="line" data-startTime="1241">onto a URL or a page </span><span class="line" data-startTime="1243">that contains content </span><span class="line" data-startTime="1243">known to be bad, </span><span class="line" data-startTime="1247">we'll show an interstitial, </span><span class="line" data-startTime="1247">an error, </span><span class="line" data-startTime="1249">allowing the user </span><span class="line" data-startTime="1249">to go through or not. </span> <span class="line" data-startTime="1251">That's sort of a first cut. </span></p>

<p><span class="line" data-startTime="1253">You know, obviously </span><span class="line" data-startTime="1253">if we don't know &mdash; </span><span class="line" data-startTime="1255">If the service </span><span class="line" data-startTime="1255">that you're using </span><span class="line" data-startTime="1257">to supply that data </span><span class="line" data-startTime="1257">doesn't know about the bad URL, </span><span class="line" data-startTime="1259">it's not gonna work. </span> <span class="line" data-startTime="1260">So you need some kind </span><span class="line" data-startTime="1260">of extra protection. </span> <span class="line" data-startTime="1262">It was very interesting &mdash; </span><span class="line" data-startTime="1262">a very interesting story. </span> <span class="line" data-startTime="1265">One of our engineers </span><span class="line" data-startTime="1265">was tracking down a crash </span><span class="line" data-startTime="1267">that he saw in Chrome </span><span class="line" data-startTime="1267">in the renderer, </span><span class="line" data-startTime="1268">and he was like, </span><span class="line" data-startTime="1268">"Oh, it's hard to reproduce &mdash; " </span><span class="line" data-startTime="1272">It's hard to debug </span><span class="line" data-startTime="1272">when he has the sandbox engaged. </span> <span class="line" data-startTime="1274">So he thought, "I'll just </span><span class="line" data-startTime="1274">take off the sandbox, </span><span class="line" data-startTime="1277">"and then I'll load this page up </span><span class="line" data-startTime="1277">in my debugger, </span><span class="line" data-startTime="1279">and go to town </span><span class="line" data-startTime="1279">trying to figure it out." </span><span class="line" data-startTime="1281">Well, it turns out that </span><span class="line" data-startTime="1281">that was actually </span><span class="line" data-startTime="1283">a site serving malware </span><span class="line" data-startTime="1283">that exploited his system </span><span class="line" data-startTime="1285">and corrupted his XP. </span> <span class="line" data-startTime="1288">And he was like, "Oh, crap, </span><span class="line" data-startTime="1288">now I have to re-image," </span><span class="line" data-startTime="1290">just 'cause he was trying </span><span class="line" data-startTime="1290">to debug this problem. </span></p>

<p><span class="line" data-startTime="1292">So sandbox </span><span class="line" data-startTime="1292">is a really nice tool. </span> <span class="line" data-startTime="1295">What are we trying </span><span class="line" data-startTime="1295">to restrict? </span><span class="line" data-startTime="1298">Well, trying to restrict </span><span class="line" data-startTime="1300">the processes' access </span><span class="line" data-startTime="1300">to the file system and network </span><span class="line" data-startTime="1303">and other kinds of devices </span><span class="line" data-startTime="1303">on the system. </span> <span class="line" data-startTime="1305">We're also trying </span><span class="line" data-startTime="1305">to restrict his access </span><span class="line" data-startTime="1306">to the windowing system. </span> <span class="line" data-startTime="1308">So he shouldn't be able to mess </span><span class="line" data-startTime="1308">around with your desktop, </span><span class="line" data-startTime="1309">shouldn't be able </span><span class="line" data-startTime="1309">to mess around </span><span class="line" data-startTime="1311">with any of the hardware, </span><span class="line" data-startTime="1311">your keyboard or your mouse </span><span class="line" data-startTime="1314">and so on. </span> <span class="line" data-startTime="1315">The mechanisms </span><span class="line" data-startTime="1315">to achieve this &mdash; </span><span class="line" data-startTime="1317">Well, as I said, every process </span><span class="line" data-startTime="1317">has some associated user, </span><span class="line" data-startTime="1321">and the user has </span><span class="line" data-startTime="1321">a certain set of capabilities. </span> <span class="line" data-startTime="1323">Under Windows, this is </span><span class="line" data-startTime="1323">represented by a user token. </span></p>

<p><span class="line" data-startTime="1326">And we can strip </span><span class="line" data-startTime="1326">all of the rights </span><span class="line" data-startTime="1328">off of that user token, </span><span class="line" data-startTime="1328">thereby denying things </span><span class="line" data-startTime="1330">like system access </span><span class="line" data-startTime="1330">and file system access. </span> <span class="line" data-startTime="1333">And there's other techniques </span><span class="line" data-startTime="1333">in Windows, </span><span class="line" data-startTime="1335">including job objects </span><span class="line" data-startTime="1335">that can be used </span><span class="line" data-startTime="1337">to further restrict </span><span class="line" data-startTime="1337">the capabilities of a process. </span> <span class="line" data-startTime="1339">And even just running it </span><span class="line" data-startTime="1339">on a separate virtual desktop, </span><span class="line" data-startTime="1341">this is a great way </span><span class="line" data-startTime="1341">to sort of limit </span><span class="line" data-startTime="1344">the processes' ability </span><span class="line" data-startTime="1344">to get access </span><span class="line" data-startTime="1346">to some of the input devices. </span> <span class="line" data-startTime="1351">Okay, but sandbox </span><span class="line" data-startTime="1351">doesn't actually &mdash; </span><span class="line" data-startTime="1354">A browser actually needs </span><span class="line" data-startTime="1354">to be able to load file URLs. </span> <span class="line" data-startTime="1356">So how do we achieve that </span><span class="line" data-startTime="1356">given that sandbox </span><span class="line" data-startTime="1358">doesn't allow you </span><span class="line" data-startTime="1358">to access file URLs? </span><span class="line" data-startTime="1360">Well, two big examples </span><span class="line" data-startTime="1360">of this </span><span class="line" data-startTime="1362">are A, </span><span class="line" data-startTime="1362">loading file colon URLs, </span><span class="line" data-startTime="1364">and the other one is actually </span><span class="line" data-startTime="1364">being able to upload a file </span><span class="line" data-startTime="1367">that is specified </span><span class="line" data-startTime="1367">in a web form. </span> <span class="line" data-startTime="1369">So to deal with file uploads, </span><span class="line" data-startTime="1369">what we do </span><span class="line" data-startTime="1373">is when the WebKit </span><span class="line" data-startTime="1373">wants to show a file picker, </span><span class="line" data-startTime="1378">it actually just asks </span><span class="line" data-startTime="1378">the browser, </span><span class="line" data-startTime="1380">"Please show a file picker." </span><span class="line" data-startTime="1382">Or a rendering process </span><span class="line" data-startTime="1382">asks the browser, </span><span class="line" data-startTime="1384">"Please show a file picker." </span><span class="line" data-startTime="1385">The browser </span><span class="line" data-startTime="1385">shows a file picker. </span></p>

<p><span class="line" data-startTime="1386">The user makes their selection. </span> <span class="line" data-startTime="1388">And then what we do </span><span class="line" data-startTime="1388">before we return that result </span><span class="line" data-startTime="1390">to the rendering engine </span><span class="line" data-startTime="1390">is we put it on a whitelist </span><span class="line" data-startTime="1392">associated </span><span class="line" data-startTime="1392">with that rendering engine. </span> <span class="line" data-startTime="1394">And now that rendering engine </span><span class="line" data-startTime="1394">is allowed to say </span><span class="line" data-startTime="1396">that he wants </span><span class="line" data-startTime="1396">to upload that file. </span> <span class="line" data-startTime="1398">It's pretty simple. </span> <span class="line" data-startTime="1400">File colon URLs, well, </span><span class="line" data-startTime="1400">what is this? </span><span class="line" data-startTime="1402">This is, you know, </span><span class="line" data-startTime="1402">the rendering engine </span><span class="line" data-startTime="1405">being able to load </span><span class="line" data-startTime="1405">any file URL, </span><span class="line" data-startTime="1406">because if you go to some </span><span class="line" data-startTime="1406">Food.HTML on your hard drive, </span><span class="line" data-startTime="1410">it can load images from </span><span class="line" data-startTime="1410">anywhere else on the hard drive. </span></p>

<p><span class="line" data-startTime="1413">To make that work, </span><span class="line" data-startTime="1413">what we do is we actually </span><span class="line" data-startTime="1415">just dedicate a separate </span><span class="line" data-startTime="1415">process for file colon URLs. </span> <span class="line" data-startTime="1418">So we're never mixing </span><span class="line" data-startTime="1418">web content and file colon URLs </span><span class="line" data-startTime="1422">in the same process. </span> <span class="line" data-startTime="1425">For example, if you go </span><span class="line" data-startTime="1425">into the location bar </span><span class="line" data-startTime="1427">and you type file colon, </span><span class="line" data-startTime="1429">and you're sitting </span><span class="line" data-startTime="1429">on a web page somewhere, </span><span class="line" data-startTime="1431">what we'll actually do </span><span class="line" data-startTime="1431">is leverage that technique </span><span class="line" data-startTime="1433">I mentioned before of swapping </span><span class="line" data-startTime="1433">the rendering engine out </span><span class="line" data-startTime="1435">underneath the hood, </span><span class="line" data-startTime="1436">so that really </span><span class="line" data-startTime="1436">what we're doing </span><span class="line" data-startTime="1438">is loading it </span><span class="line" data-startTime="1438">in a fresh rendering engine </span><span class="line" data-startTime="1441">that is now just dedicated </span><span class="line" data-startTime="1441">to local files. </span> <span class="line" data-startTime="1445">Okay, so what isn't protected? </span><span class="line" data-startTime="1447">I talked a little bit before </span><span class="line" data-startTime="1447">about, like, </span><span class="line" data-startTime="1450">we're not separating origins. </span> <span class="line" data-startTime="1451">So what that means </span><span class="line" data-startTime="1451">is that cookies &mdash; </span><span class="line" data-startTime="1454">A rendering engine can read </span><span class="line" data-startTime="1455">all of your cookies </span><span class="line" data-startTime="1455">from anywhere. </span> <span class="line" data-startTime="1457">So if somehow there was </span><span class="line" data-startTime="1457">a bug in the rendering engine, </span><span class="line" data-startTime="1459">that guy could then </span><span class="line" data-startTime="1459">go and ask for cookies </span><span class="line" data-startTime="1461">from any domain. </span></p>

<p><span class="line" data-startTime="1462">And this is just &mdash; this is </span><span class="line" data-startTime="1462">something we have to support </span><span class="line" data-startTime="1466">because of document.cookie. </span> <span class="line" data-startTime="1467">There's a JavaScript API </span><span class="line" data-startTime="1467">to allow the web page </span><span class="line" data-startTime="1469">to read your cookies. </span> <span class="line" data-startTime="1471">The one exception here </span><span class="line" data-startTime="1471">is the HTTP-only cookies. </span> <span class="line" data-startTime="1474">We actually don't have to allow </span><span class="line" data-startTime="1474">the renderer to see those. </span> <span class="line" data-startTime="1477">He can make HTTP requests, </span><span class="line" data-startTime="1479">and then the network stack </span><span class="line" data-startTime="1479">running in the browser </span><span class="line" data-startTime="1480">will add those </span><span class="line" data-startTime="1480">HTTP-only cookies. </span> <span class="line" data-startTime="1484">Passwords. </span> <span class="line" data-startTime="1485">Passwords, </span><span class="line" data-startTime="1485">much like cookies, </span><span class="line" data-startTime="1486">it turns out that the web page </span><span class="line" data-startTime="1486">can read the passwords. </span> <span class="line" data-startTime="1488">So if you have an input type, </span><span class="line" data-startTime="1488">people's password, </span><span class="line" data-startTime="1490">and the user enters </span><span class="line" data-startTime="1490">a value there, </span><span class="line" data-startTime="1493">it's actually supported </span><span class="line" data-startTime="1493">by the web </span><span class="line" data-startTime="1494">that the web page </span><span class="line" data-startTime="1494">should be able </span><span class="line" data-startTime="1496">to actually read that value out </span><span class="line" data-startTime="1496">and do something with it. </span></p>

<p><span class="line" data-startTime="1498">It's just the way </span><span class="line" data-startTime="1500">the input type, </span><span class="line" data-startTime="1500">people's password, </span><span class="line" data-startTime="1501">it's just a mechanism </span><span class="line" data-startTime="1501">for having some sort of secret </span><span class="line" data-startTime="1504">that's entered into </span><span class="line" data-startTime="1504">the web page. </span> <span class="line" data-startTime="1505">And so this generic mechanism </span><span class="line" data-startTime="1505">allows web pages </span><span class="line" data-startTime="1508">to do things like </span><span class="line" data-startTime="1508">do client-side authentication. </span> <span class="line" data-startTime="1511">So it's not </span><span class="line" data-startTime="1511">necessarily the case </span><span class="line" data-startTime="1513">that this password field </span><span class="line" data-startTime="1513">corresponds to data </span><span class="line" data-startTime="1516">that will be in a forum post. </span> <span class="line" data-startTime="1518">The reason why </span><span class="line" data-startTime="1518">that's interesting, </span><span class="line" data-startTime="1520">'cause you might </span><span class="line" data-startTime="1520">imagine a system </span><span class="line" data-startTime="1521">where the browser returns </span><span class="line" data-startTime="1521">a dummy password </span><span class="line" data-startTime="1524">to the web page. </span> <span class="line" data-startTime="1525">And then </span><span class="line" data-startTime="1525">when the dummy password </span><span class="line" data-startTime="1527">appears in the form post, </span><span class="line" data-startTime="1528">the browser transparently </span><span class="line" data-startTime="1528">replaces it </span><span class="line" data-startTime="1531">with the real password. </span> <span class="line" data-startTime="1532">That's a very clever way </span><span class="line" data-startTime="1532">to avoid exposing </span><span class="line" data-startTime="1535">the real password </span><span class="line" data-startTime="1535">to the web page. </span> <span class="line" data-startTime="1536">But again, </span><span class="line" data-startTime="1536">because the web page </span><span class="line" data-startTime="1538">has the power </span><span class="line" data-startTime="1538">to read that value </span><span class="line" data-startTime="1540">and so some computation on it, </span><span class="line" data-startTime="1542">it's &mdash; there's a potential &mdash; </span><span class="line" data-startTime="1544">there's a huge web </span><span class="line" data-startTime="1544">compatibility problem there. </span></p>

<p><span class="line" data-startTime="1546">So we end up </span><span class="line" data-startTime="1546">exposing the passwords </span><span class="line" data-startTime="1548">to the rendering engine. </span> <span class="line" data-startTime="1551">Other things like </span><span class="line" data-startTime="1551">HTML 5 database, </span><span class="line" data-startTime="1552">local store, session store, </span><span class="line" data-startTime="1552">they're much like cookies &mdash; </span><span class="line" data-startTime="1554">same kind of deal. </span> <span class="line" data-startTime="1555">They're origin-based, </span><span class="line" data-startTime="1556">and the renderer </span><span class="line" data-startTime="1556">gets access to them. </span> <span class="line" data-startTime="1558">Cross-site attacks, </span><span class="line" data-startTime="1558">user data in the cloud, </span><span class="line" data-startTime="1560">that kind of stuff </span><span class="line" data-startTime="1560">is not what the sandbox </span><span class="line" data-startTime="1562">is trying to protect against. </span> <span class="line" data-startTime="1563">You could imagine </span><span class="line" data-startTime="1563">a better sandbox </span><span class="line" data-startTime="1565">that did do that kind </span><span class="line" data-startTime="1565">of stuff. </span> <span class="line" data-startTime="1569">Okay, so moving on </span><span class="line" data-startTime="1569">to rendering in a sandbox. </span> <span class="line" data-startTime="1571">So given that we have, like, </span><span class="line" data-startTime="1571">almost no access to the system, </span><span class="line" data-startTime="1573">how do we render? </span><span class="line" data-startTime="1575">Normally, </span><span class="line" data-startTime="1575">a web rendering engine </span><span class="line" data-startTime="1577">is designed to render </span><span class="line" data-startTime="1577">to a native widget, </span><span class="line" data-startTime="1579">like an hWnd </span><span class="line" data-startTime="1579">or an NSView </span><span class="line" data-startTime="1581">or an X Window. </span></p>

<p><span class="line" data-startTime="1584">And that kind of thing </span><span class="line" data-startTime="1584">doesn't work </span><span class="line" data-startTime="1585">in a sandbox renderer </span><span class="line" data-startTime="1585">because we literally </span><span class="line" data-startTime="1588">are trying to deny </span><span class="line" data-startTime="1588">access to hWnds. </span> <span class="line" data-startTime="1589">HWnds are in </span><span class="line" data-startTime="1589">the Windows desktop. </span> <span class="line" data-startTime="1591">We're trying to deny that. </span> <span class="line" data-startTime="1593">So instead, very simply, </span><span class="line" data-startTime="1593">render to a bitmap. </span> <span class="line" data-startTime="1595">Send the bitmap </span><span class="line" data-startTime="1595">to the browser process. </span> <span class="line" data-startTime="1597">The browser puts that bitmap </span><span class="line" data-startTime="1597">on the screen. </span> <span class="line" data-startTime="1599">So it's like </span><span class="line" data-startTime="1599">a glorified image viewer. </span> <span class="line" data-startTime="1602">Complexities. </span> <span class="line" data-startTime="1604">Well, the rendering engine </span><span class="line" data-startTime="1607">can't get away without </span><span class="line" data-startTime="1607">using some system calls. </span> <span class="line" data-startTime="1610">For example, we need a way </span><span class="line" data-startTime="1610">to render fonts. </span> <span class="line" data-startTime="1613">And on Windows, to get </span><span class="line" data-startTime="1613">the best sort of fidelity </span><span class="line" data-startTime="1615">and the best sort of </span><span class="line" data-startTime="1615">native look and feel, </span><span class="line" data-startTime="1618">you really need to use </span><span class="line" data-startTime="1618">the Windows GDI APIs </span><span class="line" data-startTime="1620">to render fonts. </span></p>

<p><span class="line" data-startTime="1622">Well, </span><span class="line" data-startTime="1622">an interesting story here. </span> <span class="line" data-startTime="1624">This turned out to be </span><span class="line" data-startTime="1624">really challenging, </span><span class="line" data-startTime="1626">'cause once you take away </span><span class="line" data-startTime="1626">the rendering engine's ability </span><span class="line" data-startTime="1629">to access the file system, </span><span class="line" data-startTime="1632">well, what this actually means </span><span class="line" data-startTime="1632">is that you can't load fonts. </span> <span class="line" data-startTime="1635">And all the font APIs, </span><span class="line" data-startTime="1635">transparently under the hood, </span><span class="line" data-startTime="1638">will load fonts. </span> <span class="line" data-startTime="1639">Interestingly enough, </span><span class="line" data-startTime="1639">they don't do it in user land. </span> <span class="line" data-startTime="1642">They do it in kernel mode. </span> <span class="line" data-startTime="1644">But they use the token </span><span class="line" data-startTime="1645">of the process </span><span class="line" data-startTime="1645">that was calling them </span><span class="line" data-startTime="1647">to actually decide </span><span class="line" data-startTime="1647">whether or not </span><span class="line" data-startTime="1649">the kernel should load </span><span class="line" data-startTime="1649">that font. </span> <span class="line" data-startTime="1652">Well, our token doesn't have </span><span class="line" data-startTime="1652">those privileges. </span></p>

<p><span class="line" data-startTime="1656">So it turns out that Chrome </span><span class="line" data-startTime="1656">implements a glorious hack </span><span class="line" data-startTime="1659">of when we encounter </span><span class="line" data-startTime="1659">a font API call that fails, </span><span class="line" data-startTime="1662">we pause and let the browser </span><span class="line" data-startTime="1662">repeat the API </span><span class="line" data-startTime="1664">and load the font, </span><span class="line" data-startTime="1666">thereby populating the kernel's </span><span class="line" data-startTime="1666">cache of all fonts, </span><span class="line" data-startTime="1668">and then we repeat the exercise </span><span class="line" data-startTime="1668">of calling that API </span><span class="line" data-startTime="1671">in the renderer </span><span class="line" data-startTime="1673">and this time </span><span class="line" data-startTime="1673">hope it succeeds </span><span class="line" data-startTime="1674">because it hits some cache </span><span class="line" data-startTime="1676">that the kernel maintains. </span> <span class="line" data-startTime="1679">So fascinating complexities </span><span class="line" data-startTime="1679">just trying to deal </span><span class="line" data-startTime="1681">with some OS APIs. </span> <span class="line" data-startTime="1683">Other things </span><span class="line" data-startTime="1683">that we really wanted </span><span class="line" data-startTime="1685">to try to achieve </span><span class="line" data-startTime="1685">with this &mdash; </span><span class="line" data-startTime="1686">We really wanted to make sure </span><span class="line" data-startTime="1686">that there's no way </span><span class="line" data-startTime="1688">that a hung renderer </span><span class="line" data-startTime="1688">can screw up the browser. </span></p>

<p><span class="line" data-startTime="1690">This really impacts </span><span class="line" data-startTime="1690">the rendering model, </span><span class="line" data-startTime="1693">which I'll talk about </span><span class="line" data-startTime="1693">a little more in detail later. </span> <span class="line" data-startTime="1695">But fundamentally, you don't </span><span class="line" data-startTime="1695">want to be in a situation </span><span class="line" data-startTime="1697">where the renderer </span><span class="line" data-startTime="1697">is acquiring a lock </span><span class="line" data-startTime="1699">that the browser </span><span class="line" data-startTime="1699">then has to also acquire, </span><span class="line" data-startTime="1701">because the renderer </span><span class="line" data-startTime="1701">might never release it. </span> <span class="line" data-startTime="1703">And that &mdash; </span><span class="line" data-startTime="1703">As an end result, you know, </span><span class="line" data-startTime="1706">a bad renderer might </span><span class="line" data-startTime="1706">bring down the whole browser, </span><span class="line" data-startTime="1708">and we just really don't want </span><span class="line" data-startTime="1708">to be in that situation. </span></p>

<p><span class="line" data-startTime="1710">And of course </span><span class="line" data-startTime="1710">it needs to be really fast. </span> <span class="line" data-startTime="1713">So speed is very important </span><span class="line" data-startTime="1715">and somehow there should not </span><span class="line" data-startTime="1715">be any situations </span><span class="line" data-startTime="1717">where the renderer </span><span class="line" data-startTime="1717">can lock up the browser. </span> <span class="line" data-startTime="1722">So painting and scrolling, </span><span class="line" data-startTime="1724">lock free </span><span class="line" data-startTime="1724">painting and scrolling. </span> <span class="line" data-startTime="1725">This is a system </span><span class="line" data-startTime="1725">that we implement </span><span class="line" data-startTime="1727">of maintaining </span><span class="line" data-startTime="1727">a backingstore in the browser. </span> <span class="line" data-startTime="1730">A recent Pixmap </span><span class="line" data-startTime="1730">of what the tab looks like. </span> <span class="line" data-startTime="1734">Very simple idea. </span> <span class="line" data-startTime="1735">And then the renderer, </span><span class="line" data-startTime="1737">whenever he needs </span><span class="line" data-startTime="1737">to update a region, </span><span class="line" data-startTime="1739">he sends a bitmap </span><span class="line" data-startTime="1739">over shared memory </span><span class="line" data-startTime="1741">to the browser </span><span class="line" data-startTime="1741">and he blits that in </span><span class="line" data-startTime="1742">to his backingstore </span><span class="line" data-startTime="1744">and then blits that result </span><span class="line" data-startTime="1744">onto the screen. </span> <span class="line" data-startTime="1748">Very straightforward. </span></p>

<p><span class="line" data-startTime="1749">And then when the browser </span><span class="line" data-startTime="1750">is finished </span><span class="line" data-startTime="1750">putting pixels on the screen, </span><span class="line" data-startTime="1752">he acknowledges </span><span class="line" data-startTime="1752">to the renderer, </span><span class="line" data-startTime="1753">"Hey, look, and now </span><span class="line" data-startTime="1753">it's a good time </span><span class="line" data-startTime="1754">to produce another bitmap." </span><span class="line" data-startTime="1756">So this turns out to work </span><span class="line" data-startTime="1756">fairly well, </span><span class="line" data-startTime="1759">except that, you know, </span><span class="line" data-startTime="1759">we recognize </span><span class="line" data-startTime="1762">that you end up </span><span class="line" data-startTime="1762">in this sort of staggering </span><span class="line" data-startTime="1765">kind of situation </span><span class="line" data-startTime="1766">where the renderer paints, </span><span class="line" data-startTime="1766">then the browser paints, </span><span class="line" data-startTime="1768">then the renderer paints, </span><span class="line" data-startTime="1768">browser paints. </span></p>

<p><span class="line" data-startTime="1770">And in order to get </span><span class="line" data-startTime="1770">better performance, </span><span class="line" data-startTime="1772">we allow the renderer </span><span class="line" data-startTime="1772">to sort of prefetch </span><span class="line" data-startTime="1774">or do one additional render </span><span class="line" data-startTime="1774">ahead of the next &mdash; </span><span class="line" data-startTime="1777">in parallel </span><span class="line" data-startTime="1777">to the browser painting. </span> <span class="line" data-startTime="1780">So if you're on </span><span class="line" data-startTime="1780">a multi-core system, </span><span class="line" data-startTime="1781">you would be able </span><span class="line" data-startTime="1781">to light up both CPUs, </span><span class="line" data-startTime="1783">one of them is the renderer </span><span class="line" data-startTime="1785">producing the next </span><span class="line" data-startTime="1785">rendered output, </span><span class="line" data-startTime="1786">and the other one </span><span class="line" data-startTime="1786">is the browser </span><span class="line" data-startTime="1788">putting the pixels </span><span class="line" data-startTime="1788">from the previous rendering </span><span class="line" data-startTime="1789">on the screen. </span> <span class="line" data-startTime="1791">Scrolling works </span><span class="line" data-startTime="1791">very similarly. </span> <span class="line" data-startTime="1793">In order to achieve </span><span class="line" data-startTime="1793">very good scrolling performance, </span><span class="line" data-startTime="1795">you don't want to just </span><span class="line" data-startTime="1795">repaint the whole thing. </span> <span class="line" data-startTime="1798">You want to tell </span><span class="line" data-startTime="1798">the windowing system, </span><span class="line" data-startTime="1800">"Hey, look, </span><span class="line" data-startTime="1800">move your pixels down </span><span class="line" data-startTime="1801">and backfill </span><span class="line" data-startTime="1801">this exposed region." </span><span class="line" data-startTime="1803">So we send commands </span><span class="line" data-startTime="1803">from the renderer </span><span class="line" data-startTime="1806">to scroll the backingstore </span><span class="line" data-startTime="1806">and fill the exposed region, </span><span class="line" data-startTime="1809">the then the browser </span><span class="line" data-startTime="1809">repeats the exercise </span><span class="line" data-startTime="1811">of commanding </span><span class="line" data-startTime="1811">the windowing system </span><span class="line" data-startTime="1813">to scroll the pixels and then </span><span class="line" data-startTime="1813">backfill the exposed region. </span></p>

<p><span class="line" data-startTime="1815">And again, it acknowledges </span><span class="line" data-startTime="1815">once that's been done. </span> <span class="line" data-startTime="1821">Actually one more comment </span><span class="line" data-startTime="1821">about painting. </span> <span class="line" data-startTime="1824">So whenever you need </span><span class="line" data-startTime="1824">to resize the browser window, </span><span class="line" data-startTime="1827">because we have a backingstore </span><span class="line" data-startTime="1827">of the old rendering, </span><span class="line" data-startTime="1831">we don't necessarily have &mdash; </span><span class="line" data-startTime="1831">that backingstore </span><span class="line" data-startTime="1833">is not the right size </span><span class="line" data-startTime="1833">when you resize. </span> <span class="line" data-startTime="1835">And so it turns out </span><span class="line" data-startTime="1835">to be necessary </span><span class="line" data-startTime="1837">to play some games to try </span><span class="line" data-startTime="1837">to get good performance there, </span><span class="line" data-startTime="1840">because we're in a situation </span><span class="line" data-startTime="1840">where a resize happened </span><span class="line" data-startTime="1843">and we want to update </span><span class="line" data-startTime="1843">the backingstore, </span><span class="line" data-startTime="1846">and we obviously </span><span class="line" data-startTime="1846">don't have it yet. </span> <span class="line" data-startTime="1849">But we have asked the renderer </span><span class="line" data-startTime="1849">to produce the data, </span><span class="line" data-startTime="1851">and we're just waiting </span><span class="line" data-startTime="1851">for the renderer </span><span class="line" data-startTime="1853">to produce the data, </span><span class="line" data-startTime="1853">but Windows has asked us </span><span class="line" data-startTime="1855">to paint right now, </span><span class="line" data-startTime="1855">because it just resized. </span> <span class="line" data-startTime="1857">So we do implement </span><span class="line" data-startTime="1857">a little bit of a pause </span><span class="line" data-startTime="1860">to allow the renderer </span><span class="line" data-startTime="1860">to produce pixels. </span></p>

<p><span class="line" data-startTime="1862">If it can produce them </span><span class="line" data-startTime="1862">fast enough, </span><span class="line" data-startTime="1864">then on resize we will </span><span class="line" data-startTime="1864">paint the correct pixels </span><span class="line" data-startTime="1866">and not the old pixels. </span> <span class="line" data-startTime="1869">But it's fairly common </span><span class="line" data-startTime="1869">in Chrome when you use it, </span><span class="line" data-startTime="1871">if you resize very quickly, </span><span class="line" data-startTime="1871">you will see a little gutter, </span><span class="line" data-startTime="1874">and that's </span><span class="line" data-startTime="1874">what's going on there. </span> <span class="line" data-startTime="1878">Resource loading. </span> <span class="line" data-startTime="1879">So as I mentioned before, </span><span class="line" data-startTime="1881">the browser's this proxy </span><span class="line" data-startTime="1881">for all the IO. </span> <span class="line" data-startTime="1883">He takes great care </span><span class="line" data-startTime="1883">to restrict the types of URLs </span><span class="line" data-startTime="1887">that can be loaded </span><span class="line" data-startTime="1887">based on protocols. </span> <span class="line" data-startTime="1889">So if a rendering process </span><span class="line" data-startTime="1889">was not asked by the browser </span><span class="line" data-startTime="1893">to load a file URL, </span><span class="line" data-startTime="1893">then the rendering process </span><span class="line" data-startTime="1896">shall not request file URLs. </span> <span class="line" data-startTime="1898">And if he does, </span><span class="line" data-startTime="1898">they're denied. </span></p>

<p><span class="line" data-startTime="1900">Chrome colon URLs </span><span class="line" data-startTime="1900">are like file colon URLs </span><span class="line" data-startTime="1902">in that they're trusted. </span> <span class="line" data-startTime="1904">Chrome colon URLs </span><span class="line" data-startTime="1904">are used to load things </span><span class="line" data-startTime="1906">like the new tab page, </span><span class="line" data-startTime="1906">the downloads panel, </span><span class="line" data-startTime="1909">and other web content </span><span class="line" data-startTime="1909">that part of Chrome's UI. </span> <span class="line" data-startTime="1913">This browser network code </span><span class="line" data-startTime="1913">will actually perform </span><span class="line" data-startTime="1918">all the safe browsing checks </span><span class="line" data-startTime="1918">I talked about. </span> <span class="line" data-startTime="1921">He'll do all kinds of things </span><span class="line" data-startTime="1921">like vending the cookies </span><span class="line" data-startTime="1923">to the renderers </span><span class="line" data-startTime="1923">and managing all the data </span><span class="line" data-startTime="1924">associated </span><span class="line" data-startTime="1924">with resource loading. </span> <span class="line" data-startTime="1927">Finally, before WebKit </span><span class="line" data-startTime="1927">sees any data, </span><span class="line" data-startTime="1929">the browser's actually performed </span><span class="line" data-startTime="1929">a lot of different things. </span></p>

<p><span class="line" data-startTime="1932">He's handled </span><span class="line" data-startTime="1932">HTTP authentication </span><span class="line" data-startTime="1934">if prompting was necessary. </span> <span class="line" data-startTime="1935">He's done all </span><span class="line" data-startTime="1935">the SSL verification </span><span class="line" data-startTime="1938">and potentially put up UI </span><span class="line" data-startTime="1940">to ask users if they're &mdash; </span><span class="line" data-startTime="1942">You know, put a warning dialog </span><span class="line" data-startTime="1942">that's like, </span><span class="line" data-startTime="1944">"This, you know &mdash; </span><span class="line" data-startTime="1946">This certificate </span><span class="line" data-startTime="1946">is not necessarily valid." </span><span class="line" data-startTime="1948">He's done all these things </span><span class="line" data-startTime="1949">by the time </span><span class="line" data-startTime="1949">WebKit sees any data. </span> <span class="line" data-startTime="1951">He's also potentially </span><span class="line" data-startTime="1951">handled downloads, </span><span class="line" data-startTime="1954">so content sniffing </span><span class="line" data-startTime="1954">happens in the browser. </span> <span class="line" data-startTime="1956">MIME detection happens there </span><span class="line" data-startTime="1956">if necessary and so on. </span> <span class="line" data-startTime="1961">Some of the things that's </span><span class="line" data-startTime="1961">interesting about downloads </span><span class="line" data-startTime="1962">is that if you imagine </span><span class="line" data-startTime="1962">a scenario </span><span class="line" data-startTime="1965">where you were </span><span class="line" data-startTime="1965">returning data to WebKit </span><span class="line" data-startTime="1968">or to the rendering process, </span><span class="line" data-startTime="1969">and that process </span><span class="line" data-startTime="1969">was to determine </span><span class="line" data-startTime="1971">whether or not the data </span><span class="line" data-startTime="1971">should be treated as a download, </span><span class="line" data-startTime="1973">well, you would be </span><span class="line" data-startTime="1973">in an unfortunate situation </span><span class="line" data-startTime="1976">of having to echo that data </span><span class="line" data-startTime="1976">back to the browser </span><span class="line" data-startTime="1978">so that he could </span><span class="line" data-startTime="1978">save it to disk. </span></p>

<p><span class="line" data-startTime="1980">And so moving the detection </span><span class="line" data-startTime="1980">into the browser </span><span class="line" data-startTime="1981">allows for better performance. </span> <span class="line" data-startTime="1983">All the decisions </span><span class="line" data-startTime="1983">happen there, </span><span class="line" data-startTime="1985">and it can either go &mdash; </span><span class="line" data-startTime="1986">it could either decide </span><span class="line" data-startTime="1986">at that time </span><span class="line" data-startTime="1988">to T it to disk </span><span class="line" data-startTime="1988">instead of to the renderer. </span> <span class="line" data-startTime="1993">The history system. </span> <span class="line" data-startTime="1994">So...much like painting, </span><span class="line" data-startTime="2000">it was important to us </span><span class="line" data-startTime="2000">that we could achieve </span><span class="line" data-startTime="2002">a good way to manage </span><span class="line" data-startTime="2002">visited links </span><span class="line" data-startTime="2006">without locking. </span> <span class="line" data-startTime="2008">We wanted to make sure that &mdash; </span><span class="line" data-startTime="2011">so that the renderer </span><span class="line" data-startTime="2011">could very quickly check </span><span class="line" data-startTime="2015">whether or not </span><span class="line" data-startTime="2015">a link was visited </span><span class="line" data-startTime="2017">so it could color it </span><span class="line" data-startTime="2017">as visited or not, </span><span class="line" data-startTime="2019">and do so in a way </span><span class="line" data-startTime="2019">that didn't require </span><span class="line" data-startTime="2020">acquiring any kind of lock. </span> <span class="line" data-startTime="2022">So there's sort of simple idea </span><span class="line" data-startTime="2022">of shared memory </span><span class="line" data-startTime="2024">containing a bitmap </span><span class="line" data-startTime="2026">that's treated like </span><span class="line" data-startTime="2026">a hash table. </span> <span class="line" data-startTime="2028">We apply a crypto hash </span><span class="line" data-startTime="2028">to the URL, </span><span class="line" data-startTime="2030">take 64 bits of that, </span><span class="line" data-startTime="2030">index this bitmap, </span><span class="line" data-startTime="2033">and then see if </span><span class="line" data-startTime="2033">the link's visited or not. </span></p>

<p><span class="line" data-startTime="2038">And then the browser, </span><span class="line" data-startTime="2039">whenever he needs </span><span class="line" data-startTime="2039">to update this thing, </span><span class="line" data-startTime="2041">he's either setting the bits, </span><span class="line" data-startTime="2042">or if he finds that </span><span class="line" data-startTime="2042">he needs to grow the table, </span><span class="line" data-startTime="2044">he creates a whole new table, </span><span class="line" data-startTime="2045">sends the new table </span><span class="line" data-startTime="2045">down to the renderer. </span> <span class="line" data-startTime="2047">The renderers </span><span class="line" data-startTime="2047">drop the old table </span><span class="line" data-startTime="2048">and then pick up </span><span class="line" data-startTime="2048">the new one. </span> <span class="line" data-startTime="2050">Works great </span><span class="line" data-startTime="2050">with the minor exception </span><span class="line" data-startTime="2052">that it causes us to fail </span><span class="line" data-startTime="2052">one of the Acid3 tests. </span> <span class="line" data-startTime="2055">This is why Chrome gets </span><span class="line" data-startTime="2055">that link test error in Acid3, </span><span class="line" data-startTime="2058">because it turns out that this </span><span class="line" data-startTime="2058">is a very asynchronous model, </span><span class="line" data-startTime="2061">of the browser's the only one </span><span class="line" data-startTime="2062">who writes </span><span class="line" data-startTime="2062">to the visited link table. </span> <span class="line" data-startTime="2064">The renderer's </span><span class="line" data-startTime="2064">the one who reads, </span><span class="line" data-startTime="2065">but this Acid3 test </span><span class="line" data-startTime="2065">actually requires the renderer </span><span class="line" data-startTime="2068">to have visited </span><span class="line" data-startTime="2068">and be able to check right away </span><span class="line" data-startTime="2072">that this link </span><span class="line" data-startTime="2072">is actually visited. </span></p>

<p><span class="line" data-startTime="2075">But we're working </span><span class="line" data-startTime="2075">on a fix. </span> <span class="line" data-startTime="2077">So after a page loads, </span><span class="line" data-startTime="2079">data is actually extracted </span><span class="line" data-startTime="2079">from the page </span><span class="line" data-startTime="2081">so that it can be sent </span><span class="line" data-startTime="2081">into the full text index, </span><span class="line" data-startTime="2083">and that's what drives </span><span class="line" data-startTime="2083">things like the Omnibox </span><span class="line" data-startTime="2085">and the whole history search </span><span class="line" data-startTime="2085">mechanism in Chrome. </span> <span class="line" data-startTime="2088">And new tab is populated </span><span class="line" data-startTime="2088">with thumbnails. </span> <span class="line" data-startTime="2090">Those thumbnails are captured </span><span class="line" data-startTime="2090">at this time and so on. </span> <span class="line" data-startTime="2094">And this data is collected, </span><span class="line" data-startTime="2094">sent up to the browser. </span> <span class="line" data-startTime="2096">All this history management </span><span class="line" data-startTime="2096">happens up there. </span> <span class="line" data-startTime="2100">Plug-ins. </span> <span class="line" data-startTime="2103">This is probably &mdash; Plug-ins &mdash; </span><span class="line" data-startTime="2104">Support Netscape </span><span class="line" data-startTime="2104">style plug-ins </span><span class="line" data-startTime="2107">and even ActiveX controls </span><span class="line" data-startTime="2107">through a shim. </span> <span class="line" data-startTime="2111">Talk a little bit more </span><span class="line" data-startTime="2111">about that. </span> <span class="line" data-startTime="2112">Supporting plug-ins </span><span class="line" data-startTime="2112">turns out to be </span><span class="line" data-startTime="2114">probably one of the hardest </span><span class="line" data-startTime="2114">things about doing Chrome, </span><span class="line" data-startTime="2115">because we knew </span><span class="line" data-startTime="2115">they could not run </span><span class="line" data-startTime="2118">in the sandbox renderer </span><span class="line" data-startTime="2120">because they required </span><span class="line" data-startTime="2120">a lot of privileges, </span><span class="line" data-startTime="2121">and we knew that we wanted </span><span class="line" data-startTime="2121">to have a sandbox </span><span class="line" data-startTime="2123">that was very aggressive. </span></p>

<p><span class="line" data-startTime="2125">And so that meant </span><span class="line" data-startTime="2125">pushing the plug-in </span><span class="line" data-startTime="2126">outside of </span><span class="line" data-startTime="2126">the rendering engine, </span><span class="line" data-startTime="2128">which meant taking an API </span><span class="line" data-startTime="2128">that was synchronous </span><span class="line" data-startTime="2132">and designed to run </span><span class="line" data-startTime="2132">inside of a rendering engine </span><span class="line" data-startTime="2134">and forcing it out of process. </span> <span class="line" data-startTime="2137">This turned out to be </span><span class="line" data-startTime="2137">very complicated. </span> <span class="line" data-startTime="2140">But what we tried to do here </span><span class="line" data-startTime="2141">by allocating a single </span><span class="line" data-startTime="2141">plug-in process per plug-in </span><span class="line" data-startTime="2144">was to give plug-ins sort of </span><span class="line" data-startTime="2144">this environment to run in </span><span class="line" data-startTime="2148">that looked to them much like </span><span class="line" data-startTime="2148">an ordinary browser environment. </span> <span class="line" data-startTime="2152">So unbeknownst to them, </span><span class="line" data-startTime="2152">hopefully, </span><span class="line" data-startTime="2154">they don't realize </span><span class="line" data-startTime="2154">that they're actually </span><span class="line" data-startTime="2156">in a separate process. </span> <span class="line" data-startTime="2157">And this works &mdash; </span><span class="line" data-startTime="2159">Through a lot of </span><span class="line" data-startTime="2159">sweat, tears, and toil, </span><span class="line" data-startTime="2163">we've gotten this to work. </span></p>

<p><span class="line" data-startTime="2165">So there's two types </span><span class="line" data-startTime="2165">of plug-ins, </span><span class="line" data-startTime="2168">two modes of rendering </span><span class="line" data-startTime="2168">for plug-ins. </span> <span class="line" data-startTime="2169">One is called windowless </span><span class="line" data-startTime="2169">and one is windowed. </span> <span class="line" data-startTime="2172">Windowed means that </span><span class="line" data-startTime="2172">you actually get &mdash; </span><span class="line" data-startTime="2174">the plug-in actually </span><span class="line" data-startTime="2174">has its own native widget, </span><span class="line" data-startTime="2176">like its own hWnd. </span> <span class="line" data-startTime="2177">And then once it has </span><span class="line" data-startTime="2177">its own hWnd, </span><span class="line" data-startTime="2180">it has its own </span><span class="line" data-startTime="2180">render loop basically. </span> <span class="line" data-startTime="2184">And it has a lot of control </span><span class="line" data-startTime="2184">and access to the system. </span> <span class="line" data-startTime="2187">But we're running </span><span class="line" data-startTime="2187">that hWnd out of process, </span><span class="line" data-startTime="2189">and so we are managing </span><span class="line" data-startTime="2189">a windowing hierarchy </span><span class="line" data-startTime="2191">that spans processes, </span><span class="line" data-startTime="2192">and windows </span><span class="line" data-startTime="2192">outside of our control </span><span class="line" data-startTime="2194">will be doing IPCs </span><span class="line" data-startTime="2194">between those windows, </span><span class="line" data-startTime="2198">and that leads to a lot </span><span class="line" data-startTime="2198">of complexity. </span> <span class="line" data-startTime="2201">So we do </span><span class="line" data-startTime="2201">some interesting tricks </span><span class="line" data-startTime="2203">to try to minimize </span><span class="line" data-startTime="2203">the synchronous communication </span><span class="line" data-startTime="2206">that Windows does </span><span class="line" data-startTime="2206">underneath the hood </span><span class="line" data-startTime="2208">so that scrolling a page </span><span class="line" data-startTime="2208">with plug-ins </span><span class="line" data-startTime="2209">will actually perform okay. </span></p>

<p><span class="line" data-startTime="2211">I think we still have </span><span class="line" data-startTime="2211">room to improve here, </span><span class="line" data-startTime="2214">but it's gotten </span><span class="line" data-startTime="2214">a lot better </span><span class="line" data-startTime="2216">since the Chrome 1 days. </span> <span class="line" data-startTime="2217">Or I should say </span><span class="line" data-startTime="2217">since our initial launch. </span> <span class="line" data-startTime="2220">Caching the rendering </span><span class="line" data-startTime="2220">of windowless plug-ins. </span> <span class="line" data-startTime="2222">What we do when there's </span><span class="line" data-startTime="2222">a windowless plug-in &mdash; </span><span class="line" data-startTime="2224">This is a plug-in type </span><span class="line" data-startTime="2225">that has no hWnd </span><span class="line" data-startTime="2225">associated with it, no window. </span> <span class="line" data-startTime="2228">Instead the rendering engine </span><span class="line" data-startTime="2228">just asks it, </span><span class="line" data-startTime="2230">"Please paint </span><span class="line" data-startTime="2230">into this buffer." </span><span class="line" data-startTime="2232">And it turns out </span><span class="line" data-startTime="2232">that windowless plug-ins </span><span class="line" data-startTime="2234">do something interesting. </span></p>

<p><span class="line" data-startTime="2235">They actually </span><span class="line" data-startTime="2235">do the compositing </span><span class="line" data-startTime="2237">inside the plug-in. </span> <span class="line" data-startTime="2239">What this means is &mdash; </span><span class="line" data-startTime="2240">And they can be </span><span class="line" data-startTime="2240">in the Z-order of CSS. </span> <span class="line" data-startTime="2243">And so what this means </span><span class="line" data-startTime="2243">is that as WebKit is painting </span><span class="line" data-startTime="2246">and it encounters a plug-in, </span><span class="line" data-startTime="2248">it sort of stops, </span><span class="line" data-startTime="2248">asks the plug-in, </span><span class="line" data-startTime="2249">"Now please draw your pixels," </span><span class="line" data-startTime="2250">and then WebKit </span><span class="line" data-startTime="2250">continues painting on top. </span> <span class="line" data-startTime="2252">So you get </span><span class="line" data-startTime="2252">this interesting stack. </span> <span class="line" data-startTime="2254">And so if we were </span><span class="line" data-startTime="2254">trying to achieve, </span><span class="line" data-startTime="2256">as I mentioned earlier on, </span><span class="line" data-startTime="2256">good asynchronous communication </span><span class="line" data-startTime="2259">between our processes </span><span class="line" data-startTime="2259">and asynchronous separation, </span><span class="line" data-startTime="2262">here, rendering </span><span class="line" data-startTime="2262">windowless plug-ins, </span><span class="line" data-startTime="2263">is a case </span><span class="line" data-startTime="2263">where we don't have that. </span></p>

<p><span class="line" data-startTime="2265">So our solution </span><span class="line" data-startTime="2265">was to keep a cache </span><span class="line" data-startTime="2267">or what the windowless </span><span class="line" data-startTime="2267">plug-in rendered last time </span><span class="line" data-startTime="2270">in the rendering process, </span><span class="line" data-startTime="2271">so that when we're painting </span><span class="line" data-startTime="2271">in WebKit, </span><span class="line" data-startTime="2273">he can quickly just paint </span><span class="line" data-startTime="2273">from that cached representation </span><span class="line" data-startTime="2276">of the plug-in. </span> <span class="line" data-startTime="2277">And once we implemented this, </span><span class="line" data-startTime="2277">we got a much better performance </span><span class="line" data-startTime="2280">for windowless plug-ins. </span> <span class="line" data-startTime="2281">Of course you suffer </span><span class="line" data-startTime="2281">a frame rate hit </span><span class="line" data-startTime="2283">for windowless animations, </span><span class="line" data-startTime="2285">but overall the results </span><span class="line" data-startTime="2285">are much better. </span> <span class="line" data-startTime="2288">Another big challenge </span><span class="line" data-startTime="2288">with all of this is porting, </span><span class="line" data-startTime="2291">because NPAPI is not </span><span class="line" data-startTime="2291">a platform-independent API. </span> <span class="line" data-startTime="2294">It's really just glue, </span><span class="line" data-startTime="2294">bridging glue, </span><span class="line" data-startTime="2297">binding the browser </span><span class="line" data-startTime="2297">to other native APIs </span><span class="line" data-startTime="2301">for rendering. </span> <span class="line" data-startTime="2303">And so the work required </span><span class="line" data-startTime="2303">to support Mac and Linux </span><span class="line" data-startTime="2307">is similar magnitude </span><span class="line" data-startTime="2307">to the work </span><span class="line" data-startTime="2309">that was required </span><span class="line" data-startTime="2309">to support Windows, </span><span class="line" data-startTime="2310">and it's very challenging. </span> <span class="line" data-startTime="2313">But it's coming along. </span></p>

<p><span class="line" data-startTime="2314">The current Chromium </span><span class="line" data-startTime="2314">Max and Linux builds </span><span class="line" data-startTime="2316">do not yet have plug-ins </span><span class="line" data-startTime="2316">enabled for this reason, </span><span class="line" data-startTime="2318">but they're in development </span><span class="line" data-startTime="2320">and can be enabled </span><span class="line" data-startTime="2320">through a switch, I believe. </span> <span class="line" data-startTime="2324">So I want to talk </span><span class="line" data-startTime="2324">a little bit about WebKit, </span><span class="line" data-startTime="2329">just briefly about WebKit. </span> <span class="line" data-startTime="2331">So WebKit, </span><span class="line" data-startTime="2331">for those who don't know, </span><span class="line" data-startTime="2333">is comprised of, </span><span class="line" data-startTime="2333">what I'd say, </span><span class="line" data-startTime="2335">is about three major modules. </span> <span class="line" data-startTime="2337">There's JavaScriptCore, </span><span class="line" data-startTime="2338">the WebKit's </span><span class="line" data-startTime="2338">JavaScript engine. </span></p>

<p><span class="line" data-startTime="2340">This is obviously </span><span class="line" data-startTime="2340">what Chrome doesn't use. </span> <span class="line" data-startTime="2342">We use V8 instead. </span> <span class="line" data-startTime="2343">WebCore represents </span><span class="line" data-startTime="2343">all of the code </span><span class="line" data-startTime="2346">to do the HTML, CSS, </span><span class="line" data-startTime="2346">and DOM rendering. </span> <span class="line" data-startTime="2349">SVG is at this layer </span><span class="line" data-startTime="2349">and other features. </span> <span class="line" data-startTime="2352">A lot of the new </span><span class="line" data-startTime="2352">API's database and so on </span><span class="line" data-startTime="2356">are at this layer. </span> <span class="line" data-startTime="2358">And then there's </span><span class="line" data-startTime="2358">the WebKit layer to WebKit, </span><span class="line" data-startTime="2360">which is the API layer. </span> <span class="line" data-startTime="2362">And we don't use this because </span><span class="line" data-startTime="2362">the layers that exist here </span><span class="line" data-startTime="2365">in the WebKit repository </span><span class="line" data-startTime="2367">are things like </span><span class="line" data-startTime="2367">a COM API to WebKit, </span><span class="line" data-startTime="2370">an objective CAPI </span><span class="line" data-startTime="2370">to WebKit, </span><span class="line" data-startTime="2372">a GDK API to WebKit, </span><span class="line" data-startTime="2374">a QT API to WebKit, </span><span class="line" data-startTime="2375">wxWidgets API to WebKit. </span></p>

<p><span class="line" data-startTime="2377">None of those </span><span class="line" data-startTime="2377">are really appropriate </span><span class="line" data-startTime="2379">for our use case </span><span class="line" data-startTime="2381">where we need it </span><span class="line" data-startTime="2381">to run the renderer </span><span class="line" data-startTime="2383">in this insulated world </span><span class="line" data-startTime="2383">in the sandbox </span><span class="line" data-startTime="2385">where it really doesn't </span><span class="line" data-startTime="2385">have access to the system. </span> <span class="line" data-startTime="2387">And so there's any native </span><span class="line" data-startTime="2387">toolkit you can imagine, </span><span class="line" data-startTime="2389">or any even </span><span class="line" data-startTime="2389">cross-platform toolkit, </span><span class="line" data-startTime="2391">that, under the hood, </span><span class="line" data-startTime="2391">really deals in native widgets </span><span class="line" data-startTime="2393">just wouldn't work. </span> <span class="line" data-startTime="2395">So, for us, </span><span class="line" data-startTime="2395">we were not able to use </span><span class="line" data-startTime="2396">the existing embedding APIs, </span><span class="line" data-startTime="2398">but we had to have our own. </span> <span class="line" data-startTime="2399">And so we're </span><span class="line" data-startTime="2399">building out own </span><span class="line" data-startTime="2401">that we will be putting into </span><span class="line" data-startTime="2401">the WebKit repository </span><span class="line" data-startTime="2403">in good time. </span> <span class="line" data-startTime="2406">So if you were to look </span><span class="line" data-startTime="2406">into the WebCore reposit &mdash; </span><span class="line" data-startTime="2409">WebCore directory today, </span><span class="line" data-startTime="2411">you would see some </span><span class="line" data-startTime="2411">interesting pound defines. </span> <span class="line" data-startTime="2413">Things for, like, </span><span class="line" data-startTime="2413">PLATFORM(CHROMIUM) </span><span class="line" data-startTime="2415">which represents changes </span><span class="line" data-startTime="2415">that we made to WebKit </span><span class="line" data-startTime="2420">to support </span><span class="line" data-startTime="2420">Chromium-specific things. </span></p>

<p><span class="line" data-startTime="2423">PLATFORM(SKIA), </span><span class="line" data-startTime="2424">again for Skia-specific </span><span class="line" data-startTime="2424">things. </span> <span class="line" data-startTime="2426">Basically WebCore </span><span class="line" data-startTime="2426">has a graphics layer </span><span class="line" data-startTime="2430">where you are to implement </span><span class="line" data-startTime="2430">a graphics context. </span> <span class="line" data-startTime="2432">And so we have </span><span class="line" data-startTime="2432">a Skia implementation </span><span class="line" data-startTime="2434">to graphics contexts. </span> <span class="line" data-startTime="2435">USE(V8) is the pound defined </span><span class="line" data-startTime="2435">to select V8. </span> <span class="line" data-startTime="2438">The V8 bindings </span><span class="line" data-startTime="2438">all live inside of WebCore. </span> <span class="line" data-startTime="2442">Mostly. </span> <span class="line" data-startTime="2444">WebKit versions. </span> <span class="line" data-startTime="2446">So for when we shipped </span><span class="line" data-startTime="2446">Chrome 1, </span><span class="line" data-startTime="2450">when we did </span><span class="line" data-startTime="2450">our initial launch, </span><span class="line" data-startTime="2451">we were very nervous </span><span class="line" data-startTime="2451">about our selection </span><span class="line" data-startTime="2453">of the version of WebKit. </span> <span class="line" data-startTime="2455">We wanted to make sure </span><span class="line" data-startTime="2455">that we didn't inadvertently </span><span class="line" data-startTime="2458">introduce web compatibility </span><span class="line" data-startTime="2458">issues. </span> <span class="line" data-startTime="2461">So Safari 3 had shipped </span><span class="line" data-startTime="2461">earlier in the year, </span><span class="line" data-startTime="2464">and we chose to continue </span><span class="line" data-startTime="2464">shipping WebKit </span><span class="line" data-startTime="2467">based on the version of WebKit </span><span class="line" data-startTime="2467">that Safari 3 shipped, </span><span class="line" data-startTime="2470">mostly just to achieve </span><span class="line" data-startTime="2470">compatibility. </span></p>

<p><span class="line" data-startTime="2472">We didn't want to worry about </span><span class="line" data-startTime="2472">being on a different WebKit </span><span class="line" data-startTime="2475">that had changed. </span> <span class="line" data-startTime="2477">Again for Chrome 2, </span><span class="line" data-startTime="2478">we're pretty lined up </span><span class="line" data-startTime="2478">with Safari 4's WebKit. </span> <span class="line" data-startTime="2480">I think we've taken </span><span class="line" data-startTime="2480">a slightly older &mdash; </span><span class="line" data-startTime="2482">a slightly newer version </span><span class="line" data-startTime="2482">of WebKit than they shipped. </span> <span class="line" data-startTime="2485">And one of the big hurdles </span><span class="line" data-startTime="2485">for Chrome 2 </span><span class="line" data-startTime="2491">was actually moving </span><span class="line" data-startTime="2491">from this older WebKit </span><span class="line" data-startTime="2494">to the newer WebKit. </span> <span class="line" data-startTime="2495">And so that has a lot to do </span><span class="line" data-startTime="2497">with what I want </span><span class="line" data-startTime="2497">to talk about next. </span> <span class="line" data-startTime="2500">It's WebKit development. </span> <span class="line" data-startTime="2502">So members </span><span class="line" data-startTime="2502">of the Chromium team </span><span class="line" data-startTime="2504">are very active </span><span class="line" data-startTime="2504">in the WebKit community now. </span> <span class="line" data-startTime="2508">We have a number of reviewers, </span><span class="line" data-startTime="2508">a number of contributors, </span><span class="line" data-startTime="2511">and we're just trying </span><span class="line" data-startTime="2511">to increase our presence </span><span class="line" data-startTime="2515">and increase our contribution </span><span class="line" data-startTime="2515">to the WebKit project. </span> <span class="line" data-startTime="2518">So we believe strongly </span><span class="line" data-startTime="2518">in WebKit being &mdash; </span><span class="line" data-startTime="2522">We're very happy </span><span class="line" data-startTime="2522">to have used WebKit. </span></p>

<p><span class="line" data-startTime="2524">We're just very much enjoying </span><span class="line" data-startTime="2524">all the things it does for us, </span><span class="line" data-startTime="2528">and we want to continue </span><span class="line" data-startTime="2528">to contribute to it. </span> <span class="line" data-startTime="2531">I say status: unforked. </span> <span class="line" data-startTime="2533">So when we initially launched, </span><span class="line" data-startTime="2535">because we were on </span><span class="line" data-startTime="2535">an older version of WebKit </span><span class="line" data-startTime="2539">and we needed </span><span class="line" data-startTime="2539">to fix problems, </span><span class="line" data-startTime="2541">we accumulated a large number </span><span class="line" data-startTime="2541">of forks to WebKit. </span> <span class="line" data-startTime="2545">And indeed to even </span><span class="line" data-startTime="2545">support V8 in WebKit, </span><span class="line" data-startTime="2548">we needed to make </span><span class="line" data-startTime="2548">modifications. </span> <span class="line" data-startTime="2551">So in order to get </span><span class="line" data-startTime="2551">to a point where we could </span><span class="line" data-startTime="2554">actually work </span><span class="line" data-startTime="2554">directly on WebKit </span><span class="line" data-startTime="2555">and be a first-class citizen </span><span class="line" data-startTime="2555">in the WebKit world, </span><span class="line" data-startTime="2558">we needed to unfork. </span></p>

<p><span class="line" data-startTime="2559">And so we went through </span><span class="line" data-startTime="2559">this massive, </span><span class="line" data-startTime="2562">I call massive, undertaking </span><span class="line" data-startTime="2564">to sort of push all </span><span class="line" data-startTime="2564">of our changes into WebKit </span><span class="line" data-startTime="2566">and refactor things so that </span><span class="line" data-startTime="2566">our changes could live there </span><span class="line" data-startTime="2569">and finally end up in a world </span><span class="line" data-startTime="2569">where we're able to work </span><span class="line" data-startTime="2572">with Chrome, </span><span class="line" data-startTime="2572">develop Chrome, </span><span class="line" data-startTime="2574">on the tip of tree </span><span class="line" data-startTime="2574">of WebKit </span><span class="line" data-startTime="2576">alongside of other developers </span><span class="line" data-startTime="2578">who are developing </span><span class="line" data-startTime="2578">tip of tree WebKit </span><span class="line" data-startTime="2580">using Safari. </span> <span class="line" data-startTime="2582">So our focus of WebKit </span><span class="line" data-startTime="2582">development going forward </span><span class="line" data-startTime="2585">is, as I mentioned before, </span><span class="line" data-startTime="2586">we want to establish </span><span class="line" data-startTime="2586">a WebKit API for Chromium. </span> <span class="line" data-startTime="2589">Our goals here </span><span class="line" data-startTime="2589">are very simple </span><span class="line" data-startTime="2592">We want to build a very simple </span><span class="line" data-startTime="2592">C++ API to WebKit </span><span class="line" data-startTime="2595">that is not dependent </span><span class="line" data-startTime="2595">on any other toolkit </span><span class="line" data-startTime="2599">other than WebCore, </span><span class="line" data-startTime="2599">all right? </span><span class="line" data-startTime="2601">That's basically just about </span><span class="line" data-startTime="2601">a very thin layer to WebKit </span><span class="line" data-startTime="2605">so that if anybody else </span><span class="line" data-startTime="2605">wants to embed WebKit, </span><span class="line" data-startTime="2607">they have </span><span class="line" data-startTime="2607">an easy path forward. </span></p>

<p><span class="line" data-startTime="2609">It's not a matter of picking </span><span class="line" data-startTime="2609">a certain flavor of toolkit </span><span class="line" data-startTime="2612">that is compatible </span><span class="line" data-startTime="2612">with your world, </span><span class="line" data-startTime="2613">but here, </span><span class="line" data-startTime="2613">suppose you just want </span><span class="line" data-startTime="2615">a simple API </span><span class="line" data-startTime="2615">that's not particular, </span><span class="line" data-startTime="2620">you could use this as well. </span> <span class="line" data-startTime="2622">We have a lot of folks </span><span class="line" data-startTime="2622">working on open web platform, </span><span class="line" data-startTime="2625">HTML 5, et cetera. </span> <span class="line" data-startTime="2626">Web workers </span><span class="line" data-startTime="2626">is included in that </span><span class="line" data-startTime="2628">and a number of other things, </span><span class="line" data-startTime="2629">like the video feature </span><span class="line" data-startTime="2629">that was just recently launched </span><span class="line" data-startTime="2631">in the Chrome developer </span><span class="line" data-startTime="2631">channel. </span> <span class="line" data-startTime="2634">And of course </span><span class="line" data-startTime="2634">we're very interested </span><span class="line" data-startTime="2636">in improving web compat. </span> <span class="line" data-startTime="2638">I think web compat is probably </span><span class="line" data-startTime="2638">one of the number one challenges </span><span class="line" data-startTime="2640">for any fledging browser, </span><span class="line" data-startTime="2643">certainly for </span><span class="line" data-startTime="2643">any rendering engine </span><span class="line" data-startTime="2645">that doesn't have </span><span class="line" data-startTime="2645">the kind of market share </span><span class="line" data-startTime="2646">that MSHTML has </span><span class="line" data-startTime="2646">or Gekko has. </span> <span class="line" data-startTime="2649">And so the things </span><span class="line" data-startTime="2649">that we can do here </span><span class="line" data-startTime="2651">to make a difference </span><span class="line" data-startTime="2651">I think would go a long way. </span></p>

<p><span class="line" data-startTime="2653">I think WebKit is fortunately </span><span class="line" data-startTime="2653">getting to the point now </span><span class="line" data-startTime="2656">where it's &mdash; </span><span class="line" data-startTime="2657">you know, it's approaching </span><span class="line" data-startTime="2657">10% market share </span><span class="line" data-startTime="2660">if you add up all the browser, </span><span class="line" data-startTime="2660">mobile included, </span><span class="line" data-startTime="2662">that embed WebKit. </span> <span class="line" data-startTime="2664">And so once &mdash; </span><span class="line" data-startTime="2664">my experience with Firefox </span><span class="line" data-startTime="2667">tells me that, you know, </span><span class="line" data-startTime="2667">once you get to that 10% point, </span><span class="line" data-startTime="2670">that's when people </span><span class="line" data-startTime="2670">don't have a choice but to care. </span> <span class="line" data-startTime="2673">Because if one out of ten </span><span class="line" data-startTime="2673">users to their website </span><span class="line" data-startTime="2676">can't view their website </span><span class="line" data-startTime="2678">or can't purchase something </span><span class="line" data-startTime="2678">off of their site, </span><span class="line" data-startTime="2681">well, then they'll feel that </span><span class="line" data-startTime="2683">in a financial manner </span><span class="line" data-startTime="2683">at least. </span> <span class="line" data-startTime="2685">And so the hope is that </span><span class="line" data-startTime="2685">once you reach that threshold, </span><span class="line" data-startTime="2688">suddenly it'll be </span><span class="line" data-startTime="2688">a snowball effect </span><span class="line" data-startTime="2689">and people will care </span><span class="line" data-startTime="2689">and people will &mdash; </span><span class="line" data-startTime="2691">and compatibility problems </span><span class="line" data-startTime="2691">will disappear faster. </span></p>

<p><span class="line" data-startTime="2696">And of course we continue </span><span class="line" data-startTime="2696">to be very interested </span><span class="line" data-startTime="2698">in how we can </span><span class="line" data-startTime="2698">improve performance. </span> <span class="line" data-startTime="2700">Performance is &mdash; </span><span class="line" data-startTime="2702">Speed is important </span><span class="line" data-startTime="2703">to the whole essence </span><span class="line" data-startTime="2703">of Chrome. </span> <span class="line" data-startTime="2707">Open web platform. </span> <span class="line" data-startTime="2708">Just a few </span><span class="line" data-startTime="2708">more notes about that, </span><span class="line" data-startTime="2709">some of the things </span><span class="line" data-startTime="2709">that are in progress. </span> <span class="line" data-startTime="2711">Audio/video, well, </span><span class="line" data-startTime="2711">you saw the recent release. </span> <span class="line" data-startTime="2714">And we're very excited </span><span class="line" data-startTime="2714">about that. </span> <span class="line" data-startTime="2717">There's lots more </span><span class="line" data-startTime="2717">that can be done </span><span class="line" data-startTime="2719">to improve HTML 5 </span><span class="line" data-startTime="2719">video support in Chrome. </span></p>

<p><span class="line" data-startTime="2722">So we'll be working on that. </span> <span class="line" data-startTime="2723">Application cache, </span><span class="line" data-startTime="2723">database, </span><span class="line" data-startTime="2725">local storage, </span><span class="line" data-startTime="2725">session storage. </span> <span class="line" data-startTime="2726">These are all features about </span><span class="line" data-startTime="2726">enabling offline applications. </span> <span class="line" data-startTime="2729">So very excited to adopt </span><span class="line" data-startTime="2729">the same APIs </span><span class="line" data-startTime="2732">as all the other </span><span class="line" data-startTime="2732">major browsers. </span> <span class="line" data-startTime="2735">Some of these things are </span><span class="line" data-startTime="2735">already enabled in WebKit. </span> <span class="line" data-startTime="2736">So you might say, </span><span class="line" data-startTime="2738">"Well, how come Chrome </span><span class="line" data-startTime="2738">doesn't have them already? </span><span class="line" data-startTime="2739">Safari 4 has it." </span><span class="line" data-startTime="2741">And, you know, </span><span class="line" data-startTime="2741">it turns out </span><span class="line" data-startTime="2743">that when you throw a sandbox </span><span class="line" data-startTime="2743">around a rendering engine </span><span class="line" data-startTime="2745">and you divide it up </span><span class="line" data-startTime="2745">into multiple processes, </span><span class="line" data-startTime="2747">that some of these things </span><span class="line" data-startTime="2747">become much more complicated </span><span class="line" data-startTime="2750">to support. </span> <span class="line" data-startTime="2752">What do these have in common? </span><span class="line" data-startTime="2753">Well, application cache, </span><span class="line" data-startTime="2753">database, local storage, </span><span class="line" data-startTime="2756">they're all touching </span><span class="line" data-startTime="2756">the disk. </span> <span class="line" data-startTime="2757">So there's file system access. </span></p>

<p><span class="line" data-startTime="2759">File system access </span><span class="line" data-startTime="2759">that needs to be proxied </span><span class="line" data-startTime="2761">or managed in some way </span><span class="line" data-startTime="2763">so that these </span><span class="line" data-startTime="2763">rendering processes </span><span class="line" data-startTime="2765">can securely access </span><span class="line" data-startTime="2765">these APIs. </span> <span class="line" data-startTime="2768">So these are all </span><span class="line" data-startTime="2768">in development. </span> <span class="line" data-startTime="2771">And the way we tend to develop </span><span class="line" data-startTime="2771">new features in Chrome </span><span class="line" data-startTime="2774">is that we put them </span><span class="line" data-startTime="2774">into the main line </span><span class="line" data-startTime="2777">but behind a command line flag </span><span class="line" data-startTime="2779">so that they're not </span><span class="line" data-startTime="2779">actually enabled by default </span><span class="line" data-startTime="2781">until they're ready. </span></p>

<p><span class="line" data-startTime="2783">But by having them </span><span class="line" data-startTime="2783">in the main line, </span><span class="line" data-startTime="2784">it means that as Dev Channel </span><span class="line" data-startTime="2784">releases go out, </span><span class="line" data-startTime="2786">Beta channel releases go out, </span><span class="line" data-startTime="2788">or stable pushes even happen, </span><span class="line" data-startTime="2788">these features are there, </span><span class="line" data-startTime="2791">and people who are interested </span><span class="line" data-startTime="2793">can set </span><span class="line" data-startTime="2793">the command line option </span><span class="line" data-startTime="2795">to turn it on to try it out </span><span class="line" data-startTime="2795">to give us feedback. </span> <span class="line" data-startTime="2797">So we don't have </span><span class="line" data-startTime="2797">to require people </span><span class="line" data-startTime="2798">to do custom builds in order </span><span class="line" data-startTime="2798">to try out new features </span><span class="line" data-startTime="2801">and give us feedback. </span> <span class="line" data-startTime="2802">They can just take </span><span class="line" data-startTime="2802">the standard build, </span><span class="line" data-startTime="2804">try it out, </span><span class="line" data-startTime="2804">give us feedback. </span> <span class="line" data-startTime="2805">And this is huge for supporting </span><span class="line" data-startTime="2805">a community of testers. </span> <span class="line" data-startTime="2810">Notifications </span><span class="line" data-startTime="2810">is a new thing </span><span class="line" data-startTime="2812">that has a lot of interest. </span></p>

<p><span class="line" data-startTime="2814">It's all about trying </span><span class="line" data-startTime="2814">to make it possible </span><span class="line" data-startTime="2817">for web applications </span><span class="line" data-startTime="2817">to do better notifications </span><span class="line" data-startTime="2820">to the user, </span><span class="line" data-startTime="2820">better than window.alert. </span> <span class="line" data-startTime="2824">Window.alert </span><span class="line" data-startTime="2824">is very, you know, </span><span class="line" data-startTime="2826">a very unfortunate API. </span> <span class="line" data-startTime="2828">It sure would be nice </span><span class="line" data-startTime="2828">if Calendar could have </span><span class="line" data-startTime="2830">a less annoying, </span><span class="line" data-startTime="2830">a less obtrusive way </span><span class="line" data-startTime="2832">of notifying the user that </span><span class="line" data-startTime="2832">there is a meeting coming up, </span><span class="line" data-startTime="2835">but a notification </span><span class="line" data-startTime="2835">that is still effective </span><span class="line" data-startTime="2837">at getting your attention. </span> <span class="line" data-startTime="2840">So that's the kind of stuff </span><span class="line" data-startTime="2840">that we're working on. </span> <span class="line" data-startTime="2843">And of course web workers </span><span class="line" data-startTime="2843">I talked about before. </span> <span class="line" data-startTime="2845">There's this idea </span><span class="line" data-startTime="2845">of shared workers, </span><span class="line" data-startTime="2847">which is really interesting </span><span class="line" data-startTime="2847">that's still being worked out, </span><span class="line" data-startTime="2849">details are being worked out, </span><span class="line" data-startTime="2849">but sure would be &mdash; </span><span class="line" data-startTime="2852">It would be very powerful </span><span class="line" data-startTime="2852">if you could have a worker </span><span class="line" data-startTime="2855">that lives on beyond &mdash; </span><span class="line" data-startTime="2858">Well, I should back up </span><span class="line" data-startTime="2858">and make sure everybody's </span><span class="line" data-startTime="2860">familiar with workers. </span></p>

<p><span class="line" data-startTime="2861">This is the idea </span><span class="line" data-startTime="2861">of background threads </span><span class="line" data-startTime="2863">where you can run </span><span class="line" data-startTime="2863">JavaScript on. </span> <span class="line" data-startTime="2865">A dedicated worker </span><span class="line" data-startTime="2865">is one that a web page </span><span class="line" data-startTime="2868">just creates for itself. </span> <span class="line" data-startTime="2869">So it wants </span><span class="line" data-startTime="2869">a background thread, </span><span class="line" data-startTime="2870">he can create </span><span class="line" data-startTime="2870">a dedicated worker. </span> <span class="line" data-startTime="2872">When the page goes away, </span><span class="line" data-startTime="2872">the dedicated worker goes away. </span> <span class="line" data-startTime="2874">Persistent workers. </span> <span class="line" data-startTime="2875">Well, there the worker </span><span class="line" data-startTime="2875">can live on a little longer. </span> <span class="line" data-startTime="2878">But shared workers are kind of </span><span class="line" data-startTime="2878">like persistent workers, </span><span class="line" data-startTime="2881">but different </span><span class="line" data-startTime="2881">in that they have a name. </span> <span class="line" data-startTime="2884">And you can find them lazily. </span> <span class="line" data-startTime="2886">You can find them </span><span class="line" data-startTime="2886">and connect to them. </span></p>

<p><span class="line" data-startTime="2888">And so it could give </span><span class="line" data-startTime="2888">web applications </span><span class="line" data-startTime="2890">a very powerful way </span><span class="line" data-startTime="2890">to have a context, </span><span class="line" data-startTime="2892">a JavaScript context </span><span class="line" data-startTime="2893">that's hidden </span><span class="line" data-startTime="2893">and off to the side </span><span class="line" data-startTime="2895">that they can </span><span class="line" data-startTime="2895">later connect to. </span> <span class="line" data-startTime="2897">So you can imagine </span><span class="line" data-startTime="2897">a web application </span><span class="line" data-startTime="2899">might run a portion </span><span class="line" data-startTime="2899">of its back end there </span><span class="line" data-startTime="2902">in a shared worker </span><span class="line" data-startTime="2904">and let the actual web pages </span><span class="line" data-startTime="2904">just be front ends </span><span class="line" data-startTime="2907">that render the data that </span><span class="line" data-startTime="2907">that shared worker manages. </span> <span class="line" data-startTime="2910">There's a lot of really </span><span class="line" data-startTime="2910">interesting ideas in HTML 5 </span><span class="line" data-startTime="2914">and an open web platform </span><span class="line" data-startTime="2915">that we're very excited </span><span class="line" data-startTime="2915">to be implementing. </span> <span class="line" data-startTime="2920">So I just want to briefly </span><span class="line" data-startTime="2920">talk about the network stack </span><span class="line" data-startTime="2922">since I mentioned before </span><span class="line" data-startTime="2924">that that's </span><span class="line" data-startTime="2924">a very important element </span><span class="line" data-startTime="2926">of browser architecture. </span></p>

<p><span class="line" data-startTime="2928">Making a better wheel. </span> <span class="line" data-startTime="2930">So one wonders, </span><span class="line" data-startTime="2932">why go and invent </span><span class="line" data-startTime="2932">another networking stack? </span><span class="line" data-startTime="2935">There's so many out there. </span> <span class="line" data-startTime="2937">Indeed, when we first </span><span class="line" data-startTime="2937">started the project, </span><span class="line" data-startTime="2939">we thought, well, </span><span class="line" data-startTime="2939">let's not do this &mdash; </span><span class="line" data-startTime="2940">let's not write this code </span><span class="line" data-startTime="2940">if we don't have to. </span> <span class="line" data-startTime="2943">In fact, can't we just use </span><span class="line" data-startTime="2943">the networking stacks </span><span class="line" data-startTime="2946">that ship with </span><span class="line" data-startTime="2946">the various operating systems </span><span class="line" data-startTime="2948">that we wish to target? </span><span class="line" data-startTime="2950">So on Windows, </span><span class="line" data-startTime="2950">the natural choice </span><span class="line" data-startTime="2951">was probably Wininet. </span> <span class="line" data-startTime="2952">That's the networking stack </span><span class="line" data-startTime="2954">under the hood </span><span class="line" data-startTime="2954">of Internet Explorer. </span></p>

<p><span class="line" data-startTime="2955">And there's an API to that </span><span class="line" data-startTime="2955">that's well established, </span><span class="line" data-startTime="2958">and, well, let's use that. </span> <span class="line" data-startTime="2960">And we started </span><span class="line" data-startTime="2960">down that path. </span> <span class="line" data-startTime="2962">And interestingly enough, </span><span class="line" data-startTime="2962">we learned that </span><span class="line" data-startTime="2965">we really needed </span><span class="line" data-startTime="2965">to have control </span><span class="line" data-startTime="2967">over our own web cache </span><span class="line" data-startTime="2967">and our own cookie store. </span> <span class="line" data-startTime="2970">Okay, so Wininet, </span><span class="line" data-startTime="2970">you tell it, </span><span class="line" data-startTime="2971">"Don't use your cookies. </span> <span class="line" data-startTime="2971">We'll supply our own." </span><span class="line" data-startTime="2974">Turning off the cache though </span><span class="line" data-startTime="2976">turned out to be </span><span class="line" data-startTime="2976">kind of difficult. </span> <span class="line" data-startTime="2977">Well, we wanted to be able </span><span class="line" data-startTime="2977">to turn off the cache </span><span class="line" data-startTime="2980">because we needed to be able </span><span class="line" data-startTime="2980">to support incognito mode. </span> <span class="line" data-startTime="2982">We didn't want it to be able </span><span class="line" data-startTime="2982">to turn off the cache </span><span class="line" data-startTime="2984">because if the cache </span><span class="line" data-startTime="2984">contained data </span><span class="line" data-startTime="2987">that was fetched </span><span class="line" data-startTime="2987">by Internet Explorer, </span><span class="line" data-startTime="2989">then it might be data </span><span class="line" data-startTime="2989">specific to Internet Explorer's </span><span class="line" data-startTime="2991">user agent string. </span></p>

<p><span class="line" data-startTime="2993">And so that </span><span class="line" data-startTime="2993">could be a problem. </span> <span class="line" data-startTime="2995">So we really are in </span><span class="line" data-startTime="2995">a situation </span><span class="line" data-startTime="2997">where we have to manage </span><span class="line" data-startTime="2997">our own cache. </span> <span class="line" data-startTime="3000">And it turns out </span><span class="line" data-startTime="3000">that there was no way </span><span class="line" data-startTime="3001">to tell Wininet, </span><span class="line" data-startTime="3001">"Hey, look, </span><span class="line" data-startTime="3003">I don't want you to supply </span><span class="line" data-startTime="3003">data from your cache." </span><span class="line" data-startTime="3007">And so we then switched </span><span class="line" data-startTime="3007">to Winhttp, </span><span class="line" data-startTime="3009">which is another library </span><span class="line" data-startTime="3009">that Microsoft ships </span><span class="line" data-startTime="3011">that just provides </span><span class="line" data-startTime="3011">the HTTP layer. </span> <span class="line" data-startTime="3014">You bring your own cache. </span> <span class="line" data-startTime="3014">You bring your own cookies. </span> <span class="line" data-startTime="3015">Okay, that sounds great. </span> <span class="line" data-startTime="3018">And that's actually what </span><span class="line" data-startTime="3018">we shipped with in Chrome 1. </span></p>

<p><span class="line" data-startTime="3021">But, you know, </span><span class="line" data-startTime="3021">we recognized that there's &mdash; </span><span class="line" data-startTime="3024">we were missing opportunities </span><span class="line" data-startTime="3024">to improve performance, </span><span class="line" data-startTime="3026">missing opportunities </span><span class="line" data-startTime="3026">to improve this layer </span><span class="line" data-startTime="3031">and even to fix </span><span class="line" data-startTime="3031">certain bugs. </span> <span class="line" data-startTime="3034">And so we set about </span><span class="line" data-startTime="3034">developing our own library, </span><span class="line" data-startTime="3037">and that now lives </span><span class="line" data-startTime="3037">in src/net/http/ </span><span class="line" data-startTime="3039">in the Chromium code base. </span> <span class="line" data-startTime="3042">And that's what shipped </span><span class="line" data-startTime="3042">in Chrome 2. </span> <span class="line" data-startTime="3045">So DNS prefetching is something </span><span class="line" data-startTime="3045">we shipped in Chrome 1, </span><span class="line" data-startTime="3047">you've probably heard about, </span><span class="line" data-startTime="3047">which is all about predicting </span><span class="line" data-startTime="3051">which host names </span><span class="line" data-startTime="3051">you might visit </span><span class="line" data-startTime="3054">so that we can get </span><span class="line" data-startTime="3054">the DNS results started earlier. </span> <span class="line" data-startTime="3056">This has a very measurable </span><span class="line" data-startTime="3056">impact on performance. </span> <span class="line" data-startTime="3060">And we've been spending </span><span class="line" data-startTime="3060">a lot of energy &mdash; </span><span class="line" data-startTime="3063">You know, whenever anybody </span><span class="line" data-startTime="3063">checks the little thing, </span><span class="line" data-startTime="3065">helps supply anonymous </span><span class="line" data-startTime="3065">usage data to Google </span><span class="line" data-startTime="3067">to make Google Chrome better, </span><span class="line" data-startTime="3070">that anonymous data </span><span class="line" data-startTime="3070">is used to help support </span><span class="line" data-startTime="3074">tailoring these kinds </span><span class="line" data-startTime="3074">of algorithms, </span><span class="line" data-startTime="3076">understanding </span><span class="line" data-startTime="3076">when this is working, </span><span class="line" data-startTime="3077">when it's not working, </span><span class="line" data-startTime="3079">and various other aspects </span><span class="line" data-startTime="3079">of Chrome as well. </span></p>

<p><span class="line" data-startTime="3082">So in development, </span><span class="line" data-startTime="3082">there's lots of things </span><span class="line" data-startTime="3084">still to be done </span><span class="line" data-startTime="3084">for the new network stack &mdash; </span><span class="line" data-startTime="3085">feature parity. </span> <span class="line" data-startTime="3087">And there's things missing </span><span class="line" data-startTime="3087">like sock support, </span><span class="line" data-startTime="3088">IPv6 literals. </span> <span class="line" data-startTime="3090">Regular IPv6, </span><span class="line" data-startTime="3090">if a host name results, </span><span class="line" data-startTime="3092">IPv6 would work fine, </span><span class="line" data-startTime="3093">but if you actually use </span><span class="line" data-startTime="3093">an IPv6 literal, </span><span class="line" data-startTime="3095">there's some little, </span><span class="line" data-startTime="3095">subtle bugs. </span> <span class="line" data-startTime="3097">We're working out </span><span class="line" data-startTime="3097">all those kinks </span><span class="line" data-startTime="3098">or things that are happening </span><span class="line" data-startTime="3098">for future releases. </span> <span class="line" data-startTime="3102">Other cool new features </span><span class="line" data-startTime="3102">that might help &mdash; </span><span class="line" data-startTime="3104">that will have a big impact </span><span class="line" data-startTime="3104">on performance. </span> <span class="line" data-startTime="3106">Sparse caching. </span></p>

<p><span class="line" data-startTime="3107">So video support </span><span class="line" data-startTime="3107">really demands the idea </span><span class="line" data-startTime="3110">that you should be able </span><span class="line" data-startTime="3110">to advance the movie </span><span class="line" data-startTime="3112">to a certain location </span><span class="line" data-startTime="3113">and start downloading </span><span class="line" data-startTime="3113">from there </span><span class="line" data-startTime="3115">and cache all that data. </span> <span class="line" data-startTime="3116">Well, we want to still </span><span class="line" data-startTime="3116">be able to jump back </span><span class="line" data-startTime="3118">to the old location </span><span class="line" data-startTime="3118">and hit the cache again. </span> <span class="line" data-startTime="3120">Sparse caching is gonna help </span><span class="line" data-startTime="3120">with this a lot. </span> <span class="line" data-startTime="3124">This will also improve the way </span><span class="line" data-startTime="3124">Acrobat Reader runs </span><span class="line" data-startTime="3126">inside of Chrome, </span><span class="line" data-startTime="3126">because Acrobat Reader, </span><span class="line" data-startTime="3128">when you advance to a page, </span><span class="line" data-startTime="3128">like the 27th page, </span><span class="line" data-startTime="3131">Acrobat Reader </span><span class="line" data-startTime="3131">will ask the browser, </span><span class="line" data-startTime="3133">"Please fetch me the data </span><span class="line" data-startTime="3133">at this range." </span><span class="line" data-startTime="3135">And so we want to be able </span><span class="line" data-startTime="3135">to cache that. </span> <span class="line" data-startTime="3137">Other browsers don't cache </span><span class="line" data-startTime="3137">the ranges like that </span><span class="line" data-startTime="3140">because managing </span><span class="line" data-startTime="3140">a sparse cache </span><span class="line" data-startTime="3141">is actually </span><span class="line" data-startTime="3141">pretty complicated. </span></p>

<p><span class="line" data-startTime="3144">There's a bunch of other ideas </span><span class="line" data-startTime="3144">we have that we're brewing </span><span class="line" data-startTime="3146">and trying to actually </span><span class="line" data-startTime="3146">test out. </span> <span class="line" data-startTime="3149">Looking at ways </span><span class="line" data-startTime="3149">that we can actually employ </span><span class="line" data-startTime="3150">HTTP pipelining </span><span class="line" data-startTime="3150">in a manner that's safe. </span> <span class="line" data-startTime="3152">Looking at ways </span><span class="line" data-startTime="3152">that we can improve </span><span class="line" data-startTime="3154">the establishment </span><span class="line" data-startTime="3154">of TCP connections, </span><span class="line" data-startTime="3156">'cause these are &mdash; </span><span class="line" data-startTime="3157">TCP connection establishment </span><span class="line" data-startTime="3157">is a point at which </span><span class="line" data-startTime="3160">you can really lose </span><span class="line" data-startTime="3160">a lot of time. </span> <span class="line" data-startTime="3162">And if anything you can do </span><span class="line" data-startTime="3162">to kinda like hide that time </span><span class="line" data-startTime="3165">or avoid paying that cost, </span><span class="line" data-startTime="3165">you know, when the user </span><span class="line" data-startTime="3168">actually tries to go somewhere </span><span class="line" data-startTime="3168">would be beneficial. </span> <span class="line" data-startTime="3170">But of course </span><span class="line" data-startTime="3170">we have to be very careful </span><span class="line" data-startTime="3172">not to put too much burden </span><span class="line" data-startTime="3172">on servers and things like that. </span> <span class="line" data-startTime="3175">So parallel proxy auto-config. </span> <span class="line" data-startTime="3179">Well, if you're ever using </span><span class="line" data-startTime="3179">proxy auto-config, </span><span class="line" data-startTime="3182">you know that performance </span><span class="line" data-startTime="3182">can be a real problem with it. </span></p>

<p><span class="line" data-startTime="3184">And so all of us at Google </span><span class="line" data-startTime="3184">use a proxy auto-config, </span><span class="line" data-startTime="3187">and so we feel this pain </span><span class="line" data-startTime="3187">every day, </span><span class="line" data-startTime="3189">and so we really want </span><span class="line" data-startTime="3189">to do something about it. </span> <span class="line" data-startTime="3190">And hopefully it benefits </span><span class="line" data-startTime="3190">other people as well. </span> <span class="line" data-startTime="3194">And that's it. </span> <span class="line" data-startTime="3195">I want to open </span><span class="line" data-startTime="3195">the floor to questions. </span> <span class="line" data-startTime="3198">And let me know </span><span class="line" data-startTime="3198">what you're interested in. </span> <span class="line" data-startTime="3203">man: Hi. </span> <span class="line" data-startTime="3205">As a script developer </span><span class="line" data-startTime="3205">in JavaScript, </span><span class="line" data-startTime="3208">I'm not that familiar </span><span class="line" data-startTime="3208">with the Chrome yet. </span> <span class="line" data-startTime="3211">When I write </span><span class="line" data-startTime="3211">an XML HTTP request, </span><span class="line" data-startTime="3214">I can do it synchronous </span><span class="line" data-startTime="3214">or asynchronous. </span> <span class="line" data-startTime="3216">And the synchronous </span><span class="line" data-startTime="3216">is usually blocking </span><span class="line" data-startTime="3218">based on IE. </span> <span class="line" data-startTime="3220">The new Firefox, I realized, </span><span class="line" data-startTime="3220">it's non-blocking. </span> <span class="line" data-startTime="3224">Is it the same with Chrome? </span><span class="line" data-startTime="3226">Fisher: </span><span class="line" data-startTime="3226">So it turns out that </span><span class="line" data-startTime="3227">that's a very interesting </span><span class="line" data-startTime="3227">thing you mentioned. </span> <span class="line" data-startTime="3229">I'm actually the developer </span><span class="line" data-startTime="3229">who implemented </span><span class="line" data-startTime="3231">Firefox's behavior. </span> <span class="line" data-startTime="3233">And I kind of regret it, </span><span class="line" data-startTime="3233">and I'll explain why. </span> <span class="line" data-startTime="3236">Because JavaScript </span><span class="line" data-startTime="3236">has the assumption </span><span class="line" data-startTime="3239">of run to completion, </span><span class="line" data-startTime="3239">being single-threaded. </span></p>

<p><span class="line" data-startTime="3241">But if you &mdash; </span><span class="line" data-startTime="3243">If JavaScript blocks on </span><span class="line" data-startTime="3243">XML HTTP requests </span><span class="line" data-startTime="3246">to do a synchronous network IO, </span><span class="line" data-startTime="3249">it still looks like </span><span class="line" data-startTime="3249">a function call to JavaScript. </span> <span class="line" data-startTime="3251">And if you interrupt </span><span class="line" data-startTime="3251">that function call </span><span class="line" data-startTime="3253">with, like, running </span><span class="line" data-startTime="3253">another JavaScript &mdash; </span><span class="line" data-startTime="3256">some other thread </span><span class="line" data-startTime="3256">of JavaScript somewhere &mdash; </span><span class="line" data-startTime="3258">I mean, it's all </span><span class="line" data-startTime="3258">on the same real thread, </span><span class="line" data-startTime="3260">but to the programmer it looks </span><span class="line" data-startTime="3260">like somehow JavaScript, </span><span class="line" data-startTime="3262">in another context, </span><span class="line" data-startTime="3262">was running </span><span class="line" data-startTime="3264">in the middle </span><span class="line" data-startTime="3264">of this function call. </span> <span class="line" data-startTime="3266">And so it breaks </span><span class="line" data-startTime="3266">the run to completion behavior </span><span class="line" data-startTime="3268">that you come to expect. </span> <span class="line" data-startTime="3270">And so really I worry that </span><span class="line" data-startTime="3270">the Firefox implementation &mdash; </span><span class="line" data-startTime="3275">You know, I was a fan of it </span><span class="line" data-startTime="3275">at the time, </span><span class="line" data-startTime="3278">because it frees the UI </span><span class="line" data-startTime="3278">from being locked up. </span> <span class="line" data-startTime="3282">But I worry </span><span class="line" data-startTime="3282">that it would result </span><span class="line" data-startTime="3284">in some very strange bugs </span><span class="line" data-startTime="3284">for web developers, </span><span class="line" data-startTime="3287">because when </span><span class="line" data-startTime="3287">they expect their program </span><span class="line" data-startTime="3289">to just run </span><span class="line" data-startTime="3289">like a sequential program, </span><span class="line" data-startTime="3291">it's suddenly not. </span></p>

<p><span class="line" data-startTime="3293">And so it is </span><span class="line" data-startTime="3293">a very big concern to me. </span> <span class="line" data-startTime="3296">In Chrome, </span><span class="line" data-startTime="3296">we took the approach of, </span><span class="line" data-startTime="3298">well, the rendering engine </span><span class="line" data-startTime="3298">is a child process, </span><span class="line" data-startTime="3301">and we have a bitmap </span><span class="line" data-startTime="3302">of the recent </span><span class="line" data-startTime="3302">representation of it. </span> <span class="line" data-startTime="3304">So when the web page says </span><span class="line" data-startTime="3306">XML HTTP request send, </span><span class="line" data-startTime="3306">in a synchronous manner, </span><span class="line" data-startTime="3309">we just let that process </span><span class="line" data-startTime="3309">suspend itself. </span> <span class="line" data-startTime="3312">And during that IO time, </span><span class="line" data-startTime="3313">we show the old representation </span><span class="line" data-startTime="3313">of the page. </span> <span class="line" data-startTime="3316">Of course the page is not </span><span class="line" data-startTime="3316">interactive at this time. </span> <span class="line" data-startTime="3319">But I feel like that's </span><span class="line" data-startTime="3319">probably the right way </span><span class="line" data-startTime="3322">for it to behave. </span></p>

<p><span class="line" data-startTime="3323">And basically my belief </span><span class="line" data-startTime="3323">is that synchronous XHR </span><span class="line" data-startTime="3327">is really a pretty evil API. </span> <span class="line" data-startTime="3329">It's not one that works well </span><span class="line" data-startTime="3329">with the web. </span> <span class="line" data-startTime="3331">The web is asynchronous. </span> <span class="line" data-startTime="3332">Asynchronous APIs </span><span class="line" data-startTime="3332">work much more naturally </span><span class="line" data-startTime="3334">in a browser environment. </span> <span class="line" data-startTime="3337">So &mdash; So that's &mdash; </span><span class="line" data-startTime="3339">I can imagine Chrome </span><span class="line" data-startTime="3339">doing smarter things though </span><span class="line" data-startTime="3341">in the future. </span> <span class="line" data-startTime="3342">Like, for example, </span><span class="line" data-startTime="3342">giving the user some UI </span><span class="line" data-startTime="3344">so that they could interrupt </span><span class="line" data-startTime="3344">a synchronous XHR </span><span class="line" data-startTime="3346">that's taking too long. </span></p>

<p><span class="line" data-startTime="3348">Today, the only way </span><span class="line" data-startTime="3348">to interrupt </span><span class="line" data-startTime="3350">a synchronous XHR in Chrome </span><span class="line" data-startTime="3350">that's taking too long </span><span class="line" data-startTime="3351">is to close the tab. </span> <span class="line" data-startTime="3353">Close the tab, </span><span class="line" data-startTime="3353">you kill the process. </span> <span class="line" data-startTime="3355">But if you could interrupt it </span><span class="line" data-startTime="3356">and return control </span><span class="line" data-startTime="3356">to a JavaScript with an error, </span><span class="line" data-startTime="3358">that seems like it'd be better. </span> <span class="line" data-startTime="3362">Any other questions? </span><span class="line" data-startTime="3365">man: You know, </span><span class="line" data-startTime="3365">I almost want to encourage you </span><span class="line" data-startTime="3366">to do some alternative </span><span class="line" data-startTime="3366">to NPAPI. </span></p>

<p><span class="line" data-startTime="3369">I've struggled </span><span class="line" data-startTime="3369">with trying to port across </span><span class="line" data-startTime="3372">the different browsers </span><span class="line" data-startTime="3372">on PGP. </span> <span class="line" data-startTime="3375">And we've been trying </span><span class="line" data-startTime="3375">to do something </span><span class="line" data-startTime="3377">to look at secure text, </span><span class="line" data-startTime="3377">encrypted text, encrypted &mdash; </span><span class="line" data-startTime="3382">you know, like an embedded </span><span class="line" data-startTime="3382">encrypted content </span><span class="line" data-startTime="3384">and display it. </span> <span class="line" data-startTime="3386">And it's just &mdash; </span><span class="line" data-startTime="3386">it's really difficult </span><span class="line" data-startTime="3388">to go across </span><span class="line" data-startTime="3388">the different browsers. </span> <span class="line" data-startTime="3390">There's a lot </span><span class="line" data-startTime="3390">of little fallbacks. </span> <span class="line" data-startTime="3391">NPAPI &mdash; Well, put it this way. </span> <span class="line" data-startTime="3393">If you're gonna do it, </span><span class="line" data-startTime="3393">could you, like, at least </span><span class="line" data-startTime="3394">put out some sample code, </span><span class="line" data-startTime="3394">one that compiles </span><span class="line" data-startTime="3397">and actually works </span><span class="line" data-startTime="3397">in the different browsers </span><span class="line" data-startTime="3398">and does something &mdash; </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="3400"><span class="speakerName">Darin Fisher</span>: I agree with you. </span><span class="line" data-startTime="3401">NPAPI is really the bane </span><span class="line" data-startTime="3402">of developers </span><span class="line" data-startTime="3402">who have to deal with it. </span><span class="line" data-startTime="3405">I wish there was </span><span class="line" data-startTime="3405">something better as well. </span><span class="line" data-startTime="3407">man: Well, I mean, </span><span class="line" data-startTime="3407">even the Safari &mdash; </span><span class="line" data-startTime="3409">The Safari, you know, </span><span class="line" data-startTime="3409">WebKit plug-in thing is way &mdash; </span><span class="line" data-startTime="3413">at least that works </span><span class="line" data-startTime="3413">on Safari. </span><span class="line" data-startTime="3415">Maybe leverage some of that. </span></p>

<p class="speaker"><span class="line" data-starttime="3416"><span class="speakerName">Darin Fisher</span>: Yeah, </span><span class="line" data-startTime="3416">I'm very interested </span><span class="line" data-startTime="3418">in a better solution </span><span class="line" data-startTime="3420">and one that is well documented </span><span class="line" data-startTime="3420">and full of samples </span><span class="line" data-startTime="3422">that actually make sense. </span><span class="line" data-startTime="3424">Next question. </span><span class="line" data-startTime="3426">man: I have a question </span><span class="line" data-startTime="3426">about your strategy </span><span class="line" data-startTime="3427">for increasing compatibility, </span><span class="line" data-startTime="3430">like, with the rendering </span><span class="line" data-startTime="3430">in Safari. </span><span class="line" data-startTime="3431">It seems like, in Safari, </span><span class="line" data-startTime="3433">when they're about </span><span class="line" data-startTime="3433">to make a release, </span><span class="line" data-startTime="3434">they do, like, </span><span class="line" data-startTime="3434">a WebKit tag, </span><span class="line" data-startTime="3436">and then maybe they commit </span><span class="line" data-startTime="3436">into that tag. </span><span class="line" data-startTime="3438">What do you do to, like, </span><span class="line" data-startTime="3438">ensure that your &mdash; </span><span class="line" data-startTime="3441">whatever you do for a release </span><span class="line" data-startTime="3443">is compatible </span><span class="line" data-startTime="3443">with their rendering? </span></p>

<p class="speaker"><span class="line" data-starttime="3447"><span class="speakerName">Darin Fisher</span>: If I understood </span><span class="line" data-startTime="3447">the question right, </span><span class="line" data-startTime="3449">you're saying what happens </span><span class="line" data-startTime="3449">if, like, </span><span class="line" data-startTime="3450">a new tag is introduced </span><span class="line" data-startTime="3450">that's sort of half-baked? </span><span class="line" data-startTime="3453">man: </span><span class="line" data-startTime="3453">Or what do you do, like &mdash; </span><span class="line" data-startTime="3455">I guess what's your strategy </span><span class="line" data-startTime="3455">before &mdash; </span><span class="line" data-startTime="3457">When you're deciding on, </span><span class="line" data-startTime="3457">you know, where to &mdash; </span><span class="line" data-startTime="3460">what revision to go off of. </span></p>

<p class="speaker"><span class="line" data-starttime="3462"><span class="speakerName">Darin Fisher</span>: Yes. </span> <span class="line" data-startTime="3463">Okay, yeah, so it's </span><span class="line" data-startTime="3463">a very tough question. </span> <span class="line" data-startTime="3465">Like, because we are trying </span><span class="line" data-startTime="3465">to release early release often </span><span class="line" data-startTime="3468">and not just be beholden </span><span class="line" data-startTime="3471">to when Apple decides </span><span class="line" data-startTime="3471">to launch WebKit, </span><span class="line" data-startTime="3473">it does mean </span><span class="line" data-startTime="3473">that we potentially pick up </span><span class="line" data-startTime="3475">half-baked APIs, </span><span class="line" data-startTime="3475">half-baked things. </span> <span class="line" data-startTime="3477">But fortunately the way </span><span class="line" data-startTime="3477">WebKit community tends to work </span><span class="line" data-startTime="3479">is that they hide those things </span><span class="line" data-startTime="3479">behind a pound define. </span> <span class="line" data-startTime="3481">And so it's up to us </span><span class="line" data-startTime="3481">to decide when to add </span><span class="line" data-startTime="3483">that pound define </span><span class="line" data-startTime="3483">so that it's compiled in. </span> <span class="line" data-startTime="3486">And that's basically </span><span class="line" data-startTime="3486">been our approach. </span> <span class="line" data-startTime="3489">So we don't expose them </span><span class="line" data-startTime="3489">until we're ready. </span> <span class="line" data-startTime="3494">man: I was curious </span><span class="line" data-startTime="3494">a little bit more </span><span class="line" data-startTime="3495">about the sandboxing. </span></p>

<p><span class="line" data-startTime="3497">You were saying in Windows </span><span class="line" data-startTime="3498">it kind of strips </span><span class="line" data-startTime="3498">the credentials away from it, </span><span class="line" data-startTime="3500">and I was curious </span><span class="line" data-startTime="3500">about other operating systems, </span><span class="line" data-startTime="3502">if you're like &mdash; </span><span class="line" data-startTime="3502">if it would be more of, like, </span><span class="line" data-startTime="3504">a memory bounds checking </span><span class="line" data-startTime="3504">at the code level </span><span class="line" data-startTime="3506">or if you're familiar </span><span class="line" data-startTime="3506">with, like, Valgrind, </span><span class="line" data-startTime="3508">which is, like, object code. </span> <span class="line" data-startTime="3510">Like, how would you </span><span class="line" data-startTime="3510">be implementing that? </span><span class="line" data-startTime="3512">Fisher: </span><span class="line" data-startTime="3512">There's a lot of &mdash; </span><span class="line" data-startTime="3514">a lot of crazy ideas, </span><span class="line" data-startTime="3514">you know, afoot </span><span class="line" data-startTime="3516">for how to sandbox </span><span class="line" data-startTime="3516">on Linux. </span> <span class="line" data-startTime="3518">You have a lot </span><span class="line" data-startTime="3518">of traditional tools </span><span class="line" data-startTime="3520">like chroot, </span><span class="line" data-startTime="3520">different user &mdash; </span><span class="line" data-startTime="3522">totally different user. </span></p>

<p><span class="line" data-startTime="3523">You know, there's a lot </span><span class="line" data-startTime="3523">of things. </span> <span class="line" data-startTime="3525">But all of those tools </span><span class="line" data-startTime="3525">seem to require </span><span class="line" data-startTime="3527">some change or some support </span><span class="line" data-startTime="3527">from the host system, </span><span class="line" data-startTime="3529">so something that's installed </span><span class="line" data-startTime="3529">by admin or whatnot. </span> <span class="line" data-startTime="3533">I would encourage you </span><span class="line" data-startTime="3533">to get up on Chromium Dev </span><span class="line" data-startTime="3534">and chat with the engineers </span><span class="line" data-startTime="3536">who are actually looking </span><span class="line" data-startTime="3536">into this problem, </span><span class="line" data-startTime="3537">'cause there's just so many </span><span class="line" data-startTime="3537">different approaches </span><span class="line" data-startTime="3539">you could take </span><span class="line" data-startTime="3539">with sandboxing. </span> <span class="line" data-startTime="3540">man: Are you guys interested </span><span class="line" data-startTime="3540">in any sort of, like, </span><span class="line" data-startTime="3542">it's not really portable, </span><span class="line" data-startTime="3542">but it's, like, an object type &mdash; </span><span class="line" data-startTime="3545">like, how Valgrind does it, </span><span class="line" data-startTime="3546">where it just </span><span class="line" data-startTime="3546">reads object code </span><span class="line" data-startTime="3548">and just runs that inside </span><span class="line" data-startTime="3548">of, like, an emulator, </span><span class="line" data-startTime="3550">like a user space emulation? </span></p>

<p class="speaker"><span class="line" data-starttime="3551"><span class="speakerName">Darin Fisher</span>: Big concern </span><span class="line" data-startTime="3551">is performance really </span><span class="line" data-startTime="3553">with anything we do. </span><span class="line" data-startTime="3554">man: Okay, thank you. </span><span class="line" data-startTime="3556">another man: </span><span class="line" data-startTime="3556">One more thing about plug-ins. </span><span class="line" data-startTime="3558">You know, </span><span class="line" data-startTime="3558">it would also help if maybe </span><span class="line" data-startTime="3560">you streamlined the installation </span><span class="line" data-startTime="3560">process a little bit. </span><span class="line" data-startTime="3563">I understand the security </span><span class="line" data-startTime="3563">implications of having plug-ins. </span><span class="line" data-startTime="3567">It'd be nice, </span><span class="line" data-startTime="3567">from a user's point of view, </span><span class="line" data-startTime="3569">if they could click somewhere </span><span class="line" data-startTime="3569">and actually get a plug-in </span><span class="line" data-startTime="3571">without having </span><span class="line" data-startTime="3571">to reboot the browser and &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="3575"><span class="speakerName">Darin Fisher</span>: Well, one of the things </span><span class="line" data-startTime="3575">we're trying to solve </span><span class="line" data-startTime="3577">with Chrome extension system </span><span class="line" data-startTime="3577">is to actually make it easy </span><span class="line" data-startTime="3579">for extensions to deliver </span><span class="line" data-startTime="3579">all manner of things </span><span class="line" data-startTime="3582">that extend the browser. </span><span class="line" data-startTime="3584">And so just like an XPI </span><span class="line" data-startTime="3584">can be used on Mozilla </span><span class="line" data-startTime="3587">to deliver an NPAPI plug-in, </span><span class="line" data-startTime="3589">a Chrome extension bundle </span><span class="line" data-startTime="3589">should be able to do the same </span><span class="line" data-startTime="3592">and give the user </span><span class="line" data-startTime="3592">very good control </span><span class="line" data-startTime="3594">over managing </span><span class="line" data-startTime="3594">that plug-in. </span><span class="line" data-startTime="3595">man: Yeah, </span><span class="line" data-startTime="3595">we'll talk offline. </span></p>

<p class="speaker"><span class="line" data-starttime="3597"><span class="speakerName">Darin Fisher</span>: So anyways, </span><span class="line" data-startTime="3597">that's it. </span><span class="line" data-startTime="3599">I'm afraid we're </span><span class="line" data-startTime="3599">all out of time for questions, </span><span class="line" data-startTime="3600">but I'm happy to talk </span><span class="line" data-startTime="3600">to folks afterwards. </span><span class="line" data-startTime="3602">Thank you so much </span><span class="line" data-startTime="3602">for coming, </span><span class="line" data-startTime="3604">and I'm to remind you </span><span class="line" data-startTime="3609">of this. </span><span class="line" data-startTime="3610">Haveasec.com/IO. </span><span class="line" data-startTime="3612">Please leave your comments. </span></p></div>