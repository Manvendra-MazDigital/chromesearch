<style>* {font-family: "Open Sans", sans-serif}
a {color: #77aaff}
a.video {border-bottom: 1px solid #ddd; display: block; margin: 0 0 2em 0; padding: 0 0 2em 0}
h2 {color: #444; font-size: 18px;}
span.speakerName {color: black; font-weight: 900;}
body {padding: 2em}
p {color: #444; margin: 0; text-indent: 1.5em;}
p.speaker {margin: 1em 0 0 0; text-indent: 0;}
div#transcript > p:first-child {text-indent: 0;}
</style>

<h1>Network connectivity: optional &mdash; Chrome Dev Summit 2013 (Jake Archibald)</h1>

<h2>Jake Archibald</h2>

<a class="video" href="http://youtu.be/Z7sRMg0f5Hk">youtu.be/Z7sRMg0f5Hk</a><div id="transcript"><p class="speaker"><span class="line" data-starttime="0"><span class="speakerName">Male Speaker</span>: So next up </span><span class="line" data-startTime="0">we have Mr. Jake Archibald, </span><span class="line" data-startTime="2">who you met before. </span><span class="line" data-startTime="4">Jake is a long time </span><span class="line" data-startTime="4">front end developer. </span><span class="line" data-startTime="7">He originally worked on the </span><span class="line" data-startTime="7">Glow library at the BBC. </span><span class="line" data-startTime="11">It was kind of like a competitor </span><span class="line" data-startTime="11">to jQuery sort of back </span><span class="line" data-startTime="14">then because they </span><span class="line" data-startTime="14">needed IE 5.5 support. </span><span class="line" data-startTime="18">Is that the reason? </span></p>

<p class="speaker"><span class="line" data-starttime="18"><span class="speakerName">Jake Archibald</span>: And 5. </span></p>

<p class="speaker"><span class="line" data-starttime="19"><span class="speakerName">Male Speaker</span>: Yeah, and 5. </span><span class="line" data-startTime="20">IE 5 support. </span><span class="line" data-startTime="21">Yeah, this was good. </span><span class="line" data-startTime="23">He also is an expert </span><span class="line" data-startTime="23">in @font-face. </span><span class="line" data-startTime="26">He made a fantastic </span><span class="line" data-startTime="26">offline tool for creating </span><span class="line" data-startTime="29">CSS sprites called Sprite Cow. </span><span class="line" data-startTime="31">He developed a technique for </span><span class="line" data-startTime="31">including IE specific styles </span><span class="line" data-startTime="35">with Sass IE, naturally. </span><span class="line" data-startTime="38">More recently, you might </span><span class="line" data-startTime="38">know him from his work </span><span class="line" data-startTime="41">with the Application </span><span class="line" data-startTime="41">Cache, where </span><span class="line" data-startTime="43">he wrote a number of </span><span class="line" data-startTime="43">articles and talks. </span><span class="line" data-startTime="45">And today, he's going to be </span><span class="line" data-startTime="45">telling you a little bit more </span><span class="line" data-startTime="48">about ServiceWorker. </span><span class="line" data-startTime="49">So, Jake Archibald. </span></p>

<p class="speaker"><span class="line" data-starttime="51"><span class="speakerName">Jake Archibald</span>: Hey. </span> <span class="line" data-startTime="52">[APPLAUSE] </span><span class="line" data-startTime="56">So I couldn't help notice that </span><span class="line" data-startTime="56">in Mat's list of talks there </span><span class="line" data-startTime="59">that you should pay attention </span><span class="line" data-startTime="59">to, mine wasn't on there. </span> <span class="line" data-startTime="61">So no Christmas card </span><span class="line" data-startTime="61">for you this year. </span> <span class="line" data-startTime="65">So making stuff work offline </span><span class="line" data-startTime="65">used to be very easy, right? </span><span class="line" data-startTime="68">I mean, it's only </span><span class="line" data-startTime="68">really become an issue </span><span class="line" data-startTime="70">since the advent </span><span class="line" data-startTime="70">of the internet. </span> <span class="line" data-startTime="71">Before that, you had everything </span><span class="line" data-startTime="71">you needed in front of you. </span> <span class="line" data-startTime="74">You had the machine </span><span class="line" data-startTime="74">that was going </span><span class="line" data-startTime="76">to do 100% of the </span><span class="line" data-startTime="76">processing, and you </span><span class="line" data-startTime="79">had the thing that was </span><span class="line" data-startTime="79">going to be processed. </span> <span class="line" data-startTime="81">This is the first </span><span class="line" data-startTime="81">computer I ever owned. </span> <span class="line" data-startTime="83">And we should have audio here. </span></p>

<p><span class="line" data-startTime="84">Oh, we do a little bit. </span> <span class="line" data-startTime="84">[BEEPING] </span><span class="line" data-startTime="85">And these were the </span><span class="line" data-startTime="85">sights and sounds </span><span class="line" data-startTime="87">you would get just </span><span class="line" data-startTime="87">to do something </span><span class="line" data-startTime="89">like render a simple </span><span class="line" data-startTime="89">image on the page. </span> <span class="line" data-startTime="90">And I got this working on a </span><span class="line" data-startTime="90">Spectrum emulator last week, </span><span class="line" data-startTime="93">and it's the most </span><span class="line" data-startTime="93">fun I've had in ages. </span> <span class="line" data-startTime="95">And I uploaded it to </span><span class="line" data-startTime="95">YouTube, the full video. </span> <span class="line" data-startTime="97">And someone actually </span><span class="line" data-startTime="97">took the audio, </span><span class="line" data-startTime="98">recorded it onto a </span><span class="line" data-startTime="98">cassette, and played it </span><span class="line" data-startTime="100">in a real ZX Spectrum. </span> <span class="line" data-startTime="102">And it worked. </span> <span class="line" data-startTime="102">Well, it crashed </span><span class="line" data-startTime="102">at the very end. </span> <span class="line" data-startTime="104">But for me, that makes </span><span class="line" data-startTime="104">it more authentic. </span></p>

<p><span class="line" data-startTime="105">It was great. </span> <span class="line" data-startTime="108">But in these days &mdash; </span><span class="line" data-startTime="108">the only thing </span><span class="line" data-startTime="110">you needed from outside the </span><span class="line" data-startTime="110">building was electricity. </span> <span class="line" data-startTime="113">And that came from beyond the </span><span class="line" data-startTime="113">wall, wherever it comes from. </span> <span class="line" data-startTime="116">As long as that stream was </span><span class="line" data-startTime="116">constant, then you were gold. </span> <span class="line" data-startTime="120">Everything would work. </span> <span class="line" data-startTime="121">But then we got another stream. </span> <span class="line" data-startTime="122">We got another stream </span><span class="line" data-startTime="122">from beyond the wall, </span><span class="line" data-startTime="124">the internet, data on demand. </span> <span class="line" data-startTime="126">It looks like people were </span><span class="line" data-startTime="126">terrified of it at first. </span> <span class="line" data-startTime="128">But not anymore. </span> <span class="line" data-startTime="129">In fact, now, even things </span><span class="line" data-startTime="129">that are kind of built </span><span class="line" data-startTime="131">around physical media, they </span><span class="line" data-startTime="131">can't resist a delicious slurp </span><span class="line" data-startTime="135">of internet before </span><span class="line" data-startTime="135">they'll do anything. </span> <span class="line" data-startTime="137">I don't &mdash; I didn't buy </span><span class="line" data-startTime="137">new games for the PS3. </span></p>

<p><span class="line" data-startTime="140">Because you would go through </span><span class="line" data-startTime="140">this every couple of months </span><span class="line" data-startTime="143">where every time you would </span><span class="line" data-startTime="143">try and play the game, </span><span class="line" data-startTime="144">it wanted to connect </span><span class="line" data-startTime="144">to the internet </span><span class="line" data-startTime="146">and download a 50 </span><span class="line" data-startTime="146">megabyte update. </span> <span class="line" data-startTime="147">And I just wanted </span><span class="line" data-startTime="147">to play a game. </span> <span class="line" data-startTime="149">And they do automatic </span><span class="line" data-startTime="149">updates now. </span> <span class="line" data-startTime="151">It's about time, really. </span> <span class="line" data-startTime="153">Yeah, I just want </span><span class="line" data-startTime="153">to play the game. </span> <span class="line" data-startTime="155">I've got the disk </span><span class="line" data-startTime="155">here in my hand. </span> <span class="line" data-startTime="157">These days, most </span><span class="line" data-startTime="157">devices will ship </span><span class="line" data-startTime="158">with a cache for </span><span class="line" data-startTime="158">electricity which </span><span class="line" data-startTime="161">can be used when the </span><span class="line" data-startTime="161">stream isn't available. </span></p>

<p><span class="line" data-startTime="163">And we call it a battery. </span> <span class="line" data-startTime="165">In fact, as we've become less </span><span class="line" data-startTime="165">reliant on this electricity </span><span class="line" data-startTime="168">stream, we've become more </span><span class="line" data-startTime="168">reliant on the internet stream, </span><span class="line" data-startTime="172">especially on the web. </span> <span class="line" data-startTime="174">I became very aware </span><span class="line" data-startTime="174">of this back when </span><span class="line" data-startTime="176">I worked at a small agency. </span> <span class="line" data-startTime="178">You see, one day I needed </span><span class="line" data-startTime="178">to go to the toilet. </span> <span class="line" data-startTime="181">And there were five cubicles </span><span class="line" data-startTime="181">for me to choose from. </span> <span class="line" data-startTime="184">But unfortunately, </span><span class="line" data-startTime="184">on this instance, </span><span class="line" data-startTime="185">the first four were occupied. </span> <span class="line" data-startTime="187">And that's usually OK. </span> <span class="line" data-startTime="188">I tend to only need </span><span class="line" data-startTime="188">one toilet per visit. </span></p>

<p><span class="line" data-startTime="192">But I knew from </span><span class="line" data-startTime="192">previous experience </span><span class="line" data-startTime="194">that the office Wi-Fi only </span><span class="line" data-startTime="194">extended to the first four. </span> <span class="line" data-startTime="199">And there's no mobile </span><span class="line" data-startTime="199">data in there either. </span> <span class="line" data-startTime="201">And I thought for a moment. </span> <span class="line" data-startTime="202">And I was like, no. </span> <span class="line" data-startTime="204">No, I don't consider </span><span class="line" data-startTime="204">this good enough anymore. </span> <span class="line" data-startTime="206">As a human being, </span><span class="line" data-startTime="206">it's my right to have </span><span class="line" data-startTime="209">internet when I </span><span class="line" data-startTime="209">go to the toilet. </span> <span class="line" data-startTime="212">I've been using this </span><span class="line" data-startTime="212">joke for a while now. </span> <span class="line" data-startTime="213">But it comes with </span><span class="line" data-startTime="213">an important update. </span></p>

<p><span class="line" data-startTime="215">In the Google offices &mdash; </span><span class="line" data-startTime="215">or certainly in the UK &mdash; </span><span class="line" data-startTime="218">the situation is much worse. </span> <span class="line" data-startTime="220">We have no data </span><span class="line" data-startTime="220">at all, completely </span><span class="line" data-startTime="222">data-less to the point where </span><span class="line" data-startTime="222">saying, I'm just going offline, </span><span class="line" data-startTime="226">has become a kind of euphemism. </span> <span class="line" data-startTime="231">Of course, there </span><span class="line" data-startTime="231">are other places </span><span class="line" data-startTime="232">without internet, like large </span><span class="line" data-startTime="232">parts of my daily commute </span><span class="line" data-startTime="234">because I get the train in </span><span class="line" data-startTime="234">through the countryside, </span><span class="line" data-startTime="237">underground systems of course, </span><span class="line" data-startTime="237">planes, international roaming. </span> <span class="line" data-startTime="239">You have data, but it's </span><span class="line" data-startTime="239">too expensive to use. </span> <span class="line" data-startTime="242">Have we lost something </span><span class="line" data-startTime="242">through this data dependency? </span><span class="line" data-startTime="245">Wouldn't it be great if things </span><span class="line" data-startTime="245">like Wikipedia or Google </span><span class="line" data-startTime="247">Maps and YouTube were once </span><span class="line" data-startTime="247">again resilient to fluctuations </span><span class="line" data-startTime="251">in connectivity? </span><span class="line" data-startTime="252">Well, as a community, </span><span class="line" data-startTime="252">we thought so. </span> <span class="line" data-startTime="256">And we asked for a solution. </span> <span class="line" data-startTime="257">And thus, we received </span><span class="line" data-startTime="257">the Application Cache. </span> <span class="line" data-startTime="262">How did that turn out? </span><span class="line" data-startTime="264">I have voiced my opinions </span><span class="line" data-startTime="264">on AppCache before. </span></p>

<p><span class="line" data-startTime="267">But today, I would like to </span><span class="line" data-startTime="267">defer to the philosopher Andre </span><span class="line" data-startTime="270">the Giant from then </span><span class="line" data-startTime="270">WWF, who said this. </span> <span class="line" data-startTime="274">I don't like to speak </span><span class="line" data-startTime="274">badly of people. </span> <span class="line" data-startTime="276">I have grown up thinking and </span><span class="line" data-startTime="276">being told that if you cannot </span><span class="line" data-startTime="279">say something nice </span><span class="line" data-startTime="279">about someone, </span><span class="line" data-startTime="281">you should not say </span><span class="line" data-startTime="281">anything at all. </span> <span class="line" data-startTime="283">Yeah. </span> <span class="line" data-startTime="284">Oh, but I must break </span><span class="line" data-startTime="284">that rule in this case </span><span class="line" data-startTime="287">because I hate Hulk </span><span class="line" data-startTime="287">Hogan very much. </span> <span class="line" data-startTime="289">He is a big ugly goon, and </span><span class="line" data-startTime="289">I want to squash his face. </span></p>

<p><span class="line" data-startTime="293">Yeah. </span> <span class="line" data-startTime="294">AppCache needs </span><span class="line" data-startTime="294">squashed in the face. </span> <span class="line" data-startTime="296">The problem with AppCache </span><span class="line" data-startTime="296">is it's like this. </span> <span class="line" data-startTime="298">It looks so simple, so inviting, </span><span class="line" data-startTime="298">so easy to get started. </span> <span class="line" data-startTime="303">But it comes with an instruction </span><span class="line" data-startTime="303">manual, and it's huge. </span> <span class="line" data-startTime="309">And if you don't read it </span><span class="line" data-startTime="309">all and remember it all, </span><span class="line" data-startTime="311">you will be caught out. </span> <span class="line" data-startTime="314">If I make an HTML </span><span class="line" data-startTime="314">page, and point it </span><span class="line" data-startTime="316">at a manifest like this </span><span class="line" data-startTime="316">and list some files in it, </span><span class="line" data-startTime="319">and it'll be cached and it'll </span><span class="line" data-startTime="319">work offline, and that's great. </span> <span class="line" data-startTime="322">But any page that points at </span><span class="line" data-startTime="322">the manifest, just index HTML5 </span><span class="line" data-startTime="325">here &mdash; that will automatically </span><span class="line" data-startTime="325">become part of the cache. </span> <span class="line" data-startTime="328">And that counts per URL. </span> <span class="line" data-startTime="329">So if the URL just has a </span><span class="line" data-startTime="329">change in the query string, </span><span class="line" data-startTime="332">that's a new thing that will </span><span class="line" data-startTime="332">be automatically cached. </span> <span class="line" data-startTime="334">And this will just </span><span class="line" data-startTime="334">build up and up and up. </span></p>

<p><span class="line" data-startTime="335">There's no way you </span><span class="line" data-startTime="335">can prevent it, </span><span class="line" data-startTime="337">and there's nothing you </span><span class="line" data-startTime="337">can do to clear it out </span><span class="line" data-startTime="339">once it happens. </span> <span class="line" data-startTime="341">Also, on a page like this, </span><span class="line" data-startTime="341">the CSS is going to work. </span> <span class="line" data-startTime="345">That should be &mdash; it </span><span class="line" data-startTime="345">shouldn't be SCS, should it? </span><span class="line" data-startTime="347">What am I doing? </span><span class="line" data-startTime="347">Anyway, the </span><span class="line" data-startTime="347">JavaScript will work. </span> <span class="line" data-startTime="350">But what about this? </span><span class="line" data-startTime="352">This won't load even </span><span class="line" data-startTime="352">if you're online, </span><span class="line" data-startTime="356">because it's not in the cache. </span> <span class="line" data-startTime="357">And AppCache won't let network </span><span class="line" data-startTime="357">requests through by default, </span><span class="line" data-startTime="360">unless you add this little </span><span class="line" data-startTime="360">bit of magic at the bottom. </span> <span class="line" data-startTime="363">Of course, this is </span><span class="line" data-startTime="363">all in the manual. </span> <span class="line" data-startTime="365">But there's nothing </span><span class="line" data-startTime="365">in the manifest there </span><span class="line" data-startTime="367">that hints to me that </span><span class="line" data-startTime="367">this is the behavior, </span><span class="line" data-startTime="369">this is what I should expect. </span> <span class="line" data-startTime="371">I was on a transatlantic flight, </span><span class="line" data-startTime="371">and I had nothing better to do. </span></p>

<p><span class="line" data-startTime="374">I was offline. </span> <span class="line" data-startTime="375">So I tried to draw </span><span class="line" data-startTime="375">how AppCache works. </span> <span class="line" data-startTime="378">And it took me like </span><span class="line" data-startTime="378">eight hours, partly </span><span class="line" data-startTime="380">because the specification </span><span class="line" data-startTime="380">is so dense, </span><span class="line" data-startTime="381">and it kept confounding </span><span class="line" data-startTime="381">my expectations. </span> <span class="line" data-startTime="383">But also because the person </span><span class="line" data-startTime="383">in front had fully reclined, </span><span class="line" data-startTime="386">so I was having to use </span><span class="line" data-startTime="386">my laptop like a T Rex. </span> <span class="line" data-startTime="388">But it's that complicated. </span> <span class="line" data-startTime="390">And there's nothing wrong </span><span class="line" data-startTime="390">with high level APIs, right? </span><span class="line" data-startTime="393">I mean, look at jQuery. </span></p>

<p><span class="line" data-startTime="394">They looked at what people </span><span class="line" data-startTime="394">were doing with the DOM, all </span><span class="line" data-startTime="397">the common stuff, and </span><span class="line" data-startTime="397">they made shortcuts. </span> <span class="line" data-startTime="400">Some quite overloaded methods. </span> <span class="line" data-startTime="401">You need to know what the </span><span class="line" data-startTime="401">different arguments actually </span><span class="line" data-startTime="405">do. </span> <span class="line" data-startTime="405">But it works in practice. </span> <span class="line" data-startTime="406">They're really nice shortcuts. </span> <span class="line" data-startTime="408">However, AppCache tried </span><span class="line" data-startTime="408">to be the shortcut </span><span class="line" data-startTime="411">before it knew the long cuts. </span> <span class="line" data-startTime="413">It looked really sweet on paper. </span> <span class="line" data-startTime="414">But when developers </span><span class="line" data-startTime="414">actually look closely at it, </span><span class="line" data-startTime="416">we go like, ugh, no, don't </span><span class="line" data-startTime="416">like the look of that. </span> <span class="line" data-startTime="419">Take that away. </span> <span class="line" data-startTime="423">So we're going to </span><span class="line" data-startTime="423">give it another try. </span> <span class="line" data-startTime="425">We're giving it another try. </span></p>

<p><span class="line" data-startTime="426">And the new thing is </span><span class="line" data-startTime="426">the ServiceWorker. </span> <span class="line" data-startTime="428">Actually, I think this </span><span class="line" data-startTime="428">is the first talk on it. </span> <span class="line" data-startTime="430">So that didn't feel like </span><span class="line" data-startTime="430">a deserving introduction. </span> <span class="line" data-startTime="433">So we'll give that another go. </span> <span class="line" data-startTime="435">And the new thing is </span><span class="line" data-startTime="435">the ServiceWorker. </span> <span class="line" data-startTime="441">But yeah. </span> <span class="line" data-startTime="441">The current status is </span><span class="line" data-startTime="441">it's a specification </span><span class="line" data-startTime="443">that we're developing, </span><span class="line" data-startTime="443">drafting on GitHub. </span> <span class="line" data-startTime="446">We've been working on this </span><span class="line" data-startTime="446">a while, along with Mozilla </span><span class="line" data-startTime="449">and other third parties </span><span class="line" data-startTime="449">who are interested. </span> <span class="line" data-startTime="451">We've been prototyping bits </span><span class="line" data-startTime="451">and pieces in the browser. </span> <span class="line" data-startTime="453">But the spec is still </span><span class="line" data-startTime="453">a work in progress. </span> <span class="line" data-startTime="454">I'm going to show </span><span class="line" data-startTime="454">you bits of it. </span> <span class="line" data-startTime="456">And any feedback you </span><span class="line" data-startTime="456">have on it, anything </span><span class="line" data-startTime="458">you see you don't like, </span><span class="line" data-startTime="458">you can talk to me. </span> <span class="line" data-startTime="460">You can ask me in the </span><span class="line" data-startTime="460">Q&A. But you can also </span><span class="line" data-startTime="462">file issues on GitHub. </span></p>

<p><span class="line" data-startTime="464">There's nothing to play </span><span class="line" data-startTime="464">with in the browser yet, </span><span class="line" data-startTime="467">but we're hoping to hit canary </span><span class="line" data-startTime="467">sometime early next year. </span> <span class="line" data-startTime="470">So what is the ServiceWorker? </span><span class="line" data-startTime="471">Well, it's a </span><span class="line" data-startTime="471">JavaScript context that </span><span class="line" data-startTime="473">operates for a set of URLs. </span> <span class="line" data-startTime="475">And you can use it </span><span class="line" data-startTime="475">to manage behavior. </span> <span class="line" data-startTime="476">It's actually kind of easier </span><span class="line" data-startTime="476">to show you rather than </span><span class="line" data-startTime="478">describe it. </span> <span class="line" data-startTime="479">So on just a normal page, you </span><span class="line" data-startTime="479">would register a ServiceWorker </span><span class="line" data-startTime="482">like this. </span> <span class="line" data-startTime="483">The first argument, </span><span class="line" data-startTime="483">you're telling </span><span class="line" data-startTime="484">it which URLs you want </span><span class="line" data-startTime="484">it to be in charge of. </span> <span class="line" data-startTime="486">The second argument, the </span><span class="line" data-startTime="486">URL to the JavaScript file </span><span class="line" data-startTime="490">that's going to do </span><span class="line" data-startTime="490">all the controlling. </span> <span class="line" data-startTime="492">And congratulations, you </span><span class="line" data-startTime="492">now have a ServiceWorker. </span> <span class="line" data-startTime="495">And the ServiceWorker is very </span><span class="line" data-startTime="495">similar to a shared worker. </span> <span class="line" data-startTime="497">I mean, it exists </span><span class="line" data-startTime="497">separately to the pages. </span> <span class="line" data-startTime="499">And multiple pages </span><span class="line" data-startTime="499">can communicate </span><span class="line" data-startTime="501">with the same instance </span><span class="line" data-startTime="501">of the ServiceWorker. </span></p>

<p><span class="line" data-startTime="503">If you've developed </span><span class="line" data-startTime="503">Chrome apps before, </span><span class="line" data-startTime="505">this is kind of similar to </span><span class="line" data-startTime="505">the background pages model. </span> <span class="line" data-startTime="508">But these are much lighter. </span> <span class="line" data-startTime="509">They don't have a document. </span> <span class="line" data-startTime="511">They've got no DOM. </span> <span class="line" data-startTime="512">They're less of a memory </span><span class="line" data-startTime="512">burden and less startup cost </span><span class="line" data-startTime="514">than a whole page would be. </span> <span class="line" data-startTime="517">So our ServiceWorker file </span><span class="line" data-startTime="517">currently looks like this. </span> <span class="line" data-startTime="519">It's empty. </span> <span class="line" data-startTime="520">And how does that affect </span><span class="line" data-startTime="520">the behavior of pages? </span><span class="line" data-startTime="522">Well, it doesn't. </span> <span class="line" data-startTime="524">Magic was a huge </span><span class="line" data-startTime="524">problem with AppCache. </span> <span class="line" data-startTime="526">An empty AppCache file </span><span class="line" data-startTime="526">would start doing things. </span></p>

<p><span class="line" data-startTime="528">This doesn't. </span> <span class="line" data-startTime="529">ServiceWorker aims to have </span><span class="line" data-startTime="529">as little magic as possible. </span> <span class="line" data-startTime="532">It's a bring your own magic API. </span> <span class="line" data-startTime="534">You can make your </span><span class="line" data-startTime="534">own magic with it. </span> <span class="line" data-startTime="536">But by default, it doesn't </span><span class="line" data-startTime="536">do anything you don't expect. </span> <span class="line" data-startTime="539">You're in full control. </span> <span class="line" data-startTime="540">But what control do </span><span class="line" data-startTime="540">you actually get? </span><span class="line" data-startTime="542">Well, you can listen </span><span class="line" data-startTime="542">in on network requests. </span> <span class="line" data-startTime="544">You get this event. </span> <span class="line" data-startTime="546">Some just like listening to the </span><span class="line" data-startTime="546">event using the old DOM method, </span><span class="line" data-startTime="548">but you can use add event </span><span class="line" data-startTime="548">listener if you want as well. </span> <span class="line" data-startTime="552">So here, if I navigate to </span><span class="line" data-startTime="552">slash whatever slash fubar, </span><span class="line" data-startTime="555">I'm going to get a </span><span class="line" data-startTime="555">console lock for that </span><span class="line" data-startTime="557">in this other JavaScript file. </span> <span class="line" data-startTime="559">But I also get one </span><span class="line" data-startTime="559">for any request </span><span class="line" data-startTime="561">that I triggered by </span><span class="line" data-startTime="561">that page as well, </span><span class="line" data-startTime="563">even they're to another domain. </span> <span class="line" data-startTime="565">The usual cross </span><span class="line" data-startTime="565">origin rules apply </span><span class="line" data-startTime="566">when it comes to accessing data. </span> <span class="line" data-startTime="568">But you'll still get the </span><span class="line" data-startTime="568">event for the request actually </span><span class="line" data-startTime="570">happening. </span></p>

<p><span class="line" data-startTime="571">Anyway, so what? </span><span class="line" data-startTime="572">Well, like other events </span><span class="line" data-startTime="572">we have in the browser, </span><span class="line" data-startTime="575">you can prevent the default. </span> <span class="line" data-startTime="577">And you can do something else. </span> <span class="line" data-startTime="579">So here, I'm looking </span><span class="line" data-startTime="579">at the request URL, </span><span class="line" data-startTime="581">and I'm looking </span><span class="line" data-startTime="581">to see if it ends </span><span class="line" data-startTime="582">with one of the </span><span class="line" data-startTime="582">image extensions. </span> <span class="line" data-startTime="584">And then I'm going to </span><span class="line" data-startTime="584">call event.respondwith. </span> <span class="line" data-startTime="587">And event.respondwith </span><span class="line" data-startTime="587">takes a response object, </span><span class="line" data-startTime="590">which is new in ServiceWorker. </span> <span class="line" data-startTime="591">Or it will take a promise, </span><span class="line" data-startTime="591">which will eventually </span><span class="line" data-startTime="594">resolve to a response. </span> <span class="line" data-startTime="596">And the fetch method, which </span><span class="line" data-startTime="596">is also new in ServiceWorker, </span><span class="line" data-startTime="599">is going to give you a promise </span><span class="line" data-startTime="599">for a response to the URL you </span><span class="line" data-startTime="603">give it. </span></p>

<p><span class="line" data-startTime="603">So here I'm just redirecting </span><span class="line" data-startTime="603">all of the requests or &mdash; </span><span class="line" data-startTime="606">and they're going to serve up </span><span class="line" data-startTime="606">this not-a-cat image instead </span><span class="line" data-startTime="609">of any other images on the page. </span> <span class="line" data-startTime="612">So note here I'm actually </span><span class="line" data-startTime="612">satisfying a cross origin </span><span class="line" data-startTime="614">request with a same </span><span class="line" data-startTime="614">origin response. </span> <span class="line" data-startTime="616">And you can do the </span><span class="line" data-startTime="616">opposite as well. </span> <span class="line" data-startTime="618">Security is always determined by </span><span class="line" data-startTime="618">the origin of the response, not </span><span class="line" data-startTime="622">the request. </span> <span class="line" data-startTime="623">This isn't an HTTP redirect. </span> <span class="line" data-startTime="626">You're just serving </span><span class="line" data-startTime="626">up a different file. </span> <span class="line" data-startTime="628">As far as the </span><span class="line" data-startTime="628">browser's concerned, </span><span class="line" data-startTime="630">it requested </span><span class="line" data-startTime="630">probably-cats-again, </span><span class="line" data-startTime="633">and it got it. </span> <span class="line" data-startTime="634">But you could do an HTTP </span><span class="line" data-startTime="634">redirect if you want. </span> <span class="line" data-startTime="636">In fact, you can create </span><span class="line" data-startTime="636">any kind of response. </span></p>

<p><span class="line" data-startTime="638">We have a kind of low </span><span class="line" data-startTime="638">level API for that. </span> <span class="line" data-startTime="640">So new same origin response, </span><span class="line" data-startTime="640">give it a content type. </span> <span class="line" data-startTime="643">Give it a body. </span> <span class="line" data-startTime="643">And I'm going to serve that up. </span> <span class="line" data-startTime="645">And you can see </span><span class="line" data-startTime="645">how you could start </span><span class="line" data-startTime="647">to make things work </span><span class="line" data-startTime="647">offline with this. </span> <span class="line" data-startTime="648">Like, I get a template </span><span class="line" data-startTime="648">from the file system API. </span> <span class="line" data-startTime="652">I can get some data </span><span class="line" data-startTime="652">from index database </span><span class="line" data-startTime="654">and mush them together </span><span class="line" data-startTime="654">and serve that out. </span> <span class="line" data-startTime="656">But that would be a </span><span class="line" data-startTime="656">lot of code, and it </span><span class="line" data-startTime="658">would involve some </span><span class="line" data-startTime="658">pretty gnarly APIs. </span> <span class="line" data-startTime="661">So we're introducing a new </span><span class="line" data-startTime="661">storage system specifically </span><span class="line" data-startTime="663">for this, and it's </span><span class="line" data-startTime="663">the cache list. </span> <span class="line" data-startTime="666">So we just need to </span><span class="line" data-startTime="666">unfetch, but there </span><span class="line" data-startTime="668">are other events </span><span class="line" data-startTime="668">as well on install. </span> <span class="line" data-startTime="670">So this is called </span><span class="line" data-startTime="670">when the browser sees </span><span class="line" data-startTime="672">the ServiceWorker </span><span class="line" data-startTime="672">for the first time. </span></p>

<p><span class="line" data-startTime="673">It's your opportunity </span><span class="line" data-startTime="673">to get everything ready </span><span class="line" data-startTime="675">before you start </span><span class="line" data-startTime="675">hearing about requests, </span><span class="line" data-startTime="678">before you start </span><span class="line" data-startTime="678">handling requests. </span> <span class="line" data-startTime="679">So in here, I can create a new </span><span class="line" data-startTime="679">cache, give it a set of URLs, </span><span class="line" data-startTime="683">and add it onto </span><span class="line" data-startTime="683">the caches object. </span> <span class="line" data-startTime="685">And these are just URLs. </span> <span class="line" data-startTime="686">They can be from another domain. </span> <span class="line" data-startTime="688">That's fine. </span> <span class="line" data-startTime="688">And they'll be downloaded, </span><span class="line" data-startTime="688">and we add them </span><span class="line" data-startTime="690">to this cache called </span><span class="line" data-startTime="690">static-v1 or whatever. </span> <span class="line" data-startTime="693">Now the cache won't </span><span class="line" data-startTime="693">serve responses </span><span class="line" data-startTime="695">until all of those files </span><span class="line" data-startTime="695">have successfully downloaded. </span> <span class="line" data-startTime="698">And if one of them </span><span class="line" data-startTime="698">fails, then you </span><span class="line" data-startTime="700">get nothing for </span><span class="line" data-startTime="700">that whole cache. </span> <span class="line" data-startTime="702">This is a good way to </span><span class="line" data-startTime="702">group files together </span><span class="line" data-startTime="703">that are dependent </span><span class="line" data-startTime="703">on each other. </span> <span class="line" data-startTime="705">So if you can get the </span><span class="line" data-startTime="705">network-failed.html out </span><span class="line" data-startTime="709">of the cache, you </span><span class="line" data-startTime="709">know the PNG is there. </span></p>

<p><span class="line" data-startTime="713">The JS is there. </span> <span class="line" data-startTime="714">The CSS is definitely there. </span> <span class="line" data-startTime="715">They're dependent on each other. </span> <span class="line" data-startTime="717">We're creating one </span><span class="line" data-startTime="717">cache here, but you </span><span class="line" data-startTime="718">could create many, </span><span class="line" data-startTime="718">like for a game. </span> <span class="line" data-startTime="721">You could create a cache </span><span class="line" data-startTime="721">per level, for instance. </span> <span class="line" data-startTime="723">For a newspaper, you </span><span class="line" data-startTime="723">could do a cache per issue </span><span class="line" data-startTime="725">or a cache per article. </span> <span class="line" data-startTime="728">And then we wait on the cache. </span> <span class="line" data-startTime="730">So event.waitUntil </span><span class="line" data-startTime="730">takes a promise. </span> <span class="line" data-startTime="733">And this is where you can </span><span class="line" data-startTime="733">say, look, I'm not actually </span><span class="line" data-startTime="735">ready to handle requests </span><span class="line" data-startTime="735">until this stuff has happened. </span> <span class="line" data-startTime="738">On cache objects, you </span><span class="line" data-startTime="738">get this ready method, </span><span class="line" data-startTime="740">which will resolve once that </span><span class="line" data-startTime="740">cache has successfully formed. </span> <span class="line" data-startTime="746">You might wait on </span><span class="line" data-startTime="746">all of your caches, </span><span class="line" data-startTime="748">or you might only wait on some. </span></p>

<p><span class="line" data-startTime="749">So in the game model, you </span><span class="line" data-startTime="749">might only wait on level one </span><span class="line" data-startTime="752">and allow the other levels to </span><span class="line" data-startTime="752">download in the background. </span> <span class="line" data-startTime="754">And you'll just handle it </span><span class="line" data-startTime="754">if level two is not there </span><span class="line" data-startTime="756">for whatever reason. </span> <span class="line" data-startTime="758">For instance, if the </span><span class="line" data-startTime="758">user goes offline </span><span class="line" data-startTime="761">while that's still downloading </span><span class="line" data-startTime="761">levels two and three, </span><span class="line" data-startTime="763">you can still offer an offline </span><span class="line" data-startTime="763">experience for level one. </span> <span class="line" data-startTime="766">And then when the user gets </span><span class="line" data-startTime="766">to the end of level one, </span><span class="line" data-startTime="768">you can say, look, we don't </span><span class="line" data-startTime="768">have the files for level two. </span> <span class="line" data-startTime="771">We've saved your position, </span><span class="line" data-startTime="771">and when you're next online, </span><span class="line" data-startTime="773">we can pick up </span><span class="line" data-startTime="773">where we left off. </span> <span class="line" data-startTime="776">But we're just </span><span class="line" data-startTime="776">creating caches here. </span> <span class="line" data-startTime="778">We're not actually using them. </span> <span class="line" data-startTime="780">To use them, we go back </span><span class="line" data-startTime="780">to our own fetch method. </span> <span class="line" data-startTime="782">And once again, the </span><span class="line" data-startTime="782">respondWith method, </span><span class="line" data-startTime="784">and I'm just going </span><span class="line" data-startTime="784">to ask the caches </span><span class="line" data-startTime="786">for a match for this URL. </span></p>

<p><span class="line" data-startTime="788">I can be specific </span><span class="line" data-startTime="788">and say, look, I only </span><span class="line" data-startTime="789">want to get a match </span><span class="line" data-startTime="789">from the cache named </span><span class="line" data-startTime="791">static-v1 or whatever. </span> <span class="line" data-startTime="792">But we don't really </span><span class="line" data-startTime="792">need to do that here. </span> <span class="line" data-startTime="794">We don't need to </span><span class="line" data-startTime="794">be that specific. </span> <span class="line" data-startTime="796">Of course, if that doesn't </span><span class="line" data-startTime="796">match anything in our caches &mdash; </span><span class="line" data-startTime="799">because we're handling all </span><span class="line" data-startTime="799">requests at the moment- we're </span><span class="line" data-startTime="801">going to get a hard failure, </span><span class="line" data-startTime="801">even if the user's online </span><span class="line" data-startTime="804">because we're saying, go to </span><span class="line" data-startTime="804">the cache for everything. </span> <span class="line" data-startTime="807">But this whole thing </span><span class="line" data-startTime="807">is promise based, </span><span class="line" data-startTime="808">promises that we now have </span><span class="line" data-startTime="808">in a DOM in JavaScript. </span> <span class="line" data-startTime="810">So we can fix that just by </span><span class="line" data-startTime="810">adding .catch to the end and do </span><span class="line" data-startTime="814">something else. </span> <span class="line" data-startTime="815">If you're unfamiliar </span><span class="line" data-startTime="815">with how promises work, </span><span class="line" data-startTime="817">then there is an HTML5 </span><span class="line" data-startTime="817">Rocks article coming. </span> <span class="line" data-startTime="819">It should be out next month. </span></p>

<p><span class="line" data-startTime="821">That hopefully will explain it. </span> <span class="line" data-startTime="822">But all sync success </span><span class="line" data-startTime="822">failure methods </span><span class="line" data-startTime="825">in JavaScript in the DOM </span><span class="line" data-startTime="825">are moving to this model. </span> <span class="line" data-startTime="828">So if you fail to get stuff from </span><span class="line" data-startTime="828">the cache for whatever reason, </span><span class="line" data-startTime="832">like something </span><span class="line" data-startTime="832">fails or there's not </span><span class="line" data-startTime="834">something in the </span><span class="line" data-startTime="834">cache for that URL, </span><span class="line" data-startTime="835">we fall down to this next step. </span> <span class="line" data-startTime="837">And what I'm doing </span><span class="line" data-startTime="837">is I'm using fetch. </span> <span class="line" data-startTime="838">And I'm just going to </span><span class="line" data-startTime="838">pipe through the requests. </span> <span class="line" data-startTime="840">So we're going to </span><span class="line" data-startTime="840">go to the network. </span> <span class="line" data-startTime="843">Of course, if there's </span><span class="line" data-startTime="843">nothing in the cache, </span><span class="line" data-startTime="844">and the network request fails, </span><span class="line" data-startTime="844">we're going to get nothing. </span></p>

<p><span class="line" data-startTime="847">But we can fix that as well. </span> <span class="line" data-startTime="849">We can catch again. </span> <span class="line" data-startTime="850">And here, I'm going to </span><span class="line" data-startTime="850">go to the cache again, </span><span class="line" data-startTime="852">and I'm going to get the </span><span class="line" data-startTime="852">network-failed.html file </span><span class="line" data-startTime="855">and serve that. </span> <span class="line" data-startTime="856">And I know that's there </span><span class="line" data-startTime="856">because I depended </span><span class="line" data-startTime="857">on it in the uninstall </span><span class="line" data-startTime="857">method, event even. </span> <span class="line" data-startTime="861">And our other page is going to </span><span class="line" data-startTime="861">be better than the browser's </span><span class="line" data-startTime="863">default one because </span><span class="line" data-startTime="863">we can say, hey, </span><span class="line" data-startTime="865">I'm afraid that resource </span><span class="line" data-startTime="865">is not available. </span> <span class="line" data-startTime="866">But here's a list </span><span class="line" data-startTime="866">of things which are. </span> <span class="line" data-startTime="868">Here's the articles that </span><span class="line" data-startTime="868">are available to you. </span> <span class="line" data-startTime="870">Here's the levels </span><span class="line" data-startTime="870">which will work. </span></p>

<p><span class="line" data-startTime="872">As I mentioned before, </span><span class="line" data-startTime="872">onfetch doesn't just </span><span class="line" data-startTime="874">fire for full page navigations. </span> <span class="line" data-startTime="876">It also fires for assets on </span><span class="line" data-startTime="876">the page, your JavaScript, XHR, </span><span class="line" data-startTime="880">CSS, images, et cetera. </span> <span class="line" data-startTime="881">We can differentiate </span><span class="line" data-startTime="881">between the two </span><span class="line" data-startTime="883">using event.type because </span><span class="line" data-startTime="883">it makes sense here. </span> <span class="line" data-startTime="885">We don't want to serve up </span><span class="line" data-startTime="885">network-failed.html for an XHR </span><span class="line" data-startTime="888">request. </span> <span class="line" data-startTime="888">That doesn't work. </span> <span class="line" data-startTime="890">So here, we can just serve it </span><span class="line" data-startTime="890">up for full page navigations. </span> <span class="line" data-startTime="894">So this, this bit of </span><span class="line" data-startTime="894">code &mdash; what does this look </span><span class="line" data-startTime="896">like in AppCache? </span><span class="line" data-startTime="898">Ah. </span> <span class="line" data-startTime="901">It's a lot simpler. </span> <span class="line" data-startTime="902">But it's not actually </span><span class="line" data-startTime="902">simpler, is it? </span><span class="line" data-startTime="904">It's just less characters. </span> <span class="line" data-startTime="906">This doesn't tell </span><span class="line" data-startTime="906">me that for any URL, </span><span class="line" data-startTime="908">it should go to the cache </span><span class="line" data-startTime="908">first and then try the network </span><span class="line" data-startTime="911">and then fall back to </span><span class="line" data-startTime="911">network-failed.html. </span> <span class="line" data-startTime="915">And this is just </span><span class="line" data-startTime="915">one of the few cases </span><span class="line" data-startTime="916">that AppCache can actually </span><span class="line" data-startTime="916">do without too much issue. </span> <span class="line" data-startTime="920">But you don't get </span><span class="line" data-startTime="920">the full separation </span><span class="line" data-startTime="922">of caching and routing. </span></p>

<p><span class="line" data-startTime="924">But you're going to </span><span class="line" data-startTime="924">get the weird auto </span><span class="line" data-startTime="925">caching of all pages, </span><span class="line" data-startTime="925">that link to it. </span> <span class="line" data-startTime="927">And if you want it to serve </span><span class="line" data-startTime="927">a different fall back for XHR </span><span class="line" data-startTime="930">compared to navigations, </span><span class="line" data-startTime="930">AppCache can't do that. </span> <span class="line" data-startTime="935">If this, the worker code, </span><span class="line" data-startTime="935">starts doing something </span><span class="line" data-startTime="937">I don't understand, </span><span class="line" data-startTime="937">what can I do? </span><span class="line" data-startTime="940">I can add a console.log. </span> <span class="line" data-startTime="942">I can add a JavaScript </span><span class="line" data-startTime="942">break point, </span><span class="line" data-startTime="944">and I can step through </span><span class="line" data-startTime="944">it step by step </span><span class="line" data-startTime="945">and look at all the </span><span class="line" data-startTime="945">values of variables, </span><span class="line" data-startTime="948">look at the whole </span><span class="line" data-startTime="948">state on every step. </span></p>

<p><span class="line" data-startTime="951">If this does something I </span><span class="line" data-startTime="951">don't expect &mdash; and it will &mdash; </span><span class="line" data-startTime="956">we're back to the manual. </span> <span class="line" data-startTime="957">Read the whole thing again. </span> <span class="line" data-startTime="960">When I was building Lanyard's </span><span class="line" data-startTime="960">offline enabled mobile site, </span><span class="line" data-startTime="962">I found out some devices </span><span class="line" data-startTime="962">were behaving differently </span><span class="line" data-startTime="965">when they were out of signal to </span><span class="line" data-startTime="965">when they were in flight mode. </span> <span class="line" data-startTime="970">And what I was </span><span class="line" data-startTime="970">most interested in </span><span class="line" data-startTime="971">is doing a proper </span><span class="line" data-startTime="971">no reception test. </span> <span class="line" data-startTime="974">But how could I test </span><span class="line" data-startTime="974">genuinely no reception? </span><span class="line" data-startTime="976">This is before I </span><span class="line" data-startTime="976">worked at Google, </span><span class="line" data-startTime="978">so I couldn't just pop </span><span class="line" data-startTime="978">along to Faraday's lavatory </span><span class="line" data-startTime="980">and sit there testing phones. </span> <span class="line" data-startTime="982">So I populated the </span><span class="line" data-startTime="982">caches on each device, </span><span class="line" data-startTime="984">and I went to the local </span><span class="line" data-startTime="984">underground station </span><span class="line" data-startTime="987">because there's no mobile </span><span class="line" data-startTime="987">reception down there. </span> <span class="line" data-startTime="989">And I tested each </span><span class="line" data-startTime="989">devices, see what it did. </span> <span class="line" data-startTime="991">And I was filming it </span><span class="line" data-startTime="991">with a digital camera </span><span class="line" data-startTime="993">so I could review it later on. </span> <span class="line" data-startTime="995">And I looked up, and I saw </span><span class="line" data-startTime="995">that two police officers were </span><span class="line" data-startTime="998">kind of standing in front of </span><span class="line" data-startTime="998">me, pulling faces and pointing </span><span class="line" data-startTime="1001">behind me. </span></p>

<p><span class="line" data-startTime="1002">And I look around, and I was </span><span class="line" data-startTime="1002">sitting in between two posters. </span> <span class="line" data-startTime="1005">One said, someone's got </span><span class="line" data-startTime="1005">more than one mobile phone. </span> <span class="line" data-startTime="1007">Probably a terrorist. </span> <span class="line" data-startTime="1010">Doing something odd with a </span><span class="line" data-startTime="1010">camera, probably a terrorist. </span> <span class="line" data-startTime="1014">I was ticking all </span><span class="line" data-startTime="1014">of the terror boxes. </span> <span class="line" data-startTime="1016">Thankfully, the police </span><span class="line" data-startTime="1016">thought this was hilarious </span><span class="line" data-startTime="1018">and decided not to </span><span class="line" data-startTime="1018">shoot me to pieces, </span><span class="line" data-startTime="1020">which was very nice of them. </span> <span class="line" data-startTime="1023">So the ServiceWorker lets us </span><span class="line" data-startTime="1023">build these offline experiences </span><span class="line" data-startTime="1025">in a flexible and testable way. </span> <span class="line" data-startTime="1027">But who cares? </span><span class="line" data-startTime="1028">I mean, we've got </span><span class="line" data-startTime="1028">train journeys, </span><span class="line" data-startTime="1029">plane journey, roaming abroad. </span> <span class="line" data-startTime="1031">But mobile coverage is just </span><span class="line" data-startTime="1031">getting better and better. </span> <span class="line" data-startTime="1034">Planes and trains are getting </span><span class="line" data-startTime="1034">Wi-Fi, some even for free. </span> <span class="line" data-startTime="1037">And mobile providers </span><span class="line" data-startTime="1037">are starting </span><span class="line" data-startTime="1039">to remove roaming costs. </span></p>

<p><span class="line" data-startTime="1041">Maybe even one day, Google </span><span class="line" data-startTime="1041">will put a Wi-Fi antenna </span><span class="line" data-startTime="1043">outside the toilets. </span> <span class="line" data-startTime="1045">Is this problem going away, this </span><span class="line" data-startTime="1045">problem of zero connectivity? </span><span class="line" data-startTime="1049">When I first started </span><span class="line" data-startTime="1049">making stuff work offline, </span><span class="line" data-startTime="1051">my instinct was to </span><span class="line" data-startTime="1051">build things as normal </span><span class="line" data-startTime="1053">and then catch the </span><span class="line" data-startTime="1053">users that were offline. </span> <span class="line" data-startTime="1055">And you can do that </span><span class="line" data-startTime="1055">in ServiceWorker </span><span class="line" data-startTime="1057">because, do what you want. </span> <span class="line" data-startTime="1059">I can do onfetch, event, </span><span class="line" data-startTime="1059">respondWith, go to the network, </span><span class="line" data-startTime="1061">and then catch that </span><span class="line" data-startTime="1061">and do something else, </span><span class="line" data-startTime="1063">like pull some data </span><span class="line" data-startTime="1063">out of the cache. </span></p>

<p><span class="line" data-startTime="1066">So people who have </span><span class="line" data-startTime="1066">never connectivity </span><span class="line" data-startTime="1068">are going to get </span><span class="line" data-startTime="1068">fresh data every time. </span> <span class="line" data-startTime="1070">Users without </span><span class="line" data-startTime="1070">connectivity are rescued. </span> <span class="line" data-startTime="1072">We can give them something. </span> <span class="line" data-startTime="1073">This is graceful degradation. </span> <span class="line" data-startTime="1075">And as we found with </span><span class="line" data-startTime="1075">graceful degradation, </span><span class="line" data-startTime="1077">it's the wrong way around. </span> <span class="line" data-startTime="1079">You see, when I want to get </span><span class="line" data-startTime="1079">something from the internet, </span><span class="line" data-startTime="1082">I have to wake up the </span><span class="line" data-startTime="1082">radio or the Wi-Fi devices. </span> <span class="line" data-startTime="1084">Non 3G, that can take </span><span class="line" data-startTime="1084">a couple of seconds. </span> <span class="line" data-startTime="1087">And then we can begin </span><span class="line" data-startTime="1087">the epic journey </span><span class="line" data-startTime="1089">to get data from somewhere </span><span class="line" data-startTime="1089">else in the world. </span></p>

<p><span class="line" data-startTime="1091">And it's a dangerous business, </span><span class="line" data-startTime="1091">going out onto the internet. </span> <span class="line" data-startTime="1094">We need to negotiate the router, </span><span class="line" data-startTime="1094">ISP, DNS, intermediate proxies, </span><span class="line" data-startTime="1099">the destination server, </span><span class="line" data-startTime="1099">grab what we need, </span><span class="line" data-startTime="1101">and then come back </span><span class="line" data-startTime="1101">through all those things. </span> <span class="line" data-startTime="1103">And it's a lot to do. </span> <span class="line" data-startTime="1104">And if any of these </span><span class="line" data-startTime="1104">things are busy or flaky, </span><span class="line" data-startTime="1106">we're going to be slow. </span> <span class="line" data-startTime="1108">Or worse, we're going to </span><span class="line" data-startTime="1108">end up with a total failure. </span> <span class="line" data-startTime="1112">But we don't know it's going to </span><span class="line" data-startTime="1112">be fast or slow until we try. </span> <span class="line" data-startTime="1115">We don't know it's </span><span class="line" data-startTime="1115">going to succeed or fail </span><span class="line" data-startTime="1117">until one of those </span><span class="line" data-startTime="1117">two things happens. </span></p>

<p><span class="line" data-startTime="1119">And this epic journey </span><span class="line" data-startTime="1119">is per request, </span><span class="line" data-startTime="1121">and your pages are </span><span class="line" data-startTime="1121">made out of many. </span> <span class="line" data-startTime="1122">This is why I like </span><span class="line" data-startTime="1122">progressive enhancement, </span><span class="line" data-startTime="1124">because you can get stuff </span><span class="line" data-startTime="1124">on the screen with less </span><span class="line" data-startTime="1127">requirements from the network. </span> <span class="line" data-startTime="1131">A bit of the HTML and </span><span class="line" data-startTime="1131">the CSS comes down, </span><span class="line" data-startTime="1133">you can start rendering. </span> <span class="line" data-startTime="1134">But ultimately, it's </span><span class="line" data-startTime="1134">still network dependent. </span> <span class="line" data-startTime="1138">And when your phone's like this, </span><span class="line" data-startTime="1138">it's like a one legged dog. </span> <span class="line" data-startTime="1143">It thinks it can still </span><span class="line" data-startTime="1143">play fetch, but it can't. </span> <span class="line" data-startTime="1148">And boy, will it try. </span> <span class="line" data-startTime="1149">And you have to sit there </span><span class="line" data-startTime="1149">watching it drag itself </span><span class="line" data-startTime="1152">along the floor </span><span class="line" data-startTime="1152">with its one leg. </span> <span class="line" data-startTime="1155">And it's heartbreaking. </span> <span class="line" data-startTime="1156">It'll spend minutes </span><span class="line" data-startTime="1156">trying before it gives up. </span> <span class="line" data-startTime="1158">But even if your </span><span class="line" data-startTime="1158">connection's like this, </span><span class="line" data-startTime="1160">you're still at the </span><span class="line" data-startTime="1160">mercy of everything </span><span class="line" data-startTime="1162">else out on in the internet, </span><span class="line" data-startTime="1162">any problems that are there. </span></p>

<p><span class="line" data-startTime="1164">And if you've got </span><span class="line" data-startTime="1164">something already </span><span class="line" data-startTime="1165">on the device, if you already </span><span class="line" data-startTime="1165">have an offline experience, why </span><span class="line" data-startTime="1168">wait for the network to show it? </span><span class="line" data-startTime="1170">You don't have to leave the </span><span class="line" data-startTime="1170">device to get to first render. </span> <span class="line" data-startTime="1173">We should build our </span><span class="line" data-startTime="1173">pages offline first. </span> <span class="line" data-startTime="1176">And the next generation </span><span class="line" data-startTime="1176">of progressive enhancement </span><span class="line" data-startTime="1178">treats the network as a </span><span class="line" data-startTime="1178">potential enhancement, </span><span class="line" data-startTime="1180">an enhancement that </span><span class="line" data-startTime="1180">might not be available. </span> <span class="line" data-startTime="1183">So sure, connectivity's </span><span class="line" data-startTime="1183">getting better. </span> <span class="line" data-startTime="1184">But it's very rarely going to </span><span class="line" data-startTime="1184">be faster than getting stuff </span><span class="line" data-startTime="1188">straight off the device. </span> <span class="line" data-startTime="1190">This whole thing's as much </span><span class="line" data-startTime="1190">about improving performance </span><span class="line" data-startTime="1192">for users with </span><span class="line" data-startTime="1192">connectivity as it </span><span class="line" data-startTime="1194">is for giving something </span><span class="line" data-startTime="1194">to those without. </span></p>

<p><span class="line" data-startTime="1197">The Hoodie guys </span><span class="line" data-startTime="1197">made a great post </span><span class="line" data-startTime="1198">about this, which I </span><span class="line" data-startTime="1198">recommend reading. </span> <span class="line" data-startTime="1200">But these ideas are </span><span class="line" data-startTime="1200">pretty new to the web. </span> <span class="line" data-startTime="1203">But some native apps have been </span><span class="line" data-startTime="1203">doing this for quite a while. </span> <span class="line" data-startTime="1206">Here we can compare the loading </span><span class="line" data-startTime="1206">of the Google Plus mobile site </span><span class="line" data-startTime="1209">versus the native app </span><span class="line" data-startTime="1209">over a pretty decent </span><span class="line" data-startTime="1212">mobile connection. </span> <span class="line" data-startTime="1214">Unfortunately, we have </span><span class="line" data-startTime="1214">to give the website </span><span class="line" data-startTime="1216">a head start in this because </span><span class="line" data-startTime="1216">it has a one of these. </span> <span class="line" data-startTime="1222">I love the web. </span> <span class="line" data-startTime="1225">I hate this. </span></p>

<p><span class="line" data-startTime="1226">We should not be doing this. </span> <span class="line" data-startTime="1228">But let's &mdash; we'll </span><span class="line" data-startTime="1228">gloss over that. </span> <span class="line" data-startTime="1230">Oh, yeah thanks. </span> <span class="line" data-startTime="1231">[APPLAUSE] </span><span class="line" data-startTime="1233">But let's &mdash; we're going to load </span><span class="line" data-startTime="1233">the main site now at the same </span><span class="line" data-startTime="1235">time as the app. </span> <span class="line" data-startTime="1237">So we go. </span> <span class="line" data-startTime="1239">And the native app has </span><span class="line" data-startTime="1239">content on the screen. </span> <span class="line" data-startTime="1241">There it goes. </span> <span class="line" data-startTime="1241">And the website's still </span><span class="line" data-startTime="1241">thinking about it. </span> <span class="line" data-startTime="1243">Oh, and now it's being </span><span class="line" data-startTime="1243">blocked by a font download. </span> <span class="line" data-startTime="1245">And eventually, </span><span class="line" data-startTime="1245">it comes through. </span> <span class="line" data-startTime="1247">If we ignore the font </span><span class="line" data-startTime="1247">delay, then both the app </span><span class="line" data-startTime="1250">and the website actually </span><span class="line" data-startTime="1250">got fresh content around </span><span class="line" data-startTime="1252">about the same time. </span> <span class="line" data-startTime="1253">But before that, the native </span><span class="line" data-startTime="1253">app shows cache content. </span></p>

<p><span class="line" data-startTime="1257">And it feels so much faster. </span> <span class="line" data-startTime="1258">It looks like it beats the </span><span class="line" data-startTime="1258">website by two seconds. </span> <span class="line" data-startTime="1261">And in this example, </span><span class="line" data-startTime="1261">connectivity was good. </span> <span class="line" data-startTime="1262">And the mobile site </span><span class="line" data-startTime="1262">got an advantage </span><span class="line" data-startTime="1264">because by going </span><span class="line" data-startTime="1264">through the slam door </span><span class="line" data-startTime="1267">thing we did a lot of </span><span class="line" data-startTime="1267">the DNS work up front. </span> <span class="line" data-startTime="1270">And we did a lot </span><span class="line" data-startTime="1270">of the &mdash; yeah, we </span><span class="line" data-startTime="1273">had some [? warmer ?] for </span><span class="line" data-startTime="1273">the connections in the radio. </span> <span class="line" data-startTime="1276">As connectivity </span><span class="line" data-startTime="1276">gets worse, the app </span><span class="line" data-startTime="1277">is going to look </span><span class="line" data-startTime="1277">better and better </span><span class="line" data-startTime="1279">compared to the website because </span><span class="line" data-startTime="1279">it can just render straight </span><span class="line" data-startTime="1281">from the device. </span></p>

<p><span class="line" data-startTime="1282">ServiceWorker levels </span><span class="line" data-startTime="1282">this playing field. </span> <span class="line" data-startTime="1285">So we can start by </span><span class="line" data-startTime="1285">just serving a page </span><span class="line" data-startTime="1287">shell from the </span><span class="line" data-startTime="1287">ServiceWorker, just the UI </span><span class="line" data-startTime="1291">but no content there. </span> <span class="line" data-startTime="1292">And we can start up a spinner. </span> <span class="line" data-startTime="1294">And we can see if we've </span><span class="line" data-startTime="1294">got any cached content. </span> <span class="line" data-startTime="1296">And if we do, we </span><span class="line" data-startTime="1296">can show it and then </span><span class="line" data-startTime="1297">start going in and fetching </span><span class="line" data-startTime="1297">some network content. </span> <span class="line" data-startTime="1300">If we don't have cached </span><span class="line" data-startTime="1300">content, that's fine. </span> <span class="line" data-startTime="1301">We'll just go to </span><span class="line" data-startTime="1301">the network and see </span><span class="line" data-startTime="1303">if we can get </span><span class="line" data-startTime="1303">something from there. </span> <span class="line" data-startTime="1304">And once that works, we </span><span class="line" data-startTime="1304">can show the new content </span><span class="line" data-startTime="1307">and hide the spinner. </span> <span class="line" data-startTime="1309">If the network </span><span class="line" data-startTime="1309">request fails, and we </span><span class="line" data-startTime="1311">didn't show any cached </span><span class="line" data-startTime="1311">content, then that's a shame. </span> <span class="line" data-startTime="1313">We have to show </span><span class="line" data-startTime="1313">an error message. </span> <span class="line" data-startTime="1315">But if we did show </span><span class="line" data-startTime="1315">cached content, </span><span class="line" data-startTime="1318">and the network request fails, </span><span class="line" data-startTime="1318">we can actually fail silently. </span></p>

<p><span class="line" data-startTime="1321">Because this is just a load </span><span class="line" data-startTime="1321">of a page &mdash; the user hasn't </span><span class="line" data-startTime="1323">hit the Refresh </span><span class="line" data-startTime="1323">button specifically &mdash; </span><span class="line" data-startTime="1325">this is the offline experience. </span> <span class="line" data-startTime="1327">And it works. </span> <span class="line" data-startTime="1328">And this is what a </span><span class="line" data-startTime="1328">lot of native apps do. </span> <span class="line" data-startTime="1331">We can represent that </span><span class="line" data-startTime="1331">diagram with promises. </span> <span class="line" data-startTime="1333">And once again, if promises </span><span class="line" data-startTime="1333">make your eyes bleed, </span><span class="line" data-startTime="1336">then keep an eye on </span><span class="line" data-startTime="1336">HTML5 Rocks next month. </span> <span class="line" data-startTime="1339">Hopefully, there'll </span><span class="line" data-startTime="1339">be an explanation. </span> <span class="line" data-startTime="1341">But actually, we can do better </span><span class="line" data-startTime="1341">than the flow chart because we </span><span class="line" data-startTime="1343">can make the network </span><span class="line" data-startTime="1343">request at the same time </span><span class="line" data-startTime="1345">as we make the cache request. </span> <span class="line" data-startTime="1347">Because why wait </span><span class="line" data-startTime="1347">on the cache before </span><span class="line" data-startTime="1348">we actually try </span><span class="line" data-startTime="1348">going to the network? </span><span class="line" data-startTime="1350">It is possible in extreme cases </span><span class="line" data-startTime="1350">that the network request will </span><span class="line" data-startTime="1353">beat the cache, like if the </span><span class="line" data-startTime="1353">user's hard drive is made </span><span class="line" data-startTime="1355">of old cassette tape, but their </span><span class="line" data-startTime="1355">internet connection's amazing. </span> <span class="line" data-startTime="1358">It is possible. </span></p>

<p><span class="line" data-startTime="1359">We can let the </span><span class="line" data-startTime="1359">two requests race. </span> <span class="line" data-startTime="1362">But we've got these two methods </span><span class="line" data-startTime="1362">where we go and fetch data. </span> <span class="line" data-startTime="1365">And in one, we're asking </span><span class="line" data-startTime="1365">it to go to the cache. </span> <span class="line" data-startTime="1367">And in the other, we're not. </span> <span class="line" data-startTime="1368">How does the page </span><span class="line" data-startTime="1368">tell the ServiceWorker </span><span class="line" data-startTime="1371">were to get the data from? </span><span class="line" data-startTime="1373">Well, here's our </span><span class="line" data-startTime="1373">implementation of fetch data. </span> <span class="line" data-startTime="1375">It's just XHR. </span> <span class="line" data-startTime="1376">It's pretty simple. </span> <span class="line" data-startTime="1379">If options object dot </span><span class="line" data-startTime="1379">useCache is true &mdash; </span><span class="line" data-startTime="1382">if there's no </span><span class="line" data-startTime="1382">ServiceWorker there, </span><span class="line" data-startTime="1384">we're just going to </span><span class="line" data-startTime="1384">reject at this point </span><span class="line" data-startTime="1385">because we can't do </span><span class="line" data-startTime="1385">anything about it. </span> <span class="line" data-startTime="1387">But if the ServiceWorker is </span><span class="line" data-startTime="1387">there, we can set header. </span> <span class="line" data-startTime="1390">We're going to set header x </span><span class="line" data-startTime="1390">useCache to be true and then </span><span class="line" data-startTime="1395">just serve up the XHR. </span> <span class="line" data-startTime="1396">I'm kind of pretending </span><span class="line" data-startTime="1396">that XHR uses promises, </span><span class="line" data-startTime="1398">which it doesn't at the moment. </span> <span class="line" data-startTime="1400">Hopefully one day, it will. </span></p>

<p><span class="line" data-startTime="1402">This header thing looks a </span><span class="line" data-startTime="1402">little bit magic, and it is. </span> <span class="line" data-startTime="1405">But it's not magic </span><span class="line" data-startTime="1405">in the ServiceWorker. </span> <span class="line" data-startTime="1407">It's magic you can </span><span class="line" data-startTime="1407">bring as a developer. </span> <span class="line" data-startTime="1410">Over in the worker, we're </span><span class="line" data-startTime="1410">listening for requests. </span> <span class="line" data-startTime="1413">And if it's to the API, we </span><span class="line" data-startTime="1413">can look for that header. </span> <span class="line" data-startTime="1417">And if that header's </span><span class="line" data-startTime="1417">there, we can just </span><span class="line" data-startTime="1419">go straight to the cache </span><span class="line" data-startTime="1419">and only from the cache. </span> <span class="line" data-startTime="1422">And if it's not there, well, </span><span class="line" data-startTime="1422">we can get rid of that header </span><span class="line" data-startTime="1425">and just go to the </span><span class="line" data-startTime="1425">network because we </span><span class="line" data-startTime="1426">don't want that header hitting </span><span class="line" data-startTime="1426">the network particularly. </span> <span class="line" data-startTime="1427">It's not useful. </span></p>

<p><span class="line" data-startTime="1428">But at the same time, </span><span class="line" data-startTime="1428">we can update the cache </span><span class="line" data-startTime="1430">with the response we get back. </span> <span class="line" data-startTime="1434">The important thing </span><span class="line" data-startTime="1434">about the code </span><span class="line" data-startTime="1435">here is it doesn't </span><span class="line" data-startTime="1435">make any assumptions </span><span class="line" data-startTime="1438">about the network at all. </span> <span class="line" data-startTime="1439">It just tries stuff </span><span class="line" data-startTime="1439">and sees what happens. </span> <span class="line" data-startTime="1441">It's reactive, not </span><span class="line" data-startTime="1441">predictive because predictive </span><span class="line" data-startTime="1444">doesn't work. </span> <span class="line" data-startTime="1446">Case in point, navigator.onLine. </span> <span class="line" data-startTime="1448">Aside from having the </span><span class="line" data-startTime="1448">worst camel casing </span><span class="line" data-startTime="1450">since XMLHttpRequest, </span><span class="line" data-startTime="1450">it's useless. </span> <span class="line" data-startTime="1455">If you have no Wi-Fi </span><span class="line" data-startTime="1455">reception and no other data, </span><span class="line" data-startTime="1458">navigator.onLine is </span><span class="line" data-startTime="1458">going to be false. </span></p>

<p><span class="line" data-startTime="1460">Right. </span> <span class="line" data-startTime="1461">If you have some </span><span class="line" data-startTime="1461">Wi-Fi, it will be true. </span> <span class="line" data-startTime="1466">Even if the router </span><span class="line" data-startTime="1466">you're connected to </span><span class="line" data-startTime="1468">is ultimately plugged into </span><span class="line" data-startTime="1468">some soil, it will be true. </span> <span class="line" data-startTime="1476">Predictive doesn't </span><span class="line" data-startTime="1476">work. navigator.onLine </span><span class="line" data-startTime="1478">doesn't know anything </span><span class="line" data-startTime="1478">outside the device. </span> <span class="line" data-startTime="1481">It only knows about </span><span class="line" data-startTime="1481">the first hop. </span> <span class="line" data-startTime="1484">It doesn't know if the </span><span class="line" data-startTime="1484">rest of the network </span><span class="line" data-startTime="1487">has just soiled itself. </span> <span class="line" data-startTime="1488">It can't predict </span><span class="line" data-startTime="1488">that sort of thing. </span> <span class="line" data-startTime="1491">Instead, just try </span><span class="line" data-startTime="1491">making requests </span><span class="line" data-startTime="1493">and react to what happens. </span> <span class="line" data-startTime="1496">So I've got a couple of </span><span class="line" data-startTime="1496">minutes left of the talk. </span> <span class="line" data-startTime="1498">It's quite short. </span></p>

<p><span class="line" data-startTime="1499">But I wanted to throw </span><span class="line" data-startTime="1499">together some other API </span><span class="line" data-startTime="1501">examples, some stuff that </span><span class="line" data-startTime="1501">I haven't covered so far. </span> <span class="line" data-startTime="1505">If you've got a </span><span class="line" data-startTime="1505">ServiceWorker looking </span><span class="line" data-startTime="1507">like this &mdash; you're caching </span><span class="line" data-startTime="1507">some stuff &mdash; at some point, </span><span class="line" data-startTime="1509">you'll want to change that. </span> <span class="line" data-startTime="1510">You want to change the </span><span class="line" data-startTime="1510">URLs that in there, </span><span class="line" data-startTime="1512">maybe change the routeing, fix </span><span class="line" data-startTime="1512">some bugs, add some new routes, </span><span class="line" data-startTime="1515">whatever. </span> <span class="line" data-startTime="1516">Well, the browser's going </span><span class="line" data-startTime="1516">to check for updates </span><span class="line" data-startTime="1518">to your ServiceWorker </span><span class="line" data-startTime="1518">file, serviceworker.js. </span> <span class="line" data-startTime="1520">It's going to check for updates </span><span class="line" data-startTime="1520">on every page navigation. </span> <span class="line" data-startTime="1524">You can make this not happen </span><span class="line" data-startTime="1524">with HTTP headers if you want. </span> <span class="line" data-startTime="1528">But by default, every </span><span class="line" data-startTime="1528">page navigation. </span> <span class="line" data-startTime="1530">So just change stuff. </span> <span class="line" data-startTime="1531">I'm going to change the URLs. </span> <span class="line" data-startTime="1533">I'm going to use </span><span class="line" data-startTime="1533">cache, static-v2. </span> <span class="line" data-startTime="1536">The fine. </span></p>

<p><span class="line" data-startTime="1537">The browser will pick up the </span><span class="line" data-startTime="1537">byte differences in the file </span><span class="line" data-startTime="1539">and go, oh, this is a new </span><span class="line" data-startTime="1539">version of the ServiceWorker, </span><span class="line" data-startTime="1543">excellent. </span> <span class="line" data-startTime="1544">So it's going to file uninstall </span><span class="line" data-startTime="1544">for that new ServiceWorker. </span> <span class="line" data-startTime="1547">But the old one is </span><span class="line" data-startTime="1547">going to remain running, </span><span class="line" data-startTime="1549">handling requests and </span><span class="line" data-startTime="1549">pages that are active, </span><span class="line" data-startTime="1551">that are actually using it. </span> <span class="line" data-startTime="1553">And that's why we create </span><span class="line" data-startTime="1553">static-v2 rather than mess </span><span class="line" data-startTime="1555">around with static-v1, because </span><span class="line" data-startTime="1555">there are pages still using </span><span class="line" data-startTime="1558">the old version. </span> <span class="line" data-startTime="1559">This new worker won't take </span><span class="line" data-startTime="1559">over dealing with pages </span><span class="line" data-startTime="1563">until the static cache </span><span class="line" data-startTime="1563">is ready, because we've </span><span class="line" data-startTime="1565">asked it to do that. </span></p>

<p><span class="line" data-startTime="1567">But also, it waits for all </span><span class="line" data-startTime="1567">pages using the old version </span><span class="line" data-startTime="1569">to go away. </span> <span class="line" data-startTime="1570">And this is important because </span><span class="line" data-startTime="1570">it means that you won't end up </span><span class="line" data-startTime="1572">with a situation </span><span class="line" data-startTime="1572">where you've made </span><span class="line" data-startTime="1574">some changes to your </span><span class="line" data-startTime="1574">database, but there are still </span><span class="line" data-startTime="1576">some pages trying to use the </span><span class="line" data-startTime="1576">old model, the old pattern. </span> <span class="line" data-startTime="1579">And worse, they're </span><span class="line" data-startTime="1579">saving stuff that's </span><span class="line" data-startTime="1581">not going to be picked </span><span class="line" data-startTime="1581">up by the new version. </span> <span class="line" data-startTime="1585">Of course, you can override </span><span class="line" data-startTime="1585">this, like most things. </span> <span class="line" data-startTime="1588">When you're ready, when </span><span class="line" data-startTime="1588">your static cache is ready, </span><span class="line" data-startTime="1590">you can call event.replace. </span> <span class="line" data-startTime="1591">And this is saying, </span><span class="line" data-startTime="1591">look, I don't care. </span> <span class="line" data-startTime="1593">I am ready to go right now. </span> <span class="line" data-startTime="1594">Kick the other worker out. </span></p>

<p><span class="line" data-startTime="1596">I'm going to take over </span><span class="line" data-startTime="1596">those pages I mean, </span><span class="line" data-startTime="1597">that means you're going to </span><span class="line" data-startTime="1597">be taking over pages that </span><span class="line" data-startTime="1599">were loaded using old </span><span class="line" data-startTime="1599">stuff from the cache. </span> <span class="line" data-startTime="1601">But if you can deal </span><span class="line" data-startTime="1601">with that, that's fine. </span> <span class="line" data-startTime="1603">You can take over straight away. </span> <span class="line" data-startTime="1604">Another method can smooth </span><span class="line" data-startTime="1604">this transition, reloadAll. </span> <span class="line" data-startTime="1607">What this is going </span><span class="line" data-startTime="1607">to tell &mdash; it's </span><span class="line" data-startTime="1609">going to tell the pages that </span><span class="line" data-startTime="1609">are currently active to unload. </span> <span class="line" data-startTime="1612">And when they're all unloaded, </span><span class="line" data-startTime="1612">the new worker will step in, </span><span class="line" data-startTime="1616">and those pages will reload. </span></p>

<p><span class="line" data-startTime="1617">But each page gets the </span><span class="line" data-startTime="1617">opportunity to cancel this. </span> <span class="line" data-startTime="1620">So if in one of the </span><span class="line" data-startTime="1620">pages, the user's </span><span class="line" data-startTime="1622">halfway through writing </span><span class="line" data-startTime="1622">a comment or an email, </span><span class="line" data-startTime="1624">it can go, nope, I'm not ready. </span> <span class="line" data-startTime="1626">I'm going to cancel this. </span> <span class="line" data-startTime="1628">And I'm going to let </span><span class="line" data-startTime="1628">you know when I'm done, </span><span class="line" data-startTime="1631">and we can continue upgrading. </span> <span class="line" data-startTime="1634">You get an event when you're </span><span class="line" data-startTime="1634">ready to take over on activate. </span> <span class="line" data-startTime="1637">And this is the point </span><span class="line" data-startTime="1637">where you'll go and delete </span><span class="line" data-startTime="1639">the old caches because you </span><span class="line" data-startTime="1639">don't need them anymore. </span> <span class="line" data-startTime="1640">The old worker's gone. </span> <span class="line" data-startTime="1641">You can do your IDB schema </span><span class="line" data-startTime="1641">migrations or whatever. </span> <span class="line" data-startTime="1644">You can rearrange file </span><span class="line" data-startTime="1644">systems and so on. </span> <span class="line" data-startTime="1649">So this is us </span><span class="line" data-startTime="1649">controlling the cache </span><span class="line" data-startTime="1650">by changing a list of files. </span> <span class="line" data-startTime="1652">But you can let users </span><span class="line" data-startTime="1652">control the cache themselves </span><span class="line" data-startTime="1656">by deferring that to them. </span> <span class="line" data-startTime="1657">So you might have a page </span><span class="line" data-startTime="1657">with a Read Later button. </span></p>

<p><span class="line" data-startTime="1660">And when it's clicked, </span><span class="line" data-startTime="1660">you can postMessage </span><span class="line" data-startTime="1662">to the ServiceWorker, </span><span class="line" data-startTime="1662">telling it, </span><span class="line" data-startTime="1664">we want to cache the </span><span class="line" data-startTime="1664">article with this ID. </span> <span class="line" data-startTime="1668">And then over in </span><span class="line" data-startTime="1668">the ServiceWorker, </span><span class="line" data-startTime="1669">you can pick that up </span><span class="line" data-startTime="1669">and go, oh, is this </span><span class="line" data-startTime="1671">a post request for read later? </span><span class="line" data-startTime="1673">Cool, I'm going to </span><span class="line" data-startTime="1673">go and find whatever </span><span class="line" data-startTime="1675">URLs I need for that article </span><span class="line" data-startTime="1675">just using XHR or something. </span> <span class="line" data-startTime="1679">And when I've got </span><span class="line" data-startTime="1679">those, I'm going </span><span class="line" data-startTime="1681">to create a new cache </span><span class="line" data-startTime="1681">for them, and I'm </span><span class="line" data-startTime="1684">going to return </span><span class="line" data-startTime="1684">when that's ready. </span> <span class="line" data-startTime="1685">And then I'm going </span><span class="line" data-startTime="1685">to post message </span><span class="line" data-startTime="1686">back to the page to say, </span><span class="line" data-startTime="1686">yes, that thing is now </span><span class="line" data-startTime="1688">available offline. </span> <span class="line" data-startTime="1689">I mean, this is how </span><span class="line" data-startTime="1689">you would do something </span><span class="line" data-startTime="1691">like a Read Later button. </span> <span class="line" data-startTime="1692">It gives you full independent </span><span class="line" data-startTime="1692">control of caching and routing. </span></p>

<p><span class="line" data-startTime="1696">So this is something that </span><span class="line" data-startTime="1696">isn't in the spec yet. </span> <span class="line" data-startTime="1698">But I just wanted to show that </span><span class="line" data-startTime="1698">we were thinking about it. </span> <span class="line" data-startTime="1701">With your caches, </span><span class="line" data-startTime="1701">they're static. </span> <span class="line" data-startTime="1704">But we want you to be able </span><span class="line" data-startTime="1704">to make a cache that updates </span><span class="line" data-startTime="1707">in the background. </span> <span class="line" data-startTime="1708">We don't know the API yet, but </span><span class="line" data-startTime="1708">just something like auto update </span><span class="line" data-startTime="1710">is true. </span> <span class="line" data-startTime="1711">And this means that </span><span class="line" data-startTime="1711">the browser can </span><span class="line" data-startTime="1712">update that cache </span><span class="line" data-startTime="1712">in the background, </span><span class="line" data-startTime="1714">even when the browser's </span><span class="line" data-startTime="1714">not open on the phone. </span> <span class="line" data-startTime="1716">It can just be </span><span class="line" data-startTime="1716">periodically checking </span><span class="line" data-startTime="1718">this stuff for updates. </span> <span class="line" data-startTime="1719">The frequency it </span><span class="line" data-startTime="1719">would do this would </span><span class="line" data-startTime="1721">depend on how often the </span><span class="line" data-startTime="1721">user uses your site, which </span><span class="line" data-startTime="1723">is the iOS model, which </span><span class="line" data-startTime="1723">works pretty well. </span></p>

<p><span class="line" data-startTime="1726">So yeah, all works in </span><span class="line" data-startTime="1726">the background services. </span> <span class="line" data-startTime="1728">It's really nice. </span> <span class="line" data-startTime="1730">Developing for the web </span><span class="line" data-startTime="1730">has huge advantages. </span> <span class="line" data-startTime="1733">If a thing has a </span><span class="line" data-startTime="1733">screen, it's more </span><span class="line" data-startTime="1736">and more likely to </span><span class="line" data-startTime="1736">have a browser on it. </span> <span class="line" data-startTime="1738">Most devices now </span><span class="line" data-startTime="1738">have a browser on. </span> <span class="line" data-startTime="1740">When someone goes </span><span class="line" data-startTime="1740">down the native path </span><span class="line" data-startTime="1742">and develops multiple </span><span class="line" data-startTime="1742">versions of the same thing </span><span class="line" data-startTime="1745">for different languages, as </span><span class="line" data-startTime="1745">a platform, we must ask why </span><span class="line" data-startTime="1748">and fix that bug </span><span class="line" data-startTime="1748">because it is a bug. </span></p>

<p><span class="line" data-startTime="1751">The ServiceWorker is </span><span class="line" data-startTime="1751">one of those fixes, </span><span class="line" data-startTime="1753">as are many of the </span><span class="line" data-startTime="1753">things that are going </span><span class="line" data-startTime="1755">to be covered over </span><span class="line" data-startTime="1755">the next two days. </span> <span class="line" data-startTime="1756">ServiceWorker lets you </span><span class="line" data-startTime="1756">get content on the screen </span><span class="line" data-startTime="1759">seconds faster. </span> <span class="line" data-startTime="1761">You can use it to ride </span><span class="line" data-startTime="1761">smoothly over bumps </span><span class="line" data-startTime="1763">and jams in the network. </span> <span class="line" data-startTime="1765">And it provides the </span><span class="line" data-startTime="1765">groundwork for other things, </span><span class="line" data-startTime="1767">like background syncing, </span><span class="line" data-startTime="1767">alarms, push notifications. </span> <span class="line" data-startTime="1770">We're looking at putting all of </span><span class="line" data-startTime="1770">these things into this model. </span> <span class="line" data-startTime="1773">And I know know. </span> <span class="line" data-startTime="1774">You can probably tell that I'm </span><span class="line" data-startTime="1774">[INAUDIBLE] speaking about it. </span></p>

<p><span class="line" data-startTime="1777">I'm really excited about </span><span class="line" data-startTime="1777">this, and we hope you are too. </span> <span class="line" data-startTime="1780">Thank you very much. </span> <span class="line" data-startTime="1781">Cheers. </span> <span class="line" data-startTime="1782">[APPLAUSE] </span></p></div>