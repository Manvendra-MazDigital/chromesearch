<p><span class="line" data-startTime="5">Thank you, everyone, </span><span class="line" data-startTime="5">for coming today. </span> <span class="line" data-startTime="6">My name is Colt McAnlis. </span> <span class="line" data-startTime="7">I'm a Developer Advocate at </span><span class="line" data-startTime="7">Google focusing on gaming and </span><span class="line" data-startTime="11">web technologies in general. </span> <span class="line" data-startTime="13">You see my email address here, </span><span class="line" data-startTime="13">colton@google.com. </span> <span class="line" data-startTime="16">And we are here today to </span><span class="line" data-startTime="16">talk about a very, </span><span class="line" data-startTime="17">very important topic. </span> <span class="line" data-startTime="19">We're here to talk about </span><span class="line" data-startTime="19">texture compression. </span> <span class="line" data-startTime="21">Now before we get too started, </span><span class="line" data-startTime="21">I'm going to need to see a </span><span class="line" data-startTime="24">show of hands. </span> <span class="line" data-startTime="24">How many of you in here have </span><span class="line" data-startTime="24">actually shipped a product, a </span><span class="line" data-startTime="27">video game, on a console? </span><span class="line" data-startTime="29">So Xbox 360, PS3, Nintendo </span><span class="line" data-startTime="29">DS for that matter? </span><span class="line" data-startTime="33">OK, good. </span> <span class="line" data-startTime="34">So out of those hands &mdash; </span><span class="line" data-startTime="35">you can put them down and </span><span class="line" data-startTime="35">we'll get a new set &mdash; </span><span class="line" data-startTime="37">out of those hands, how many of </span><span class="line" data-startTime="37">you have ever fought with </span><span class="line" data-startTime="39">texture footprint in memory? </span><span class="line" data-startTime="41">OK, Good. </span></p>

<p><span class="line" data-startTime="42">Good, good, good. </span> <span class="line" data-startTime="43">So obviously, you know that </span><span class="line" data-startTime="43">compressing your textures is a </span><span class="line" data-startTime="47">big problem and that, most </span><span class="line" data-startTime="47">importantly, you spend a lot </span><span class="line" data-startTime="49">of time trying to fight your </span><span class="line" data-startTime="49">memory constraints against </span><span class="line" data-startTime="53">what your artists </span><span class="line" data-startTime="53">are producing. </span> <span class="line" data-startTime="54">Well today, we're here to talk </span><span class="line" data-startTime="54">about that specifically. </span> <span class="line" data-startTime="55">And what we want to talk about </span><span class="line" data-startTime="55">is DXT is not enough. </span> <span class="line" data-startTime="58">Now I know there's hardware </span><span class="line" data-startTime="58">architecture differences with </span><span class="line" data-startTime="60">compressed textures and </span><span class="line" data-startTime="60">PVR and ECT and </span><span class="line" data-startTime="63">all these other things. </span> <span class="line" data-startTime="64">So I hope you take what we're </span><span class="line" data-startTime="64">talking about today and how </span><span class="line" data-startTime="66">it's being applied </span><span class="line" data-startTime="66">to DXT texturing. </span></p>

<p><span class="line" data-startTime="68">And I hope you apply it to some </span><span class="line" data-startTime="68">of these other things </span><span class="line" data-startTime="70">that may be platform-specific. </span> <span class="line" data-startTime="72">So all right, let's </span><span class="line" data-startTime="72">get started then. </span> <span class="line" data-startTime="74">So texture footprints matters </span><span class="line" data-startTime="74">for games, as we've already </span><span class="line" data-startTime="77">talked about this. </span> <span class="line" data-startTime="78">How many times have you been </span><span class="line" data-startTime="78">down to the wire or down to </span><span class="line" data-startTime="81">memory and needed an extra five </span><span class="line" data-startTime="81">megabytes for animations </span><span class="line" data-startTime="84">or 10 megabytes for sound? </span><span class="line" data-startTime="85">And you go back and you do your </span><span class="line" data-startTime="85">statistic gathering and </span><span class="line" data-startTime="88">find that your losing 50% or </span><span class="line" data-startTime="88">60% of your entire memory </span><span class="line" data-startTime="92">footprint just for </span><span class="line" data-startTime="92">texture assets. </span> <span class="line" data-startTime="93">And there's tons of different </span><span class="line" data-startTime="93">reasons for this. </span> <span class="line" data-startTime="96">They could need to </span><span class="line" data-startTime="96">be high-res. </span> <span class="line" data-startTime="98">Or there could be too </span><span class="line" data-startTime="98">many MIP chains. </span> <span class="line" data-startTime="100">Or the artists author them at </span><span class="line" data-startTime="100">2048's when they only occupy a </span><span class="line" data-startTime="103">64x64 pixel set on the screen. </span></p>

<p><span class="line" data-startTime="106">Whatever the reasons, right? </span><span class="line" data-startTime="107">For us, this is a big problem </span><span class="line" data-startTime="107">because, as a console </span><span class="line" data-startTime="111">developer, you spend a lot </span><span class="line" data-startTime="111">of time fighting this. </span> <span class="line" data-startTime="113">Retail doesn't really care </span><span class="line" data-startTime="113">a lot about this, though. </span> <span class="line" data-startTime="116">There's a great article &mdash; </span><span class="line" data-startTime="117">I forget which site posted </span><span class="line" data-startTime="117">it &mdash; where John Carmack </span><span class="line" data-startTime="119">actually went to the head of </span><span class="line" data-startTime="119">their publisher at the time </span><span class="line" data-startTime="123">and said, hey, I've got an </span><span class="line" data-startTime="123">amazing new technology. </span> <span class="line" data-startTime="125">It's called MegaTexture. </span> <span class="line" data-startTime="128">And it's awesome. </span> <span class="line" data-startTime="129">You can stream in </span><span class="line" data-startTime="129">infinite detail. </span> <span class="line" data-startTime="130">And it's fantastic. </span></p>

<p><span class="line" data-startTime="131">The problem is that we're now </span><span class="line" data-startTime="131">looking at 17 gigabytes of </span><span class="line" data-startTime="135">data just for one game. </span> <span class="line" data-startTime="137">And in the article, it actually </span><span class="line" data-startTime="137">says that the head of </span><span class="line" data-startTime="140">the publisher said, hey, </span><span class="line" data-startTime="140">that's fantastic. </span> <span class="line" data-startTime="141">I love it. </span> <span class="line" data-startTime="142">This will push our Blu-ray </span><span class="line" data-startTime="142">sales for video games. </span> <span class="line" data-startTime="145">The point of this is that, for </span><span class="line" data-startTime="145">retail developers, that's </span><span class="line" data-startTime="150">good, right? </span><span class="line" data-startTime="151">They're giving out this physical </span><span class="line" data-startTime="151">medium and pushing </span><span class="line" data-startTime="153">this physical medium to consoles </span><span class="line" data-startTime="153">and to PC developers </span><span class="line" data-startTime="156">the 17-gig Blu-rays. </span> <span class="line" data-startTime="159">This is great. </span> <span class="line" data-startTime="160">But for us digital distribution </span><span class="line" data-startTime="160">outlets, as well </span><span class="line" data-startTime="165">as consumers in general, this </span><span class="line" data-startTime="165">isn't a good thing. </span> <span class="line" data-startTime="168">Waiting for 17 to 40 gigabytes </span><span class="line" data-startTime="168">worth of data to play your </span><span class="line" data-startTime="171">game is not good at all. </span></p>

<p><span class="line" data-startTime="173">It takes time. </span> <span class="line" data-startTime="174">It creates a lag between what </span><span class="line" data-startTime="174">the user's expectation is and </span><span class="line" data-startTime="178">pay rate is to when </span><span class="line" data-startTime="178">they actually </span><span class="line" data-startTime="180">experience the content. </span> <span class="line" data-startTime="181">And there's a large gap there </span><span class="line" data-startTime="181">that is directly correlated to </span><span class="line" data-startTime="184">how many users buy your game, </span><span class="line" data-startTime="184">how many users continue to </span><span class="line" data-startTime="187">play your game, and how many </span><span class="line" data-startTime="187">users just get stopped at the </span><span class="line" data-startTime="189">front door. </span> <span class="line" data-startTime="190">And as we all know, especially </span><span class="line" data-startTime="190">the Indies that may be in the </span><span class="line" data-startTime="192">audience today, that's </span><span class="line" data-startTime="192">huge, right? </span><span class="line" data-startTime="194">You want these people </span><span class="line" data-startTime="194">giving you money. </span> <span class="line" data-startTime="196">And creating barriers to their </span><span class="line" data-startTime="196">experience is a bad thing. </span> <span class="line" data-startTime="199">So we talk about texture </span><span class="line" data-startTime="199">compression systems because we </span><span class="line" data-startTime="202">want to avoid 17 gigabytes, </span><span class="line" data-startTime="202">right? </span><span class="line" data-startTime="205">We want to move down. </span> <span class="line" data-startTime="207">You need to look at </span><span class="line" data-startTime="207">it as a triangle. </span></p>

<p><span class="line" data-startTime="209">For instance, this is a nice </span><span class="line" data-startTime="209">little understanding here. </span> <span class="line" data-startTime="212">And again, we're talking about </span><span class="line" data-startTime="212">texture decompression, so </span><span class="line" data-startTime="214">we're talking about the runtime </span><span class="line" data-startTime="216">decompressing of textures. </span> <span class="line" data-startTime="218">It's kind of a performance </span><span class="line" data-startTime="218">triangle where you need to </span><span class="line" data-startTime="221">optimize, based upon your game </span><span class="line" data-startTime="221">and your title, between the </span><span class="line" data-startTime="224">quality of the decompressed </span><span class="line" data-startTime="224">image, the size and the </span><span class="line" data-startTime="227">footprint of the in-memory </span><span class="line" data-startTime="227">representation and then how </span><span class="line" data-startTime="229">fast you can actually decompress </span><span class="line" data-startTime="229">that data. </span> <span class="line" data-startTime="232">And depending on your game, </span><span class="line" data-startTime="232">you'll find a different point </span><span class="line" data-startTime="236">on this triangle. </span> <span class="line" data-startTime="238">So for some of Id stuff, </span><span class="line" data-startTime="238">you may be more towards </span><span class="line" data-startTime="243">decompression speed and </span><span class="line" data-startTime="243">size than quality. </span></p>

<p><span class="line" data-startTime="245">For FarmVille, obviously, you </span><span class="line" data-startTime="245">would want quality and size as </span><span class="line" data-startTime="249">a better metric. </span> <span class="line" data-startTime="250">Maybe speed is not as </span><span class="line" data-startTime="250">big of an issue. </span> <span class="line" data-startTime="252">Who knows? </span><span class="line" data-startTime="253">But you really need to take </span><span class="line" data-startTime="253">this triangle into thought </span><span class="line" data-startTime="255">when you're talking about </span><span class="line" data-startTime="255">decompression and algorithms </span><span class="line" data-startTime="257">in general. </span> <span class="line" data-startTime="258">And hopefully, you'll think </span><span class="line" data-startTime="258">about this while we're talking </span><span class="line" data-startTime="259">about our stuff today too. </span> <span class="line" data-startTime="261">So the state-of-the-art for this </span><span class="line" data-startTime="261">process, let's talk about </span><span class="line" data-startTime="263">what you all are </span><span class="line" data-startTime="263">already doing. </span> <span class="line" data-startTime="265">So you should all know this. </span> <span class="line" data-startTime="266">You should all be familiar with </span><span class="line" data-startTime="266">this as we start forward. </span> <span class="line" data-startTime="269">So the way that people handle </span><span class="line" data-startTime="269">textures today is the artist </span><span class="line" data-startTime="272">usually generates some PSD </span><span class="line" data-startTime="272">file in Photoshop. </span> <span class="line" data-startTime="275">This PSD file is converted to a </span><span class="line" data-startTime="275">DXT texture, either through </span><span class="line" data-startTime="279">Microsoft's tool, or </span><span class="line" data-startTime="279">NVIDIA tools, or </span><span class="line" data-startTime="281">Compressonator from AMD, ATI. </span></p>

<p><span class="line" data-startTime="284">And then that data is usually </span><span class="line" data-startTime="284">just thrown, batch process </span><span class="line" data-startTime="287">ad-hoc, into a zip file or </span><span class="line" data-startTime="287">some sort of compressed, </span><span class="line" data-startTime="290">binary archive. </span> <span class="line" data-startTime="292">And then that archive is then </span><span class="line" data-startTime="292">put on disk or put into </span><span class="line" data-startTime="295">memory, shipped out </span><span class="line" data-startTime="295">with the product. </span> <span class="line" data-startTime="297">And when a level load or the </span><span class="line" data-startTime="297">game loads, usually what </span><span class="line" data-startTime="300">happens is the zip </span><span class="line" data-startTime="300">file is opened up </span><span class="line" data-startTime="304">in memory at runtime. </span> <span class="line" data-startTime="306">The entire zip archive is either </span><span class="line" data-startTime="306">loaded into memory or </span><span class="line" data-startTime="308">kept on disk and then </span><span class="line" data-startTime="308">streamed from. </span> <span class="line" data-startTime="310">And that data is copied right </span><span class="line" data-startTime="310">from the memory, or right from </span><span class="line" data-startTime="313">the compressed version, </span><span class="line" data-startTime="313">right to the GPU. </span> <span class="line" data-startTime="315">So the DXT data that's in the </span><span class="line" data-startTime="315">archive and in memory just </span><span class="line" data-startTime="318">gets, effectively, </span><span class="line" data-startTime="318">mem copied over. </span> <span class="line" data-startTime="320">And this is usually fine. </span></p>

<p><span class="line" data-startTime="322">But the problem here is that you </span><span class="line" data-startTime="322">don't want to always keep </span><span class="line" data-startTime="326">this process going because, </span><span class="line" data-startTime="326">when you open your zip </span><span class="line" data-startTime="329">archive, you either keep the </span><span class="line" data-startTime="329">entire thing in memory or you </span><span class="line" data-startTime="331">keep it all on disc and </span><span class="line" data-startTime="331">stream from it. </span> <span class="line" data-startTime="335">And the point here is that you </span><span class="line" data-startTime="335">should not keep your entire </span><span class="line" data-startTime="337">zip in archive. </span> <span class="line" data-startTime="337">I remember, in my previous life, </span><span class="line" data-startTime="337">we were putting out a </span><span class="line" data-startTime="341">console title on the Xbox 360. </span> <span class="line" data-startTime="343">And we had archives </span><span class="line" data-startTime="343">around four gigs. </span> <span class="line" data-startTime="347">Well, the problem was the </span><span class="line" data-startTime="347">hardware we were working on </span><span class="line" data-startTime="349">only had 512 megs of RAM that </span><span class="line" data-startTime="349">we could actually work with. </span> <span class="line" data-startTime="352">So obviously, keeping the entire </span><span class="line" data-startTime="352">thing in memory is not </span><span class="line" data-startTime="355">a good idea. </span></p>

<p><span class="line" data-startTime="356">On the other side of this, </span><span class="line" data-startTime="356">actually hitting the optical </span><span class="line" data-startTime="359">disk to stream in your data is </span><span class="line" data-startTime="359">not always available as well. </span> <span class="line" data-startTime="363">In addition to that, some of the </span><span class="line" data-startTime="363">data that exists in your </span><span class="line" data-startTime="366">archive is not actually </span><span class="line" data-startTime="366">needed. </span> <span class="line" data-startTime="368">So for instance, let's say </span><span class="line" data-startTime="368">you're loading a level, right? </span><span class="line" data-startTime="371">When you load a level, there's </span><span class="line" data-startTime="371">going to be lots of data. </span> <span class="line" data-startTime="373">There's going to be bounding </span><span class="line" data-startTime="373">volume hierarchies, quad </span><span class="line" data-startTime="376">trees, navigational meshes. </span> <span class="line" data-startTime="377">There's going to be animations </span><span class="line" data-startTime="377">for characters. </span> <span class="line" data-startTime="380">Some of this stuff can actually </span><span class="line" data-startTime="380">be loaded once and </span><span class="line" data-startTime="382">then thrown away, while </span><span class="line" data-startTime="382">other items and other </span><span class="line" data-startTime="384">representations need to be </span><span class="line" data-startTime="384">loaded and continuously used. </span></p>

<p><span class="line" data-startTime="387">And this is where you get the </span><span class="line" data-startTime="387">divide between load and forget </span><span class="line" data-startTime="391">and then load and </span><span class="line" data-startTime="391">continue using </span><span class="line" data-startTime="392">between data and textures. </span> <span class="line" data-startTime="396">So you kind of go, OK, well, if </span><span class="line" data-startTime="396">I have a zip archive that </span><span class="line" data-startTime="399">represents level seven and I </span><span class="line" data-startTime="399">only need to use the first 25% </span><span class="line" data-startTime="403">during load time, and then the </span><span class="line" data-startTime="403">rest of it I need at runtime </span><span class="line" data-startTime="406">for textures or whatever, </span><span class="line" data-startTime="406">then it makes sense to </span><span class="line" data-startTime="409">segment that out. </span> <span class="line" data-startTime="410">And say, OK, well, here's </span><span class="line" data-startTime="410">the pre-load </span><span class="line" data-startTime="412">stuff for level seven. </span> <span class="line" data-startTime="413">And then, here's the runtime </span><span class="line" data-startTime="413">stuff for level seven. </span> <span class="line" data-startTime="416">And then there's sort of a </span><span class="line" data-startTime="416">rabbit hole that, once you </span><span class="line" data-startTime="418">start thinking about this, you </span><span class="line" data-startTime="418">go down this rabbit hole. </span></p>

<p><span class="line" data-startTime="420">And you end up in </span><span class="line" data-startTime="420">utter madness. </span> <span class="line" data-startTime="421">But you don't get the free tea </span><span class="line" data-startTime="421">or the cool hat or the rabbit </span><span class="line" data-startTime="424">running around. </span> <span class="line" data-startTime="424">But you get the craziness of </span><span class="line" data-startTime="424">the experience because what </span><span class="line" data-startTime="428">happens is you start to bin-sort </span><span class="line" data-startTime="428">all of your content </span><span class="line" data-startTime="431">around and figure out these </span><span class="line" data-startTime="431">optimal solutions. </span> <span class="line" data-startTime="433">That's really just madness. </span> <span class="line" data-startTime="435">Really, what you should be doing </span><span class="line" data-startTime="435">is you should find a way </span><span class="line" data-startTime="438">to hyper compress your textures </span><span class="line" data-startTime="438">so that they turn </span><span class="line" data-startTime="441">into a load-once solution. </span> <span class="line" data-startTime="444">And the rest of this talk is </span><span class="line" data-startTime="444">going to be focused explicitly </span><span class="line" data-startTime="446">on this sort of technique. </span></p>

<p><span class="line" data-startTime="447">The idea here is that you're </span><span class="line" data-startTime="447">going to want to hyper </span><span class="line" data-startTime="450">compress your textures in some </span><span class="line" data-startTime="450">way that you can load them </span><span class="line" data-startTime="452">into main memory and keep them </span><span class="line" data-startTime="452">in main memory for the entire </span><span class="line" data-startTime="455">duration of the game, or the </span><span class="line" data-startTime="455">level, or what you need. </span> <span class="line" data-startTime="458">And then, on-demand, decompress </span><span class="line" data-startTime="458">them from whatever </span><span class="line" data-startTime="461">format they're in </span><span class="line" data-startTime="461">to a GPU format. </span> <span class="line" data-startTime="464">And then throw them </span><span class="line" data-startTime="464">away, if you need. </span> <span class="line" data-startTime="466">And this is actually a very </span><span class="line" data-startTime="466">powerful instance, right? </span><span class="line" data-startTime="469">IDtech5 has made waves </span><span class="line" data-startTime="469">with this. </span> <span class="line" data-startTime="472">I've been hearing about </span><span class="line" data-startTime="472">MegaTexture for almost six </span><span class="line" data-startTime="475">years, I think, seven years </span><span class="line" data-startTime="475">has been the big thing. </span></p>

<p><span class="line" data-startTime="477">And RAGE has finally shipped. </span> <span class="line" data-startTime="480">And you can go play the game </span><span class="line" data-startTime="480">and see the RAGE of IDtech5 </span><span class="line" data-startTime="485">and what happens. </span> <span class="line" data-startTime="486">Basically, they realized </span><span class="line" data-startTime="486">that this was a </span><span class="line" data-startTime="488">problem early on, right? </span><span class="line" data-startTime="489">They had tons and tons </span><span class="line" data-startTime="489">of texture data. </span> <span class="line" data-startTime="491">And the way that they handled </span><span class="line" data-startTime="491">this was they stored the </span><span class="line" data-startTime="494">textures in this hyper </span><span class="line" data-startTime="494">compressed format. </span> <span class="line" data-startTime="496">Basically, some of their early </span><span class="line" data-startTime="496">papers by Van Waveren &mdash; </span><span class="line" data-startTime="500">you can find them on the </span><span class="line" data-startTime="500">Intel Developer site &mdash; </span><span class="line" data-startTime="502">actually talk about creating a </span><span class="line" data-startTime="502">variant of JPEG, which is a </span><span class="line" data-startTime="506">DCT block-based format, and </span><span class="line" data-startTime="506">actually compressing them to </span><span class="line" data-startTime="510">DXT at runtime. </span></p>

<p><span class="line" data-startTime="512">So basically, offline, they </span><span class="line" data-startTime="512">would compress them into this </span><span class="line" data-startTime="515">lossy-style format, DCT. </span> <span class="line" data-startTime="516">And then, at runtime, they'd </span><span class="line" data-startTime="516">take that DCT data and then </span><span class="line" data-startTime="519">convert it over to DXT, which </span><span class="line" data-startTime="519">was then mem copied to the </span><span class="line" data-startTime="521">GPU, right? </span><span class="line" data-startTime="523">The cool thing about this is, </span><span class="line" data-startTime="523">according to their research, </span><span class="line" data-startTime="525">they were getting about 112 </span><span class="line" data-startTime="525">megapixels or megatexles a </span><span class="line" data-startTime="528">second on dual core. </span> <span class="line" data-startTime="530">That's a lot of megapixels, </span><span class="line" data-startTime="530">megatexles a second. </span> <span class="line" data-startTime="533">That's a lot of texture data to </span><span class="line" data-startTime="533">be effectively streaming, </span><span class="line" data-startTime="536">converting and moving around. </span> <span class="line" data-startTime="539">Some of the down-sides of this, </span><span class="line" data-startTime="539">though, aren't really </span><span class="line" data-startTime="541">that published. </span> <span class="line" data-startTime="541">But when you actually start </span><span class="line" data-startTime="541">implementing that algorithm </span><span class="line" data-startTime="544">and realizing what's going on </span><span class="line" data-startTime="544">here, or if you've spend a lot </span><span class="line" data-startTime="546">of time with texture </span><span class="line" data-startTime="546">compression, you first realize </span><span class="line" data-startTime="549">that this is very processor </span><span class="line" data-startTime="549">intensive. </span></p>

<p><span class="line" data-startTime="551">You're spending a lot of </span><span class="line" data-startTime="551">CPU time redoing the </span><span class="line" data-startTime="554">same sort of work. </span> <span class="line" data-startTime="555">You're taking a DCT texture, </span><span class="line" data-startTime="555">converting it to DXT. </span> <span class="line" data-startTime="559">In addition to that, this </span><span class="line" data-startTime="559">actually converts and </span><span class="line" data-startTime="561">introduces 2 times the </span><span class="line" data-startTime="561">amount of noise. </span> <span class="line" data-startTime="564">DCT actually is a lossy codec. </span> <span class="line" data-startTime="568">It's a lossy form. </span> <span class="line" data-startTime="569">So what happens is, when you </span><span class="line" data-startTime="569">compress your texture, it's </span><span class="line" data-startTime="572">going to introduce noise </span><span class="line" data-startTime="572">into the texture. </span> <span class="line" data-startTime="574">And then, when you decompress </span><span class="line" data-startTime="574">the texture to compress it to </span><span class="line" data-startTime="578">DXT, DXT is also </span><span class="line" data-startTime="578">a lossy format. </span></p>

<p><span class="line" data-startTime="581">So what's happening is you're </span><span class="line" data-startTime="581">introducing error, reverting </span><span class="line" data-startTime="584">that error, but keeping it </span><span class="line" data-startTime="584">around to some respect and </span><span class="line" data-startTime="586">then introducing new </span><span class="line" data-startTime="586">error again. </span> <span class="line" data-startTime="588">So you're actually getting 2 </span><span class="line" data-startTime="588">times the amount of error in </span><span class="line" data-startTime="590">your image during the </span><span class="line" data-startTime="590">compression process. </span> <span class="line" data-startTime="593">In addition to that, because </span><span class="line" data-startTime="593">of the fact that the DXT </span><span class="line" data-startTime="596">conversion is happening at </span><span class="line" data-startTime="596">runtime, it means that you </span><span class="line" data-startTime="599">can't spend a ton of time </span><span class="line" data-startTime="599">optimizing for how your DXT </span><span class="line" data-startTime="602">blocks should be considered, </span><span class="line" data-startTime="602">right? </span><span class="line" data-startTime="604">Basically, you have to resort </span><span class="line" data-startTime="604">to a box fit or a best fit </span><span class="line" data-startTime="607">algorithm, which might not </span><span class="line" data-startTime="607">actually produce the best </span><span class="line" data-startTime="610">color correlation ratio. </span></p>

<p><span class="line" data-startTime="612">There's tons of algorithms </span><span class="line" data-startTime="612">out there. </span> <span class="line" data-startTime="613">We're going to talk about some </span><span class="line" data-startTime="613">today that allow you to get a </span><span class="line" data-startTime="616">better quality, if you're </span><span class="line" data-startTime="616">working at it offline. </span> <span class="line" data-startTime="620">So here's the idea. </span> <span class="line" data-startTime="620">Here the whole point of this </span><span class="line" data-startTime="620">talk that I'd like to talk </span><span class="line" data-startTime="622">about today. </span> <span class="line" data-startTime="623">So what if we approach this </span><span class="line" data-startTime="623">from a different angle? </span><span class="line" data-startTime="625">What if, instead of taking an </span><span class="line" data-startTime="625">existing compressed form, </span><span class="line" data-startTime="630">decompressing it and translating </span><span class="line" data-startTime="630">it into DXT at </span><span class="line" data-startTime="633">runtime, what if we started with </span><span class="line" data-startTime="633">the DXT data initially? </span><span class="line" data-startTime="636">And we took that DXT data, and </span><span class="line" data-startTime="636">we hyper compressed it? </span><span class="line" data-startTime="640">So we hyper compress the DXT </span><span class="line" data-startTime="640">data more, such that, at </span><span class="line" data-startTime="643">runtime, all we're doing is a </span><span class="line" data-startTime="643">decompression step to get us </span><span class="line" data-startTime="647">our original DXT input. </span> <span class="line" data-startTime="649">So this is the idea. </span></p>

<p><span class="line" data-startTime="650">The idea is that we don't </span><span class="line" data-startTime="650">introduce any new error data </span><span class="line" data-startTime="653">with this because it's just </span><span class="line" data-startTime="653">going from something </span><span class="line" data-startTime="655">compressed back to DXT. </span> <span class="line" data-startTime="657">And then we can actually store </span><span class="line" data-startTime="657">this in memory, hyper </span><span class="line" data-startTime="659">compressed. </span> <span class="line" data-startTime="660">So we load it from our zip file, </span><span class="line" data-startTime="660">keep it in some section </span><span class="line" data-startTime="663">of memory that we're not </span><span class="line" data-startTime="663">using all the time. </span> <span class="line" data-startTime="665">And then we decompress directly </span><span class="line" data-startTime="665">to DXT whenever our </span><span class="line" data-startTime="667">view frustum changes, or we have </span><span class="line" data-startTime="667">a cache invalidation, or </span><span class="line" data-startTime="671">we do a flush, or something </span><span class="line" data-startTime="671">along those lines. </span> <span class="line" data-startTime="674">So in order to test if this is </span><span class="line" data-startTime="674">the right direction to go, we </span><span class="line" data-startTime="679">need some sort of test images </span><span class="line" data-startTime="679">to prove both decompression </span><span class="line" data-startTime="683">time and size and speeds </span><span class="line" data-startTime="683">and whatnot like that. </span> <span class="line" data-startTime="685">So anytime you're doing image </span><span class="line" data-startTime="685">compression block tests, you </span><span class="line" data-startTime="690">have to produce some sort of </span><span class="line" data-startTime="690">conical representation </span><span class="line" data-startTime="692">to take a look at. </span></p>

<p><span class="line" data-startTime="693">So what I've created is </span><span class="line" data-startTime="693">actually a random </span><span class="line" data-startTime="695">collection of images. </span> <span class="line" data-startTime="696">All images behave differently. </span> <span class="line" data-startTime="698">I think it would be </span><span class="line" data-startTime="698">irresponsible on my side to </span><span class="line" data-startTime="702">just use one type of image. </span> <span class="line" data-startTime="703">So I've actually included a </span><span class="line" data-startTime="703">bunch of images in my set from </span><span class="line" data-startTime="706">different things. </span> <span class="line" data-startTime="707">Some are from games &mdash; </span><span class="line" data-startTime="708">the actual PSD, the source </span><span class="line" data-startTime="708">images, the TGAs uncompressed. </span> <span class="line" data-startTime="711">So there's no noise </span><span class="line" data-startTime="711">being added there. </span> <span class="line" data-startTime="713">Some are public. </span> <span class="line" data-startTime="714">For example, the famous Lena </span><span class="line" data-startTime="714">image, which, if you don't </span><span class="line" data-startTime="716">know who Lena is in respect to </span><span class="line" data-startTime="716">compression, please go take a </span><span class="line" data-startTime="720">look at it. </span> <span class="line" data-startTime="721">And some are from </span><span class="line" data-startTime="721">image libraries. </span></p>

<p><span class="line" data-startTime="723">The Kodak Image Library </span><span class="line" data-startTime="723">is actually fantastic. </span> <span class="line" data-startTime="725">It's a lot of high-resolution </span><span class="line" data-startTime="725">images that are great to test </span><span class="line" data-startTime="727">against your own compression </span><span class="line" data-startTime="727">algorithms. </span> <span class="line" data-startTime="730">And then all of the numbers I'm </span><span class="line" data-startTime="730">going to be showing today </span><span class="line" data-startTime="732">for these compression processes </span><span class="line" data-startTime="732">actually include the </span><span class="line" data-startTime="734">DDS headers, which is </span><span class="line" data-startTime="734">about 128 bytes. </span> <span class="line" data-startTime="736">So this is going to skew </span><span class="line" data-startTime="736">the results slightly. </span> <span class="line" data-startTime="740">But if you take that into </span><span class="line" data-startTime="740">account, you have to have the </span><span class="line" data-startTime="742">header of the texture, how big </span><span class="line" data-startTime="742">it is, how many MIPs it is, </span><span class="line" data-startTime="745">what the format is, all </span><span class="line" data-startTime="745">these other things. </span> <span class="line" data-startTime="747">So take that in. </span> <span class="line" data-startTime="748">And then, any percentage values </span><span class="line" data-startTime="748">that I produce on my </span><span class="line" data-startTime="752">slides are actually in </span><span class="line" data-startTime="752">amount of reduction. </span> <span class="line" data-startTime="755">This is basically saying, how </span><span class="line" data-startTime="755">much has been reduced from the </span><span class="line" data-startTime="759">original format so that you're </span><span class="line" data-startTime="759">seeing this large delta to see </span><span class="line" data-startTime="763">what we're saving as all of </span><span class="line" data-startTime="763">these things come together. </span> <span class="line" data-startTime="768">So before we move on, </span><span class="line" data-startTime="768">let's take a look at </span><span class="line" data-startTime="770">a typical DXT block. </span> <span class="line" data-startTime="771">And for the sake of this talk, </span><span class="line" data-startTime="771">I'm going to focus on DXT1 </span><span class="line" data-startTime="774">because, I think, understanding </span><span class="line" data-startTime="774">it from here </span><span class="line" data-startTime="776">allows us to launch off the </span><span class="line" data-startTime="776">different algorithms, DXT3, 5, </span><span class="line" data-startTime="779">DXTN, all these other </span><span class="line" data-startTime="779">sorts of things. </span></p>

<p><span class="line" data-startTime="781">So a DXT block is constructed </span><span class="line" data-startTime="781">likewise. </span> <span class="line" data-startTime="783">First off, it starts by storing </span><span class="line" data-startTime="783">a high color and a low </span><span class="line" data-startTime="786">color in a 5-6-5 bit poly. </span> <span class="line" data-startTime="788">That's red, green, blue </span><span class="line" data-startTime="788">5-bit, 6-bits, 5 bits. </span> <span class="line" data-startTime="791">What these two colors represent </span><span class="line" data-startTime="791">in space is </span><span class="line" data-startTime="794">effectively the endpoints </span><span class="line" data-startTime="794">of a line. </span> <span class="line" data-startTime="795">You can see that, these two </span><span class="line" data-startTime="795">large circles here. </span> <span class="line" data-startTime="800">Then what you end up with is, </span><span class="line" data-startTime="800">with these two high- and </span><span class="line" data-startTime="802">low-colors, you end up with </span><span class="line" data-startTime="802">a 4x4 block of pixels. </span> <span class="line" data-startTime="805">These 4x4 block effectively </span><span class="line" data-startTime="805">only contains </span><span class="line" data-startTime="808">two bits per cell. </span></p>

<p><span class="line" data-startTime="810">And the two bits actually </span><span class="line" data-startTime="810">represent a discrete step </span><span class="line" data-startTime="813">between these two endpoints </span><span class="line" data-startTime="813">in color space, right? </span><span class="line" data-startTime="817">So you can see on the image </span><span class="line" data-startTime="817">here, we've got some random </span><span class="line" data-startTime="820">assortment of colors that </span><span class="line" data-startTime="820">are off the line. </span> <span class="line" data-startTime="822">And effectively, they </span><span class="line" data-startTime="822">get snapped to one </span><span class="line" data-startTime="824">of these four values. </span> <span class="line" data-startTime="826">This is the heart of </span><span class="line" data-startTime="826">DXT compression. </span> <span class="line" data-startTime="828">It allows for a really fast </span><span class="line" data-startTime="828">load, really fast filtering. </span> <span class="line" data-startTime="832">It allows you to keep a lot of </span><span class="line" data-startTime="832">blocks in a mem cache line on </span><span class="line" data-startTime="834">the GPU, which is really </span><span class="line" data-startTime="834">important. </span> <span class="line" data-startTime="836">And in general, it doesn't </span><span class="line" data-startTime="836">actually reduce </span><span class="line" data-startTime="838">the quality too much. </span> <span class="line" data-startTime="839">But it is lossy, so it does </span><span class="line" data-startTime="839">introduce some error. </span></p>

<p><span class="line" data-startTime="843">So let's look at the initial </span><span class="line" data-startTime="843">data set for DXT. </span> <span class="line" data-startTime="846">The uncompressed images </span><span class="line" data-startTime="846">are around 37 megs. </span> <span class="line" data-startTime="850">This is just the source image, </span><span class="line" data-startTime="850">non-compressed, right? </span><span class="line" data-startTime="852">And I could have chosen a </span><span class="line" data-startTime="852">bigger data set size. </span> <span class="line" data-startTime="855">But every time I would run </span><span class="line" data-startTime="855">this set, it takes 15, 20 </span><span class="line" data-startTime="859">minutes to actually run </span><span class="line" data-startTime="859">and get the results. </span> <span class="line" data-startTime="860">And I've got stuff to do today, </span><span class="line" data-startTime="860">so I can't have a </span><span class="line" data-startTime="862">200-megabyte set. </span> <span class="line" data-startTime="864">DXT1, if I just take the source </span><span class="line" data-startTime="864">data and compress it </span><span class="line" data-startTime="866">into DXT1, it gets it down to </span><span class="line" data-startTime="866">about 7.6 megs, which is good. </span></p>

<p><span class="line" data-startTime="870">That's fantastic. </span> <span class="line" data-startTime="871">That's exactly the type of </span><span class="line" data-startTime="871">compression size you want to </span><span class="line" data-startTime="874">see out of DXT. </span> <span class="line" data-startTime="875">If we zip that data, so we do </span><span class="line" data-startTime="875">whatever everyone in the room </span><span class="line" data-startTime="878">is already doing. </span> <span class="line" data-startTime="879">We just take that DXT </span><span class="line" data-startTime="879">data, throw into an </span><span class="line" data-startTime="880">archive, and zip it. </span> <span class="line" data-startTime="881">That ends up at about 4.82 </span><span class="line" data-startTime="881">megs, or about 36%, 37% </span><span class="line" data-startTime="886">savings, which is good. </span> <span class="line" data-startTime="888">It means we're getting </span><span class="line" data-startTime="888">that in addition </span><span class="line" data-startTime="889">to what we're getting. </span></p>

<p><span class="line" data-startTime="891">Now as a form of comparison, </span><span class="line" data-startTime="891">just to look at things a </span><span class="line" data-startTime="894">different way, if we actually </span><span class="line" data-startTime="894">compressed each of the DXT </span><span class="line" data-startTime="898">images individually by zipping </span><span class="line" data-startTime="898">them, we get about 5.1 megs. </span> <span class="line" data-startTime="902">Now notice this is higher. </span> <span class="line" data-startTime="904">The reason for this is because </span><span class="line" data-startTime="904">we're adding all of the </span><span class="line" data-startTime="907">additional zip data overhead. </span> <span class="line" data-startTime="908">So we're adding the headers, </span><span class="line" data-startTime="908">the span chunks, all these </span><span class="line" data-startTime="912">other fun things. </span> <span class="line" data-startTime="913">And there's some other </span><span class="line" data-startTime="913">interesting nuances of why </span><span class="line" data-startTime="916">that footprint is higher that </span><span class="line" data-startTime="916">I'll get to a little bit later </span><span class="line" data-startTime="918">in the talk. </span> <span class="line" data-startTime="919">The goal for this talk, though, </span><span class="line" data-startTime="919">is to beat this. </span> <span class="line" data-startTime="922">We want our compression </span><span class="line" data-startTime="922">algorithm to match what zip is </span><span class="line" data-startTime="926">creating, so that our in memory </span><span class="line" data-startTime="926">version is the same </span><span class="line" data-startTime="930">footprint size as what </span><span class="line" data-startTime="930">we would expect </span><span class="line" data-startTime="932">our of our zip file. </span> <span class="line" data-startTime="933">So the goal is can </span><span class="line" data-startTime="933">we get to that? </span><span class="line" data-startTime="934">Can we beat 36.83% </span><span class="line" data-startTime="934">for our hyper </span><span class="line" data-startTime="938">compressed format in memory? </span><span class="line" data-startTime="940">To do this, I'm going to present </span><span class="line" data-startTime="940">you a bag of tricks. </span></p>

<p><span class="line" data-startTime="942">And these are all separate </span><span class="line" data-startTime="942">items. I'm going to talk about </span><span class="line" data-startTime="945">how each one of these items </span><span class="line" data-startTime="945">changes the footprint size, </span><span class="line" data-startTime="949">the memory size, and then </span><span class="line" data-startTime="949">present them individually so </span><span class="line" data-startTime="951">that you can mix and match them, </span><span class="line" data-startTime="951">depending on your input. </span> <span class="line" data-startTime="953">So for lossless algorithms, so </span><span class="line" data-startTime="953">these are algorithms that do </span><span class="line" data-startTime="956">not introduce any new errors </span><span class="line" data-startTime="956">into the image. </span> <span class="line" data-startTime="959">The first one we're going to </span><span class="line" data-startTime="959">cover is de-interleaving. </span> <span class="line" data-startTime="961">I'll talk about that </span><span class="line" data-startTime="961">in a minute. </span> <span class="line" data-startTime="962">The next one, of course, </span><span class="line" data-startTime="962">is Huffman compression. </span> <span class="line" data-startTime="964">Everyone in here, if you have </span><span class="line" data-startTime="964">a basic computer science </span><span class="line" data-startTime="966">degree, you should have written </span><span class="line" data-startTime="966">a Huffman before. </span> <span class="line" data-startTime="968">The next one is delta </span><span class="line" data-startTime="968">encoding. </span></p>

<p><span class="line" data-startTime="969">This is sort of a tricky </span><span class="line" data-startTime="969">thing that not a lot of </span><span class="line" data-startTime="972">people are aware of. </span> <span class="line" data-startTime="973">And then, finally, we're going </span><span class="line" data-startTime="973">to talk about codebooks and </span><span class="line" data-startTime="974">what codebooks are and </span><span class="line" data-startTime="974">how you can use them. </span> <span class="line" data-startTime="977">Now to really get some amazing </span><span class="line" data-startTime="977">results, we're going to also </span><span class="line" data-startTime="980">talk about one specific </span><span class="line" data-startTime="980">lossy technique. </span> <span class="line" data-startTime="983">And this is actually going to </span><span class="line" data-startTime="983">be an expanding blocks, aka </span><span class="line" data-startTime="985">region of interest-based </span><span class="line" data-startTime="985">finding pattern. </span> <span class="line" data-startTime="988">And I think you'll love what </span><span class="line" data-startTime="988">we come out of that. </span> <span class="line" data-startTime="990">But we're going to save </span><span class="line" data-startTime="990">until the end because </span><span class="line" data-startTime="991">it's the big review. </span> <span class="line" data-startTime="993">So let's start the top </span><span class="line" data-startTime="993">with de-interleaving. </span></p>

<p><span class="line" data-startTime="995">Again, as mentioned before, here </span><span class="line" data-startTime="995">is a standard DXT block. </span> <span class="line" data-startTime="998">You've got your high-color and </span><span class="line" data-startTime="998">your low-color and your 4x4 </span><span class="line" data-startTime="1000">set of selector bits. </span> <span class="line" data-startTime="1002">Now in memory, in GPU memory, </span><span class="line" data-startTime="1002">CPU memory and on-disk in a </span><span class="line" data-startTime="1006">DDS format, effectively, </span><span class="line" data-startTime="1006">you concatenate </span><span class="line" data-startTime="1009">these blocks in memory. </span> <span class="line" data-startTime="1010">So you've got your high-color, </span><span class="line" data-startTime="1010">low-color selector bits, </span><span class="line" data-startTime="1013">high-color, low-color selector </span><span class="line" data-startTime="1013">bits, high-color, low-color </span><span class="line" data-startTime="1015">selector bits. </span> <span class="line" data-startTime="1016">The ideal with de-interleaving </span><span class="line" data-startTime="1016">is what if we actually </span><span class="line" data-startTime="1019">separated those out? </span><span class="line" data-startTime="1020">What if we put all of our high </span><span class="line" data-startTime="1020">and low colors together, and </span><span class="line" data-startTime="1023">then put all of the selector </span><span class="line" data-startTime="1023">bits together? </span><span class="line" data-startTime="1025">The intent here is that, for </span><span class="line" data-startTime="1025">zip compression, which is </span><span class="line" data-startTime="1030">basically a modified version </span><span class="line" data-startTime="1030">of LZW, what they create is </span><span class="line" data-startTime="1035">actually a window. </span></p>

<p><span class="line" data-startTime="1036">And they say, we're </span><span class="line" data-startTime="1036">going to analyze. </span> <span class="line" data-startTime="1038">And we're going to deflate &mdash; </span><span class="line" data-startTime="1040">it's another compression </span><span class="line" data-startTime="1040">algorithm &mdash; we're going to </span><span class="line" data-startTime="1042">deflate everything within this </span><span class="line" data-startTime="1042">window, and then move on to </span><span class="line" data-startTime="1044">the next window and deflate </span><span class="line" data-startTime="1044">everything in that window. </span> <span class="line" data-startTime="1047">So by de-interleaving our </span><span class="line" data-startTime="1047">data, putting all of our </span><span class="line" data-startTime="1049">colors and then all of our </span><span class="line" data-startTime="1049">selector bits in, effectively, </span><span class="line" data-startTime="1051">two separate bins, what we're </span><span class="line" data-startTime="1051">trying to do here is optimize </span><span class="line" data-startTime="1055">for the zip compression </span><span class="line" data-startTime="1055">format. </span> <span class="line" data-startTime="1058">So we're trying to pack as much </span><span class="line" data-startTime="1058">duplicate data into each </span><span class="line" data-startTime="1061">one of those sliding windows </span><span class="line" data-startTime="1061">as we can to, hopefully, </span><span class="line" data-startTime="1064">increase the amount of </span><span class="line" data-startTime="1064">compression we get. </span> <span class="line" data-startTime="1066">So let's check out what </span><span class="line" data-startTime="1066">that looks like. </span> <span class="line" data-startTime="1068">So with DXTi, I've got each </span><span class="line" data-startTime="1068">one of these techniques </span><span class="line" data-startTime="1071">segmented out with a different </span><span class="line" data-startTime="1071">enunciation at the top. </span></p>

<p><span class="line" data-startTime="1075">So de-interleaving, so again </span><span class="line" data-startTime="1075">the DXT1 original footprint </span><span class="line" data-startTime="1078">was 7.63 megs. </span> <span class="line" data-startTime="1080">The interleaved version </span><span class="line" data-startTime="1080">is 7.63 megs. </span> <span class="line" data-startTime="1083">Now again, no compression </span><span class="line" data-startTime="1083">has occurred here. </span> <span class="line" data-startTime="1085">All we've done here is just </span><span class="line" data-startTime="1085">moved around the selector bits </span><span class="line" data-startTime="1089">and color bits so that they're </span><span class="line" data-startTime="1089">homogeneous in </span><span class="line" data-startTime="1092">their sorting here. </span> <span class="line" data-startTime="1093">Now the zip here is fantastic. </span> <span class="line" data-startTime="1095">We've actually went </span><span class="line" data-startTime="1095">to 43% savings. </span> <span class="line" data-startTime="1098">Now if you remember, this is </span><span class="line" data-startTime="1098">basically about a 10%, I </span><span class="line" data-startTime="1101">think, savings here. </span> <span class="line" data-startTime="1101">This is fantastic. </span> <span class="line" data-startTime="1102">This is the end result. </span> <span class="line" data-startTime="1103">So simply by de-interleaving </span><span class="line" data-startTime="1103">your data, you get about 10% </span><span class="line" data-startTime="1108">savings there, which is good. </span> <span class="line" data-startTime="1111">A 10%, 15% savings there, </span><span class="line" data-startTime="1111">which is fantastic. </span> <span class="line" data-startTime="1113">And this is optimized, so </span><span class="line" data-startTime="1113">this is exactly what </span><span class="line" data-startTime="1116">we wanted to see. </span> <span class="line" data-startTime="1117">So that's good. </span></p>

<p><span class="line" data-startTime="1118">The next question is, can we </span><span class="line" data-startTime="1118">reduce the amount of unique </span><span class="line" data-startTime="1120">data in the sliding window </span><span class="line" data-startTime="1120">even further? </span><span class="line" data-startTime="1123">Such that zip can compress </span><span class="line" data-startTime="1123">it even further? </span><span class="line" data-startTime="1126">To do that, we're going to look </span><span class="line" data-startTime="1126">at a common compression </span><span class="line" data-startTime="1128">technique called Huffman. </span> <span class="line" data-startTime="1129">Now Huffman is effectively a </span><span class="line" data-startTime="1129">dictionary creation system. </span> <span class="line" data-startTime="1132">So dictionary systems all work </span><span class="line" data-startTime="1132">in a very specific way. </span> <span class="line" data-startTime="1136">Effectively, they create a </span><span class="line" data-startTime="1136">dictionary symbol of unique </span><span class="line" data-startTime="1140">values that exist </span><span class="line" data-startTime="1140">in the stream. </span></p>

<p><span class="line" data-startTime="1142">And then they replace the </span><span class="line" data-startTime="1142">instance of that symbol in the </span><span class="line" data-startTime="1145">data stream with a </span><span class="line" data-startTime="1145">minimal bit-code </span><span class="line" data-startTime="1148">representation of that. </span> <span class="line" data-startTime="1149">So for instance, Morse code is </span><span class="line" data-startTime="1149">a perfect example of that. </span> <span class="line" data-startTime="1152">They analyzed the English </span><span class="line" data-startTime="1152">language. </span> <span class="line" data-startTime="1154">And they said, E is the most </span><span class="line" data-startTime="1154">common character in the </span><span class="line" data-startTime="1156">English language. </span> <span class="line" data-startTime="1157">Therefore, we're going </span><span class="line" data-startTime="1157">to represent E </span><span class="line" data-startTime="1159">with a single beep. </span> <span class="line" data-startTime="1160">So then, any time you're doing </span><span class="line" data-startTime="1160">scans and whatnot, E is </span><span class="line" data-startTime="1163">represented in the least </span><span class="line" data-startTime="1163">value possible. </span> <span class="line" data-startTime="1165">For an example of this, let's </span><span class="line" data-startTime="1165">say we've got this string, </span><span class="line" data-startTime="1169">four A's, two B's and a C, which </span><span class="line" data-startTime="1169">is, with 8-bit ASCII is </span><span class="line" data-startTime="1172">about 56 bits, right? </span><span class="line" data-startTime="1175">In Huffman, if you just looked </span><span class="line" data-startTime="1175">at the compression stream, A </span><span class="line" data-startTime="1179">is going to be the most </span><span class="line" data-startTime="1179">common symbol. </span> <span class="line" data-startTime="1181">So it's only going to </span><span class="line" data-startTime="1181">get the zero bit. </span></p>

<p><span class="line" data-startTime="1184">B is the second most symbol, </span><span class="line" data-startTime="1184">so it's going </span><span class="line" data-startTime="1186">to get the one bits. </span> <span class="line" data-startTime="1186">And then C is the third </span><span class="line" data-startTime="1186">symbol here, so it's </span><span class="line" data-startTime="1188">going to get two bits. </span> <span class="line" data-startTime="1189">So we go from 56 </span><span class="line" data-startTime="1189">bits to 8 bits. </span> <span class="line" data-startTime="1191">And I there's some of you in the </span><span class="line" data-startTime="1191">audience who are saying, </span><span class="line" data-startTime="1193">actually, that should be </span><span class="line" data-startTime="1193">a little bit different, </span><span class="line" data-startTime="1194">depending on which Huffman </span><span class="line" data-startTime="1194">version you use. </span> <span class="line" data-startTime="1196">We're going to use this </span><span class="line" data-startTime="1196">is an illustration. </span> <span class="line" data-startTime="1198">Please consult Wikipedia for </span><span class="line" data-startTime="1198">all the different versions </span><span class="line" data-startTime="1201">that you can find </span><span class="line" data-startTime="1201">about Huffman. </span> <span class="line" data-startTime="1203">It's actually staggering how </span><span class="line" data-startTime="1203">many different versions of </span><span class="line" data-startTime="1205">Huffman are out there. </span> <span class="line" data-startTime="1206">So make sure you're tuning </span><span class="line" data-startTime="1206">that as you see fit. </span></p>

<p><span class="line" data-startTime="1209">So let's look at what </span><span class="line" data-startTime="1209">this did to us. </span> <span class="line" data-startTime="1211">So we've got DXTih. </span> <span class="line" data-startTime="1212">So this is de-interleaving </span><span class="line" data-startTime="1212">plus Huffman. </span> <span class="line" data-startTime="1216">And also, I want to point out </span><span class="line" data-startTime="1216">at the top here, I'm noting </span><span class="line" data-startTime="1218">that Huffman and the usage of </span><span class="line" data-startTime="1218">Huffman requires you to define </span><span class="line" data-startTime="1222">a symbol size. </span> <span class="line" data-startTime="1224">Now for this test here, I've </span><span class="line" data-startTime="1224">actually chosen 16-bit symbols </span><span class="line" data-startTime="1229">for my colors and 8-bit symbols </span><span class="line" data-startTime="1229">for my selectors. </span> <span class="line" data-startTime="1232">And this has a big bearing on </span><span class="line" data-startTime="1232">how things work, right? </span><span class="line" data-startTime="1235">If I were to use 16-bit for </span><span class="line" data-startTime="1235">selectors, I get less value. </span> <span class="line" data-startTime="1238">If I use 8-bits for colors, </span><span class="line" data-startTime="1238">I get less compression, et </span><span class="line" data-startTime="1241">cetera, et cetera. </span> <span class="line" data-startTime="1241">So let's take a look at this. </span></p>

<p><span class="line" data-startTime="1243">So the standard again, </span><span class="line" data-startTime="1243">7.63 megs for DXT. </span> <span class="line" data-startTime="1246">DXTdih, so de-interleaved </span><span class="line" data-startTime="1246">with Huffman </span><span class="line" data-startTime="1250">encoding, is about 40%. </span> <span class="line" data-startTime="1251">So this is not as good </span><span class="line" data-startTime="1251">as we saw before. </span> <span class="line" data-startTime="1253">We're introducing a little bit </span><span class="line" data-startTime="1253">of noise into the stream here. </span> <span class="line" data-startTime="1257">When you add in the </span><span class="line" data-startTime="1257">zip, though, </span><span class="line" data-startTime="1259">you get back to about &mdash; </span><span class="line" data-startTime="1262">we only get about 1% savings </span><span class="line" data-startTime="1262">by adding the Huffman. </span> <span class="line" data-startTime="1265">So we didn't get much benefit. </span> <span class="line" data-startTime="1267">One important note here is </span><span class="line" data-startTime="1267">though, that again, this is </span><span class="line" data-startTime="1270">optimized for your </span><span class="line" data-startTime="1270">colors up top. </span></p>

<p><span class="line" data-startTime="1272">And basically, what </span><span class="line" data-startTime="1272">I was doing was </span><span class="line" data-startTime="1276">optimizing for my set. </span> <span class="line" data-startTime="1277">Now if you take that into </span><span class="line" data-startTime="1277">account, what you should </span><span class="line" data-startTime="1279">really be doing is finding </span><span class="line" data-startTime="1279">the optimal bit encoding. </span> <span class="line" data-startTime="1285">For what I did this test, </span><span class="line" data-startTime="1285">I just used a </span><span class="line" data-startTime="1286">8-bit row, 4x4 block. </span> <span class="line" data-startTime="1288">So I just took the 4x4 and just </span><span class="line" data-startTime="1288">made that one symbol. </span> <span class="line" data-startTime="1292">In reality, you should scan your </span><span class="line" data-startTime="1292">data input to determine </span><span class="line" data-startTime="1294">what the optimal combination </span><span class="line" data-startTime="1294">provides. </span> <span class="line" data-startTime="1297">So the blog, [? Seibey ?] </span><span class="line" data-startTime="1298">Live &mdash; </span><span class="line" data-startTime="1299">you can see the link at the </span><span class="line" data-startTime="1299">bottom of the slide there &mdash; </span><span class="line" data-startTime="1301">did a similar test where they </span><span class="line" data-startTime="1301">basically figured out what the </span><span class="line" data-startTime="1304">multiple pairings were to </span><span class="line" data-startTime="1304">determine the best symbol </span><span class="line" data-startTime="1306">orientation for this exact </span><span class="line" data-startTime="1306">type of compression. </span> <span class="line" data-startTime="1309">In their particular data set </span><span class="line" data-startTime="1309">that they were using, they </span><span class="line" data-startTime="1311">found that 2x2 blocks of </span><span class="line" data-startTime="1311">selector bits produced the </span><span class="line" data-startTime="1314">highest number of duplicate </span><span class="line" data-startTime="1314">symbols. </span></p>

<p><span class="line" data-startTime="1315">You can see that as the high </span><span class="line" data-startTime="1315">value there in the frequency. </span> <span class="line" data-startTime="1320">In reality, before you actually </span><span class="line" data-startTime="1320">compress your data, </span><span class="line" data-startTime="1321">you should be doing this. </span> <span class="line" data-startTime="1322">You should be going through, per </span><span class="line" data-startTime="1322">texture, finding out what </span><span class="line" data-startTime="1325">the optimal solution is </span><span class="line" data-startTime="1325">and compressing that. </span> <span class="line" data-startTime="1327">And in reality, you should all </span><span class="line" data-startTime="1327">have build farms in here. </span> <span class="line" data-startTime="1330">This is the modern gaming age. </span> <span class="line" data-startTime="1332">You should have some ability to </span><span class="line" data-startTime="1332">kick off a nightly build to </span><span class="line" data-startTime="1334">a farm of servers that </span><span class="line" data-startTime="1334">bake all your data. </span> <span class="line" data-startTime="1336">So the processing involved </span><span class="line" data-startTime="1336">with generating this data </span><span class="line" data-startTime="1339">should not be that </span><span class="line" data-startTime="1339">important to you. </span> <span class="line" data-startTime="1342">So Huffman provided great </span><span class="line" data-startTime="1342">reduction for the base stream, </span><span class="line" data-startTime="1344">but didn't provide too much </span><span class="line" data-startTime="1344">help with our zip </span><span class="line" data-startTime="1346">compression, right? </span><span class="line" data-startTime="1347">So we got our base data </span><span class="line" data-startTime="1347">compressed very nicely. </span> <span class="line" data-startTime="1349">But when you put zip on top </span><span class="line" data-startTime="1349">of it, we didn't see </span><span class="line" data-startTime="1352">too much of a help. </span> <span class="line" data-startTime="1353">Now this is OK. </span></p>

<p><span class="line" data-startTime="1354">This is what we want, right? </span><span class="line" data-startTime="1355">We want that base, non-zipped, </span><span class="line" data-startTime="1355">compressed data to start </span><span class="line" data-startTime="1358">getting lower so </span><span class="line" data-startTime="1358">it matches zip. </span> <span class="line" data-startTime="1361">So delta encoding, let's </span><span class="line" data-startTime="1361">talk about this. </span> <span class="line" data-startTime="1364">Delta encoding will effectively </span><span class="line" data-startTime="1364">encode a stream of </span><span class="line" data-startTime="1366">data by replacing each element </span><span class="line" data-startTime="1366">in the stream with a value </span><span class="line" data-startTime="1370">that represents the data </span><span class="line" data-startTime="1370">from the previous sum. </span> <span class="line" data-startTime="1372">The goal here is to reduce the </span><span class="line" data-startTime="1372">dynamic range of symbols that </span><span class="line" data-startTime="1376">could exist in the </span><span class="line" data-startTime="1376">stream, right? </span><span class="line" data-startTime="1378">And so Huffman encoding will </span><span class="line" data-startTime="1378">basically replace the symbols </span><span class="line" data-startTime="1381">in the stream, based upon </span><span class="line" data-startTime="1381">frequency, with minimal bit </span><span class="line" data-startTime="1384">representations. </span> <span class="line" data-startTime="1385">Delta encoding will scan through </span><span class="line" data-startTime="1385">the string before that </span><span class="line" data-startTime="1389">and, basically, truncate, </span><span class="line" data-startTime="1389">concatenate and quantize to </span><span class="line" data-startTime="1393">create more of the low-band, </span><span class="line" data-startTime="1393">unique signals. </span></p>

<p><span class="line" data-startTime="1397">A perfect example </span><span class="line" data-startTime="1397">of this this. </span> <span class="line" data-startTime="1398">So we've got this string here, </span><span class="line" data-startTime="1398">or this set of numbers, 155, </span><span class="line" data-startTime="1402">156, yada, yada, yada. </span> <span class="line" data-startTime="1404">Now if we just threw this at </span><span class="line" data-startTime="1404">Huffman, the only symbols that </span><span class="line" data-startTime="1407">we would find here as duplicates </span><span class="line" data-startTime="1407">are basically, the </span><span class="line" data-startTime="1409">157's right there. </span> <span class="line" data-startTime="1411">Huffman would say that's the </span><span class="line" data-startTime="1411">most frequent symbol, that </span><span class="line" data-startTime="1413">would get the lowest bit-set. </span> <span class="line" data-startTime="1415">Now if we run this through delta </span><span class="line" data-startTime="1415">encoding first, what </span><span class="line" data-startTime="1418">happens is we create 155, </span><span class="line" data-startTime="1418">1, 1, 0, 0, 64, 1, 3. </span> <span class="line" data-startTime="1423">So basically, what you're seeing </span><span class="line" data-startTime="1423">here is that what we do </span><span class="line" data-startTime="1425">is we say, the first </span><span class="line" data-startTime="1425">symbol is 155. </span> <span class="line" data-startTime="1427">The next symbol is add one. </span> <span class="line" data-startTime="1431">The next symbol to that is </span><span class="line" data-startTime="1431">add one to that value. </span> <span class="line" data-startTime="1433">The next symbol to that is add </span><span class="line" data-startTime="1433">zero, add zero, add 64, add </span><span class="line" data-startTime="1436">one, add three. </span></p>

<p><span class="line" data-startTime="1437">What we've done here, </span><span class="line" data-startTime="1437">effectively, is increased the </span><span class="line" data-startTime="1440">number of duplicate symbols in </span><span class="line" data-startTime="1440">the stream by encoding the </span><span class="line" data-startTime="1445">delta between the values, as </span><span class="line" data-startTime="1445">opposed to the actual values </span><span class="line" data-startTime="1448">themselves. </span> <span class="line" data-startTime="1448">So this decreases the dynamic </span><span class="line" data-startTime="1448">range of the stream. </span> <span class="line" data-startTime="1452">So let's see how this </span><span class="line" data-startTime="1452">did for us. </span> <span class="line" data-startTime="1454">So DXTihd with delta encoding. </span> <span class="line" data-startTime="1458">Base, again, 7.63 megs, </span><span class="line" data-startTime="1458">non-zipped. </span> <span class="line" data-startTime="1462">So just taking the DXT data </span><span class="line" data-startTime="1462">itself about 41%. </span></p>

<p><span class="line" data-startTime="1465">That's good, right? </span><span class="line" data-startTime="1467">And about 45% reduction for </span><span class="line" data-startTime="1467">the zipped version. </span> <span class="line" data-startTime="1469">And that's great, right? </span><span class="line" data-startTime="1471">The problem here is is we're </span><span class="line" data-startTime="1471">starting to see this plateau. </span> <span class="line" data-startTime="1473">We're not getting </span><span class="line" data-startTime="1473">huge results by </span><span class="line" data-startTime="1475">squeezing this stream itself. </span> <span class="line" data-startTime="1478">It might be worth looking at </span><span class="line" data-startTime="1478">a different direction. </span> <span class="line" data-startTime="1481">And with that, we take </span><span class="line" data-startTime="1481">a look at codebooks. </span> <span class="line" data-startTime="1485">Effectively, we create a </span><span class="line" data-startTime="1485">codebook by scanning the DXT </span><span class="line" data-startTime="1488">image and create a codebook </span><span class="line" data-startTime="1488">that lists all the unique </span><span class="line" data-startTime="1491">symbols, sort of like the </span><span class="line" data-startTime="1491">dictionary method. </span> <span class="line" data-startTime="1493">And then we delta encode </span><span class="line" data-startTime="1493">those unique values. </span> <span class="line" data-startTime="1497">Then in the DST block stream &mdash; </span><span class="line" data-startTime="1499">so basically, we create </span><span class="line" data-startTime="1499">all the this </span><span class="line" data-startTime="1500">unique stream of colors. </span></p>

<p><span class="line" data-startTime="1501">We delta encode that. </span> <span class="line" data-startTime="1502">And then, in the block stream, </span><span class="line" data-startTime="1502">we go back and we list a </span><span class="line" data-startTime="1505">256-bit index into </span><span class="line" data-startTime="1505">this codebook. </span> <span class="line" data-startTime="1509">Now, of course, some of you in </span><span class="line" data-startTime="1509">the audience should say, hey, </span><span class="line" data-startTime="1512">wait a minute. </span> <span class="line" data-startTime="1513">What if you've got more </span><span class="line" data-startTime="1513">than 256 colors? </span><span class="line" data-startTime="1514">That's OK. </span> <span class="line" data-startTime="1515">What we actually do is we </span><span class="line" data-startTime="1515">create a sliding window </span><span class="line" data-startTime="1519">approach to ensure that you'll </span><span class="line" data-startTime="1519">always have a 256-bit index. </span> <span class="line" data-startTime="1522">So basically, what we do is, for </span><span class="line" data-startTime="1522">the entire list of colors </span><span class="line" data-startTime="1526">in your codebook, you basically </span><span class="line" data-startTime="1526">say, I'm going to </span><span class="line" data-startTime="1528">create a window of the </span><span class="line" data-startTime="1528">first 256 values. </span></p>

<p><span class="line" data-startTime="1531">Those will be numbered zero to </span><span class="line" data-startTime="1531">255, then the next set of 256, </span><span class="line" data-startTime="1534">and then the next set of 256, </span><span class="line" data-startTime="1534">and the next set of 256. </span> <span class="line" data-startTime="1538">And then, in your actual index </span><span class="line" data-startTime="1538">data stream, you're going to </span><span class="line" data-startTime="1541">make a reference into the proper </span><span class="line" data-startTime="1541">bin of 256 values. </span> <span class="line" data-startTime="1545">And there's some interesting </span><span class="line" data-startTime="1545">ways to make </span><span class="line" data-startTime="1546">sure that this works. </span> <span class="line" data-startTime="1547">There's lots of stuff </span><span class="line" data-startTime="1547">on Wikipedia. </span> <span class="line" data-startTime="1549">I would highly recommend you go </span><span class="line" data-startTime="1549">take a look at that because </span><span class="line" data-startTime="1551">I don't have time today to </span><span class="line" data-startTime="1551">explain the specific nuances. </span> <span class="line" data-startTime="1555">So with that, we actually got </span><span class="line" data-startTime="1555">some different results. </span> <span class="line" data-startTime="1559">It gave some really good ones. </span> <span class="line" data-startTime="1560">So first off, we're at 46% </span><span class="line" data-startTime="1560">without zip compression &mdash; </span><span class="line" data-startTime="1564">that's pretty amazing &mdash; </span><span class="line" data-startTime="1565">and 49% with zip compression. </span> <span class="line" data-startTime="1568">So we're still sort of chasing </span><span class="line" data-startTime="1568">the dragon of zip compression </span><span class="line" data-startTime="1571">and trying to track that down. </span> <span class="line" data-startTime="1573">But again, we're not seeing the </span><span class="line" data-startTime="1573">huge jumps in savings that </span><span class="line" data-startTime="1576">we're expecting. </span> <span class="line" data-startTime="1576">Or we haven't broken that 50%. </span></p>

<p><span class="line" data-startTime="1578">And there's got to be a </span><span class="line" data-startTime="1578">better way to do that. </span> <span class="line" data-startTime="1582">And with that, we're going to </span><span class="line" data-startTime="1582">talk about expanding blocks. </span> <span class="line" data-startTime="1584">Now this is a lossy technique, </span><span class="line" data-startTime="1584">but I think you're going to </span><span class="line" data-startTime="1587">like the results. </span> <span class="line" data-startTime="1587">And so that's why I want </span><span class="line" data-startTime="1587">to bring it up today. </span> <span class="line" data-startTime="1589">So the point here is that </span><span class="line" data-startTime="1589">adjacent DXT cells often share </span><span class="line" data-startTime="1593">color profiles. </span> <span class="line" data-startTime="1595">So 4x4 and the block next to it </span><span class="line" data-startTime="1595">and the block below it and </span><span class="line" data-startTime="1598">block in an adjacent direction </span><span class="line" data-startTime="1598">to it, they're &mdash; </span><span class="line" data-startTime="1601">the way that artists and </span><span class="line" data-startTime="1601">pictures work, the number of </span><span class="line" data-startTime="1604">pixels we have on a screen, </span><span class="line" data-startTime="1604">chances are, those colors are </span><span class="line" data-startTime="1607">all correlated. </span></p>

<p><span class="line" data-startTime="1608">So what if we used an 8x8 </span><span class="line" data-startTime="1608">cell instead of a 4x4? </span><span class="line" data-startTime="1611">Just hypothetically? </span><span class="line" data-startTime="1612">We stored one high- and </span><span class="line" data-startTime="1612">low-color per 8x8. </span> <span class="line" data-startTime="1614">And then we stored six </span><span class="line" data-startTime="1614">64 two-bit selectors. </span> <span class="line" data-startTime="1618">What would this do </span><span class="line" data-startTime="1618">to our image? </span><span class="line" data-startTime="1620">What would the results be? </span><span class="line" data-startTime="1622">Well, let's take </span><span class="line" data-startTime="1622">a look at that. </span> <span class="line" data-startTime="1624">What you're seeing on the screen </span><span class="line" data-startTime="1624">here is two images. </span> <span class="line" data-startTime="1626">The left is the original. </span> <span class="line" data-startTime="1628">The right has been compressed </span><span class="line" data-startTime="1628">with 8x8 blocks instead of 4x4 </span><span class="line" data-startTime="1633">DXT blocks. </span> <span class="line" data-startTime="1634">From this distance, you </span><span class="line" data-startTime="1634">really shouldn't </span><span class="line" data-startTime="1637">see much of a problem. </span> <span class="line" data-startTime="1638">You can see a little bit of </span><span class="line" data-startTime="1638">banding, a little bit </span><span class="line" data-startTime="1642">quantization, maybe some blocks </span><span class="line" data-startTime="1642">for the full image. </span></p>

<p><span class="line" data-startTime="1645">But in general, you shouldn't </span><span class="line" data-startTime="1645">see anything wrong. </span> <span class="line" data-startTime="1647">It's not until we zoom in that </span><span class="line" data-startTime="1647">you actually start seeing </span><span class="line" data-startTime="1649">problems. And even here, it's </span><span class="line" data-startTime="1649">pretty hard to notice. </span> <span class="line" data-startTime="1651">I want to point out where </span><span class="line" data-startTime="1651">the errors are here. </span> <span class="line" data-startTime="1653">If you look at the top of the </span><span class="line" data-startTime="1653">bird's beak, you can see some </span><span class="line" data-startTime="1655">blocking artifacts there. </span> <span class="line" data-startTime="1656">You can see some graininess at </span><span class="line" data-startTime="1656">the bottom of the background. </span> <span class="line" data-startTime="1660">You see the quantization of </span><span class="line" data-startTime="1660">the steps of colors there. </span> <span class="line" data-startTime="1662">But in general, this </span><span class="line" data-startTime="1662">image performs </span><span class="line" data-startTime="1664">very well at 8x8 blocks. </span></p>

<p><span class="line" data-startTime="1667">Here's another example. </span> <span class="line" data-startTime="1668">This is from the Kodak </span><span class="line" data-startTime="1668">suite as well. </span> <span class="line" data-startTime="1670">At this distance, you </span><span class="line" data-startTime="1670">really shouldn't </span><span class="line" data-startTime="1672">see much of a problem. </span> <span class="line" data-startTime="1674">Again, this is 8x8 block </span><span class="line" data-startTime="1674">compressed, right? </span><span class="line" data-startTime="1677">We actually see less problems </span><span class="line" data-startTime="1677">than the parrot because </span><span class="line" data-startTime="1680">there's a lot less smooth </span><span class="line" data-startTime="1680">gradients in this image. </span> <span class="line" data-startTime="1682">And there's more general </span><span class="line" data-startTime="1682">sub-noise, which helps hide </span><span class="line" data-startTime="1685">the DXT artifacts. </span> <span class="line" data-startTime="1687">Now when we zoom in on her </span><span class="line" data-startTime="1687">chin, you actually start </span><span class="line" data-startTime="1689">seeing the problems </span><span class="line" data-startTime="1689">pretty badly. </span> <span class="line" data-startTime="1691">Here, you actually see the block </span><span class="line" data-startTime="1691">and the color truncation </span><span class="line" data-startTime="1694">on her necklace as well as some </span><span class="line" data-startTime="1696">clipping on her chin there. </span> <span class="line" data-startTime="1698">You can actually see these </span><span class="line" data-startTime="1698">problems. But again, you have </span><span class="line" data-startTime="1700">to zoom in all the way </span><span class="line" data-startTime="1700">to look at these. </span> <span class="line" data-startTime="1701">Now if someone's chasing you </span><span class="line" data-startTime="1701">around with a rocket launcher </span><span class="line" data-startTime="1704">at 60 frames a second, you're </span><span class="line" data-startTime="1704">probably not going to care. </span></p>

<p><span class="line" data-startTime="1706">Here's a trick question. </span> <span class="line" data-startTime="1709">Which one's compressed? </span><span class="line" data-startTime="1711">Now this is an in-game </span><span class="line" data-startTime="1711">texture. </span> <span class="line" data-startTime="1713">So this is something </span><span class="line" data-startTime="1713">you would see. </span> <span class="line" data-startTime="1714">This is something that artists </span><span class="line" data-startTime="1714">would generate to put in your </span><span class="line" data-startTime="1716">environment. </span> <span class="line" data-startTime="1716">Which one of these </span><span class="line" data-startTime="1716">is compressed? </span><span class="line" data-startTime="1719">Well, of course, with this </span><span class="line" data-startTime="1719">normal trend, the one on the </span><span class="line" data-startTime="1721">left is the original and the </span><span class="line" data-startTime="1721">one on the right is the </span><span class="line" data-startTime="1723">compressed version. </span> <span class="line" data-startTime="1725">But could you really tell, </span><span class="line" data-startTime="1725">especially with </span><span class="line" data-startTime="1727">this type of image? </span><span class="line" data-startTime="1728">Even when we zoom in, can you </span><span class="line" data-startTime="1728">tell which one of these has </span><span class="line" data-startTime="1731">been quantized 8x8 blocks </span><span class="line" data-startTime="1731">and which hasn't? </span><span class="line" data-startTime="1735">So let's look at the </span><span class="line" data-startTime="1735">results here. </span> <span class="line" data-startTime="1736">This is awesome. </span> <span class="line" data-startTime="1738">With 8x8 blocks explicitly &mdash; </span><span class="line" data-startTime="1738">so we're using 8x8 blocks </span><span class="line" data-startTime="1741">everywhere &mdash; </span><span class="line" data-startTime="1742">we actually end up with our </span><span class="line" data-startTime="1742">zipped and our non-zipped </span><span class="line" data-startTime="1745">memory footprint at exactly the </span><span class="line" data-startTime="1745">same size, 67.7% savings, </span><span class="line" data-startTime="1751">taking the original 37 </span><span class="line" data-startTime="1751">megs down to 2.46. </span></p>

<p><span class="line" data-startTime="1754">This is exactly what we were </span><span class="line" data-startTime="1754">looking for in this research. </span> <span class="line" data-startTime="1756">We were trying to find a way </span><span class="line" data-startTime="1756">to make the uncompressed </span><span class="line" data-startTime="1758">version in memory match what </span><span class="line" data-startTime="1758">we get out of a zip. </span> <span class="line" data-startTime="1761">And we did it by combining </span><span class="line" data-startTime="1761">Huffman encoding, </span><span class="line" data-startTime="1764">deinterlacing, and </span><span class="line" data-startTime="1764">doing 8x8 blocks. </span> <span class="line" data-startTime="1767">It's fantastic. </span> <span class="line" data-startTime="1768">Oh, as well as codebooks. </span> <span class="line" data-startTime="1770">So now let's talk about </span><span class="line" data-startTime="1770">everyone else in here. </span> <span class="line" data-startTime="1772">So you remember that </span><span class="line" data-startTime="1772">triangle, right? </span><span class="line" data-startTime="1773">So everyone else in </span><span class="line" data-startTime="1773">here is say well, </span><span class="line" data-startTime="1774">what about the triangle? </span><span class="line" data-startTime="1774">We've gotten speed, and </span><span class="line" data-startTime="1774">we've gotten quality &mdash; </span><span class="line" data-startTime="1778">or we've gotten compression size </span><span class="line" data-startTime="1778">and we've gotten quality. </span> <span class="line" data-startTime="1780">Now let's talk about speed. </span> <span class="line" data-startTime="1781">So for this style I just </span><span class="line" data-startTime="1781">showed you, which is </span><span class="line" data-startTime="1785">de-interleaving, Huffman </span><span class="line" data-startTime="1785">and [? styles ?] </span><span class="line" data-startTime="1787">delta encoding of codebooks with </span><span class="line" data-startTime="1787">8x8 blocks, using CS101 </span><span class="line" data-startTime="1793">Huffman and delta encoding. </span></p>

<p><span class="line" data-startTime="1794">So I didn't do anything </span><span class="line" data-startTime="1794">special here. </span> <span class="line" data-startTime="1795">I didn't spend any time </span><span class="line" data-startTime="1795">optimizing my Huffman </span><span class="line" data-startTime="1797">decompression or my </span><span class="line" data-startTime="1797">delta encoding. </span> <span class="line" data-startTime="1799">I just threw it in there. </span> <span class="line" data-startTime="1801">With about 67.8% savings, </span><span class="line" data-startTime="1801">I was getting about 73 </span><span class="line" data-startTime="1806">megapixels a second </span><span class="line" data-startTime="1806">on a single core. </span> <span class="line" data-startTime="1809">So this was one core doing this </span><span class="line" data-startTime="1809">compression, which is </span><span class="line" data-startTime="1811">fantastic, right? </span><span class="line" data-startTime="1812">If you go to two cores, </span><span class="line" data-startTime="1812">that's 114. </span> <span class="line" data-startTime="1814">Three cores, you start getting </span><span class="line" data-startTime="1814">into some of the numbers that </span><span class="line" data-startTime="1816">you start seeing here. </span> <span class="line" data-startTime="1818">The cool thing here is that </span><span class="line" data-startTime="1818">that's 1.32 bits per pixel. </span> <span class="line" data-startTime="1822">That's fantastic. </span> <span class="line" data-startTime="1822">DXT is four bits per pixel. </span> <span class="line" data-startTime="1824">And with this technique, we </span><span class="line" data-startTime="1824">get it down to about 1.32. </span></p>

<p><span class="line" data-startTime="1827">That's awesome. </span> <span class="line" data-startTime="1829">So here's the big </span><span class="line" data-startTime="1829">reveal, right? </span><span class="line" data-startTime="1831">This is the entire thing. </span> <span class="line" data-startTime="1833">Why stop at 8x8 blocks? </span><span class="line" data-startTime="1835">What if we actually modified our </span><span class="line" data-startTime="1835">image heuristics to scan, </span><span class="line" data-startTime="1839">based upon the frequency of the </span><span class="line" data-startTime="1839">image, and use somewhere </span><span class="line" data-startTime="1842">between four and 16x16 blocks? </span><span class="line" data-startTime="1846">We do the same thing. </span> <span class="line" data-startTime="1847">We de-interleave, delta encode </span><span class="line" data-startTime="1847">and Huffman encode them. </span> <span class="line" data-startTime="1849">With this, we get about 80% </span><span class="line" data-startTime="1849">reduction at 93 megapixels a </span><span class="line" data-startTime="1852">second for diffuse </span><span class="line" data-startTime="1852">textures only. </span> <span class="line" data-startTime="1855">And that gets us down to </span><span class="line" data-startTime="1855">0.8 bits per pixel. </span> <span class="line" data-startTime="1858">That is amazing. </span> <span class="line" data-startTime="1860">For one core, you're telling </span><span class="line" data-startTime="1860">me I can get </span><span class="line" data-startTime="1861">0.8 bits per pixel. </span></p>

<p><span class="line" data-startTime="1863">And I can decompress 93 </span><span class="line" data-startTime="1863">megatexles a second. </span> <span class="line" data-startTime="1865">That's awesome. </span> <span class="line" data-startTime="1866">This is fantastic, right? </span><span class="line" data-startTime="1867">Of course, you have to do all </span><span class="line" data-startTime="1867">this stuff offline and </span><span class="line" data-startTime="1870">compress it properly. </span> <span class="line" data-startTime="1871">But that's a separate thing. </span> <span class="line" data-startTime="1873">So the bigger reveal is that, </span><span class="line" data-startTime="1873">once I came to all this </span><span class="line" data-startTime="1875">research and got all this stuff </span><span class="line" data-startTime="1875">done a couple of days </span><span class="line" data-startTime="1877">later, a very young, friendly </span><span class="line" data-startTime="1877">gentleman named Rich </span><span class="line" data-startTime="1880">Geldreich, who I've worked with </span><span class="line" data-startTime="1880">at my previous companies, </span><span class="line" data-startTime="1883">decided to put his </span><span class="line" data-startTime="1883">CRUNCH codec &mdash; </span><span class="line" data-startTime="1886">which is his version of texture </span><span class="line" data-startTime="1886">compression &mdash; online. </span> <span class="line" data-startTime="1888">It's licensed very generally. </span> <span class="line" data-startTime="1890">You should go check it out. </span> <span class="line" data-startTime="1892">Click that link there </span><span class="line" data-startTime="1892">and go check it out. </span> <span class="line" data-startTime="1894">He does about the same, about </span><span class="line" data-startTime="1894">between 0.8 and 1.25 bits per </span><span class="line" data-startTime="1898">pixel for his texture </span><span class="line" data-startTime="1899">compression for diffuse textures. </span></p>

<p><span class="line" data-startTime="1902">For normal textures, he gets </span><span class="line" data-startTime="1902">about 1.75 to 2 bits per </span><span class="line" data-startTime="1905">pixel, which is still </span><span class="line" data-startTime="1905">really amazing. </span> <span class="line" data-startTime="1907">This is cutting edge for game </span><span class="line" data-startTime="1907">textures, without having to go </span><span class="line" data-startTime="1909">through a full JPEG </span><span class="line" data-startTime="1909">2000 stack. </span> <span class="line" data-startTime="1913">The thing here that is different </span><span class="line" data-startTime="1913">is that he gets </span><span class="line" data-startTime="1915">about 256 megatexles a second </span><span class="line" data-startTime="1915">decompression, single core. </span> <span class="line" data-startTime="1919">I was only able to get 93. </span> <span class="line" data-startTime="1920">So he's got some dark </span><span class="line" data-startTime="1920">voodoo in there that </span><span class="line" data-startTime="1923">really changes the game. </span> <span class="line" data-startTime="1924">Again, his stuff is up </span><span class="line" data-startTime="1924">on code.google.com. </span> <span class="line" data-startTime="1928">You can get it. </span> <span class="line" data-startTime="1928">You can use it in your game. </span></p>

<p><span class="line" data-startTime="1930">I forget what the </span><span class="line" data-startTime="1930">licenses are. </span> <span class="line" data-startTime="1931">But you should definitely </span><span class="line" data-startTime="1931">go check that out. </span> <span class="line" data-startTime="1934">So take aways, it's actually </span><span class="line" data-startTime="1934">easy to get really simple </span><span class="line" data-startTime="1937">savings with really simple </span><span class="line" data-startTime="1937">algorithms, if you just </span><span class="line" data-startTime="1939">concatenate them in </span><span class="line" data-startTime="1939">the right way. </span> <span class="line" data-startTime="1941">Most importantly, your mileage </span><span class="line" data-startTime="1941">may vary for texture types. </span> <span class="line" data-startTime="1944">What works for an ambient </span><span class="line" data-startTime="1944">occlusion texture really well </span><span class="line" data-startTime="1946">may not work for </span><span class="line" data-startTime="1946">a DXT texture. </span> <span class="line" data-startTime="1948">So it's important to optimize </span><span class="line" data-startTime="1948">and combine each of these </span><span class="line" data-startTime="1951">things to put them together </span><span class="line" data-startTime="1951">to figure out what texture </span><span class="line" data-startTime="1953">profile works best for you. </span> <span class="line" data-startTime="1955">And it's best to spend offline </span><span class="line" data-startTime="1955">doing your compression. </span></p>

<p><span class="line" data-startTime="1957">You want to spend all of your </span><span class="line" data-startTime="1957">time online, while the game is </span><span class="line" data-startTime="1960">running, while you're fighting </span><span class="line" data-startTime="1960">for that 16 millisecond frame </span><span class="line" data-startTime="1963">to get you 60 Hertz, you want </span><span class="line" data-startTime="1963">all of that time to go towards </span><span class="line" data-startTime="1966">what you need. </span> <span class="line" data-startTime="1966">You don't want to be spending </span><span class="line" data-startTime="1966">a lot of time decompressing </span><span class="line" data-startTime="1968">and compressing. </span> <span class="line" data-startTime="1969">So do all of your compression </span><span class="line" data-startTime="1969">offline. </span> <span class="line" data-startTime="1971">And do your decompression </span><span class="line" data-startTime="1971">online. </span> <span class="line" data-startTime="1973">So that's it for me. </span> <span class="line" data-startTime="1974">Big thanks to Rich Geldreich, </span><span class="line" data-startTime="1974">John Brooks and Ken Adams for </span><span class="line" data-startTime="1977">their help in this talk. </span></p>

<p><span class="line" data-startTime="1978">You can see our final </span><span class="line" data-startTime="1978">table here. </span> <span class="line" data-startTime="1979">And feel free to contact me </span><span class="line" data-startTime="1979">any time you nee need </span><span class="line" data-startTime="1980">questions, colton@google.com. </span> <span class="line" data-startTime="1983">Thank you all, very much. </span> <span class="line" data-startTime="1983">Have a good day. </span></p>