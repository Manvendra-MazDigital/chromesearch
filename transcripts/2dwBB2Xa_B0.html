<p><span class="line" data-startTime="7">ETIAN KONIGSBURG: </span><span class="line" data-startTime="7">So hi, everybody. </span> <span class="line" data-startTime="8">My name's Etian Konigsburg. </span> <span class="line" data-startTime="10">I'm a frontend </span><span class="line" data-startTime="10">software architect here </span><span class="line" data-startTime="12">at the "New York Times". </span> <span class="line" data-startTime="13">Today I'm going to </span><span class="line" data-startTime="13">be talking about </span><span class="line" data-startTime="15">the very real history of our </span><span class="line" data-startTime="15">web performance efforts here </span><span class="line" data-startTime="19">at the "New York Times". </span> <span class="line" data-startTime="21">Before I dive in, I </span><span class="line" data-startTime="21">wanted to share with you </span><span class="line" data-startTime="22">this tweet by Steve </span><span class="line" data-startTime="22">Souders himself. </span> <span class="line" data-startTime="24">If you're not familiar </span><span class="line" data-startTime="24">Steve Souders, </span><span class="line" data-startTime="26">it's the place to </span><span class="line" data-startTime="26">start when you're </span><span class="line" data-startTime="27">talking about web performance. </span> <span class="line" data-startTime="29">He tweeted, "Is </span><span class="line" data-startTime="29">performance of 'the Web' </span><span class="line" data-startTime="31">getting better or worse? </span><span class="line" data-startTime="32">My past week was </span><span class="line" data-startTime="32">painfully slow, marred </span><span class="line" data-startTime="34">by top sites w/bad WebPerf. </span></p>

<p><span class="line" data-startTime="36">Is it too hard?" </span><span class="line" data-startTime="38">I don't know if the "New York </span><span class="line" data-startTime="38">Times" was among the sites </span><span class="line" data-startTime="40">that Steve was </span><span class="line" data-startTime="40">having trouble with. </span> <span class="line" data-startTime="42">We've known that we've had a </span><span class="line" data-startTime="42">little bit of a performance </span><span class="line" data-startTime="44">problem. </span> <span class="line" data-startTime="45">I like to think that </span><span class="line" data-startTime="45">he's checking our site </span><span class="line" data-startTime="47">and he's actually complaining </span><span class="line" data-startTime="47">for real that our site is slow </span><span class="line" data-startTime="50">so that we make it faster him. </span> <span class="line" data-startTime="51">But I'm going to get </span><span class="line" data-startTime="51">back to this question </span><span class="line" data-startTime="53">about whether it's too hard. </span> <span class="line" data-startTime="56">So while I was </span><span class="line" data-startTime="56">preparing for this talk, </span><span class="line" data-startTime="58">I was thinking that this </span><span class="line" data-startTime="58">is a very real story. </span> <span class="line" data-startTime="60">And it reminded me of a </span><span class="line" data-startTime="60">GEICO ad from about 2006 </span><span class="line" data-startTime="63">that I just kind of </span><span class="line" data-startTime="63">wanted to share with you. </span> <span class="line" data-startTime="65">So just give me one sec to play. </span></p>

<p><span class="line" data-startTime="68">[VIDEO PLAYBLACK] </span><span class="line" data-startTime="70">-Paula Sala is a real GEICO </span><span class="line" data-startTime="70">customer, not an actor. </span> <span class="line" data-startTime="73">So to help tell her story, </span><span class="line" data-startTime="73">we hired that announcer guy </span><span class="line" data-startTime="75">from the movies. </span> <span class="line" data-startTime="76">-When the storm hit, both our </span><span class="line" data-startTime="76">cars were totally under water. </span> <span class="line" data-startTime="80">-In a world where both of our </span><span class="line" data-startTime="80">cars were totally under water. </span> <span class="line" data-startTime="84">-We thought it would take </span><span class="line" data-startTime="84">forever to get some help. </span> <span class="line" data-startTime="87">-But a new wind </span><span class="line" data-startTime="87">was about to blow. </span> <span class="line" data-startTime="90">-With GEICO, we had </span><span class="line" data-startTime="90">our check in two days. </span> <span class="line" data-startTime="93">-Payback. </span> <span class="line" data-startTime="93">This time, it's for real. </span> <span class="line" data-startTime="96">-GEICO. </span></p>

<p><span class="line" data-startTime="97">Real service. </span> <span class="line" data-startTime="98">Real savings. </span></p>

<p class="speaker"><span class="line" data-starttime="98"><span class="speakerName">Etian Konigsburg</span>: So I thought </span><span class="line" data-startTime="98">about doing this entire talk </span><span class="line" data-startTime="101">in movie announcer voice. </span> <span class="line" data-startTime="103">I didn't think I'd be able to </span><span class="line" data-startTime="103">keep it up all the way through. </span> <span class="line" data-startTime="106">Colt is actually </span><span class="line" data-startTime="106">the expert at that. </span> <span class="line" data-startTime="107">So you should check out </span><span class="line" data-startTime="107">his talk on National Talk </span><span class="line" data-startTime="110">Like A Pirate Day. </span> <span class="line" data-startTime="111">That was actually really great. </span> <span class="line" data-startTime="113">Kudos. </span> <span class="line" data-startTime="114">So in a world of static pages. </span> <span class="line" data-startTime="119">Pages on our website </span><span class="line" data-startTime="119">are published basically </span><span class="line" data-startTime="121">like you would a newspaper. </span> <span class="line" data-startTime="123">Somebody hits a button, the </span><span class="line" data-startTime="123">content goes through templates </span><span class="line" data-startTime="126">and is written to disk. </span></p>

<p><span class="line" data-startTime="128">And we mix it with a </span><span class="line" data-startTime="128">proprietary language </span><span class="line" data-startTime="130">that we compile to give a </span><span class="line" data-startTime="130">little bit of dynamicism </span><span class="line" data-startTime="134">on the server side. </span> <span class="line" data-startTime="135">And it was fast. </span> <span class="line" data-startTime="137">We have about 1 million of </span><span class="line" data-startTime="137">these static pages since 2004. </span> <span class="line" data-startTime="141">And re-publishing them is </span><span class="line" data-startTime="141">really not an option for us. </span> <span class="line" data-startTime="143">If hypothetically it </span><span class="line" data-startTime="143">took about five seconds </span><span class="line" data-startTime="145">to re-publish one </span><span class="line" data-startTime="145">of these pages, </span><span class="line" data-startTime="147">5 million seconds I think </span><span class="line" data-startTime="147">comes out to about two months. </span> <span class="line" data-startTime="151">We can't be doing that </span><span class="line" data-startTime="151">every time we make a change. </span> <span class="line" data-startTime="153">So what ends up happening is </span><span class="line" data-startTime="153">it's extremely hard for us </span><span class="line" data-startTime="156">to change markup once </span><span class="line" data-startTime="156">it's been published. </span> <span class="line" data-startTime="159">And every time we </span><span class="line" data-startTime="159">make a change, it's </span><span class="line" data-startTime="161">only present from the </span><span class="line" data-startTime="161">day we deployed onward, </span><span class="line" data-startTime="163">which means we have an </span><span class="line" data-startTime="163">unknown number of permutations </span><span class="line" data-startTime="166">of these markups to handle </span><span class="line" data-startTime="166">and support over time. </span></p>

<p><span class="line" data-startTime="170">So our frontend assets, </span><span class="line" data-startTime="170">our JavaScript and CSS, </span><span class="line" data-startTime="172">have to handle all of </span><span class="line" data-startTime="172">these permutations. </span> <span class="line" data-startTime="175">And in order to be able </span><span class="line" data-startTime="175">to change these files, </span><span class="line" data-startTime="177">since we can't change the </span><span class="line" data-startTime="177">asset path because the HTML is </span><span class="line" data-startTime="180">static, we have to </span><span class="line" data-startTime="180">keep the time to live, </span><span class="line" data-startTime="183">the cache expiration timeout, </span><span class="line" data-startTime="183">very low on these files, which </span><span class="line" data-startTime="187">is a performance bad practice. </span> <span class="line" data-startTime="189">And we also don't really </span><span class="line" data-startTime="189">know what pages on the site </span><span class="line" data-startTime="192">call which assets in general. </span> <span class="line" data-startTime="195">So I want to talk </span><span class="line" data-startTime="195">about our CSS history. </span></p>

<p><span class="line" data-startTime="197">We didn't really </span><span class="line" data-startTime="197">have a CSS framework, </span><span class="line" data-startTime="199">which means we have a </span><span class="line" data-startTime="199">lot of repetitive styles. </span> <span class="line" data-startTime="202">Files were imported </span><span class="line" data-startTime="202">basically as needed. </span> <span class="line" data-startTime="206">Style sheets approached. </span> <span class="line" data-startTime="208">The import limits in IE, 31 </span><span class="line" data-startTime="208">total and maybe up to three </span><span class="line" data-startTime="212">nested levels deep. </span> <span class="line" data-startTime="214">There was inconsistent </span><span class="line" data-startTime="214">load style. </span> <span class="line" data-startTime="215">We were using link tags in </span><span class="line" data-startTime="215">one case, and right after it, </span><span class="line" data-startTime="217">using a style tag with </span><span class="line" data-startTime="217">an @import directive. </span> <span class="line" data-startTime="221">And basically, we also have </span><span class="line" data-startTime="221">to deal with web producers who </span><span class="line" data-startTime="225">who go through, and they're </span><span class="line" data-startTime="225">able to modify the look </span><span class="line" data-startTime="227">and feel of our page on the </span><span class="line" data-startTime="227">fly as the news happens. </span> <span class="line" data-startTime="230">So they can be dropped </span><span class="line" data-startTime="230">into our content system </span><span class="line" data-startTime="232">and appear anywhere on the page. </span></p>

<p><span class="line" data-startTime="234">In the JavaScript department, </span><span class="line" data-startTime="234">JavaScript was very ad hoc. </span> <span class="line" data-startTime="237">Since most of the dynamicism </span><span class="line" data-startTime="237">was on the server side, </span><span class="line" data-startTime="240">we basically used </span><span class="line" data-startTime="240">JS basically as </span><span class="line" data-startTime="242">needed to fix </span><span class="line" data-startTime="242">cross-browser issues, </span><span class="line" data-startTime="245">to do widgets that </span><span class="line" data-startTime="245">respond to events </span><span class="line" data-startTime="246">by the user in the browser. </span> <span class="line" data-startTime="248">Most of the variables </span><span class="line" data-startTime="248">and functions are global. </span> <span class="line" data-startTime="251">Script tags are dropped </span><span class="line" data-startTime="251">wherever they were needed. </span> <span class="line" data-startTime="253">You would define a new </span><span class="line" data-startTime="253">div, leave it empty, </span><span class="line" data-startTime="255">and you'd put a script </span><span class="line" data-startTime="255">tag right after it. </span> <span class="line" data-startTime="257">We didn't defer execution, </span><span class="line" data-startTime="257">another performance no no. </span> <span class="line" data-startTime="260">We didn't have a DOM </span><span class="line" data-startTime="260">framework to handle </span><span class="line" data-startTime="262">any cross-browser functionality. </span> <span class="line" data-startTime="266">That framework war happened and </span><span class="line" data-startTime="266">we still hadn't picked one yet. </span> <span class="line" data-startTime="270">Some words on images. </span> <span class="line" data-startTime="272">Basically, the UI images </span><span class="line" data-startTime="272">that are part of a product </span><span class="line" data-startTime="275">would get uploaded </span><span class="line" data-startTime="275">individually to production. </span></p>

<p><span class="line" data-startTime="277">You could easily forget </span><span class="line" data-startTime="277">how to do that when </span><span class="line" data-startTime="280">you were deploying, </span><span class="line" data-startTime="280">so they would </span><span class="line" data-startTime="282">go missing for a little while. </span> <span class="line" data-startTime="283">Our content photography </span><span class="line" data-startTime="283">is extremely hard for us </span><span class="line" data-startTime="286">to optimize. </span> <span class="line" data-startTime="287">We have a lot of pride </span><span class="line" data-startTime="287">in our photography. </span> <span class="line" data-startTime="289">There's a lot of resistance </span><span class="line" data-startTime="289">in making them smaller </span><span class="line" data-startTime="291">and not featuring them </span><span class="line" data-startTime="291">as largely on our pages. </span> <span class="line" data-startTime="294">We did some experiments </span><span class="line" data-startTime="294">with lossless compression. </span> <span class="line" data-startTime="297">We actually, for </span><span class="line" data-startTime="297">color novices, we </span><span class="line" data-startTime="299">noticed some colors changing </span><span class="line" data-startTime="299">in whatever these tools were. </span> <span class="line" data-startTime="303">There's a whole department here </span><span class="line" data-startTime="303">that does color correction, </span><span class="line" data-startTime="305">and the red walls don't </span><span class="line" data-startTime="305">appear in their area </span><span class="line" data-startTime="308">so that they don't have a </span><span class="line" data-startTime="308">little bit of red dilution </span><span class="line" data-startTime="311">on their screens to do </span><span class="line" data-startTime="311">this color correction. </span></p>

<p><span class="line" data-startTime="315">It's basically a manual </span><span class="line" data-startTime="315">process to resize these images. </span> <span class="line" data-startTime="318">We have a lot of them. </span> <span class="line" data-startTime="320">And in order for them to be </span><span class="line" data-startTime="320">fast and have them be smaller, </span><span class="line" data-startTime="322">people have to cut them and make </span><span class="line" data-startTime="322">sure they don't crop something </span><span class="line" data-startTime="325">out of the picture. </span> <span class="line" data-startTime="326">Because it's manual, it </span><span class="line" data-startTime="326">doesn't happen a lot. </span> <span class="line" data-startTime="328">Other concerns for the business. </span> <span class="line" data-startTime="330">We have these </span><span class="line" data-startTime="330">editorial constraints. </span> <span class="line" data-startTime="332">Like I mentioned </span><span class="line" data-startTime="332">earlier, producers </span><span class="line" data-startTime="334">have a need to adjust based on </span><span class="line" data-startTime="334">what's happening in the news. </span> <span class="line" data-startTime="338">So we use this </span><span class="line" data-startTime="338">freeform module where </span><span class="line" data-startTime="340">they can drop any </span><span class="line" data-startTime="340">bit of HTML code. </span></p>

<p><span class="line" data-startTime="342">It doesn't even have </span><span class="line" data-startTime="342">to be balanced tags, </span><span class="line" data-startTime="346">so this can easily </span><span class="line" data-startTime="346">mess up our page. </span> <span class="line" data-startTime="348">But they have the </span><span class="line" data-startTime="348">freedom to do that. </span> <span class="line" data-startTime="349">And we have to be able to handle </span><span class="line" data-startTime="349">styles and scripts occurring </span><span class="line" data-startTime="352">in them. </span> <span class="line" data-startTime="353">And ads, of course. </span> <span class="line" data-startTime="355">They're top-level </span><span class="line" data-startTime="355">objects in our DOM. </span> <span class="line" data-startTime="357">They're not treated </span><span class="line" data-startTime="357">in any special way. </span> <span class="line" data-startTime="359">They bring their own copies </span><span class="line" data-startTime="359">of DOM frameworks in. </span> <span class="line" data-startTime="361">We get older versions of jQuery. </span> <span class="line" data-startTime="362">We saw an ad that tried </span><span class="line" data-startTime="362">to encapsulate prototype </span><span class="line" data-startTime="367">which, if you're familiar </span><span class="line" data-startTime="367">with how prototype.js works, </span><span class="line" data-startTime="369">it modifies built-in </span><span class="line" data-startTime="369">objects in the browser. </span> <span class="line" data-startTime="372">You can't actually </span><span class="line" data-startTime="372">contain it in a box, </span><span class="line" data-startTime="375">so it didn't really work. </span> <span class="line" data-startTime="377">Ads animate as </span><span class="line" data-startTime="377">soon as they load. </span></p>

<p><span class="line" data-startTime="379">We get a lot of painting </span><span class="line" data-startTime="379">issues when animations </span><span class="line" data-startTime="382">happen while the </span><span class="line" data-startTime="382">page is loading. </span> <span class="line" data-startTime="384">And basically, they are </span><span class="line" data-startTime="384">higher in the DOM order </span><span class="line" data-startTime="388">as the page is loading than </span><span class="line" data-startTime="388">our own logo on the homepage. </span> <span class="line" data-startTime="391">You'll see two ads, </span><span class="line" data-startTime="391">and then you'll </span><span class="line" data-startTime="392">see our logo if you </span><span class="line" data-startTime="392">look at the source. </span> <span class="line" data-startTime="395">So just to caveat </span><span class="line" data-startTime="395">all of this history, </span><span class="line" data-startTime="396">it wasn't really </span><span class="line" data-startTime="396">entirely all bad. </span> <span class="line" data-startTime="398">We do use a CDN. </span> <span class="line" data-startTime="400">We've had Akamai for </span><span class="line" data-startTime="400">a number of years. </span> <span class="line" data-startTime="402">It's been great. </span> <span class="line" data-startTime="404">We did turn GSIP on in 2007. </span> <span class="line" data-startTime="409">The bandwidth savings </span><span class="line" data-startTime="409">were actually immediate, </span><span class="line" data-startTime="411">and there were a lot </span><span class="line" data-startTime="411">of really happy people </span><span class="line" data-startTime="412">as soon as we did that. </span> <span class="line" data-startTime="413">But it wasn't on </span><span class="line" data-startTime="413">previously, and it's worth </span><span class="line" data-startTime="416">mentioning that </span><span class="line" data-startTime="416">we did turn it on. </span></p>

<p><span class="line" data-startTime="418">So a new wind for </span><span class="line" data-startTime="418">our efforts, and what </span><span class="line" data-startTime="421">we were trying to do starting </span><span class="line" data-startTime="421">in 2009 to make the site faster. </span> <span class="line" data-startTime="424">2009 was the year </span><span class="line" data-startTime="424">we were focusing </span><span class="line" data-startTime="425">on tools and libraries. </span> <span class="line" data-startTime="427">We basically built a new build </span><span class="line" data-startTime="427">system for frontend files. </span> <span class="line" data-startTime="431">And this was our first foray </span><span class="line" data-startTime="431">into doing automatic builds. </span> <span class="line" data-startTime="434">We used to manually </span><span class="line" data-startTime="434">untar uncompressed files </span><span class="line" data-startTime="438">in production. </span> <span class="line" data-startTime="439">And we were actually pulling </span><span class="line" data-startTime="439">changes from version control as </span><span class="line" data-startTime="442">opposed to somebody's </span><span class="line" data-startTime="442">home directory. </span> <span class="line" data-startTime="444">They would arrange the files the </span><span class="line" data-startTime="444">way they wanted them to appear, </span><span class="line" data-startTime="447">we would package them up, and </span><span class="line" data-startTime="447">someone would unpackage it. </span></p>

<p><span class="line" data-startTime="450">Now it's coming from </span><span class="line" data-startTime="450">version control directly. </span> <span class="line" data-startTime="453">There were </span><span class="line" data-startTime="453">semi-stateful rollbacks. </span> <span class="line" data-startTime="454">There was a rollback </span><span class="line" data-startTime="454">mechanism, but you could really </span><span class="line" data-startTime="456">only roll back the latest one. </span> <span class="line" data-startTime="459">If you tried to roll </span><span class="line" data-startTime="459">back any before that, </span><span class="line" data-startTime="461">you would end up in an unknown </span><span class="line" data-startTime="461">state, and that was really bad. </span> <span class="line" data-startTime="464">But the really </span><span class="line" data-startTime="464">exciting bit of it </span><span class="line" data-startTime="465">was that there were </span><span class="line" data-startTime="465">hooks for build scripts. </span> <span class="line" data-startTime="469">And we can expand on this </span><span class="line" data-startTime="469">process basically dynamically. </span> <span class="line" data-startTime="473">So we did just that for our CSS. </span> <span class="line" data-startTime="475">It was the first system </span><span class="line" data-startTime="475">to use those new hooks. </span> <span class="line" data-startTime="477">And we wrote a bunch </span><span class="line" data-startTime="477">proprietary scripts </span><span class="line" data-startTime="480">to not only unravel the ad </span><span class="line" data-startTime="480">import directives to make </span><span class="line" data-startTime="482">one concatenated file, </span><span class="line" data-startTime="482">we wrote a script </span><span class="line" data-startTime="485">to also try and to remove </span><span class="line" data-startTime="485">some of the white space </span><span class="line" data-startTime="487">and the comments. </span></p>

<p><span class="line" data-startTime="489">This was all downstream </span><span class="line" data-startTime="489">from development work, which </span><span class="line" data-startTime="491">is also a really good point. </span> <span class="line" data-startTime="492">We didn't want our </span><span class="line" data-startTime="492">developers to feel </span><span class="line" data-startTime="495">that they couldn't comment </span><span class="line" data-startTime="495">their work adequately. </span> <span class="line" data-startTime="498">While we were </span><span class="line" data-startTime="498">doing this, we were </span><span class="line" data-startTime="499">working on our CSS framework. </span> <span class="line" data-startTime="501">We took the concepts </span><span class="line" data-startTime="501">from our design, </span><span class="line" data-startTime="504">and we turned them </span><span class="line" data-startTime="504">into these base files </span><span class="line" data-startTime="505">that can be used </span><span class="line" data-startTime="505">across the site. </span> <span class="line" data-startTime="507">We split code into </span><span class="line" data-startTime="507">reusable modules </span><span class="line" data-startTime="509">and actually tried to </span><span class="line" data-startTime="509">reuse them in a sane way. </span> <span class="line" data-startTime="511">We aim to have a single entry </span><span class="line" data-startTime="511">point at the top of the page. </span> <span class="line" data-startTime="515">While we're doing </span><span class="line" data-startTime="515">this, we were also </span><span class="line" data-startTime="517">trying to lock down </span><span class="line" data-startTime="517">our JS development. </span></p>

<p><span class="line" data-startTime="519">We introduced a </span><span class="line" data-startTime="519">top-level namespace </span><span class="line" data-startTime="521">called NYTD, and </span><span class="line" data-startTime="521">the module pattern, </span><span class="line" data-startTime="523">also called the immediately </span><span class="line" data-startTime="523">invoked function expression. </span> <span class="line" data-startTime="526">This is a great way to wrap all </span><span class="line" data-startTime="526">your variables in a closure, </span><span class="line" data-startTime="530">although thanks to Colt, </span><span class="line" data-startTime="530">I'm now afraid of closures. </span> <span class="line" data-startTime="535">We introduced prototype.js </span><span class="line" data-startTime="535">as a DOM library. </span> <span class="line" data-startTime="538">This one bullet </span><span class="line" data-startTime="538">point doesn't really </span><span class="line" data-startTime="540">reflect the amount of </span><span class="line" data-startTime="540">meetings and discussions </span><span class="line" data-startTime="542">and debates and fights we </span><span class="line" data-startTime="542">had over this decision. </span> <span class="line" data-startTime="544">But prototype.js </span><span class="line" data-startTime="544">won out in the end. </span> <span class="line" data-startTime="547">We also tried to write our </span><span class="line" data-startTime="547">own proprietary asynchronous </span><span class="line" data-startTime="549">JavaScript loader in the </span><span class="line" data-startTime="549">days before RequireJS. </span></p>

<p><span class="line" data-startTime="554">LABjs, any of these </span><span class="line" data-startTime="554">loaders, they didn't exist. </span> <span class="line" data-startTime="556">We tried to write our own. </span> <span class="line" data-startTime="557">It didn't really work. </span> <span class="line" data-startTime="558">It became a synchronous </span><span class="line" data-startTime="558">JavaScript loader. </span> <span class="line" data-startTime="562">So we started with our </span><span class="line" data-startTime="562">homepage, and there's </span><span class="line" data-startTime="564">a number of reasons why. </span> <span class="line" data-startTime="565">It's published very </span><span class="line" data-startTime="565">frequently, so this problem </span><span class="line" data-startTime="567">with legacy markup really </span><span class="line" data-startTime="567">doesn't become an issue. </span> <span class="line" data-startTime="570">It gets the most traffic, </span><span class="line" data-startTime="570">so it has the potential </span><span class="line" data-startTime="572">to save people the </span><span class="line" data-startTime="572">most amount of time. </span> <span class="line" data-startTime="574">It has an isolated </span><span class="line" data-startTime="574">implementation. </span> <span class="line" data-startTime="577">Basically, if </span><span class="line" data-startTime="577">something went wrong, </span><span class="line" data-startTime="579">nothing would go wrong on </span><span class="line" data-startTime="579">other parts of the site. </span> <span class="line" data-startTime="581">And it's viewed very </span><span class="line" data-startTime="581">heavily internally. </span></p>

<p><span class="line" data-startTime="582">If something were </span><span class="line" data-startTime="582">really bad, it'd </span><span class="line" data-startTime="584">get noticed before it </span><span class="line" data-startTime="584">got out into production. </span> <span class="line" data-startTime="587">So November, 2009, we </span><span class="line" data-startTime="587">put our CSS optimizations </span><span class="line" data-startTime="590">on the homepage. </span> <span class="line" data-startTime="591">It saved 25 HTTP connections to </span><span class="line" data-startTime="591">what are very small CSS files. </span> <span class="line" data-startTime="596">The first paint occurred </span><span class="line" data-startTime="596">a whole second earlier, </span><span class="line" data-startTime="598">and the homepage </span><span class="line" data-startTime="598">really felt faster. </span> <span class="line" data-startTime="600">And we are very happy by this. </span> <span class="line" data-startTime="602">So in 2010, we wanted to </span><span class="line" data-startTime="602">continue these efforts. </span> <span class="line" data-startTime="606">The CSS framework </span><span class="line" data-startTime="606">basically rolled out </span><span class="line" data-startTime="608">to our section </span><span class="line" data-startTime="608">and article pages. </span> <span class="line" data-startTime="610">Again, we were focusing </span><span class="line" data-startTime="610">on a single entry point. </span> <span class="line" data-startTime="612">But we never optimized them. </span> <span class="line" data-startTime="615">There were some concerns with </span><span class="line" data-startTime="615">these proprietary scripts. </span> <span class="line" data-startTime="618">And it turns out later, </span><span class="line" data-startTime="618">when we did an audit, </span><span class="line" data-startTime="619">that we were right </span><span class="line" data-startTime="619">to be concerned. </span> <span class="line" data-startTime="621">There were references </span><span class="line" data-startTime="621">to missing files. </span> <span class="line" data-startTime="623">There were @import cycles. </span></p>

<p><span class="line" data-startTime="624">A would include B </span><span class="line" data-startTime="624">include C include A. </span> <span class="line" data-startTime="626">And if you're ever curious </span><span class="line" data-startTime="626">about what the browser does </span><span class="line" data-startTime="628">to get out of that, I still </span><span class="line" data-startTime="628">don't know the answer. </span> <span class="line" data-startTime="632">And there were syntax errors. </span> <span class="line" data-startTime="633">There were styles </span><span class="line" data-startTime="633">not getting applied </span><span class="line" data-startTime="635">because they were </span><span class="line" data-startTime="635">typed improperly. </span> <span class="line" data-startTime="637">So we decided to build a </span><span class="line" data-startTime="637">new JS build system in 2010. </span> <span class="line" data-startTime="641">We forked the codebase. </span> <span class="line" data-startTime="642">We wanted to create </span><span class="line" data-startTime="642">a clean build. </span></p>

<p><span class="line" data-startTime="644">And only code that was </span><span class="line" data-startTime="644">modular and namespaced </span><span class="line" data-startTime="649">would be able to </span><span class="line" data-startTime="649">be in this build. </span> <span class="line" data-startTime="651">Basically, we have these </span><span class="line" data-startTime="651">manifests of files that had </span><span class="line" data-startTime="653">an @import-like syntax in a JS </span><span class="line" data-startTime="653">comment so that they would be </span><span class="line" data-startTime="657">inert if the build </span><span class="line" data-startTime="657">process failed. </span> <span class="line" data-startTime="661">We used YUI Compressor </span><span class="line" data-startTime="661">for minification. </span> <span class="line" data-startTime="663">We no longer want to </span><span class="line" data-startTime="663">write our own scripts. </span> <span class="line" data-startTime="665">This was well supported </span><span class="line" data-startTime="665">at the time, so why not? </span><span class="line" data-startTime="667">We were focusing </span><span class="line" data-startTime="667">on two build files, </span><span class="line" data-startTime="670">one at the top, </span><span class="line" data-startTime="670">one at the bottom. </span></p>

<p><span class="line" data-startTime="671">If you're familiar with </span><span class="line" data-startTime="671">the best practices, </span><span class="line" data-startTime="673">they say that you're </span><span class="line" data-startTime="673">supposed to put </span><span class="line" data-startTime="675">your JS at the </span><span class="line" data-startTime="675">bottom of the page. </span> <span class="line" data-startTime="676">So why did we have </span><span class="line" data-startTime="676">them at the top? </span><span class="line" data-startTime="678">If you remember that editors </span><span class="line" data-startTime="678">can put JavaScript on the page. </span> <span class="line" data-startTime="681">If we wanted them to </span><span class="line" data-startTime="681">use our frameworks, </span><span class="line" data-startTime="683">it had to be there before they </span><span class="line" data-startTime="683">could actually run their code. </span> <span class="line" data-startTime="686">So we put stuff at </span><span class="line" data-startTime="686">the top to make sure </span><span class="line" data-startTime="687">that that wouldn't </span><span class="line" data-startTime="687">break anything. </span> <span class="line" data-startTime="689">This build process </span><span class="line" data-startTime="689">was executed manually, </span><span class="line" data-startTime="691">so it didn't see </span><span class="line" data-startTime="691">widespread usage. </span> <span class="line" data-startTime="693">It's basically almost </span><span class="line" data-startTime="693">only on the homepage. </span></p>

<p><span class="line" data-startTime="696">And now we have two code </span><span class="line" data-startTime="696">bases and still no automatic </span><span class="line" data-startTime="698">build process. </span> <span class="line" data-startTime="700">But when we did launch these </span><span class="line" data-startTime="700">JS changes to the homepage, </span><span class="line" data-startTime="702">it was pretty drastic. </span> <span class="line" data-startTime="703">We got a 50% speedup, </span><span class="line" data-startTime="703">six seconds down from 12. </span> <span class="line" data-startTime="707">We were very excited by that. </span> <span class="line" data-startTime="709">So 2011 was a bit </span><span class="line" data-startTime="709">of a slow year. </span> <span class="line" data-startTime="712">As you might remember if you're </span><span class="line" data-startTime="712">fans of "The New York Times", </span><span class="line" data-startTime="714">we introduced digital </span><span class="line" data-startTime="714">subscriptions in 2011. </span> <span class="line" data-startTime="718">So resourcing for </span><span class="line" data-startTime="718">this kind of work </span><span class="line" data-startTime="719">was really, really </span><span class="line" data-startTime="719">hard to come by. </span> <span class="line" data-startTime="721">Oh, hello. </span> <span class="line" data-startTime="722">I don't know what I just did. </span> <span class="line" data-startTime="724">All right. </span> <span class="line" data-startTime="726">There were efforts to optimize </span><span class="line" data-startTime="726">our analytics packaging. </span> <span class="line" data-startTime="731">We have a lot of </span><span class="line" data-startTime="731">analytics packages, </span><span class="line" data-startTime="732">and they were kind of doing </span><span class="line" data-startTime="732">some really bad stuff. </span></p>

<p><span class="line" data-startTime="734">They got aborted, </span><span class="line" data-startTime="734">mostly because we </span><span class="line" data-startTime="736">were afraid to break </span><span class="line" data-startTime="736">these actual reports. </span> <span class="line" data-startTime="739">We wanted to make sure </span><span class="line" data-startTime="739">that the business was </span><span class="line" data-startTime="741">able to analyze </span><span class="line" data-startTime="741">things correctly, </span><span class="line" data-startTime="743">so we didn't continue that. </span> <span class="line" data-startTime="744">So we used a series of code </span><span class="line" data-startTime="744">reviews and style guides </span><span class="line" data-startTime="747">to make sure that </span><span class="line" data-startTime="747">we were enforcing </span><span class="line" data-startTime="749">good standards </span><span class="line" data-startTime="749">and best practices </span><span class="line" data-startTime="750">to keep the status quo. </span> <span class="line" data-startTime="753">But at the end of 2011, </span><span class="line" data-startTime="753">we made the decision. </span></p>

<p><span class="line" data-startTime="756">We decided to </span><span class="line" data-startTime="756">replace prototype.js </span><span class="line" data-startTime="758">with jQuery sitewide. </span> <span class="line" data-startTime="759">And as you can imagine, </span><span class="line" data-startTime="759">this is really, really hard. </span> <span class="line" data-startTime="764">We needed both of them to </span><span class="line" data-startTime="764">coexist during the transition. </span> <span class="line" data-startTime="766">We weren't going to rewrite </span><span class="line" data-startTime="766">everything and launch </span><span class="line" data-startTime="768">a new site on a new </span><span class="line" data-startTime="768">framework all at once, </span><span class="line" data-startTime="770">so we needed both </span><span class="line" data-startTime="770">of them to basically </span><span class="line" data-startTime="772">be around while we did this. </span> <span class="line" data-startTime="774">But in 2012, a group </span><span class="line" data-startTime="774">of five developers </span><span class="line" data-startTime="777">basically set out to try </span><span class="line" data-startTime="777">and excise prototype.js </span><span class="line" data-startTime="780">from article pages. </span> <span class="line" data-startTime="782">And we were making really, </span><span class="line" data-startTime="782">really excellent progress. </span> <span class="line" data-startTime="784">Things were going great. </span> <span class="line" data-startTime="785">Hours and hours of work. </span> <span class="line" data-startTime="787">And then we found out there </span><span class="line" data-startTime="787">were some inline scripts that </span><span class="line" data-startTime="790">made references to prototype.js. </span> <span class="line" data-startTime="792">And if you remember that we have </span><span class="line" data-startTime="792">these static pages with markup </span><span class="line" data-startTime="795">that we can't change, </span><span class="line" data-startTime="795">we really have no idea </span><span class="line" data-startTime="798">of what's calling prototype.js </span><span class="line" data-startTime="798">in inline scripts. </span> <span class="line" data-startTime="800">And so therefore, we're not </span><span class="line" data-startTime="800">ever able to remove prototype.js </span><span class="line" data-startTime="803">fully from our site. </span> <span class="line" data-startTime="805">So now we have two frameworks. </span> <span class="line" data-startTime="806">They both download. </span></p>

<p><span class="line" data-startTime="807">They're both still in use. </span> <span class="line" data-startTime="809">And this actually causes </span><span class="line" data-startTime="809">some really strange bugs </span><span class="line" data-startTime="811">in older IE, where you </span><span class="line" data-startTime="811">don't have a get elements </span><span class="line" data-startTime="814">by class name. </span> <span class="line" data-startTime="815">Prototype.js would </span><span class="line" data-startTime="815">add one, and jQuery </span><span class="line" data-startTime="818">will detect it and use it. </span> <span class="line" data-startTime="820">It returns prototype </span><span class="line" data-startTime="820">objects and jQuery says, </span><span class="line" data-startTime="822">I have no idea what </span><span class="line" data-startTime="822">these are, and fails. </span> <span class="line" data-startTime="826">So 2012 also marked the end </span><span class="line" data-startTime="826">of life for this proprietary </span><span class="line" data-startTime="830">build system. </span> <span class="line" data-startTime="831">We basically </span><span class="line" data-startTime="831">migrated to a system </span><span class="line" data-startTime="833">that mirrored our entire </span><span class="line" data-startTime="833">SPN repositories via Hudson. </span></p>

<p><span class="line" data-startTime="837">We wrote a new script to </span><span class="line" data-startTime="837">concatenate these CSS imports. </span> <span class="line" data-startTime="840">We needed feature parity </span><span class="line" data-startTime="840">with what we had before. </span> <span class="line" data-startTime="842">So we had to write </span><span class="line" data-startTime="842">something new to make sure </span><span class="line" data-startTime="844">that we could handle it for the </span><span class="line" data-startTime="844">homepage, which already had it. </span> <span class="line" data-startTime="847">It does have all these </span><span class="line" data-startTime="847">features, although CSSLint </span><span class="line" data-startTime="850">is added on the list to </span><span class="line" data-startTime="850">catch syntax errors that </span><span class="line" data-startTime="852">didn't exist until </span><span class="line" data-startTime="852">2012, I believe. </span> <span class="line" data-startTime="856">It uses YUI Compressor </span><span class="line" data-startTime="856">to do minification, </span><span class="line" data-startTime="858">and also has to be run manually. </span> <span class="line" data-startTime="860">So again, it's really just </span><span class="line" data-startTime="860">limited to the homepage. </span> <span class="line" data-startTime="864">So finally, I'm going to </span><span class="line" data-startTime="864">talk a bit about some efforts </span><span class="line" data-startTime="868">in modern times of </span><span class="line" data-startTime="868">what we're trying </span><span class="line" data-startTime="870">to do to really </span><span class="line" data-startTime="870">fix this problem. </span> <span class="line" data-startTime="871">So we were really gifted </span><span class="line" data-startTime="871">a very rare opportunity </span><span class="line" data-startTime="874">by the business. </span> <span class="line" data-startTime="875">In March, 2013, the </span><span class="line" data-startTime="875">"New York Times" </span><span class="line" data-startTime="877">announced that it was going </span><span class="line" data-startTime="877">to introduce a new article </span><span class="line" data-startTime="880">redesign. </span></p>

<p><span class="line" data-startTime="882">For us, it's more than </span><span class="line" data-startTime="882">just a new user interface </span><span class="line" data-startTime="884">and a new user experience. </span> <span class="line" data-startTime="886">It's really a </span><span class="line" data-startTime="886">technological reboot. </span> <span class="line" data-startTime="887">We've changed everything </span><span class="line" data-startTime="887">about our systems </span><span class="line" data-startTime="889">in order to deal with some </span><span class="line" data-startTime="889">of these legacy issues </span><span class="line" data-startTime="892">that we've had. </span> <span class="line" data-startTime="893">So the best thing &mdash; and I have </span><span class="line" data-startTime="893">an exclamation point here. </span> <span class="line" data-startTime="896">And it really doesn't represent </span><span class="line" data-startTime="896">our excitement by this. </span> <span class="line" data-startTime="899">We have dynamic pages now. </span> <span class="line" data-startTime="900">We no longer have to deal </span><span class="line" data-startTime="900">with an unknown number </span><span class="line" data-startTime="902">of permutations. </span> <span class="line" data-startTime="904">We can actually </span><span class="line" data-startTime="904">change our asset URLs </span><span class="line" data-startTime="905">on the fly to bypass the cache </span><span class="line" data-startTime="905">as soon as we do a deploy. </span></p>

<p><span class="line" data-startTime="909">We pushed a lot of </span><span class="line" data-startTime="909">the user customization </span><span class="line" data-startTime="911">into the client side. </span> <span class="line" data-startTime="912">We're not doing </span><span class="line" data-startTime="912">it on the server, </span><span class="line" data-startTime="914">so we can actually cache our </span><span class="line" data-startTime="914">pages better on the backend. </span> <span class="line" data-startTime="916">We introduced HTML 5 Boilerplate </span><span class="line" data-startTime="916">and Modernizr to give us </span><span class="line" data-startTime="919">a nice starting point </span><span class="line" data-startTime="919">for these new pages. </span> <span class="line" data-startTime="922">So now we have a modern </span><span class="line" data-startTime="922">build system using Grunt. </span> <span class="line" data-startTime="925">It can be run both in </span><span class="line" data-startTime="925">our developer sandboxes </span><span class="line" data-startTime="927">and in Hudson to </span><span class="line" data-startTime="927">prepare a build. </span> <span class="line" data-startTime="929">And most of these </span><span class="line" data-startTime="929">web performance </span><span class="line" data-startTime="931">best practices are actually </span><span class="line" data-startTime="931">available as Grunt tasks </span><span class="line" data-startTime="933">already, which </span><span class="line" data-startTime="933">made it really easy </span><span class="line" data-startTime="935">to integrate some of this </span><span class="line" data-startTime="935">great advice for our code. </span></p>

<p><span class="line" data-startTime="940">We're using RPM packaging </span><span class="line" data-startTime="940">for deployments. </span> <span class="line" data-startTime="943">They have very great </span><span class="line" data-startTime="943">rollback support, </span><span class="line" data-startTime="945">and they're really easy to use. </span> <span class="line" data-startTime="949">So for style development, </span><span class="line" data-startTime="949">we switched to using LESS. </span> <span class="line" data-startTime="952">LESS itself handles </span><span class="line" data-startTime="952">concatenation. </span> <span class="line" data-startTime="955">Minification is supported </span><span class="line" data-startTime="955">by YUI Compressor </span><span class="line" data-startTime="957">through the Grunt task. </span> <span class="line" data-startTime="958">So this was really easy </span><span class="line" data-startTime="958">to get, these two wins. </span> <span class="line" data-startTime="961">Variables and mixins allow us </span><span class="line" data-startTime="961">to do some really interesting </span><span class="line" data-startTime="963">things in CSS that we had </span><span class="line" data-startTime="963">to do with images before. </span> <span class="line" data-startTime="967">Arrows, buttons, data </span><span class="line" data-startTime="967">URIs, and spriting. </span></p>

<p><span class="line" data-startTime="971">So earlier this year, </span><span class="line" data-startTime="971">I wrote a Grunt task </span><span class="line" data-startTime="972">that automates the </span><span class="line" data-startTime="972">creation of spritesheets. </span> <span class="line" data-startTime="975">I don't really know </span><span class="line" data-startTime="975">what the diction </span><span class="line" data-startTime="978">is around sprites </span><span class="line" data-startTime="978">and spritesheets. </span> <span class="line" data-startTime="981">And I don't know. </span> <span class="line" data-startTime="981">What do you call the individual </span><span class="line" data-startTime="981">images in a spritesheet? </span><span class="line" data-startTime="984">I have no idea. </span> <span class="line" data-startTime="985">So I'm making up </span><span class="line" data-startTime="985">the terminology. </span> <span class="line" data-startTime="988">Basically, the task takes in </span><span class="line" data-startTime="988">a bunch of images and exports </span><span class="line" data-startTime="991">not only the </span><span class="line" data-startTime="991">combined spritesheet, </span><span class="line" data-startTime="993">but also a bunch </span><span class="line" data-startTime="993">of mixins and LESS </span><span class="line" data-startTime="995">with the background coordinates, </span><span class="line" data-startTime="995">which makes it not only </span><span class="line" data-startTime="997">really easy to make these </span><span class="line" data-startTime="997">combined images &mdash; you don't </span><span class="line" data-startTime="999">have to maintain them manually &mdash; </span><span class="line" data-startTime="999">it's really easy for developers </span><span class="line" data-startTime="1002">to use them in the code. </span></p>

<p><span class="line" data-startTime="1003">The mixins are named </span><span class="line" data-startTime="1003">after the image itself, </span><span class="line" data-startTime="1005">so you just put the image </span><span class="line" data-startTime="1005">name and you basically </span><span class="line" data-startTime="1007">get the sprite. </span> <span class="line" data-startTime="1009">And the best part about </span><span class="line" data-startTime="1009">it is if the coordinates </span><span class="line" data-startTime="1011">change because we've added a new </span><span class="line" data-startTime="1011">image, and if it's alphabetical </span><span class="line" data-startTime="1014">and you added a C, right? </span><span class="line" data-startTime="1016">And all the images shift </span><span class="line" data-startTime="1016">a little bit, right? </span><span class="line" data-startTime="1018">All you have to do is </span><span class="line" data-startTime="1018">rebuild the system, </span><span class="line" data-startTime="1019">and all the coordinates </span><span class="line" data-startTime="1019">are updated. </span> <span class="line" data-startTime="1021">Nobody has to go in and actually </span><span class="line" data-startTime="1021">figure something out and change </span><span class="line" data-startTime="1023">anything. </span> <span class="line" data-startTime="1024">And we're currently </span><span class="line" data-startTime="1024">combining about I </span><span class="line" data-startTime="1026">think over 100 small </span><span class="line" data-startTime="1026">images into one. </span> <span class="line" data-startTime="1028">That's 99 saved requests </span><span class="line" data-startTime="1028">to very small files </span><span class="line" data-startTime="1031">that we need for our new design. </span> <span class="line" data-startTime="1033">I'm not showing it here. </span> <span class="line" data-startTime="1034">You can check out the marketing </span><span class="line" data-startTime="1034">page to see what it looks like. </span></p>

<p><span class="line" data-startTime="1038">Just a heads up. </span> <span class="line" data-startTime="1040">For JavaScript, we </span><span class="line" data-startTime="1040">switched to RequireJS. </span> <span class="line" data-startTime="1044">This handles, again, </span><span class="line" data-startTime="1044">concatenation and minification </span><span class="line" data-startTime="1047">in the Grunt task. </span> <span class="line" data-startTime="1047">And we also get </span><span class="line" data-startTime="1047">source maps, which </span><span class="line" data-startTime="1049">is something we're </span><span class="line" data-startTime="1049">really excited to use </span><span class="line" data-startTime="1051">for our development. </span> <span class="line" data-startTime="1053">We no longer need </span><span class="line" data-startTime="1053">a global namespace. </span> <span class="line" data-startTime="1055">That's why the slide </span><span class="line" data-startTime="1055">is titled that we're </span><span class="line" data-startTime="1056">deleting our </span><span class="line" data-startTime="1056">window.nytd namespace. </span></p>

<p><span class="line" data-startTime="1059">We get asynchronous </span><span class="line" data-startTime="1059">loading of JavaScript. </span> <span class="line" data-startTime="1062">And we basically decided </span><span class="line" data-startTime="1062">to focus on larger </span><span class="line" data-startTime="1065">build files so that </span><span class="line" data-startTime="1065">once you've established </span><span class="line" data-startTime="1068">a connection on mobile, </span><span class="line" data-startTime="1068">you want to make sure </span><span class="line" data-startTime="1070">you keep the latency low. </span> <span class="line" data-startTime="1071">That the initial handshake </span><span class="line" data-startTime="1071">can be really high. </span> <span class="line" data-startTime="1073">So we keep these large </span><span class="line" data-startTime="1073">build files around instead </span><span class="line" data-startTime="1076">of using a bunch of </span><span class="line" data-startTime="1076">individual RequireJS loads. </span> <span class="line" data-startTime="1080">Since we moved a lot of </span><span class="line" data-startTime="1080">the client customization </span><span class="line" data-startTime="1082">to the browser, </span><span class="line" data-startTime="1082">we needed to make </span><span class="line" data-startTime="1085">sure we could template properly. </span> <span class="line" data-startTime="1086">So we use Underscore </span><span class="line" data-startTime="1086">JS Templates </span><span class="line" data-startTime="1088">instead of building with </span><span class="line" data-startTime="1088">the DOM or any HTML strings. </span></p>

<p><span class="line" data-startTime="1091">And its way faster </span><span class="line" data-startTime="1091">to precompile. </span> <span class="line" data-startTime="1092">You're essentially running </span><span class="line" data-startTime="1092">a JavaScript function, </span><span class="line" data-startTime="1094">which is optimized </span><span class="line" data-startTime="1094">in the browser. </span> <span class="line" data-startTime="1096">Grunt can automate this </span><span class="line" data-startTime="1096">compilation as a built-in task </span><span class="line" data-startTime="1099">to do it. </span> <span class="line" data-startTime="1100">And we turn them into </span><span class="line" data-startTime="1100">a RequireJS module </span><span class="line" data-startTime="1102">that gets included as </span><span class="line" data-startTime="1102">part of our build process. </span> <span class="line" data-startTime="1106">So we use Backbone to organize </span><span class="line" data-startTime="1106">everything into modules. </span> <span class="line" data-startTime="1109">They are reusable and they </span><span class="line" data-startTime="1109">are shared across applications </span><span class="line" data-startTime="1111">if we would like them to be. </span> <span class="line" data-startTime="1113">But the real win is </span><span class="line" data-startTime="1113">that they give us </span><span class="line" data-startTime="1115">a bunch of inherited </span><span class="line" data-startTime="1115">functionality. </span> <span class="line" data-startTime="1116">So we can abstract out </span><span class="line" data-startTime="1116">touch events and analytics </span><span class="line" data-startTime="1120">or some common element </span><span class="line" data-startTime="1120">references so that we can &mdash; </span><span class="line" data-startTime="1124">we won't have to look </span><span class="line" data-startTime="1124">them up all the time, </span><span class="line" data-startTime="1126">and we can get this </span><span class="line" data-startTime="1126">functionality and everything </span><span class="line" data-startTime="1129">very easily. </span></p>

<p><span class="line" data-startTime="1130">We get event delegation, </span><span class="line" data-startTime="1130">fewer event listeners, </span><span class="line" data-startTime="1133">so things run a </span><span class="line" data-startTime="1133">little more smoothly. </span> <span class="line" data-startTime="1135">And the modules communicate </span><span class="line" data-startTime="1135">with each other using events, </span><span class="line" data-startTime="1137">so you can publish </span><span class="line" data-startTime="1137">events or you can </span><span class="line" data-startTime="1139">subscribe to another </span><span class="line" data-startTime="1139">module's events </span><span class="line" data-startTime="1140">to find out about changes. </span> <span class="line" data-startTime="1142">So this is the big topic. </span> <span class="line" data-startTime="1143">What do we do about ads? </span><span class="line" data-startTime="1144">We took ads out of </span><span class="line" data-startTime="1144">the critical path. </span> <span class="line" data-startTime="1146">What we do is on DOM ready, </span><span class="line" data-startTime="1146">we write the ad markup </span><span class="line" data-startTime="1150">into a new IFrame. </span> <span class="line" data-startTime="1151">You just take the </span><span class="line" data-startTime="1151">frame's document, </span><span class="line" data-startTime="1153">and you document.write </span><span class="line" data-startTime="1153">it into the frame. </span> <span class="line" data-startTime="1155">And what happens if the ad </span><span class="line" data-startTime="1155">itself calls document.write, </span><span class="line" data-startTime="1158">you don't lose your whole page. </span></p>

<p><span class="line" data-startTime="1159">You would just lose the </span><span class="line" data-startTime="1159">content of the IFrame, which </span><span class="line" data-startTime="1161">is blank to begin with. </span> <span class="line" data-startTime="1162">So we don't care what they </span><span class="line" data-startTime="1162">do once they're in the frame, </span><span class="line" data-startTime="1165">once they load. </span> <span class="line" data-startTime="1165">If they decide to bust out </span><span class="line" data-startTime="1165">of the frame, they can. </span> <span class="line" data-startTime="1168">But we have this notion of </span><span class="line" data-startTime="1168">trusted ads that aren't framed. </span> <span class="line" data-startTime="1170">And trusted basically means </span><span class="line" data-startTime="1170">that they specifically </span><span class="line" data-startTime="1173">don't do things that </span><span class="line" data-startTime="1173">are bad for page speed. </span> <span class="line" data-startTime="1175">And also if there's actually a </span><span class="line" data-startTime="1175">problem, it's very easy for us </span><span class="line" data-startTime="1179">to get in touch with </span><span class="line" data-startTime="1179">them and make the change. </span> <span class="line" data-startTime="1181">And this has been really, </span><span class="line" data-startTime="1181">really effective for us. </span> <span class="line" data-startTime="1183">So this is the results page. </span> <span class="line" data-startTime="1186">I thought it would </span><span class="line" data-startTime="1186">be great to show you </span><span class="line" data-startTime="1188">a comparative slide </span><span class="line" data-startTime="1188">of our waterfalls </span><span class="line" data-startTime="1190">to show you how really </span><span class="line" data-startTime="1190">dramatic this is. </span></p>

<p><span class="line" data-startTime="1192">We're not quite ready to show </span><span class="line" data-startTime="1192">you that information yet. </span> <span class="line" data-startTime="1195">It's still being built, so we're </span><span class="line" data-startTime="1195">not quite ready to do that. </span> <span class="line" data-startTime="1198">But to give you an overview. </span> <span class="line" data-startTime="1200">Before starting to </span><span class="line" data-startTime="1200">render the page, </span><span class="line" data-startTime="1202">it used to download </span><span class="line" data-startTime="1202">over 60 requests. </span> <span class="line" data-startTime="1204">It's about 10 now, </span><span class="line" data-startTime="1204">maybe even fewer. </span> <span class="line" data-startTime="1208">Before we're fully loaded, we </span><span class="line" data-startTime="1208">had to download 200 assets. </span> <span class="line" data-startTime="1211">It's about 70 now. </span> <span class="line" data-startTime="1213">Start render is under </span><span class="line" data-startTime="1213">one second in Chrome, </span><span class="line" data-startTime="1215">and document complete is </span><span class="line" data-startTime="1215">under three seconds in Chrome. </span> <span class="line" data-startTime="1218">So this is a huge win for us. </span></p>

<p><span class="line" data-startTime="1219">Before, previously, </span><span class="line" data-startTime="1219">document complete </span><span class="line" data-startTime="1221">would be about nine seconds </span><span class="line" data-startTime="1221">on our article pages. </span> <span class="line" data-startTime="1224">So to answer Steve's </span><span class="line" data-startTime="1224">question about </span><span class="line" data-startTime="1226">is web performance </span><span class="line" data-startTime="1226">too hard, no and yes. </span> <span class="line" data-startTime="1231">It's really not that hard. </span> <span class="line" data-startTime="1233">The optimization </span><span class="line" data-startTime="1233">practices are really not </span><span class="line" data-startTime="1234">that difficult to begin with. </span> <span class="line" data-startTime="1236">And there's excellent tooling </span><span class="line" data-startTime="1236">that exists to make it really, </span><span class="line" data-startTime="1238">really, really easy to do. </span> <span class="line" data-startTime="1240">However, there are </span><span class="line" data-startTime="1240">some unique challenges </span><span class="line" data-startTime="1242">that I think not </span><span class="line" data-startTime="1242">just big websites, </span><span class="line" data-startTime="1244">but companies tend to have </span><span class="line" data-startTime="1244">their own challenges that people </span><span class="line" data-startTime="1247">can't solve their </span><span class="line" data-startTime="1247">problems for them. </span> <span class="line" data-startTime="1249">And not to mention any legacy </span><span class="line" data-startTime="1249">decisions such as ours, where </span><span class="line" data-startTime="1252">we have our static pages </span><span class="line" data-startTime="1252">that was holding us back. </span></p>

<p><span class="line" data-startTime="1254">We found that we did this </span><span class="line" data-startTime="1254">negative feedback cycle. </span> <span class="line" data-startTime="1257">We had this bad, </span><span class="line" data-startTime="1257">this poor setup. </span> <span class="line" data-startTime="1259">And we tried to this proprietary </span><span class="line" data-startTime="1259">fix to make it better. </span> <span class="line" data-startTime="1261">And we found ourselves slightly </span><span class="line" data-startTime="1261">worse off than we were before, </span><span class="line" data-startTime="1264">even though we were getting </span><span class="line" data-startTime="1264">slightly faster speed. </span> <span class="line" data-startTime="1266">So here's some stuff that we </span><span class="line" data-startTime="1266">learned, share some advice. </span> <span class="line" data-startTime="1270">It's really worth </span><span class="line" data-startTime="1270">it to fight to solve </span><span class="line" data-startTime="1271">these big, difficult problems. </span> <span class="line" data-startTime="1273">They are the 800 pound gorilla </span><span class="line" data-startTime="1273">in the room for a reason. </span></p>

<p><span class="line" data-startTime="1276">Fight to solve them. </span> <span class="line" data-startTime="1277">Once they're out of </span><span class="line" data-startTime="1277">your way, it really </span><span class="line" data-startTime="1279">opens the path to making </span><span class="line" data-startTime="1279">this a lot simpler. </span> <span class="line" data-startTime="1282">We live in a world </span><span class="line" data-startTime="1282">where you don't </span><span class="line" data-startTime="1283">have to rely on proprietary </span><span class="line" data-startTime="1283">systems anymore. </span> <span class="line" data-startTime="1286">You might need some </span><span class="line" data-startTime="1286">because it's your business, </span><span class="line" data-startTime="1288">so you may need to </span><span class="line" data-startTime="1288">make sure that you </span><span class="line" data-startTime="1292">have all your requirements </span><span class="line" data-startTime="1292">taken care of. </span> <span class="line" data-startTime="1294">But a lot of the tooling is </span><span class="line" data-startTime="1294">just to make this very simple. </span> <span class="line" data-startTime="1298">I always say that you </span><span class="line" data-startTime="1298">should HTTP connections </span><span class="line" data-startTime="1301">before you count </span><span class="line" data-startTime="1301">bytes in every file. </span> <span class="line" data-startTime="1305">Do the big easy wins first. </span></p>

<p><span class="line" data-startTime="1307">It's really easy to </span><span class="line" data-startTime="1307">combine files together </span><span class="line" data-startTime="1309">than it is to figure </span><span class="line" data-startTime="1309">out what code is old </span><span class="line" data-startTime="1311">and needs to be removed </span><span class="line" data-startTime="1311">from your files. </span> <span class="line" data-startTime="1313">And automate everything. </span> <span class="line" data-startTime="1315">As soon as you introduce </span><span class="line" data-startTime="1315">manual to the equation, </span><span class="line" data-startTime="1317">it really doesn't get done. </span> <span class="line" data-startTime="1318">So if you can </span><span class="line" data-startTime="1318">automate everything, </span><span class="line" data-startTime="1320">it's by far going to pave the </span><span class="line" data-startTime="1320">road and make it really easy. </span> <span class="line" data-startTime="1325">So that's it. </span> <span class="line" data-startTime="1326">I think I'm running out of time. </span> <span class="line" data-startTime="1327">Thank you very much </span><span class="line" data-startTime="1328">[APPLAUSE] </span><span class="line" data-startTime="1333">MALE SPEAKER: [INAUDIBLE]? </span></p>

<p class="speaker"><span class="line" data-starttime="1334"><span class="speakerName">Etian Konigsburg</span>: I don't think </span><span class="line" data-startTime="1334">I have time for questions. </span><span class="line" data-startTime="1336">But I will be around at dinner, </span><span class="line" data-startTime="1336">so if you want to come find me. </span><span class="line" data-startTime="1339">And I can talk endlessly </span><span class="line" data-startTime="1339">about this, so please find me. </span><span class="line" data-startTime="1342">I will share all </span><span class="line" data-startTime="1342">of my knowledge. </span></p>