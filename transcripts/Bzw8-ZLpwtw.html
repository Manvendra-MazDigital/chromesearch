<style>* {font-family: "Open Sans", sans-serif}
a {color: #77aaff}
a.video {border-bottom: 1px solid #ddd; display: block; margin: 0 0 2em 0; padding: 0 0 2em 0}
h2 {color: #444; font-size: 18px;}
span.speakerName {color: black; font-weight: 900;}
body {padding: 2em}
p {color: #444; margin: 0; text-indent: 1.5em;}
p.speaker {margin: 1em 0 0 0; text-indent: 0;}
div#transcript > p:first-child {text-indent: 0;}
</style>

<h1>Google I/O 2013 &mdash; Instant Mobile Websites: Techniques and Best Practices</h1>

<h2>Mona Vajolahi, Doantam Phan, Bryan Mcquade</h2>

<a class="video" href="http://youtu.be/Bzw8-ZLpwtw">youtu.be/Bzw8-ZLpwtw</a><div id="transcript"><p class="speaker"><span class="line" data-starttime="0"><span class="speakerName">Mona Vajolahi</span>: I'm </span><span class="line" data-startTime="0">Mona Vajolahi. </span><span class="line" data-startTime="1">I'm a product manager </span><span class="line" data-startTime="1">at Google. </span><span class="line" data-startTime="4">I work on making the web fast, </span><span class="line" data-startTime="4">and more specifically, I work </span><span class="line" data-startTime="8">on [INAUDIBLE] products. </span></p>

<p class="speaker"><span class="line" data-starttime="10"><span class="speakerName">Doantam Phan</span>: My name's </span><span class="line" data-startTime="10">Doantam Phan. </span><span class="line" data-startTime="11">I'm also a product manager </span><span class="line" data-startTime="11">working on </span><span class="line" data-startTime="13">making the web fast. </span></p>

<p class="speaker"><span class="line" data-starttime="16"><span class="speakerName">Bryan Mcquade</span>: And I'm </span><span class="line" data-startTime="16">Bryan McQuade. </span><span class="line" data-startTime="17">I'm the technical lead of </span><span class="line" data-startTime="17">PageSpeed Insights. </span></p>

<p class="speaker"><span class="line" data-starttime="20"><span class="speakerName">Mona Vajolahi</span>: All right. </span> <span class="line" data-startTime="21">So I want to start by showing </span><span class="line" data-startTime="21">you a video that would capture </span><span class="line" data-startTime="26">the impact of the </span><span class="line" data-startTime="26">recommendations that we are </span><span class="line" data-startTime="28">going to talk to you </span><span class="line" data-startTime="28">about today. </span> <span class="line" data-startTime="30">So here's a sample </span><span class="line" data-startTime="30">Wikipedia page. </span> <span class="line" data-startTime="32">We are going to load it on a </span><span class="line" data-startTime="32">mobile device at 3G network. </span> <span class="line" data-startTime="36">And on the left hand side, </span><span class="line" data-startTime="36">you'll see the Wikipedia </span><span class="line" data-startTime="39">page &mdash; the original version. </span> <span class="line" data-startTime="40">Then the right hand side, the </span><span class="line" data-startTime="40">optimized vision is after the </span><span class="line" data-startTime="43">implemented best practices </span><span class="line" data-startTime="43">that we are going </span><span class="line" data-startTime="45">to share with you. </span> <span class="line" data-startTime="46">So let me play the video. </span></p>

<p><span class="line" data-startTime="51">So as you can see, the original </span><span class="line" data-startTime="51">one takes some time </span><span class="line" data-startTime="55">to show something on the page, </span><span class="line" data-startTime="55">and overall the original </span><span class="line" data-startTime="58">finishes in five seconds, </span><span class="line" data-startTime="58">whereas the optimized version </span><span class="line" data-startTime="61">finishes in two seconds. </span> <span class="line" data-startTime="62">Now, let's have a closer look </span><span class="line" data-startTime="62">at what's happening here. </span> <span class="line" data-startTime="67">So even more interesting is </span><span class="line" data-startTime="67">that the optimized version </span><span class="line" data-startTime="70">actually shows something on the </span><span class="line" data-startTime="70">page around the one second </span><span class="line" data-startTime="73">mark, whereas in the original </span><span class="line" data-startTime="73">version, we are staring at a </span><span class="line" data-startTime="77">blank screen for almost </span><span class="line" data-startTime="77">three seconds. </span> <span class="line" data-startTime="80">And here's what we are </span><span class="line" data-startTime="80">going to do today. </span> <span class="line" data-startTime="82">We are going to try to get </span><span class="line" data-startTime="82">some content on the page </span><span class="line" data-startTime="86">around that one second mark. </span></p>

<p><span class="line" data-startTime="87">Let's see just a quick </span><span class="line" data-startTime="87">agenda on the top. </span> <span class="line" data-startTime="91">So we're talking about why speed </span><span class="line" data-startTime="91">matters, and then we're </span><span class="line" data-startTime="94">going to share the </span><span class="line" data-startTime="94">recommendations for creating </span><span class="line" data-startTime="96">an instant mobile performance. </span> <span class="line" data-startTime="97">And also, in the end, Bryan is </span><span class="line" data-startTime="97">going to do a deep dive in one </span><span class="line" data-startTime="101">example, and show you in action </span><span class="line" data-startTime="101">how we can do that. </span> <span class="line" data-startTime="105">So we all know that connection </span><span class="line" data-startTime="105">speed on mobile, 3G or 4G, is </span><span class="line" data-startTime="110">slower than your average </span><span class="line" data-startTime="110">connection speed on desktop. </span> <span class="line" data-startTime="114">However, users on a mobile </span><span class="line" data-startTime="114">device actually expect the </span><span class="line" data-startTime="118">sites to load as fast or even </span><span class="line" data-startTime="118">faster as what they have on </span><span class="line" data-startTime="122">the desktop. </span> <span class="line" data-startTime="123">So there's a problem. </span> <span class="line" data-startTime="124">More than that, users of mobile </span><span class="line" data-startTime="124">sites actually learn to </span><span class="line" data-startTime="130">avoid slow sites. </span></p>

<p><span class="line" data-startTime="131">And that first interaction that </span><span class="line" data-startTime="131">they have with a site &mdash; </span><span class="line" data-startTime="133">the first experience they have &mdash; </span><span class="line" data-startTime="133">is actually really, </span><span class="line" data-startTime="136">really important. </span> <span class="line" data-startTime="137">In an experiment of adding one </span><span class="line" data-startTime="137">second additional latency to a </span><span class="line" data-startTime="142">shopping site, it actually saw </span><span class="line" data-startTime="142">that page views will decrease </span><span class="line" data-startTime="146">if you have additional latency, </span><span class="line" data-startTime="146">conversion rates are </span><span class="line" data-startTime="149">going to drop, and bounce rates </span><span class="line" data-startTime="149">are going to go up. </span> <span class="line" data-startTime="151">More importantly, what happens </span><span class="line" data-startTime="151">is that that experience sticks </span><span class="line" data-startTime="155">with the user, so they are less </span><span class="line" data-startTime="155">likely to come back to </span><span class="line" data-startTime="158">the site, and less likely </span><span class="line" data-startTime="158">to go back to the site. </span></p>

<p><span class="line" data-startTime="164">So here's what we want </span><span class="line" data-startTime="164">to do today. </span> <span class="line" data-startTime="167">We want to make that first </span><span class="line" data-startTime="167">experience really fast and </span><span class="line" data-startTime="170">snappy, so that we actually get </span><span class="line" data-startTime="170">the users to come back and </span><span class="line" data-startTime="175">visit the site more often. </span> <span class="line" data-startTime="180">So the topic of today's talk &mdash; </span><span class="line" data-startTime="180">we're going to show how we can </span><span class="line" data-startTime="186">get the most important content </span><span class="line" data-startTime="186">of the site to the user under </span><span class="line" data-startTime="191">one second. </span> <span class="line" data-startTime="192">So that most important content </span><span class="line" data-startTime="192">usually is what you see above </span><span class="line" data-startTime="195">the fold of the page. </span> <span class="line" data-startTime="197">And why did we pick </span><span class="line" data-startTime="197">one second? </span><span class="line" data-startTime="198">Because user studies show that </span><span class="line" data-startTime="198">that is the limit that people </span><span class="line" data-startTime="202">are going to pay attention </span><span class="line" data-startTime="202">to your site. </span></p>

<p><span class="line" data-startTime="204">So after that one second of </span><span class="line" data-startTime="204">staring at a blank screen, </span><span class="line" data-startTime="206">users are more likely to just </span><span class="line" data-startTime="206">step away and basically never </span><span class="line" data-startTime="210">come back to your site. </span> <span class="line" data-startTime="211">And today, the average page load </span><span class="line" data-startTime="211">time on mobile is seven </span><span class="line" data-startTime="215">seconds, which is a huge gap </span><span class="line" data-startTime="215">from where we want to be </span><span class="line" data-startTime="218">compared to where </span><span class="line" data-startTime="218">we are today. </span> <span class="line" data-startTime="222">Now, we all know 4G bandwidth </span><span class="line" data-startTime="222">is much higher than 3G, so </span><span class="line" data-startTime="228">that should solve all our </span><span class="line" data-startTime="228">problems, and basically </span><span class="line" data-startTime="231">experience on mobile would </span><span class="line" data-startTime="231">be very fast on 4G. </span> <span class="line" data-startTime="234">Well, not quite. </span> <span class="line" data-startTime="236">Let's look at the difference </span><span class="line" data-startTime="236">between bandwidth and latency. </span> <span class="line" data-startTime="240">Bandwidth is the amount of </span><span class="line" data-startTime="240">data transferred over the </span><span class="line" data-startTime="242">network per unit of time. </span> <span class="line" data-startTime="244">So for example, a network can </span><span class="line" data-startTime="244">have five megabit per second </span><span class="line" data-startTime="248">of bandwidth. </span> <span class="line" data-startTime="249">However, latency is the delay </span><span class="line" data-startTime="249">in transferring the packet </span><span class="line" data-startTime="252">from the source to </span><span class="line" data-startTime="252">a destination. </span> <span class="line" data-startTime="255">So for specifying latency, we </span><span class="line" data-startTime="255">usually use round trip times. </span></p>

<p><span class="line" data-startTime="259">Now, if I have huge amounts of </span><span class="line" data-startTime="259">data that I want to transfer </span><span class="line" data-startTime="262">on a network &mdash; like, if I'm </span><span class="line" data-startTime="262">loading a video, obviously, </span><span class="line" data-startTime="265">bandwidth matters a lot. </span> <span class="line" data-startTime="266">But when I'm loading a page, </span><span class="line" data-startTime="266">there's a lot of small </span><span class="line" data-startTime="270">requests going back and forth, </span><span class="line" data-startTime="270">and in that case, bandwidth is </span><span class="line" data-startTime="273">not helping me a lot. </span> <span class="line" data-startTime="275">So what happens is that latency </span><span class="line" data-startTime="275">in loading your page </span><span class="line" data-startTime="278">is dominated by round </span><span class="line" data-startTime="278">trip times. </span> <span class="line" data-startTime="279">And now round trip times </span><span class="line" data-startTime="279">on mobile networks </span><span class="line" data-startTime="282">are especially high. </span> <span class="line" data-startTime="284">And on an average 3G network, </span><span class="line" data-startTime="284">for example, you have a round </span><span class="line" data-startTime="288">trip between 100 milliseconds </span><span class="line" data-startTime="288">to 450 milliseconds. </span> <span class="line" data-startTime="291">On a 4G network, you </span><span class="line" data-startTime="291">have between 60 </span><span class="line" data-startTime="294">milliseconds and 180. </span></p>

<p><span class="line" data-startTime="295">And as you can see, the </span><span class="line" data-startTime="295">difference between 3G and 4G </span><span class="line" data-startTime="298">is not huge here. </span> <span class="line" data-startTime="300">So in order to get that snappy </span><span class="line" data-startTime="300">user experience, we have to </span><span class="line" data-startTime="304">design for this high latency </span><span class="line" data-startTime="304">environment. </span> <span class="line" data-startTime="306">And we have to try to reduce the </span><span class="line" data-startTime="306">number of round trips as </span><span class="line" data-startTime="310">much as possible. </span> <span class="line" data-startTime="311">And that brings us to the rules </span><span class="line" data-startTime="311">that we are going to </span><span class="line" data-startTime="314">share with you today. </span> <span class="line" data-startTime="315">These are about how to create </span><span class="line" data-startTime="315">a fast user experience in a </span><span class="line" data-startTime="319">high latency environment. </span> <span class="line" data-startTime="321">It could be when I'm using my </span><span class="line" data-startTime="321">mobile phone to load a page. </span> <span class="line" data-startTime="324">It could be when I'm using my </span><span class="line" data-startTime="324">laptop and connecting to a 3G </span><span class="line" data-startTime="327">network to load a page. </span></p>

<p><span class="line" data-startTime="330">So the four rules are, one, </span><span class="line" data-startTime="330">avoid landing page redirects. </span> <span class="line" data-startTime="334">Two, minimize server </span><span class="line" data-startTime="334">response time. </span> <span class="line" data-startTime="337">Three, eliminate render </span><span class="line" data-startTime="337">blocking resources. </span> <span class="line" data-startTime="339">And four, prioritize </span><span class="line" data-startTime="339">visible content. </span> <span class="line" data-startTime="342">Now, what we are going to do </span><span class="line" data-startTime="342">is that we're going through </span><span class="line" data-startTime="344">each one of these rules, and </span><span class="line" data-startTime="344">tell you why we picked those, </span><span class="line" data-startTime="347">and why they're useful. </span> <span class="line" data-startTime="350">So let's just start by let's see </span><span class="line" data-startTime="350">what happens when a user </span><span class="line" data-startTime="353">visits a site. </span> <span class="line" data-startTime="354">So I'll go to my mobile device &mdash; </span><span class="line" data-startTime="354">mobile browser. </span> <span class="line" data-startTime="357">I enter www.example.com </span><span class="line" data-startTime="357">in the browser. </span> <span class="line" data-startTime="361">What happens is that there's </span><span class="line" data-startTime="361">going to be a DNS lookup to </span><span class="line" data-startTime="363">fetch the IP. </span> <span class="line" data-startTime="364">Then there's going to be a TCP </span><span class="line" data-startTime="364">connection established. </span></p>

<p><span class="line" data-startTime="368">Then the request is sent </span><span class="line" data-startTime="368">to the server. </span> <span class="line" data-startTime="370">Server takes the request, </span><span class="line" data-startTime="370">processes the response, </span><span class="line" data-startTime="373">generates the response, and </span><span class="line" data-startTime="373">sends it back to the user. </span> <span class="line" data-startTime="375">So we already have three </span><span class="line" data-startTime="375">round trips, plus </span><span class="line" data-startTime="378">server processing time. </span> <span class="line" data-startTime="380">Now, if I say, on an average </span><span class="line" data-startTime="380">network, the round trip time </span><span class="line" data-startTime="383">is 200 milliseconds, that brings </span><span class="line" data-startTime="383">us to 600 millisecond </span><span class="line" data-startTime="387">plus server response time. </span> <span class="line" data-startTime="390">Now, let's say www.example.com </span><span class="line" data-startTime="390">actually has a redirect to </span><span class="line" data-startTime="395">m.example.com. </span> <span class="line" data-startTime="397">What happens then? </span><span class="line" data-startTime="398">In that case, there is another </span><span class="line" data-startTime="398">DNS lookup, another TCP </span><span class="line" data-startTime="402">connection, another sender </span><span class="line" data-startTime="402">response, which basically </span><span class="line" data-startTime="406">doubles our latency. </span></p>

<p><span class="line" data-startTime="408">So there is three additional </span><span class="line" data-startTime="408">round trips. </span> <span class="line" data-startTime="409">If we are over SSL, it's </span><span class="line" data-startTime="409">actually four, and brings us </span><span class="line" data-startTime="413">to 1.2 second total latency. </span> <span class="line" data-startTime="416">And this is all before </span><span class="line" data-startTime="416">any of your HTML </span><span class="line" data-startTime="419">content gets to the browser. </span> <span class="line" data-startTime="421">Now, if you look at this, there </span><span class="line" data-startTime="421">are parts of this that </span><span class="line" data-startTime="423">I, as a developer, have </span><span class="line" data-startTime="423">no control over. </span> <span class="line" data-startTime="426">I cannot do anything about DNS </span><span class="line" data-startTime="426">lookup, TCP connection, send </span><span class="line" data-startTime="429">and receive. </span> <span class="line" data-startTime="429">But what I do have control </span><span class="line" data-startTime="429">over is the redirect and </span><span class="line" data-startTime="433">server response time. </span></p>

<p><span class="line" data-startTime="435">And that brings us to the first </span><span class="line" data-startTime="435">two rules that says, </span><span class="line" data-startTime="442">avoid any landing page redirects </span><span class="line" data-startTime="442">and minimize server </span><span class="line" data-startTime="445">processing time as much as </span><span class="line" data-startTime="445">possible to reduce that </span><span class="line" data-startTime="448">latency and to minimize </span><span class="line" data-startTime="448">the RTT time. </span> <span class="line" data-startTime="450">Now, Doantam is going to tell </span><span class="line" data-startTime="450">you more about these next two </span><span class="line" data-startTime="453">rules, and why they are </span><span class="line" data-startTime="453">really important. </span></p>

<p class="speaker"><span class="line" data-starttime="455"><span class="speakerName">Doantam Phan</span>: Thanks, Mona. </span> <span class="line" data-startTime="457">So we've seen that there are </span><span class="line" data-startTime="457">various things that you can do </span><span class="line" data-startTime="462">to your network by adding extra </span><span class="line" data-startTime="462">redirects, by having a </span><span class="line" data-startTime="465">high server response time, that </span><span class="line" data-startTime="465">really slow down the user </span><span class="line" data-startTime="468">perceived latency </span><span class="line" data-startTime="468">of your site. </span> <span class="line" data-startTime="471">What I'm going to talk about now </span><span class="line" data-startTime="471">is actually the way that </span><span class="line" data-startTime="475">the structure of your page &mdash; </span><span class="line" data-startTime="476">the HTML that you use and how </span><span class="line" data-startTime="476">you organize it &mdash; can actually </span><span class="line" data-startTime="479">also lead to a huge increase </span><span class="line" data-startTime="479">in user perceived latency. </span> <span class="line" data-startTime="482">And the way that we're going to </span><span class="line" data-startTime="482">do this is we're going to </span><span class="line" data-startTime="484">look a little bit into the </span><span class="line" data-startTime="484">browser rendering pipeline. </span> <span class="line" data-startTime="487">So what I have here is a </span><span class="line" data-startTime="487">simplified diagram, and you </span><span class="line" data-startTime="491">can see that to paint anything </span><span class="line" data-startTime="491">to the screen, we both need a </span><span class="line" data-startTime="494">document object model to be </span><span class="line" data-startTime="494">ready, and the CSS object </span><span class="line" data-startTime="497">model to be ready. </span> <span class="line" data-startTime="498">And it turns out that both of </span><span class="line" data-startTime="498">these things are going to </span><span class="line" data-startTime="501">depend heavily on having the </span><span class="line" data-startTime="501">presence of external scripts </span><span class="line" data-startTime="504">and stylesheets. </span></p>

<p><span class="line" data-startTime="506">To see how this actually </span><span class="line" data-startTime="506">affects user perceived </span><span class="line" data-startTime="509">latency, we'll go through </span><span class="line" data-startTime="509">this brief example. </span> <span class="line" data-startTime="513">So here I have a very simple </span><span class="line" data-startTime="513">HTML web page. </span> <span class="line" data-startTime="515">I've grayed out all the text, </span><span class="line" data-startTime="515">because I want to indicate </span><span class="line" data-startTime="518">that the parser hasn't actually </span><span class="line" data-startTime="519">gotten to the HTML yet. </span> <span class="line" data-startTime="523">On the right hand side, I have </span><span class="line" data-startTime="523">a representation of what the </span><span class="line" data-startTime="525">user sees &mdash; </span><span class="line" data-startTime="526">a smartphone &mdash; </span><span class="line" data-startTime="527">and at the bottom of the page, </span><span class="line" data-startTime="527">I have some representation of </span><span class="line" data-startTime="530">the internal state of </span><span class="line" data-startTime="530">the browser, right? </span><span class="line" data-startTime="532">So I have the pipeline, and I </span><span class="line" data-startTime="532">also have the various external </span><span class="line" data-startTime="536">files that the HTML </span><span class="line" data-startTime="536">references. </span> <span class="line" data-startTime="540">So from our perspective, the </span><span class="line" data-startTime="540">first interesting event is </span><span class="line" data-startTime="542">when we discover example.css. </span> <span class="line" data-startTime="544">So at that point, you can see </span><span class="line" data-startTime="544">the progress bars on the </span><span class="line" data-startTime="546">bottom are indicating that I've </span><span class="line" data-startTime="546">started parsing the HTML, </span><span class="line" data-startTime="549">I've started constructing the </span><span class="line" data-startTime="549">DOM, and I've initiated a </span><span class="line" data-startTime="552">fetch for the CSS. </span> <span class="line" data-startTime="556">The next interesting event from </span><span class="line" data-startTime="556">the perspective of user </span><span class="line" data-startTime="558">latency is when I encounter </span><span class="line" data-startTime="558">this div &mdash; </span><span class="line" data-startTime="560">this div that presents some </span><span class="line" data-startTime="560">text to the user. </span></p>

<p><span class="line" data-startTime="563">Now, ideally, at this point in </span><span class="line" data-startTime="563">our rendering pipeline, we'd </span><span class="line" data-startTime="566">want to show this text to the </span><span class="line" data-startTime="566">user immediately, right? </span><span class="line" data-startTime="568">Because the user has clicked </span><span class="line" data-startTime="568">on our site, and they're </span><span class="line" data-startTime="571">waiting, staring at a blank </span><span class="line" data-startTime="571">page and a progress bar. </span> <span class="line" data-startTime="574">But due to the way that this </span><span class="line" data-startTime="574">div depends on the styling </span><span class="line" data-startTime="577">information inside external.css, </span><span class="line" data-startTime="577">that's going to </span><span class="line" data-startTime="581">cause the browser to not </span><span class="line" data-startTime="581">know what to do. </span> <span class="line" data-startTime="583">And so it's just going to </span><span class="line" data-startTime="583">continue parsing the file. </span></p>

<p><span class="line" data-startTime="585">And so this is where you can see </span><span class="line" data-startTime="585">that the latency is going </span><span class="line" data-startTime="587">to creep in. </span> <span class="line" data-startTime="590">So similarly, as I encounter the </span><span class="line" data-startTime="590">image, as I encounter the </span><span class="line" data-startTime="595">JavaScript file, I'm also going </span><span class="line" data-startTime="595">to have to initiate </span><span class="line" data-startTime="597">fetches for them. </span> <span class="line" data-startTime="598">But I still can't show anything, </span><span class="line" data-startTime="598">because the CSS file </span><span class="line" data-startTime="600">hasn't yet loaded. </span> <span class="line" data-startTime="602">And so it's only finally when </span><span class="line" data-startTime="602">the CSS file is loaded off the </span><span class="line" data-startTime="606">network and memory that I can </span><span class="line" data-startTime="606">actually pop something up on </span><span class="line" data-startTime="608">the screen to the user. </span> <span class="line" data-startTime="609">At that point, the user </span><span class="line" data-startTime="609">is finally engaged. </span> <span class="line" data-startTime="611">Up to that point, they're just </span><span class="line" data-startTime="611">staring at a blank screen. </span></p>

<p><span class="line" data-startTime="615">And so an important thing to </span><span class="line" data-startTime="615">note here is that the DOM can </span><span class="line" data-startTime="618">be constructed iteratively </span><span class="line" data-startTime="618">as you're </span><span class="line" data-startTime="620">parsing through the file. </span> <span class="line" data-startTime="621">But the CSS object model is only </span><span class="line" data-startTime="621">constructed once all the </span><span class="line" data-startTime="624">CSS is in place. </span> <span class="line" data-startTime="626">And this is really the reason </span><span class="line" data-startTime="626">why a lot of webpages feel </span><span class="line" data-startTime="629">slow on a mobile device, or </span><span class="line" data-startTime="629">really, on any device. </span> <span class="line" data-startTime="632">It's just not as noticeable on a </span><span class="line" data-startTime="632">desktop, due to the way that </span><span class="line" data-startTime="636">latency works. </span> <span class="line" data-startTime="640">And so as we continue parsing </span><span class="line" data-startTime="640">through the file, we're going </span><span class="line" data-startTime="642">to finish loading </span><span class="line" data-startTime="642">the JavaScript. </span></p>

<p><span class="line" data-startTime="644">We're going to finish </span><span class="line" data-startTime="644">loading the image. </span> <span class="line" data-startTime="645">And at that point, the page </span><span class="line" data-startTime="645">is ready, and sort of </span><span class="line" data-startTime="649">consumed by the user. </span> <span class="line" data-startTime="650">But at that point, they've been </span><span class="line" data-startTime="650">waiting quite some time </span><span class="line" data-startTime="652">to get this information. </span> <span class="line" data-startTime="655">So to summarize, the issue is </span><span class="line" data-startTime="655">that these external scripts </span><span class="line" data-startTime="660">and stylesheets are going to </span><span class="line" data-startTime="660">block the painting of content </span><span class="line" data-startTime="662">in the body, right? </span><span class="line" data-startTime="664">And we're not saying that </span><span class="line" data-startTime="664">external resources are bad. </span> <span class="line" data-startTime="666">In fact, it's generally a very </span><span class="line" data-startTime="666">reasonable practice on desktop </span><span class="line" data-startTime="669">to have these resources for </span><span class="line" data-startTime="669">cacheability, and for easy </span><span class="line" data-startTime="672">composition of HTML. </span> <span class="line" data-startTime="674">But on a mobile device, if you </span><span class="line" data-startTime="674">assume 200 millisecond </span><span class="line" data-startTime="677">latency, maybe 300 millisecond, </span><span class="line" data-startTime="677">these extra round </span><span class="line" data-startTime="680">trips to fetch every additional </span><span class="line" data-startTime="680">resource is going </span><span class="line" data-startTime="682">to be very costly. </span></p>

<p><span class="line" data-startTime="684">And so what you really want to </span><span class="line" data-startTime="684">do is be able to avoid these </span><span class="line" data-startTime="686">blocking external scripts </span><span class="line" data-startTime="686">and stylesheets. </span> <span class="line" data-startTime="691">So generally speaking, when you </span><span class="line" data-startTime="691">do this, the way that you </span><span class="line" data-startTime="694">can get around this is you can </span><span class="line" data-startTime="694">be smart about the CSS. </span> <span class="line" data-startTime="697">You can inline parts of the CSS </span><span class="line" data-startTime="697">that are responsible for </span><span class="line" data-startTime="701">the above the fold content in </span><span class="line" data-startTime="701">the header of your HTML file. </span> <span class="line" data-startTime="704">And so, then when the browser </span><span class="line" data-startTime="704">is parsing through the file, </span><span class="line" data-startTime="708">at the point that it encounters </span><span class="line" data-startTime="708">that div, it knows </span><span class="line" data-startTime="710">how to style it and paint </span><span class="line" data-startTime="710">it to the screen. </span> <span class="line" data-startTime="715">And that's really where this </span><span class="line" data-startTime="715">third rule comes from &mdash; this </span><span class="line" data-startTime="717">notion of eliminating render </span><span class="line" data-startTime="717">blocking resources. </span> <span class="line" data-startTime="720">Understanding that there's </span><span class="line" data-startTime="720">certain things in the </span><span class="line" data-startTime="722">rendering pipeline that will </span><span class="line" data-startTime="722">block, because they don't have </span><span class="line" data-startTime="725">the right information, and </span><span class="line" data-startTime="725">making that information </span><span class="line" data-startTime="727">available to the browser </span><span class="line" data-startTime="727">at the right moment. </span> <span class="line" data-startTime="731">So let's say that I attended </span><span class="line" data-startTime="731">this talk, and I saw these </span><span class="line" data-startTime="734">three rules, and I think to </span><span class="line" data-startTime="734">myself, hey, I'm done. </span> <span class="line" data-startTime="736">I can just inline everything, </span><span class="line" data-startTime="736">and everything will be great. </span></p>

<p><span class="line" data-startTime="740">And I just want to add an </span><span class="line" data-startTime="740">additional caveat, which is </span><span class="line" data-startTime="742">where this fourth rule comes </span><span class="line" data-startTime="742">into play, which is this </span><span class="line" data-startTime="744">notion of the additional latency </span><span class="line" data-startTime="744">that comes due to the </span><span class="line" data-startTime="748">slow start of TCP. </span> <span class="line" data-startTime="750">So in this example, I've </span><span class="line" data-startTime="750">actually inlined all the CSS </span><span class="line" data-startTime="753">that I have. </span> <span class="line" data-startTime="754">I've put all the styling </span><span class="line" data-startTime="754">information there. </span> <span class="line" data-startTime="756">In fact, I've gone the extra </span><span class="line" data-startTime="756">step where I've added in the </span><span class="line" data-startTime="759">icons as data image URLs in </span><span class="line" data-startTime="759">the header of the CSS. </span></p>

<p><span class="line" data-startTime="763">Now, the problem is going </span><span class="line" data-startTime="763">to come up that &mdash; </span><span class="line" data-startTime="767">keep in mind that we want </span><span class="line" data-startTime="767">to reduce these </span><span class="line" data-startTime="769">round trips, right? </span><span class="line" data-startTime="770">And so if the initial above the </span><span class="line" data-startTime="770">fold content of your page </span><span class="line" data-startTime="773">is over 14K over that initial </span><span class="line" data-startTime="773">TCP congestion window, that's </span><span class="line" data-startTime="777">actually going to incur an </span><span class="line" data-startTime="777">additional round trip. </span> <span class="line" data-startTime="779">And so, you need to be </span><span class="line" data-startTime="779">really careful about </span><span class="line" data-startTime="782">how you inline something. </span> <span class="line" data-startTime="783">You can't just blindly inline a </span><span class="line" data-startTime="783">file, unless, of course, the </span><span class="line" data-startTime="786">file is below that cutoff. </span> <span class="line" data-startTime="788">But if a file's above that </span><span class="line" data-startTime="788">cutoff, you're going to need </span><span class="line" data-startTime="791">to figure out what are the </span><span class="line" data-startTime="791">critical parts of CSS, and </span><span class="line" data-startTime="794">what are the noncritical </span><span class="line" data-startTime="794">parts of CSS? </span><span class="line" data-startTime="796">And then you should use delay </span><span class="line" data-startTime="796">loading and asynchronous stuff </span><span class="line" data-startTime="799">for the parts that are not </span><span class="line" data-startTime="799">necessary for that initial </span><span class="line" data-startTime="801">user experience to really get </span><span class="line" data-startTime="801">to something in one second. </span> <span class="line" data-startTime="808">And I want to emphasize that </span><span class="line" data-startTime="808">we're not saying that you </span><span class="line" data-startTime="811">should only make your whole page </span><span class="line" data-startTime="811">fit in 14 kilobytes or 15 </span><span class="line" data-startTime="815">kilobytes, because that is kind </span><span class="line" data-startTime="815">of really stringent, and </span><span class="line" data-startTime="818">actually fairly difficult </span><span class="line" data-startTime="818">to do. </span></p>

<p><span class="line" data-startTime="820">You only need to make sure </span><span class="line" data-startTime="820">that the above the fold </span><span class="line" data-startTime="822">portion of your page fits. </span> <span class="line" data-startTime="823">And actually keep in mind that </span><span class="line" data-startTime="823">with compression, that's </span><span class="line" data-startTime="826">actually going to cause us </span><span class="line" data-startTime="826">to get a lot more space. </span> <span class="line" data-startTime="829">Maybe up to 45K of text. </span> <span class="line" data-startTime="834">And so that's where this is </span><span class="line" data-startTime="834">final rule comes from &mdash; this </span><span class="line" data-startTime="836">notion of prioritizing </span><span class="line" data-startTime="836">the visible content. </span> <span class="line" data-startTime="839">So be smart about what you're </span><span class="line" data-startTime="839">inlining, and make sure that </span><span class="line" data-startTime="843">it fits within this congestion </span><span class="line" data-startTime="843">window so that the user can </span><span class="line" data-startTime="845">get that content right away. </span> <span class="line" data-startTime="847">So now Brian is going to go into </span><span class="line" data-startTime="847">an example about how you </span><span class="line" data-startTime="851">apply these rules </span><span class="line" data-startTime="851">to a real site. </span></p>

<p class="speaker"><span class="line" data-starttime="855"><span class="speakerName">Bryan Mcquade</span>: Thanks, </span><span class="line" data-startTime="855">Doantam. </span> <span class="line" data-startTime="856">So I'm Bryan McQuaid. </span> <span class="line" data-startTime="857">I'm the tech lead of </span><span class="line" data-startTime="857">PageSpeed Insights. </span> <span class="line" data-startTime="859">And I'm going to take what we </span><span class="line" data-startTime="859">just learned from Mona and </span><span class="line" data-startTime="862">Doantam and apply that to an </span><span class="line" data-startTime="862">actual website that we created </span><span class="line" data-startTime="866">to work through and see how much </span><span class="line" data-startTime="866">faster we can make that </span><span class="line" data-startTime="869">website load on mobile. </span> <span class="line" data-startTime="870">So we have this demo website, </span><span class="line" data-startTime="872">demo.modspdy.com, that we put together. </span> <span class="line" data-startTime="874">It's a simple mobile page. </span> <span class="line" data-startTime="876">It sort of has characteristics </span><span class="line" data-startTime="876">of standard mobile websites. </span> <span class="line" data-startTime="879">It redirects to an m.site, it </span><span class="line" data-startTime="879">has a little bit of server </span><span class="line" data-startTime="882">processing time, it's reasonably </span><span class="line" data-startTime="882">small, and it has </span><span class="line" data-startTime="885">just one stylesheet in the </span><span class="line" data-startTime="885">head with some data URIs. </span> <span class="line" data-startTime="888">The page looks like </span><span class="line" data-startTime="888">this on the right. </span> <span class="line" data-startTime="890">And it's a simple page, right? </span><span class="line" data-startTime="892">We would expect a page like </span><span class="line" data-startTime="892">this to load quickly. </span></p>

<p><span class="line" data-startTime="894">We would hope, anyway, right? </span><span class="line" data-startTime="896">It turns out &mdash; </span><span class="line" data-startTime="899">and I suppose I should </span><span class="line" data-startTime="899">clarify. </span> <span class="line" data-startTime="902">Modspdy.com was a domain we had </span><span class="line" data-startTime="903">available to create a demo. </span> <span class="line" data-startTime="905">It has nothing to </span><span class="line" data-startTime="905">do with SPDY. </span> <span class="line" data-startTime="906">It just happened to </span><span class="line" data-startTime="906">be on that domain. </span> <span class="line" data-startTime="912">So now we'll sort of dive in, </span><span class="line" data-startTime="912">and we'll look at this page, </span><span class="line" data-startTime="914">figure out where the performance </span><span class="line" data-startTime="914">bottlenecks are, </span><span class="line" data-startTime="917">apply these optimizations one </span><span class="line" data-startTime="917">at a time, and then observe </span><span class="line" data-startTime="920">the improvement in load time </span><span class="line" data-startTime="920">that we get as result of </span><span class="line" data-startTime="922">applying those. </span> <span class="line" data-startTime="923">So to start, we have this </span><span class="line" data-startTime="923">unoptimized page here which </span><span class="line" data-startTime="926">literally just has </span><span class="line" data-startTime="926">three resources. </span></p>

<p><span class="line" data-startTime="927">We've got demo.modspdy.com, </span><span class="line" data-startTime="927">which redirects to </span><span class="line" data-startTime="931">m.modspdy.com, which </span><span class="line" data-startTime="931">then loads a </span><span class="line" data-startTime="933">single static CSS resource. </span> <span class="line" data-startTime="936">And what we see is that </span><span class="line" data-startTime="936">unfortunately, the load of </span><span class="line" data-startTime="942">these resources is completely </span><span class="line" data-startTime="942">serialized, and we essentially </span><span class="line" data-startTime="946">incur &mdash; because it's on HTTPS </span><span class="line" data-startTime="946">as well, we've got a fourth </span><span class="line" data-startTime="948">round trip in there &mdash; </span><span class="line" data-startTime="950">and the end result is that we're </span><span class="line" data-startTime="950">looking at about 6.6 </span><span class="line" data-startTime="953">seconds of latency before we </span><span class="line" data-startTime="953">see anything on the screen, </span><span class="line" data-startTime="955">even for a simple </span><span class="line" data-startTime="955">page like this. </span> <span class="line" data-startTime="958">So let's go ahead and look </span><span class="line" data-startTime="958">a little further. </span> <span class="line" data-startTime="965">So to start, we've got this </span><span class="line" data-startTime="965">redirect, demo.modspdy.com, </span><span class="line" data-startTime="968">which redirects to </span><span class="line" data-startTime="968">m.modspdy.com. </span></p>

<p><span class="line" data-startTime="970">And we know that's costly. </span> <span class="line" data-startTime="972">Mona has showed us. </span> <span class="line" data-startTime="973">In fact, in this particular </span><span class="line" data-startTime="973">environment, we're using web </span><span class="line" data-startTime="975">page tests' 3G modeling. </span> <span class="line" data-startTime="978">Round trips are actually </span><span class="line" data-startTime="978">300 milliseconds. </span> <span class="line" data-startTime="980">So we've talked about 200 being </span><span class="line" data-startTime="980">a good general target to </span><span class="line" data-startTime="983">be in between 3G and 4G. </span> <span class="line" data-startTime="986">But for 200 milliseconds, </span><span class="line" data-startTime="986">that is. </span> <span class="line" data-startTime="988">For this particular demo, we're </span><span class="line" data-startTime="988">using a 300 millisecond </span><span class="line" data-startTime="990">round trip time. </span> <span class="line" data-startTime="992">And on top of that, because it's </span><span class="line" data-startTime="992">on HTTPS, we're looking </span><span class="line" data-startTime="994">at four round trips. </span> <span class="line" data-startTime="996">So that redirect ends up costing </span><span class="line" data-startTime="996">us, by itself, 4 times </span><span class="line" data-startTime="999">300, 1.2 seconds. </span> <span class="line" data-startTime="1002">So the question becomes, </span><span class="line" data-startTime="1002">how do we avoid that? </span><span class="line" data-startTime="1003">How do we avoid that cost? </span><span class="line" data-startTime="1005">There are really two good </span><span class="line" data-startTime="1005">ways to approach this. </span></p>

<p><span class="line" data-startTime="1007">At a high level, we have to make </span><span class="line" data-startTime="1007">sure that we serve the </span><span class="line" data-startTime="1010">user content at the URL they </span><span class="line" data-startTime="1010">request initially, right? </span><span class="line" data-startTime="1013">If we redirect them from </span><span class="line" data-startTime="1013">demo.modspdy.com to </span><span class="line" data-startTime="1017">m.modspdy.com, we saw we're </span><span class="line" data-startTime="1017">inherently going to experience </span><span class="line" data-startTime="1021">that additional latency. </span> <span class="line" data-startTime="1023">So what we have to do is </span><span class="line" data-startTime="1023">instead serve the right </span><span class="line" data-startTime="1025">content to the right users </span><span class="line" data-startTime="1025">at the URL they request. </span> <span class="line" data-startTime="1028">So what that means is </span><span class="line" data-startTime="1028">one of two things. </span> <span class="line" data-startTime="1029">Either user responsive design, </span><span class="line" data-startTime="1029">which allows you to serve the </span><span class="line" data-startTime="1032">same HTML to all your users, </span><span class="line" data-startTime="1032">be it mobile users, desktop </span><span class="line" data-startTime="1035">users, and the page will render </span><span class="line" data-startTime="1035">differently depending </span><span class="line" data-startTime="1038">on the device characteristics. </span> <span class="line" data-startTime="1040">And I should say, that's a </span><span class="line" data-startTime="1040">great approach if you're </span><span class="line" data-startTime="1042">building a site from scratch. </span> <span class="line" data-startTime="1044">I think that's the </span><span class="line" data-startTime="1044">right way to go. </span></p>

<p><span class="line" data-startTime="1045">But if you've got an existing </span><span class="line" data-startTime="1045">mobile website and desktop </span><span class="line" data-startTime="1048">website, and you're just trying </span><span class="line" data-startTime="1048">to figure out, well, </span><span class="line" data-startTime="1051">how do I move from having this </span><span class="line" data-startTime="1051">redirect to not, then what you </span><span class="line" data-startTime="1055">want to do is make sure that you </span><span class="line" data-startTime="1055">vary the HTML content that </span><span class="line" data-startTime="1059">you serve to your users based on </span><span class="line" data-startTime="1059">the user agent coming in at </span><span class="line" data-startTime="1062">the web server. </span> <span class="line" data-startTime="1063">And so if you're getting a </span><span class="line" data-startTime="1063">request from a mobile user </span><span class="line" data-startTime="1066">agent, you serve the mobile HTML </span><span class="line" data-startTime="1066">directly, and if you get </span><span class="line" data-startTime="1070">a request from a desktop user, </span><span class="line" data-startTime="1070">you serve the desktop HTML for </span><span class="line" data-startTime="1074">them as well. </span> <span class="line" data-startTime="1078">So it's easy enough to </span><span class="line" data-startTime="1078">sort of say, just go </span><span class="line" data-startTime="1080">ahead and do that. </span> <span class="line" data-startTime="1080">Let's go ahead and do </span><span class="line" data-startTime="1080">a quick example. </span> <span class="line" data-startTime="1083">I'm actually on the web server </span><span class="line" data-startTime="1083">for modspdy.com now. </span> <span class="line" data-startTime="1086">And we can take a look in </span><span class="line" data-startTime="1086">the demo directory. </span> <span class="line" data-startTime="1091">We've got a couple files. </span></p>

<p><span class="line" data-startTime="1093">This is an Apache web server. </span> <span class="line" data-startTime="1095">So I'm going to go ahead and </span><span class="line" data-startTime="1095">actually bring up the </span><span class="line" data-startTime="1097">.htaccess file for </span><span class="line" data-startTime="1097">demo.modspdy.com, </span><span class="line" data-startTime="1101">and we'll see that &mdash; </span><span class="line" data-startTime="1102">so .htaccess file is an Apache </span><span class="line" data-startTime="1102">file that lets you specify </span><span class="line" data-startTime="1105">additional information about how </span><span class="line" data-startTime="1105">content should be served. </span> <span class="line" data-startTime="1109">And what we've done here is we </span><span class="line" data-startTime="1109">have this rewrite rule that </span><span class="line" data-startTime="1113">basically says, conditionally </span><span class="line" data-startTime="1113">apply the following rule if </span><span class="line" data-startTime="1117">the HTTP user agent matches </span><span class="line" data-startTime="1117">either iPhone or Android. </span> <span class="line" data-startTime="1120">So basically, a very simple </span><span class="line" data-startTime="1120">mobile user agent matcher. </span> <span class="line" data-startTime="1123">You could expand on this. </span> <span class="line" data-startTime="1124">And then if that matched, </span><span class="line" data-startTime="1124">go ahead and </span><span class="line" data-startTime="1127">rewrite the empty URL &mdash; </span><span class="line" data-startTime="1129">so that is the URL with just a </span><span class="line" data-startTime="1129">slash, essentially &mdash; no URL, </span><span class="line" data-startTime="1133">just the host name &mdash; </span><span class="line" data-startTime="1134">to HTTPS://m.modspdy.com. </span> <span class="line" data-startTime="1136">So that's the costly one that </span><span class="line" data-startTime="1136">we just looked at that </span><span class="line" data-startTime="1139">incurred that 1.2 seconds </span><span class="line" data-startTime="1139">of latency. </span> <span class="line" data-startTime="1141">So if, instead, we tell Apache </span><span class="line" data-startTime="1141">to rewrite that URL to a local </span><span class="line" data-startTime="1148">file, then what we'll get &mdash; </span><span class="line" data-startTime="1153">so let me do this, actually. </span></p>

<p><span class="line" data-startTime="1155">Let me go ahead and put </span><span class="line" data-startTime="1155">demo.modspdy.com on there, and </span><span class="line" data-startTime="1163">we can see it redirect. </span> <span class="line" data-startTime="1166">So that was before. </span> <span class="line" data-startTime="1167">And if we just switch those &mdash; </span><span class="line" data-startTime="1172">so now I'll go ahead </span><span class="line" data-startTime="1172">and do that again. </span> <span class="line" data-startTime="1178">And now we can see that the </span><span class="line" data-startTime="1178">content that we had been re </span><span class="line" data-startTime="1181">directing users to on m dot is </span><span class="line" data-startTime="1181">now served directly from </span><span class="line" data-startTime="1184">demo.modspdy.com. </span> <span class="line" data-startTime="1186">And just to sort </span><span class="line" data-startTime="1186">of close that &mdash; </span><span class="line" data-startTime="1188">so it's a pretty simple thing </span><span class="line" data-startTime="1188">to configure, right? </span><span class="line" data-startTime="1190">This is the Apache variant, but </span><span class="line" data-startTime="1190">if you use a different web </span><span class="line" data-startTime="1192">server, they all support </span><span class="line" data-startTime="1192">this in different ways. </span> <span class="line" data-startTime="1195">And then just to look &mdash; </span><span class="line" data-startTime="1196">so we're saying, basically, </span><span class="line" data-startTime="1196">serve up mobile.php instead. </span></p>

<p><span class="line" data-startTime="1201">Why don't we look at what </span><span class="line" data-startTime="1201">that file looks like? </span><span class="line" data-startTime="1211">So that's just a sim link over </span><span class="line" data-startTime="1211">to the m.modspdy.com index </span><span class="line" data-startTime="1216">file, right? </span><span class="line" data-startTime="1216">Which is exactly what we were </span><span class="line" data-startTime="1217">redirecting the user to before. </span> <span class="line" data-startTime="1219">And so now we're able to </span><span class="line" data-startTime="1219">avoid that redirect. </span> <span class="line" data-startTime="1222">And let's see the effect </span><span class="line" data-startTime="1222">of doing that on </span><span class="line" data-startTime="1227">the page load time. </span> <span class="line" data-startTime="1230">So if we think about what we </span><span class="line" data-startTime="1230">expect to happen here, we're </span><span class="line" data-startTime="1234">removing, as we talked about, </span><span class="line" data-startTime="1234">four round trips &mdash; </span><span class="line" data-startTime="1237">DNS, TCP, SSL, and request and </span><span class="line" data-startTime="1237">response, each of which cost </span><span class="line" data-startTime="1241">300 millis from the </span><span class="line" data-startTime="1241">time to display. </span></p>

<p><span class="line" data-startTime="1244">We were at 6.6 seconds before, </span><span class="line" data-startTime="1244">and as a result of removing </span><span class="line" data-startTime="1249">that redirect, indeed, we see </span><span class="line" data-startTime="1249">the load time of the page drop </span><span class="line" data-startTime="1252">to 5.4 seconds, which is </span><span class="line" data-startTime="1252">exactly what we expect. </span> <span class="line" data-startTime="1254">So we've sort of confirmed </span><span class="line" data-startTime="1254">through our test environment </span><span class="line" data-startTime="1258">here the result that we </span><span class="line" data-startTime="1258">would expect to see. </span> <span class="line" data-startTime="1263">And by the way, did </span><span class="line" data-startTime="1263">I mention &mdash; </span><span class="line" data-startTime="1265">so I don't know, how many </span><span class="line" data-startTime="1265">people are familiar </span><span class="line" data-startTime="1266">with Web Page Test? </span><span class="line" data-startTime="1268">OK, so not most. </span> <span class="line" data-startTime="1270">So we've used Web Page Test to </span><span class="line" data-startTime="1270">both produce these videos and </span><span class="line" data-startTime="1273">the waterfall underneath, which </span><span class="line" data-startTime="1273">shows the resources that </span><span class="line" data-startTime="1276">are loaded and the time that </span><span class="line" data-startTime="1276">each one is loaded at. </span> <span class="line" data-startTime="1278">It's a really great resource, </span><span class="line" data-startTime="1278">webpagetest.org. </span> <span class="line" data-startTime="1281">You can tell it, show me what </span><span class="line" data-startTime="1281">my page looks like over a 3G </span><span class="line" data-startTime="1284">connection from various </span><span class="line" data-startTime="1284">locations around the world </span><span class="line" data-startTime="1287">using different kinds of </span><span class="line" data-startTime="1287">devices, get these videos, </span><span class="line" data-startTime="1290">look at still frames. </span></p>

<p><span class="line" data-startTime="1291">It's a really rich tool to </span><span class="line" data-startTime="1291">understand what the experience </span><span class="line" data-startTime="1295">your users are seeing is. </span> <span class="line" data-startTime="1297">And so we've use that to </span><span class="line" data-startTime="1297">create these here. </span> <span class="line" data-startTime="1302">OK, so let's go ahead and </span><span class="line" data-startTime="1302">dive into the next. </span> <span class="line" data-startTime="1304">So we've improved </span><span class="line" data-startTime="1304">the page, right? </span><span class="line" data-startTime="1305">We've gone from 6.6 seconds to </span><span class="line" data-startTime="1305">5.4 seconds, but it's still by </span><span class="line" data-startTime="1309">no means fast. </span> <span class="line" data-startTime="1310">So let's go ahead and dive </span><span class="line" data-startTime="1310">in and talk about server </span><span class="line" data-startTime="1312">processing time. </span> <span class="line" data-startTime="1318">So there's sort of two things </span><span class="line" data-startTime="1318">you want to think about when </span><span class="line" data-startTime="1320">you think about server </span><span class="line" data-startTime="1320">processing time. </span> <span class="line" data-startTime="1322">One is, what is your server </span><span class="line" data-startTime="1322">processing time? </span><span class="line" data-startTime="1324">How do you measure that? </span><span class="line" data-startTime="1324">And two, if it's high, why is </span><span class="line" data-startTime="1324">it high, and what can you do </span><span class="line" data-startTime="1328">to reduce that? </span><span class="line" data-startTime="1329">And so we can go ahead and take </span><span class="line" data-startTime="1329">a look at that actual </span><span class="line" data-startTime="1332">page we have. </span> <span class="line" data-startTime="1334">I'll bring up Chrome Dev Tools, </span><span class="line" data-startTime="1334">bring up the network </span><span class="line" data-startTime="1338">tab, and then I'm going to </span><span class="line" data-startTime="1338">go ahead and reload. </span></p>

<p><span class="line" data-startTime="1347">And so we can see here that </span><span class="line" data-startTime="1347">the waiting time, when we </span><span class="line" data-startTime="1350">click on the resource for </span><span class="line" data-startTime="1350">demo.modspdy.com and the </span><span class="line" data-startTime="1353">timing, the waiting time &mdash; </span><span class="line" data-startTime="1354">I don't know if you can read </span><span class="line" data-startTime="1354">that, it's pretty small &mdash; </span><span class="line" data-startTime="1356">is 1.6 seconds. </span> <span class="line" data-startTime="1357">So we've got 1.6 seconds of time </span><span class="line" data-startTime="1357">between the time we sent </span><span class="line" data-startTime="1360">the request and the time </span><span class="line" data-startTime="1360">the first bytes of the </span><span class="line" data-startTime="1362">response came back. </span> <span class="line" data-startTime="1363">So it's quite high. </span> <span class="line" data-startTime="1364">We'd expect to see maybe one </span><span class="line" data-startTime="1364">network round trip there, but </span><span class="line" data-startTime="1366">1.6 seconds is way above </span><span class="line" data-startTime="1366">that, right? </span><span class="line" data-startTime="1368">And so then the question </span><span class="line" data-startTime="1368">becomes, well, why? </span><span class="line" data-startTime="1370">What's going on there? </span><span class="line" data-startTime="1370">Why is it so high? </span><span class="line" data-startTime="1372">And so it's a little bit outside </span><span class="line" data-startTime="1372">the scope of the talk </span><span class="line" data-startTime="1375">to sort of figure out and </span><span class="line" data-startTime="1375">understand server processing </span><span class="line" data-startTime="1378">time deeply, but at a high </span><span class="line" data-startTime="1378">level, what you need to do is </span><span class="line" data-startTime="1381">essentially measure </span><span class="line" data-startTime="1381">this server side. </span> <span class="line" data-startTime="1383">So what are those times? </span><span class="line" data-startTime="1384">And then, ideally, have some </span><span class="line" data-startTime="1384">monitoring infrastructure in </span><span class="line" data-startTime="1387">place that helps you understand </span><span class="line" data-startTime="1387">if it's high, where </span><span class="line" data-startTime="1389">that time is going. </span> <span class="line" data-startTime="1390">And so one of the tools </span><span class="line" data-startTime="1390">we like for this </span><span class="line" data-startTime="1393">is called New Relic. </span></p>

<p><span class="line" data-startTime="1394">They have a free offering that </span><span class="line" data-startTime="1394">you can use, and it lets you </span><span class="line" data-startTime="1399">see at a high level where time </span><span class="line" data-startTime="1399">is going within your </span><span class="line" data-startTime="1401">application. </span> <span class="line" data-startTime="1401">So I'll go ahead and just bring </span><span class="line" data-startTime="1401">up the New Relic view </span><span class="line" data-startTime="1403">for this webpage. </span> <span class="line" data-startTime="1407">And so this graph in the middle </span><span class="line" data-startTime="1407">here is showing us over </span><span class="line" data-startTime="1409">time how long the server took to </span><span class="line" data-startTime="1409">generate various responses </span><span class="line" data-startTime="1413">that were requested for </span><span class="line" data-startTime="1413">the particular URL </span><span class="line" data-startTime="1415">we're looking at. </span> <span class="line" data-startTime="1416">And so we've got a breakdown by </span><span class="line" data-startTime="1416">database time and PHP time, </span><span class="line" data-startTime="1420">and so we can see that, by and </span><span class="line" data-startTime="1420">large, recently, anyway &mdash; </span><span class="line" data-startTime="1425">and so I should say these pits </span><span class="line" data-startTime="1425">are just places where there </span><span class="line" data-startTime="1427">were no requests. </span> <span class="line" data-startTime="1429">It's a demo page, so </span><span class="line" data-startTime="1429">there's not a whole </span><span class="line" data-startTime="1430">lot of activity here. </span></p>

<p><span class="line" data-startTime="1432">But by and large, we're seeing </span><span class="line" data-startTime="1432">pretty substantial time spent </span><span class="line" data-startTime="1436">in the database querying, and </span><span class="line" data-startTime="1436">a little bit of time in that </span><span class="line" data-startTime="1440">blue, though nonzero </span><span class="line" data-startTime="1440">time, right? </span><span class="line" data-startTime="1443">A couple hundred mills in the </span><span class="line" data-startTime="1443">PHP execution environment. </span> <span class="line" data-startTime="1447">And so then the question </span><span class="line" data-startTime="1447">becomes why? </span><span class="line" data-startTime="1448">What are we doing? </span><span class="line" data-startTime="1450">And what can we do to sort </span><span class="line" data-startTime="1450">of address those? </span><span class="line" data-startTime="1453">So I'll just look really </span><span class="line" data-startTime="1453">quickly at our page. </span> <span class="line" data-startTime="1459">And this is just </span><span class="line" data-startTime="1459">a simple demo. </span> <span class="line" data-startTime="1460">But sure enough, we've </span><span class="line" data-startTime="1460">got two things. </span> <span class="line" data-startTime="1463">Get data from database, and then </span><span class="line" data-startTime="1463">render the HTML with that </span><span class="line" data-startTime="1466">data, right? </span><span class="line" data-startTime="1468">And I've sort of created the </span><span class="line" data-startTime="1468">queries in such a way that </span><span class="line" data-startTime="1471">they're intentionally slow for </span><span class="line" data-startTime="1471">the purpose of this demo, but </span><span class="line" data-startTime="1473">this is something we see pretty </span><span class="line" data-startTime="1473">often is that pages </span><span class="line" data-startTime="1477">will have multiple second for </span><span class="line" data-startTime="1477">spike times as a result of </span><span class="line" data-startTime="1481">spending a lot of time either </span><span class="line" data-startTime="1481">in the database or executing </span><span class="line" data-startTime="1483">PHP, or possibly some </span><span class="line" data-startTime="1483">other reason. </span></p>

<p><span class="line" data-startTime="1486">But in any case, now that we </span><span class="line" data-startTime="1486">know that, the question </span><span class="line" data-startTime="1488">becomes what can we do </span><span class="line" data-startTime="1488">to reduce this time? </span><span class="line" data-startTime="1495">And our options are really </span><span class="line" data-startTime="1495">remove, defer, or optimize. </span> <span class="line" data-startTime="1500">And in this case, I observe </span><span class="line" data-startTime="1500">the page is generated </span><span class="line" data-startTime="1506">dynamically, but it's really </span><span class="line" data-startTime="1506">static content, right? </span><span class="line" data-startTime="1509">And this is a common pattern </span><span class="line" data-startTime="1509">you see, too, right? </span><span class="line" data-startTime="1511">You've got a page that's mostly </span><span class="line" data-startTime="1511">static or it might </span><span class="line" data-startTime="1513">change periodically, but </span><span class="line" data-startTime="1513">fundamentally, it doesn't </span><span class="line" data-startTime="1516">change on every request, but </span><span class="line" data-startTime="1516">it's still generated </span><span class="line" data-startTime="1518">dynamically from the database </span><span class="line" data-startTime="1518">on every request, and that </span><span class="line" data-startTime="1521">ends up, in some cases, adding </span><span class="line" data-startTime="1521">a good bit of latency. </span> <span class="line" data-startTime="1524">So in this case, because it's </span><span class="line" data-startTime="1524">mostly static, we can simply </span><span class="line" data-startTime="1528">just whenever we update the </span><span class="line" data-startTime="1528">database to have a new product </span><span class="line" data-startTime="1530">or whatever it may be, just </span><span class="line" data-startTime="1530">render that to HTML, right? </span><span class="line" data-startTime="1533">Dump that to a static HTML file </span><span class="line" data-startTime="1533">on the web server, and </span><span class="line" data-startTime="1536">then just serve that instead. </span> <span class="line" data-startTime="1537">And so I've done that. </span></p>

<p><span class="line" data-startTime="1541">Or I thought I did that. </span> <span class="line" data-startTime="1543">I did do that. </span> <span class="line" data-startTime="1545">It's over here. </span> <span class="line" data-startTime="1547">And we can see now, we'll </span><span class="line" data-startTime="1547">go ahead and reload </span><span class="line" data-startTime="1551">it and take a look &mdash; </span><span class="line" data-startTime="1554">that our waiting time has gone </span><span class="line" data-startTime="1554">from that 1.6 seconds down to </span><span class="line" data-startTime="1557">84 milliseconds, because we're </span><span class="line" data-startTime="1557">not invoking the database and </span><span class="line" data-startTime="1560">running the PHP engine </span><span class="line" data-startTime="1560">on every request now. </span> <span class="line" data-startTime="1562">We just rendered this to static </span><span class="line" data-startTime="1562">content, and we're </span><span class="line" data-startTime="1563">serving that instead. </span> <span class="line" data-startTime="1565">And so, in general, as much as </span><span class="line" data-startTime="1565">you can precompute ideally all </span><span class="line" data-startTime="1567">of the content, if your pages </span><span class="line" data-startTime="1567">doesn't have any dynamic </span><span class="line" data-startTime="1570">pieces &mdash; many pages do have a </span><span class="line" data-startTime="1570">little bit that's dynamic, but </span><span class="line" data-startTime="1572">if you can precompute the </span><span class="line" data-startTime="1572">majority of it to minimize the </span><span class="line" data-startTime="1575">work in the request path of </span><span class="line" data-startTime="1575">the user, you'll create a </span><span class="line" data-startTime="1578">better experience </span><span class="line" data-startTime="1578">for your users. </span></p>

<p><span class="line" data-startTime="1581">So that's server processing </span><span class="line" data-startTime="1581">time. </span> <span class="line" data-startTime="1586">And so now we can see &mdash; </span><span class="line" data-startTime="1586">that was about 1.5, </span><span class="line" data-startTime="1588">1.6 seconds we saw. </span> <span class="line" data-startTime="1589">And indeed, again, we were </span><span class="line" data-startTime="1589">at &mdash; what was it? </span><span class="line" data-startTime="1594">5.4 seconds? </span><span class="line" data-startTime="1595">And now we're down </span><span class="line" data-startTime="1595">to 3.8 seconds. </span> <span class="line" data-startTime="1596">So we've reduced render time, </span><span class="line" data-startTime="1596">again, by another 1.6 seconds. </span> <span class="line" data-startTime="1600">And you can see that if we go </span><span class="line" data-startTime="1600">backwards a little bit, this </span><span class="line" data-startTime="1609">sort of green region right here </span><span class="line" data-startTime="1609">in the old version was </span><span class="line" data-startTime="1612">quite long. </span> <span class="line" data-startTime="1612">That was that server </span><span class="line" data-startTime="1612">processing time. </span> <span class="line" data-startTime="1614">And we can see now that that </span><span class="line" data-startTime="1614">green region is much shorter. </span> <span class="line" data-startTime="1620">And that's where we've pulled </span><span class="line" data-startTime="1620">in time, and that's resulted </span><span class="line" data-startTime="1622">in a faster render </span><span class="line" data-startTime="1622">on the screen. </span></p>

<p><span class="line" data-startTime="1624">So let's keep going. </span> <span class="line" data-startTime="1626">We're doing well, but </span><span class="line" data-startTime="1626">we're not to our one </span><span class="line" data-startTime="1628">second target yet. </span> <span class="line" data-startTime="1629">And I should &mdash; </span><span class="line" data-startTime="1629">I guess a spoiler alert. </span> <span class="line" data-startTime="1630">It's physically impossible to </span><span class="line" data-startTime="1630">get to one second in this </span><span class="line" data-startTime="1632">configuration. </span> <span class="line" data-startTime="1633">So we're not going to get there, </span><span class="line" data-startTime="1633">but we're going to get </span><span class="line" data-startTime="1635">as close as we can get. </span> <span class="line" data-startTime="1636">We're going to get </span><span class="line" data-startTime="1636">quite close. </span> <span class="line" data-startTime="1637">So let's see how close </span><span class="line" data-startTime="1637">we can get. </span> <span class="line" data-startTime="1640">So as Doantam talked about, the </span><span class="line" data-startTime="1640">load of our external CSS </span><span class="line" data-startTime="1644">resource blocks rendering </span><span class="line" data-startTime="1644">of page content. </span> <span class="line" data-startTime="1647">So that actually ends up </span><span class="line" data-startTime="1647">incurring seven round trips on </span><span class="line" data-startTime="1650">the network, and at 300 </span><span class="line" data-startTime="1650">milliseconds, that's a very </span><span class="line" data-startTime="1652">substantial cost. </span> <span class="line" data-startTime="1654">So that's the first thing we can </span><span class="line" data-startTime="1654">do &mdash; a very simple, very </span><span class="line" data-startTime="1656">easy thing &mdash; is just simply </span><span class="line" data-startTime="1656">experiment with inlining all </span><span class="line" data-startTime="1658">that content. </span></p>

<p><span class="line" data-startTime="1659">And people do this </span><span class="line" data-startTime="1659">a lot on mobile. </span> <span class="line" data-startTime="1660">It's a pretty common </span><span class="line" data-startTime="1660">technique, right? </span><span class="line" data-startTime="1662">Just inline, inline, inline. </span> <span class="line" data-startTime="1663">As Doantam talked about, there </span><span class="line" data-startTime="1663">are some drawbacks to that. </span> <span class="line" data-startTime="1666">So we'll start with that. </span> <span class="line" data-startTime="1667">We'll start with inlining, and </span><span class="line" data-startTime="1667">then we'll iterate from there. </span> <span class="line" data-startTime="1672">So if this is our first page, </span><span class="line" data-startTime="1672">with the external stylesheet, </span><span class="line" data-startTime="1677">then we can simply, as Doantam </span><span class="line" data-startTime="1677">showed, inline all the styles </span><span class="line" data-startTime="1683">and serve it up. </span> <span class="line" data-startTime="1684">And so what does this actually </span><span class="line" data-startTime="1684">do in terms of load time </span><span class="line" data-startTime="1686">performance? </span><span class="line" data-startTime="1690">And so what we see is we're down </span><span class="line" data-startTime="1690">from, I believe it was </span><span class="line" data-startTime="1692">3.6 seconds before, now </span><span class="line" data-startTime="1692">down to 2.4 seconds. </span> <span class="line" data-startTime="1695">So we've removed 1.2 seconds, </span><span class="line" data-startTime="1695">which, interestingly, is the </span><span class="line" data-startTime="1698">four round trips from the DNS, </span><span class="line" data-startTime="1698">TCP, SSL and request response </span><span class="line" data-startTime="1703">of that external stylesheet. </span> <span class="line" data-startTime="1704">We've essentially eliminated </span><span class="line" data-startTime="1704">those. </span> <span class="line" data-startTime="1706">We still have the round trips </span><span class="line" data-startTime="1706">for fetching the stylesheet, </span><span class="line" data-startTime="1709">though, right? </span><span class="line" data-startTime="1710">They've just moved </span><span class="line" data-startTime="1710">to be inline. </span> <span class="line" data-startTime="1712">And we're still paying </span><span class="line" data-startTime="1712">that cost. </span></p>

<p><span class="line" data-startTime="1714">And worse than that, we've </span><span class="line" data-startTime="1714">moved those assets from a </span><span class="line" data-startTime="1718">cacheable resource &mdash; </span><span class="line" data-startTime="1718">a CSS file &mdash; </span><span class="line" data-startTime="1721">into sort of a non-cacheable </span><span class="line" data-startTime="1721">HTML payload. </span> <span class="line" data-startTime="1724">So repeat visitors to our </span><span class="line" data-startTime="1724">site are going to end up </span><span class="line" data-startTime="1726">downloading that content on </span><span class="line" data-startTime="1726">every visit, which is pretty </span><span class="line" data-startTime="1729">undesirable, right? </span><span class="line" data-startTime="1730">And so let's see as a final sort </span><span class="line" data-startTime="1730">of optimization if we can </span><span class="line" data-startTime="1735">go ahead and address </span><span class="line" data-startTime="1735">that issue and </span><span class="line" data-startTime="1736">make the page faster. </span> <span class="line" data-startTime="1738">So the only issue we're faced </span><span class="line" data-startTime="1738">with now is that we've got </span><span class="line" data-startTime="1741">this large blob of CSS in the </span><span class="line" data-startTime="1741">head, and as Doantam talked </span><span class="line" data-startTime="1744">about, that ends up delaying </span><span class="line" data-startTime="1744">render of the page due to the </span><span class="line" data-startTime="1748">TCP congestion window growth. </span> <span class="line" data-startTime="1751">And so what we want to do is </span><span class="line" data-startTime="1751">essentially identify the </span><span class="line" data-startTime="1754">critical CSS &mdash; </span><span class="line" data-startTime="1755">that CSS that's needed </span><span class="line" data-startTime="1755">to style and position </span><span class="line" data-startTime="1758">content on the page &mdash; </span><span class="line" data-startTime="1759">and load that inline </span><span class="line" data-startTime="1759">in the head. </span></p>

<p><span class="line" data-startTime="1762">And ideally, that's small. </span> <span class="line" data-startTime="1764">And then defer the </span><span class="line" data-startTime="1764">non-critical CSS. </span> <span class="line" data-startTime="1767">So let's see what that </span><span class="line" data-startTime="1767">might look like. </span> <span class="line" data-startTime="1770">So if we take note of the fact </span><span class="line" data-startTime="1770">that the CSS is largely data </span><span class="line" data-startTime="1775">URIs, right? </span><span class="line" data-startTime="1777">And those data URIs are big. </span> <span class="line" data-startTime="1778">They also don't compress very </span><span class="line" data-startTime="1778">well, so they end up taking a </span><span class="line" data-startTime="1782">lot of time on the network. </span> <span class="line" data-startTime="1786">If we say, well, we'll reserve </span><span class="line" data-startTime="1786">this space for those </span><span class="line" data-startTime="1789">images in the HTML &mdash; </span><span class="line" data-startTime="1790">we'll carve out that 100 by </span><span class="line" data-startTime="1790">100 pixel block, and we'll </span><span class="line" data-startTime="1793">make sure to put that style in </span><span class="line" data-startTime="1793">early so things don't move </span><span class="line" data-startTime="1795">around when the stylesheet </span><span class="line" data-startTime="1795">loads, but then we'll load the </span><span class="line" data-startTime="1798">remaining content in a deferred </span><span class="line" data-startTime="1798">stylesheet in a way </span><span class="line" data-startTime="1800">that doesn't block render, </span><span class="line" data-startTime="1800">then we can make the page </span><span class="line" data-startTime="1803">faster and recover a lot of </span><span class="line" data-startTime="1803">the caching benefits of </span><span class="line" data-startTime="1806">externalizing that content </span><span class="line" data-startTime="1806">in the CSS resource. </span> <span class="line" data-startTime="1811">So let's go ahead and take a </span><span class="line" data-startTime="1811">look at the effect of that. </span></p>

<p><span class="line" data-startTime="1817">And so here we've achieved an </span><span class="line" data-startTime="1817">even more dramatic speedup of </span><span class="line" data-startTime="1821">the first paint time. </span> <span class="line" data-startTime="1822">Now we're at 1.5 seconds </span><span class="line" data-startTime="1822">to display </span><span class="line" data-startTime="1824">almost all the content. </span> <span class="line" data-startTime="1826">You can see that the Chrome </span><span class="line" data-startTime="1826">icon comes in a bit later. </span> <span class="line" data-startTime="1829">And so it's interesting to </span><span class="line" data-startTime="1829">look at the waterfall. </span> <span class="line" data-startTime="1832">For the first time, we've </span><span class="line" data-startTime="1832">actually moved the paint line </span><span class="line" data-startTime="1834">from the end in, and then we can </span><span class="line" data-startTime="1834">see the first paint line </span><span class="line" data-startTime="1838">here &mdash; this green line &mdash; </span><span class="line" data-startTime="1839">actually happens, essentially, </span><span class="line" data-startTime="1839">before the deferred stylesheet </span><span class="line" data-startTime="1844">has to load. </span></p>

<p><span class="line" data-startTime="1845">So we've basically achieved a </span><span class="line" data-startTime="1845">render very shortly after the </span><span class="line" data-startTime="1849">four round trips we incur for </span><span class="line" data-startTime="1849">the network cost, which is </span><span class="line" data-startTime="1851">about as good as we can </span><span class="line" data-startTime="1851">do on this page. </span> <span class="line" data-startTime="1853">And then the remaining deferred </span><span class="line" data-startTime="1853">styles come in later, </span><span class="line" data-startTime="1856">and they automatically kind of &mdash; </span><span class="line" data-startTime="1856">we'll watch it again just </span><span class="line" data-startTime="1858">to see it, right? </span><span class="line" data-startTime="1859">The Chrome icon comes </span><span class="line" data-startTime="1859">in a slightly </span><span class="line" data-startTime="1860">later time at the end. </span> <span class="line" data-startTime="1865">So one other thing I did just </span><span class="line" data-startTime="1865">as a kind of advanced </span><span class="line" data-startTime="1867">optimization &mdash; </span><span class="line" data-startTime="1868">if some of the icons on your </span><span class="line" data-startTime="1868">page are really high priority, </span><span class="line" data-startTime="1871">you can inline low resolution </span><span class="line" data-startTime="1871">previews of those, and that's </span><span class="line" data-startTime="1873">what I've done with the </span><span class="line" data-startTime="1873">PageSpeed icon. </span> <span class="line" data-startTime="1875">And that causes that content to </span><span class="line" data-startTime="1875">show up a little sooner so </span><span class="line" data-startTime="1877">the user can see it, but doesn't </span><span class="line" data-startTime="1877">have the cost of </span><span class="line" data-startTime="1881">downloading the full </span><span class="line" data-startTime="1881">image asset inline </span><span class="line" data-startTime="1884">in a blocking manner. </span></p>

<p><span class="line" data-startTime="1885">So just real quickly to close, </span><span class="line" data-startTime="1885">let's go ahead and look at </span><span class="line" data-startTime="1889">where we were and where </span><span class="line" data-startTime="1889">we ended up. </span> <span class="line" data-startTime="1896">So we went from a the first ping </span><span class="line" data-startTime="1896">time of 6.6 seconds to </span><span class="line" data-startTime="1899">about 1.5 seconds, which is just </span><span class="line" data-startTime="1899">about as low as we can </span><span class="line" data-startTime="1902">get, right? </span><span class="line" data-startTime="1903">That's the sort of absolute </span><span class="line" data-startTime="1903">minimum is the four round trip </span><span class="line" data-startTime="1905">times of 1.2. </span> <span class="line" data-startTime="1906">So we've got a little bit of </span><span class="line" data-startTime="1906">browser processing time in </span><span class="line" data-startTime="1908">there, and we've basically </span><span class="line" data-startTime="1908">streamlined </span><span class="line" data-startTime="1910">this as much as possible. </span> <span class="line" data-startTime="1917">So that's it. </span> <span class="line" data-startTime="1918">So at a high level, designing </span><span class="line" data-startTime="1918">for high latency means </span><span class="line" data-startTime="1920">following these four </span><span class="line" data-startTime="1920">best practices. </span></p>

<p><span class="line" data-startTime="1922">Avoiding landing page redirects, </span><span class="line" data-startTime="1922">minimizing server </span><span class="line" data-startTime="1924">processing time, eliminating </span><span class="line" data-startTime="1924">render blocking round trips, </span><span class="line" data-startTime="1927">and prioritizing visible </span><span class="line" data-startTime="1927">content. </span> <span class="line" data-startTime="1930">Any questions? </span></p>

<p class="speaker"><span class="line" data-starttime="1941"><span class="speakerName">Audience</span>: So, several of the </span><span class="line" data-startTime="1941">tricks that you proposed here </span><span class="line" data-startTime="1947">would cause the same URL to </span><span class="line" data-startTime="1947">serve both mobile and </span><span class="line" data-startTime="1953">non-mobile content. </span><span class="line" data-startTime="1955">I think that's still </span><span class="line" data-startTime="1955">considered a </span><span class="line" data-startTime="1957">no-no by search engines. </span><span class="line" data-startTime="1959">Is that &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="1961"><span class="speakerName">Bryan Mcquade</span>: No. </span><span class="line" data-startTime="1962">So I'm not a search expert, </span><span class="line" data-startTime="1962">but there's a good bit of </span><span class="line" data-startTime="1964">content on the webmaster site </span><span class="line" data-startTime="1964">for Google specifically that </span><span class="line" data-startTime="1969">talks about the different ways </span><span class="line" data-startTime="1969">you can address this issue. </span><span class="line" data-startTime="1971">One of them is to have separate </span><span class="line" data-startTime="1971">URLs, but we actually </span><span class="line" data-startTime="1975">show how you can support </span><span class="line" data-startTime="1975">both responsive design </span><span class="line" data-startTime="1977">and varying the HTML. </span><span class="line" data-startTime="1978">So both those techniques are </span><span class="line" data-startTime="1978">supported, at least by Google, </span><span class="line" data-startTime="1983">and really should be by </span><span class="line" data-startTime="1983">all search engines. </span><span class="line" data-startTime="1984">If they're not, then &mdash; </span><span class="line" data-startTime="1988">Does that &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="1989"><span class="speakerName">Audience</span>: Yeah. </span><span class="line" data-startTime="1989">I mean, in this specific </span><span class="line" data-startTime="1989">example, the site was very </span><span class="line" data-startTime="1993">clearly mobile. </span><span class="line" data-startTime="1994">Like, I wouldn't want to </span><span class="line" data-startTime="1994">see that on a browser. </span></p>

<p class="speaker"><span class="line" data-starttime="1996"><span class="speakerName">Bryan Mcquade</span>: Oh, I see. </span> <span class="line" data-startTime="1997">So what I didn't actually </span><span class="line" data-startTime="1997">do there &mdash; </span><span class="line" data-startTime="1999">there was a line in my .htaccess </span><span class="line" data-startTime="1999">that actually </span><span class="line" data-startTime="2001">allowed it to conditionally </span><span class="line" data-startTime="2001">execute that redirect to the </span><span class="line" data-startTime="2004">mobile thing, depending </span><span class="line" data-startTime="2004">on the user agent. </span> <span class="line" data-startTime="2006">So we would still send &mdash; </span><span class="line" data-startTime="2007">I can actually really quickly </span><span class="line" data-startTime="2007">just &mdash; right. </span> <span class="line" data-startTime="2014">So if I actually enable this &mdash; </span><span class="line" data-startTime="2015">I didn't, because it made it </span><span class="line" data-startTime="2015">hard to actually use the demo </span><span class="line" data-startTime="2018">on a desktop. </span> <span class="line" data-startTime="2018">But now if I re-enable that </span><span class="line" data-startTime="2018">rewrite [INAUDIBLE], if you </span><span class="line" data-startTime="2022">now go to demo.modspdy.com, </span><span class="line" data-startTime="2022">well &mdash; </span><span class="line" data-startTime="2029">I don't have an index.html </span><span class="line" data-startTime="2029">now. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="2031"><span class="speakerName">Audience</span>: Yeah. </span><span class="line" data-startTime="2031">Because it's a back end </span><span class="line" data-startTime="2031">redirect, though, if you go to </span><span class="line" data-startTime="2034">that same URL on a mobile </span><span class="line" data-startTime="2034">site, you might </span><span class="line" data-startTime="2038">get something different. </span><span class="line" data-startTime="2040">So that's why I kind of &mdash; </span><span class="line" data-startTime="2043">I assume that this was not </span><span class="line" data-startTime="2043">intended to change the </span><span class="line" data-startTime="2046">recommendation from Google. </span><span class="line" data-startTime="2048">This was just an example. </span></p>

<p class="speaker"><span class="line" data-starttime="2050"><span class="speakerName">Bryan Mcquade</span>: So yeah. </span><span class="line" data-startTime="2050">So at a high level, </span><span class="line" data-startTime="2050">you should &mdash; and I </span><span class="line" data-startTime="2052">apologize for this. </span><span class="line" data-startTime="2053">I'm not actually sure </span><span class="line" data-startTime="2053">what's going on. </span><span class="line" data-startTime="2054">I can debug it in a moment. </span><span class="line" data-startTime="2056">At a high level, it's totally </span><span class="line" data-startTime="2056">fine to vary the HTML you send </span><span class="line" data-startTime="2059">as a function of user agent. </span><span class="line" data-startTime="2060">We say you should include the </span><span class="line" data-startTime="2060">vary user agent header in the </span><span class="line" data-startTime="2062">response as well to give us a </span><span class="line" data-startTime="2062">heads up that it does vary as </span><span class="line" data-startTime="2065">a function of user agent. </span></p>

<p class="speaker"><span class="line" data-starttime="2069"><span class="speakerName">Audience</span>: Thanks. </span></p>

<p class="speaker"><span class="line" data-starttime="2069"><span class="speakerName">Bryan Mcquade</span>: Yep. </span></p>

<p class="speaker"><span class="line" data-starttime="2070"><span class="speakerName">Audience</span>: I have a question. </span><span class="line" data-startTime="2071">This is kind of a throwback. </span><span class="line" data-startTime="2073">Have you played around with </span><span class="line" data-startTime="2073">using progressive images? </span></p>

<p class="speaker"><span class="line" data-starttime="2077"><span class="speakerName">Bryan Mcquade</span>: I think that's </span><span class="line" data-startTime="2077">another talk in itself. </span><span class="line" data-startTime="2079">So we're looking at that now, </span><span class="line" data-startTime="2079">and we're thinking about what </span><span class="line" data-startTime="2082">is optimal there, but it's </span><span class="line" data-startTime="2082">definitely a big challenge, I </span><span class="line" data-startTime="2086">think, to do optimally </span><span class="line" data-startTime="2086">and efficiently. </span><span class="line" data-startTime="2089">I'd be happy to &mdash; maybe we </span><span class="line" data-startTime="2089">can chat afterwards. </span></p>

<p class="speaker"><span class="line" data-starttime="2091"><span class="speakerName">Audience</span>: OK. </span></p>

<p class="speaker"><span class="line" data-starttime="2093"><span class="speakerName">Audience</span>: Hi. </span> <span class="line" data-startTime="2094">I'm a user of page speed </span><span class="line" data-startTime="2094">services, and I </span><span class="line" data-startTime="2097">find this very cool. </span> <span class="line" data-startTime="2098">And I have a question about </span><span class="line" data-startTime="2098">how to reduce the latency </span><span class="line" data-startTime="2103">about subs request, since we </span><span class="line" data-startTime="2103">know that in order for page </span><span class="line" data-startTime="2108">speed service to optimize a </span><span class="line" data-startTime="2108">page, it will fetch the page </span><span class="line" data-startTime="2113">first, and then make several </span><span class="line" data-startTime="2113">sample requests. </span> <span class="line" data-startTime="2118">Could you share a bit about </span><span class="line" data-startTime="2118">your consideration about </span><span class="line" data-startTime="2123">deploying processing centers </span><span class="line" data-startTime="2123">for page speed services in </span><span class="line" data-startTime="2129">order to make a great </span><span class="line" data-startTime="2129">global product? </span></p>

<p class="speaker"><span class="line" data-starttime="2132"><span class="speakerName">Bryan Mcquade</span>: So I think Elia, </span><span class="line" data-startTime="2132">another person on our </span><span class="line" data-startTime="2135">team, will be giving a talk </span><span class="line" data-startTime="2135">about PageSpeed products later </span><span class="line" data-startTime="2137">today, and that might </span><span class="line" data-startTime="2137">be a better question </span><span class="line" data-startTime="2139">just to ask to him. </span><span class="line" data-startTime="2142">Or we could maybe </span><span class="line" data-startTime="2142">chat afterwards. </span></p>

<p class="speaker"><span class="line" data-starttime="2144"><span class="speakerName">Audience</span>: OK. </span><span class="line" data-startTime="2144">Thank you. </span></p>

<p class="speaker"><span class="line" data-starttime="2147"><span class="speakerName">Bryan Mcquade</span>: Any </span><span class="line" data-startTime="2147">other questions? </span><span class="line" data-startTime="2150">OK. </span><span class="line" data-startTime="2151">Thank you. </span><span class="line" data-startTime="2151">Oh, we'll do one more. </span></p>

<p class="speaker"><span class="line" data-starttime="2154"><span class="speakerName">Audience</span>: OK, so I noticed you </span><span class="line" data-startTime="2154">used some JavaScript magic </span><span class="line" data-startTime="2155">there to make the CSS load </span><span class="line" data-startTime="2155">in a deferred matter. </span><span class="line" data-startTime="2159">Is there any techniques that are </span><span class="line" data-startTime="2159">maybe coming to tell the </span><span class="line" data-startTime="2162">browser in the style tag to </span><span class="line" data-startTime="2162">say, defer this later? </span><span class="line" data-startTime="2166">I don't need to do that. </span></p>

<p class="speaker"><span class="line" data-starttime="2167"><span class="speakerName">Bryan Mcquade</span>: I wish that </span><span class="line" data-startTime="2167">existed, and that's something </span><span class="line" data-startTime="2168">that, I think, is talked </span><span class="line" data-startTime="2168">about a little bit. </span><span class="line" data-startTime="2169">I think it's needed. </span><span class="line" data-startTime="2171">Anytime you have to use a little </span><span class="line" data-startTime="2171">JavaScript snippet, it </span><span class="line" data-startTime="2173">feels a little wrong, right? </span></p>

<p class="speaker"><span class="line" data-starttime="2175"><span class="speakerName">Audience</span>: Well, it's really </span><span class="line" data-startTime="2175">verbose, and you can't really </span><span class="line" data-startTime="2177">know what's going </span><span class="line" data-startTime="2177">on unless you &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="2179"><span class="speakerName">Bryan Mcquade</span>: Right, right. </span><span class="line" data-startTime="2180">Yeah. </span><span class="line" data-startTime="2180">So I think that's where </span><span class="line" data-startTime="2180">we want to be. </span><span class="line" data-startTime="2181">There's no mechanism to express, </span><span class="line" data-startTime="2181">basically, I want to </span><span class="line" data-startTime="2184">load this stylesheet, but don't </span><span class="line" data-startTime="2184">have [? a ?] block the </span><span class="line" data-startTime="2186">render today, and so you </span><span class="line" data-startTime="2186">have to do it in </span><span class="line" data-startTime="2188">that mechanism currently. </span><span class="line" data-startTime="2189">But I think that's where </span><span class="line" data-startTime="2189">we should be moving. </span></p>

<p class="speaker"><span class="line" data-starttime="2190"><span class="speakerName">Audience</span>: Thank you. </span></p>

<p class="speaker"><span class="line" data-starttime="2191"><span class="speakerName">Bryan Mcquade</span>: Yep. </span></p>

<p class="speaker"><span class="line" data-starttime="2194"><span class="speakerName">Audience</span>: So I had a question </span><span class="line" data-startTime="2194">about putting an upstream </span><span class="line" data-startTime="2197">cache in front of these </span><span class="line" data-startTime="2197">web servers. </span><span class="line" data-startTime="2200">And your recommendation is to </span><span class="line" data-startTime="2200">vary on the user agent, which </span><span class="line" data-startTime="2203">means the cache is basically </span><span class="line" data-startTime="2203">made ineffective. </span></p>

<p class="speaker"><span class="line" data-starttime="2208"><span class="speakerName">Bryan Mcquade</span>: So that's a </span><span class="line" data-startTime="2208">good question, actually. </span> <span class="line" data-startTime="2209">I don't know if there was a </span><span class="line" data-startTime="2209">video from the webmaster team </span><span class="line" data-startTime="2215">recently about this. </span> <span class="line" data-startTime="2218">So we talked to some </span><span class="line" data-startTime="2218">of the big CDNs &mdash; </span><span class="line" data-startTime="2223">someone at Akamai, for </span><span class="line" data-startTime="2223">instance &mdash; and they actually </span><span class="line" data-startTime="2224">walked us through basically how </span><span class="line" data-startTime="2224">you would enable this use </span><span class="line" data-startTime="2227">case using their system </span><span class="line" data-startTime="2227">specifically. </span> <span class="line" data-startTime="2228">I can point you at that if </span><span class="line" data-startTime="2228">that would be helpful. </span></p>

<p><span class="line" data-startTime="2230">Basically, it is a solvable </span><span class="line" data-startTime="2230">problem that requires a little </span><span class="line" data-startTime="2232">bit of additional configuration </span><span class="line" data-startTime="2232">on the CDN side. </span> <span class="line" data-startTime="2238">OK. </span> <span class="line" data-startTime="2239">Thank you. </span></p></div>