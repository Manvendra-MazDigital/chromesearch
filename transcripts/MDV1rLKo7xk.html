<p><span class="line" data-startTime="7">Hello, and welcome to another </span><span class="line" data-startTime="7">episode of GDL-IL, GDL Israel. </span> <span class="line" data-startTime="12">Today we're going to </span><span class="line" data-startTime="12">do some [INAUDIBLE] </span><span class="line" data-startTime="14">things. </span> <span class="line" data-startTime="16">We'll start with checking out </span><span class="line" data-startTime="16">how we could run NodeJS on </span><span class="line" data-startTime="21">Google infrastructure on Google </span><span class="line" data-startTime="21">Cloud, and we'll use of </span><span class="line" data-startTime="24">course Compute Engine </span><span class="line" data-startTime="24">to do that. </span> <span class="line" data-startTime="27">And later, we'll see how easy </span><span class="line" data-startTime="27">it is to use NodeJS in order </span><span class="line" data-startTime="32">to run things like fetching </span><span class="line" data-startTime="32">data from other </span><span class="line" data-startTime="35">sources on the web. </span> <span class="line" data-startTime="36">It might be another API, in our </span><span class="line" data-startTime="36">case we took a different </span><span class="line" data-startTime="41">set of APIs, not directly Google </span><span class="line" data-startTime="41">ones, just to show you </span><span class="line" data-startTime="45">the power of getting information </span><span class="line" data-startTime="45">from any open API </span><span class="line" data-startTime="50">that you have out there. </span></p>

<p><span class="line" data-startTime="51">And then, using Google Sheets </span><span class="line" data-startTime="51">in order to upload this API, </span><span class="line" data-startTime="55">this data, and then later on </span><span class="line" data-startTime="55">of course using it and </span><span class="line" data-startTime="59">leveraging it inside </span><span class="line" data-startTime="59">Google Sheets. </span> <span class="line" data-startTime="61">The nice thing or the nice theme </span><span class="line" data-startTime="61">that is connecting all </span><span class="line" data-startTime="65">the dots in this episode </span><span class="line" data-startTime="65">will be JavaScript. </span> <span class="line" data-startTime="68">And we have JavaScript </span><span class="line" data-startTime="68">on the server side. </span> <span class="line" data-startTime="70">And of course, we'll use </span><span class="line" data-startTime="70">NodeJS to execute it. </span> <span class="line" data-startTime="73">And then, we'll have JavaScript </span><span class="line" data-startTime="73">as the scripting </span><span class="line" data-startTime="76">language of Google Docs and </span><span class="line" data-startTime="76">Google Apps that allows you to </span><span class="line" data-startTime="80">do clever, sophisticated things </span><span class="line" data-startTime="80">on the information, on </span><span class="line" data-startTime="84">the data that you already </span><span class="line" data-startTime="84">fetched and put in your Google </span><span class="line" data-startTime="87">Sheets in our case. </span></p>

<p><span class="line" data-startTime="89">So without further ado, let me </span><span class="line" data-startTime="89">just share my screen with you. </span> <span class="line" data-startTime="93">And maybe today, I'll just share </span><span class="line" data-startTime="93">my old desktop so I can </span><span class="line" data-startTime="98">jump quickly. </span> <span class="line" data-startTime="100">Or maybe it would be wiser, I'll </span><span class="line" data-startTime="100">just try to go through </span><span class="line" data-startTime="104">this little blog post that just </span><span class="line" data-startTime="104">summarizes all the things </span><span class="line" data-startTime="107">that we're going to touch on. </span> <span class="line" data-startTime="109">The blog post is live as of 10 </span><span class="line" data-startTime="109">minutes ago, so feel free to </span><span class="line" data-startTime="113">go and check it out. </span> <span class="line" data-startTime="115">And of course, I'll put links </span><span class="line" data-startTime="115">to this blog post on the </span><span class="line" data-startTime="120">footnotes of this show on the </span><span class="line" data-startTime="120">developer.google.com site. </span> <span class="line" data-startTime="125">So feel free, you don't need </span><span class="line" data-startTime="125">to write anything. </span> <span class="line" data-startTime="128">Basically, what we're going </span><span class="line" data-startTime="128">to show here is </span><span class="line" data-startTime="130">the ability to go. </span></p>

<p><span class="line" data-startTime="132">And in this case, I just choose </span><span class="line" data-startTime="132">Yahoo Finance API just </span><span class="line" data-startTime="135">because I got lots of questions </span><span class="line" data-startTime="135">on how to use it and </span><span class="line" data-startTime="141">leverage it from inside </span><span class="line" data-startTime="141">Google Sheets. </span> <span class="line" data-startTime="144">And here in the example you </span><span class="line" data-startTime="144">[INAUDIBLE], basically Yahoo </span><span class="line" data-startTime="147">allows you to do things like </span><span class="line" data-startTime="147">get a certain URL. </span> <span class="line" data-startTime="153">Let me make all the </span><span class="line" data-startTime="153">fonts much larger. </span> <span class="line" data-startTime="156">And then, if you put in </span><span class="line" data-startTime="156">here, I put Netflix. </span> <span class="line" data-startTime="158">But you could put any ticker. </span> <span class="line" data-startTime="160">And after you put a ticker, you </span><span class="line" data-startTime="160">have a set of let's say </span><span class="line" data-startTime="164">parameters, or it's more </span><span class="line" data-startTime="164">crypting keys that will fetch </span><span class="line" data-startTime="168">the right information </span><span class="line" data-startTime="168">that you want. </span> <span class="line" data-startTime="169">And once you are clicking </span><span class="line" data-startTime="169">on it, basically you're </span><span class="line" data-startTime="172">downloading a CSV file that you </span><span class="line" data-startTime="172">can later on work with it. </span> <span class="line" data-startTime="175">In our case, we want to </span><span class="line" data-startTime="175">do something nicer. </span></p>

<p><span class="line" data-startTime="178">And basically, to take even </span><span class="line" data-startTime="178">farther this approach of </span><span class="line" data-startTime="184">getting data, getting </span><span class="line" data-startTime="184">information, and then putting </span><span class="line" data-startTime="187">it into good work, into good </span><span class="line" data-startTime="187">usage inside of Google Sheets. </span> <span class="line" data-startTime="191">So what I did here is after </span><span class="line" data-startTime="191">you've installed NodeJS, and </span><span class="line" data-startTime="196">if you remember correctly, I </span><span class="line" data-startTime="196">have an episode in the past </span><span class="line" data-startTime="199">here on this [INAUDIBLE] </span><span class="line" data-startTime="203">how to install NodeJS on Compute </span><span class="line" data-startTime="203">Engine in less than </span><span class="line" data-startTime="207">five minutes. </span> <span class="line" data-startTime="209">So just go search </span><span class="line" data-startTime="209">it and do that. </span> <span class="line" data-startTime="213">That's the first step </span><span class="line" data-startTime="213">that you need to do. </span> <span class="line" data-startTime="214">But after you install NodeJS, </span><span class="line" data-startTime="214">basically you just need those </span><span class="line" data-startTime="218">three packages. </span> <span class="line" data-startTime="219">And luckily for us, the </span><span class="line" data-startTime="219">community around NodeJS is </span><span class="line" data-startTime="222">holding a very large set of </span><span class="line" data-startTime="222">libraries and frameworks and </span><span class="line" data-startTime="228">abilities, basically already </span><span class="line" data-startTime="228">made wheels for us. </span></p>

<p><span class="line" data-startTime="232">So we don't need to reinvent </span><span class="line" data-startTime="232">the wheel again. </span> <span class="line" data-startTime="235">And in this case, I just choose </span><span class="line" data-startTime="235">those three libraries. </span> <span class="line" data-startTime="238">One is the request model </span><span class="line" data-startTime="238">that just lets you do </span><span class="line" data-startTime="241">work easily with URLs. </span> <span class="line" data-startTime="243">Basically, we're using a very </span><span class="line" data-startTime="243">easy way of fetching the </span><span class="line" data-startTime="248">information with </span><span class="line" data-startTime="248">a get request. </span> <span class="line" data-startTime="249">But once you install it, </span><span class="line" data-startTime="249">basically you have all the </span><span class="line" data-startTime="252">different possibilities of doing </span><span class="line" data-startTime="252">authentication, doing </span><span class="line" data-startTime="255">OAuth, post, and all the </span><span class="line" data-startTime="255">good things that you'll </span><span class="line" data-startTime="257">want to do later on. </span> <span class="line" data-startTime="259">So it's good thing to have right </span><span class="line" data-startTime="259">at the beginning of a </span><span class="line" data-startTime="261">new project that is going to do </span><span class="line" data-startTime="261">something interesting with </span><span class="line" data-startTime="264">this API that is being </span><span class="line" data-startTime="264">fetched over HTTP. </span> <span class="line" data-startTime="269">Then, I put cheerio. </span> <span class="line" data-startTime="271">It's a cool name. </span> <span class="line" data-startTime="273">And for us, it's basically </span><span class="line" data-startTime="273">jQuery on the server side. </span></p>

<p><span class="line" data-startTime="275">So the ability to work with that </span><span class="line" data-startTime="275">dollar sign that we all </span><span class="line" data-startTime="279">love, and just to be able to </span><span class="line" data-startTime="279">have these CSS selectors to </span><span class="line" data-startTime="284">get the right piece of </span><span class="line" data-startTime="284">information from this or that </span><span class="line" data-startTime="287">location in the DOM. </span> <span class="line" data-startTime="289">Very easy to do. </span> <span class="line" data-startTime="290">So that's why I use this one. </span> <span class="line" data-startTime="293">And last but not least, just to </span><span class="line" data-startTime="293">make our life easier when </span><span class="line" data-startTime="295">we're going to integrate and </span><span class="line" data-startTime="295">upload and edit and update our </span><span class="line" data-startTime="300">information, let's just leverage </span><span class="line" data-startTime="300">again already built </span><span class="line" data-startTime="304">model that's letting us just </span><span class="line" data-startTime="304">work with Google Spreadsheets. </span> <span class="line" data-startTime="310">Having those three pieces of </span><span class="line" data-startTime="310">code in place, our code will </span><span class="line" data-startTime="315">be really, really short. </span> <span class="line" data-startTime="316">So in these three lines, we're </span><span class="line" data-startTime="316">just fetching the models so we </span><span class="line" data-startTime="322">could work with them later. </span> <span class="line" data-startTime="324">And then, of course, we have </span><span class="line" data-startTime="324">those few parameters that we </span><span class="line" data-startTime="328">want to keep as global </span><span class="line" data-startTime="328">to our script. </span></p>

<p><span class="line" data-startTime="331">I highly recommend you to remove </span><span class="line" data-startTime="331">them, as in line 19 </span><span class="line" data-startTime="335">it's written here. </span> <span class="line" data-startTime="337">Not black and white, but clearly </span><span class="line" data-startTime="337">enough, you want to </span><span class="line" data-startTime="341">remove them from the </span><span class="line" data-startTime="341">global scope. </span> <span class="line" data-startTime="342">In this specific, simple case </span><span class="line" data-startTime="342">I just left it there. </span> <span class="line" data-startTime="345">But probably the first thing </span><span class="line" data-startTime="345">that I'll do tomorrow morning </span><span class="line" data-startTime="348">would be just to remove them </span><span class="line" data-startTime="348">from the global scope, make </span><span class="line" data-startTime="351">sure that I'm encapsulating them </span><span class="line" data-startTime="351">inside an object so when </span><span class="line" data-startTime="355">this project will get bigger and </span><span class="line" data-startTime="355">bigger and not just live </span><span class="line" data-startTime="358">as a gist, we'll be able to have </span><span class="line" data-startTime="358">all the best practices of </span><span class="line" data-startTime="362">software development. </span></p>

<p><span class="line" data-startTime="364">And we want [INAUDIBLE] </span><span class="line" data-startTime="366">so quickly. </span> <span class="line" data-startTime="367">So the basic constants here </span><span class="line" data-startTime="367">are just the ticker, and </span><span class="line" data-startTime="372">probably it would be wiser just </span><span class="line" data-startTime="372">to put it as a variable </span><span class="line" data-startTime="375">so that the user will enter </span><span class="line" data-startTime="375">from the script itself. </span> <span class="line" data-startTime="378">Later on, just the end point. </span> <span class="line" data-startTime="381">And in your case, it might </span><span class="line" data-startTime="381">be Google Cloud endpoint. </span> <span class="line" data-startTime="384">It might be any other API that's </span><span class="line" data-startTime="384">letting you just fetch </span><span class="line" data-startTime="387">information over </span><span class="line" data-startTime="387">HTTP or HTTPS. </span> <span class="line" data-startTime="391">And then, just two actually </span><span class="line" data-startTime="391">arrays that are letting us </span><span class="line" data-startTime="396">have the keys, or mainly the </span><span class="line" data-startTime="396">metadata on the data that </span><span class="line" data-startTime="399">we're going to fetch, and </span><span class="line" data-startTime="399">the details themselves. </span> <span class="line" data-startTime="403">Then, we have a few functions </span><span class="line" data-startTime="403">that we're using. </span> <span class="line" data-startTime="406">sheetReady, we'll touch </span><span class="line" data-startTime="406">on it later. </span></p>

<p><span class="line" data-startTime="408">And in this one, </span><span class="line" data-startTime="408">basically we're </span><span class="line" data-startTime="410">just calling the request. </span> <span class="line" data-startTime="411">So after we're fetching </span><span class="line" data-startTime="411">the URL. </span> <span class="line" data-startTime="414">Here, you can see that first </span><span class="line" data-startTime="414">and foremost I just want to </span><span class="line" data-startTime="416">see that everything came </span><span class="line" data-startTime="416">back correctly with </span><span class="line" data-startTime="420">status code of 200. </span> <span class="line" data-startTime="421">If it's 400 or 500 or other </span><span class="line" data-startTime="421">things, I want probably to </span><span class="line" data-startTime="425">just notify the user. </span> <span class="line" data-startTime="426">And in this case, I'm just </span><span class="line" data-startTime="426">loading into cheerio the body. </span> <span class="line" data-startTime="430">And then nicely enough, I have </span><span class="line" data-startTime="430">this dollar sign that </span><span class="line" data-startTime="433">I could work with. </span></p>

<p><span class="line" data-startTime="435">And in this case, I'm just </span><span class="line" data-startTime="435">choosing one table that's </span><span class="line" data-startTime="437">containing all the </span><span class="line" data-startTime="437">information. </span> <span class="line" data-startTime="439">And then, I'm getting all the </span><span class="line" data-startTime="439">tds in this table into my </span><span class="line" data-startTime="445">array, the keys. </span> <span class="line" data-startTime="447">And I'm doing just the same </span><span class="line" data-startTime="447">thing on a different class </span><span class="line" data-startTime="450">name and fetching </span><span class="line" data-startTime="450">all the details </span><span class="line" data-startTime="453">into a different array. </span> <span class="line" data-startTime="454">Once I do those two things, </span><span class="line" data-startTime="454">all I need to do now is </span><span class="line" data-startTime="458">basically just of course letting </span><span class="line" data-startTime="458">ourselves know that we </span><span class="line" data-startTime="462">have the right information </span><span class="line" data-startTime="462">in place. </span> <span class="line" data-startTime="463">And we'll run the script </span><span class="line" data-startTime="463">in a minute. </span> <span class="line" data-startTime="466">And then, I want to upload it. </span> <span class="line" data-startTime="468">So look how easy is </span><span class="line" data-startTime="468">the API itself. </span> <span class="line" data-startTime="471">I call it. </span> <span class="line" data-startTime="473">I'm creating a new one. </span></p>

<p><span class="line" data-startTime="475">Basically, I already </span><span class="line" data-startTime="475">created one. </span> <span class="line" data-startTime="477">But here, I'm just creating or </span><span class="line" data-startTime="477">calling the constructor of </span><span class="line" data-startTime="481">this object that here it's </span><span class="line" data-startTime="481">called spreadsheet. </span> <span class="line" data-startTime="484">And the debug information is </span><span class="line" data-startTime="484">just for us right now. </span> <span class="line" data-startTime="488">Actually, I see that we </span><span class="line" data-startTime="488">have two lines of it. </span> <span class="line" data-startTime="490">So I need to remove one. </span> <span class="line" data-startTime="491">Here, of course, you want to put </span><span class="line" data-startTime="491">your credentials, probably </span><span class="line" data-startTime="495">your Gmail address and </span><span class="line" data-startTime="495">then your password. </span> <span class="line" data-startTime="498">And very important, the sheet </span><span class="line" data-startTime="498">name and the worksheet. </span> <span class="line" data-startTime="504">So both of them need to be here </span><span class="line" data-startTime="504">so we know which sheet we </span><span class="line" data-startTime="507">are going to update. </span></p>

<p><span class="line" data-startTime="509">And then we're calling, in the </span><span class="line" data-startTime="509">callback after this, returning </span><span class="line" data-startTime="511">the sheetReady method. </span> <span class="line" data-startTime="514">And if we scroll back to this </span><span class="line" data-startTime="514">method, basically you could </span><span class="line" data-startTime="518">see that it's a very, </span><span class="line" data-startTime="518">very simple one. </span> <span class="line" data-startTime="521">We're adding to the spreadsheet </span><span class="line" data-startTime="521">on the top. </span> <span class="line" data-startTime="523">So it will be at column one, row </span><span class="line" data-startTime="523">one, and then column one, </span><span class="line" data-startTime="528">row two, the attribute </span><span class="line" data-startTime="528">and the value. </span> <span class="line" data-startTime="532">And then, we're just going </span><span class="line" data-startTime="532">to iterate and </span><span class="line" data-startTime="536">just in those arrays. </span> <span class="line" data-startTime="538">And luckily for us, any looping </span><span class="line" data-startTime="538">here will just call </span><span class="line" data-startTime="542">our object, the spreadsheet, </span><span class="line" data-startTime="542">and will add an array. </span> <span class="line" data-startTime="545">We're giving it the </span><span class="line" data-startTime="545">starting point. </span> <span class="line" data-startTime="547">And once I get the started </span><span class="line" data-startTime="547">point, all we need to do is </span><span class="line" data-startTime="551">just attach the array, and all </span><span class="line" data-startTime="551">the information will be there. </span></p>

<p><span class="line" data-startTime="555">And of course, we're sending </span><span class="line" data-startTime="555">all the information in one </span><span class="line" data-startTime="558">batch and getting </span><span class="line" data-startTime="558">the response. </span> <span class="line" data-startTime="560">Here, probably you want to </span><span class="line" data-startTime="560">notify the user that </span><span class="line" data-startTime="563">everything is done correctly </span><span class="line" data-startTime="563">and is in the good hands of </span><span class="line" data-startTime="567">Google Cloud. </span> <span class="line" data-startTime="568">So all the data is now saved. </span> <span class="line" data-startTime="570">And of course, if something </span><span class="line" data-startTime="570">wrong happens, just </span><span class="line" data-startTime="573">communicate it back. </span> <span class="line" data-startTime="574">That's all the script. </span> <span class="line" data-startTime="575">So you could see here that at </span><span class="line" data-startTime="575">the bottom, there's nothing </span><span class="line" data-startTime="578">more than it. </span> <span class="line" data-startTime="579">And now, we could check or let </span><span class="line" data-startTime="579">me show you how you could </span><span class="line" data-startTime="585">quite easily run this script. </span> <span class="line" data-startTime="589">So let's see again </span><span class="line" data-startTime="589">in this window. </span> <span class="line" data-startTime="595">This is my terminal. </span> <span class="line" data-startTime="596">I'll make the font </span><span class="line" data-startTime="596">even bigger, and </span><span class="line" data-startTime="600">even one step bigger. </span></p>

<p><span class="line" data-startTime="602">And what you can see here is </span><span class="line" data-startTime="602">that I'm calling node with the </span><span class="line" data-startTime="607">fetch example that </span><span class="line" data-startTime="607">we have here. </span> <span class="line" data-startTime="610">And once I'm running it, </span><span class="line" data-startTime="610">quite quickly we're </span><span class="line" data-startTime="612">going to Yahoo API. </span> <span class="line" data-startTime="617">We're fetching the </span><span class="line" data-startTime="617">information. </span> <span class="line" data-startTime="619">Here, the console log </span><span class="line" data-startTime="619">just making sure &mdash; </span><span class="line" data-startTime="622">actually, it's from here &mdash; </span><span class="line" data-startTime="623">that I'm fetching </span><span class="line" data-startTime="623">the information. </span> <span class="line" data-startTime="626">And you can see that in this </span><span class="line" data-startTime="626">case, for instance, the key </span><span class="line" data-startTime="630">would be the market cap. </span> <span class="line" data-startTime="632">And then, I have the overall </span><span class="line" data-startTime="632">value of the company. </span> <span class="line" data-startTime="635">And again, and again, lots </span><span class="line" data-startTime="635">of other parameters. </span></p>

<p><span class="line" data-startTime="638">And then, when I'm wanting to </span><span class="line" data-startTime="638">upload it to Google, I got a </span><span class="line" data-startTime="642">log in error. </span> <span class="line" data-startTime="643">And this is because all I have </span><span class="line" data-startTime="643">there right now are the to </span><span class="line" data-startTime="648">dos, and not my real </span><span class="line" data-startTime="648">credentials. </span> <span class="line" data-startTime="650">But I highly encourage you to </span><span class="line" data-startTime="650">fork the gist that we just </span><span class="line" data-startTime="654">showed and just put your </span><span class="line" data-startTime="654">credentials and work with it </span><span class="line" data-startTime="659">and see how fluidly </span><span class="line" data-startTime="659">it's working. </span> <span class="line" data-startTime="663">The other beauty is that you </span><span class="line" data-startTime="663">could take this code that we </span><span class="line" data-startTime="666">ran, and let me just again </span><span class="line" data-startTime="666">share with you </span><span class="line" data-startTime="669">that snippet itself. </span> <span class="line" data-startTime="673">We could actually see it here. </span> <span class="line" data-startTime="677">And this code, with very few </span><span class="line" data-startTime="677">changes, will work from Google </span><span class="line" data-startTime="685">App, Google Sheets as well. </span> <span class="line" data-startTime="689">So if you don't want even to </span><span class="line" data-startTime="689">have the ability or the </span><span class="line" data-startTime="693">efficiency of running this </span><span class="line" data-startTime="693">simple script inside Node, you </span><span class="line" data-startTime="697">could do the same </span><span class="line" data-startTime="697">from JavaScript </span><span class="line" data-startTime="700">that will run in Sheets. </span> <span class="line" data-startTime="704">And that's another benefit for </span><span class="line" data-startTime="704">the ones that don't want to </span><span class="line" data-startTime="706">work with a Node instance. </span></p>

<p><span class="line" data-startTime="710">However, I highly encourage you </span><span class="line" data-startTime="710">to check Compute Engine </span><span class="line" data-startTime="713">and to check the ability to run </span><span class="line" data-startTime="713">with NodeJS because the </span><span class="line" data-startTime="718">performances will be </span><span class="line" data-startTime="718">much, much better. </span> <span class="line" data-startTime="720">And if you want to do something </span><span class="line" data-startTime="720">more than just </span><span class="line" data-startTime="723">putting a simple example like </span><span class="line" data-startTime="723">that, you want some heavy </span><span class="line" data-startTime="729">lifting on the server side, some </span><span class="line" data-startTime="729">data manipulation, some </span><span class="line" data-startTime="732">things that you do want </span><span class="line" data-startTime="732">a strong server side. </span> <span class="line" data-startTime="735">NodeJS on Compute Engine will </span><span class="line" data-startTime="735">give you those benefits. </span> <span class="line" data-startTime="738">And it's highly recommended </span><span class="line" data-startTime="738">to check it out. </span> <span class="line" data-startTime="742">So if we have any, questions </span><span class="line" data-startTime="742">right now is </span><span class="line" data-startTime="745">that the right time. </span></p>

<p><span class="line" data-startTime="746">Let's see here. </span> <span class="line" data-startTime="748">Let's see if in the </span><span class="line" data-startTime="748">chat we have some. </span> <span class="line" data-startTime="752">I don't see any question </span><span class="line" data-startTime="752">right now. </span> <span class="line" data-startTime="754">So if you have later on any </span><span class="line" data-startTime="754">questions, +GreenIdo on G+ or </span><span class="line" data-startTime="759">GreenIdo as one word </span><span class="line" data-startTime="759">on Twitter. </span> <span class="line" data-startTime="761">Both will work quite nicely. </span> <span class="line" data-startTime="763">Happy hacking, and be strong. </span> <span class="line" data-startTime="767">Bye-bye. </span></p>