<p><span class="line" data-startTime="2">Hi, I'm Raf. </span> <span class="line" data-startTime="2">I'm a programmer working on the Google Chrome </span><span class="line" data-startTime="5">extension system. </span> <span class="line" data-startTime="5">I'm here to talk about the design of the APIs </span><span class="line" data-startTime="9">that you'll use in creating your extension. </span> <span class="line" data-startTime="9">One goal in the design of the extensions system </span><span class="line" data-startTime="14">is that programming extensions should be just </span><span class="line" data-startTime="14">like programming web pages. </span> <span class="line" data-startTime="18">So as you'd expect, you'll be programming </span><span class="line" data-startTime="18">in JavaScript which runs inside web pages. </span> <span class="line" data-startTime="23">Many things your extension will want to do, </span><span class="line" data-startTime="23">you can accomplish with existing web APIs. </span> <span class="line" data-startTime="28">Want it to talk to a server? </span><span class="line" data-startTime="28">Use XmlHttpRequest. </span> <span class="line" data-startTime="32">Want it to persist some data? </span><span class="line" data-startTime="32">Use cookies, LocalStorage, or HTML5 Databases. </span> <span class="line" data-startTime="37">Want it to display a nicely designed options </span><span class="line" data-startTime="37">page? </span><span class="line" data-startTime="40">Use HTML and Cascading Style Sheets. </span> <span class="line" data-startTime="40">However, Google Chrome also exposes APIs that </span><span class="line" data-startTime="45">only extension code can access. We've tried </span><span class="line" data-startTime="45">to make these APIs feel as much like web platform </span><span class="line" data-startTime="51">APIs as possible. </span></p>

<p><span class="line" data-startTime="51">Let's start with an example: </span><span class="line" data-startTime="54">This is code from a simple extension which </span><span class="line" data-startTime="54">displays a browser action icon and when the </span><span class="line" data-startTime="58">user clicks on it, it opens up a web page </span><span class="line" data-startTime="58">which is packaged within the extension. </span> <span class="line" data-startTime="63">Already we see a few key aspects of the extension </span><span class="line" data-startTime="63">APIs. </span> <span class="line" data-startTime="66">First, you can identify all the extension </span><span class="line" data-startTime="66">calls because they exist in the "chrome" namespace. </span> <span class="line" data-startTime="71">"chrome" is a global object to which all extension </span><span class="line" data-startTime="71">APIs are bound. </span> <span class="line" data-startTime="75">The Google Chrome extensions APIs are only </span><span class="line" data-startTime="75">visible to extension code and are broken down </span><span class="line" data-startTime="80">into modules. </span> <span class="line" data-startTime="80">Here we are using the "browserAction", "tabs", </span><span class="line" data-startTime="85">and "extension" modules. </span> <span class="line" data-startTime="85">chrome.browserAction.onClicked is an event </span><span class="line" data-startTime="90">which can register listeners who act on something </span><span class="line" data-startTime="90">interesting that happens &mdash; in this case, </span><span class="line" data-startTime="95">the user clicking the browserAction icon. </span></p>

<p><span class="line" data-startTime="95">Most modules expose events and they all have </span><span class="line" data-startTime="99">the same form - which allows for the addition </span><span class="line" data-startTime="99">and removal of listeners. </span> <span class="line" data-startTime="104">Now, let's look at the call to chrome.extension.getUrl(). </span> <span class="line" data-startTime="104">This is an example of a synchronous function </span><span class="line" data-startTime="109">call &mdash; meaning that it does it's thing immediately </span><span class="line" data-startTime="109">and returns a value to the calling code. </span> <span class="line" data-startTime="115">In this case, it's constructing a URL which </span><span class="line" data-startTime="115">the browser can use to navigate to a resource </span><span class="line" data-startTime="120">which is within your extension. </span> <span class="line" data-startTime="120">Some API calls are synchronous, but many are </span><span class="line" data-startTime="125">asynchronous. </span> <span class="line" data-startTime="125">Let's take a look at another example: </span><span class="line" data-startTime="127">Here, we are asking Google Chrome to modify </span><span class="line" data-startTime="127">one of the userâ€™s bookmarks by modifying </span><span class="line" data-startTime="132">its title. </span> <span class="line" data-startTime="132">This call is asynchronous &mdash; meaning that </span><span class="line" data-startTime="135">the code that makes the call will continue </span><span class="line" data-startTime="135">executing and the function you provide as </span><span class="line" data-startTime="139">a callback will be run sometime later &mdash; and </span><span class="line" data-startTime="139">which point your code will know that the bookmark </span><span class="line" data-startTime="143">has been updated. </span> <span class="line" data-startTime="143">The reason why this call is asynchronous has </span><span class="line" data-startTime="146">to do with Google Chrome's multi-process architecture. </span> <span class="line" data-startTime="146">Web pages and JavaScript run in processes </span><span class="line" data-startTime="152">which are not only separate from each other, </span><span class="line" data-startTime="152">but also from the main browser process which </span><span class="line" data-startTime="156">alone has the ability to do things like read </span><span class="line" data-startTime="156"> & write to the local file system. </span></p>

<p><span class="line" data-startTime="160">This is an important security and stability </span><span class="line" data-startTime="160">feature for Google Chrome. </span> <span class="line" data-startTime="164">If calls like this were synchronous, your </span><span class="line" data-startTime="164">extension would have to stop everything and </span><span class="line" data-startTime="168">wait for the browser process to respond to </span><span class="line" data-startTime="168">the request, all the while the user may be </span><span class="line" data-startTime="172">trying to interact with the UI of your extension </span><span class="line" data-startTime="172">which has become unresponsive. </span> <span class="line" data-startTime="177">Using asynchronous APIs is more challenging, </span><span class="line" data-startTime="177">but it's in the service of the best user experience </span><span class="line" data-startTime="182">possible, and it won't take long to get the </span><span class="line" data-startTime="182">hang of it. </span></p>

<p><span class="line" data-startTime="185">Just remember that it won't be uncommon to </span><span class="line" data-startTime="185">write code like this </span><span class="line" data-startTime="189">rather than this </span><span class="line" data-startTime="189">There's one more interesting thing about this </span><span class="line" data-startTime="194">example: </span><span class="line" data-startTime="194">There's a bug in it that the extensions system </span><span class="line" data-startTime="197">is going to help us find. </span> <span class="line" data-startTime="197">If you look at the documentation for this </span><span class="line" data-startTime="200">call you can see that the id that chrome.bookmarks.update() </span><span class="line" data-startTime="200">takes as it's first argument is a string, </span><span class="line" data-startTime="207">not an integer. When this call executes, the </span><span class="line" data-startTime="207">extension system will throw an exception pointing </span><span class="line" data-startTime="212">out the error. </span> <span class="line" data-startTime="212">The extensions API uses an implementation </span><span class="line" data-startTime="218">of JSON schema which declares the name, type, </span><span class="line" data-startTime="218">number and position of its function arguments. </span></p>

<p><span class="line" data-startTime="223">If you call it with the wrong types or wrong </span><span class="line" data-startTime="223">number of arguments, it'll complain. </span> <span class="line" data-startTime="228">Additionally, the extension documentation </span><span class="line" data-startTime="228">is generated from exactly the same JSON schema </span><span class="line" data-startTime="233">that Google Chrome uses to create it's internal </span><span class="line" data-startTime="233">API. </span> <span class="line" data-startTime="237">So, for instance, if you are developing using </span><span class="line" data-startTime="237">the beta channel of Google Chrome, you can </span><span class="line" data-startTime="241">be assured that the docs at http://code.google.com/chrome/extensions/beta </span><span class="line" data-startTime="241">are accurate. </span> <span class="line" data-startTime="249">In creating the initial release of the extensions </span><span class="line" data-startTime="249">we focused on creating a robust, secure and </span><span class="line" data-startTime="254">easy to use system that included a small set </span><span class="line" data-startTime="254">of APIs that we felt would allow many useful </span><span class="line" data-startTime="259">extensions to be made. </span> <span class="line" data-startTime="259">It initially includes interacting with browser </span><span class="line" data-startTime="263">windows, tabs & bookmarks, but we expect to </span><span class="line" data-startTime="263">be adding more soon. </span> <span class="line" data-startTime="268">Have fun working with the Google Chrome extensions </span><span class="line" data-startTime="268">and please let us know what we can do to make </span><span class="line" data-startTime="272">your extensions better by giving us feedback </span><span class="line" data-startTime="272">at our discussion group. </span></p>

<p></p>