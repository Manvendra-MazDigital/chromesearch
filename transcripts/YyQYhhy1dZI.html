<style>* {font-family: "Open Sans", sans-serif}
a {color: #77aaff}
a.video {border-bottom: 1px solid #ddd; display: block; margin: 0 0 2em 0; padding: 0 0 2em 0}
h2 {color: #444; font-size: 18px;}
span.speakerName {color: black; font-weight: 900;}
body {padding: 2em}
p {color: #444; margin: 0; text-indent: 1.5em;}
p.speaker {margin: 1em 0 0 0; text-indent: 0;}
div#transcript > p:first-child {text-indent: 0;}
</style>

<h1>#perfmatters: 60fps layout and rendering &mdash; Chrome Dev Summit 2013 (Tom Wiltzius and Nat Duca)</h1>

<h2>Paul Irish, Tom Tom Wiltzius, Nat Duca</h2>

<a class="video" href="http://youtu.be/YyQYhhy1dZI">youtu.be/YyQYhhy1dZI</a><div id="transcript"><p class="speaker"><span class="line" data-starttime="0"><span class="speakerName">Paul Irish</span>: We have Tom </span><span class="line" data-startTime="0">Wiltzius and Nat Duca. </span><span class="line" data-startTime="3">They are on the Chrome </span><span class="line" data-startTime="3">Graphics team and hack all day </span><span class="line" data-startTime="7">on the graphic stack. </span><span class="line" data-startTime="8">They're dedicated to making </span><span class="line" data-startTime="8">you as a developer understand </span><span class="line" data-startTime="13">what's going on so that you can </span><span class="line" data-startTime="13">make sure that your apps are </span><span class="line" data-startTime="15">fast, fluid, and awesome and </span><span class="line" data-startTime="15">then simultaneously dedicated </span><span class="line" data-startTime="19">to improving that platform </span><span class="line" data-startTime="19">so that you don't have </span><span class="line" data-startTime="22">to work so hard to do that, </span><span class="line" data-startTime="22">and you just get it for free. </span><span class="line" data-startTime="25">I'm really excited, and </span><span class="line" data-startTime="25">please put your hands together </span><span class="line" data-startTime="28">for Nat and Tom. </span><span class="line" data-startTime="30">[APPLAUSE] </span></p>

<p class="speaker"><span class="line" data-starttime="38"><span class="speakerName">Tom Tom Wiltzius</span>: Hello, everyone. </span><span class="line" data-startTime="39">My name's Tom </span><span class="line" data-startTime="39">Wiltzius, as Paul said. </span></p>

<p class="speaker"><span class="line" data-starttime="41"><span class="speakerName">Nat Duca</span>: I'm Nat Duca. </span><span class="line" data-startTime="43">Nice to see everybody here. </span></p>

<p class="speaker"><span class="line" data-starttime="44"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. </span><span class="line" data-startTime="45">And we're from the </span><span class="line" data-startTime="45">Chrome Graphics team. </span><span class="line" data-startTime="47">I'm going to use the laptop </span><span class="line" data-startTime="47">instead of the clicker </span><span class="line" data-startTime="51">so we can play videos. </span><span class="line" data-startTime="53">We're here today to talk </span><span class="line" data-startTime="53">about rendering performance. </span><span class="line" data-startTime="55">And we want to start </span><span class="line" data-startTime="55">off with a few basics </span><span class="line" data-startTime="57">that we're not going to </span><span class="line" data-startTime="57">cover in much detail, </span><span class="line" data-startTime="59">because there is a ton of great </span><span class="line" data-startTime="59">content available on the web </span><span class="line" data-startTime="62">about this stuff already. </span><span class="line" data-startTime="64">We've talked about it before. </span><span class="line" data-startTime="65">Other folks on our </span><span class="line" data-startTime="65">Developer Relations team </span><span class="line" data-startTime="68">have talked about it before. </span><span class="line" data-startTime="70">But we want to make sure </span><span class="line" data-startTime="70">we're all on the same page. </span></p>

<p class="speaker"><span class="line" data-starttime="73"><span class="speakerName">Nat Duca</span>: So the pages </span><span class="line" data-startTime="73">that we want you to be on </span><span class="line" data-startTime="75">are the following, right? </span><span class="line" data-startTime="78">You got the screens </span><span class="line" data-startTime="78">here, lots of them. </span><span class="line" data-startTime="80">They're all running at about </span><span class="line" data-startTime="80">60 hertz, but maybe not. </span><span class="line" data-startTime="83">16 milliseconds is a number that </span><span class="line" data-startTime="83">you want to keep in your mind. </span><span class="line" data-startTime="86">We heard [? Elia ?] talking </span><span class="line" data-startTime="86">about numbers much bigger </span><span class="line" data-startTime="88">than 16 milliseconds, so this </span><span class="line" data-startTime="88">is a much smaller time frame. </span><span class="line" data-startTime="91">But it's super, super important </span><span class="line" data-startTime="91">that if you want to be smooth, </span><span class="line" data-startTime="94">you've got to hit that budget. </span></p>

<p class="speaker"><span class="line" data-starttime="95"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. </span><span class="line" data-startTime="95">And there's a lot </span><span class="line" data-startTime="95">of stuff that needs </span><span class="line" data-startTime="97">to go into that 16 milliseconds. </span><span class="line" data-startTime="98">The rendering system's </span><span class="line" data-startTime="98">really complicated. </span><span class="line" data-startTime="100">We're going to walk through the </span><span class="line" data-startTime="100">various stages in the rendering </span><span class="line" data-startTime="103">pipeline in this talk. </span><span class="line" data-startTime="104">But it's challenging </span><span class="line" data-startTime="104">to fit everything </span><span class="line" data-startTime="107">into 16 milliseconds. </span><span class="line" data-startTime="108">And this means that </span><span class="line" data-startTime="108">you should be working </span><span class="line" data-startTime="111">with the browser </span><span class="line" data-startTime="111">whenever possible. </span><span class="line" data-startTime="113">This means using things </span><span class="line" data-startTime="113">like requestAnimationFrame </span><span class="line" data-startTime="115">rather than a timer </span><span class="line" data-startTime="115">to run animations. </span><span class="line" data-startTime="118">This means using things like </span><span class="line" data-startTime="118">CSS animations, when possible, </span><span class="line" data-startTime="121">rather than doing everything </span><span class="line" data-startTime="121">yourself in JavaScript. </span><span class="line" data-startTime="125">And yeah, just </span><span class="line" data-startTime="125">trying to play nice. </span></p>

<p class="speaker"><span class="line" data-starttime="127"><span class="speakerName">Nat Duca</span>: Please be nice. </span></p>

<p class="speaker"><span class="line" data-starttime="128"><span class="speakerName">Tom Tom Wiltzius</span>: There's </span><span class="line" data-startTime="128">more content available </span><span class="line" data-startTime="130">at those links. </span></p>

<p class="speaker"><span class="line" data-starttime="131"><span class="speakerName">Nat Duca</span>: Yeah. </span><span class="line" data-startTime="132">So we all know, and we've </span><span class="line" data-startTime="132">known for many years, </span><span class="line" data-startTime="134">that if you have good </span><span class="line" data-startTime="134">load times for your pages, </span><span class="line" data-startTime="138">your user engagement will </span><span class="line" data-startTime="138">be much better than if you </span><span class="line" data-startTime="141">have bad load times. </span><span class="line" data-startTime="142">There's another part </span><span class="line" data-startTime="142">of this business </span><span class="line" data-startTime="143">that we don't talk </span><span class="line" data-startTime="143">about but that's </span><span class="line" data-startTime="145">obvious to mobile developers, </span><span class="line" data-startTime="145">which is your responsiveness, </span><span class="line" data-startTime="148">right? </span><span class="line" data-startTime="149">We've got two videos </span><span class="line" data-startTime="149">here going that are </span><span class="line" data-startTime="151">a good responsive page that is </span><span class="line" data-startTime="151">smooth, and one that's janky. </span><span class="line" data-startTime="155">You've got to think of </span><span class="line" data-startTime="155">this as a first order </span><span class="line" data-startTime="157">part of your business </span><span class="line" data-startTime="157">as creating a web app. </span><span class="line" data-startTime="160">I think most of you know this. </span><span class="line" data-startTime="161">But it's really worth hammering </span><span class="line" data-startTime="161">that home up to the bosses </span><span class="line" data-startTime="163">that this is something </span><span class="line" data-startTime="163">you don't fix at the end, </span><span class="line" data-startTime="165">you think about </span><span class="line" data-startTime="165">throughout the life cycle </span><span class="line" data-startTime="167">of whatever it is </span><span class="line" data-startTime="167">that you're building. </span></p>

<p class="speaker"><span class="line" data-starttime="169"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. </span> <span class="line" data-startTime="170">And especially, we're going to </span><span class="line" data-startTime="170">talk a lot today about things </span><span class="line" data-startTime="174">that impact mobile </span><span class="line" data-startTime="174">devices more than they </span><span class="line" data-startTime="177">impact, say, this laptop. </span> <span class="line" data-startTime="179">And this kind of </span><span class="line" data-startTime="179">difference, this difference </span><span class="line" data-startTime="182">in responsiveness, </span><span class="line" data-startTime="182">the difference </span><span class="line" data-startTime="185">comes out much more on </span><span class="line" data-startTime="185">said mobile devices, right? </span><span class="line" data-startTime="187">This is one of the </span><span class="line" data-startTime="187">key distinctions </span><span class="line" data-startTime="189">between native </span><span class="line" data-startTime="189">application development </span><span class="line" data-startTime="191">platforms on Android or </span><span class="line" data-startTime="191">iOS and the mobile web </span><span class="line" data-startTime="194">is that things feel webby when </span><span class="line" data-startTime="194">they lag, when they're slow, </span><span class="line" data-startTime="198">when they're jittery. </span></p>

<p><span class="line" data-startTime="199">And your users are going to </span><span class="line" data-startTime="199">notice the difference, even </span><span class="line" data-startTime="201">if they're not conscious of it. </span> <span class="line" data-startTime="202">It doesn't feel as nice. </span> <span class="line" data-startTime="204">It's one of the tells, so </span><span class="line" data-startTime="204">to speak, of a web app. </span> <span class="line" data-startTime="208">And that's unfortunate, and </span><span class="line" data-startTime="208">that's what we want to avoid. </span></p>

<p class="speaker"><span class="line" data-starttime="210"><span class="speakerName">Nat Duca</span>: So we've been nice. </span><span class="line" data-startTime="211">And now let's talk tech. </span></p>

<p class="speaker"><span class="line" data-starttime="212"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. </span> <span class="line" data-startTime="213">So if any of you have </span><span class="line" data-startTime="213">seen us talk before, </span><span class="line" data-startTime="217">we're going to go </span><span class="line" data-startTime="217">through some content that </span><span class="line" data-startTime="220">should be fairly familiar about </span><span class="line" data-startTime="220">how the painting system works, </span><span class="line" data-startTime="223">how the compositing </span><span class="line" data-startTime="223">system works. </span> <span class="line" data-startTime="225">And then we're going to </span><span class="line" data-startTime="225">talk about some stuff </span><span class="line" data-startTime="225">that we haven't </span><span class="line" data-startTime="225">talked about before. </span> <span class="line" data-startTime="227">So with that in mind, we're </span><span class="line" data-startTime="227">going to kind of fast, </span><span class="line" data-startTime="230">but bear with us. </span> <span class="line" data-startTime="232">If you think about </span><span class="line" data-startTime="232">how pixels get </span><span class="line" data-startTime="236">on the screen of, </span><span class="line" data-startTime="236">say, a mobile phone, </span><span class="line" data-startTime="238">there's a whole slew of </span><span class="line" data-startTime="238">stuff that needs to happen. </span> <span class="line" data-startTime="240">From the perspective </span><span class="line" data-startTime="240">of JavaScript, </span><span class="line" data-startTime="242">it's all of this stuff. </span></p>

<p class="speaker"><span class="line" data-starttime="243"><span class="speakerName">Nat Duca</span>: Yeah. </span> <span class="line" data-startTime="244">So this sort of thing makes </span><span class="line" data-startTime="244">the actual Chrome engineers </span><span class="line" data-startTime="247">try to kill themselves, </span><span class="line" data-startTime="247">because it's all a lie. </span> <span class="line" data-startTime="248">But from the point of </span><span class="line" data-startTime="248">view of the web developer, </span><span class="line" data-startTime="250">there are these </span><span class="line" data-startTime="250">various pipeline stages </span><span class="line" data-startTime="252">that your content goes through. </span> <span class="line" data-startTime="254">You start off with </span><span class="line" data-startTime="254">your JS and your DOM. </span> <span class="line" data-startTime="256">It has to be styled. </span> <span class="line" data-startTime="257">That has sort of two big </span><span class="line" data-startTime="257">steps &mdash; layout and recalc style. </span> <span class="line" data-startTime="261">The first part is where you're </span><span class="line" data-startTime="261">taking all your CSS selectors </span><span class="line" data-startTime="263">and figuring out </span><span class="line" data-startTime="263">which apply to what. </span> <span class="line" data-startTime="265">Second part is figuring out </span><span class="line" data-startTime="265">where things are positionally. </span></p>

<p><span class="line" data-startTime="268">Eventually you've got </span><span class="line" data-startTime="268">all that stuff done. </span> <span class="line" data-startTime="270">You're still not done. </span> <span class="line" data-startTime="271">You've got to basically take </span><span class="line" data-startTime="271">all of that computed stuff </span><span class="line" data-startTime="273">and turn it in to actual pixels, </span><span class="line" data-startTime="273">RGB values, in memory somewhere </span><span class="line" data-startTime="278">or on a GPU. </span> <span class="line" data-startTime="279">And we do that in </span><span class="line" data-startTime="279">two parts right now. </span> <span class="line" data-startTime="281">First we paint, which is </span><span class="line" data-startTime="281">where we take all of the lines </span><span class="line" data-startTime="283">and we rasterize them. </span> <span class="line" data-startTime="285">And the second part is we take </span><span class="line" data-startTime="285">all those textures that we made </span><span class="line" data-startTime="288">and we smash them </span><span class="line" data-startTime="288">together on the screen </span><span class="line" data-startTime="290">using the compositor. </span> <span class="line" data-startTime="291">And that's the stage where </span><span class="line" data-startTime="291">you hear layers come about. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="293"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. </span><span class="line" data-startTime="294">And so you can actually see this </span><span class="line" data-startTime="294">pipeline in action in DevTools. </span><span class="line" data-startTime="298">We really, really like </span><span class="line" data-startTime="298">the DevTools timeline view </span><span class="line" data-startTime="300">because it not only shows you </span><span class="line" data-startTime="300">each of these pipeline stages </span><span class="line" data-startTime="304">happening, but it also shows </span><span class="line" data-startTime="304">you how long each stage took. </span><span class="line" data-startTime="307">Which means that you have some </span><span class="line" data-startTime="307">sense of where the time may </span><span class="line" data-startTime="310">be eaten up if you have some </span><span class="line" data-startTime="310">janky interaction on your page. </span><span class="line" data-startTime="314">And usually the </span><span class="line" data-startTime="314">first thing I do when </span><span class="line" data-startTime="317">I'm trying to debug some </span><span class="line" data-startTime="317">slow site for whatever reason </span><span class="line" data-startTime="321">is I open it up and I take a </span><span class="line" data-startTime="321">timeline recording of whatever </span><span class="line" data-startTime="324">it was that was slow. </span><span class="line" data-startTime="325">And I start to get some sense </span><span class="line" data-startTime="325">of the breakdown of where </span><span class="line" data-startTime="329">that time is going and what it </span><span class="line" data-startTime="329">is that's causing a lot of time </span><span class="line" data-startTime="332">to be eaten. </span></p>

<p class="speaker"><span class="line" data-starttime="333"><span class="speakerName">Nat Duca</span>: This is your </span><span class="line" data-startTime="333">first line of defense, </span><span class="line" data-startTime="335">really, when it comes </span><span class="line" data-startTime="335">to jank busting. </span></p>

<p class="speaker"><span class="line" data-starttime="336"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. </span> <span class="line" data-startTime="337">And if you think </span><span class="line" data-startTime="337">about what properties </span><span class="line" data-startTime="340">you can animate in CSS, you </span><span class="line" data-startTime="340">know CSS will let you animate </span><span class="line" data-startTime="343">whatever you want, right? </span><span class="line" data-startTime="344">But it's important to realize </span><span class="line" data-startTime="344">that not all of these things </span><span class="line" data-startTime="348">are created equal. </span> <span class="line" data-startTime="349">If you change something like the </span><span class="line" data-startTime="349">opacity value on some element, </span><span class="line" data-startTime="355">then all we need to do behind </span><span class="line" data-startTime="355">the scenes is recomposite. </span> <span class="line" data-startTime="359">Turns out compositing </span><span class="line" data-startTime="359">is fairly cheap. </span> <span class="line" data-startTime="361">We can do it on the GPU. </span> <span class="line" data-startTime="363">And we can composite </span><span class="line" data-startTime="363">every frame, no problem. </span> <span class="line" data-startTime="366">In fact, Chrome needs to </span><span class="line" data-startTime="366">composite every frame just </span><span class="line" data-startTime="368">to make a new screen image. </span> <span class="line" data-startTime="370">But then you compare that to </span><span class="line" data-startTime="370">something like width or top. </span> <span class="line" data-startTime="373">And all of a sudden, you modify </span><span class="line" data-startTime="373">the width property and maybe </span><span class="line" data-startTime="377">some text [? tree ?] flows. </span> <span class="line" data-startTime="378">We need to do a </span><span class="line" data-startTime="378">lot of re-layout. </span></p>

<p><span class="line" data-startTime="381">And everything that </span><span class="line" data-startTime="381">got re-layed out, </span><span class="line" data-startTime="383">and maybe more stuff around </span><span class="line" data-startTime="383">it, needs to be repainted. </span> <span class="line" data-startTime="385">And then everything </span><span class="line" data-startTime="385">that got repainted </span><span class="line" data-startTime="387">needs to be recomposited. </span> <span class="line" data-startTime="388">And all of a sudden, </span><span class="line" data-startTime="388">this whole pipeline </span><span class="line" data-startTime="390">is kind of in action, </span><span class="line" data-startTime="390">which is very difficult </span><span class="line" data-startTime="393">to fit in 16 milliseconds. </span></p>

<p class="speaker"><span class="line" data-starttime="394"><span class="speakerName">Nat Duca</span>: You're now </span><span class="line" data-startTime="394">in danger territory. </span><span class="line" data-startTime="395">The more left you </span><span class="line" data-startTime="395">go in this pipeline, </span><span class="line" data-startTime="397">the more you're risking jank. </span></p>

<p class="speaker"><span class="line" data-starttime="399"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. </span><span class="line" data-startTime="399">But it's not just the </span><span class="line" data-startTime="399">more left, there's </span><span class="line" data-startTime="401">kind of a big cliff </span><span class="line" data-startTime="401">right about there. </span><span class="line" data-startTime="406">One of these things is </span><span class="line" data-startTime="406">not like the others. </span><span class="line" data-startTime="408">Painting is really slow. </span></p>

<p class="speaker"><span class="line" data-starttime="410"><span class="speakerName">Nat Duca</span>: It's </span><span class="line" data-startTime="410">like, really slow. </span><span class="line" data-startTime="412">And we wanted to </span><span class="line" data-startTime="412">share some numbers. </span></p>

<p class="speaker"><span class="line" data-starttime="414"><span class="speakerName">Tom Tom Wiltzius</span>: Right. </span><span class="line" data-startTime="415">So this is data from </span><span class="line" data-startTime="415">Chrome Perf, which </span><span class="line" data-startTime="417">is the dashboard that was </span><span class="line" data-startTime="417">mentioned earlier this morning. </span><span class="line" data-startTime="423">We have a rasterization </span><span class="line" data-startTime="423">time metric. </span><span class="line" data-startTime="426">And if you look at </span><span class="line" data-startTime="426">a Nexus 10 and you </span><span class="line" data-startTime="428">take a site like the </span><span class="line" data-startTime="428">"New York Times," </span><span class="line" data-startTime="429">takes 10 milliseconds </span><span class="line" data-startTime="429">to raster just </span><span class="line" data-startTime="432">the content that's </span><span class="line" data-startTime="432">currently visible, say, </span><span class="line" data-startTime="434">during the page load. </span></p>

<p class="speaker"><span class="line" data-starttime="435"><span class="speakerName">Nat Duca</span>: So that's better. </span><span class="line" data-startTime="437">I mean 10 is not &mdash; </span><span class="line" data-startTime="437">OK, sure, fine. </span><span class="line" data-startTime="439">Like, eh, why are </span><span class="line" data-startTime="439">you on about this? </span></p>

<p class="speaker"><span class="line" data-starttime="441"><span class="speakerName">Tom Tom Wiltzius</span>: Because then you </span><span class="line" data-startTime="441">go to a site like The Verge, </span><span class="line" data-startTime="443">and all of a sudden, it takes </span><span class="line" data-startTime="443">107 milliseconds to raster. </span></p>

<p class="speaker"><span class="line" data-starttime="445"><span class="speakerName">Nat Duca</span>: This is not fast. </span></p>

<p class="speaker"><span class="line" data-starttime="447"><span class="speakerName">Tom Tom Wiltzius</span>: Right. </span><span class="line" data-startTime="447">And then you go </span><span class="line" data-startTime="447">to Cute Overload, </span><span class="line" data-startTime="449">and it takes 214 milliseconds </span><span class="line" data-startTime="449">to raster, right? </span></p>

<p class="speaker"><span class="line" data-starttime="451"><span class="speakerName">Nat Duca</span>: Which is a </span><span class="line" data-startTime="451">lovely site, right? </span></p>

<p class="speaker"><span class="line" data-starttime="455"><span class="speakerName">Tom Tom Wiltzius</span>: Right. </span><span class="line" data-startTime="456">I'm not pooh-poohing </span><span class="line" data-startTime="456">any of these sites. </span><span class="line" data-startTime="457">I'm just saying, there </span><span class="line" data-startTime="457">is an incredible amount </span><span class="line" data-startTime="460">of unpredictability in how </span><span class="line" data-startTime="460">long things take to paint. </span><span class="line" data-startTime="463">And if you think about this </span><span class="line" data-startTime="463">in terms of frames, which </span><span class="line" data-startTime="466">is kind of a good </span><span class="line" data-startTime="466">logical unit to consider, </span><span class="line" data-startTime="469">then all of a </span><span class="line" data-startTime="469">sudden, you can see </span><span class="line" data-startTime="471">that 214 milliseconds, </span><span class="line" data-startTime="471">that's 13 frames at 16 </span><span class="line" data-startTime="475">milliseconds a frame. </span><span class="line" data-startTime="476">That means that you </span><span class="line" data-startTime="476">end up in this position </span><span class="line" data-startTime="478">where if you really </span><span class="line" data-startTime="478">want to be repainting </span><span class="line" data-startTime="480">all that content every frame, </span><span class="line" data-startTime="480">there's just no way, right? </span></p>

<p class="speaker"><span class="line" data-starttime="484"><span class="speakerName">Nat Duca</span>: Seconds per frame. </span></p>

<p class="speaker"><span class="line" data-starttime="485"><span class="speakerName">Tom Tom Wiltzius</span>: This means </span><span class="line" data-startTime="485">that your frames per second </span><span class="line" data-startTime="487">goes way, way, way down. </span><span class="line" data-startTime="488">You're nowhere near 60. </span></p>

<p class="speaker"><span class="line" data-starttime="489"><span class="speakerName">Nat Duca</span>: Four. </span><span class="line" data-startTime="490">Is that smooth? </span></p>

<p class="speaker"><span class="line" data-starttime="492"><span class="speakerName">Tom Tom Wiltzius</span>: Right. </span><span class="line" data-startTime="494">And this is exacerbated </span><span class="line" data-startTime="494">when, as I kind of alluded </span><span class="line" data-startTime="499">on the last slide, you end </span><span class="line" data-startTime="499">up in this position where </span><span class="line" data-startTime="501">you need to paint things </span><span class="line" data-startTime="501">on a per frame basis. </span><span class="line" data-startTime="504">So we call this a paint storm. </span><span class="line" data-startTime="507">If you go into DevTools and you </span><span class="line" data-startTime="507">turn on Show Paint Rectangles, </span><span class="line" data-startTime="510">you'll get a red flash on </span><span class="line" data-startTime="510">the part of the screen that </span><span class="line" data-startTime="513">repaints every time it repaints. </span><span class="line" data-startTime="515">This is cool because it means </span><span class="line" data-startTime="515">that you can see that during </span><span class="line" data-startTime="518">this interaction &mdash; this is Nat's </span><span class="line" data-startTime="518">fat finger moving up and down </span><span class="line" data-startTime="521">on &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="522"><span class="speakerName">Nat Duca</span>: It's a fine </span><span class="line" data-startTime="522">finger, isn't it? </span></p>

<p class="speaker"><span class="line" data-starttime="523"><span class="speakerName">Tom Tom Wiltzius</span>:  &mdash; a demo he made. </span> <span class="line" data-startTime="524">You can see that there are </span><span class="line" data-startTime="524">key points in that interaction </span><span class="line" data-startTime="527">where, all of a sudden, there </span><span class="line" data-startTime="527">are these red flashes that </span><span class="line" data-startTime="530">show up and cover the screen. </span> <span class="line" data-startTime="531">And this is really bad, right? </span><span class="line" data-startTime="532">Because that means that every </span><span class="line" data-startTime="532">time one of those red flashes </span><span class="line" data-startTime="535">shows up, then we're paying a </span><span class="line" data-startTime="535">lot of this significant paint </span><span class="line" data-startTime="538">cost, right? </span><span class="line" data-startTime="539">And if you were to show sort </span><span class="line" data-startTime="539">of like a timeline view of this </span><span class="line" data-startTime="542">in Developer Tools, you'd </span><span class="line" data-startTime="542">be able to see exactly how </span><span class="line" data-startTime="544">long each of those </span><span class="line" data-startTime="544">paints were taking. </span></p>

<p class="speaker"><span class="line" data-starttime="546"><span class="speakerName">Nat Duca</span>: Yeah. </span> <span class="line" data-startTime="547">And we see a lot of sites </span><span class="line" data-startTime="547">that basically get pretty far </span><span class="line" data-startTime="550">along in their lifetime before </span><span class="line" data-startTime="550">they even look at paint rects. </span> <span class="line" data-startTime="553">And at that point, you've added </span><span class="line" data-startTime="553">so much complexity to your DOM. </span> <span class="line" data-startTime="556">You've got 73 different </span><span class="line" data-startTime="556">things all going on. </span> <span class="line" data-startTime="559">You no longer know </span><span class="line" data-startTime="559">which is the one that's </span><span class="line" data-startTime="560">causing the storm, </span><span class="line" data-startTime="560">what's going wrong. </span> <span class="line" data-startTime="562">And so you want to </span><span class="line" data-startTime="562">keep your eye out </span><span class="line" data-startTime="564">for this from the </span><span class="line" data-startTime="564">beginning of your content </span><span class="line" data-startTime="567">through its lifetime in </span><span class="line" data-startTime="567">order to defend against this. </span> <span class="line" data-startTime="571">Now the defense. </span> <span class="line" data-startTime="572">You know, the first line </span><span class="line" data-startTime="572">of defense in this space </span><span class="line" data-startTime="574">is layers, right? </span><span class="line" data-startTime="575">We've alluded to it. </span> <span class="line" data-startTime="576">We've talked a lot </span><span class="line" data-startTime="576">about it on Jank Free. </span> <span class="line" data-startTime="578">You can look at that demo and </span><span class="line" data-startTime="578">think about it in your head </span><span class="line" data-startTime="580">and go, well, yeah. </span> <span class="line" data-startTime="581">They're these pieces, and </span><span class="line" data-startTime="581">they're just moving around. </span> <span class="line" data-startTime="583">So what we can do to </span><span class="line" data-startTime="583">make this smoother </span><span class="line" data-startTime="585">is keep each one </span><span class="line" data-startTime="585">of those in a layer </span><span class="line" data-startTime="587">and add them all together. </span></p>

<p><span class="line" data-startTime="589">And if you sort of think about, </span><span class="line" data-startTime="589">then, the movement from frame </span><span class="line" data-startTime="592">to frame to frame is us just </span><span class="line" data-startTime="592">moving these layers around </span><span class="line" data-startTime="595">on the screen, no </span><span class="line" data-startTime="595">repainting is necessary. </span> <span class="line" data-startTime="598">So that means we </span><span class="line" data-startTime="598">don't have to get </span><span class="line" data-startTime="599">those left parts of the </span><span class="line" data-startTime="599">pipeline running that are slow, </span><span class="line" data-startTime="602">the purples and the greens. </span> <span class="line" data-startTime="604">And so in theory, this </span><span class="line" data-startTime="604">is smoother, right? </span><span class="line" data-startTime="607">And so this is </span><span class="line" data-startTime="607">just the same thing </span><span class="line" data-startTime="609">but redone to be no </span><span class="line" data-startTime="609">repaints, or very few. </span> <span class="line" data-startTime="615">And so it's a lot smoother. </span></p>

<p class="speaker"><span class="line" data-starttime="616"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. </span><span class="line" data-startTime="617">And actually, you can </span><span class="line" data-startTime="617">see &mdash; it's probably </span><span class="line" data-startTime="619">pretty small on </span><span class="line" data-startTime="619">the screen, but you </span><span class="line" data-startTime="620">can see that there are some </span><span class="line" data-startTime="620">red flashes still happening </span><span class="line" data-startTime="623">along the far right side of </span><span class="line" data-startTime="623">the mobile device screen. </span><span class="line" data-startTime="626">That's just us repainting </span><span class="line" data-startTime="626">the scroll bar, which we do </span><span class="line" data-startTime="628">[INAUDIBLE]. </span></p>

<p class="speaker"><span class="line" data-starttime="628"><span class="speakerName">Nat Duca</span>: Scroll bars. </span><span class="line" data-startTime="628">We haven't optimized them. </span><span class="line" data-startTime="629">They're small. </span></p>

<p class="speaker"><span class="line" data-starttime="630"><span class="speakerName">Tom Tom Wiltzius</span>: But you can </span><span class="line" data-startTime="630">see that other than that, </span><span class="line" data-startTime="631">there are no red flashes. </span></p>

<p class="speaker"><span class="line" data-starttime="632"><span class="speakerName">Nat Duca</span>: So that's better. </span></p>

<p class="speaker"><span class="line" data-starttime="633"><span class="speakerName">Tom Tom Wiltzius</span>: This is good. </span><span class="line" data-startTime="634">The point here is </span><span class="line" data-startTime="634">that you want to try </span><span class="line" data-startTime="636">to decompose the </span><span class="line" data-startTime="636">structure of your page </span><span class="line" data-startTime="638">into logical units that </span><span class="line" data-startTime="638">map well to layers. </span><span class="line" data-startTime="642">And these logical units should </span><span class="line" data-startTime="642">be things that move together, </span><span class="line" data-startTime="645">that fade together, or that, </span><span class="line" data-startTime="645">maybe, stretch together. </span><span class="line" data-startTime="648">These are things that </span><span class="line" data-startTime="648">are easy to express </span><span class="line" data-startTime="651">in terms of the </span><span class="line" data-startTime="651">layering triggers </span><span class="line" data-startTime="653">that we have on the </span><span class="line" data-startTime="653">web platform today. </span></p>

<p class="speaker"><span class="line" data-starttime="655"><span class="speakerName">Nat Duca</span>: We should make </span><span class="line" data-startTime="655">a postcard that says that. </span><span class="line" data-startTime="657">Like move together, </span><span class="line" data-startTime="657">stretch together. </span></p>

<p class="speaker"><span class="line" data-starttime="659"><span class="speakerName">Tom Tom Wiltzius</span>: And basically, </span><span class="line" data-startTime="659">this maps to the set </span><span class="line" data-startTime="661">of things &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="661"><span class="speakerName">Nat Duca</span>: Anybody? </span></p>

<p class="speaker"><span class="line" data-starttime="662"><span class="speakerName">Tom Tom Wiltzius</span>: This </span><span class="line" data-startTime="662">maps to the set </span><span class="line" data-startTime="663">of things that GPUs are good at. </span><span class="line" data-startTime="665">Like GPUs are OK at the </span><span class="line" data-startTime="665">kind of rasterization </span><span class="line" data-startTime="669">that Nat was talking </span><span class="line" data-startTime="669">about earlier. </span><span class="line" data-startTime="671">But they're really good at </span><span class="line" data-startTime="671">these bulk pixel operations. </span></p>

<p class="speaker"><span class="line" data-starttime="674"><span class="speakerName">Nat Duca</span>: Yeah. </span><span class="line" data-startTime="674">So think in terms of layers. </span><span class="line" data-startTime="676">It's really, really that </span><span class="line" data-startTime="676">key building block right now </span><span class="line" data-startTime="679">for getting speed on mobile. </span><span class="line" data-startTime="681">But that having been said &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="682"><span class="speakerName">Tom Tom Wiltzius</span>: Great, right? </span><span class="line" data-startTime="683">What sucks about this? </span></p>

<p class="speaker"><span class="line" data-starttime="684"><span class="speakerName">Nat Duca</span>: The fine print. </span></p>

<p class="speaker"><span class="line" data-starttime="684"><span class="speakerName">Tom Tom Wiltzius</span>: Lots of </span><span class="line" data-startTime="684">things suck about this. </span><span class="line" data-startTime="686">We try to make </span><span class="line" data-startTime="686">layers automatically, </span><span class="line" data-startTime="688">but we can't always do it. </span><span class="line" data-startTime="690">Like one of the common questions </span><span class="line" data-startTime="690">we get is always, OK, so great, </span><span class="line" data-startTime="694">I see how you guys </span><span class="line" data-startTime="694">are explaining </span><span class="line" data-startTime="696">the rendering system working. </span><span class="line" data-startTime="697">Why can't the browser do </span><span class="line" data-startTime="697">all of this on my behalf? </span><span class="line" data-startTime="699">And believe me, we are trying. </span><span class="line" data-startTime="702">But there are some </span><span class="line" data-startTime="702">fundamental limitations </span><span class="line" data-startTime="705">that we more or </span><span class="line" data-startTime="705">less can't get over. </span><span class="line" data-startTime="708">The most mundane of these, in </span><span class="line" data-startTime="708">my mind, is text antialiasing. </span><span class="line" data-startTime="713">You'll drop from subpixel, like </span><span class="line" data-startTime="713">LCD screen text antialiasing, </span><span class="line" data-startTime="718">to grayscale text antialiasing. </span></p>

<p class="speaker"><span class="line" data-starttime="719"><span class="speakerName">Nat Duca</span>: This is </span><span class="line" data-startTime="719">like ClearType. </span></p>

<p class="speaker"><span class="line" data-starttime="721"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. </span> <span class="line" data-startTime="722">If you're on a </span><span class="line" data-startTime="722">composited layer that </span><span class="line" data-startTime="723">doesn't have a solid </span><span class="line" data-startTime="723">color background. </span> <span class="line" data-startTime="724">So if you're concerned </span><span class="line" data-startTime="724">about text quality </span><span class="line" data-startTime="727">and you maybe manually </span><span class="line" data-startTime="727">promoted something to a layer, </span><span class="line" data-startTime="730">try to make it a </span><span class="line" data-startTime="730">solid color background </span><span class="line" data-startTime="732">and you won't have that problem. </span> <span class="line" data-startTime="733">This is the same reason that </span><span class="line" data-startTime="733">we have different criteria </span><span class="line" data-startTime="736">for automatically promoting </span><span class="line" data-startTime="736">certain content to layers </span><span class="line" data-startTime="739">on high DPI versus </span><span class="line" data-startTime="739">low DPI devices </span><span class="line" data-startTime="741">and on Android versus desktop. </span> <span class="line" data-startTime="743">So you need to be testing </span><span class="line" data-startTime="743">all of these places. </span> <span class="line" data-startTime="745">This sucks &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="746"><span class="speakerName">Nat Duca</span>: This is the </span><span class="line" data-startTime="746">reality that we live in. </span></p>

<p class="speaker"><span class="line" data-starttime="748"><span class="speakerName">Tom Tom Wiltzius</span>:  &mdash; but there's </span><span class="line" data-startTime="748">not a lot we can do about it. </span></p>

<p class="speaker"><span class="line" data-starttime="749"><span class="speakerName">Nat Duca</span>: There are </span><span class="line" data-startTime="749">other things, too. </span> <span class="line" data-startTime="750">So for example, </span><span class="line" data-startTime="750">position sticky is </span><span class="line" data-startTime="752">one of the looks du jour, right? </span><span class="line" data-startTime="753">And understandably so. </span> <span class="line" data-startTime="756">When you try to </span><span class="line" data-startTime="756">emulate that, a lot </span><span class="line" data-startTime="757">of the times what you </span><span class="line" data-startTime="757">end up having is you </span><span class="line" data-startTime="759">have a div that you're </span><span class="line" data-startTime="759">moving up and down. </span> <span class="line" data-startTime="761">And inside it, you want </span><span class="line" data-startTime="761">a position fixed child </span><span class="line" data-startTime="764">of that div that's </span><span class="line" data-startTime="764">your sticky element. </span> <span class="line" data-startTime="766">Unfortunately, when you </span><span class="line" data-startTime="766">put translateZ(0) on that, </span><span class="line" data-startTime="769">that redefines at </span><span class="line" data-startTime="769">the spec level what </span><span class="line" data-startTime="772">the position fixed </span><span class="line" data-startTime="772">is relative to. </span> <span class="line" data-startTime="774">If you go and do a little </span><span class="line" data-startTime="774">JS fiddle on your own, </span><span class="line" data-startTime="776">you'll find that position </span><span class="line" data-startTime="776">fixed on something </span><span class="line" data-startTime="779">that is a layer </span><span class="line" data-startTime="779">through translateZ(0) </span><span class="line" data-startTime="782">is relative to the actual layer. </span> <span class="line" data-startTime="784">So then you can't do </span><span class="line" data-startTime="784">sticky, because you </span><span class="line" data-startTime="786">want sticky to stick </span><span class="line" data-startTime="786">to the viewport. </span></p>

<p><span class="line" data-startTime="788">If you use this nasty </span><span class="line" data-startTime="788">little dirty trick, </span><span class="line" data-startTime="790">you might have more headway. </span> <span class="line" data-startTime="792">And we're going to leave </span><span class="line" data-startTime="792">it at that, because this </span><span class="line" data-startTime="794">is unblessed, but the reality </span><span class="line" data-startTime="794">of the world we live in. </span> <span class="line" data-startTime="799">And this is, in fact, </span><span class="line" data-startTime="799">the reality, right? </span></p>

<p class="speaker"><span class="line" data-starttime="801"><span class="speakerName">Tom Tom Wiltzius</span>: This </span><span class="line" data-startTime="801">is the web, right? </span></p>

<p class="speaker"><span class="line" data-starttime="802"><span class="speakerName">Nat Duca</span>: And here's another </span><span class="line" data-startTime="802">little unfortunate reality. </span> <span class="line" data-startTime="805">Web pages are tall, right? </span><span class="line" data-startTime="806">You've got lots </span><span class="line" data-startTime="806">of things in them. </span> <span class="line" data-startTime="808">10,000, 20,000 pixels </span><span class="line" data-startTime="808">tall is not unusual. </span> <span class="line" data-startTime="812">Chrome's rendering </span><span class="line" data-startTime="812">system uses layers </span><span class="line" data-startTime="814">in order to warm things up. </span> <span class="line" data-startTime="816">So we are looking at </span><span class="line" data-startTime="816">all layers assuming </span><span class="line" data-startTime="818">that they might come on </span><span class="line" data-startTime="818">the screen imminently. </span> <span class="line" data-startTime="822">Has anybody ever done </span><span class="line" data-startTime="822">a trick in their app </span><span class="line" data-startTime="824">where they put something </span><span class="line" data-startTime="824">at negative 10,000 pixels </span><span class="line" data-startTime="827">and then they fly it </span><span class="line" data-startTime="827">in with an animation? </span><span class="line" data-startTime="829">Right? </span><span class="line" data-startTime="830">It looks really pretty. </span> <span class="line" data-startTime="832">But the problem with </span><span class="line" data-startTime="832">that is we, Chrome, </span><span class="line" data-startTime="834">have no idea if something </span><span class="line" data-startTime="834">is negative 10,000 pixels </span><span class="line" data-startTime="837">from the viewport and can't </span><span class="line" data-startTime="837">become visible next frame, </span><span class="line" data-startTime="840">versus it's negative </span><span class="line" data-startTime="840">10,000 pixels </span><span class="line" data-startTime="842">and the user can't get there. </span></p>

<p><span class="line" data-startTime="844">So this is a thing where we </span><span class="line" data-startTime="844">don't have that understanding. </span> <span class="line" data-startTime="847">So if you hide stuff that the </span><span class="line" data-startTime="847">user can't get to any time </span><span class="line" data-startTime="850">soon, that gives </span><span class="line" data-startTime="850">us less work to do. </span> <span class="line" data-startTime="852">We use less CPU, and </span><span class="line" data-startTime="852">you're less janky. </span></p>

<p class="speaker"><span class="line" data-starttime="856"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. </span><span class="line" data-startTime="857">And that's &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="857"><span class="speakerName">Nat Duca</span>: That's a good thing. </span></p>

<p class="speaker"><span class="line" data-starttime="857"><span class="speakerName">Tom Tom Wiltzius</span>:  &mdash; all really good. </span> <span class="line" data-startTime="859">OK. </span> <span class="line" data-startTime="859">This is a lot of content </span><span class="line" data-startTime="859">that we just blew through. </span> <span class="line" data-startTime="862">And we didn't do any kind </span><span class="line" data-startTime="862">of live demos the way </span><span class="line" data-startTime="865">we usually do. </span> <span class="line" data-startTime="866">But I want to break this down </span><span class="line" data-startTime="866">into simple takeaway messages, </span><span class="line" data-startTime="869">which is that, you want to be </span><span class="line" data-startTime="869">looking for these paint storms. </span> <span class="line" data-startTime="872">You can find them </span><span class="line" data-startTime="872">with DevTools and </span><span class="line" data-startTime="873">the showPaintRects function. </span> <span class="line" data-startTime="875">If you find these </span><span class="line" data-startTime="875">paint storms, you </span><span class="line" data-startTime="878">want to try to avoid them </span><span class="line" data-startTime="878">through implicit or explicit </span><span class="line" data-startTime="881">layer creation, if </span><span class="line" data-startTime="881">at all possible. </span></p>

<p><span class="line" data-startTime="883">You can see the layer </span><span class="line" data-startTime="883">borders really nicely </span><span class="line" data-startTime="886">if you go into DevTools and </span><span class="line" data-startTime="886">turn on Show Composited Layer </span><span class="line" data-startTime="889">Borders. </span> <span class="line" data-startTime="889">This is a very nice </span><span class="line" data-startTime="889">visual aid to help you </span><span class="line" data-startTime="892">with this sort of layer </span><span class="line" data-startTime="892">decomposition process. </span> <span class="line" data-startTime="895">And if you're doing </span><span class="line" data-startTime="895">everything right </span><span class="line" data-startTime="898">and you're still finding that </span><span class="line" data-startTime="898">you have these paint storms </span><span class="line" data-startTime="901">and you just can't figure out </span><span class="line" data-startTime="901">why it's repainting, because it </span><span class="line" data-startTime="904">doesn't seem like anything </span><span class="line" data-startTime="904">needs to, you may be right. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="908"><span class="speakerName">Nat Duca</span>: Chrome isn't perfect. </span><span class="line" data-startTime="910">We've spent a lot of time </span><span class="line" data-startTime="910">making this just work. </span><span class="line" data-startTime="913">There are cases where </span><span class="line" data-startTime="913">Chrome's tiny little brain, </span><span class="line" data-startTime="915">or Blink's tiny little </span><span class="line" data-startTime="915">brain, gets confused, </span><span class="line" data-startTime="917">and it repaints the universe. </span><span class="line" data-startTime="918">If you're hitting that, </span><span class="line" data-startTime="918">try to reduce it down, </span><span class="line" data-startTime="920">pare it down, and email </span><span class="line" data-startTime="920">Tom or I or file a bug. </span><span class="line" data-startTime="923">We'll try to get </span><span class="line" data-startTime="923">that sorted out. </span></p>

<p class="speaker"><span class="line" data-starttime="924"><span class="speakerName">Tom Tom Wiltzius</span>: We've </span><span class="line" data-startTime="924">been, recently, </span><span class="line" data-startTime="926">on a spree of stamping out </span><span class="line" data-startTime="926">what we call spurious paint </span><span class="line" data-startTime="930">invalidations, and we </span><span class="line" data-startTime="930">would love to have more. </span></p>

<p class="speaker"><span class="line" data-starttime="933"><span class="speakerName">Nat Duca</span>: Bugs welcome. </span></p>

<p class="speaker"><span class="line" data-starttime="934"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. </span><span class="line" data-startTime="936">OK, so that's </span><span class="line" data-startTime="936">rendering performance </span><span class="line" data-startTime="938">from the perspective </span><span class="line" data-startTime="938">of JavaScript, right? </span><span class="line" data-startTime="940">But if what we really </span><span class="line" data-startTime="940">want to talk about </span><span class="line" data-startTime="943">is responsiveness on </span><span class="line" data-startTime="943">a touch based device, </span><span class="line" data-startTime="946">like a mobile phone, </span><span class="line" data-startTime="946">there's another component </span><span class="line" data-startTime="949">to the entire story </span><span class="line" data-startTime="949">that we haven't really </span><span class="line" data-startTime="951">talked about yet. </span><span class="line" data-startTime="953">And that's the input, right? </span><span class="line" data-startTime="955">Particularly on a </span><span class="line" data-startTime="955">touch device, latency </span><span class="line" data-startTime="958">can be absolutely killer. </span><span class="line" data-startTime="960">And Nat's going to walk through </span><span class="line" data-startTime="960">a couple examples of that. </span></p>

<p class="speaker"><span class="line" data-starttime="962"><span class="speakerName">Nat Duca</span>: We've got two videos </span><span class="line" data-startTime="962">going here, a good and a bad, </span><span class="line" data-startTime="964">right? </span><span class="line" data-startTime="965">This should jump </span><span class="line" data-startTime="965">right out at you. </span> <span class="line" data-startTime="967">If you drag something </span><span class="line" data-startTime="967">around with your finger, </span><span class="line" data-startTime="969">you want it to stick </span><span class="line" data-startTime="969">to your finger. </span> <span class="line" data-startTime="971">And on the left, you've got </span><span class="line" data-startTime="971">something that's definitely not </span><span class="line" data-startTime="974">sticky, feels a little laggy </span><span class="line" data-startTime="974">if you're doing this yourself. </span> <span class="line" data-startTime="977">On the right is sort of a </span><span class="line" data-startTime="977">little closer to what you want. </span> <span class="line" data-startTime="979">And ideally you get even </span><span class="line" data-startTime="979">closer, as much as you can. </span> <span class="line" data-startTime="984">Now getting there </span><span class="line" data-startTime="984">on the web, that's </span><span class="line" data-startTime="987">the leading edge of innovation </span><span class="line" data-startTime="987">for both Chrome and really </span><span class="line" data-startTime="990">everyone. </span> <span class="line" data-startTime="991">This is a hard problem. </span> <span class="line" data-startTime="993">But we'd like to share what </span><span class="line" data-startTime="993">we know about it today. </span></p>

<p class="speaker"><span class="line" data-starttime="995"><span class="speakerName">Tom Tom Wiltzius</span>: Right, </span><span class="line" data-startTime="995">and a little bit </span><span class="line" data-startTime="996">about what we've been doing. </span> <span class="line" data-startTime="998">So if you're trying to get the </span><span class="line" data-startTime="998">page to stick to your finger, </span><span class="line" data-startTime="1001">or say, maybe you </span><span class="line" data-startTime="1001">have a slider widget </span><span class="line" data-startTime="1003">and you really want </span><span class="line" data-startTime="1003">the slider widget </span><span class="line" data-startTime="1005">to stay under your finger when </span><span class="line" data-startTime="1005">you slide the widget around, </span><span class="line" data-startTime="1007">then you've kind </span><span class="line" data-startTime="1007">of got two options. </span> <span class="line" data-startTime="1009">Option A is you </span><span class="line" data-startTime="1009">get lucky and you </span><span class="line" data-startTime="1013">happen to have an effect </span><span class="line" data-startTime="1013">that can be expressed </span><span class="line" data-startTime="1015">in terms of the </span><span class="line" data-startTime="1015">fast scroll path. </span> <span class="line" data-startTime="1020">If you're on this </span><span class="line" data-startTime="1020">fast scroll path </span><span class="line" data-startTime="1021">and the browser is sort of </span><span class="line" data-startTime="1021">doing the scrolling for you, </span><span class="line" data-startTime="1024">then you just happen to get </span><span class="line" data-startTime="1024">all of the best possible touch </span><span class="line" data-startTime="1029">input latency. </span></p>

<p><span class="line" data-startTime="1030">Because we built </span><span class="line" data-startTime="1030">that part, and we </span><span class="line" data-startTime="1032">tried to make it as </span><span class="line" data-startTime="1032">good as possible. </span></p>

<p class="speaker"><span class="line" data-starttime="1034"><span class="speakerName">Nat Duca</span>: But the </span><span class="line" data-startTime="1034">option B happens </span><span class="line" data-startTime="1035">when you're in a </span><span class="line" data-startTime="1035">situation where you've </span><span class="line" data-startTime="1037">got to implement a </span><span class="line" data-startTime="1037">drawer or a slider </span><span class="line" data-startTime="1039">where the actual </span><span class="line" data-startTime="1039">thing &mdash; or a drawing </span><span class="line" data-startTime="1041">app &mdash; the actual </span><span class="line" data-startTime="1041">thing that happens </span><span class="line" data-startTime="1043">in response to that input </span><span class="line" data-startTime="1043">is necessarily programmatic. </span><span class="line" data-startTime="1046">That is not a scroll. </span><span class="line" data-startTime="1047">You need to handle </span><span class="line" data-startTime="1047">that yourself. </span><span class="line" data-startTime="1049">There's a different set of </span><span class="line" data-startTime="1049">rules for making that fast. </span></p>

<p class="speaker"><span class="line" data-starttime="1051"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. </span><span class="line" data-startTime="1052">So let's say you </span><span class="line" data-startTime="1052">go with option A. </span></p>

<p class="speaker"><span class="line" data-starttime="1054"><span class="speakerName">Nat Duca</span>: Because </span><span class="line" data-startTime="1054">that's fun, right? </span></p>

<p class="speaker"><span class="line" data-starttime="1055"><span class="speakerName">Tom Tom Wiltzius</span>: Right. </span> <span class="line" data-startTime="1056">And often, that totally works. </span> <span class="line" data-startTime="1057">Depending on your </span><span class="line" data-startTime="1057">content, like scrolling, </span><span class="line" data-startTime="1059">the reason we have done all </span><span class="line" data-startTime="1059">this work about scrolling </span><span class="line" data-startTime="1062">is that scrolling </span><span class="line" data-startTime="1062">is one of the most </span><span class="line" data-startTime="1063">common operations </span><span class="line" data-startTime="1063">on the web, right? </span><span class="line" data-startTime="1066">And even on mobile devices. </span> <span class="line" data-startTime="1068">So if you're going </span><span class="line" data-startTime="1068">to go this route, </span><span class="line" data-startTime="1071">you want to make sure </span><span class="line" data-startTime="1071">that the layers you expect </span><span class="line" data-startTime="1073">to have gotten created </span><span class="line" data-startTime="1073">were, in fact, created. </span></p>

<p><span class="line" data-startTime="1076">And that they're </span><span class="line" data-startTime="1076">working as intended. </span> <span class="line" data-startTime="1077">So this means that whatever </span><span class="line" data-startTime="1077">the kind of content area that </span><span class="line" data-startTime="1080">is scrolling should </span><span class="line" data-startTime="1080">be in its own layer. </span> <span class="line" data-startTime="1084">And when it scrolls, </span><span class="line" data-startTime="1084">you shouldn't </span><span class="line" data-startTime="1085">see it all repainting, right? </span><span class="line" data-startTime="1087">And again, the same couple </span><span class="line" data-startTime="1087">of basic DevTools features </span><span class="line" data-startTime="1091">will let you very </span><span class="line" data-startTime="1091">easily visualize </span><span class="line" data-startTime="1093">this, along with timeline. </span></p>

<p class="speaker"><span class="line" data-starttime="1094"><span class="speakerName">Nat Duca</span>: We're just </span><span class="line" data-startTime="1094">hitting this point again, </span><span class="line" data-startTime="1096">which is layers are </span><span class="line" data-startTime="1096">good, but they're </span><span class="line" data-startTime="1098">very hard to persuade to exist. </span><span class="line" data-startTime="1100">And so you have to be </span><span class="line" data-startTime="1100">constant vigilance here </span><span class="line" data-startTime="1104">in order to catch </span><span class="line" data-startTime="1104">that fast path. </span></p>

<p class="speaker"><span class="line" data-starttime="1105"><span class="speakerName">Tom Tom Wiltzius</span>: Exactly. </span> <span class="line" data-startTime="1106">And a lot of that </span><span class="line" data-startTime="1106">vigilance comes down </span><span class="line" data-startTime="1108">to testing the right places. </span> <span class="line" data-startTime="1110">So it is very tempting </span><span class="line" data-startTime="1110">as a developer </span><span class="line" data-startTime="1114">to do everything on </span><span class="line" data-startTime="1114">your laptop, right? </span><span class="line" data-startTime="1117">Or on your work station. </span> <span class="line" data-startTime="1118">But the unfortunate reality </span><span class="line" data-startTime="1118">is it's basically impossible </span><span class="line" data-startTime="1122">to emulate the performance </span><span class="line" data-startTime="1122">characteristics of an Android </span><span class="line" data-startTime="1125">device on, say, </span><span class="line" data-startTime="1125">this nice laptop. </span> <span class="line" data-startTime="1128">That's not just to do with CPU </span><span class="line" data-startTime="1128">versus GPU speed, et cetera. </span> <span class="line" data-startTime="1131">But it has a lot </span><span class="line" data-startTime="1131">to do with the fact </span><span class="line" data-startTime="1132">that Chrome actually will behave </span><span class="line" data-startTime="1132">slightly differently on Android </span><span class="line" data-startTime="1136">than it does on desktop. </span></p>

<p><span class="line" data-startTime="1137">The DPI matters. </span> <span class="line" data-startTime="1138">And all of this is subtle, </span><span class="line" data-startTime="1138">and that's unfortunate, </span><span class="line" data-startTime="1141">but the reality is building </span><span class="line" data-startTime="1141">high performance rendering </span><span class="line" data-startTime="1144">systems is complicated. </span> <span class="line" data-startTime="1145">And you need to test </span><span class="line" data-startTime="1145">on the target devices. </span></p>

<p class="speaker"><span class="line" data-starttime="1147"><span class="speakerName">Nat Duca</span>: So if you </span><span class="line" data-startTime="1147">do hit the fast path, </span><span class="line" data-startTime="1149">you're in a good position. </span><span class="line" data-startTime="1149">We're doing a lot of work to </span><span class="line" data-startTime="1149">make that feel less laggy. </span><span class="line" data-startTime="1152">Chrome has been particularly </span><span class="line" data-startTime="1152">kind of not good at that. </span><span class="line" data-startTime="1155">Notice I didn't say bad. </span></p>

<p class="speaker"><span class="line" data-starttime="1158"><span class="speakerName">Tom Tom Wiltzius</span>: And it's </span><span class="line" data-startTime="1158">gotten a lot better. </span></p>

<p class="speaker"><span class="line" data-starttime="1159"><span class="speakerName">Nat Duca</span>: We're working </span><span class="line" data-startTime="1159">hard to make that better. </span><span class="line" data-startTime="1161">But that is the case </span><span class="line" data-startTime="1161">for native scrolling. </span></p>

<p class="speaker"><span class="line" data-starttime="1163"><span class="speakerName">Tom Tom Wiltzius</span>: Right. </span><span class="line" data-startTime="1164">So what about option B? </span></p>

<p class="speaker"><span class="line" data-starttime="1165"><span class="speakerName">Nat Duca</span>: So OK, </span><span class="line" data-startTime="1165">I'm going to attempt </span><span class="line" data-startTime="1166">to do a little bit </span><span class="line" data-startTime="1166">of footwork here </span><span class="line" data-startTime="1168">to try to say how you </span><span class="line" data-startTime="1168">can make this work. </span> <span class="line" data-startTime="1170">This is really bleeding edge. </span> <span class="line" data-startTime="1172">If you want to do something with </span><span class="line" data-startTime="1172">a touch listener and be smooth, </span><span class="line" data-startTime="1176">you have to do these </span><span class="line" data-startTime="1176">two things &mdash; you </span><span class="line" data-startTime="1178">got to keep all of your </span><span class="line" data-startTime="1178">costs, all of them, </span><span class="line" data-startTime="1181">to less than seven </span><span class="line" data-startTime="1181">milliseconds, and you </span><span class="line" data-startTime="1183">have to avoid foot guns. </span> <span class="line" data-startTime="1185">Push stack on the foot guns and </span><span class="line" data-startTime="1185">talk about why I said seven. </span></p>

<p class="speaker"><span class="line" data-starttime="1187"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah, why not 16? </span></p>

<p class="speaker"><span class="line" data-starttime="1189"><span class="speakerName">Nat Duca</span>: Because I </span><span class="line" data-startTime="1189">felt like it, really. </span><span class="line" data-startTime="1191">OK, we have Chrome running </span><span class="line" data-startTime="1191">and then we have your code. </span><span class="line" data-startTime="1194">And we're sort of </span><span class="line" data-startTime="1194">sharing that system. </span><span class="line" data-startTime="1196">In order to get zero </span><span class="line" data-startTime="1196">latency, we have </span><span class="line" data-startTime="1199">to run your stuff, </span><span class="line" data-startTime="1199">then our stuff, all </span><span class="line" data-startTime="1201">in that 16 millisecond budget. </span><span class="line" data-startTime="1203">And oh, by the way, </span><span class="line" data-startTime="1203">the operating system </span><span class="line" data-startTime="1205">also is there doing stuff. </span></p>

<p class="speaker"><span class="line" data-starttime="1206"><span class="speakerName">Tom Tom Wiltzius</span>: And this </span><span class="line" data-startTime="1206">is the kind of thing </span><span class="line" data-startTime="1208">that you don't generally </span><span class="line" data-startTime="1208">worry about on, say, a laptop, </span><span class="line" data-startTime="1210">because there's enough </span><span class="line" data-startTime="1210">performance overhead that you </span><span class="line" data-startTime="1213">don't really worry </span><span class="line" data-startTime="1213">about what Windows </span><span class="line" data-startTime="1214">is doing in the background. </span><span class="line" data-startTime="1215">But in fact, on most </span><span class="line" data-startTime="1215">modern mobile phones, </span><span class="line" data-startTime="1220">even, they're so </span><span class="line" data-startTime="1220">resource constrained </span><span class="line" data-startTime="1223">that, actually, some system </span><span class="line" data-startTime="1223">thing coming in and running </span><span class="line" data-startTime="1226">can deschedule all of </span><span class="line" data-startTime="1226">the browser's threads, </span><span class="line" data-startTime="1228">and then that crap. </span></p>

<p class="speaker"><span class="line" data-starttime="1230"><span class="speakerName">Nat Duca</span>: So seven. </span><span class="line" data-startTime="1230">Keep that in mind. </span><span class="line" data-startTime="1231">Keep your stuff. </span><span class="line" data-startTime="1232">So this essentially means </span><span class="line" data-startTime="1232">don't paint at the moment. </span><span class="line" data-startTime="1234">Don't paint. </span><span class="line" data-startTime="1235">Don't do heavy JS. </span><span class="line" data-startTime="1236">Do as minimal JS as you can. </span><span class="line" data-startTime="1239">If you've got a </span><span class="line" data-startTime="1239">layout, be very careful </span><span class="line" data-startTime="1241">and avoid recalc style </span><span class="line" data-startTime="1241">if at all possible. </span><span class="line" data-startTime="1244">OK, foot guns. </span><span class="line" data-startTime="1245">So this is another one of </span><span class="line" data-startTime="1245">those laundry slides of, </span><span class="line" data-startTime="1248">like, there's that </span><span class="line" data-startTime="1248">nice theoretical world </span><span class="line" data-startTime="1250">that we talk about. </span></p>

<p class="speaker"><span class="line" data-starttime="1251"><span class="speakerName">Tom Tom Wiltzius</span>: And then </span><span class="line" data-startTime="1251">here's all the caveats. </span> <span class="line" data-startTime="1253">The first one is </span><span class="line" data-startTime="1253">probably the craziest. </span> <span class="line" data-startTime="1256">If you want to do </span><span class="line" data-startTime="1256">this, if you want </span><span class="line" data-startTime="1258">to handle touch events </span><span class="line" data-startTime="1258">yourself in JavaScript, </span><span class="line" data-startTime="1260">that means you need touch </span><span class="line" data-startTime="1260">event listeners, right? </span><span class="line" data-startTime="1262">If you're going to have </span><span class="line" data-startTime="1262">touch event listeners, </span><span class="line" data-startTime="1265">be judicious about when </span><span class="line" data-startTime="1265">and where you install them. </span> <span class="line" data-startTime="1267">Particularly, be wary of </span><span class="line" data-startTime="1267">installing touch listeners </span><span class="line" data-startTime="1272">during the page </span><span class="line" data-startTime="1272">load, or you will </span><span class="line" data-startTime="1274">risk scrolling jank and </span><span class="line" data-startTime="1274">unpredictable delivery </span><span class="line" data-startTime="1278">of those touch events. </span></p>

<p class="speaker"><span class="line" data-starttime="1279"><span class="speakerName">Nat Duca</span>: So we're simplifying </span><span class="line" data-startTime="1279">a very complex message </span><span class="line" data-startTime="1281">with this general rule. </span><span class="line" data-startTime="1283">And we'll come back to it </span><span class="line" data-startTime="1283">later about the details of it. </span><span class="line" data-startTime="1286">But just keep this in mind. </span><span class="line" data-startTime="1287">Big listeners, touch </span><span class="line" data-startTime="1287">listeners, in general, </span><span class="line" data-startTime="1289">have a lot of scary. </span></p>

<p class="speaker"><span class="line" data-starttime="1290"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. </span><span class="line" data-startTime="1292">Touchends. </span><span class="line" data-startTime="1293">I'm going to let you explain </span><span class="line" data-startTime="1293">because this is complicated, </span><span class="line" data-startTime="1295">too. </span></p>

<p class="speaker"><span class="line" data-starttime="1295"><span class="speakerName">Nat Duca</span>: You want me </span><span class="line" data-startTime="1295">to talk about touchends? </span><span class="line" data-startTime="1295">This is also complicated. </span><span class="line" data-startTime="1297">So if you drag your </span><span class="line" data-startTime="1297">finger off a screen, </span><span class="line" data-startTime="1299">do you get a touchend </span><span class="line" data-startTime="1299">or a touchcancel? </span></p>

<p class="speaker"><span class="line" data-starttime="1302"><span class="speakerName">Tom Tom Wiltzius</span>: What? </span></p>

<p class="speaker"><span class="line" data-starttime="1303"><span class="speakerName">Nat Duca</span>: Yeah. </span><span class="line" data-startTime="1303">So there's this </span><span class="line" data-startTime="1303">common set of problems </span><span class="line" data-startTime="1305">where people forget to </span><span class="line" data-startTime="1305">listen to touchcancel, </span><span class="line" data-startTime="1307">and so they get basically really </span><span class="line" data-startTime="1307">weird behavior in the field. </span><span class="line" data-startTime="1309">And they can't figure </span><span class="line" data-startTime="1309">out what's going on. </span><span class="line" data-startTime="1311">They forgot to listen </span><span class="line" data-startTime="1311">to touchcancel. </span><span class="line" data-startTime="1312">It's a minor point, </span><span class="line" data-startTime="1312">but very important </span><span class="line" data-startTime="1314">because people will say </span><span class="line" data-startTime="1314">that you're being janked. </span><span class="line" data-startTime="1316">And the reality is you just </span><span class="line" data-startTime="1316">forgot to get that one event. </span><span class="line" data-startTime="1319">We're so trained to think, mouse </span><span class="line" data-startTime="1319">down, mouse move, mouse up. </span><span class="line" data-startTime="1322">All of us grew up like that, so </span><span class="line" data-startTime="1322">this is a bit of an adaptation. </span></p>

<p class="speaker"><span class="line" data-starttime="1325"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. </span><span class="line" data-startTime="1326">The 300 millisecond </span><span class="line" data-startTime="1326">tap delay has </span><span class="line" data-startTime="1328">been mentioned in other talks </span><span class="line" data-startTime="1328">and will be pounded on more. </span><span class="line" data-startTime="1331">This is to disambiguate between </span><span class="line" data-startTime="1331">double tap to zoom and a click. </span><span class="line" data-startTime="1336">And yes, this is crappy. </span><span class="line" data-startTime="1337">And yes, the </span><span class="line" data-startTime="1337">browser tries to not </span><span class="line" data-startTime="1339">wait if it can determine </span><span class="line" data-startTime="1339">it's impossible to zoom. </span></p>

<p class="speaker"><span class="line" data-starttime="1343"><span class="speakerName">Nat Duca</span>: Set your </span><span class="line" data-startTime="1343">viewport tag correctly </span><span class="line" data-startTime="1345">if you don't care </span><span class="line" data-startTime="1345">about [? the page. ?] </span></p>

<p class="speaker"><span class="line" data-starttime="1346"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah, </span><span class="line" data-startTime="1346">just be careful. </span><span class="line" data-startTime="1347">There's a lot of good content </span><span class="line" data-startTime="1347">online about this one, </span><span class="line" data-startTime="1349">so we won't talk </span><span class="line" data-startTime="1349">about it too much. </span><span class="line" data-startTime="1351">And lastly, mouse wheels. </span><span class="line" data-startTime="1353">Mouse wheels, </span><span class="line" data-startTime="1353">obviously not so much </span><span class="line" data-startTime="1354">relevant on mobile, more </span><span class="line" data-startTime="1354">relevant on desktop platforms. </span><span class="line" data-startTime="1357">But mouse wheel listeners have </span><span class="line" data-startTime="1357">a lot of the same problems </span><span class="line" data-startTime="1359">that touch listeners do. </span><span class="line" data-startTime="1362">So lest you think that this </span><span class="line" data-startTime="1362">is sort of limited to touch. </span><span class="line" data-startTime="1365">In fact, you can shoot yourself </span><span class="line" data-startTime="1365">in the foot with mouse wheel </span><span class="line" data-startTime="1369">listeners, too. </span></p>

<p class="speaker"><span class="line" data-starttime="1369"><span class="speakerName">Nat Duca</span>: And there's </span><span class="line" data-startTime="1369">some major websites </span><span class="line" data-startTime="1370">that actually have </span><span class="line" data-startTime="1370">touch listeners. </span><span class="line" data-startTime="1372">And so they technically could </span><span class="line" data-startTime="1372">hit all these fast paths </span><span class="line" data-startTime="1375">we've been talking </span><span class="line" data-startTime="1375">about about latency, </span><span class="line" data-startTime="1377">except they have a </span><span class="line" data-startTime="1377">mouse wheel listener. </span><span class="line" data-startTime="1378">They don't do anything </span><span class="line" data-startTime="1378">[INAUDIBLE], ironically. </span></p>

<p class="speaker"><span class="line" data-starttime="1380"><span class="speakerName">Tom Tom Wiltzius</span>: Nope. </span><span class="line" data-startTime="1380">Except blog about </span><span class="line" data-startTime="1380">how slow Chrome is. </span></p>

<p class="speaker"><span class="line" data-starttime="1381"><span class="speakerName">Nat Duca</span>: But they've shot </span><span class="line" data-startTime="1381">themselves in the foot, </span><span class="line" data-startTime="1383">and there's nothing </span><span class="line" data-startTime="1383">we can do about. </span></p>

<p class="speaker"><span class="line" data-starttime="1385"><span class="speakerName">Tom Tom Wiltzius</span>: This is </span><span class="line" data-startTime="1385">all specced or de facto </span><span class="line" data-startTime="1389">standard behavior, which </span><span class="line" data-startTime="1389">means that this is not </span><span class="line" data-startTime="1392">going to change. </span></p>

<p class="speaker"><span class="line" data-starttime="1393"><span class="speakerName">Nat Duca</span>: It's a </span><span class="line" data-startTime="1393">wild world out there. </span></p>

<p class="speaker"><span class="line" data-starttime="1394"><span class="speakerName">Tom Tom Wiltzius</span>: It is. </span></p>

<p class="speaker"><span class="line" data-starttime="1395"><span class="speakerName">Nat Duca</span>: Yeah. </span> <span class="line" data-startTime="1396">So remember we started off </span><span class="line" data-startTime="1396">with a video of a janky finger </span><span class="line" data-startTime="1399">moving this thing around. </span> <span class="line" data-startTime="1400">So imagine your </span><span class="line" data-startTime="1400">PM is like, hey, I </span><span class="line" data-startTime="1403">want you to make that logo thing </span><span class="line" data-startTime="1403">draggable because I'm your boss </span><span class="line" data-startTime="1407">and I'm going to make you do it. </span> <span class="line" data-startTime="1408">So you're a good [? dooby ?] </span><span class="line" data-startTime="1408">and you go code it up, right? </span><span class="line" data-startTime="1410">You document .addEventListener </span><span class="line" data-startTime="1410">and touchbegin </span><span class="line" data-startTime="1413">and addEventListener touchmove. </span> <span class="line" data-startTime="1415">And you're like, look, it works. </span> <span class="line" data-startTime="1416">It's awesome. </span> <span class="line" data-startTime="1416">And then you get these </span><span class="line" data-startTime="1416">reports from the field </span><span class="line" data-startTime="1418">and they're like, yo, </span><span class="line" data-startTime="1418">this is really janky. </span> <span class="line" data-startTime="1421">Like, I can't use my page. </span></p>

<p><span class="line" data-startTime="1424">I love that thing, but like, </span><span class="line" data-startTime="1424">you destroyed your page. </span> <span class="line" data-startTime="1427">You go to these </span><span class="line" data-startTime="1427">options in DevTools </span><span class="line" data-startTime="1428">and you show scroll bottlenecks. </span> <span class="line" data-startTime="1430">This is what you'll see on the </span><span class="line" data-startTime="1430">left with a global document </span><span class="line" data-startTime="1433">listener. </span> <span class="line" data-startTime="1434">What's happened is </span><span class="line" data-startTime="1434">you've told Chrome </span><span class="line" data-startTime="1436">that your JavaScript wishes </span><span class="line" data-startTime="1436">to preempt any input received </span><span class="line" data-startTime="1440">by the user right into </span><span class="line" data-startTime="1440">JavaScript all the time. </span> <span class="line" data-startTime="1444">We cannot think about doing </span><span class="line" data-startTime="1444">anything with your input, </span><span class="line" data-startTime="1447">do any sort of fanciness </span><span class="line" data-startTime="1447">that we can do, </span><span class="line" data-startTime="1450">until you say yes or no. </span> <span class="line" data-startTime="1452">Specifically you </span><span class="line" data-startTime="1452">say prevent default </span><span class="line" data-startTime="1453">or fail to prevent </span><span class="line" data-startTime="1453">default that event. </span></p>

<p><span class="line" data-startTime="1456">And so if you're going </span><span class="line" data-startTime="1456">to listen to touch, </span><span class="line" data-startTime="1459">you need to do it on the most </span><span class="line" data-startTime="1459">specific thing you can do. </span> <span class="line" data-startTime="1463">And because of this whole </span><span class="line" data-startTime="1463">prevent defaulting thing, </span><span class="line" data-startTime="1465">remember the thing we </span><span class="line" data-startTime="1465">pushed onto the stack </span><span class="line" data-startTime="1467">earlier about that mysterious </span><span class="line" data-startTime="1467">don't add touch before load? </span><span class="line" data-startTime="1471">It's the same thing. </span> <span class="line" data-startTime="1472">If you have an input handler </span><span class="line" data-startTime="1472">and you've told Chrome </span><span class="line" data-startTime="1475">that, then any time you touch </span><span class="line" data-startTime="1475">the thing that has the handler, </span><span class="line" data-startTime="1480">you get automatic preempt </span><span class="line" data-startTime="1480">over anything we can do. </span> <span class="line" data-startTime="1483">Which means that if the </span><span class="line" data-startTime="1483">browser is busy doing something </span><span class="line" data-startTime="1486">like recalc style, we can't </span><span class="line" data-startTime="1486">do anything in response </span><span class="line" data-startTime="1489">to user input. </span></p>

<p><span class="line" data-startTime="1490">And so you get a jank. </span></p>

<p class="speaker"><span class="line" data-starttime="1491"><span class="speakerName">Tom Tom Wiltzius</span>: That means we </span><span class="line" data-startTime="1491">can't scroll until your touch </span><span class="line" data-startTime="1494">listener runs or we </span><span class="line" data-startTime="1494">timeout and we give up. </span></p>

<p class="speaker"><span class="line" data-starttime="1496"><span class="speakerName">Nat Duca</span>: So be </span><span class="line" data-startTime="1496">very, very careful </span><span class="line" data-startTime="1497">about when and where you </span><span class="line" data-startTime="1497">install these listeners. </span></p>

<p class="speaker"><span class="line" data-starttime="1500"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. </span> <span class="line" data-startTime="1501">Not good. </span> <span class="line" data-startTime="1501">OK, we've only got </span><span class="line" data-startTime="1501">five minutes left, </span><span class="line" data-startTime="1503">and we want to talk through </span><span class="line" data-startTime="1503">a little bit of where we've </span><span class="line" data-startTime="1507">come from in terms of </span><span class="line" data-startTime="1507">the Chrome rendering </span><span class="line" data-startTime="1509">stack and more importantly, </span><span class="line" data-startTime="1509">where we're going. </span> <span class="line" data-startTime="1512">If you've seen us </span><span class="line" data-startTime="1512">give talks before, </span><span class="line" data-startTime="1514">you've probably heard </span><span class="line" data-startTime="1514">us kind of caveat </span><span class="line" data-startTime="1516">some of the differences </span><span class="line" data-startTime="1516">between desktop platforms </span><span class="line" data-startTime="1519">and Android, et cetera. </span> <span class="line" data-startTime="1520">And there are still differences, </span><span class="line" data-startTime="1520">as we mentioned before. </span> <span class="line" data-startTime="1523">But these days, that's </span><span class="line" data-startTime="1523">more about the actual power </span><span class="line" data-startTime="1526">of the device and less about </span><span class="line" data-startTime="1526">the rendering architecture. </span> <span class="line" data-startTime="1529">This is really good </span><span class="line" data-startTime="1529">because it makes </span><span class="line" data-startTime="1531">your lives easier as developers. </span></p>

<p><span class="line" data-startTime="1533">It makes our lives </span><span class="line" data-startTime="1533">easier building Chrome. </span> <span class="line" data-startTime="1535">And the pace of that catch </span><span class="line" data-startTime="1535">up of other platforms </span><span class="line" data-startTime="1538">has accelerated in </span><span class="line" data-startTime="1538">the last year or so. </span></p>

<p class="speaker"><span class="line" data-starttime="1540"><span class="speakerName">Nat Duca</span>: But we have a lot </span><span class="line" data-startTime="1540">of really fancy technology </span><span class="line" data-startTime="1542">that enables us to run </span><span class="line" data-startTime="1542">smoothly on Android. </span> <span class="line" data-startTime="1544">And it's unevenly </span><span class="line" data-startTime="1544">deployed right now. </span> <span class="line" data-startTime="1547">It's a lot better in Chrome 32. </span> <span class="line" data-startTime="1548">Hugely better, but </span><span class="line" data-startTime="1548">it's still not there. </span> <span class="line" data-startTime="1550">So this is why we continue </span><span class="line" data-startTime="1550">to recommend testing </span><span class="line" data-startTime="1553">on all the platforms you intend </span><span class="line" data-startTime="1553">to support, at least for now. </span> <span class="line" data-startTime="1556">At least in terms </span><span class="line" data-startTime="1556">of jank, because </span><span class="line" data-startTime="1558">of these nonuniformities. </span> <span class="line" data-startTime="1559">It's the world we live in. </span></p>

<p class="speaker"><span class="line" data-starttime="1560"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. </span><span class="line" data-startTime="1561">The Android WebView, </span><span class="line" data-startTime="1561">though, is new </span><span class="line" data-startTime="1563">and is further bringing </span><span class="line" data-startTime="1563">everything in line. </span></p>

<p class="speaker"><span class="line" data-starttime="1565"><span class="speakerName">Nat Duca</span>: We wish, though, </span><span class="line" data-startTime="1565">to share some things with you </span><span class="line" data-startTime="1568">because it's not </span><span class="line" data-startTime="1568">also caveat free. </span></p>

<p class="speaker"><span class="line" data-starttime="1570"><span class="speakerName">Tom Tom Wiltzius</span>: List </span><span class="line" data-startTime="1570">of caveats, right. </span></p>

<p class="speaker"><span class="line" data-starttime="1571"><span class="speakerName">Nat Duca</span>: Sorry. </span><span class="line" data-startTime="1574">There is a rich tradition </span><span class="line" data-startTime="1574">on the Android WebView </span><span class="line" data-startTime="1577">to disable hardware </span><span class="line" data-startTime="1577">acceleration. </span><span class="line" data-startTime="1579">There were good reasons for </span><span class="line" data-startTime="1579">this in Android WebView. </span><span class="line" data-startTime="1582">There still are </span><span class="line" data-startTime="1582">some good reasons </span><span class="line" data-startTime="1583">to do this with the </span><span class="line" data-startTime="1583">Chrome-based WebView </span><span class="line" data-startTime="1586">but fewer and different. </span><span class="line" data-startTime="1588">We're not going to explain </span><span class="line" data-startTime="1588">that sort of curvature space </span><span class="line" data-startTime="1591">directly, but the </span><span class="line" data-startTime="1591">thing is, please, </span><span class="line" data-startTime="1593">if you were, in the past, </span><span class="line" data-startTime="1593">disabling acceleration </span><span class="line" data-startTime="1597">on your WebView, please </span><span class="line" data-startTime="1597">revisit that decision. </span><span class="line" data-startTime="1599">Check your content </span><span class="line" data-startTime="1599">out in Chrome WebView. </span><span class="line" data-startTime="1601">See if it's better. </span><span class="line" data-startTime="1604">If it is, Chrome will </span><span class="line" data-startTime="1604">reward you in scores. </span><span class="line" data-startTime="1606">The hardware-based rendering </span><span class="line" data-startTime="1606">is really, really good </span><span class="line" data-startTime="1608">compared to the software one. </span></p>

<p class="speaker"><span class="line" data-starttime="1610"><span class="speakerName">Tom Tom Wiltzius</span>: Another </span><span class="line" data-startTime="1610">important caveat, there </span><span class="line" data-startTime="1612">are differences </span><span class="line" data-startTime="1612">between Chrome itself </span><span class="line" data-startTime="1615">on Android and the WebView. </span> <span class="line" data-startTime="1616">One of the most significant </span><span class="line" data-startTime="1616">is that the DOM size </span><span class="line" data-startTime="1619">matters a lot more. </span> <span class="line" data-startTime="1621">Chrome tries to be smart </span><span class="line" data-startTime="1621">about culling stuff </span><span class="line" data-startTime="1623">that's way away </span><span class="line" data-startTime="1623">from the viewport. </span> <span class="line" data-startTime="1625">But this gets a lot easier </span><span class="line" data-startTime="1625">if the developer just </span><span class="line" data-startTime="1627">says, no, this is </span><span class="line" data-startTime="1627">right out invisible. </span> <span class="line" data-startTime="1631">This is particularly </span><span class="line" data-startTime="1631">relevant to the WebView </span><span class="line" data-startTime="1632">because part of the </span><span class="line" data-startTime="1632">WebView API contract </span><span class="line" data-startTime="1635">is you can ask for </span><span class="line" data-startTime="1635">the whole document. </span> <span class="line" data-startTime="1638">Which means that </span><span class="line" data-startTime="1638">every time we go </span><span class="line" data-startTime="1639">to record things </span><span class="line" data-startTime="1639">to paint later, we </span><span class="line" data-startTime="1642">have to record the </span><span class="line" data-startTime="1642">entire document. </span></p>

<p><span class="line" data-startTime="1643">We can't do any of the </span><span class="line" data-startTime="1643">smartness around culling </span><span class="line" data-startTime="1645">that we're trying to do. </span> <span class="line" data-startTime="1646">This means that we </span><span class="line" data-startTime="1646">incur a lot more memory, </span><span class="line" data-startTime="1648">and so you need to be </span><span class="line" data-startTime="1648">careful about this. </span> <span class="line" data-startTime="1650">So you want to try to </span><span class="line" data-startTime="1650">do your own viewporting, </span><span class="line" data-startTime="1652">if at all possible. </span></p>

<p class="speaker"><span class="line" data-starttime="1653"><span class="speakerName">Nat Duca</span>: Yeah. </span> <span class="line" data-startTime="1653">And this is just </span><span class="line" data-startTime="1653">that basic thing. </span> <span class="line" data-startTime="1655">Maybe someday </span><span class="line" data-startTime="1655">we'll revisit that, </span><span class="line" data-startTime="1657">but please keep it in mind. </span> <span class="line" data-startTime="1658">And just sort of a </span><span class="line" data-startTime="1658">more broad thing, </span><span class="line" data-startTime="1660">jank busting in a WebView </span><span class="line" data-startTime="1660">Android sort of combined app </span><span class="line" data-startTime="1664">means keeping the UI thread </span><span class="line" data-startTime="1664">free for both components. </span> <span class="line" data-startTime="1667">They're sharing the same thread. </span> <span class="line" data-startTime="1669">You've got great tooling to </span><span class="line" data-startTime="1669">show which one's eating time, </span><span class="line" data-startTime="1673">but you got to keep </span><span class="line" data-startTime="1673">an eye on both. </span> <span class="line" data-startTime="1674">There's nothing that we've </span><span class="line" data-startTime="1674">got that protects you </span><span class="line" data-startTime="1676">against janking each other. </span></p>

<p class="speaker"><span class="line" data-starttime="1678"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. </span><span class="line" data-startTime="1679">So where are we going next? </span><span class="line" data-startTime="1681">There are these fast paths, but </span><span class="line" data-startTime="1681">it's hard to get on to them, </span><span class="line" data-startTime="1684">and it's easy to </span><span class="line" data-startTime="1684">fall off of them. </span><span class="line" data-startTime="1685">We think this sucks just </span><span class="line" data-startTime="1685">as much as you guys do. </span><span class="line" data-startTime="1688">And we want to make it </span><span class="line" data-startTime="1688">better through a combination </span><span class="line" data-startTime="1690">of improving Chrome and </span><span class="line" data-startTime="1690">improving Chrome's tooling. </span><span class="line" data-startTime="1693">So about tooling &mdash; </span></p>

<p class="speaker"><span class="line" data-starttime="1694"><span class="speakerName">Nat Duca</span>: Yeah. </span><span class="line" data-startTime="1695">I mean, so you've seen </span><span class="line" data-startTime="1695">a couple little pictures </span><span class="line" data-startTime="1697">like this where we tilt </span><span class="line" data-startTime="1697">the web page to the side. </span><span class="line" data-startTime="1699">We think that these </span><span class="line" data-startTime="1699">things, these questions, </span><span class="line" data-startTime="1702">need to be easily and without </span><span class="line" data-startTime="1702">a lot of thought answerable </span><span class="line" data-startTime="1705">for you all to be </span><span class="line" data-startTime="1705">more productive. </span><span class="line" data-startTime="1708">It should be possible </span><span class="line" data-startTime="1708">to see the layers. </span><span class="line" data-startTime="1709">It should be possible to see why </span><span class="line" data-startTime="1709">something became a layer, why </span><span class="line" data-startTime="1712">something didn't become a layer. </span><span class="line" data-startTime="1714">You should see your </span><span class="line" data-startTime="1714">scroll bottlenecks. </span><span class="line" data-startTime="1715">None of this should be </span><span class="line" data-startTime="1715">so hard as it is now. </span><span class="line" data-startTime="1718">And it certainly shouldn't </span><span class="line" data-startTime="1718">be a soup of check boxes. </span><span class="line" data-startTime="1721">This is coming. </span></p>

<p class="speaker"><span class="line" data-starttime="1722"><span class="speakerName">Tom Tom Wiltzius</span>: It's difficult </span><span class="line" data-startTime="1722">to visually inspect this. </span><span class="line" data-startTime="1723">So we need Richard [INAUDIBLE]. </span></p>

<p class="speaker"><span class="line" data-starttime="1724"><span class="speakerName">Nat Duca</span>: Mr. Paul </span><span class="line" data-startTime="1724">Irish is going </span><span class="line" data-startTime="1725">to be talking about this </span><span class="line" data-startTime="1725">in more detail tomorrow. </span></p>

<p class="speaker"><span class="line" data-starttime="1728"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. </span> <span class="line" data-startTime="1730">Meanwhile, there's a lot that </span><span class="line" data-startTime="1730">we can do behind the scenes </span><span class="line" data-startTime="1732">to keep making Chrome faster. </span> <span class="line" data-startTime="1733">And there's a lot of </span><span class="line" data-startTime="1733">people working on this. </span> <span class="line" data-startTime="1736">We're trying to fix a </span><span class="line" data-startTime="1736">lot of the issues that </span><span class="line" data-startTime="1738">make the slow stages in </span><span class="line" data-startTime="1738">the pipeline so slow. </span> <span class="line" data-startTime="1741">So if you can't just </span><span class="line" data-startTime="1741">express yourself </span><span class="line" data-startTime="1743">in terms of </span><span class="line" data-startTime="1743">compositing operations, </span><span class="line" data-startTime="1745">there are some basic </span><span class="line" data-startTime="1745">changes to layout </span><span class="line" data-startTime="1747">that actually should </span><span class="line" data-startTime="1747">be very cheap, right? </span><span class="line" data-startTime="1748">Why can't you move something </span><span class="line" data-startTime="1748">around with [? top ?] </span><span class="line" data-startTime="1750">if it's absolutely </span><span class="line" data-startTime="1750">positioned and doesn't </span><span class="line" data-startTime="1752">affect anything else? </span><span class="line" data-startTime="1753">In theory, this should work. </span> <span class="line" data-startTime="1755">But Blink is just </span><span class="line" data-startTime="1755">not that smart. </span> <span class="line" data-startTime="1757">And so we're trying to </span><span class="line" data-startTime="1757">sort of improve that. </span></p>

<p><span class="line" data-startTime="1760">And there's a slew of </span><span class="line" data-startTime="1760">things along those lines </span><span class="line" data-startTime="1762">that are just under optimized. </span></p>

<p class="speaker"><span class="line" data-starttime="1763"><span class="speakerName">Nat Duca</span>: And so we're going </span><span class="line" data-startTime="1763">to start thinking about. </span> <span class="line" data-startTime="1766">But in parallel with </span><span class="line" data-startTime="1766">that, we're also </span><span class="line" data-startTime="1767">starting to get out </span><span class="line" data-startTime="1767">of the monofocus </span><span class="line" data-startTime="1771">that we've had for </span><span class="line" data-startTime="1771">the last two years </span><span class="line" data-startTime="1773">to try to just survive </span><span class="line" data-startTime="1773">the transition to mobile. </span> <span class="line" data-startTime="1775">We've been just trying to </span><span class="line" data-startTime="1775">scroll a web page basically, </span><span class="line" data-startTime="1777">and that was hard. </span> <span class="line" data-startTime="1779">Surprisingly hard. </span> <span class="line" data-startTime="1781">We are now getting </span><span class="line" data-startTime="1781">to a point where </span><span class="line" data-startTime="1783">we can contemplate what should </span><span class="line" data-startTime="1783">the mobile web really be </span><span class="line" data-startTime="1787">from a jank perspective. </span> <span class="line" data-startTime="1788">How do you all want to express </span><span class="line" data-startTime="1788">your intent to the browser </span><span class="line" data-startTime="1793">so that we do the right </span><span class="line" data-startTime="1793">thing from the beginning? </span><span class="line" data-startTime="1796">We put up a list of </span><span class="line" data-startTime="1796">intentionally provocative ideas </span><span class="line" data-startTime="1800">here, just to whet </span><span class="line" data-startTime="1800">your appetite. </span> <span class="line" data-startTime="1802">If anybody has other </span><span class="line" data-startTime="1802">ideas, if you've </span><span class="line" data-startTime="1806">got strong opinions about </span><span class="line" data-startTime="1806">one of these, if one of these </span><span class="line" data-startTime="1808">makes you want to </span><span class="line" data-startTime="1808">storm out of the room, </span><span class="line" data-startTime="1809">stay and storm out of the </span><span class="line" data-startTime="1809">room after you tell me </span><span class="line" data-startTime="1811">why you hated it. </span></p>

<p></p>

<p class="speaker"><span class="line" data-starttime="1812"><span class="speakerName">Tom Tom Wiltzius</span>: Yeah. </span><span class="line" data-startTime="1812">We'd love to talk about this. </span></p>

<p class="speaker"><span class="line" data-starttime="1813"><span class="speakerName">Nat Duca</span>: But we want </span><span class="line" data-startTime="1813">to make this better. </span><span class="line" data-startTime="1815">And the reason is, we know </span><span class="line" data-startTime="1815">that it's not good enough. </span><span class="line" data-startTime="1819">And we know that, </span><span class="line" data-startTime="1819">now that we've got </span><span class="line" data-startTime="1821">scrolling sort of </span><span class="line" data-startTime="1821">figured out, we </span><span class="line" data-startTime="1823">need to go and make </span><span class="line" data-startTime="1823">the tools better, </span><span class="line" data-startTime="1825">we need to make this </span><span class="line" data-startTime="1825">more accessible, we need </span><span class="line" data-startTime="1827">to make just jank on the web </span><span class="line" data-startTime="1827">sort of a solved you don't </span><span class="line" data-startTime="1831">think about it problem. </span></p>

<p class="speaker"><span class="line" data-starttime="1833"><span class="speakerName">Tom Tom Wiltzius</span>: That's right. </span><span class="line" data-startTime="1834">So with that, we're </span><span class="line" data-startTime="1834">going to wrap up. </span><span class="line" data-startTime="1835">Thank you very much for </span><span class="line" data-startTime="1835">your time and attention. </span><span class="line" data-startTime="1837">I'm Tom, and this is Nat. </span><span class="line" data-startTime="1839">And thanks again. </span></p>

<p class="speaker"><span class="line" data-starttime="1839"><span class="speakerName">Nat Duca</span>: Cheers. </span><span class="line" data-startTime="1840">[APPLAUSE] </span></p></div>