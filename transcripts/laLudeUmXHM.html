<style>* {font-family: "Open Sans", sans-serif}
a {color: #77aaff}
a.video {border-bottom: 1px solid #ddd; display: block; margin: 0 0 2em 0; padding: 0 0 2em 0}
h2 {color: #444; font-size: 18px;}
span.speakerName {color: black; font-weight: 900;}
body {padding: 2em}
p {color: #444; margin: 0; text-indent: 1.5em;}
p.speaker {margin: 1em 0 0 0; text-indent: 0;}
div#transcript > p:first-child {text-indent: 0;}
</style>

<h1>Google Chrome Extensions: Content Scripts and Isolated Worlds</h1>

<h2></h2>

<a class="video" href="http://youtu.be/laLudeUmXHM">youtu.be/laLudeUmXHM</a><div id="transcript"><p><span class="line" data-startTime="3">Hi, I'm Aaron, a programmer working on the </span><span class="line" data-startTime="3">extension system for Google Chrome. </span> <span class="line" data-startTime="8">One of the most powerful features of our system </span><span class="line" data-startTime="8">is the ability to interact with web pages. </span> <span class="line" data-startTime="12">This is done with a feature called 'content </span><span class="line" data-startTime="12">scripts'. </span> <span class="line" data-startTime="14">Using a content script, an extension developer </span><span class="line" data-startTime="14">can do things like: find unlinked URLs in </span><span class="line" data-startTime="20">web pages and convert them into links, download </span><span class="line" data-startTime="20">all images on a page, or add in-page integration </span><span class="line" data-startTime="25">with a third-party application. </span> <span class="line" data-startTime="25">Content scripts do all of this by interacting </span><span class="line" data-startTime="29">with a web page's Document Object Model, or </span><span class="line" data-startTime="29">its "DOM" for short. </span> <span class="line" data-startTime="33">The DOM is a tree-like data structure that </span><span class="line" data-startTime="33">represents the HTML for a web page. </span></p>

<p><span class="line" data-startTime="37">This is the same API that is used by web developers </span><span class="line" data-startTime="37">today to make modern web applications like </span><span class="line" data-startTime="42">Google Maps. </span> <span class="line" data-startTime="42">With extensions, the DOM for a web page is </span><span class="line" data-startTime="45">shared between the page's JavaScript and each </span><span class="line" data-startTime="45">of the content scripts that is also interacting </span><span class="line" data-startTime="49">with that page. </span> <span class="line" data-startTime="49">Any of the scripts can modify the DOM, for </span><span class="line" data-startTime="52">example by removing a node, and all the scripts </span><span class="line" data-startTime="52">will immediately see the change. </span> <span class="line" data-startTime="57">We want to share the structure of the DOM </span><span class="line" data-startTime="57">between web pages and content scripts, but </span><span class="line" data-startTime="61">it is important for robustness that the scripts </span><span class="line" data-startTime="61">themselves are isolated from each other. </span> <span class="line" data-startTime="66">For example, it should be possible for the </span><span class="line" data-startTime="66">web page to use jQuery v1.2 and the content </span><span class="line" data-startTime="72">script to use jQuery v1.3 without the two </span><span class="line" data-startTime="72">versions of the library accidentally interfering </span><span class="line" data-startTime="77">with each other. </span></p>

<p><span class="line" data-startTime="77">Also, since extensions have access to privileged </span><span class="line" data-startTime="82">APIs and sensitive user data, we need to make </span><span class="line" data-startTime="82">sure that the web page JavaScript cannot use </span><span class="line" data-startTime="87">the shared DOM as a way to get access to those </span><span class="line" data-startTime="87">APIs and that data. </span> <span class="line" data-startTime="91">In Google Chrome, we keep content scripts </span><span class="line" data-startTime="91">isolated from each other and from the pages </span><span class="line" data-startTime="95">they are running on with a system called 'isolated </span><span class="line" data-startTime="95">worlds'. </span> <span class="line" data-startTime="98">Each script that is accessing the DOM runs </span><span class="line" data-startTime="98">in its own isolated world. Each isolated world </span><span class="line" data-startTime="103">gets its own clean JavaScript environment, </span><span class="line" data-startTime="103">which ensures that libraries don't conflict </span><span class="line" data-startTime="107">with each other. </span> <span class="line" data-startTime="107">Many isolated worlds can share access to a </span><span class="line" data-startTime="111">single DOM tree, but when they do, they each </span><span class="line" data-startTime="111">get their own complement of JavaScript objects </span><span class="line" data-startTime="115">to represent the nodes in the tree. </span></p>

<p><span class="line" data-startTime="115">Since no JavaScript objects are shared between </span><span class="line" data-startTime="119">isolated worlds, it is not possible for web </span><span class="line" data-startTime="119">page JavaScript to use the shared DOM to "break </span><span class="line" data-startTime="124">out" of the normal web page sandbox and somehow </span><span class="line" data-startTime="124">get access to the content script or its APIs. </span> <span class="line" data-startTime="129">With content scripts, extension developers </span><span class="line" data-startTime="129">can take full advantage of the familiar DOM </span><span class="line" data-startTime="134">API to manipulate web pages. </span> <span class="line" data-startTime="134">And because of isolated worlds, they can do </span><span class="line" data-startTime="138">this without having to worry about web pages </span><span class="line" data-startTime="138">or other extensions accidentally interfering. </span> <span class="line" data-startTime="142">Learn more on content scripts and the rest </span><span class="line" data-startTime="142">of the Google Chrome extensions system </span><span class="line" data-startTime="146">by visiting our web site at code.google.com/chrome/extensions. </span></p></div>