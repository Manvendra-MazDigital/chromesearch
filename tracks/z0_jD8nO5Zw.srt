1
00:00:00,000 --> 00:00:01,360

2
00:00:01,360 --> 00:00:02,330
PAUL IRISH: Hi, I'm Paul.

3
00:00:02,330 --> 00:00:03,420
PAUL LEWIS: Hi, I'm Paul.

4
00:00:03,420 --> 00:00:05,240
PAUL IRISH: We're going to
be taking a look at the

5
00:00:05,240 --> 00:00:07,250
performance of your sites
and apps that you've

6
00:00:07,250 --> 00:00:08,260
submitted to us.

7
00:00:08,260 --> 00:00:09,400
PAUL LEWIS: Now, we've
taken a very quick

8
00:00:09,400 --> 00:00:10,000
look at some of them.

9
00:00:10,000 --> 00:00:12,120
But we haven't spent that long
doing it, just so that we can

10
00:00:12,120 --> 00:00:14,320
show you how we kind of come
at these things fresh.

11
00:00:14,320 --> 00:00:15,890
PAUL IRISH: So we're going to be
doing an audit of both the

12
00:00:15,890 --> 00:00:16,880
page load time--

13
00:00:16,880 --> 00:00:18,130
PAUL LEWIS: --and
the run time.

14
00:00:18,130 --> 00:00:18,495
PAUL IRISH: And--

15
00:00:18,495 --> 00:00:19,610
PAUL LEWIS: Well, let's
get on with i.

16
00:00:19,610 --> 00:00:20,970
PAUL IRISH: OK, cool.

17
00:00:20,970 --> 00:00:23,870
So these were the sites
that you submitted.

18
00:00:23,870 --> 00:00:27,340
And let's just-- we're going
to just take a few of them.

19
00:00:27,340 --> 00:00:30,760
So the first one to come
up is myunidays.

20
00:00:30,760 --> 00:00:31,560
Uh, Paul.

21
00:00:31,560 --> 00:00:32,049
PAUL LEWIS: Yes?

22
00:00:32,049 --> 00:00:33,630
PAUL IRISH: I know that
you took a look.

23
00:00:33,630 --> 00:00:34,930
And it looked interesting.

24
00:00:34,930 --> 00:00:35,420
PAUL LEWIS: It did.

25
00:00:35,420 --> 00:00:35,790
It did.

26
00:00:35,790 --> 00:00:36,890
PAUL IRISH: Want
to drive this?

27
00:00:36,890 --> 00:00:37,320
PAUL LEWIS: All right.

28
00:00:37,320 --> 00:00:41,240
So step one always for these
things, for me at least, is to

29
00:00:41,240 --> 00:00:43,910
do a timeline.

30
00:00:43,910 --> 00:00:45,170
So go into DevTools.

31
00:00:45,170 --> 00:00:46,520
Hit Timeline.

32
00:00:46,520 --> 00:00:48,100
Go to frames mode.

33
00:00:48,100 --> 00:00:50,560
And you can hit Command
E, which should

34
00:00:50,560 --> 00:00:51,820
start things recording.

35
00:00:51,820 --> 00:00:53,670
And then normally, I'll just
do a bit of a scroll test,

36
00:00:53,670 --> 00:00:55,490
maybe interact with a few
things, just kind of get the

37
00:00:55,490 --> 00:00:56,910
sense of what's going on.

38
00:00:56,910 --> 00:00:59,530
And oh, you've got an unusual
keyboard now.

39
00:00:59,530 --> 00:01:01,380
How do we get back
to-- there we go.

40
00:01:01,380 --> 00:01:01,920
PAUL IRISH: There we go.

41
00:01:01,920 --> 00:01:02,072
PAUL LEWIS: All right.

42
00:01:02,072 --> 00:01:02,720
That's good.

43
00:01:02,720 --> 00:01:03,620
Now um--

44
00:01:03,620 --> 00:01:04,430
PAUL IRISH: So what
do we see here?

45
00:01:04,430 --> 00:01:05,710
PAUL LEWIS: Yeah, so the first
thing that we really, really

46
00:01:05,710 --> 00:01:07,780
care about is the fact that
we've got this 60 frames a

47
00:01:07,780 --> 00:01:10,240
second line and then the 30
frames a second line.

48
00:01:10,240 --> 00:01:11,990
And you can see that that's
on the right hand

49
00:01:11,990 --> 00:01:13,220
side of the top part.

50
00:01:13,220 --> 00:01:16,620
Now we never want our bars to
go above the 60 frames a

51
00:01:16,620 --> 00:01:16,970
second line.

52
00:01:16,970 --> 00:01:18,190
This is kind of super
critical.

53
00:01:18,190 --> 00:01:19,850
If we want a 60 frames a
second app, which we

54
00:01:19,850 --> 00:01:21,520
do, never go above.

55
00:01:21,520 --> 00:01:23,760
Now you can see, we are
obviously going way above on

56
00:01:23,760 --> 00:01:24,750
some of these.

57
00:01:24,750 --> 00:01:28,850
So just by clicking in the
timeline, you start to figure

58
00:01:28,850 --> 00:01:30,470
out what's actually going on.

59
00:01:30,470 --> 00:01:33,060
Now this is the thing that
really started to bother me,

60
00:01:33,060 --> 00:01:35,215
which is this little exclamation
mark what you can

61
00:01:35,215 --> 00:01:37,050
see on the left hand side.

62
00:01:37,050 --> 00:01:38,850
So if we spin this--

63
00:01:38,850 --> 00:01:39,155
oh.

64
00:01:39,155 --> 00:01:40,170
PAUL IRISH: Just click
around here.

65
00:01:40,170 --> 00:01:40,470
There you go.

66
00:01:40,470 --> 00:01:40,870
PAUL LEWIS: OK.

67
00:01:40,870 --> 00:01:42,100
Spin this down.

68
00:01:42,100 --> 00:01:44,520
You can see that we get
some recalc style,

69
00:01:44,520 --> 00:01:46,200
and we get some layout.

70
00:01:46,200 --> 00:01:48,110
And you can see that there's
this little exclamation mark

71
00:01:48,110 --> 00:01:49,340
on the left hand side.

72
00:01:49,340 --> 00:01:52,000
And that's basically-- when you
roll over the exclamation

73
00:01:52,000 --> 00:01:54,635
mark, you see this note. "Forced
synchronous layout is

74
00:01:54,635 --> 00:01:56,650
a possible performance
bottleneck."

75
00:01:56,650 --> 00:02:00,140
Now what's really happening here
is we've forced Chrome to

76
00:02:00,140 --> 00:02:02,490
answer a question about the
dimension or the position of

77
00:02:02,490 --> 00:02:05,280
an element when it wasn't
really expecting to.

78
00:02:05,280 --> 00:02:08,330
So it has to go off, and it has
to lay out a whole of the

79
00:02:08,330 --> 00:02:10,570
page-- probably, in this case--
plus the partial scope.

80
00:02:10,570 --> 00:02:12,895
So not the whole page, but it
still had to do some work that

81
00:02:12,895 --> 00:02:14,680
it didn't expect to
do in layout.

82
00:02:14,680 --> 00:02:17,050
Then the next we're actually
going to do is probably change

83
00:02:17,050 --> 00:02:18,670
some style, recalculate.

84
00:02:18,670 --> 00:02:21,270
Recalculate style suggests that
we then change things.

85
00:02:21,270 --> 00:02:24,060
And that invalidated the
previous calculation we did.

86
00:02:24,060 --> 00:02:25,160
So then we lay out against.

87
00:02:25,160 --> 00:02:27,010
So this is called layout
thrashing.

88
00:02:27,010 --> 00:02:29,390
And it's this idea of stepping
back and forth, going layout,

89
00:02:29,390 --> 00:02:31,100
change some styles, layout,
change some styles.

90
00:02:31,100 --> 00:02:32,130
PAUL IRISH: You'll see it--

91
00:02:32,130 --> 00:02:35,730
it'll commonly-- in the
DevTools, it'll visualize as a

92
00:02:35,730 --> 00:02:39,010
number of just purple bars,
just a big kind

93
00:02:39,010 --> 00:02:41,200
of cascade of purple.

94
00:02:41,200 --> 00:02:43,170
Often-- and on the left hand
side, you'll see a kind of

95
00:02:43,170 --> 00:02:44,640
recalc val layout going
back and forth.

96
00:02:44,640 --> 00:02:47,190
And hopefully, this little arrow
indicating that yeah,

97
00:02:47,190 --> 00:02:48,000
this is a problem.

98
00:02:48,000 --> 00:02:49,880
PAUL LEWIS: Now, don't be
confused by the fact that it's

99
00:02:49,880 --> 00:02:51,450
often wrapped in a yellow bar.

100
00:02:51,450 --> 00:02:52,900
It's triggered by JavaScript.

101
00:02:52,900 --> 00:02:54,500
But it's not JavaScript.

102
00:02:54,500 --> 00:02:55,320
Right?

103
00:02:55,320 --> 00:02:55,870
PAUL IRISH: Right.

104
00:02:55,870 --> 00:02:57,750
PAUL LEWIS: It can be triggered
by CSS as well.

105
00:02:57,750 --> 00:03:01,670
But it's the fact that when
it was in here, it was

106
00:03:01,670 --> 00:03:02,665
triggered--

107
00:03:02,665 --> 00:03:03,986
wherever it was.

108
00:03:03,986 --> 00:03:04,920
I forget now.

109
00:03:04,920 --> 00:03:07,820
PAUL IRISH: So next, what we can
do is we can take a look

110
00:03:07,820 --> 00:03:09,590
at the actual code
of what happens.

111
00:03:09,590 --> 00:03:11,450
So we have a few options
for doing this.

112
00:03:11,450 --> 00:03:14,900
We can just click ahead in right
here on the link for all

113
00:03:14,900 --> 00:03:17,420
JS line number 21.

114
00:03:17,420 --> 00:03:19,080
So let's do that.

115
00:03:19,080 --> 00:03:20,720
OK.

116
00:03:20,720 --> 00:03:23,260
So line number 21 is
the remainder of

117
00:03:23,260 --> 00:03:25,320
the minified jQuery.

118
00:03:25,320 --> 00:03:28,625
So we'll use the prettify
function down here.

119
00:03:28,625 --> 00:03:30,150
[HUMMING]

120
00:03:30,150 --> 00:03:32,140
All right.

121
00:03:32,140 --> 00:03:34,120
Now come back.

122
00:03:34,120 --> 00:03:37,405
And so what we'll see--

123
00:03:37,405 --> 00:03:41,030
let's take a look
at this again.

124
00:03:41,030 --> 00:03:42,350
Oh, no.

125
00:03:42,350 --> 00:03:45,740
I'm going to record
another timeline.

126
00:03:45,740 --> 00:03:47,070
I'll just scroll like this.

127
00:03:47,070 --> 00:03:48,950
PAUL LEWIS: Yeah, yeah.

128
00:03:48,950 --> 00:03:54,780
PAUL IRISH: Come back over, pick
a long frame, go inside.

129
00:03:54,780 --> 00:03:55,953
PAUL LEWIS: Still doesn't
like a bit-- does

130
00:03:55,953 --> 00:03:57,420
the stack trace change?

131
00:03:57,420 --> 00:03:58,920
PAUL IRISH: No.

132
00:03:58,920 --> 00:03:59,860
What?

133
00:03:59,860 --> 00:04:02,040
Chrome Canary.

134
00:04:02,040 --> 00:04:04,010
Come on!

135
00:04:04,010 --> 00:04:04,500
PAUL LEWIS: All right.

136
00:04:04,500 --> 00:04:06,500
PAUL IRISH: So what I'd
like to see is--

137
00:04:06,500 --> 00:04:09,240
what you'll normally catch in
this case is-- you'll catch an

138
00:04:09,240 --> 00:04:15,010
instance where the pretty print
will adjust all the line

139
00:04:15,010 --> 00:04:17,370
numbers for the entire
call stack.

140
00:04:17,370 --> 00:04:19,450
This means that after your
pretty print, you can dive

141
00:04:19,450 --> 00:04:23,170
into the original location more
or less and figure out

142
00:04:23,170 --> 00:04:24,050
what the story is.

143
00:04:24,050 --> 00:04:29,060
But the interesting part here is
that we're going to be able

144
00:04:29,060 --> 00:04:32,920
to not only see kind of where
this came-- so let's try it

145
00:04:32,920 --> 00:04:38,290
once more, pretty print, and
come back to timeline.

146
00:04:38,290 --> 00:04:39,190
PAUL LEWIS: Hey!

147
00:04:39,190 --> 00:04:40,270
So this is stable.

148
00:04:40,270 --> 00:04:42,160
He switched to Stable, in case
you didn't notice that.

149
00:04:42,160 --> 00:04:43,595
PAUL IRISH: Yeah, yeah,
Chrome Stable.

150
00:04:43,595 --> 00:04:43,880
All right.

151
00:04:43,880 --> 00:04:47,110
So now we have a line
number of 3835.

152
00:04:47,110 --> 00:04:50,410
So if we click through
on this--

153
00:04:50,410 --> 00:04:52,560
so we're inside of jQuery.

154
00:04:52,560 --> 00:04:52,910
PAUL LEWIS: What do you know?

155
00:04:52,910 --> 00:04:54,860
Offset width, offset height.

156
00:04:54,860 --> 00:04:57,300
These are kind of classic
candidates for something--

157
00:04:57,300 --> 00:05:00,250
obviously, this is something
that jQuery is using, which is

158
00:05:00,250 --> 00:05:01,490
perfectly reasonable to use.

159
00:05:01,490 --> 00:05:02,470
But it's something that--

160
00:05:02,470 --> 00:05:04,940
when you ask for the offset
width or the offset height,

161
00:05:04,940 --> 00:05:06,140
Chrome's going to have
to go off and

162
00:05:06,140 --> 00:05:06,945
figure out the for that.

163
00:05:06,945 --> 00:05:07,290
Right?

164
00:05:07,290 --> 00:05:07,930
PAUL IRISH: Right.

165
00:05:07,930 --> 00:05:10,720
And so if we want to figure out
why this happened, we can

166
00:05:10,720 --> 00:05:12,420
look at the call stack
of this layout.

167
00:05:12,420 --> 00:05:15,360
And so typically, what you're
going to be looking at is this

168
00:05:15,360 --> 00:05:16,700
Layout Forced section
down here.

169
00:05:16,700 --> 00:05:20,746
Now this is the location that
forced that layout.

170
00:05:20,746 --> 00:05:23,810
In our case, it is that offset
width, offset height.

171
00:05:23,810 --> 00:05:25,400
But we can walk back
to call stack.

172
00:05:25,400 --> 00:05:26,890
See, we're inside jQuery,
jQuery, jQuery.

173
00:05:26,890 --> 00:05:30,050
But we get back to here,
Get Size Info.

174
00:05:30,050 --> 00:05:35,530
Here on Get Size Info, we're
able to basically--

175
00:05:35,530 --> 00:05:36,520
whoops.

176
00:05:36,520 --> 00:05:38,320
Let me try that again.

177
00:05:38,320 --> 00:05:39,710
I just want to make sure that
this is big enough for

178
00:05:39,710 --> 00:05:42,350
everyone to see.

179
00:05:42,350 --> 00:05:44,440
How about--

180
00:05:44,440 --> 00:05:45,340
there we go.

181
00:05:45,340 --> 00:05:45,790
PAUL LEWIS: How are
we doing now?

182
00:05:45,790 --> 00:05:46,030
PAUL IRISH: There we go.

183
00:05:46,030 --> 00:05:46,710
Looking good.

184
00:05:46,710 --> 00:05:47,080
PAUL LEWIS: Yeah.

185
00:05:47,080 --> 00:05:47,450
PAUL IRISH: All right.

186
00:05:47,450 --> 00:05:50,000
So Get Size Info, don't
think it's jQuery.

187
00:05:50,000 --> 00:05:53,476
I'll click over to it in here.

188
00:05:53,476 --> 00:05:54,210
All right.

189
00:05:54,210 --> 00:05:56,690
So Get Size Info, we get
the view port width.

190
00:05:56,690 --> 00:05:57,740
We grab the wrapper.

191
00:05:57,740 --> 00:06:00,100
We walk up its parent
chain twice.

192
00:06:00,100 --> 00:06:02,000
And we get the width
of that parent.

193
00:06:02,000 --> 00:06:06,570
And so it looks like Get Size
Info is actually being called

194
00:06:06,570 --> 00:06:09,660
inside of tick.

195
00:06:09,660 --> 00:06:15,820
And tick is being called
how often?

196
00:06:15,820 --> 00:06:18,030
PAUL LEWIS: Every two
seconds, maybe.

197
00:06:18,030 --> 00:06:20,530
Maybe more.

198
00:06:20,530 --> 00:06:22,490
2,000, there we go.

199
00:06:22,490 --> 00:06:23,520
PAUL IRISH: Every two seconds.

200
00:06:23,520 --> 00:06:24,770
So that's--

201
00:06:24,770 --> 00:06:25,380
[INAUDIBLE] intervals.

202
00:06:25,380 --> 00:06:27,590
PAUL LEWIS: Because we figured
this-- is this part of the

203
00:06:27,590 --> 00:06:29,710
carousel or something
like that?

204
00:06:29,710 --> 00:06:30,560
Do we know?

205
00:06:30,560 --> 00:06:32,730
PAUL IRISH: Yeah, scroll
up a little bit.

206
00:06:32,730 --> 00:06:34,520
I think--

207
00:06:34,520 --> 00:06:36,530
PAUL LEWIS: There we go,
function carousel.

208
00:06:36,530 --> 00:06:37,890
So there's a carousel
on this site

209
00:06:37,890 --> 00:06:39,830
ticking every two seconds.

210
00:06:39,830 --> 00:06:42,980
It's kind of going into layout
thrashing for whatever reason.

211
00:06:42,980 --> 00:06:44,120
Yeah, it's probably that one.

212
00:06:44,120 --> 00:06:45,250
PAUL IRISH: There are a
few carousels there.

213
00:06:45,250 --> 00:06:45,860
PAUL LEWIS: OK, there
are a few carousels.

214
00:06:45,860 --> 00:06:46,430
OK.

215
00:06:46,430 --> 00:06:48,500
So it's probably several
carousels

216
00:06:48,500 --> 00:06:49,080
that are causing this.

217
00:06:49,080 --> 00:06:53,320
So you're always probably in
some kind of recalc layout

218
00:06:53,320 --> 00:06:57,360
thrashing kind of mode at
some points or other.

219
00:06:57,360 --> 00:06:58,010
PAUL IRISH: Right.

220
00:06:58,010 --> 00:06:59,980
In this case, there
are a few options.

221
00:06:59,980 --> 00:07:03,150
It's likely that actually the
width of that parent parent

222
00:07:03,150 --> 00:07:05,330
probably isn't going
to be changing.

223
00:07:05,330 --> 00:07:08,200
You can-- so if you're seeing
this, and you want to avoid

224
00:07:08,200 --> 00:07:10,230
this time spent layout
thrashing, you want to be able

225
00:07:10,230 --> 00:07:11,990
to cache these values,
hold on to them.

226
00:07:11,990 --> 00:07:15,610
So you don't need to go back and
re-query the DOM while the

227
00:07:15,610 --> 00:07:18,370
browser is trying to paint
updates to the user.

228
00:07:18,370 --> 00:07:20,270
You want to just let
it paint updates.

229
00:07:20,270 --> 00:07:22,440
And so give it all the
truth ahead of time.

230
00:07:22,440 --> 00:07:25,570
PAUL LEWIS: If it is a
responsive site, then you

231
00:07:25,570 --> 00:07:27,580
probably want to do it in things
like the resize handler

232
00:07:27,580 --> 00:07:29,975
or something like that, just
somewhere where you can

233
00:07:29,975 --> 00:07:32,350
actually say, look, I'm only
carrying when you actually

234
00:07:32,350 --> 00:07:33,930
definitely resize this stuff.

235
00:07:33,930 --> 00:07:34,960
PAUL IRISH: So I
would disagree.

236
00:07:34,960 --> 00:07:36,470
PAUL LEWIS: Ooh, where
would you put it?

237
00:07:36,470 --> 00:07:36,860
PAUL IRISH: [LAUGHS]

238
00:07:36,860 --> 00:07:36,960
PAUL LEWIS: That's fine.

239
00:07:36,960 --> 00:07:37,980
What'd you do it in? rAF?

240
00:07:37,980 --> 00:07:38,500
PAUL IRISH: I did it in rAF.

241
00:07:38,500 --> 00:07:39,220
PAUL LEWIS: OK, he's
just doing it--

242
00:07:39,220 --> 00:07:40,380
OK, fair enough.

243
00:07:40,380 --> 00:07:42,900
Do the [INAUDIBLE] and just set
a rAF inside your resize

244
00:07:42,900 --> 00:07:45,360
handler, at which point
you'll pick up the--

245
00:07:45,360 --> 00:07:46,000
PAUL IRISH:
requestAnimationFrame.

246
00:07:46,000 --> 00:07:47,850
PAUL LEWIS: Yeah.

247
00:07:47,850 --> 00:07:48,475
That's fine.

248
00:07:48,475 --> 00:07:50,370
PAUL IRISH: So actually,
I want to

249
00:07:50,370 --> 00:07:51,990
spend a moment on this.

250
00:07:51,990 --> 00:07:54,840
Resize events.

251
00:07:54,840 --> 00:07:57,000
There's only a few things that
you should ever do inside of a

252
00:07:57,000 --> 00:07:59,300
resize event or a
scroll event.

253
00:07:59,300 --> 00:08:00,550
Let's take scroll because
it's a little bit more

254
00:08:00,550 --> 00:08:02,370
common of an example.

255
00:08:02,370 --> 00:08:09,300
Inside a scroll event, you can
ask for, let's say, get the

256
00:08:09,300 --> 00:08:11,120
scroll top, the scroll
top metric.

257
00:08:11,120 --> 00:08:16,100
You ca also ask for the
time, probably.

258
00:08:16,100 --> 00:08:16,900
And that's about it.

259
00:08:16,900 --> 00:08:20,620
You do not want to do any other
work inside the handler.

260
00:08:20,620 --> 00:08:22,750
So minimizing the amount of work
that you're doing in the

261
00:08:22,750 --> 00:08:27,990
handler, do the work that you
actually have to do inside of

262
00:08:27,990 --> 00:08:29,090
requestAnimationFrame.

263
00:08:29,090 --> 00:08:30,780
So that's where you're going
to do your work.

264
00:08:30,780 --> 00:08:32,880
And what this allows the
browser to do is--

265
00:08:32,880 --> 00:08:34,130
it gets out of scroll.

266
00:08:34,130 --> 00:08:37,299
When you bind a scroll, what it
means is that when a person

267
00:08:37,299 --> 00:08:42,230
puts their finger down on the
site, on your site, and

268
00:08:42,230 --> 00:08:45,620
scrolls the page like that,
everything that you have bound

269
00:08:45,620 --> 00:08:47,040
to a scroll handler means--

270
00:08:47,040 --> 00:08:53,030
it has to execute that before it
can even update the page to

271
00:08:53,030 --> 00:08:55,770
scroll it, reacting to
that finger move.

272
00:08:55,770 --> 00:08:57,250
PAUL LEWIS: The other thing
is you might actually get

273
00:08:57,250 --> 00:08:59,540
multiple scroll events
per frame.

274
00:08:59,540 --> 00:08:59,780
Right?

275
00:08:59,780 --> 00:09:02,140
So if you're doing work in the--
you only probably care

276
00:09:02,140 --> 00:09:03,030
about the last one.

277
00:09:03,030 --> 00:09:03,365
Right?

278
00:09:03,365 --> 00:09:03,700
PAUL IRISH: Right.

279
00:09:03,700 --> 00:09:04,790
PAUL LEWIS: And the other things
you want to do is if

280
00:09:04,790 --> 00:09:05,910
you do this debouncing--

281
00:09:05,910 --> 00:09:08,290
which is what it's often
referred to as--

282
00:09:08,290 --> 00:09:10,230
you want to make sure that you
don't shed your multiple

283
00:09:10,230 --> 00:09:11,890
requestAnimaitonFrame
call backs.

284
00:09:11,890 --> 00:09:13,530
So you want to make
sure that--

285
00:09:13,530 --> 00:09:16,010
however many scrolls you've got,
you just say, look, just

286
00:09:16,010 --> 00:09:18,780
set requestAnimaitonFrame call
back, store the value.

287
00:09:18,780 --> 00:09:19,080
OK?

288
00:09:19,080 --> 00:09:20,925
And then inside that
requestAnimationFrame call

289
00:09:20,925 --> 00:09:22,840
back, you say, well, what was
the most recent value?

290
00:09:22,840 --> 00:09:25,660
Now do my visual updates and
paint to the screen.

291
00:09:25,660 --> 00:09:26,800
PAUL IRISH: This is something
that's really important if

292
00:09:26,800 --> 00:09:28,980
you're doing any sort of
scrolling parallax site.

293
00:09:28,980 --> 00:09:30,620
There are a few parallax
scripts that

294
00:09:30,620 --> 00:09:32,010
do this exact technique.

295
00:09:32,010 --> 00:09:34,450
Stellar.js, I know
is one of them.

296
00:09:34,450 --> 00:09:35,870
But this is something to
watch out for, to make

297
00:09:35,870 --> 00:09:36,600
sure that you do.

298
00:09:36,600 --> 00:09:39,030
Otherwise, the performance of
the scrolling in the parallax

299
00:09:39,030 --> 00:09:42,080
is going to be really poor.

300
00:09:42,080 --> 00:09:42,620
They can get bad.

301
00:09:42,620 --> 00:09:42,970
PAUL LEWIS: Yeah.

302
00:09:42,970 --> 00:09:43,790
Shall we roll on?

303
00:09:43,790 --> 00:09:45,064
PAUL IRISH: Yeah, let's
take a look.

304
00:09:45,064 --> 00:09:45,950
PAUL LEWIS: All right.

305
00:09:45,950 --> 00:09:46,320
PAUL IRISH: All right.

306
00:09:46,320 --> 00:09:49,080
So I've got a few more here.

307
00:09:49,080 --> 00:09:50,670
There's one up here at the
top I want to take

308
00:09:50,670 --> 00:09:51,500
a quick look at.

309
00:09:51,500 --> 00:09:52,580
So this Voos.

310
00:09:52,580 --> 00:09:54,910
It is a big, big
Wordpress site.

311
00:09:54,910 --> 00:09:57,180
They are using mod_pagespeed
already.

312
00:09:57,180 --> 00:09:58,860
Awesome.

313
00:09:58,860 --> 00:10:01,250
What else can we do?

314
00:10:01,250 --> 00:10:04,420
So I opened this up earlier.

315
00:10:04,420 --> 00:10:05,970
It's taking a while right now.

316
00:10:05,970 --> 00:10:08,960
Actually, the domain was
br.staticcontent.

317
00:10:08,960 --> 00:10:10,570
So I think actually--
we're in London.

318
00:10:10,570 --> 00:10:12,820
It's coming over the
wire from Brazil.

319
00:10:12,820 --> 00:10:15,590
So transfer time is going
to take a while.

320
00:10:15,590 --> 00:10:18,560
CDN would help for us, but
not help for Brazilians.

321
00:10:18,560 --> 00:10:19,880
So all right.

322
00:10:19,880 --> 00:10:24,470
So it's a pretty basic
site here.

323
00:10:24,470 --> 00:10:29,040
So other than going into the
interaction speed of these

324
00:10:29,040 --> 00:10:30,870
form controls--

325
00:10:30,870 --> 00:10:33,120
but I thought it would be
interesting to look at it from

326
00:10:33,120 --> 00:10:34,490
a network perspective.

327
00:10:34,490 --> 00:10:36,930
So I went to a WebPagetest just

328
00:10:36,930 --> 00:10:38,460
before I started recording.

329
00:10:38,460 --> 00:10:39,660
A I dropped Voos in here.

330
00:10:39,660 --> 00:10:42,470
And WebPagetest usually
only takes a few.

331
00:10:42,470 --> 00:10:44,050
Minutes

332
00:10:44,050 --> 00:10:45,440
PAUL LEWIS: But you changed
the location, right?

333
00:10:45,440 --> 00:10:46,190
For up to--

334
00:10:46,190 --> 00:10:46,850
PAUL IRISH: Oh, I did, yeah.

335
00:10:46,850 --> 00:10:50,570
So you can actually just say
in here what the test

336
00:10:50,570 --> 00:10:51,600
location should be.

337
00:10:51,600 --> 00:10:54,010
And there's locations
all over the globe.

338
00:10:54,010 --> 00:10:57,520
So if you want to get kind of a
real world, over the network

339
00:10:57,520 --> 00:10:58,130
experience--

340
00:10:58,130 --> 00:10:59,990
PAUL LEWIS: So you set it to
Buenos Aires, so Argentina,

341
00:10:59,990 --> 00:11:01,080
which is not so far away.

342
00:11:01,080 --> 00:11:02,490
It's still in South America.

343
00:11:02,490 --> 00:11:02,850
PAUL IRISH: Yeah.

344
00:11:02,850 --> 00:11:03,265
PAUL LEWIS: OK.

345
00:11:03,265 --> 00:11:04,410
So it's a little bit nearer.

346
00:11:04,410 --> 00:11:08,370
So it's not skewed by our
London-ness right now.

347
00:11:08,370 --> 00:11:09,730
PAUL IRISH: Yes, yes, yes.

348
00:11:09,730 --> 00:11:11,380
So this is the report.

349
00:11:11,380 --> 00:11:13,810
And so WebPagetest is going
to give us a lot of data.

350
00:11:13,810 --> 00:11:18,210
And one of the most important
things is the waterfall.

351
00:11:18,210 --> 00:11:19,560
I'll show right after it.

352
00:11:19,560 --> 00:11:20,220
This is the connection view.

353
00:11:20,220 --> 00:11:22,210
This is pretty rad.

354
00:11:22,210 --> 00:11:24,410
So you'll have--

355
00:11:24,410 --> 00:11:25,880
so it looks at TCP
connections.

356
00:11:25,880 --> 00:11:29,240
Sometimes a browser will share
the same TCP pipe.

357
00:11:29,240 --> 00:11:35,290
So actually it requested a
JavaScript file on a single

358
00:11:35,290 --> 00:11:37,960
connection and then another
JavaScript file to share in

359
00:11:37,960 --> 00:11:39,310
the exact same one.

360
00:11:39,310 --> 00:11:41,190
This can be helpful sometimes.

361
00:11:41,190 --> 00:11:44,950
But a lot of time, what you're
looking at is the waterfall.

362
00:11:44,950 --> 00:11:48,680
Now, so this at the very
top is just the

363
00:11:48,680 --> 00:11:50,190
HTML that comes in.

364
00:11:50,190 --> 00:11:51,330
You can see we're
taking a while.

365
00:11:51,330 --> 00:11:52,760
We're waiting on the server.

366
00:11:52,760 --> 00:11:56,100
But then it's downloading
here.

367
00:11:56,100 --> 00:11:59,030
But what I notice immediately
is I noticed a lot of

368
00:11:59,030 --> 00:12:00,500
JavaScript up at the top.

369
00:12:00,500 --> 00:12:03,830
So search box helper, functions,
jQuery, jQuery

370
00:12:03,830 --> 00:12:05,650
templating plug-in.

371
00:12:05,650 --> 00:12:07,600
And since these are
up at the top--

372
00:12:07,600 --> 00:12:09,170
PAUL LEWIS: Yeah, because
you'd expect--

373
00:12:09,170 --> 00:12:11,360
if this was in flow, you'd
expect all the images,

374
00:12:11,360 --> 00:12:11,990
everything else.

375
00:12:11,990 --> 00:12:14,440
And then best practice is
JavaScript at the end, right?

376
00:12:14,440 --> 00:12:15,206
PAUL IRISH: Yes.

377
00:12:15,206 --> 00:12:16,260
So let's take a look.

378
00:12:16,260 --> 00:12:17,300
So we hop over.

379
00:12:17,300 --> 00:12:19,772
We view source.

380
00:12:19,772 --> 00:12:21,490
[HUMMING]

381
00:12:21,490 --> 00:12:24,960
Find, I like just
bracket script.

382
00:12:24,960 --> 00:12:28,700
PAUL LEWIS: Make it bigger
for everybody.

383
00:12:28,700 --> 00:12:30,170
PAUL IRISH: Here we go.

384
00:12:30,170 --> 00:12:31,790
Actually, the most
important thing--

385
00:12:31,790 --> 00:12:33,470
it's probably hard to see.

386
00:12:33,470 --> 00:12:36,420
But way over here on the right
is the scroll bar.

387
00:12:36,420 --> 00:12:38,790
And you can see, there's a lot
of matches in my scroll bar in

388
00:12:38,790 --> 00:12:41,200
the very top right, whereas
there's not matches at the

389
00:12:41,200 --> 00:12:43,650
bottom as much.

390
00:12:43,650 --> 00:12:47,510
But so if we look up here on
the top, you can see, yup.

391
00:12:47,510 --> 00:12:49,820
Here's all the scripts
in the head.

392
00:12:49,820 --> 00:12:53,280
And so we have jQuery and then
templating plug-in, base, all

393
00:12:53,280 --> 00:12:55,480
these things.

394
00:12:55,480 --> 00:13:00,440
So a browser is going to have
to request and complete

395
00:13:00,440 --> 00:13:06,760
execution of all of these files
before it even starts to

396
00:13:06,760 --> 00:13:09,880
show this sort of content
to a user.

397
00:13:09,880 --> 00:13:11,830
That's just how it works.

398
00:13:11,830 --> 00:13:14,720
This could be mitigated
potentially with async

399
00:13:14,720 --> 00:13:17,100
attribute up here.

400
00:13:17,100 --> 00:13:20,310
But generally, the best practice
is to throw all the

401
00:13:20,310 --> 00:13:21,730
scripts at the bottom,
of course.

402
00:13:21,730 --> 00:13:25,260
Concat as much as you can.

403
00:13:25,260 --> 00:13:27,280
So that is the obvious
thing that I see

404
00:13:27,280 --> 00:13:28,740
from WebPagetest waterfall.

405
00:13:28,740 --> 00:13:31,890

406
00:13:31,890 --> 00:13:32,390
Anything else?

407
00:13:32,390 --> 00:13:36,090
It looks like there's flag
images that are sprited.

408
00:13:36,090 --> 00:13:37,420
PAUL LEWIS: That's usually
a good thing.

409
00:13:37,420 --> 00:13:38,740
PAUL IRISH: Good thing.

410
00:13:38,740 --> 00:13:41,850
So the comment actually says
that mod_pagespeed is enabled.

411
00:13:41,850 --> 00:13:46,480
mod_pagespeed by default is
actually not too aggressive.

412
00:13:46,480 --> 00:13:50,710
So I would take a look at
configuring a few more filters

413
00:13:50,710 --> 00:13:52,120
to be turned on by default.

414
00:13:52,120 --> 00:13:57,340
One of my favorites
is around images.

415
00:13:57,340 --> 00:14:01,210
There is a lot of
images of stuff.

416
00:14:01,210 --> 00:14:01,770
But yeah.

417
00:14:01,770 --> 00:14:02,650
Here, this one at the top.

418
00:14:02,650 --> 00:14:04,390
This is rewrite_images.

419
00:14:04,390 --> 00:14:07,010
So mod_pagespeed is a module for
Apache, also available for

420
00:14:07,010 --> 00:14:09,920
EngineX, which is rad.

421
00:14:09,920 --> 00:14:12,040
This rewrite_images
does a few things.

422
00:14:12,040 --> 00:14:13,290
It in-lines images.

423
00:14:13,290 --> 00:14:15,530
So if an image is under some
threshold, it'll just do it as

424
00:14:15,530 --> 00:14:16,340
a data URI.

425
00:14:16,340 --> 00:14:18,260
PAUL LEWIS: So we've now
removed the additional

426
00:14:18,260 --> 00:14:19,010
request, right?

427
00:14:19,010 --> 00:14:20,050
PAUL IRISH: Yup, absolutely.

428
00:14:20,050 --> 00:14:23,150
It'll recompress images,
losslessly recompress them to

429
00:14:23,150 --> 00:14:26,010
be even smaller than
they should be.

430
00:14:26,010 --> 00:14:27,180
PAUL LEWIS: How does
it do that?

431
00:14:27,180 --> 00:14:28,820
PAUL IRISH: Sorry.

432
00:14:28,820 --> 00:14:29,640
Losslessly--

433
00:14:29,640 --> 00:14:31,160
it's the same quality,
visually.

434
00:14:31,160 --> 00:14:31,830
PAUL LEWIS: Oh, OK.

435
00:14:31,830 --> 00:14:33,220
PAUL IRISH: Get rid of
excess stuff that

436
00:14:33,220 --> 00:14:33,830
doesn't need to be there.

437
00:14:33,830 --> 00:14:34,300
PAUL LEWIS: OK.

438
00:14:34,300 --> 00:14:34,770
Right.

439
00:14:34,770 --> 00:14:36,370
Does it transcode?

440
00:14:36,370 --> 00:14:37,920
PAUL IRISH: Um, no.

441
00:14:37,920 --> 00:14:39,010
PAUL LEWIS: Is that a
different filter?

442
00:14:39,010 --> 00:14:39,850
PAUL IRISH: Different filter.

443
00:14:39,850 --> 00:14:40,140
PAUL LEWIS: OK.

444
00:14:40,140 --> 00:14:43,110
So you've actually got options
of just optimizing your images

445
00:14:43,110 --> 00:14:44,780
on the fly, but not transcoding
them over to, say,

446
00:14:44,780 --> 00:14:48,320
WebP or-- assuming you've
started with PNT or JPEG.

447
00:14:48,320 --> 00:14:48,840
PAUL IRISH: Yes.

448
00:14:48,840 --> 00:14:50,900
And resize_images,
which is pretty.

449
00:14:50,900 --> 00:14:54,330
So resize_images will take
effect if you have an inline

450
00:14:54,330 --> 00:14:57,230
width or height attribute
on the image tag

451
00:14:57,230 --> 00:14:58,910
or an inline style.

452
00:14:58,910 --> 00:15:03,790
It will resize the image to fit
natively as that size that

453
00:15:03,790 --> 00:15:04,860
the page is requesting
it be in.

454
00:15:04,860 --> 00:15:06,470
PAUL LEWIS: I like it.

455
00:15:06,470 --> 00:15:07,590
PAUL IRISH: Really powerful.

456
00:15:07,590 --> 00:15:10,190
So that gives you all those
things for free.

457
00:15:10,190 --> 00:15:13,530
So if you are digging into
mod_pagespeed or index page

458
00:15:13,530 --> 00:15:16,510
speed, which you should, it does
all this work for you.

459
00:15:16,510 --> 00:15:20,110
So your build script does
not have to be as crazy.

460
00:15:20,110 --> 00:15:23,690
Dig into these filters, try
some out because there's a

461
00:15:23,690 --> 00:15:24,500
lot, a lot power in there.

462
00:15:24,500 --> 00:15:26,410
PAUL LEWIS: I think that's
really good to point that just

463
00:15:26,410 --> 00:15:28,850
by having pagespeed step
one, but step two--

464
00:15:28,850 --> 00:15:29,070
PAUL IRISH: Definitely.

465
00:15:29,070 --> 00:15:29,930
PAUL LEWIS: Step two
is definitely

466
00:15:29,930 --> 00:15:31,070
look at those filters.

467
00:15:31,070 --> 00:15:32,660
So they're not just a kind
of-- and you're done.

468
00:15:32,660 --> 00:15:33,686
PAUL IRISH: Yup.

469
00:15:33,686 --> 00:15:35,400
Yup.

470
00:15:35,400 --> 00:15:37,625
What's next?

471
00:15:37,625 --> 00:15:38,960
[INAUDIBLE]?

472
00:15:38,960 --> 00:15:40,820
PAUL LEWIS: Do you want
to meet the Ipsums?

473
00:15:40,820 --> 00:15:41,920
PAUL IRISH: Meet the Ipsums.

474
00:15:41,920 --> 00:15:42,950
PAUL LEWIS: Yeah, let's
meet the Ipsums.

475
00:15:42,950 --> 00:15:43,310
PAUL IRISH: Let's do it.

476
00:15:43,310 --> 00:15:45,340
PAUL LEWIS: This is a great
little site, very amusing to

477
00:15:45,340 --> 00:15:48,810
me, this whole site, different
forms of lorem ipsum.

478
00:15:48,810 --> 00:15:52,000
This one is featuring cat ipsum
and veggie ipsum, so

479
00:15:52,000 --> 00:15:56,420
celery, seakale, all these
different kinds of veggies,

480
00:15:56,420 --> 00:15:57,430
corporate ipsum.

481
00:15:57,430 --> 00:15:58,610
I like this one.

482
00:15:58,610 --> 00:16:01,350
I've worked in those kind of
environments for a while.

483
00:16:01,350 --> 00:16:01,570
PAUL IRISH: That's nice.

484
00:16:01,570 --> 00:16:02,180
PAUL LEWIS: So I was
looking at this.

485
00:16:02,180 --> 00:16:03,260
And I thought, this is great.

486
00:16:03,260 --> 00:16:06,180
It's a really clean,
simple site.

487
00:16:06,180 --> 00:16:08,820
And so I was busy looking at
the time, as I always do.

488
00:16:08,820 --> 00:16:10,140
So I did a run.

489
00:16:10,140 --> 00:16:12,870
And then I was just scrolling
just like that.

490
00:16:12,870 --> 00:16:14,330
And it kind of felt janky.

491
00:16:14,330 --> 00:16:16,470
And I was like, but why?

492
00:16:16,470 --> 00:16:17,570
And then--

493
00:16:17,570 --> 00:16:19,915
so paint is a thing.

494
00:16:19,915 --> 00:16:20,370
PAUL IRISH: Yup.

495
00:16:20,370 --> 00:16:20,550
Big thing.

496
00:16:20,550 --> 00:16:22,190
PAUL LEWIS: It's a big thing.

497
00:16:22,190 --> 00:16:23,720
And you can see here, it's--

498
00:16:23,720 --> 00:16:26,540
I mean, you can't see Chrome
so much in the background.

499
00:16:26,540 --> 00:16:29,170
But as you roll over this
record, you actually see a

500
00:16:29,170 --> 00:16:31,810
blue area highlighted in Chrome,
which is kind of--

501
00:16:31,810 --> 00:16:33,400
it's the area that had
to be repainted.

502
00:16:33,400 --> 00:16:34,650
And looking at the size
of this thing--

503
00:16:34,650 --> 00:16:36,950
1526 by 882--

504
00:16:36,950 --> 00:16:38,700
it's like, that's big.

505
00:16:38,700 --> 00:16:41,180
We want to reduce paint size
and paint complexity.

506
00:16:41,180 --> 00:16:43,970
And I'm thinking paint size is
a good first start here.

507
00:16:43,970 --> 00:16:45,710
Spin it down.

508
00:16:45,710 --> 00:16:48,980
There's a couple of paints in
here that we can look at.

509
00:16:48,980 --> 00:16:50,670
And yeah, there's a couple
of smaller ones.

510
00:16:50,670 --> 00:16:52,840
But clearly, there's
this big paint.

511
00:16:52,840 --> 00:16:55,570
So I'm thinking, well, this
is just scrolling.

512
00:16:55,570 --> 00:16:57,860
It doesn't seem to
be doing much.

513
00:16:57,860 --> 00:17:04,440
I get to end of the page and
there's this fixed position

514
00:17:04,440 --> 00:17:05,319
element at the background.

515
00:17:05,319 --> 00:17:06,970
Now--

516
00:17:06,970 --> 00:17:09,380
PAUL IRISH: Now one thing that I
was wondering-- so normally,

517
00:17:09,380 --> 00:17:14,150
a paint, when you scroll, at
least on desktop, the paint

518
00:17:14,150 --> 00:17:15,819
will just happen at
the bottom, right?

519
00:17:15,819 --> 00:17:18,380
As I'm scrolling, the paint
will supplement the new

520
00:17:18,380 --> 00:17:19,910
content as that comes in?

521
00:17:19,910 --> 00:17:21,369
PAUL LEWIS: It is going
to paint whatever--

522
00:17:21,369 --> 00:17:21,690
yeah.

523
00:17:21,690 --> 00:17:22,920
So if you're scrolling, yes.

524
00:17:22,920 --> 00:17:25,660
It's exactly-- if you're up or
down, it depends on which end

525
00:17:25,660 --> 00:17:27,760
of the-- the page needs
to be kind of handled.

526
00:17:27,760 --> 00:17:29,950
PAUL IRISH: Yeah But what
we're seeing here is

527
00:17:29,950 --> 00:17:31,300
that this paint is--

528
00:17:31,300 --> 00:17:33,740
you can see kind of this
blue highlight.

529
00:17:33,740 --> 00:17:36,050
It is the entire page.

530
00:17:36,050 --> 00:17:37,900
And then this one again,
the entire page.

531
00:17:37,900 --> 00:17:41,370
PAUL LEWIS: Now the reason for
this is most likely that

532
00:17:41,370 --> 00:17:43,670
Chrome is looking at all the
styles of all the elements,

533
00:17:43,670 --> 00:17:47,160
and it's grouping that fixed
position element with the

534
00:17:47,160 --> 00:17:48,610
content that's scrolling.

535
00:17:48,610 --> 00:17:51,500
So as it scrolls, the that fixed
position element needs

536
00:17:51,500 --> 00:17:54,230
to be repainted so that it can
fill up the view port.

537
00:17:54,230 --> 00:17:55,760
And then the scrolling content
sits over the top.

538
00:17:55,760 --> 00:17:58,320
So it's almost like it's
pointless because-- it's just

539
00:17:58,320 --> 00:18:01,720
one of these things, definitely
looking at ways

540
00:18:01,720 --> 00:18:03,160
that we can make this better.

541
00:18:03,160 --> 00:18:06,290
The fix for it, if you're
interested, would be to go

542
00:18:06,290 --> 00:18:11,130
into the elements and would be
to promote the footer, which

543
00:18:11,130 --> 00:18:12,145
is this fixed--

544
00:18:12,145 --> 00:18:14,280
you can see it over here,
position fixed.

545
00:18:14,280 --> 00:18:16,290
Would be to promote this
to its own layer.

546
00:18:16,290 --> 00:18:19,050
So that basically, all the
compositor has to do is just

547
00:18:19,050 --> 00:18:20,030
leave that there.

548
00:18:20,030 --> 00:18:21,590
And the scrolling content
can move over the

549
00:18:21,590 --> 00:18:22,460
top in its own layer.

550
00:18:22,460 --> 00:18:24,620
And the simplest way to
do that that I know--

551
00:18:24,620 --> 00:18:26,050
whoops, put that back--

552
00:18:26,050 --> 00:18:27,100
is to use the 3D transform.

553
00:18:27,100 --> 00:18:28,030
So use it sparingly.

554
00:18:28,030 --> 00:18:30,420
But this is a classic case for
it, where we're painting

555
00:18:30,420 --> 00:18:32,230
something on every frame,
something that doesn't need to

556
00:18:32,230 --> 00:18:32,790
be repainted.

557
00:18:32,790 --> 00:18:35,270
So let's do that web
kit transform.

558
00:18:35,270 --> 00:18:35,840
Why not?

559
00:18:35,840 --> 00:18:36,850
PAUL IRISH: Say it with
the [INAUDIBLE].

560
00:18:36,850 --> 00:18:37,574
PAUL LEWIS: TranslateZ.

561
00:18:37,574 --> 00:18:38,382
PAUL IRISH: [SNAPS FINGERS]

562
00:18:38,382 --> 00:18:39,400
PAUL LEWIS: Yeah,
that's right.

563
00:18:39,400 --> 00:18:39,880
It's so catchy.

564
00:18:39,880 --> 00:18:42,310
I mean, I've even caught
my non-nerdy wife

565
00:18:42,310 --> 00:18:43,040
talking about this.

566
00:18:43,040 --> 00:18:43,880
No, I haven't really.

567
00:18:43,880 --> 00:18:44,560
It's a lie.

568
00:18:44,560 --> 00:18:45,380
It's a lie.

569
00:18:45,380 --> 00:18:45,710
PAUL IRISH: [LAUGHS]

570
00:18:45,710 --> 00:18:46,080
PAUL LEWIS: All right.

571
00:18:46,080 --> 00:18:47,510
So I've translated it.

572
00:18:47,510 --> 00:18:48,490
Does it look any different?

573
00:18:48,490 --> 00:18:49,200
Maybe, maybe not.

574
00:18:49,200 --> 00:18:49,830
Let's find out.

575
00:18:49,830 --> 00:18:52,670
Let's do a test and see what
happens when we scroll.

576
00:18:52,670 --> 00:18:53,510
PAUL IRISH: Oh, that
looks nice.

577
00:18:53,510 --> 00:18:58,540
PAUL LEWIS: So now we've much
reduced our paint costs.

578
00:18:58,540 --> 00:18:59,850
Now there are things
going on here.

579
00:18:59,850 --> 00:19:02,910
But that's the main thing
in this right now.

580
00:19:02,910 --> 00:19:05,460
PAUL IRISH: Can we take a look
at this with Show Paint

581
00:19:05,460 --> 00:19:05,845
Rectangles?

582
00:19:05,845 --> 00:19:07,270
PAUL LEWIS: Yeah.

583
00:19:07,270 --> 00:19:09,010
PAUL IRISH: Are we going to
see a difference between

584
00:19:09,010 --> 00:19:10,025
before and after that?

585
00:19:10,025 --> 00:19:10,340
PAUL LEWIS: Yeah.

586
00:19:10,340 --> 00:19:11,890
So we don't need to do anything
other than-- we can

587
00:19:11,890 --> 00:19:13,050
toggle the style on and off.

588
00:19:13,050 --> 00:19:15,690
So what that'll do is-- we'll
pop down onto the cog here.

589
00:19:15,690 --> 00:19:18,250
We can switch on Show
Paint Rectangles.

590
00:19:18,250 --> 00:19:20,310
And we do that.

591
00:19:20,310 --> 00:19:21,760
That's all we need to do.

592
00:19:21,760 --> 00:19:24,430
And [INAUDIBLE], let's
just close.

593
00:19:24,430 --> 00:19:25,810
Yeah, thank you.

594
00:19:25,810 --> 00:19:27,990
You know all the shortcuts.

595
00:19:27,990 --> 00:19:28,160
Aw.

596
00:19:28,160 --> 00:19:28,870
PAUL IRISH: Escape.

597
00:19:28,870 --> 00:19:29,530
PAUL LEWIS: Is that
what it is?

598
00:19:29,530 --> 00:19:30,750
PAUL IRISH: Yeah,
there you go.

599
00:19:30,750 --> 00:19:31,520
PAUL LEWIS: Oh, I feel better
for knowing that.

600
00:19:31,520 --> 00:19:33,270
Finding that out on air!

601
00:19:33,270 --> 00:19:33,935
That's good.

602
00:19:33,935 --> 00:19:35,230
It's good to go.

603
00:19:35,230 --> 00:19:36,900
So what I need to do is I need
to go back to the elements.

604
00:19:36,900 --> 00:19:39,460
I need to switch off
my translateZ.

605
00:19:39,460 --> 00:19:43,525
Now when I scroll, you'll see
that whole thing is bright

606
00:19:43,525 --> 00:19:45,970
red, as is the scroll bar
on the right hand side.

607
00:19:45,970 --> 00:19:47,590
And that's just Chrome saying,
you know what?

608
00:19:47,590 --> 00:19:48,710
These are the things
I have to paint.

609
00:19:48,710 --> 00:19:50,530
So the scroll bar makes
perfect sense.

610
00:19:50,530 --> 00:19:51,510
That's normal.

611
00:19:51,510 --> 00:19:54,820
But seeing that whole thing,
oh, that's not so good.

612
00:19:54,820 --> 00:19:59,220
So when we switch on the
translateZ, and we push that

613
00:19:59,220 --> 00:20:01,160
out to its own layer-- that
background out to its own

614
00:20:01,160 --> 00:20:02,610
layer-- what's going to actually
happen, is the

615
00:20:02,610 --> 00:20:04,070
content that's sitting on
the top is also going

616
00:20:04,070 --> 00:20:06,060
to get its own layer.

617
00:20:06,060 --> 00:20:07,810
But we basically have
separated them out.

618
00:20:07,810 --> 00:20:10,670
We kind of forced Chrome's
hand a little bit.

619
00:20:10,670 --> 00:20:13,035
And now when we scroll--

620
00:20:13,035 --> 00:20:13,570
PAUL IRISH: There it is.

621
00:20:13,570 --> 00:20:14,840
PAUL LEWIS: There we go.

622
00:20:14,840 --> 00:20:19,180
So using Show Paint Rectangles
or even just DevTools, you'll

623
00:20:19,180 --> 00:20:22,480
find that you'll actually see
when things are painting.

624
00:20:22,480 --> 00:20:23,626
And that's actually-- yeah.

625
00:20:23,626 --> 00:20:24,680
PAUL IRISH: [MAKES GUN SOUNDS]

626
00:20:24,680 --> 00:20:25,550
PAUL LEWIS: So you can see--

627
00:20:25,550 --> 00:20:28,150
yeah, including sound effects.

628
00:20:28,150 --> 00:20:31,120
When you get to the top,
obviously this is--

629
00:20:31,120 --> 00:20:32,840
again, it makes sense for
this to probably--

630
00:20:32,840 --> 00:20:33,620
PAUL IRISH: Oh, oh, oh.

631
00:20:33,620 --> 00:20:34,310
PAUL LEWIS: But they
could probably--

632
00:20:34,310 --> 00:20:35,200
PAUL IRISH: Another
opportunity.

633
00:20:35,200 --> 00:20:36,610
PAUL LEWIS: Yeah, there is
another opportunity.

634
00:20:36,610 --> 00:20:39,305
Instead of, I'm guessing, 2D
transforms here, if it were

635
00:20:39,305 --> 00:20:40,810
me, I'd look at 3D
transforms again.

636
00:20:40,810 --> 00:20:42,980
These are the things that don't
want to interact with

637
00:20:42,980 --> 00:20:43,340
each other.

638
00:20:43,340 --> 00:20:45,030
They just want to move around.

639
00:20:45,030 --> 00:20:46,010
They want their own layer.

640
00:20:46,010 --> 00:20:47,410
PAUL IRISH: OK.

641
00:20:47,410 --> 00:20:49,970
We need two disclaimers here,
two separate disclaimers.

642
00:20:49,970 --> 00:20:50,680
PAUL LEWIS: OK.

643
00:20:50,680 --> 00:20:50,840
I like disclaimers.

644
00:20:50,840 --> 00:20:52,970
PAUL IRISH: OK, the first
one, you kind of

645
00:20:52,970 --> 00:20:54,050
wrote about, I think.

646
00:20:54,050 --> 00:20:55,220
I'm just going to guess--

647
00:20:55,220 --> 00:20:55,560
PAUL LEWIS: There it is.

648
00:20:55,560 --> 00:20:55,900
It just--

649
00:20:55,900 --> 00:20:56,390
I--

650
00:20:56,390 --> 00:20:58,050
PAUL IRISH: --layer
promotion, maybe.

651
00:20:58,050 --> 00:20:58,450
PAUL LEWIS: Try it.

652
00:20:58,450 --> 00:21:00,707
Let's see.

653
00:21:00,707 --> 00:21:01,870
PAUL IRISH: All right, yeah.

654
00:21:01,870 --> 00:21:02,255
OK, cool.

655
00:21:02,255 --> 00:21:05,300
It's a part of this blog post
about the layer promotion

656
00:21:05,300 --> 00:21:06,890
translateZ, translate3d hack.

657
00:21:06,890 --> 00:21:07,150
PAUL LEWIS: Yeah.

658
00:21:07,150 --> 00:21:10,180
It's actually one of about six
or seven rules that Chrome

659
00:21:10,180 --> 00:21:11,930
will use when it's
deciding to put

660
00:21:11,930 --> 00:21:12,850
something on its own layer.

661
00:21:12,850 --> 00:21:17,630
And translateZ is the most
well known of the family.

662
00:21:17,630 --> 00:21:21,640
PAUL IRISH: And so it is a
hack.k and we feel interesting

663
00:21:21,640 --> 00:21:24,710
about recommend it.

664
00:21:24,710 --> 00:21:28,340
And this article explains some
of the downsides and some of

665
00:21:28,340 --> 00:21:29,630
the things that you need
to be aware of.

666
00:21:29,630 --> 00:21:31,050
It's not just a silver bullet.

667
00:21:31,050 --> 00:21:31,950
It has downsides.

668
00:21:31,950 --> 00:21:34,070
So read this.

669
00:21:34,070 --> 00:21:36,350
And the other disclaimer,
I think, is about

670
00:21:36,350 --> 00:21:37,740
cross-browserness.

671
00:21:37,740 --> 00:21:39,250
Of all the things that we're
talking about today--

672
00:21:39,250 --> 00:21:41,770
PAUL LEWIS: This is the least
cross-browser thing, right?

673
00:21:41,770 --> 00:21:42,600
PAUL IRISH: Is it?

674
00:21:42,600 --> 00:21:43,270
PAUL LEWIS: Because it's
not going to--

675
00:21:43,270 --> 00:21:43,690
PAUL IRISH: Oh, yeah.

676
00:21:43,690 --> 00:21:46,000
Even Chrome on Android,
it really

677
00:21:46,000 --> 00:21:47,645
doesn't do these things.

678
00:21:47,645 --> 00:21:49,790
PAUL LEWIS: Chrome on Android
and also word on the street is

679
00:21:49,790 --> 00:21:53,570
that Safari no longer honors
it as a layer creation, or

680
00:21:53,570 --> 00:21:55,190
certainly won't do
in the future.

681
00:21:55,190 --> 00:21:58,616
And it's not-- you know, it's
a webkit prefixed thing, so

682
00:21:58,616 --> 00:21:59,770
it's not going to
work in Firefox.

683
00:21:59,770 --> 00:22:03,980
PAUL IRISH: But the networked
stuff that we should before,

684
00:22:03,980 --> 00:22:05,940
absolute cross-browser.

685
00:22:05,940 --> 00:22:07,110
Layout thrashing--

686
00:22:07,110 --> 00:22:10,320
the way that the specs are
written for HTML recalculation

687
00:22:10,320 --> 00:22:13,680
style, browsers have a
lot of consistency

688
00:22:13,680 --> 00:22:14,690
between how they work.

689
00:22:14,690 --> 00:22:17,590
So layout thrashing is
real everywhere.

690
00:22:17,590 --> 00:22:19,140
PAUL LEWIS: It's called
reflow in Firefox.

691
00:22:19,140 --> 00:22:19,700
PAUL IRISH: Reflow, yeah.

692
00:22:19,700 --> 00:22:20,680
It's the exact same thing.

693
00:22:20,680 --> 00:22:25,880
And so when you see reflow as
a term, it's this issue.

694
00:22:25,880 --> 00:22:27,880
So it's a cross-browser
situation.

695
00:22:27,880 --> 00:22:29,570
Anything else?

696
00:22:29,570 --> 00:22:31,440
Expensive paints.

697
00:22:31,440 --> 00:22:33,674
Expensive paints can be--

698
00:22:33,674 --> 00:22:35,400
it's hard to say.

699
00:22:35,400 --> 00:22:36,730
And right now, there's--

700
00:22:36,730 --> 00:22:38,880
for what's expensive to
paint in Firefox and

701
00:22:38,880 --> 00:22:41,890
IE is a little unclear.

702
00:22:41,890 --> 00:22:43,450
We're hoping to find out
more about that.

703
00:22:43,450 --> 00:22:44,030
PAUL LEWIS: Yeah, yeah.

704
00:22:44,030 --> 00:22:44,740
I think that's the thing.

705
00:22:44,740 --> 00:22:46,750
I mean, you have
to profile it.

706
00:22:46,750 --> 00:22:49,090
It's not always easy to do that
in a cross-browser way.

707
00:22:49,090 --> 00:22:51,240
And you obviously don't want
to do anything that is an

708
00:22:51,240 --> 00:22:52,270
anti-pattern elsewhere.

709
00:22:52,270 --> 00:22:55,000
But generally speaking,
not painting is a

710
00:22:55,000 --> 00:22:56,800
good pattern for everybody.

711
00:22:56,800 --> 00:22:59,230
Not paintings is not painting,
irrespective of your browser.

712
00:22:59,230 --> 00:23:00,570
So it's a good thing.

713
00:23:00,570 --> 00:23:01,666
Do you want to hear
another one?

714
00:23:01,666 --> 00:23:02,080
PAUL IRISH: Yeah.

715
00:23:02,080 --> 00:23:03,865
I want to show you this one.

716
00:23:03,865 --> 00:23:04,830
Whew.

717
00:23:04,830 --> 00:23:05,310
OK.

718
00:23:05,310 --> 00:23:07,270
Let's take a look.

719
00:23:07,270 --> 00:23:07,510
All right.

720
00:23:07,510 --> 00:23:07,800
So--

721
00:23:07,800 --> 00:23:08,630
PAUL LEWIS: Oh wow, yeah.

722
00:23:08,630 --> 00:23:11,780
PAUL IRISH: There's a bit
of load time right here.

723
00:23:11,780 --> 00:23:12,420
Is that slow?

724
00:23:12,420 --> 00:23:15,080
I'm just going to bump that into
a WebPagetest while we

725
00:23:15,080 --> 00:23:17,280
kind of wait for it.

726
00:23:17,280 --> 00:23:19,390
PAUL LEWIS: It's like
two tests in one.

727
00:23:19,390 --> 00:23:19,750
PAUL IRISH: Yeah.

728
00:23:19,750 --> 00:23:21,280
Let's go for it.

729
00:23:21,280 --> 00:23:22,615
We'll use--

730
00:23:22,615 --> 00:23:24,860
oh, what's up?

731
00:23:24,860 --> 00:23:27,372
PAUL LEWIS: Sounds like
it's got sound.

732
00:23:27,372 --> 00:23:28,420
PAUL IRISH: We've got
sound coming here.

733
00:23:28,420 --> 00:23:30,560
I'm going to turn it off just
because-- whoa, whoa, whoa,

734
00:23:30,560 --> 00:23:31,120
whoa, whoa.

735
00:23:31,120 --> 00:23:34,328
Chill out, guys.

736
00:23:34,328 --> 00:23:34,760
All right.

737
00:23:34,760 --> 00:23:36,150
We're in the front
of the queue.

738
00:23:36,150 --> 00:23:36,280
Good.

739
00:23:36,280 --> 00:23:38,690
Go back.

740
00:23:38,690 --> 00:23:39,810
What do we do?

741
00:23:39,810 --> 00:23:40,450
PAUL LEWIS: Click.

742
00:23:40,450 --> 00:23:41,860
PAUL IRISH: Click.

743
00:23:41,860 --> 00:23:43,955
PAUL LEWIS: And then
you hit the--

744
00:23:43,955 --> 00:23:45,700
I think it's--

745
00:23:45,700 --> 00:23:46,020
PAUL IRISH: OK.

746
00:23:46,020 --> 00:23:47,540
PAUL LEWIS: Yeah, try
using-- there we go.

747
00:23:47,540 --> 00:23:51,340
OK, now you roll your
mouse around and--

748
00:23:51,340 --> 00:23:52,760
now I don't know if you can
see this on the video, but

749
00:23:52,760 --> 00:23:55,470
this is hideously janky.

750
00:23:55,470 --> 00:23:57,380
This is really bad.

751
00:23:57,380 --> 00:24:00,650
PAUL IRISH: This was submitted
by someone who wanted us to

752
00:24:00,650 --> 00:24:02,040
talk about it.

753
00:24:02,040 --> 00:24:02,435
I mean--

754
00:24:02,435 --> 00:24:02,720
PAUL LEWIS: Sorry.

755
00:24:02,720 --> 00:24:05,930
PAUL IRISH: I feel like you're
being a bit mean here.

756
00:24:05,930 --> 00:24:09,020
PAUL LEWIS: I mean, this is
taking upwards of a second to

757
00:24:09,020 --> 00:24:10,570
update the screen.

758
00:24:10,570 --> 00:24:11,480
PAUL IRISH: These
are Voronois.

759
00:24:11,480 --> 00:24:13,886
There's a Voronoi
map behind it.

760
00:24:13,886 --> 00:24:14,258
PAUL LEWIS: Yeah.

761
00:24:14,258 --> 00:24:15,870
Yeah.

762
00:24:15,870 --> 00:24:16,430
PAUL IRISH: OK.

763
00:24:16,430 --> 00:24:19,978
So let's take a look at why.

764
00:24:19,978 --> 00:24:20,390
All right.

765
00:24:20,390 --> 00:24:24,130
So I'm going to Command Option
I into DevTools.

766
00:24:24,130 --> 00:24:27,267
We're going to head into
Timeline soon.

767
00:24:27,267 --> 00:24:31,050

768
00:24:31,050 --> 00:24:31,950
Come on.

769
00:24:31,950 --> 00:24:33,670
Play nice.

770
00:24:33,670 --> 00:24:35,000
PAUL LEWIS: You making it mad?

771
00:24:35,000 --> 00:24:37,290
PAUL IRISH: I'm making
it very mad.

772
00:24:37,290 --> 00:24:40,354
Hey, we're just friends.

773
00:24:40,354 --> 00:24:41,270
PAUL LEWIS: Did you
crash the browser?

774
00:24:41,270 --> 00:24:43,070
PAUL IRISH: We can--

775
00:24:43,070 --> 00:24:44,590
and you can--

776
00:24:44,590 --> 00:24:46,690
come on.

777
00:24:46,690 --> 00:24:48,440
Oh, it is really mad.

778
00:24:48,440 --> 00:24:50,220
PAUL LEWIS: Yeah,
you made it mad.

779
00:24:50,220 --> 00:24:52,400
PAUL IRISH: This is
what I get for--

780
00:24:52,400 --> 00:24:53,650
PAUL LEWIS: Turning me off.

781
00:24:53,650 --> 00:24:55,870

782
00:24:55,870 --> 00:24:57,310
The browser sided with me.

783
00:24:57,310 --> 00:24:57,990
PAUL IRISH: Oh.

784
00:24:57,990 --> 00:24:59,500
Let's kill that one.

785
00:24:59,500 --> 00:25:02,940
Oh, that was the one that
I didn't-- oh, no.

786
00:25:02,940 --> 00:25:04,160
PAUL LEWIS: You didn't
want that to happen.

787
00:25:04,160 --> 00:25:05,070
PAUL IRISH: I didn't want
that to happen.

788
00:25:05,070 --> 00:25:07,910
PAUL LEWIS: This goes to show,
profiling is not always the

789
00:25:07,910 --> 00:25:10,170
easiest task [INAUDIBLE].

790
00:25:10,170 --> 00:25:12,430
Sometimes these things break.

791
00:25:12,430 --> 00:25:13,060
All right.

792
00:25:13,060 --> 00:25:14,460
That looked good, looked
like you had it there.

793
00:25:14,460 --> 00:25:14,820
PAUL IRISH: All right.

794
00:25:14,820 --> 00:25:16,070
I think I got it.

795
00:25:16,070 --> 00:25:20,020

796
00:25:20,020 --> 00:25:22,720
So let's give this a shot.

797
00:25:22,720 --> 00:25:23,800
We've got Timeline open.

798
00:25:23,800 --> 00:25:25,835
I got this.

799
00:25:25,835 --> 00:25:27,800
PAUL LEWIS: Maybe you
have to press a key.

800
00:25:27,800 --> 00:25:29,045
PAUL IRISH: Play with me.

801
00:25:29,045 --> 00:25:30,050
This is--

802
00:25:30,050 --> 00:25:31,470
translate is trying
to take over.

803
00:25:31,470 --> 00:25:32,720
I don't want you, translate.

804
00:25:32,720 --> 00:25:35,310

805
00:25:35,310 --> 00:25:36,800
PAUL LEWIS: We might need
to leave this one, then.

806
00:25:36,800 --> 00:25:39,700

807
00:25:39,700 --> 00:25:40,470
PAUL IRISH: Leaving it.

808
00:25:40,470 --> 00:25:42,340
PAUL LEWIS: All right.

809
00:25:42,340 --> 00:25:43,500
PAUL IRISH: I just--

810
00:25:43,500 --> 00:25:45,820
before a movie theater, there
was this preroll.

811
00:25:45,820 --> 00:25:46,830
And it was advertising
movietickets.com.

812
00:25:46,830 --> 00:25:49,420
And there was this really funny
ad, where the woman--

813
00:25:49,420 --> 00:25:50,560
they're getting out
of the minivan.

814
00:25:50,560 --> 00:25:52,290
And it's like a Mission
Impossible to get

815
00:25:52,290 --> 00:25:53,580
to the movie tickets.

816
00:25:53,580 --> 00:25:56,810
And then the kid falls getting
out of the minivan.

817
00:25:56,810 --> 00:25:59,460
And the mom was like, leave
him, leave him.

818
00:25:59,460 --> 00:26:03,676
And my mom really loves that
commercial, which--

819
00:26:03,676 --> 00:26:04,520
PAUL LEWIS: I'm seeing
so much about your

820
00:26:04,520 --> 00:26:06,710
upbringing right now.

821
00:26:06,710 --> 00:26:11,060
In that 20 seconds, I didn't
expect that, if I'm honest.

822
00:26:11,060 --> 00:26:15,000
Folks, I hope you enjoyed
that as much as I did.

823
00:26:15,000 --> 00:26:17,010
Well.

824
00:26:17,010 --> 00:26:19,172
PAUL IRISH: It's there.

825
00:26:19,172 --> 00:26:19,960
PAUL LEWIS: Yeah.

826
00:26:19,960 --> 00:26:21,180
There's these paint
rectangles.

827
00:26:21,180 --> 00:26:22,290
PAUL IRISH: Show Paint
Rectangles is on.

828
00:26:22,290 --> 00:26:23,800
PAUL LEWIS: That's
probably why.

829
00:26:23,800 --> 00:26:24,630
It's probably mad.

830
00:26:24,630 --> 00:26:26,250
PAUL IRISH: Yeah, it's
really mad at us.

831
00:26:26,250 --> 00:26:26,660
PAUL LEWIS: All right.

832
00:26:26,660 --> 00:26:27,480
PAUL IRISH: All right.

833
00:26:27,480 --> 00:26:28,870
So we're going to move
to something else.

834
00:26:28,870 --> 00:26:32,680
This is Behzad, designer
and developer.

835
00:26:32,680 --> 00:26:33,490
Let's take a look.

836
00:26:33,490 --> 00:26:37,800
So you can-- it says we can
use kind of the keys here.

837
00:26:37,800 --> 00:26:38,610
Down.

838
00:26:38,610 --> 00:26:41,010
PAUL LEWIS: This is looking
pretty good, right?

839
00:26:41,010 --> 00:26:42,840
This is looking pretty--

840
00:26:42,840 --> 00:26:43,460
PAUL IRISH: Wow.

841
00:26:43,460 --> 00:26:44,970
Wow.

842
00:26:44,970 --> 00:26:48,050
Someone hire this man.

843
00:26:48,050 --> 00:26:48,930
All right.

844
00:26:48,930 --> 00:26:51,360
There's this kind of
playful, kind of--

845
00:26:51,360 --> 00:26:55,690
the background is parallaxing
two directions as these kind

846
00:26:55,690 --> 00:26:56,620
of play a little bit.

847
00:26:56,620 --> 00:26:57,270
PAUL LEWIS: And I'm seeing--

848
00:26:57,270 --> 00:27:00,770
when I'm watching, say, the
phone here in this image, it's

849
00:27:00,770 --> 00:27:01,990
kind of janking around.

850
00:27:01,990 --> 00:27:03,700
It doesn't feel like
it's smooth motion.

851
00:27:03,700 --> 00:27:04,130
PAUL IRISH: I don't know.

852
00:27:04,130 --> 00:27:05,150
PAUL LEWIS: I'm wondering
about this.

853
00:27:05,150 --> 00:27:06,720
PAUL IRISH: Do you think
we can improve it?

854
00:27:06,720 --> 00:27:07,360
PAUL LEWIS: Well,
I don't know.

855
00:27:07,360 --> 00:27:08,150
Let's find out what
it's doing.

856
00:27:08,150 --> 00:27:09,470
PAUL IRISH: Honestly,
I think it's--

857
00:27:09,470 --> 00:27:09,750
OK.

858
00:27:09,750 --> 00:27:11,020
So let's--

859
00:27:11,020 --> 00:27:12,120
PAUL LEWIS: See, I'm seeing
paints, right?

860
00:27:12,120 --> 00:27:12,660
PAUL IRISH: It's all paint.

861
00:27:12,660 --> 00:27:14,020
It's all paint.

862
00:27:14,020 --> 00:27:14,780
Paint Recs is still on.

863
00:27:14,780 --> 00:27:16,800
I'm going to make sure
that that's off.

864
00:27:16,800 --> 00:27:18,530
We want that.

865
00:27:18,530 --> 00:27:19,850
It's not going to
change anything.

866
00:27:19,850 --> 00:27:21,800
It's all the same.

867
00:27:21,800 --> 00:27:22,280
OK.

868
00:27:22,280 --> 00:27:24,840
I'm using Command D. It's fast.

869
00:27:24,840 --> 00:27:25,090
All right.

870
00:27:25,090 --> 00:27:25,880
So we look in.

871
00:27:25,880 --> 00:27:28,220
And we're all just--
we're in pain land.

872
00:27:28,220 --> 00:27:28,780
PAUL LEWIS: Image resize!

873
00:27:28,780 --> 00:27:30,540
PAUL IRISH: Image resize!

874
00:27:30,540 --> 00:27:31,720
PAUL LEWIS: 50 milliseconds.

875
00:27:31,720 --> 00:27:33,050
PAUL IRISH: Wow.

876
00:27:33,050 --> 00:27:34,120
PAUL LEWIS: Who knew?

877
00:27:34,120 --> 00:27:35,720
PAUL IRISH: Wow.

878
00:27:35,720 --> 00:27:37,530
That's really good to know.

879
00:27:37,530 --> 00:27:37,990
OK.

880
00:27:37,990 --> 00:27:40,410
So image resize, unexpected.

881
00:27:40,410 --> 00:27:43,480
PAUL LEWIS: So decoding and
resizing alike, there are

882
00:27:43,480 --> 00:27:44,750
dependencies for paint.

883
00:27:44,750 --> 00:27:48,210
So when Chrome hits something
that's it going to paint, it

884
00:27:48,210 --> 00:27:50,030
goes, right, do I need
any images for this?

885
00:27:50,030 --> 00:27:51,340
And it doesn't keep--

886
00:27:51,340 --> 00:27:53,480
it keeps the PNG or the
JPEG in memory.

887
00:27:53,480 --> 00:27:57,380
But it doesn't keep the bitmap
for that, the expanded,

888
00:27:57,380 --> 00:27:59,200
decompressed version
of that in memory.

889
00:27:59,200 --> 00:28:01,790
So it what it does, it goes
off on the fly and says,

890
00:28:01,790 --> 00:28:04,890
right, decode and decompress
that image out to a bitmap.

891
00:28:04,890 --> 00:28:06,420
And then resize it down.

892
00:28:06,420 --> 00:28:08,790
So because we don't see a decode
here, something that

893
00:28:08,790 --> 00:28:11,130
was already decoded in resident
memory, but it had to

894
00:28:11,130 --> 00:28:12,330
be re-sized.

895
00:28:12,330 --> 00:28:13,162
PAUL IRISH: Yeah.

896
00:28:13,162 --> 00:28:14,520
So it's this image, clearly.

897
00:28:14,520 --> 00:28:16,012
PAUL LEWIS: You think?

898
00:28:16,012 --> 00:28:16,974
PAUL IRISH: Yeah.

899
00:28:16,974 --> 00:28:19,250
PAUL LEWIS: I'm down with it.

900
00:28:19,250 --> 00:28:20,110
PAUL IRISH: I don't really
know where it is.

901
00:28:20,110 --> 00:28:22,910
But it's in here.

902
00:28:22,910 --> 00:28:23,780
Are you in here?

903
00:28:23,780 --> 00:28:24,690
Yup.

904
00:28:24,690 --> 00:28:27,190
I'm using H to kind
of navigate the

905
00:28:27,190 --> 00:28:29,090
DOM and hide parts.

906
00:28:29,090 --> 00:28:29,987
It's in there?

907
00:28:29,987 --> 00:28:31,210
Got it.

908
00:28:31,210 --> 00:28:33,380
OK.

909
00:28:33,380 --> 00:28:35,960
So oh, yeah.

910
00:28:35,960 --> 00:28:38,610
Naturally, 220 pixels.

911
00:28:38,610 --> 00:28:39,700
I mean, it's a big image.

912
00:28:39,700 --> 00:28:40,860
PAUL LEWIS: 2,200, right?

913
00:28:40,860 --> 00:28:41,330
PAUL IRISH: Yes.

914
00:28:41,330 --> 00:28:44,810
The larger the image, the more
expensive the resize will

915
00:28:44,810 --> 00:28:48,080
cost, which makes sense.

916
00:28:48,080 --> 00:28:49,030
But--

917
00:28:49,030 --> 00:28:50,130
PAUL LEWIS: And this doesn't
actually make--

918
00:28:50,130 --> 00:28:51,410
I mean, for me, I was
looking at this.

919
00:28:51,410 --> 00:28:54,220
And it's not resizing.

920
00:28:54,220 --> 00:28:55,420
It doesn't seem to
be resizing.

921
00:28:55,420 --> 00:28:58,410
As you were moving, it was
moving left and top or

922
00:28:58,410 --> 00:28:58,990
translating.

923
00:28:58,990 --> 00:29:00,410
But it wasn't resizing.

924
00:29:00,410 --> 00:29:04,370
So I wonder why there's
a resize going on.

925
00:29:04,370 --> 00:29:04,950
PAUL IRISH: So it's
definitely--

926
00:29:04,950 --> 00:29:06,010
yeah, left and tops.

927
00:29:06,010 --> 00:29:07,880
PAUL LEWIS: So maybe something
is resizing it.

928
00:29:07,880 --> 00:29:10,540
But it seems unusual to need
to resize it at all.

929
00:29:10,540 --> 00:29:13,070
I guess what I'm driving at is
it could be served up that

930
00:29:13,070 --> 00:29:16,420
size potentially, and the
problem would be solved.

931
00:29:16,420 --> 00:29:17,040
PAUL IRISH: Yeah, OK.

932
00:29:17,040 --> 00:29:19,560
Let's--

933
00:29:19,560 --> 00:29:20,990
PAUL LEWIS: I mean, just looking
at this profile.

934
00:29:20,990 --> 00:29:22,160
I mean, this is all
green, right?

935
00:29:22,160 --> 00:29:24,450
This is all paint work
that's happening.

936
00:29:24,450 --> 00:29:25,820
PAUL IRISH: Yeah,
but I think--

937
00:29:25,820 --> 00:29:27,750
I mean, it's triggered
off a mouse move.

938
00:29:27,750 --> 00:29:31,330
There's a mouse move that's
watching the work.

939
00:29:31,330 --> 00:29:33,584
Command uh--

940
00:29:33,584 --> 00:29:36,080
PAUL LEWIS: Command
[INAUDIBLE]?

941
00:29:36,080 --> 00:29:37,120
What are you doing?

942
00:29:37,120 --> 00:29:39,380
PAUL IRISH: I'm really
interested in what happens

943
00:29:39,380 --> 00:29:40,190
inside this image.

944
00:29:40,190 --> 00:29:41,030
PAUL LEWIS: I don't blame you.

945
00:29:41,030 --> 00:29:42,405
I'm fascinated, too.

946
00:29:42,405 --> 00:29:43,300
PAUL IRISH: OK.

947
00:29:43,300 --> 00:29:43,840
PAUL LEWIS: I'm just
trying to--

948
00:29:43,840 --> 00:29:44,920
PAUL IRISH: BG01.

949
00:29:44,920 --> 00:29:45,786
PAUL LEWIS: All right.

950
00:29:45,786 --> 00:29:46,850
Because you're going quick.

951
00:29:46,850 --> 00:29:48,707
And I'm wondering if people
are going to follow what

952
00:29:48,707 --> 00:29:49,040
you're doing.

953
00:29:49,040 --> 00:29:49,550
PAUL IRISH: Well, OK.

954
00:29:49,550 --> 00:29:50,960
So I just found--

955
00:29:50,960 --> 00:29:52,600
we grabbed the image.

956
00:29:52,600 --> 00:29:53,360
PAUL LEWIS: Can I--

957
00:29:53,360 --> 00:29:54,190
he's got--

958
00:29:54,190 --> 00:29:55,230
PAUL IRISH: We're in the
mouse move, right?

959
00:29:55,230 --> 00:29:57,900
We're in the mouse move, inside
this start screen.

960
00:29:57,900 --> 00:29:59,820
So it looks like it's only just
mouse moves inside this

961
00:29:59,820 --> 00:30:01,070
start screen, which
is good, rather

962
00:30:01,070 --> 00:30:01,960
than the entire document.

963
00:30:01,960 --> 00:30:03,390
PAUL LEWIS: Yup, yup, yup.

964
00:30:03,390 --> 00:30:05,840
PAUL IRISH: But we re-grab
that element.

965
00:30:05,840 --> 00:30:07,860
So we're doing a jQuery
traversal every single mouse

966
00:30:07,860 --> 00:30:10,700
move, which we don't
need to, obviously.

967
00:30:10,700 --> 00:30:11,670
We could cache that.

968
00:30:11,670 --> 00:30:13,840
PAUL LEWIS: I'm seeing width and
height all over the place,

969
00:30:13,840 --> 00:30:15,940
which feels like something
that wouldn't change.

970
00:30:15,940 --> 00:30:19,320
PAUL IRISH: Width and height,
probably not going to change.

971
00:30:19,320 --> 00:30:19,790
PAUL LEWIS: No.

972
00:30:19,790 --> 00:30:20,760
I mean, that's only--

973
00:30:20,760 --> 00:30:23,120
you could do those off of
requestAnimationFrame, off of

974
00:30:23,120 --> 00:30:24,250
window resize.

975
00:30:24,250 --> 00:30:27,410
PAUL IRISH: Then we just do a
bunch of math for the position

976
00:30:27,410 --> 00:30:32,640
of the mouse and the current
width, height.

977
00:30:32,640 --> 00:30:35,310
And then we just set the
left top to get the--

978
00:30:35,310 --> 00:30:37,130
oh, it looks like he tried
some animation.

979
00:30:37,130 --> 00:30:38,360
And that probably didn't
perform well.

980
00:30:38,360 --> 00:30:39,580
PAUL LEWIS: It's interesting
that there's a--

981
00:30:39,580 --> 00:30:42,020
oh, a failed 3D transform
document.

982
00:30:42,020 --> 00:30:42,860
PAUL IRISH: Yeah.

983
00:30:42,860 --> 00:30:45,720
PAUL LEWIS: Yeah, I would love
to know why that was--

984
00:30:45,720 --> 00:30:47,250
PAUL IRISH: Come on.

985
00:30:47,250 --> 00:30:48,910
Live edit, bro.

986
00:30:48,910 --> 00:30:49,880
Live edit.

987
00:30:49,880 --> 00:30:51,348
PAUL LEWIS: I would
love to know why--

988
00:30:51,348 --> 00:30:53,220
that's smooth!

989
00:30:53,220 --> 00:30:54,156
PAUL IRISH: That is smooth!

990
00:30:54,156 --> 00:30:55,180
PAUL LEWIS: That's amazing.

991
00:30:55,180 --> 00:30:55,620
PAUL IRISH: Let's go back.

992
00:30:55,620 --> 00:30:58,070
OK, Timeline looked like this.

993
00:30:58,070 --> 00:31:00,230
Command D. What the--
wait, wait.

994
00:31:00,230 --> 00:31:01,110
There we go.

995
00:31:01,110 --> 00:31:02,500
Blah, blah, blah, blah, blah.

996
00:31:02,500 --> 00:31:03,670
PAUL LEWIS: That's--

997
00:31:03,670 --> 00:31:03,790
PAUL IRISH: Seems better.

998
00:31:03,790 --> 00:31:04,930
PAUL LEWIS: That seems better.

999
00:31:04,930 --> 00:31:05,240
PAUL IRISH: Seems better.

1000
00:31:05,240 --> 00:31:08,010
PAUL LEWIS: That's breaking
through less often.

1001
00:31:08,010 --> 00:31:09,290
Switch it back.

1002
00:31:09,290 --> 00:31:09,500
All right.

1003
00:31:09,500 --> 00:31:12,970
So we're seeing 60
frames a second.

1004
00:31:12,970 --> 00:31:14,050
Boom.

1005
00:31:14,050 --> 00:31:15,490
Yeah.

1006
00:31:15,490 --> 00:31:16,760
PAUL IRISH: I bet this was
all set up for us.

1007
00:31:16,760 --> 00:31:17,310
PAUL LEWIS: I kno.

1008
00:31:17,310 --> 00:31:18,610
It genuinely wasn't.

1009
00:31:18,610 --> 00:31:19,970
That's the best bit of this.

1010
00:31:19,970 --> 00:31:20,970
OK, yeah

1011
00:31:20,970 --> 00:31:21,970
PAUL IRISH: I don't know
what's going on.

1012
00:31:21,970 --> 00:31:23,470
PAUL LEWIS: That doesn't
feel like--

1013
00:31:23,470 --> 00:31:24,980
all right.

1014
00:31:24,980 --> 00:31:25,890
Is that doing the right thing?

1015
00:31:25,890 --> 00:31:27,200
Did you save the change?

1016
00:31:27,200 --> 00:31:28,470
PAUL IRISH: Yeah, yeah, I did.

1017
00:31:28,470 --> 00:31:29,220
PAUL LEWIS: Are you sure?

1018
00:31:29,220 --> 00:31:30,176
PAUL IRISH: Yeah, I'm sure.

1019
00:31:30,176 --> 00:31:30,930
PAUL LEWIS: OK.

1020
00:31:30,930 --> 00:31:32,240
PAUL IRISH: Here, I'm going to--
this is probably a better

1021
00:31:32,240 --> 00:31:33,180
way to do it.

1022
00:31:33,180 --> 00:31:34,140
PAUL LEWIS: You're
going to relead?

1023
00:31:34,140 --> 00:31:36,400
PAUL IRISH: No, I'm
not reloading.

1024
00:31:36,400 --> 00:31:38,620
Start, move.

1025
00:31:38,620 --> 00:31:39,840
[HUMMING]

1026
00:31:39,840 --> 00:31:40,400
Come over here.

1027
00:31:40,400 --> 00:31:43,010
Sources, quick, quick,
quick, quick, quick.

1028
00:31:43,010 --> 00:31:44,580
Save, patch to the [INAUDIBLE].

1029
00:31:44,580 --> 00:31:45,270
Come back.

1030
00:31:45,270 --> 00:31:48,396
And, and, go, and--

1031
00:31:48,396 --> 00:31:49,320
hard to say.

1032
00:31:49,320 --> 00:31:52,360
PAUL LEWIS: Very hard to say,
based on what you just did.

1033
00:31:52,360 --> 00:31:52,790
PAUL IRISH: It does--

1034
00:31:52,790 --> 00:31:56,360
I mean, at first glance,
it looked like--

1035
00:31:56,360 --> 00:31:57,440
I mean, you saw what
I did, right?

1036
00:31:57,440 --> 00:31:57,990
PAUL LEWIS: Yeah, yeah, yeah.

1037
00:31:57,990 --> 00:31:58,960
PAUL IRISH: I mean,
it was just fast.

1038
00:31:58,960 --> 00:32:00,070
PAUL LEWIS: It was
just, [YELLS].

1039
00:32:00,070 --> 00:32:00,170
PAUL IRISH: Yeah.

1040
00:32:00,170 --> 00:32:01,740
Well, sorry.

1041
00:32:01,740 --> 00:32:02,010
It does--

1042
00:32:02,010 --> 00:32:02,270
OK.

1043
00:32:02,270 --> 00:32:04,160
PAUL LEWIS: That's what it's
like working with Paul Irish.

1044
00:32:04,160 --> 00:32:04,970
PAUL IRISH: I think
I was making--

1045
00:32:04,970 --> 00:32:06,160
PAUL LEWIS: Some people
are slow.

1046
00:32:06,160 --> 00:32:06,740
Some people are fast.

1047
00:32:06,740 --> 00:32:08,440
And then there's Paul Irish.

1048
00:32:08,440 --> 00:32:09,950
PAUL IRISH: I-- yeah.

1049
00:32:09,950 --> 00:32:12,780
So it looks like it actually
was more costly.

1050
00:32:12,780 --> 00:32:15,256
PAUL LEWIS: I would be
interested in spending a bit

1051
00:32:15,256 --> 00:32:16,430
more time on this if
I were the author.

1052
00:32:16,430 --> 00:32:18,190
PAUL IRISH: I think Behzad--
he tried it.

1053
00:32:18,190 --> 00:32:18,970
And he saw this.

1054
00:32:18,970 --> 00:32:21,160
And then he went back and went
like, I'm just going to set

1055
00:32:21,160 --> 00:32:23,750
left top, which is cray-cray
because--

1056
00:32:23,750 --> 00:32:26,190
[LAUGHING]

1057
00:32:26,190 --> 00:32:26,910
PAUL LEWIS: Yeah.

1058
00:32:26,910 --> 00:32:27,690
PAUL IRISH: Anyways.

1059
00:32:27,690 --> 00:32:28,830
PAUL LEWIS: But I
still think--

1060
00:32:28,830 --> 00:32:31,500
for me, I would look at the
3D transform again.

1061
00:32:31,500 --> 00:32:35,600
It seems like that might be
the better option here.

1062
00:32:35,600 --> 00:32:36,720
It's hard to say for sure.

1063
00:32:36,720 --> 00:32:40,205
But it seems like it might
be worth trying.

1064
00:32:40,205 --> 00:32:40,570
PAUL IRISH: Yeah.

1065
00:32:40,570 --> 00:32:43,095
The other thing I think that's
probably important is--

1066
00:32:43,095 --> 00:32:46,660

1067
00:32:46,660 --> 00:32:49,460
we keep asking about the width
and height of this image.

1068
00:32:49,460 --> 00:32:52,950
And it might that which is
causing the size, like the

1069
00:32:52,950 --> 00:32:56,920
browser is not terribly
confident in what

1070
00:32:56,920 --> 00:32:58,410
the actual size is.

1071
00:32:58,410 --> 00:33:00,850
And so it's going
to ask again.

1072
00:33:00,850 --> 00:33:01,030
PAUL LEWIS: Yeah.

1073
00:33:01,030 --> 00:33:03,826
I mean, there's no reason to
keep querying the width and

1074
00:33:03,826 --> 00:33:04,100
height there.

1075
00:33:04,100 --> 00:33:09,230
I think that's definitely
something to take a look at.

1076
00:33:09,230 --> 00:33:09,770
That's monster.

1077
00:33:09,770 --> 00:33:12,920
That is monster big, isn't it?

1078
00:33:12,920 --> 00:33:14,465
PAUL IRISH: All right.

1079
00:33:14,465 --> 00:33:16,940
The other thing--

1080
00:33:16,940 --> 00:33:17,180
yeah.

1081
00:33:17,180 --> 00:33:17,890
We should--

1082
00:33:17,890 --> 00:33:20,630
you want to show a continuous
paint on any of this?

1083
00:33:20,630 --> 00:33:21,670
PAUL LEWIS: I don't know.

1084
00:33:21,670 --> 00:33:22,670
PAUL IRISH: So it's
hard to say.

1085
00:33:22,670 --> 00:33:24,260
So these paints are big.

1086
00:33:24,260 --> 00:33:27,190
And so we can go in and
turn on Continuous

1087
00:33:27,190 --> 00:33:29,420
Paint Mode down here.

1088
00:33:29,420 --> 00:33:31,840
And I'll just re-dock
my DevTools.

1089
00:33:31,840 --> 00:33:35,490
And so what it's going to do
is it's just going to paint

1090
00:33:35,490 --> 00:33:37,170
the page again and
again and again.

1091
00:33:37,170 --> 00:33:38,900
And up here in the top right
of the page, we'll see how

1092
00:33:38,900 --> 00:33:40,570
long it takes to paint.

1093
00:33:40,570 --> 00:33:43,430
And from here, we can just
toggle things on and off.

1094
00:33:43,430 --> 00:33:44,750
Or you can use the H key.

1095
00:33:44,750 --> 00:33:46,640
So I turned off the
background.

1096
00:33:46,640 --> 00:33:49,610
And the paint performance
improves a little bit.

1097
00:33:49,610 --> 00:33:51,120
PAUL LEWIS: It's not
noticeably so.

1098
00:33:51,120 --> 00:33:51,990
PAUL IRISH: Not dramatically.

1099
00:33:51,990 --> 00:33:53,245
PAUL LEWIS: So this
is-- so this taps

1100
00:33:53,245 --> 00:33:53,940
into the other thing.

1101
00:33:53,940 --> 00:33:55,950
When we were talking about paint
areas before, that's

1102
00:33:55,950 --> 00:33:57,250
like part one.

1103
00:33:57,250 --> 00:33:59,220
Part two is paint complexity,
which is what this tool's

1104
00:33:59,220 --> 00:33:59,720
trying to show.

1105
00:33:59,720 --> 00:34:02,180
It's like if Chrome starts from
nothing, and it's got to

1106
00:34:02,180 --> 00:34:04,500
paint everything that's on
screen, how long does that

1107
00:34:04,500 --> 00:34:05,980
process take?

1108
00:34:05,980 --> 00:34:07,850
So it's kind of fluctuating,
what?

1109
00:34:07,850 --> 00:34:12,250
Roughly between somewhere
around the eight to

1110
00:34:12,250 --> 00:34:14,389
10 mark, I'd say.

1111
00:34:14,389 --> 00:34:16,860
Which means it's not
terribly complex to

1112
00:34:16,860 --> 00:34:19,030
repaint at this point.

1113
00:34:19,030 --> 00:34:19,530
PAUL IRISH: It's not that bad.

1114
00:34:19,530 --> 00:34:22,600
I mean, it could
be much better.

1115
00:34:22,600 --> 00:34:22,900
PAUL LEWIS: It could be worse.

1116
00:34:22,900 --> 00:34:26,960
But sometimes you'll see huge
spikes in the actual paint

1117
00:34:26,960 --> 00:34:29,865
time from when it's painting
from scratch.

1118
00:34:29,865 --> 00:34:31,690
PAUL IRISH: So I want
to try one thing.

1119
00:34:31,690 --> 00:34:32,020
Here.

1120
00:34:32,020 --> 00:34:34,710
We're going to turn on--

1121
00:34:34,710 --> 00:34:38,770
I like doing Composite Layer
Borders at the same time as

1122
00:34:38,770 --> 00:34:40,020
Paint Recs.

1123
00:34:40,020 --> 00:34:41,920

1124
00:34:41,920 --> 00:34:43,826
PAUL LEWIS: You've got Show
Paint Rectangles on.

1125
00:34:43,826 --> 00:34:44,620
PAUL IRISH: Do I?

1126
00:34:44,620 --> 00:34:44,960
PAUL LEWIS: I think.

1127
00:34:44,960 --> 00:34:46,280
PAUL IRISH: Yeah, yeah.

1128
00:34:46,280 --> 00:34:46,969
We have Show Paint Recs.

1129
00:34:46,969 --> 00:34:47,610
PAUL LEWIS: But you
haven't got--

1130
00:34:47,610 --> 00:34:48,310
PAUL IRISH: Layer borders.

1131
00:34:48,310 --> 00:34:49,260
PAUL LEWIS: You need to switch
on the first layer--

1132
00:34:49,260 --> 00:34:49,989
PAUL IRISH: Thank you.

1133
00:34:49,989 --> 00:34:50,469
Thank you.

1134
00:34:50,469 --> 00:34:52,580
Thank you.

1135
00:34:52,580 --> 00:34:53,139
OK.

1136
00:34:53,139 --> 00:34:54,729
Nothing's promoted.

1137
00:34:54,729 --> 00:34:55,750
This is what I was thinking.

1138
00:34:55,750 --> 00:34:57,990
I was thinking of promoting
these navs.

1139
00:34:57,990 --> 00:34:58,560
Terrible?

1140
00:34:58,560 --> 00:34:59,273
PAUL LEWIS: I don't know.

1141
00:34:59,273 --> 00:34:59,766
PAUL IRISH: I don't know.

1142
00:34:59,766 --> 00:35:00,650
PAUL LEWIS: Let's find out.

1143
00:35:00,650 --> 00:35:03,440
PAUL IRISH: All right.

1144
00:35:03,440 --> 00:35:04,850
This guy.

1145
00:35:04,850 --> 00:35:06,666
Yup, yup, yup.

1146
00:35:06,666 --> 00:35:09,240
Webkit transform--

1147
00:35:09,240 --> 00:35:11,320
PAUL LEWIS: So the reason I
would assume you're doing this

1148
00:35:11,320 --> 00:35:12,930
is because it's over the
top of something else.

1149
00:35:12,930 --> 00:35:13,810
PAUL IRISH: It's opacity.

1150
00:35:13,810 --> 00:35:15,650
PAUL LEWIS: And you're concerned
that it's grouping

1151
00:35:15,650 --> 00:35:19,522
them together into a single
bitmap in memory.

1152
00:35:19,522 --> 00:35:21,310
And you want to break it
down to its own layer.

1153
00:35:21,310 --> 00:35:21,620
PAUL IRISH: Yeah.

1154
00:35:21,620 --> 00:35:24,820
Because in Timeline, we did
see a good amount of

1155
00:35:24,820 --> 00:35:28,180
compositing costs, like
this composite layers.

1156
00:35:28,180 --> 00:35:32,410
And I'm guessing that because
these nav items have an

1157
00:35:32,410 --> 00:35:37,540
opacity on them, it's having to
do the compositing against

1158
00:35:37,540 --> 00:35:40,300
the background on every
single move.

1159
00:35:40,300 --> 00:35:42,640
So I'm guessing that if we drop
them out into layers--

1160
00:35:42,640 --> 00:35:42,880
PAUL LEWIS: Yup.

1161
00:35:42,880 --> 00:35:45,290
Then it's just-- all it's got to
do is it's got to just let

1162
00:35:45,290 --> 00:35:48,680
the GPU deal with that for us.

1163
00:35:48,680 --> 00:35:51,860
PAUL IRISH: That seems
pretty nice-ish.

1164
00:35:51,860 --> 00:35:53,160
PAUL LEWIS: You want
to profile it?

1165
00:35:53,160 --> 00:35:54,372
PAUL IRISH: I'll profile it.

1166
00:35:54,372 --> 00:35:55,980
PAUL LEWIS: Don't guess it.

1167
00:35:55,980 --> 00:35:58,380
PAUL IRISH: Test it.

1168
00:35:58,380 --> 00:35:58,790
PAUL LEWIS: Perfect.

1169
00:35:58,790 --> 00:36:02,870
I couldn't have asked for--
you're just the best.

1170
00:36:02,870 --> 00:36:03,020
PAUL IRISH: All right.

1171
00:36:03,020 --> 00:36:04,790
I turned off those
two debug modes.

1172
00:36:04,790 --> 00:36:06,730
And I'll turn it back on.

1173
00:36:06,730 --> 00:36:08,161
Oh, come on!

1174
00:36:08,161 --> 00:36:09,083
Nailed it!

1175
00:36:09,083 --> 00:36:10,470
Yeah!

1176
00:36:10,470 --> 00:36:13,860
PAUL LEWIS: And that's
how we do it.

1177
00:36:13,860 --> 00:36:14,820
PAUL IRISH: That was good.

1178
00:36:14,820 --> 00:36:18,020
PAUL LEWIS: This is genuinely
how we do this.

1179
00:36:18,020 --> 00:36:19,130
This is why we didn't
look at these too

1180
00:36:19,130 --> 00:36:21,341
closely before we started.

1181
00:36:21,341 --> 00:36:23,470
Hey, do you want to talk about
the transparent frame thing a

1182
00:36:23,470 --> 00:36:25,240
little bit?

1183
00:36:25,240 --> 00:36:26,580
PAUL IRISH: Oh, yeah, yeah.

1184
00:36:26,580 --> 00:36:26,950
OK.

1185
00:36:26,950 --> 00:36:29,830
So I'm going to start.

1186
00:36:29,830 --> 00:36:31,080
And then you--

1187
00:36:31,080 --> 00:36:31,900
OK.

1188
00:36:31,900 --> 00:36:35,040
If you're in timeline a lot,
you're going to see--

1189
00:36:35,040 --> 00:36:37,530
so these vertical bars, right?

1190
00:36:37,530 --> 00:36:42,620
And there's color at the bottom
of them, of course.

1191
00:36:42,620 --> 00:36:45,300
But then there's empty space.

1192
00:36:45,300 --> 00:36:47,740
There is this little dark
gray area here.

1193
00:36:47,740 --> 00:36:49,570
And that represents
uninstrumented code.

1194
00:36:49,570 --> 00:36:51,390
So we know that Chrome is doing
work, but we're not

1195
00:36:51,390 --> 00:36:52,900
exactly sure what
kind of work.

1196
00:36:52,900 --> 00:36:54,320
We're improving that.

1197
00:36:54,320 --> 00:36:55,740
PAUL LEWIS: So gray should
disappear over time.

1198
00:36:55,740 --> 00:36:56,420
PAUL IRISH: Yeah.

1199
00:36:56,420 --> 00:36:58,490
But then there's this case where
there's this kind of

1200
00:36:58,490 --> 00:37:02,730
this empty area leading
up to the 60 fps line.

1201
00:37:02,730 --> 00:37:03,880
PAUL LEWIS: Now, we don't
care about those, right?

1202
00:37:03,880 --> 00:37:04,730
PAUL IRISH: It doesn't matter.

1203
00:37:04,730 --> 00:37:07,220
That part really is
not a big concern.

1204
00:37:07,220 --> 00:37:08,480
You are hitting your
frame budget.

1205
00:37:08,480 --> 00:37:11,760
And Chrome's responsibility here
is to deliver a frame on

1206
00:37:11,760 --> 00:37:14,750
the Vsync of the monitor, which
means every time the

1207
00:37:14,750 --> 00:37:18,180
monitor's going to bring a frame
to my eyes, it wants to

1208
00:37:18,180 --> 00:37:20,250
have something ready for it.

1209
00:37:20,250 --> 00:37:21,220
PAUL LEWIS: So this
is room to spare,

1210
00:37:21,220 --> 00:37:22,660
basically, what we're seeing.

1211
00:37:22,660 --> 00:37:23,210
PAUL IRISH: Yeah.

1212
00:37:23,210 --> 00:37:25,400
PAUL LEWIS: Empty space is like
Chrome saying, I'm done.

1213
00:37:25,400 --> 00:37:27,860
I can chill out until the
end of this frame.

1214
00:37:27,860 --> 00:37:29,250
But then there's the odd
frame that we're

1215
00:37:29,250 --> 00:37:30,370
seeing here, which is--

1216
00:37:30,370 --> 00:37:31,200
PAUL IRISH: This guy

1217
00:37:31,200 --> 00:37:32,810
PAUL LEWIS: Which is shooting
out of the top.

1218
00:37:32,810 --> 00:37:36,450
PAUL IRISH: And it is
all empty space.

1219
00:37:36,450 --> 00:37:38,530
And so there's two things
to look at here.

1220
00:37:38,530 --> 00:37:40,900
One is--

1221
00:37:40,900 --> 00:37:43,550
so you see these gray bars
that are kind of in my

1222
00:37:43,550 --> 00:37:44,320
Timeline view?

1223
00:37:44,320 --> 00:37:45,440
PAUL LEWIS: No, you can switch
those on, right?

1224
00:37:45,440 --> 00:37:45,830
PAUL IRISH: Yeah.

1225
00:37:45,830 --> 00:37:52,640
So inside Settings, somewhere
down here is showing CPU

1226
00:37:52,640 --> 00:37:54,770
activity on the ruler.

1227
00:37:54,770 --> 00:37:55,760
And so it's off by default.

1228
00:37:55,760 --> 00:37:57,350
You'll have to turn it on.

1229
00:37:57,350 --> 00:38:00,900
But here, you'll get an idea
of, is the CPU active?

1230
00:38:00,900 --> 00:38:03,890
If the CPU is active-- maybe
something outside of Chrome is

1231
00:38:03,890 --> 00:38:06,750
doing a lot of work, which is
why Chrome had to slow down--

1232
00:38:06,750 --> 00:38:09,300
so you get an idea on what kind
of work is being done.

1233
00:38:09,300 --> 00:38:10,660
PAUL LEWIS: So the thing to do
here is to make sure-- if

1234
00:38:10,660 --> 00:38:12,240
you're going to do these
profiles, and you see

1235
00:38:12,240 --> 00:38:14,470
something like this, and you
want to just rule out other

1236
00:38:14,470 --> 00:38:15,200
apps, do that.

1237
00:38:15,200 --> 00:38:16,050
Close them down.

1238
00:38:16,050 --> 00:38:17,900
Make sure Chrome is the only
thing that's running.

1239
00:38:17,900 --> 00:38:19,620
Ideally, if you can really
do it, just go

1240
00:38:19,620 --> 00:38:21,260
into Incognito Mode.

1241
00:38:21,260 --> 00:38:22,640
Make sure this is the
only thing that's

1242
00:38:22,640 --> 00:38:23,710
running in the tab.

1243
00:38:23,710 --> 00:38:25,455
So it's just as isolated
as it can be.

1244
00:38:25,455 --> 00:38:27,010
PAUL IRISH: Kill all of the
tabs, Incognito, no

1245
00:38:27,010 --> 00:38:27,310
extensions.

1246
00:38:27,310 --> 00:38:27,970
PAUL LEWIS: It's
the only thing.

1247
00:38:27,970 --> 00:38:29,165
Yeah, nothing.

1248
00:38:29,165 --> 00:38:30,280
So it's just running
by itself.

1249
00:38:30,280 --> 00:38:33,190
So that kind of, as best as you
can, is going to eliminate

1250
00:38:33,190 --> 00:38:37,005
the kind of vying for
the CPU's attention.

1251
00:38:37,005 --> 00:38:40,450
PAUL IRISH: But in this case,
I do not have CPU activity

1252
00:38:40,450 --> 00:38:41,140
exactly there.

1253
00:38:41,140 --> 00:38:42,685
I mean, it's right here.

1254
00:38:42,685 --> 00:38:43,935
Right here and right here.

1255
00:38:43,935 --> 00:38:46,370

1256
00:38:46,370 --> 00:38:47,260
So what's--

1257
00:38:47,260 --> 00:38:49,440
can you tell me more about
what's going on here?

1258
00:38:49,440 --> 00:38:54,640
PAUL LEWIS: Sometimes it's going
to be Chrome waiting on

1259
00:38:54,640 --> 00:38:56,480
GPU, the simple version
of this.

1260
00:38:56,480 --> 00:39:00,240
It's just Chrome saying, I need
the GPU to do its work,

1261
00:39:00,240 --> 00:39:03,290
do some composting for example,
just deal with some

1262
00:39:03,290 --> 00:39:04,430
stuff, finish its workload.

1263
00:39:04,430 --> 00:39:07,690
And that, at the moment, is
currently showing as empty.

1264
00:39:07,690 --> 00:39:09,210
So sometimes it's just
simply-- and again,

1265
00:39:09,210 --> 00:39:10,730
it might not be--

1266
00:39:10,730 --> 00:39:12,590
we've only got one GPU normally
in these things.

1267
00:39:12,590 --> 00:39:15,380
So it might not be Chrome that's
waiting on the GPU.

1268
00:39:15,380 --> 00:39:17,750
But it might be something else
on your system that's actually

1269
00:39:17,750 --> 00:39:18,540
using the GPU.

1270
00:39:18,540 --> 00:39:20,100
So don't always assume
it's the browser.

1271
00:39:20,100 --> 00:39:23,080
But it can be waiting on
CPU and waiting on GPU.

1272
00:39:23,080 --> 00:39:24,950
PAUL IRISH: So one use case you
mentioned to me about this

1273
00:39:24,950 --> 00:39:28,240
was a lot of times in a WebGL
situation, you might be

1274
00:39:28,240 --> 00:39:30,510
uploading textures to the GPU.

1275
00:39:30,510 --> 00:39:33,650
Uploading textures to the GPU
generally can take a good

1276
00:39:33,650 --> 00:39:34,980
amount of time--

1277
00:39:34,980 --> 00:39:35,620
PAUL LEWIS: Especially
on on mobile

1278
00:39:35,620 --> 00:39:36,440
PAUL IRISH: --especially
on mobile.

1279
00:39:36,440 --> 00:39:40,650
So that might be an indication
of something that might be

1280
00:39:40,650 --> 00:39:41,360
happening here.

1281
00:39:41,360 --> 00:39:43,210
I should point out that this
is something that DevTools

1282
00:39:43,210 --> 00:39:43,960
will get better at.

1283
00:39:43,960 --> 00:39:46,690
And we'll be able to help give
you more insight into what

1284
00:39:46,690 --> 00:39:49,870
time is being absorbed
here and why.

1285
00:39:49,870 --> 00:39:50,710
For now, that's a--

1286
00:39:50,710 --> 00:39:52,490
PAUL LEWIS: I don't think
there's anything as a

1287
00:39:52,490 --> 00:39:54,560
developer that's directly
actionable

1288
00:39:54,560 --> 00:39:55,800
typically here as well.

1289
00:39:55,800 --> 00:39:59,520
If you're not dealing with WebGL
or Canvas or something

1290
00:39:59,520 --> 00:40:03,790
that's super GPU heavy, then
the chances are, it's just

1291
00:40:03,790 --> 00:40:07,590
something to do with Chrome's
overhead, probably the most

1292
00:40:07,590 --> 00:40:08,733
likely candidate.

1293
00:40:08,733 --> 00:40:09,136
PAUL IRISH: Yeah.

1294
00:40:09,136 --> 00:40:09,540
PAUL LEWIS: Yeah.

1295
00:40:09,540 --> 00:40:10,505
PAUL IRISH: I think that's--

1296
00:40:10,505 --> 00:40:11,820
I think we--

1297
00:40:11,820 --> 00:40:12,460
should we finish?

1298
00:40:12,460 --> 00:40:13,650
PAUL LEWIS: Yeah,
let's finish.

1299
00:40:13,650 --> 00:40:15,160
PAUL IRISH: Thank you very
much for watching.

1300
00:40:15,160 --> 00:40:18,160
If you want to dig in more into
these tools and what's

1301
00:40:18,160 --> 00:40:21,080
available, you can just
Google DevTools.

1302
00:40:21,080 --> 00:40:22,640
The Chrome DevTools
documentation will come up.

1303
00:40:22,640 --> 00:40:25,170
It talks a lot about Timeline,
continuous paint,

1304
00:40:25,170 --> 00:40:25,800
and things like that.

1305
00:40:25,800 --> 00:40:28,370
We also just posted about a
lot of the new features on

1306
00:40:28,370 --> 00:40:32,070
HTML5rocks.com, including-- we
didn't show the flame chart.

1307
00:40:32,070 --> 00:40:33,105
PAUL LEWIS: You want to just--

1308
00:40:33,105 --> 00:40:33,940
give us a minute.

1309
00:40:33,940 --> 00:40:35,220
We'll show you a flame chart.

1310
00:40:35,220 --> 00:40:35,810
PAUL IRISH: Flame chart,
flame chart.

1311
00:40:35,810 --> 00:40:36,880
PAUL LEWIS: He loves
the flame chart.

1312
00:40:36,880 --> 00:40:40,396
I-- to be fair, Paul requested
the flame chart.

1313
00:40:40,396 --> 00:40:42,160
It was his feature request.

1314
00:40:42,160 --> 00:40:42,500
PAUL IRISH: Come on.

1315
00:40:42,500 --> 00:40:43,340
PAUL LEWIS: He loved it.

1316
00:40:43,340 --> 00:40:44,115
He's so happy.

1317
00:40:44,115 --> 00:40:44,640
I'm so happy for him.

1318
00:40:44,640 --> 00:40:45,720
PAUL IRISH: It is
my feature area.

1319
00:40:45,720 --> 00:40:47,470
PAUL LEWIS: It's
just the best.

1320
00:40:47,470 --> 00:40:49,880
PAUL IRISH: I'll give a really
good example for the flame

1321
00:40:49,880 --> 00:40:53,673
char too because it's
just worth it.

1322
00:40:53,673 --> 00:40:54,540
PAUL LEWIS: Even
if he says so.

1323
00:40:54,540 --> 00:40:55,380
PAUL IRISH: Come over
to your MathJax.

1324
00:40:55,380 --> 00:40:58,410
It's a MathML polyfill.

1325
00:40:58,410 --> 00:41:00,340
We're going to bring up
DevTools really quick.

1326
00:41:00,340 --> 00:41:03,440
And I'm going to start
a CPU profile.

1327
00:41:03,440 --> 00:41:05,850
So flame chart is a
visualization of

1328
00:41:05,850 --> 00:41:08,140
a JavaScript profile.

1329
00:41:08,140 --> 00:41:11,620
Start, change to SVG rendering,
[STUTTERING]

1330
00:41:11,620 --> 00:41:12,370
go.

1331
00:41:12,370 --> 00:41:14,330
Change to HTML rendering, go.

1332
00:41:14,330 --> 00:41:16,060
SVG, go.

1333
00:41:16,060 --> 00:41:17,240
Boom, done.

1334
00:41:17,240 --> 00:41:19,690
Command D. OK, awesome.

1335
00:41:19,690 --> 00:41:20,910
PAUL LEWIS: Now, it won't be
flame chart by default,

1336
00:41:20,910 --> 00:41:21,910
though, right?

1337
00:41:21,910 --> 00:41:22,170
No.

1338
00:41:22,170 --> 00:41:22,740
PAUL LEWIS: You have
to switch this on.

1339
00:41:22,740 --> 00:41:23,000
PAUL IRISH: Yeah, yeah.

1340
00:41:23,000 --> 00:41:23,220
Thank you.

1341
00:41:23,220 --> 00:41:25,500
Down at the very bottom
is the toggle.

1342
00:41:25,500 --> 00:41:27,760
So it'll be probably
heavy bottom up.

1343
00:41:27,760 --> 00:41:29,340
And this is the one
that everyone's

1344
00:41:29,340 --> 00:41:30,370
used to seeing, right?

1345
00:41:30,370 --> 00:41:33,440
PAUL LEWIS: Which to be fair, is
pretty difficult for a lot

1346
00:41:33,440 --> 00:41:35,290
of people to kind understand
and get that.

1347
00:41:35,290 --> 00:41:36,260
PAUL IRISH: I think so too.

1348
00:41:36,260 --> 00:41:37,030
I think so too.

1349
00:41:37,030 --> 00:41:38,500
PAUL LEWIS: Which is why you
suggested the flame chart.

1350
00:41:38,500 --> 00:41:38,840
PAUL IRISH: Hey-o.

1351
00:41:38,840 --> 00:41:40,180
Flame chart.

1352
00:41:40,180 --> 00:41:41,580
So we've got a flame
chart here.

1353
00:41:41,580 --> 00:41:45,000
So the cool thing here is
it's Timeline based.

1354
00:41:45,000 --> 00:41:47,220
So we're seeing from the
beginning of my reporting to

1355
00:41:47,220 --> 00:41:50,790
the seven seconds
that I recorded.

1356
00:41:50,790 --> 00:41:54,270
And we can see that in the
mini map-- so this is the

1357
00:41:54,270 --> 00:41:55,780
first time that it's
changed to SVG.

1358
00:41:55,780 --> 00:41:59,020
And I know because I've looked
at this before, there's a lot

1359
00:41:59,020 --> 00:42:00,580
of interrupted CPU activity.

1360
00:42:00,580 --> 00:42:02,910
This is because there's network
activity kind of

1361
00:42:02,910 --> 00:42:03,680
interrupting this.

1362
00:42:03,680 --> 00:42:06,900
That's something that-- but once
I had it in place, you

1363
00:42:06,900 --> 00:42:11,090
can see it's just straight
up stuff going on.

1364
00:42:11,090 --> 00:42:13,360
Let me try and maximize this
a little bit more.

1365
00:42:13,360 --> 00:42:15,060
I'm going to have to
zoom out of touch.

1366
00:42:15,060 --> 00:42:17,130
There is a lot of stuff
going on here.

1367
00:42:17,130 --> 00:42:20,650
And the way to parse
these graphs is

1368
00:42:20,650 --> 00:42:23,340
y-axis is call stack.

1369
00:42:23,340 --> 00:42:25,120
Call stack is not a bad thing.

1370
00:42:25,120 --> 00:42:26,790
It's not a bad thing that
your call stack

1371
00:42:26,790 --> 00:42:28,550
is necessarily deep.

1372
00:42:28,550 --> 00:42:31,680
So height is not terribly
important.

1373
00:42:31,680 --> 00:42:33,190
Width is what soaks up time.

1374
00:42:33,190 --> 00:42:34,470
PAUL LEWIS: Because this
is time, right?

1375
00:42:34,470 --> 00:42:35,100
PAUL IRISH: Yeah, exactly.

1376
00:42:35,100 --> 00:42:36,330
Tighter on the--

1377
00:42:36,330 --> 00:42:37,170
PAUL LEWIS: The longer
it is, right?

1378
00:42:37,170 --> 00:42:40,610
PAUL IRISH: Longer is worse.

1379
00:42:40,610 --> 00:42:41,712
PAUL LEWIS: Normally.

1380
00:42:41,712 --> 00:42:43,680
PAUL IRISH: [LAUGHS]

1381
00:42:43,680 --> 00:42:45,570
OK.

1382
00:42:45,570 --> 00:42:48,870
And so we can kind
of scroll in.

1383
00:42:48,870 --> 00:42:51,460
I can zoom by just going up
and down on the track pad.

1384
00:42:51,460 --> 00:42:55,880
I can also page just by
dragging over here.

1385
00:42:55,880 --> 00:42:59,430
And we can take a look at kind
of where my time was spent.

1386
00:42:59,430 --> 00:43:00,730
And the other nice thing is
that we can understand a

1387
00:43:00,730 --> 00:43:04,050
little bit about the execution
flow of the application by

1388
00:43:04,050 --> 00:43:05,500
seeing that things
started off.

1389
00:43:05,500 --> 00:43:08,460
We went into Set Mode rendering
in MathJax.

1390
00:43:08,460 --> 00:43:10,290
And we did a little bit of
prep work right here.

1391
00:43:10,290 --> 00:43:11,690
We moved into this
removeChild.

1392
00:43:11,690 --> 00:43:12,860
This is doing some SVG work.

1393
00:43:12,860 --> 00:43:14,770
This removeChild took six
milliseconds, which is a

1394
00:43:14,770 --> 00:43:15,390
pretty long time.

1395
00:43:15,390 --> 00:43:16,740
PAUL LEWIS: So I'll tell you
what because this is quite

1396
00:43:16,740 --> 00:43:18,756
different when you're looking
at these things and it's not

1397
00:43:18,756 --> 00:43:19,660
your own code.

1398
00:43:19,660 --> 00:43:21,630
If you run this against your
own code, you're going to

1399
00:43:21,630 --> 00:43:22,450
recognize the functions.

1400
00:43:22,450 --> 00:43:24,000
You're going to recognize
the objects.

1401
00:43:24,000 --> 00:43:24,980
You'll recognize everything
you see here.

1402
00:43:24,980 --> 00:43:27,300
And you're going to be like,
oh wow, I didn't realize it

1403
00:43:27,300 --> 00:43:28,020
was spending so long
doing that

1404
00:43:28,020 --> 00:43:28,370
PAUL IRISH: Yeah.

1405
00:43:28,370 --> 00:43:30,640
So flame chart.

1406
00:43:30,640 --> 00:43:31,120
PAUL LEWIS: Awesome.

1407
00:43:31,120 --> 00:43:33,350
PAUL IRISH: Good.

1408
00:43:33,350 --> 00:43:36,440
Very useful when you identify
that you are spending a lot of

1409
00:43:36,440 --> 00:43:39,030
time in JavaScript
in particular.

1410
00:43:39,030 --> 00:43:41,150
It's not appropriate when you
see that you're spending time

1411
00:43:41,150 --> 00:43:44,270
in paint, layout, recalc style,
things like that, but

1412
00:43:44,270 --> 00:43:45,030
should help quite a bit.

1413
00:43:45,030 --> 00:43:46,360
PAUL LEWIS: Which is
always the case.

1414
00:43:46,360 --> 00:43:48,980
Find your actual bottleneck
and fix that one, not the

1415
00:43:48,980 --> 00:43:50,890
thing you think is
the bottleneck.

1416
00:43:50,890 --> 00:43:51,270
PAUL IRISH: [SNAPS FINGERS]

1417
00:43:51,270 --> 00:43:51,800
PAUL LEWIS: Should
we close on that?

1418
00:43:51,800 --> 00:43:52,240
PAUL IRISH: Yes.

1419
00:43:52,240 --> 00:43:52,680
PAUL LEWIS: Boom.

1420
00:43:52,680 --> 00:43:53,120
PAUL IRISH: Boom.

1421
00:43:53,120 --> 00:43:54,370
PAUL LEWIS: Thank you.

1422
00:43:54,370 --> 00:44:50,240

